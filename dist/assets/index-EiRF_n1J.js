function tP(d,h){for(var _=0;_<h.length;_++){const T=h[_];if(typeof T!="string"&&!Array.isArray(T)){for(const R in T)if(R!=="default"&&!(R in d)){const D=Object.getOwnPropertyDescriptor(T,R);D&&Object.defineProperty(d,R,D.get?D:{enumerable:!0,get:()=>T[R]})}}}return Object.freeze(Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}))}(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))T(R);new MutationObserver(R=>{for(const D of R)if(D.type==="childList")for(const B of D.addedNodes)B.tagName==="LINK"&&B.rel==="modulepreload"&&T(B)}).observe(document,{childList:!0,subtree:!0});function _(R){const D={};return R.integrity&&(D.integrity=R.integrity),R.referrerPolicy&&(D.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?D.credentials="include":R.crossOrigin==="anonymous"?D.credentials="omit":D.credentials="same-origin",D}function T(R){if(R.ep)return;R.ep=!0;const D=_(R);fetch(R.href,D)}})();function _1(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var ow={exports:{}},ev={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o2;function iP(){if(o2)return ev;o2=1;var d=Symbol.for("react.transitional.element"),h=Symbol.for("react.fragment");function _(T,R,D){var B=null;if(D!==void 0&&(B=""+D),R.key!==void 0&&(B=""+R.key),"key"in R){D={};for(var r in R)r!=="key"&&(D[r]=R[r])}else D=R;return R=D.ref,{$$typeof:d,type:T,key:B,ref:R!==void 0?R:null,props:D}}return ev.Fragment=h,ev.jsx=_,ev.jsxs=_,ev}var a2;function nP(){return a2||(a2=1,ow.exports=iP()),ow.exports}var ee=nP(),Tx=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(d){return this.listeners.add(d),this.onSubscribe(),()=>{this.listeners.delete(d),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},rP={setTimeout:(d,h)=>setTimeout(d,h),clearTimeout:d=>clearTimeout(d),setInterval:(d,h)=>setInterval(d,h),clearInterval:d=>clearInterval(d)},sP=class{#e=rP;#t=!1;setTimeoutProvider(d){this.#e=d}setTimeout(d,h){return this.#e.setTimeout(d,h)}clearTimeout(d){this.#e.clearTimeout(d)}setInterval(d,h){return this.#e.setInterval(d,h)}clearInterval(d){this.#e.clearInterval(d)}},kw=new sP;function oP(d){setTimeout(d,0)}var Sx=typeof window>"u"||"Deno"in globalThis;function Ju(){}function aP(d,h){return typeof d=="function"?d(h):d}function lP(d){return typeof d=="number"&&d>=0&&d!==1/0}function cP(d,h){return Math.max(d+(h||0)-Date.now(),0)}function Bw(d,h){return typeof d=="function"?d(h):d}function uP(d,h){return typeof d=="function"?d(h):d}function l2(d,h){const{type:_="all",exact:T,fetchStatus:R,predicate:D,queryKey:B,stale:r}=d;if(B){if(T){if(h.queryHash!==y1(B,h.options))return!1}else if(!dv(h.queryKey,B))return!1}if(_!=="all"){const q=h.isActive();if(_==="active"&&!q||_==="inactive"&&q)return!1}return!(typeof r=="boolean"&&h.isStale()!==r||R&&R!==h.state.fetchStatus||D&&!D(h))}function c2(d,h){const{exact:_,status:T,predicate:R,mutationKey:D}=d;if(D){if(!h.options.mutationKey)return!1;if(_){if(hv(h.options.mutationKey)!==hv(D))return!1}else if(!dv(h.options.mutationKey,D))return!1}return!(T&&h.state.status!==T||R&&!R(h))}function y1(d,h){return(h?.queryKeyHashFn||hv)(d)}function hv(d){return JSON.stringify(d,(h,_)=>Fw(_)?Object.keys(_).sort().reduce((T,R)=>(T[R]=_[R],T),{}):_)}function dv(d,h){return d===h?!0:typeof d!=typeof h?!1:d&&h&&typeof d=="object"&&typeof h=="object"?Object.keys(h).every(_=>dv(d[_],h[_])):!1}var hP=Object.prototype.hasOwnProperty;function GA(d,h){if(d===h)return d;const _=u2(d)&&u2(h);if(!_&&!(Fw(d)&&Fw(h)))return h;const R=(_?d:Object.keys(d)).length,D=_?h:Object.keys(h),B=D.length,r=_?new Array(B):{};let q=0;for(let H=0;H<B;H++){const ie=_?H:D[H],Q=d[ie],me=h[ie];if(Q===me){r[ie]=Q,(_?H<R:hP.call(d,ie))&&q++;continue}if(Q===null||me===null||typeof Q!="object"||typeof me!="object"){r[ie]=me;continue}const we=GA(Q,me);r[ie]=we,we===Q&&q++}return R===B&&q===R?d:r}function u2(d){return Array.isArray(d)&&d.length===Object.keys(d).length}function Fw(d){if(!h2(d))return!1;const h=d.constructor;if(h===void 0)return!0;const _=h.prototype;return!(!h2(_)||!_.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(d)!==Object.prototype)}function h2(d){return Object.prototype.toString.call(d)==="[object Object]"}function dP(d){return new Promise(h=>{kw.setTimeout(h,d)})}function fP(d,h,_){return typeof _.structuralSharing=="function"?_.structuralSharing(d,h):_.structuralSharing!==!1?GA(d,h):h}function pP(d,h,_=0){const T=[...d,h];return _&&T.length>_?T.slice(1):T}function mP(d,h,_=0){const T=[h,...d];return _&&T.length>_?T.slice(0,-1):T}var v1=Symbol();function qA(d,h){return!d.queryFn&&h?.initialPromise?()=>h.initialPromise:!d.queryFn||d.queryFn===v1?()=>Promise.reject(new Error(`Missing queryFn: '${d.queryHash}'`)):d.queryFn}var gP=class extends Tx{#e;#t;#i;constructor(){super(),this.#i=d=>{if(!Sx&&window.addEventListener){const h=()=>d();return window.addEventListener("visibilitychange",h,!1),()=>{window.removeEventListener("visibilitychange",h)}}}}onSubscribe(){this.#t||this.setEventListener(this.#i)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(d){this.#i=d,this.#t?.(),this.#t=d(h=>{typeof h=="boolean"?this.setFocused(h):this.onFocus()})}setFocused(d){this.#e!==d&&(this.#e=d,this.onFocus())}onFocus(){const d=this.isFocused();this.listeners.forEach(h=>{h(d)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},HA=new gP;function _P(){let d,h;const _=new Promise((R,D)=>{d=R,h=D});_.status="pending",_.catch(()=>{});function T(R){Object.assign(_,R),delete _.resolve,delete _.reject}return _.resolve=R=>{T({status:"fulfilled",value:R}),d(R)},_.reject=R=>{T({status:"rejected",reason:R}),h(R)},_}var yP=oP;function vP(){let d=[],h=0,_=r=>{r()},T=r=>{r()},R=yP;const D=r=>{h?d.push(r):R(()=>{_(r)})},B=()=>{const r=d;d=[],r.length&&R(()=>{T(()=>{r.forEach(q=>{_(q)})})})};return{batch:r=>{let q;h++;try{q=r()}finally{h--,h||B()}return q},batchCalls:r=>(...q)=>{D(()=>{r(...q)})},schedule:D,setNotifyFunction:r=>{_=r},setBatchNotifyFunction:r=>{T=r},setScheduler:r=>{R=r}}}var gl=vP(),xP=class extends Tx{#e=!0;#t;#i;constructor(){super(),this.#i=d=>{if(!Sx&&window.addEventListener){const h=()=>d(!0),_=()=>d(!1);return window.addEventListener("online",h,!1),window.addEventListener("offline",_,!1),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",_)}}}}onSubscribe(){this.#t||this.setEventListener(this.#i)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(d){this.#i=d,this.#t?.(),this.#t=d(this.setOnline.bind(this))}setOnline(d){this.#e!==d&&(this.#e=d,this.listeners.forEach(_=>{_(d)}))}isOnline(){return this.#e}},cx=new xP;function bP(d){return Math.min(1e3*2**d,3e4)}function $A(d){return(d??"online")==="online"?cx.isOnline():!0}var Nw=class extends Error{constructor(d){super("CancelledError"),this.revert=d?.revert,this.silent=d?.silent}};function ZA(d){let h=!1,_=0,T;const R=_P(),D=()=>R.status!=="pending",B=he=>{if(!D()){const Re=new Nw(he);me(Re),d.onCancel?.(Re)}},r=()=>{h=!0},q=()=>{h=!1},H=()=>HA.isFocused()&&(d.networkMode==="always"||cx.isOnline())&&d.canRun(),ie=()=>$A(d.networkMode)&&d.canRun(),Q=he=>{D()||(T?.(),R.resolve(he))},me=he=>{D()||(T?.(),R.reject(he))},we=()=>new Promise(he=>{T=Re=>{(D()||H())&&he(Re)},d.onPause?.()}).then(()=>{T=void 0,D()||d.onContinue?.()}),Ae=()=>{if(D())return;let he;const Re=_===0?d.initialPromise:void 0;try{he=Re??d.fn()}catch(Ne){he=Promise.reject(Ne)}Promise.resolve(he).then(Q).catch(Ne=>{if(D())return;const Ge=d.retry??(Sx?0:3),Ue=d.retryDelay??bP,rt=typeof Ue=="function"?Ue(_,Ne):Ue,Pt=Ge===!0||typeof Ge=="number"&&_<Ge||typeof Ge=="function"&&Ge(_,Ne);if(h||!Pt){me(Ne);return}_++,d.onFail?.(_,Ne),dP(rt).then(()=>H()?void 0:we()).then(()=>{h?me(Ne):Ae()})})};return{promise:R,status:()=>R.status,cancel:B,continue:()=>(T?.(),R),cancelRetry:r,continueRetry:q,canStart:ie,start:()=>(ie()?Ae():we().then(Ae),R)}}var WA=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),lP(this.gcTime)&&(this.#e=kw.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(d){this.gcTime=Math.max(this.gcTime||0,d??(Sx?1/0:300*1e3))}clearGcTimeout(){this.#e&&(kw.clearTimeout(this.#e),this.#e=void 0)}},wP=class extends WA{#e;#t;#i;#r;#n;#o;#a;constructor(d){super(),this.#a=!1,this.#o=d.defaultOptions,this.setOptions(d.options),this.observers=[],this.#r=d.client,this.#i=this.#r.getQueryCache(),this.queryKey=d.queryKey,this.queryHash=d.queryHash,this.#e=d2(this.options),this.state=d.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(d){if(this.options={...this.#o,...d},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const h=d2(this.options);h.data!==void 0&&(this.setData(h.data,{updatedAt:h.dataUpdatedAt,manual:!0}),this.#e=h)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#i.remove(this)}setData(d,h){const _=fP(this.state.data,d,this.options);return this.#s({data:_,type:"success",dataUpdatedAt:h?.updatedAt,manual:h?.manual}),_}setState(d,h){this.#s({type:"setState",state:d,setStateOptions:h})}cancel(d){const h=this.#n?.promise;return this.#n?.cancel(d),h?h.then(Ju).catch(Ju):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(d=>uP(d.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===v1||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(d=>Bw(d.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(d=>d.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(d=0){return this.state.data===void 0?!0:d==="static"?!1:this.state.isInvalidated?!0:!cP(this.state.dataUpdatedAt,d)}onFocus(){this.observers.find(h=>h.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(h=>h.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(d){this.observers.includes(d)||(this.observers.push(d),this.clearGcTimeout(),this.#i.notify({type:"observerAdded",query:this,observer:d}))}removeObserver(d){this.observers.includes(d)&&(this.observers=this.observers.filter(h=>h!==d),this.observers.length||(this.#n&&(this.#a?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#i.notify({type:"observerRemoved",query:this,observer:d}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(d,h){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&h?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(d&&this.setOptions(d),!this.options.queryFn){const r=this.observers.find(q=>q.options.queryFn);r&&this.setOptions(r.options)}const _=new AbortController,T=r=>{Object.defineProperty(r,"signal",{enumerable:!0,get:()=>(this.#a=!0,_.signal)})},R=()=>{const r=qA(this.options,h),H=(()=>{const ie={client:this.#r,queryKey:this.queryKey,meta:this.meta};return T(ie),ie})();return this.#a=!1,this.options.persister?this.options.persister(r,H,this):r(H)},B=(()=>{const r={fetchOptions:h,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:R};return T(r),r})();this.options.behavior?.onFetch(B,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==B.fetchOptions?.meta)&&this.#s({type:"fetch",meta:B.fetchOptions?.meta}),this.#n=ZA({initialPromise:h?.initialPromise,fn:B.fetchFn,onCancel:r=>{r instanceof Nw&&r.revert&&this.setState({...this.#t,fetchStatus:"idle"}),_.abort()},onFail:(r,q)=>{this.#s({type:"failed",failureCount:r,error:q})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:B.options.retry,retryDelay:B.options.retryDelay,networkMode:B.options.networkMode,canRun:()=>!0});try{const r=await this.#n.start();if(r===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(r),this.#i.config.onSuccess?.(r,this),this.#i.config.onSettled?.(r,this.state.error,this),r}catch(r){if(r instanceof Nw){if(r.silent)return this.#n.promise;if(r.revert){if(this.state.data===void 0)throw r;return this.state.data}}throw this.#s({type:"error",error:r}),this.#i.config.onError?.(r,this),this.#i.config.onSettled?.(this.state.data,r,this),r}finally{this.scheduleGc()}}#s(d){const h=_=>{switch(d.type){case"failed":return{..._,fetchFailureCount:d.failureCount,fetchFailureReason:d.error};case"pause":return{..._,fetchStatus:"paused"};case"continue":return{..._,fetchStatus:"fetching"};case"fetch":return{..._,...TP(_.data,this.options),fetchMeta:d.meta??null};case"success":const T={..._,data:d.data,dataUpdateCount:_.dataUpdateCount+1,dataUpdatedAt:d.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!d.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=d.manual?T:void 0,T;case"error":const R=d.error;return{..._,error:R,errorUpdateCount:_.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:_.fetchFailureCount+1,fetchFailureReason:R,fetchStatus:"idle",status:"error"};case"invalidate":return{..._,isInvalidated:!0};case"setState":return{..._,...d.state}}};this.state=h(this.state),gl.batch(()=>{this.observers.forEach(_=>{_.onQueryUpdate()}),this.#i.notify({query:this,type:"updated",action:d})})}};function TP(d,h){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:$A(h.networkMode)?"fetching":"paused",...d===void 0&&{error:null,status:"pending"}}}function d2(d){const h=typeof d.initialData=="function"?d.initialData():d.initialData,_=h!==void 0,T=_?typeof d.initialDataUpdatedAt=="function"?d.initialDataUpdatedAt():d.initialDataUpdatedAt:0;return{data:h,dataUpdateCount:0,dataUpdatedAt:_?T??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:_?"success":"pending",fetchStatus:"idle"}}function f2(d){return{onFetch:(h,_)=>{const T=h.options,R=h.fetchOptions?.meta?.fetchMore?.direction,D=h.state.data?.pages||[],B=h.state.data?.pageParams||[];let r={pages:[],pageParams:[]},q=0;const H=async()=>{let ie=!1;const Q=Ae=>{Object.defineProperty(Ae,"signal",{enumerable:!0,get:()=>(h.signal.aborted?ie=!0:h.signal.addEventListener("abort",()=>{ie=!0}),h.signal)})},me=qA(h.options,h.fetchOptions),we=async(Ae,he,Re)=>{if(ie)return Promise.reject();if(he==null&&Ae.pages.length)return Promise.resolve(Ae);const Ge=(()=>{const Bt={client:h.client,queryKey:h.queryKey,pageParam:he,direction:Re?"backward":"forward",meta:h.options.meta};return Q(Bt),Bt})(),Ue=await me(Ge),{maxPages:rt}=h.options,Pt=Re?mP:pP;return{pages:Pt(Ae.pages,Ue,rt),pageParams:Pt(Ae.pageParams,he,rt)}};if(R&&D.length){const Ae=R==="backward",he=Ae?SP:p2,Re={pages:D,pageParams:B},Ne=he(T,Re);r=await we(Re,Ne,Ae)}else{const Ae=d??D.length;do{const he=q===0?B[0]??T.initialPageParam:p2(T,r);if(q>0&&he==null)break;r=await we(r,he),q++}while(q<Ae)}return r};h.options.persister?h.fetchFn=()=>h.options.persister?.(H,{client:h.client,queryKey:h.queryKey,meta:h.options.meta,signal:h.signal},_):h.fetchFn=H}}}function p2(d,{pages:h,pageParams:_}){const T=h.length-1;return h.length>0?d.getNextPageParam(h[T],h,_[T],_):void 0}function SP(d,{pages:h,pageParams:_}){return h.length>0?d.getPreviousPageParam?.(h[0],h,_[0],_):void 0}var EP=class extends WA{#e;#t;#i;#r;constructor(d){super(),this.#e=d.client,this.mutationId=d.mutationId,this.#i=d.mutationCache,this.#t=[],this.state=d.state||AP(),this.setOptions(d.options),this.scheduleGc()}setOptions(d){this.options=d,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(d){this.#t.includes(d)||(this.#t.push(d),this.clearGcTimeout(),this.#i.notify({type:"observerAdded",mutation:this,observer:d}))}removeObserver(d){this.#t=this.#t.filter(h=>h!==d),this.scheduleGc(),this.#i.notify({type:"observerRemoved",mutation:this,observer:d})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#i.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(d){const h=()=>{this.#n({type:"continue"})},_={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=ZA({fn:()=>this.options.mutationFn?this.options.mutationFn(d,_):Promise.reject(new Error("No mutationFn found")),onFail:(D,B)=>{this.#n({type:"failed",failureCount:D,error:B})},onPause:()=>{this.#n({type:"pause"})},onContinue:h,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#i.canRun(this)});const T=this.state.status==="pending",R=!this.#r.canStart();try{if(T)h();else{this.#n({type:"pending",variables:d,isPaused:R}),await this.#i.config.onMutate?.(d,this,_);const B=await this.options.onMutate?.(d,_);B!==this.state.context&&this.#n({type:"pending",context:B,variables:d,isPaused:R})}const D=await this.#r.start();return await this.#i.config.onSuccess?.(D,d,this.state.context,this,_),await this.options.onSuccess?.(D,d,this.state.context,_),await this.#i.config.onSettled?.(D,null,this.state.variables,this.state.context,this,_),await this.options.onSettled?.(D,null,d,this.state.context,_),this.#n({type:"success",data:D}),D}catch(D){try{throw await this.#i.config.onError?.(D,d,this.state.context,this,_),await this.options.onError?.(D,d,this.state.context,_),await this.#i.config.onSettled?.(void 0,D,this.state.variables,this.state.context,this,_),await this.options.onSettled?.(void 0,D,d,this.state.context,_),D}finally{this.#n({type:"error",error:D})}}finally{this.#i.runNext(this)}}#n(d){const h=_=>{switch(d.type){case"failed":return{..._,failureCount:d.failureCount,failureReason:d.error};case"pause":return{..._,isPaused:!0};case"continue":return{..._,isPaused:!1};case"pending":return{..._,context:d.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:d.isPaused,status:"pending",variables:d.variables,submittedAt:Date.now()};case"success":return{..._,data:d.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{..._,data:void 0,error:d.error,failureCount:_.failureCount+1,failureReason:d.error,isPaused:!1,status:"error"}}};this.state=h(this.state),gl.batch(()=>{this.#t.forEach(_=>{_.onMutationUpdate(d)}),this.#i.notify({mutation:this,type:"updated",action:d})})}};function AP(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var CP=class extends Tx{constructor(d={}){super(),this.config=d,this.#e=new Set,this.#t=new Map,this.#i=0}#e;#t;#i;build(d,h,_){const T=new EP({client:d,mutationCache:this,mutationId:++this.#i,options:d.defaultMutationOptions(h),state:_});return this.add(T),T}add(d){this.#e.add(d);const h=j0(d);if(typeof h=="string"){const _=this.#t.get(h);_?_.push(d):this.#t.set(h,[d])}this.notify({type:"added",mutation:d})}remove(d){if(this.#e.delete(d)){const h=j0(d);if(typeof h=="string"){const _=this.#t.get(h);if(_)if(_.length>1){const T=_.indexOf(d);T!==-1&&_.splice(T,1)}else _[0]===d&&this.#t.delete(h)}}this.notify({type:"removed",mutation:d})}canRun(d){const h=j0(d);if(typeof h=="string"){const T=this.#t.get(h)?.find(R=>R.state.status==="pending");return!T||T===d}else return!0}runNext(d){const h=j0(d);return typeof h=="string"?this.#t.get(h)?.find(T=>T!==d&&T.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){gl.batch(()=>{this.#e.forEach(d=>{this.notify({type:"removed",mutation:d})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(d){const h={exact:!0,...d};return this.getAll().find(_=>c2(h,_))}findAll(d={}){return this.getAll().filter(h=>c2(d,h))}notify(d){gl.batch(()=>{this.listeners.forEach(h=>{h(d)})})}resumePausedMutations(){const d=this.getAll().filter(h=>h.state.isPaused);return gl.batch(()=>Promise.all(d.map(h=>h.continue().catch(Ju))))}};function j0(d){return d.options.scope?.id}var IP=class extends Tx{constructor(d={}){super(),this.config=d,this.#e=new Map}#e;build(d,h,_){const T=h.queryKey,R=h.queryHash??y1(T,h);let D=this.get(R);return D||(D=new wP({client:d,queryKey:T,queryHash:R,options:d.defaultQueryOptions(h),state:_,defaultOptions:d.getQueryDefaults(T)}),this.add(D)),D}add(d){this.#e.has(d.queryHash)||(this.#e.set(d.queryHash,d),this.notify({type:"added",query:d}))}remove(d){const h=this.#e.get(d.queryHash);h&&(d.destroy(),h===d&&this.#e.delete(d.queryHash),this.notify({type:"removed",query:d}))}clear(){gl.batch(()=>{this.getAll().forEach(d=>{this.remove(d)})})}get(d){return this.#e.get(d)}getAll(){return[...this.#e.values()]}find(d){const h={exact:!0,...d};return this.getAll().find(_=>l2(h,_))}findAll(d={}){const h=this.getAll();return Object.keys(d).length>0?h.filter(_=>l2(d,_)):h}notify(d){gl.batch(()=>{this.listeners.forEach(h=>{h(d)})})}onFocus(){gl.batch(()=>{this.getAll().forEach(d=>{d.onFocus()})})}onOnline(){gl.batch(()=>{this.getAll().forEach(d=>{d.onOnline()})})}},RP=class{#e;#t;#i;#r;#n;#o;#a;#s;constructor(d={}){this.#e=d.queryCache||new IP,this.#t=d.mutationCache||new CP,this.#i=d.defaultOptions||{},this.#r=new Map,this.#n=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=HA.subscribe(async d=>{d&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=cx.subscribe(async d=>{d&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#s?.(),this.#s=void 0)}isFetching(d){return this.#e.findAll({...d,fetchStatus:"fetching"}).length}isMutating(d){return this.#t.findAll({...d,status:"pending"}).length}getQueryData(d){const h=this.defaultQueryOptions({queryKey:d});return this.#e.get(h.queryHash)?.state.data}ensureQueryData(d){const h=this.defaultQueryOptions(d),_=this.#e.build(this,h),T=_.state.data;return T===void 0?this.fetchQuery(d):(d.revalidateIfStale&&_.isStaleByTime(Bw(h.staleTime,_))&&this.prefetchQuery(h),Promise.resolve(T))}getQueriesData(d){return this.#e.findAll(d).map(({queryKey:h,state:_})=>{const T=_.data;return[h,T]})}setQueryData(d,h,_){const T=this.defaultQueryOptions({queryKey:d}),D=this.#e.get(T.queryHash)?.state.data,B=aP(h,D);if(B!==void 0)return this.#e.build(this,T).setData(B,{..._,manual:!0})}setQueriesData(d,h,_){return gl.batch(()=>this.#e.findAll(d).map(({queryKey:T})=>[T,this.setQueryData(T,h,_)]))}getQueryState(d){const h=this.defaultQueryOptions({queryKey:d});return this.#e.get(h.queryHash)?.state}removeQueries(d){const h=this.#e;gl.batch(()=>{h.findAll(d).forEach(_=>{h.remove(_)})})}resetQueries(d,h){const _=this.#e;return gl.batch(()=>(_.findAll(d).forEach(T=>{T.reset()}),this.refetchQueries({type:"active",...d},h)))}cancelQueries(d,h={}){const _={revert:!0,...h},T=gl.batch(()=>this.#e.findAll(d).map(R=>R.cancel(_)));return Promise.all(T).then(Ju).catch(Ju)}invalidateQueries(d,h={}){return gl.batch(()=>(this.#e.findAll(d).forEach(_=>{_.invalidate()}),d?.refetchType==="none"?Promise.resolve():this.refetchQueries({...d,type:d?.refetchType??d?.type??"active"},h)))}refetchQueries(d,h={}){const _={...h,cancelRefetch:h.cancelRefetch??!0},T=gl.batch(()=>this.#e.findAll(d).filter(R=>!R.isDisabled()&&!R.isStatic()).map(R=>{let D=R.fetch(void 0,_);return _.throwOnError||(D=D.catch(Ju)),R.state.fetchStatus==="paused"?Promise.resolve():D}));return Promise.all(T).then(Ju)}fetchQuery(d){const h=this.defaultQueryOptions(d);h.retry===void 0&&(h.retry=!1);const _=this.#e.build(this,h);return _.isStaleByTime(Bw(h.staleTime,_))?_.fetch(h):Promise.resolve(_.state.data)}prefetchQuery(d){return this.fetchQuery(d).then(Ju).catch(Ju)}fetchInfiniteQuery(d){return d.behavior=f2(d.pages),this.fetchQuery(d)}prefetchInfiniteQuery(d){return this.fetchInfiniteQuery(d).then(Ju).catch(Ju)}ensureInfiniteQueryData(d){return d.behavior=f2(d.pages),this.ensureQueryData(d)}resumePausedMutations(){return cx.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#i}setDefaultOptions(d){this.#i=d}setQueryDefaults(d,h){this.#r.set(hv(d),{queryKey:d,defaultOptions:h})}getQueryDefaults(d){const h=[...this.#r.values()],_={};return h.forEach(T=>{dv(d,T.queryKey)&&Object.assign(_,T.defaultOptions)}),_}setMutationDefaults(d,h){this.#n.set(hv(d),{mutationKey:d,defaultOptions:h})}getMutationDefaults(d){const h=[...this.#n.values()],_={};return h.forEach(T=>{dv(d,T.mutationKey)&&Object.assign(_,T.defaultOptions)}),_}defaultQueryOptions(d){if(d._defaulted)return d;const h={...this.#i.queries,...this.getQueryDefaults(d.queryKey),...d,_defaulted:!0};return h.queryHash||(h.queryHash=y1(h.queryKey,h)),h.refetchOnReconnect===void 0&&(h.refetchOnReconnect=h.networkMode!=="always"),h.throwOnError===void 0&&(h.throwOnError=!!h.suspense),!h.networkMode&&h.persister&&(h.networkMode="offlineFirst"),h.queryFn===v1&&(h.enabled=!1),h}defaultMutationOptions(d){return d?._defaulted?d:{...this.#i.mutations,...d?.mutationKey&&this.getMutationDefaults(d.mutationKey),...d,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},aw={exports:{}},kn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m2;function MP(){if(m2)return kn;m2=1;var d=Symbol.for("react.transitional.element"),h=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),B=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),q=Symbol.for("react.suspense"),H=Symbol.for("react.memo"),ie=Symbol.for("react.lazy"),Q=Symbol.for("react.activity"),me=Symbol.iterator;function we(Fe){return Fe===null||typeof Fe!="object"?null:(Fe=me&&Fe[me]||Fe["@@iterator"],typeof Fe=="function"?Fe:null)}var Ae={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},he=Object.assign,Re={};function Ne(Fe,wt,bt){this.props=Fe,this.context=wt,this.refs=Re,this.updater=bt||Ae}Ne.prototype.isReactComponent={},Ne.prototype.setState=function(Fe,wt){if(typeof Fe!="object"&&typeof Fe!="function"&&Fe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Fe,wt,"setState")},Ne.prototype.forceUpdate=function(Fe){this.updater.enqueueForceUpdate(this,Fe,"forceUpdate")};function Ge(){}Ge.prototype=Ne.prototype;function Ue(Fe,wt,bt){this.props=Fe,this.context=wt,this.refs=Re,this.updater=bt||Ae}var rt=Ue.prototype=new Ge;rt.constructor=Ue,he(rt,Ne.prototype),rt.isPureReactComponent=!0;var Pt=Array.isArray;function Bt(){}var Tt={H:null,A:null,T:null,S:null},Ht=Object.prototype.hasOwnProperty;function Ei(Fe,wt,bt){var Gt=bt.ref;return{$$typeof:d,type:Fe,key:wt,ref:Gt!==void 0?Gt:null,props:bt}}function rn(Fe,wt){return Ei(Fe.type,wt,Fe.props)}function en(Fe){return typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===d}function Ui(Fe){var wt={"=":"=0",":":"=2"};return"$"+Fe.replace(/[=:]/g,function(bt){return wt[bt]})}var si=/\/+/g;function Ji(Fe,wt){return typeof Fe=="object"&&Fe!==null&&Fe.key!=null?Ui(""+Fe.key):wt.toString(36)}function Si(Fe){switch(Fe.status){case"fulfilled":return Fe.value;case"rejected":throw Fe.reason;default:switch(typeof Fe.status=="string"?Fe.then(Bt,Bt):(Fe.status="pending",Fe.then(function(wt){Fe.status==="pending"&&(Fe.status="fulfilled",Fe.value=wt)},function(wt){Fe.status==="pending"&&(Fe.status="rejected",Fe.reason=wt)})),Fe.status){case"fulfilled":return Fe.value;case"rejected":throw Fe.reason}}throw Fe}function Xe(Fe,wt,bt,Gt,ci){var Bi=typeof Fe;(Bi==="undefined"||Bi==="boolean")&&(Fe=null);var Qt=!1;if(Fe===null)Qt=!0;else switch(Bi){case"bigint":case"string":case"number":Qt=!0;break;case"object":switch(Fe.$$typeof){case d:case h:Qt=!0;break;case ie:return Qt=Fe._init,Xe(Qt(Fe._payload),wt,bt,Gt,ci)}}if(Qt)return ci=ci(Fe),Qt=Gt===""?"."+Ji(Fe,0):Gt,Pt(ci)?(bt="",Qt!=null&&(bt=Qt.replace(si,"$&/")+"/"),Xe(ci,wt,bt,"",function(Ri){return Ri})):ci!=null&&(en(ci)&&(ci=rn(ci,bt+(ci.key==null||Fe&&Fe.key===ci.key?"":(""+ci.key).replace(si,"$&/")+"/")+Qt)),wt.push(ci)),1;Qt=0;var Ii=Gt===""?".":Gt+":";if(Pt(Fe))for(var fi=0;fi<Fe.length;fi++)Gt=Fe[fi],Bi=Ii+Ji(Gt,fi),Qt+=Xe(Gt,wt,bt,Bi,ci);else if(fi=we(Fe),typeof fi=="function")for(Fe=fi.call(Fe),fi=0;!(Gt=Fe.next()).done;)Gt=Gt.value,Bi=Ii+Ji(Gt,fi++),Qt+=Xe(Gt,wt,bt,Bi,ci);else if(Bi==="object"){if(typeof Fe.then=="function")return Xe(Si(Fe),wt,bt,Gt,ci);throw wt=String(Fe),Error("Objects are not valid as a React child (found: "+(wt==="[object Object]"?"object with keys {"+Object.keys(Fe).join(", ")+"}":wt)+"). If you meant to render a collection of children, use an array instead.")}return Qt}function gt(Fe,wt,bt){if(Fe==null)return Fe;var Gt=[],ci=0;return Xe(Fe,Gt,"","",function(Bi){return wt.call(bt,Bi,ci++)}),Gt}function yt(Fe){if(Fe._status===-1){var wt=Fe._result;wt=wt(),wt.then(function(bt){(Fe._status===0||Fe._status===-1)&&(Fe._status=1,Fe._result=bt)},function(bt){(Fe._status===0||Fe._status===-1)&&(Fe._status=2,Fe._result=bt)}),Fe._status===-1&&(Fe._status=0,Fe._result=wt)}if(Fe._status===1)return Fe._result.default;throw Fe._result}var mi=typeof reportError=="function"?reportError:function(Fe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var wt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Fe=="object"&&Fe!==null&&typeof Fe.message=="string"?String(Fe.message):String(Fe),error:Fe});if(!window.dispatchEvent(wt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Fe);return}console.error(Fe)},Ci={map:gt,forEach:function(Fe,wt,bt){gt(Fe,function(){wt.apply(this,arguments)},bt)},count:function(Fe){var wt=0;return gt(Fe,function(){wt++}),wt},toArray:function(Fe){return gt(Fe,function(wt){return wt})||[]},only:function(Fe){if(!en(Fe))throw Error("React.Children.only expected to receive a single React element child.");return Fe}};return kn.Activity=Q,kn.Children=Ci,kn.Component=Ne,kn.Fragment=_,kn.Profiler=R,kn.PureComponent=Ue,kn.StrictMode=T,kn.Suspense=q,kn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Tt,kn.__COMPILER_RUNTIME={__proto__:null,c:function(Fe){return Tt.H.useMemoCache(Fe)}},kn.cache=function(Fe){return function(){return Fe.apply(null,arguments)}},kn.cacheSignal=function(){return null},kn.cloneElement=function(Fe,wt,bt){if(Fe==null)throw Error("The argument must be a React element, but you passed "+Fe+".");var Gt=he({},Fe.props),ci=Fe.key;if(wt!=null)for(Bi in wt.key!==void 0&&(ci=""+wt.key),wt)!Ht.call(wt,Bi)||Bi==="key"||Bi==="__self"||Bi==="__source"||Bi==="ref"&&wt.ref===void 0||(Gt[Bi]=wt[Bi]);var Bi=arguments.length-2;if(Bi===1)Gt.children=bt;else if(1<Bi){for(var Qt=Array(Bi),Ii=0;Ii<Bi;Ii++)Qt[Ii]=arguments[Ii+2];Gt.children=Qt}return Ei(Fe.type,ci,Gt)},kn.createContext=function(Fe){return Fe={$$typeof:B,_currentValue:Fe,_currentValue2:Fe,_threadCount:0,Provider:null,Consumer:null},Fe.Provider=Fe,Fe.Consumer={$$typeof:D,_context:Fe},Fe},kn.createElement=function(Fe,wt,bt){var Gt,ci={},Bi=null;if(wt!=null)for(Gt in wt.key!==void 0&&(Bi=""+wt.key),wt)Ht.call(wt,Gt)&&Gt!=="key"&&Gt!=="__self"&&Gt!=="__source"&&(ci[Gt]=wt[Gt]);var Qt=arguments.length-2;if(Qt===1)ci.children=bt;else if(1<Qt){for(var Ii=Array(Qt),fi=0;fi<Qt;fi++)Ii[fi]=arguments[fi+2];ci.children=Ii}if(Fe&&Fe.defaultProps)for(Gt in Qt=Fe.defaultProps,Qt)ci[Gt]===void 0&&(ci[Gt]=Qt[Gt]);return Ei(Fe,Bi,ci)},kn.createRef=function(){return{current:null}},kn.forwardRef=function(Fe){return{$$typeof:r,render:Fe}},kn.isValidElement=en,kn.lazy=function(Fe){return{$$typeof:ie,_payload:{_status:-1,_result:Fe},_init:yt}},kn.memo=function(Fe,wt){return{$$typeof:H,type:Fe,compare:wt===void 0?null:wt}},kn.startTransition=function(Fe){var wt=Tt.T,bt={};Tt.T=bt;try{var Gt=Fe(),ci=Tt.S;ci!==null&&ci(bt,Gt),typeof Gt=="object"&&Gt!==null&&typeof Gt.then=="function"&&Gt.then(Bt,mi)}catch(Bi){mi(Bi)}finally{wt!==null&&bt.types!==null&&(wt.types=bt.types),Tt.T=wt}},kn.unstable_useCacheRefresh=function(){return Tt.H.useCacheRefresh()},kn.use=function(Fe){return Tt.H.use(Fe)},kn.useActionState=function(Fe,wt,bt){return Tt.H.useActionState(Fe,wt,bt)},kn.useCallback=function(Fe,wt){return Tt.H.useCallback(Fe,wt)},kn.useContext=function(Fe){return Tt.H.useContext(Fe)},kn.useDebugValue=function(){},kn.useDeferredValue=function(Fe,wt){return Tt.H.useDeferredValue(Fe,wt)},kn.useEffect=function(Fe,wt){return Tt.H.useEffect(Fe,wt)},kn.useEffectEvent=function(Fe){return Tt.H.useEffectEvent(Fe)},kn.useId=function(){return Tt.H.useId()},kn.useImperativeHandle=function(Fe,wt,bt){return Tt.H.useImperativeHandle(Fe,wt,bt)},kn.useInsertionEffect=function(Fe,wt){return Tt.H.useInsertionEffect(Fe,wt)},kn.useLayoutEffect=function(Fe,wt){return Tt.H.useLayoutEffect(Fe,wt)},kn.useMemo=function(Fe,wt){return Tt.H.useMemo(Fe,wt)},kn.useOptimistic=function(Fe,wt){return Tt.H.useOptimistic(Fe,wt)},kn.useReducer=function(Fe,wt,bt){return Tt.H.useReducer(Fe,wt,bt)},kn.useRef=function(Fe){return Tt.H.useRef(Fe)},kn.useState=function(Fe){return Tt.H.useState(Fe)},kn.useSyncExternalStore=function(Fe,wt,bt){return Tt.H.useSyncExternalStore(Fe,wt,bt)},kn.useTransition=function(){return Tt.H.useTransition()},kn.version="19.2.1",kn}var g2;function Ex(){return g2||(g2=1,aw.exports=MP()),aw.exports}var le=Ex();const pi=_1(le),x1=tP({__proto__:null,default:pi},[le]);var DP=le.createContext(void 0),OP=({client:d,children:h})=>(le.useEffect(()=>(d.mount(),()=>{d.unmount()}),[d]),ee.jsx(DP.Provider,{value:d,children:h})),lw={exports:{}},tv={},cw={exports:{}},uw={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _2;function PP(){return _2||(_2=1,(function(d){function h(Xe,gt){var yt=Xe.length;Xe.push(gt);e:for(;0<yt;){var mi=yt-1>>>1,Ci=Xe[mi];if(0<R(Ci,gt))Xe[mi]=gt,Xe[yt]=Ci,yt=mi;else break e}}function _(Xe){return Xe.length===0?null:Xe[0]}function T(Xe){if(Xe.length===0)return null;var gt=Xe[0],yt=Xe.pop();if(yt!==gt){Xe[0]=yt;e:for(var mi=0,Ci=Xe.length,Fe=Ci>>>1;mi<Fe;){var wt=2*(mi+1)-1,bt=Xe[wt],Gt=wt+1,ci=Xe[Gt];if(0>R(bt,yt))Gt<Ci&&0>R(ci,bt)?(Xe[mi]=ci,Xe[Gt]=yt,mi=Gt):(Xe[mi]=bt,Xe[wt]=yt,mi=wt);else if(Gt<Ci&&0>R(ci,yt))Xe[mi]=ci,Xe[Gt]=yt,mi=Gt;else break e}}return gt}function R(Xe,gt){var yt=Xe.sortIndex-gt.sortIndex;return yt!==0?yt:Xe.id-gt.id}if(d.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var D=performance;d.unstable_now=function(){return D.now()}}else{var B=Date,r=B.now();d.unstable_now=function(){return B.now()-r}}var q=[],H=[],ie=1,Q=null,me=3,we=!1,Ae=!1,he=!1,Re=!1,Ne=typeof setTimeout=="function"?setTimeout:null,Ge=typeof clearTimeout=="function"?clearTimeout:null,Ue=typeof setImmediate<"u"?setImmediate:null;function rt(Xe){for(var gt=_(H);gt!==null;){if(gt.callback===null)T(H);else if(gt.startTime<=Xe)T(H),gt.sortIndex=gt.expirationTime,h(q,gt);else break;gt=_(H)}}function Pt(Xe){if(he=!1,rt(Xe),!Ae)if(_(q)!==null)Ae=!0,Bt||(Bt=!0,Ui());else{var gt=_(H);gt!==null&&Si(Pt,gt.startTime-Xe)}}var Bt=!1,Tt=-1,Ht=5,Ei=-1;function rn(){return Re?!0:!(d.unstable_now()-Ei<Ht)}function en(){if(Re=!1,Bt){var Xe=d.unstable_now();Ei=Xe;var gt=!0;try{e:{Ae=!1,he&&(he=!1,Ge(Tt),Tt=-1),we=!0;var yt=me;try{t:{for(rt(Xe),Q=_(q);Q!==null&&!(Q.expirationTime>Xe&&rn());){var mi=Q.callback;if(typeof mi=="function"){Q.callback=null,me=Q.priorityLevel;var Ci=mi(Q.expirationTime<=Xe);if(Xe=d.unstable_now(),typeof Ci=="function"){Q.callback=Ci,rt(Xe),gt=!0;break t}Q===_(q)&&T(q),rt(Xe)}else T(q);Q=_(q)}if(Q!==null)gt=!0;else{var Fe=_(H);Fe!==null&&Si(Pt,Fe.startTime-Xe),gt=!1}}break e}finally{Q=null,me=yt,we=!1}gt=void 0}}finally{gt?Ui():Bt=!1}}}var Ui;if(typeof Ue=="function")Ui=function(){Ue(en)};else if(typeof MessageChannel<"u"){var si=new MessageChannel,Ji=si.port2;si.port1.onmessage=en,Ui=function(){Ji.postMessage(null)}}else Ui=function(){Ne(en,0)};function Si(Xe,gt){Tt=Ne(function(){Xe(d.unstable_now())},gt)}d.unstable_IdlePriority=5,d.unstable_ImmediatePriority=1,d.unstable_LowPriority=4,d.unstable_NormalPriority=3,d.unstable_Profiling=null,d.unstable_UserBlockingPriority=2,d.unstable_cancelCallback=function(Xe){Xe.callback=null},d.unstable_forceFrameRate=function(Xe){0>Xe||125<Xe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ht=0<Xe?Math.floor(1e3/Xe):5},d.unstable_getCurrentPriorityLevel=function(){return me},d.unstable_next=function(Xe){switch(me){case 1:case 2:case 3:var gt=3;break;default:gt=me}var yt=me;me=gt;try{return Xe()}finally{me=yt}},d.unstable_requestPaint=function(){Re=!0},d.unstable_runWithPriority=function(Xe,gt){switch(Xe){case 1:case 2:case 3:case 4:case 5:break;default:Xe=3}var yt=me;me=Xe;try{return gt()}finally{me=yt}},d.unstable_scheduleCallback=function(Xe,gt,yt){var mi=d.unstable_now();switch(typeof yt=="object"&&yt!==null?(yt=yt.delay,yt=typeof yt=="number"&&0<yt?mi+yt:mi):yt=mi,Xe){case 1:var Ci=-1;break;case 2:Ci=250;break;case 5:Ci=1073741823;break;case 4:Ci=1e4;break;default:Ci=5e3}return Ci=yt+Ci,Xe={id:ie++,callback:gt,priorityLevel:Xe,startTime:yt,expirationTime:Ci,sortIndex:-1},yt>mi?(Xe.sortIndex=yt,h(H,Xe),_(q)===null&&Xe===_(H)&&(he?(Ge(Tt),Tt=-1):he=!0,Si(Pt,yt-mi))):(Xe.sortIndex=Ci,h(q,Xe),Ae||we||(Ae=!0,Bt||(Bt=!0,Ui()))),Xe},d.unstable_shouldYield=rn,d.unstable_wrapCallback=function(Xe){var gt=me;return function(){var yt=me;me=gt;try{return Xe.apply(this,arguments)}finally{me=yt}}}})(uw)),uw}var y2;function zP(){return y2||(y2=1,cw.exports=PP()),cw.exports}var hw={exports:{}},Ga={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v2;function LP(){if(v2)return Ga;v2=1;var d=Ex();function h(q){var H="https://react.dev/errors/"+q;if(1<arguments.length){H+="?args[]="+encodeURIComponent(arguments[1]);for(var ie=2;ie<arguments.length;ie++)H+="&args[]="+encodeURIComponent(arguments[ie])}return"Minified React error #"+q+"; visit "+H+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function _(){}var T={d:{f:_,r:function(){throw Error(h(522))},D:_,C:_,L:_,m:_,X:_,S:_,M:_},p:0,findDOMNode:null},R=Symbol.for("react.portal");function D(q,H,ie){var Q=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:R,key:Q==null?null:""+Q,children:q,containerInfo:H,implementation:ie}}var B=d.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function r(q,H){if(q==="font")return"";if(typeof H=="string")return H==="use-credentials"?H:""}return Ga.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=T,Ga.createPortal=function(q,H){var ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!H||H.nodeType!==1&&H.nodeType!==9&&H.nodeType!==11)throw Error(h(299));return D(q,H,null,ie)},Ga.flushSync=function(q){var H=B.T,ie=T.p;try{if(B.T=null,T.p=2,q)return q()}finally{B.T=H,T.p=ie,T.d.f()}},Ga.preconnect=function(q,H){typeof q=="string"&&(H?(H=H.crossOrigin,H=typeof H=="string"?H==="use-credentials"?H:"":void 0):H=null,T.d.C(q,H))},Ga.prefetchDNS=function(q){typeof q=="string"&&T.d.D(q)},Ga.preinit=function(q,H){if(typeof q=="string"&&H&&typeof H.as=="string"){var ie=H.as,Q=r(ie,H.crossOrigin),me=typeof H.integrity=="string"?H.integrity:void 0,we=typeof H.fetchPriority=="string"?H.fetchPriority:void 0;ie==="style"?T.d.S(q,typeof H.precedence=="string"?H.precedence:void 0,{crossOrigin:Q,integrity:me,fetchPriority:we}):ie==="script"&&T.d.X(q,{crossOrigin:Q,integrity:me,fetchPriority:we,nonce:typeof H.nonce=="string"?H.nonce:void 0})}},Ga.preinitModule=function(q,H){if(typeof q=="string")if(typeof H=="object"&&H!==null){if(H.as==null||H.as==="script"){var ie=r(H.as,H.crossOrigin);T.d.M(q,{crossOrigin:ie,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0})}}else H==null&&T.d.M(q)},Ga.preload=function(q,H){if(typeof q=="string"&&typeof H=="object"&&H!==null&&typeof H.as=="string"){var ie=H.as,Q=r(ie,H.crossOrigin);T.d.L(q,ie,{crossOrigin:Q,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0,type:typeof H.type=="string"?H.type:void 0,fetchPriority:typeof H.fetchPriority=="string"?H.fetchPriority:void 0,referrerPolicy:typeof H.referrerPolicy=="string"?H.referrerPolicy:void 0,imageSrcSet:typeof H.imageSrcSet=="string"?H.imageSrcSet:void 0,imageSizes:typeof H.imageSizes=="string"?H.imageSizes:void 0,media:typeof H.media=="string"?H.media:void 0})}},Ga.preloadModule=function(q,H){if(typeof q=="string")if(H){var ie=r(H.as,H.crossOrigin);T.d.m(q,{as:typeof H.as=="string"&&H.as!=="script"?H.as:void 0,crossOrigin:ie,integrity:typeof H.integrity=="string"?H.integrity:void 0})}else T.d.m(q)},Ga.requestFormReset=function(q){T.d.r(q)},Ga.unstable_batchedUpdates=function(q,H){return q(H)},Ga.useFormState=function(q,H,ie){return B.H.useFormState(q,H,ie)},Ga.useFormStatus=function(){return B.H.useHostTransitionStatus()},Ga.version="19.2.1",Ga}var x2;function XA(){if(x2)return hw.exports;x2=1;function d(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(d)}catch(h){console.error(h)}}return d(),hw.exports=LP(),hw.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b2;function kP(){if(b2)return tv;b2=1;var d=zP(),h=Ex(),_=XA();function T(l){var p="https://react.dev/errors/"+l;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var x=2;x<arguments.length;x++)p+="&args[]="+encodeURIComponent(arguments[x])}return"Minified React error #"+l+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function R(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function D(l){var p=l,x=l;if(l.alternate)for(;p.return;)p=p.return;else{l=p;do p=l,(p.flags&4098)!==0&&(x=p.return),l=p.return;while(l)}return p.tag===3?x:null}function B(l){if(l.tag===13){var p=l.memoizedState;if(p===null&&(l=l.alternate,l!==null&&(p=l.memoizedState)),p!==null)return p.dehydrated}return null}function r(l){if(l.tag===31){var p=l.memoizedState;if(p===null&&(l=l.alternate,l!==null&&(p=l.memoizedState)),p!==null)return p.dehydrated}return null}function q(l){if(D(l)!==l)throw Error(T(188))}function H(l){var p=l.alternate;if(!p){if(p=D(l),p===null)throw Error(T(188));return p!==l?null:l}for(var x=l,A=p;;){var k=x.return;if(k===null)break;var j=k.alternate;if(j===null){if(A=k.return,A!==null){x=A;continue}break}if(k.child===j.child){for(j=k.child;j;){if(j===x)return q(k),l;if(j===A)return q(k),p;j=j.sibling}throw Error(T(188))}if(x.return!==A.return)x=k,A=j;else{for(var oe=!1,Ie=k.child;Ie;){if(Ie===x){oe=!0,x=k,A=j;break}if(Ie===A){oe=!0,A=k,x=j;break}Ie=Ie.sibling}if(!oe){for(Ie=j.child;Ie;){if(Ie===x){oe=!0,x=j,A=k;break}if(Ie===A){oe=!0,A=j,x=k;break}Ie=Ie.sibling}if(!oe)throw Error(T(189))}}if(x.alternate!==A)throw Error(T(190))}if(x.tag!==3)throw Error(T(188));return x.stateNode.current===x?l:p}function ie(l){var p=l.tag;if(p===5||p===26||p===27||p===6)return l;for(l=l.child;l!==null;){if(p=ie(l),p!==null)return p;l=l.sibling}return null}var Q=Object.assign,me=Symbol.for("react.element"),we=Symbol.for("react.transitional.element"),Ae=Symbol.for("react.portal"),he=Symbol.for("react.fragment"),Re=Symbol.for("react.strict_mode"),Ne=Symbol.for("react.profiler"),Ge=Symbol.for("react.consumer"),Ue=Symbol.for("react.context"),rt=Symbol.for("react.forward_ref"),Pt=Symbol.for("react.suspense"),Bt=Symbol.for("react.suspense_list"),Tt=Symbol.for("react.memo"),Ht=Symbol.for("react.lazy"),Ei=Symbol.for("react.activity"),rn=Symbol.for("react.memo_cache_sentinel"),en=Symbol.iterator;function Ui(l){return l===null||typeof l!="object"?null:(l=en&&l[en]||l["@@iterator"],typeof l=="function"?l:null)}var si=Symbol.for("react.client.reference");function Ji(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===si?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case he:return"Fragment";case Ne:return"Profiler";case Re:return"StrictMode";case Pt:return"Suspense";case Bt:return"SuspenseList";case Ei:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case Ae:return"Portal";case Ue:return l.displayName||"Context";case Ge:return(l._context.displayName||"Context")+".Consumer";case rt:var p=l.render;return l=l.displayName,l||(l=p.displayName||p.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case Tt:return p=l.displayName||null,p!==null?p:Ji(l.type)||"Memo";case Ht:p=l._payload,l=l._init;try{return Ji(l(p))}catch{}}return null}var Si=Array.isArray,Xe=h.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,gt=_.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,yt={pending:!1,data:null,method:null,action:null},mi=[],Ci=-1;function Fe(l){return{current:l}}function wt(l){0>Ci||(l.current=mi[Ci],mi[Ci]=null,Ci--)}function bt(l,p){Ci++,mi[Ci]=l.current,l.current=p}var Gt=Fe(null),ci=Fe(null),Bi=Fe(null),Qt=Fe(null);function Ii(l,p){switch(bt(Bi,p),bt(ci,l),bt(Gt,null),p.nodeType){case 9:case 11:l=(l=p.documentElement)&&(l=l.namespaceURI)?sy(l):0;break;default:if(l=p.tagName,p=p.namespaceURI)p=sy(p),l=qg(p,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}wt(Gt),bt(Gt,l)}function fi(){wt(Gt),wt(ci),wt(Bi)}function Ri(l){l.memoizedState!==null&&bt(Qt,l);var p=Gt.current,x=qg(p,l.type);p!==x&&(bt(ci,l),bt(Gt,x))}function Fi(l){ci.current===l&&(wt(Gt),wt(ci)),Qt.current===l&&(wt(Qt),Ul._currentValue=yt)}var Oi,vn;function Mr(l){if(Oi===void 0)try{throw Error()}catch(x){var p=x.stack.trim().match(/\n( *(at )?)/);Oi=p&&p[1]||"",vn=-1<x.stack.indexOf(`
    at`)?" (<anonymous>)":-1<x.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Oi+l+vn}var Vs=!1;function Gs(l,p){if(!l||Vs)return"";Vs=!0;var x=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var A={DetermineComponentFrameRoot:function(){try{if(p){var ti=function(){throw Error()};if(Object.defineProperty(ti.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ti,[])}catch(Vt){var Lt=Vt}Reflect.construct(l,[],ti)}else{try{ti.call()}catch(Vt){Lt=Vt}l.call(ti.prototype)}}else{try{throw Error()}catch(Vt){Lt=Vt}(ti=l())&&typeof ti.catch=="function"&&ti.catch(function(){})}}catch(Vt){if(Vt&&Lt&&typeof Vt.stack=="string")return[Vt.stack,Lt.stack]}return[null,null]}};A.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var k=Object.getOwnPropertyDescriptor(A.DetermineComponentFrameRoot,"name");k&&k.configurable&&Object.defineProperty(A.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var j=A.DetermineComponentFrameRoot(),oe=j[0],Ie=j[1];if(oe&&Ie){var et=oe.split(`
`),Ot=Ie.split(`
`);for(k=A=0;A<et.length&&!et[A].includes("DetermineComponentFrameRoot");)A++;for(;k<Ot.length&&!Ot[k].includes("DetermineComponentFrameRoot");)k++;if(A===et.length||k===Ot.length)for(A=et.length-1,k=Ot.length-1;1<=A&&0<=k&&et[A]!==Ot[k];)k--;for(;1<=A&&0<=k;A--,k--)if(et[A]!==Ot[k]){if(A!==1||k!==1)do if(A--,k--,0>k||et[A]!==Ot[k]){var Xt=`
`+et[A].replace(" at new "," at ");return l.displayName&&Xt.includes("<anonymous>")&&(Xt=Xt.replace("<anonymous>",l.displayName)),Xt}while(1<=A&&0<=k);break}}}finally{Vs=!1,Error.prepareStackTrace=x}return(x=l?l.displayName||l.name:"")?Mr(x):""}function Jr(l,p){switch(l.tag){case 26:case 27:case 5:return Mr(l.type);case 16:return Mr("Lazy");case 13:return l.child!==p&&p!==null?Mr("Suspense Fallback"):Mr("Suspense");case 19:return Mr("SuspenseList");case 0:case 15:return Gs(l.type,!1);case 11:return Gs(l.type.render,!1);case 1:return Gs(l.type,!0);case 31:return Mr("Activity");default:return""}}function Cn(l){try{var p="",x=null;do p+=Jr(l,x),x=l,l=l.return;while(l);return p}catch(A){return`
Error generating stack: `+A.message+`
`+A.stack}}var ws=Object.prototype.hasOwnProperty,Ts=d.unstable_scheduleCallback,Aa=d.unstable_cancelCallback,_r=d.unstable_shouldYield,go=d.unstable_requestPaint,tr=d.unstable_now,Ss=d.unstable_getCurrentPriorityLevel,Ur=d.unstable_ImmediatePriority,Xo=d.unstable_UserBlockingPriority,io=d.unstable_NormalPriority,Co=d.unstable_LowPriority,Vr=d.unstable_IdlePriority,Ps=d.log,Wr=d.unstable_setDisableYieldValue,Yo=null,$r=null;function yr(l){if(typeof Ps=="function"&&Wr(l),$r&&typeof $r.setStrictMode=="function")try{$r.setStrictMode(Yo,l)}catch{}}var Gr=Math.clz32?Math.clz32:Es,ha=Math.log,Ko=Math.LN2;function Es(l){return l>>>=0,l===0?32:31-(ha(l)/Ko|0)|0}var Io=256,Ro=262144,Jo=4194304;function ot(l){var p=l&42;if(p!==0)return p;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return l&261888;case 262144:case 524288:case 1048576:case 2097152:return l&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function It(l,p,x){var A=l.pendingLanes;if(A===0)return 0;var k=0,j=l.suspendedLanes,oe=l.pingedLanes;l=l.warmLanes;var Ie=A&134217727;return Ie!==0?(A=Ie&~j,A!==0?k=ot(A):(oe&=Ie,oe!==0?k=ot(oe):x||(x=Ie&~l,x!==0&&(k=ot(x))))):(Ie=A&~j,Ie!==0?k=ot(Ie):oe!==0?k=ot(oe):x||(x=A&~l,x!==0&&(k=ot(x)))),k===0?0:p!==0&&p!==k&&(p&j)===0&&(j=k&-k,x=p&-p,j>=x||j===32&&(x&4194048)!==0)?p:k}function ui(l,p){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&p)===0}function Mn(l,p){switch(l){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function In(){var l=Jo;return Jo<<=1,(Jo&62914560)===0&&(Jo=4194304),l}function Xr(l){for(var p=[],x=0;31>x;x++)p.push(l);return p}function Gn(l,p){l.pendingLanes|=p,p!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function pt(l,p,x,A,k,j){var oe=l.pendingLanes;l.pendingLanes=x,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=x,l.entangledLanes&=x,l.errorRecoveryDisabledLanes&=x,l.shellSuspendCounter=0;var Ie=l.entanglements,et=l.expirationTimes,Ot=l.hiddenUpdates;for(x=oe&~x;0<x;){var Xt=31-Gr(x),ti=1<<Xt;Ie[Xt]=0,et[Xt]=-1;var Lt=Ot[Xt];if(Lt!==null)for(Ot[Xt]=null,Xt=0;Xt<Lt.length;Xt++){var Vt=Lt[Xt];Vt!==null&&(Vt.lane&=-536870913)}x&=~ti}A!==0&&Yn(l,A,0),j!==0&&k===0&&l.tag!==0&&(l.suspendedLanes|=j&~(oe&~p))}function Yn(l,p,x){l.pendingLanes|=p,l.suspendedLanes&=~p;var A=31-Gr(p);l.entangledLanes|=p,l.entanglements[A]=l.entanglements[A]|1073741824|x&261930}function or(l,p){var x=l.entangledLanes|=p;for(l=l.entanglements;x;){var A=31-Gr(x),k=1<<A;k&p|l[A]&p&&(l[A]|=p),x&=~k}}function vr(l,p){var x=p&-p;return x=(x&42)!==0?1:Ni(x),(x&(l.suspendedLanes|p))!==0?0:x}function Ni(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function Le(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function J(){var l=gt.p;return l!==0?l:(l=window.event,l===void 0?32:Xv(l.type))}function re(l,p){var x=gt.p;try{return gt.p=l,p()}finally{gt.p=x}}var ge=Math.random().toString(36).slice(2),Me="__reactFiber$"+ge,_e="__reactProps$"+ge,ke="__reactContainer$"+ge,We="__reactEvents$"+ge,je="__reactListeners$"+ge,Ke="__reactHandles$"+ge,At="__reactResources$"+ge,vt="__reactMarker$"+ge;function Zt(l){delete l[Me],delete l[_e],delete l[We],delete l[je],delete l[Ke]}function oi(l){var p=l[Me];if(p)return p;for(var x=l.parentNode;x;){if(p=x[ke]||x[Me]){if(x=p.alternate,p.child!==null||x!==null&&x.child!==null)for(l=cy(l);l!==null;){if(x=l[Me])return x;l=cy(l)}return p}l=x,x=l.parentNode}return null}function hi(l){if(l=l[Me]||l[ke]){var p=l.tag;if(p===5||p===6||p===13||p===31||p===26||p===27||p===3)return l}return null}function Mi(l){var p=l.tag;if(p===5||p===26||p===27||p===6)return l.stateNode;throw Error(T(33))}function ji(l){var p=l[At];return p||(p=l[At]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function li(l){l[vt]=!0}var bi=new Set,jn={};function xr(l,p){Qn(l,p),Qn(l+"Capture",p)}function Qn(l,p){for(jn[l]=p,l=0;l<p.length;l++)bi.add(p[l])}var Cr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Kn={},sn={};function ir(l){return ws.call(sn,l)?!0:ws.call(Kn,l)?!1:Cr.test(l)?sn[l]=!0:(Kn[l]=!0,!1)}function Dn(l,p,x){if(ir(p))if(x===null)l.removeAttribute(p);else{switch(typeof x){case"undefined":case"function":case"symbol":l.removeAttribute(p);return;case"boolean":var A=p.toLowerCase().slice(0,5);if(A!=="data-"&&A!=="aria-"){l.removeAttribute(p);return}}l.setAttribute(p,""+x)}}function On(l,p,x){if(x===null)l.removeAttribute(p);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(p);return}l.setAttribute(p,""+x)}}function Un(l,p,x,A){if(A===null)l.removeAttribute(x);else{switch(typeof A){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(x);return}l.setAttributeNS(p,x,""+A)}}function br(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function hs(l){var p=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function Qr(l,p,x){var A=Object.getOwnPropertyDescriptor(l.constructor.prototype,p);if(!l.hasOwnProperty(p)&&typeof A<"u"&&typeof A.get=="function"&&typeof A.set=="function"){var k=A.get,j=A.set;return Object.defineProperty(l,p,{configurable:!0,get:function(){return k.call(this)},set:function(oe){x=""+oe,j.call(this,oe)}}),Object.defineProperty(l,p,{enumerable:A.enumerable}),{getValue:function(){return x},setValue:function(oe){x=""+oe},stopTracking:function(){l._valueTracker=null,delete l[p]}}}}function yl(l){if(!l._valueTracker){var p=hs(l)?"checked":"value";l._valueTracker=Qr(l,p,""+l[p])}}function qs(l){if(!l)return!1;var p=l._valueTracker;if(!p)return!0;var x=p.getValue(),A="";return l&&(A=hs(l)?l.checked?"true":"false":l.value),l=A,l!==x?(p.setValue(l),!0):!1}function no(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var Ca=/[\n"\\]/g;function rs(l){return l.replace(Ca,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function _o(l,p,x,A,k,j,oe,Ie){l.name="",oe!=null&&typeof oe!="function"&&typeof oe!="symbol"&&typeof oe!="boolean"?l.type=oe:l.removeAttribute("type"),p!=null?oe==="number"?(p===0&&l.value===""||l.value!=p)&&(l.value=""+br(p)):l.value!==""+br(p)&&(l.value=""+br(p)):oe!=="submit"&&oe!=="reset"||l.removeAttribute("value"),p!=null?qa(l,oe,br(p)):x!=null?qa(l,oe,br(x)):A!=null&&l.removeAttribute("value"),k==null&&j!=null&&(l.defaultChecked=!!j),k!=null&&(l.checked=k&&typeof k!="function"&&typeof k!="symbol"),Ie!=null&&typeof Ie!="function"&&typeof Ie!="symbol"&&typeof Ie!="boolean"?l.name=""+br(Ie):l.removeAttribute("name")}function ro(l,p,x,A,k,j,oe,Ie){if(j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"&&(l.type=j),p!=null||x!=null){if(!(j!=="submit"&&j!=="reset"||p!=null)){yl(l);return}x=x!=null?""+br(x):"",p=p!=null?""+br(p):x,Ie||p===l.value||(l.value=p),l.defaultValue=p}A=A??k,A=typeof A!="function"&&typeof A!="symbol"&&!!A,l.checked=Ie?l.checked:!!A,l.defaultChecked=!!A,oe!=null&&typeof oe!="function"&&typeof oe!="symbol"&&typeof oe!="boolean"&&(l.name=oe),yl(l)}function qa(l,p,x){p==="number"&&no(l.ownerDocument)===l||l.defaultValue===""+x||(l.defaultValue=""+x)}function Ia(l,p,x,A){if(l=l.options,p){p={};for(var k=0;k<x.length;k++)p["$"+x[k]]=!0;for(x=0;x<l.length;x++)k=p.hasOwnProperty("$"+l[x].value),l[x].selected!==k&&(l[x].selected=k),k&&A&&(l[x].defaultSelected=!0)}else{for(x=""+br(x),p=null,k=0;k<l.length;k++){if(l[k].value===x){l[k].selected=!0,A&&(l[k].defaultSelected=!0);return}p!==null||l[k].disabled||(p=l[k])}p!==null&&(p.selected=!0)}}function Qo(l,p,x){if(p!=null&&(p=""+br(p),p!==l.value&&(l.value=p),x==null)){l.defaultValue!==p&&(l.defaultValue=p);return}l.defaultValue=x!=null?""+br(x):""}function rh(l,p,x,A){if(p==null){if(A!=null){if(x!=null)throw Error(T(92));if(Si(A)){if(1<A.length)throw Error(T(93));A=A[0]}x=A}x==null&&(x=""),p=x}x=br(p),l.defaultValue=x,A=l.textContent,A===x&&A!==""&&A!==null&&(l.value=A),yl(l)}function vl(l,p){if(p){var x=l.firstChild;if(x&&x===l.lastChild&&x.nodeType===3){x.nodeValue=p;return}}l.textContent=p}var yg=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Vp(l,p,x){var A=p.indexOf("--")===0;x==null||typeof x=="boolean"||x===""?A?l.setProperty(p,""):p==="float"?l.cssFloat="":l[p]="":A?l.setProperty(p,x):typeof x!="number"||x===0||yg.has(p)?p==="float"?l.cssFloat=x:l[p]=(""+x).trim():l[p]=x+"px"}function xf(l,p,x){if(p!=null&&typeof p!="object")throw Error(T(62));if(l=l.style,x!=null){for(var A in x)!x.hasOwnProperty(A)||p!=null&&p.hasOwnProperty(A)||(A.indexOf("--")===0?l.setProperty(A,""):A==="float"?l.cssFloat="":l[A]="");for(var k in p)A=p[k],p.hasOwnProperty(k)&&x[k]!==A&&Vp(l,k,A)}else for(var j in p)p.hasOwnProperty(j)&&Vp(l,j,p[j])}function dd(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var As=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),da=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ra(l){return da.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}function ds(){}var Ma=null;function Ac(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var Ha=null,Da=null;function Gl(l){var p=hi(l);if(p&&(l=p.stateNode)){var x=l[_e]||null;e:switch(l=p.stateNode,p.type){case"input":if(_o(l,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name),p=x.name,x.type==="radio"&&p!=null){for(x=l;x.parentNode;)x=x.parentNode;for(x=x.querySelectorAll('input[name="'+rs(""+p)+'"][type="radio"]'),p=0;p<x.length;p++){var A=x[p];if(A!==l&&A.form===l.form){var k=A[_e]||null;if(!k)throw Error(T(90));_o(A,k.value,k.defaultValue,k.defaultValue,k.checked,k.defaultChecked,k.type,k.name)}}for(p=0;p<x.length;p++)A=x[p],A.form===l.form&&qs(A)}break e;case"textarea":Qo(l,x.value,x.defaultValue);break e;case"select":p=x.value,p!=null&&Ia(l,!!x.multiple,p,!1)}}}var sh=!1;function Gp(l,p,x){if(sh)return l(p,x);sh=!0;try{var A=l(p);return A}finally{if(sh=!1,(Ha!==null||Da!==null)&&(Fn(),Ha&&(p=Ha,l=Da,Da=Ha=null,Gl(p),l)))for(p=0;p<l.length;p++)Gl(l[p])}}function oh(l,p){var x=l.stateNode;if(x===null)return null;var A=x[_e]||null;if(A===null)return null;x=A[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(l=l.type,A=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!A;break e;default:l=!1}if(l)return null;if(x&&typeof x!="function")throw Error(T(231,p,typeof x));return x}var es=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),su=!1;if(es)try{var ql={};Object.defineProperty(ql,"passive",{get:function(){su=!0}}),window.addEventListener("test",ql,ql),window.removeEventListener("test",ql,ql)}catch{su=!1}var yo=null,ou=null,bf=null;function wf(){if(bf)return bf;var l,p=ou,x=p.length,A,k="value"in yo?yo.value:yo.textContent,j=k.length;for(l=0;l<x&&p[l]===k[l];l++);var oe=x-l;for(A=1;A<=oe&&p[x-A]===k[j-A];A++);return bf=k.slice(l,1<A?1-A:void 0)}function on(l){var p=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&p===13&&(l=13)):l=p,l===10&&(l=13),32<=l||l===13?l:0}function Hl(){return!0}function fd(){return!1}function Mo(l){function p(x,A,k,j,oe){this._reactName=x,this._targetInst=k,this.type=A,this.nativeEvent=j,this.target=oe,this.currentTarget=null;for(var Ie in l)l.hasOwnProperty(Ie)&&(x=l[Ie],this[Ie]=x?x(j):j[Ie]);return this.isDefaultPrevented=(j.defaultPrevented!=null?j.defaultPrevented:j.returnValue===!1)?Hl:fd,this.isPropagationStopped=fd,this}return Q(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var x=this.nativeEvent;x&&(x.preventDefault?x.preventDefault():typeof x.returnValue!="unknown"&&(x.returnValue=!1),this.isDefaultPrevented=Hl)},stopPropagation:function(){var x=this.nativeEvent;x&&(x.stopPropagation?x.stopPropagation():typeof x.cancelBubble!="unknown"&&(x.cancelBubble=!0),this.isPropagationStopped=Hl)},persist:function(){},isPersistent:Hl}),p}var Cc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ic=Mo(Cc),Oa=Q({},Cc,{view:0,detail:0}),pd=Mo(Oa),ah,qp,xl,Pa=Q({},Oa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hs,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==xl&&(xl&&l.type==="mousemove"?(ah=l.screenX-xl.screenX,qp=l.screenY-xl.screenY):qp=ah=0,xl=l),ah)},movementY:function(l){return"movementY"in l?l.movementY:qp}}),lh=Mo(Pa),vg=Q({},Pa,{dataTransfer:0}),au=Mo(vg),$l=Q({},Oa,{relatedTarget:0}),so=Mo($l),za=Q({},Cc,{animationName:0,elapsedTime:0,pseudoElement:0}),Tf=Mo(za),xg=Q({},Cc,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),xn=Mo(xg),Hp=Q({},Cc,{data:0}),$p=Mo(Hp),bg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lu(l){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(l):(l=Zp[l])?!!p[l]:!1}function Hs(){return lu}var Sf=Q({},Oa,{key:function(l){if(l.key){var p=bg[l.key]||l.key;if(p!=="Unidentified")return p}return l.type==="keypress"?(l=on(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?vi[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hs,charCode:function(l){return l.type==="keypress"?on(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?on(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),Do=Mo(Sf),ri=Q({},Pa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_n=Mo(ri),fn=Q({},Oa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hs}),vo=Mo(fn),ch=Q({},Cc,{propertyName:0,elapsedTime:0,pseudoElement:0}),An=Mo(ch),Ef=Q({},Pa,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),uh=Mo(Ef),cu=Q({},Cc,{newState:0,oldState:0}),oo=Mo(cu),Or=[9,13,27,32],Wp=es&&"CompositionEvent"in window,Zl=null;es&&"documentMode"in document&&(Zl=document.documentMode);var Xp=es&&"TextEvent"in window&&!Zl,hh=es&&(!Wp||Zl&&8<Zl&&11>=Zl),md=" ",Af=!1;function gd(l,p){switch(l){case"keyup":return Or.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $s(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Cs=!1;function Oo(l,p){switch(l){case"compositionend":return $s(p);case"keypress":return p.which!==32?null:(Af=!0,md);case"textInput":return l=p.data,l===md&&Af?null:l;default:return null}}function Yp(l,p){if(Cs)return l==="compositionend"||!Wp&&gd(l,p)?(l=wf(),bf=ou=yo=null,Cs=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return hh&&p.locale!=="ko"?null:p.data;default:return null}}var Rc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ts(l){var p=l&&l.nodeName&&l.nodeName.toLowerCase();return p==="input"?!!Rc[l.type]:p==="textarea"}function $a(l,p,x,A){Ha?Da?Da.push(A):Da=[A]:Ha=A,p=Pm(p,"onChange"),0<p.length&&(x=new Ic("onChange","change",null,x,A),l.push({event:x,listeners:p}))}var fa=null,Pr=null;function Mc(l){Mm(l,0)}function wi(l){var p=Mi(l);if(qs(p))return l}function ii(l,p){if(l==="change")return p}var uu=!1;if(es){var xi;if(es){var dh="oninput"in document;if(!dh){var fh=document.createElement("div");fh.setAttribute("oninput","return;"),dh=typeof fh.oninput=="function"}xi=dh}else xi=!1;uu=xi&&(!document.documentMode||9<document.documentMode)}function gi(){fa&&(fa.detachEvent("onpropertychange",Cf),Pr=fa=null)}function Cf(l){if(l.propertyName==="value"&&wi(Pr)){var p=[];$a(p,Pr,l,Ac(l)),Gp(Mc,p)}}function Kp(l,p,x){l==="focusin"?(gi(),fa=p,Pr=x,fa.attachEvent("onpropertychange",Cf)):l==="focusout"&&gi()}function bl(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return wi(Pr)}function wg(l,p){if(l==="click")return wi(p)}function ph(l,p){if(l==="input"||l==="change")return wi(p)}function Po(l,p){return l===p&&(l!==0||1/l===1/p)||l!==l&&p!==p}var zo=typeof Object.is=="function"?Object.is:Po;function ea(l,p){if(zo(l,p))return!0;if(typeof l!="object"||l===null||typeof p!="object"||p===null)return!1;var x=Object.keys(l),A=Object.keys(p);if(x.length!==A.length)return!1;for(A=0;A<x.length;A++){var k=x[A];if(!ws.call(p,k)||!zo(l[k],p[k]))return!1}return!0}function _d(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function pa(l,p){var x=_d(l);l=0;for(var A;x;){if(x.nodeType===3){if(A=l+x.textContent.length,l<=p&&A>=p)return{node:x,offset:p-l};l=A}e:{for(;x;){if(x.nextSibling){x=x.nextSibling;break e}x=x.parentNode}x=void 0}x=_d(x)}}function Wl(l,p){return l&&p?l===p?!0:l&&l.nodeType===3?!1:p&&p.nodeType===3?Wl(l,p.parentNode):"contains"in l?l.contains(p):l.compareDocumentPosition?!!(l.compareDocumentPosition(p)&16):!1:!1}function Tg(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var p=no(l.document);p instanceof l.HTMLIFrameElement;){try{var x=typeof p.contentWindow.location.href=="string"}catch{x=!1}if(x)l=p.contentWindow;else break;p=no(l.document)}return p}function hu(l){var p=l&&l.nodeName&&l.nodeName.toLowerCase();return p&&(p==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||p==="textarea"||l.contentEditable==="true")}var yd=es&&"documentMode"in document&&11>=document.documentMode,Xl=null,If=null,xo=null,Rf=!1;function vd(l,p,x){var A=x.window===x?x.document:x.nodeType===9?x:x.ownerDocument;Rf||Xl==null||Xl!==no(A)||(A=Xl,"selectionStart"in A&&hu(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),xo&&ea(xo,A)||(xo=A,A=Pm(If,"onSelect"),0<A.length&&(p=new Ic("onSelect","select",null,p,x),l.push({event:p,listeners:A}),p.target=Xl)))}function Za(l,p){var x={};return x[l.toLowerCase()]=p.toLowerCase(),x["Webkit"+l]="webkit"+p,x["Moz"+l]="moz"+p,x}var ma={animationend:Za("Animation","AnimationEnd"),animationiteration:Za("Animation","AnimationIteration"),animationstart:Za("Animation","AnimationStart"),transitionrun:Za("Transition","TransitionRun"),transitionstart:Za("Transition","TransitionStart"),transitioncancel:Za("Transition","TransitionCancel"),transitionend:Za("Transition","TransitionEnd")},Jp={},Qp={};es&&(Qp=document.createElement("div").style,"AnimationEvent"in window||(delete ma.animationend.animation,delete ma.animationiteration.animation,delete ma.animationstart.animation),"TransitionEvent"in window||delete ma.transitionend.transition);function du(l){if(Jp[l])return Jp[l];if(!ma[l])return l;var p=ma[l],x;for(x in p)if(p.hasOwnProperty(x)&&x in Qp)return Jp[l]=p[x];return l}var Mf=du("animationend"),Sg=du("animationiteration"),wl=du("animationstart"),Eg=du("transitionrun"),Ag=du("transitionstart"),Df=du("transitioncancel"),Of=du("transitionend"),Yl=new Map,bo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");bo.push("scrollEnd");function ga(l,p){Yl.set(l,p),xr(p,[l])}var mh=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)},ao=[],Wa=0,xd=0;function fu(){for(var l=Wa,p=xd=Wa=0;p<l;){var x=ao[p];ao[p++]=null;var A=ao[p];ao[p++]=null;var k=ao[p];ao[p++]=null;var j=ao[p];if(ao[p++]=null,A!==null&&k!==null){var oe=A.pending;oe===null?k.next=k:(k.next=oe.next,oe.next=k),A.pending=k}j!==0&&Pf(x,k,j)}}function wo(l,p,x,A){ao[Wa++]=l,ao[Wa++]=p,ao[Wa++]=x,ao[Wa++]=A,xd|=A,l.lanes|=A,l=l.alternate,l!==null&&(l.lanes|=A)}function pu(l,p,x,A){return wo(l,p,x,A),gh(l)}function zt(l,p){return wo(l,null,null,p),gh(l)}function Pf(l,p,x){l.lanes|=x;var A=l.alternate;A!==null&&(A.lanes|=x);for(var k=!1,j=l.return;j!==null;)j.childLanes|=x,A=j.alternate,A!==null&&(A.childLanes|=x),j.tag===22&&(l=j.stateNode,l===null||l._visibility&1||(k=!0)),l=j,j=j.return;return l.tag===3?(j=l.stateNode,k&&p!==null&&(k=31-Gr(x),l=j.hiddenUpdates,A=l[k],A===null?l[k]=[p]:A.push(p),p.lane=x|536870912),j):null}function gh(l){if(50<un)throw un=0,Xn=null,Error(T(185));for(var p=l.return;p!==null;)l=p,p=l.return;return l.tag===3?l.stateNode:null}var Tl={};function Sl(l,p,x,A){this.tag=l,this.key=x,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lo(l,p,x,A){return new Sl(l,p,x,A)}function Kl(l){return l=l.prototype,!(!l||!l.isReactComponent)}function ko(l,p){var x=l.alternate;return x===null?(x=Lo(l.tag,p,l.key,l.mode),x.elementType=l.elementType,x.type=l.type,x.stateNode=l.stateNode,x.alternate=l,l.alternate=x):(x.pendingProps=p,x.type=l.type,x.flags=0,x.subtreeFlags=0,x.deletions=null),x.flags=l.flags&65011712,x.childLanes=l.childLanes,x.lanes=l.lanes,x.child=l.child,x.memoizedProps=l.memoizedProps,x.memoizedState=l.memoizedState,x.updateQueue=l.updateQueue,p=l.dependencies,x.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},x.sibling=l.sibling,x.index=l.index,x.ref=l.ref,x.refCleanup=l.refCleanup,x}function Jl(l,p){l.flags&=65011714;var x=l.alternate;return x===null?(l.childLanes=0,l.lanes=p,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=x.childLanes,l.lanes=x.lanes,l.child=x.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=x.memoizedProps,l.memoizedState=x.memoizedState,l.updateQueue=x.updateQueue,l.type=x.type,p=x.dependencies,l.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),l}function mu(l,p,x,A,k,j){var oe=0;if(A=l,typeof l=="function")Kl(l)&&(oe=1);else if(typeof l=="string")oe=Gv(l,x,Gt.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case Ei:return l=Lo(31,x,p,k),l.elementType=Ei,l.lanes=j,l;case he:return Dc(x.children,k,j,p);case Re:oe=8,k|=24;break;case Ne:return l=Lo(12,x,p,k|2),l.elementType=Ne,l.lanes=j,l;case Pt:return l=Lo(13,x,p,k),l.elementType=Pt,l.lanes=j,l;case Bt:return l=Lo(19,x,p,k),l.elementType=Bt,l.lanes=j,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case Ue:oe=10;break e;case Ge:oe=9;break e;case rt:oe=11;break e;case Tt:oe=14;break e;case Ht:oe=16,A=null;break e}oe=29,x=Error(T(130,l===null?"null":typeof l,"")),A=null}return p=Lo(oe,x,p,k),p.elementType=l,p.type=A,p.lanes=j,p}function Dc(l,p,x,A){return l=Lo(7,l,A,p),l.lanes=x,l}function _h(l,p,x){return l=Lo(6,l,null,p),l.lanes=x,l}function Cg(l){var p=Lo(18,null,null,0);return p.stateNode=l,p}function zf(l,p,x){return p=Lo(4,l.children!==null?l.children:[],l.key,p),p.lanes=x,p.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},p}var Lf=new WeakMap;function zs(l,p){if(typeof l=="object"&&l!==null){var x=Lf.get(l);return x!==void 0?x:(p={value:l,source:p,stack:Cn(p)},Lf.set(l,p),p)}return{value:l,source:p,stack:Cn(p)}}var Qi=[],yh=0,kf=null,bd=0,ta=[],La=0,zn=null,El=1,Xa="";function Ya(l,p){Qi[yh++]=bd,Qi[yh++]=kf,kf=l,bd=p}function wd(l,p,x){ta[La++]=El,ta[La++]=Xa,ta[La++]=zn,zn=l;var A=El;l=Xa;var k=32-Gr(A)-1;A&=~(1<<k),x+=1;var j=32-Gr(p)+k;if(30<j){var oe=k-k%5;j=(A&(1<<oe)-1).toString(32),A>>=oe,k-=oe,El=1<<32-Gr(p)+k|x<<k|A,Xa=j+l}else El=1<<j|x<<k|A,Xa=l}function Td(l){l.return!==null&&(Ya(l,1),wd(l,1,0))}function Ql(l){for(;l===kf;)kf=Qi[--yh],Qi[yh]=null,bd=Qi[--yh],Qi[yh]=null;for(;l===zn;)zn=ta[--La],ta[La]=null,Xa=ta[--La],ta[La]=null,El=ta[--La],ta[La]=null}function gu(l,p){ta[La++]=El,ta[La++]=Xa,ta[La++]=zn,El=p.id,Xa=p.overflow,zn=l}var fs=null,wr=null,Zn=!1,Al=null,_a=!1,Oc=Error(T(519));function Ka(l){var p=Error(T(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw vh(zs(p,l)),Oc}function Sd(l){var p=l.stateNode,x=l.type,A=l.memoizedProps;switch(p[Me]=l,p[_e]=A,x){case"dialog":$n("cancel",p),$n("close",p);break;case"iframe":case"object":case"embed":$n("load",p);break;case"video":case"audio":for(x=0;x<Yh.length;x++)$n(Yh[x],p);break;case"source":$n("error",p);break;case"img":case"image":case"link":$n("error",p),$n("load",p);break;case"details":$n("toggle",p);break;case"input":$n("invalid",p),ro(p,A.value,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name,!0);break;case"select":$n("invalid",p);break;case"textarea":$n("invalid",p),rh(p,A.value,A.defaultValue,A.children)}x=A.children,typeof x!="string"&&typeof x!="number"&&typeof x!="bigint"||p.textContent===""+x||A.suppressHydrationWarning===!0||zv(p.textContent,x)?(A.popover!=null&&($n("beforetoggle",p),$n("toggle",p)),A.onScroll!=null&&$n("scroll",p),A.onScrollEnd!=null&&$n("scrollend",p),A.onClick!=null&&(p.onclick=ds),p=!0):p=!1,p||Ka(l,!0)}function Bf(l){for(fs=l.return;fs;)switch(fs.tag){case 5:case 31:case 13:_a=!1;return;case 27:case 3:_a=!0;return;default:fs=fs.return}}function ec(l){if(l!==fs)return!1;if(!Zn)return Bf(l),Zn=!0,!1;var p=l.tag,x;if((x=p!==3&&p!==27)&&((x=p===5)&&(x=l.type,x=!(x!=="form"&&x!=="button")||Jc(l.type,l.memoizedProps)),x=!x),x&&wr&&Ka(l),Bf(l),p===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(T(317));wr=jv(l)}else if(p===31){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(T(317));wr=jv(l)}else p===27?(p=wr,hl(l.type)?(l=Lm,Lm=null,wr=l):wr=p):wr=fs?Nl(l.stateNode.nextSibling):null;return!0}function Ja(){wr=fs=null,Zn=!1}function Ff(){var l=Al;return l!==null&&(Nt===null?Nt=l:Nt.push.apply(Nt,l),Al=null),l}function vh(l){Al===null?Al=[l]:Al.push(l)}var Nf=Fe(null),ka=null,Cl=null;function Pc(l,p,x){bt(Nf,p._currentValue),p._currentValue=x}function tc(l){l._currentValue=Nf.current,wt(Nf)}function em(l,p,x){for(;l!==null;){var A=l.alternate;if((l.childLanes&p)!==p?(l.childLanes|=p,A!==null&&(A.childLanes|=p)):A!==null&&(A.childLanes&p)!==p&&(A.childLanes|=p),l===x)break;l=l.return}}function Ed(l,p,x,A){var k=l.child;for(k!==null&&(k.return=l);k!==null;){var j=k.dependencies;if(j!==null){var oe=k.child;j=j.firstContext;e:for(;j!==null;){var Ie=j;j=k;for(var et=0;et<p.length;et++)if(Ie.context===p[et]){j.lanes|=x,Ie=j.alternate,Ie!==null&&(Ie.lanes|=x),em(j.return,x,l),A||(oe=null);break e}j=Ie.next}}else if(k.tag===18){if(oe=k.return,oe===null)throw Error(T(341));oe.lanes|=x,j=oe.alternate,j!==null&&(j.lanes|=x),em(oe,x,l),oe=null}else oe=k.child;if(oe!==null)oe.return=k;else for(oe=k;oe!==null;){if(oe===l){oe=null;break}if(k=oe.sibling,k!==null){k.return=oe.return,oe=k;break}oe=oe.return}k=oe}}function zc(l,p,x,A){l=null;for(var k=p,j=!1;k!==null;){if(!j){if((k.flags&524288)!==0)j=!0;else if((k.flags&262144)!==0)break}if(k.tag===10){var oe=k.alternate;if(oe===null)throw Error(T(387));if(oe=oe.memoizedProps,oe!==null){var Ie=k.type;zo(k.pendingProps.value,oe.value)||(l!==null?l.push(Ie):l=[Ie])}}else if(k===Qt.current){if(oe=k.alternate,oe===null)throw Error(T(387));oe.memoizedState.memoizedState!==k.memoizedState.memoizedState&&(l!==null?l.push(Ul):l=[Ul])}k=k.return}l!==null&&Ed(p,l,x,A),p.flags|=262144}function xh(l){for(l=l.firstContext;l!==null;){if(!zo(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function ic(l){ka=l,Cl=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function Zs(l){return Ad(ka,l)}function _u(l,p){return ka===null&&ic(l),Ad(l,p)}function Ad(l,p){var x=p._currentValue;if(p={context:p,memoizedValue:x,next:null},Cl===null){if(l===null)throw Error(T(308));Cl=p,l.dependencies={lanes:0,firstContext:p},l.flags|=524288}else Cl=Cl.next=p;return x}var bh=typeof AbortController<"u"?AbortController:function(){var l=[],p=this.signal={aborted:!1,addEventListener:function(x,A){l.push(A)}};this.abort=function(){p.aborted=!0,l.forEach(function(x){return x()})}},Cd=d.unstable_scheduleCallback,Ig=d.unstable_NormalPriority,ar={$$typeof:Ue,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function wh(){return{controller:new bh,data:new Map,refCount:0}}function nc(l){l.refCount--,l.refCount===0&&Cd(Ig,function(){l.controller.abort()})}var ya=null,Th=0,rc=0,Lc=null;function Sh(l,p){if(ya===null){var x=ya=[];Th=0,rc=Im(),Lc={status:"pending",value:void 0,then:function(A){x.push(A)}}}return Th++,p.then(Eh,Eh),p}function Eh(){if(--Th===0&&ya!==null){Lc!==null&&(Lc.status="fulfilled");var l=ya;ya=null,rc=0,Lc=null;for(var p=0;p<l.length;p++)(0,l[p])()}}function Id(l,p){var x=[],A={status:"pending",value:null,reason:null,then:function(k){x.push(k)}};return l.then(function(){A.status="fulfilled",A.value=p;for(var k=0;k<x.length;k++)(0,x[k])(p)},function(k){for(A.status="rejected",A.reason=k,k=0;k<x.length;k++)(0,x[k])(void 0)}),A}var Rd=Xe.S;Xe.S=function(l,p){_i=tr(),typeof p=="object"&&p!==null&&typeof p.then=="function"&&Sh(l,p),Rd!==null&&Rd(l,p)};var sc=Fe(null);function Md(){var l=sc.current;return l!==null?l:Be.pooledCache}function Ah(l,p){p===null?bt(sc,sc.current):bt(sc,p.pool)}function yu(){var l=Md();return l===null?null:{parent:ar._currentValue,pool:l}}var Ch=Error(T(460)),tm=Error(T(474)),Dd=Error(T(542)),Od={then:function(){}};function Pd(l){return l=l.status,l==="fulfilled"||l==="rejected"}function Rg(l,p,x){switch(x=l[x],x===void 0?l.push(p):x!==p&&(p.then(ds,ds),p=x),p.status){case"fulfilled":return p.value;case"rejected":throw l=p.reason,kc(l),l;default:if(typeof p.status=="string")p.then(ds,ds);else{if(l=Be,l!==null&&100<l.shellSuspendCounter)throw Error(T(482));l=p,l.status="pending",l.then(function(A){if(p.status==="pending"){var k=p;k.status="fulfilled",k.value=A}},function(A){if(p.status==="pending"){var k=p;k.status="rejected",k.reason=A}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw l=p.reason,kc(l),l}throw oc=p,Ch}}function Il(l){try{var p=l._init;return p(l._payload)}catch(x){throw x!==null&&typeof x=="object"&&typeof x.then=="function"?(oc=x,Ch):x}}var oc=null;function im(){if(oc===null)throw Error(T(459));var l=oc;return oc=null,l}function kc(l){if(l===Ch||l===Dd)throw Error(T(483))}var Bc=null,Ih=0;function zd(l){var p=Ih;return Ih+=1,Bc===null&&(Bc=[]),Rg(Bc,l,p)}function vu(l,p){p=p.props.ref,l.ref=p!==void 0?p:null}function Qa(l,p){throw p.$$typeof===me?Error(T(525)):(l=Object.prototype.toString.call(p),Error(T(31,l==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":l)))}function Fc(l){function p(xt,st){if(l){var Rt=xt.deletions;Rt===null?(xt.deletions=[st],xt.flags|=16):Rt.push(st)}}function x(xt,st){if(!l)return null;for(;st!==null;)p(xt,st),st=st.sibling;return null}function A(xt){for(var st=new Map;xt!==null;)xt.key!==null?st.set(xt.key,xt):st.set(xt.index,xt),xt=xt.sibling;return st}function k(xt,st){return xt=ko(xt,st),xt.index=0,xt.sibling=null,xt}function j(xt,st,Rt){return xt.index=Rt,l?(Rt=xt.alternate,Rt!==null?(Rt=Rt.index,Rt<st?(xt.flags|=67108866,st):Rt):(xt.flags|=67108866,st)):(xt.flags|=1048576,st)}function oe(xt){return l&&xt.alternate===null&&(xt.flags|=67108866),xt}function Ie(xt,st,Rt,Jt){return st===null||st.tag!==6?(st=_h(Rt,xt.mode,Jt),st.return=xt,st):(st=k(st,Rt),st.return=xt,st)}function et(xt,st,Rt,Jt){var ln=Rt.type;return ln===he?Xt(xt,st,Rt.props.children,Jt,Rt.key):st!==null&&(st.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===Ht&&Il(ln)===st.type)?(st=k(st,Rt.props),vu(st,Rt),st.return=xt,st):(st=mu(Rt.type,Rt.key,Rt.props,null,xt.mode,Jt),vu(st,Rt),st.return=xt,st)}function Ot(xt,st,Rt,Jt){return st===null||st.tag!==4||st.stateNode.containerInfo!==Rt.containerInfo||st.stateNode.implementation!==Rt.implementation?(st=zf(Rt,xt.mode,Jt),st.return=xt,st):(st=k(st,Rt.children||[]),st.return=xt,st)}function Xt(xt,st,Rt,Jt,ln){return st===null||st.tag!==7?(st=Dc(Rt,xt.mode,Jt,ln),st.return=xt,st):(st=k(st,Rt),st.return=xt,st)}function ti(xt,st,Rt){if(typeof st=="string"&&st!==""||typeof st=="number"||typeof st=="bigint")return st=_h(""+st,xt.mode,Rt),st.return=xt,st;if(typeof st=="object"&&st!==null){switch(st.$$typeof){case we:return Rt=mu(st.type,st.key,st.props,null,xt.mode,Rt),vu(Rt,st),Rt.return=xt,Rt;case Ae:return st=zf(st,xt.mode,Rt),st.return=xt,st;case Ht:return st=Il(st),ti(xt,st,Rt)}if(Si(st)||Ui(st))return st=Dc(st,xt.mode,Rt,null),st.return=xt,st;if(typeof st.then=="function")return ti(xt,zd(st),Rt);if(st.$$typeof===Ue)return ti(xt,_u(xt,st),Rt);Qa(xt,st)}return null}function Lt(xt,st,Rt,Jt){var ln=st!==null?st.key:null;if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number"||typeof Rt=="bigint")return ln!==null?null:Ie(xt,st,""+Rt,Jt);if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case we:return Rt.key===ln?et(xt,st,Rt,Jt):null;case Ae:return Rt.key===ln?Ot(xt,st,Rt,Jt):null;case Ht:return Rt=Il(Rt),Lt(xt,st,Rt,Jt)}if(Si(Rt)||Ui(Rt))return ln!==null?null:Xt(xt,st,Rt,Jt,null);if(typeof Rt.then=="function")return Lt(xt,st,zd(Rt),Jt);if(Rt.$$typeof===Ue)return Lt(xt,st,_u(xt,Rt),Jt);Qa(xt,Rt)}return null}function Vt(xt,st,Rt,Jt,ln){if(typeof Jt=="string"&&Jt!==""||typeof Jt=="number"||typeof Jt=="bigint")return xt=xt.get(Rt)||null,Ie(st,xt,""+Jt,ln);if(typeof Jt=="object"&&Jt!==null){switch(Jt.$$typeof){case we:return xt=xt.get(Jt.key===null?Rt:Jt.key)||null,et(st,xt,Jt,ln);case Ae:return xt=xt.get(Jt.key===null?Rt:Jt.key)||null,Ot(st,xt,Jt,ln);case Ht:return Jt=Il(Jt),Vt(xt,st,Rt,Jt,ln)}if(Si(Jt)||Ui(Jt))return xt=xt.get(Rt)||null,Xt(st,xt,Jt,ln,null);if(typeof Jt.then=="function")return Vt(xt,st,Rt,zd(Jt),ln);if(Jt.$$typeof===Ue)return Vt(xt,st,Rt,_u(st,Jt),ln);Qa(st,Jt)}return null}function Vi(xt,st,Rt,Jt){for(var ln=null,fr=null,Wi=st,Nn=st=0,er=null;Wi!==null&&Nn<Rt.length;Nn++){Wi.index>Nn?(er=Wi,Wi=null):er=Wi.sibling;var ur=Lt(xt,Wi,Rt[Nn],Jt);if(ur===null){Wi===null&&(Wi=er);break}l&&Wi&&ur.alternate===null&&p(xt,Wi),st=j(ur,st,Nn),fr===null?ln=ur:fr.sibling=ur,fr=ur,Wi=er}if(Nn===Rt.length)return x(xt,Wi),Zn&&Ya(xt,Nn),ln;if(Wi===null){for(;Nn<Rt.length;Nn++)Wi=ti(xt,Rt[Nn],Jt),Wi!==null&&(st=j(Wi,st,Nn),fr===null?ln=Wi:fr.sibling=Wi,fr=Wi);return Zn&&Ya(xt,Nn),ln}for(Wi=A(Wi);Nn<Rt.length;Nn++)er=Vt(Wi,xt,Nn,Rt[Nn],Jt),er!==null&&(l&&er.alternate!==null&&Wi.delete(er.key===null?Nn:er.key),st=j(er,st,Nn),fr===null?ln=er:fr.sibling=er,fr=er);return l&&Wi.forEach(function(_c){return p(xt,_c)}),Zn&&Ya(xt,Nn),ln}function nn(xt,st,Rt,Jt){if(Rt==null)throw Error(T(151));for(var ln=null,fr=null,Wi=st,Nn=st=0,er=null,ur=Rt.next();Wi!==null&&!ur.done;Nn++,ur=Rt.next()){Wi.index>Nn?(er=Wi,Wi=null):er=Wi.sibling;var _c=Lt(xt,Wi,ur.value,Jt);if(_c===null){Wi===null&&(Wi=er);break}l&&Wi&&_c.alternate===null&&p(xt,Wi),st=j(_c,st,Nn),fr===null?ln=_c:fr.sibling=_c,fr=_c,Wi=er}if(ur.done)return x(xt,Wi),Zn&&Ya(xt,Nn),ln;if(Wi===null){for(;!ur.done;Nn++,ur=Rt.next())ur=ti(xt,ur.value,Jt),ur!==null&&(st=j(ur,st,Nn),fr===null?ln=ur:fr.sibling=ur,fr=ur);return Zn&&Ya(xt,Nn),ln}for(Wi=A(Wi);!ur.done;Nn++,ur=Rt.next())ur=Vt(Wi,xt,Nn,ur.value,Jt),ur!==null&&(l&&ur.alternate!==null&&Wi.delete(ur.key===null?Nn:ur.key),st=j(ur,st,Nn),fr===null?ln=ur:fr.sibling=ur,fr=ur);return l&&Wi.forEach(function(i0){return p(xt,i0)}),Zn&&Ya(xt,Nn),ln}function Ar(xt,st,Rt,Jt){if(typeof Rt=="object"&&Rt!==null&&Rt.type===he&&Rt.key===null&&(Rt=Rt.props.children),typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case we:e:{for(var ln=Rt.key;st!==null;){if(st.key===ln){if(ln=Rt.type,ln===he){if(st.tag===7){x(xt,st.sibling),Jt=k(st,Rt.props.children),Jt.return=xt,xt=Jt;break e}}else if(st.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===Ht&&Il(ln)===st.type){x(xt,st.sibling),Jt=k(st,Rt.props),vu(Jt,Rt),Jt.return=xt,xt=Jt;break e}x(xt,st);break}else p(xt,st);st=st.sibling}Rt.type===he?(Jt=Dc(Rt.props.children,xt.mode,Jt,Rt.key),Jt.return=xt,xt=Jt):(Jt=mu(Rt.type,Rt.key,Rt.props,null,xt.mode,Jt),vu(Jt,Rt),Jt.return=xt,xt=Jt)}return oe(xt);case Ae:e:{for(ln=Rt.key;st!==null;){if(st.key===ln)if(st.tag===4&&st.stateNode.containerInfo===Rt.containerInfo&&st.stateNode.implementation===Rt.implementation){x(xt,st.sibling),Jt=k(st,Rt.children||[]),Jt.return=xt,xt=Jt;break e}else{x(xt,st);break}else p(xt,st);st=st.sibling}Jt=zf(Rt,xt.mode,Jt),Jt.return=xt,xt=Jt}return oe(xt);case Ht:return Rt=Il(Rt),Ar(xt,st,Rt,Jt)}if(Si(Rt))return Vi(xt,st,Rt,Jt);if(Ui(Rt)){if(ln=Ui(Rt),typeof ln!="function")throw Error(T(150));return Rt=ln.call(Rt),nn(xt,st,Rt,Jt)}if(typeof Rt.then=="function")return Ar(xt,st,zd(Rt),Jt);if(Rt.$$typeof===Ue)return Ar(xt,st,_u(xt,Rt),Jt);Qa(xt,Rt)}return typeof Rt=="string"&&Rt!==""||typeof Rt=="number"||typeof Rt=="bigint"?(Rt=""+Rt,st!==null&&st.tag===6?(x(xt,st.sibling),Jt=k(st,Rt),Jt.return=xt,xt=Jt):(x(xt,st),Jt=_h(Rt,xt.mode,Jt),Jt.return=xt,xt=Jt),oe(xt)):x(xt,st)}return function(xt,st,Rt,Jt){try{Ih=0;var ln=Ar(xt,st,Rt,Jt);return Bc=null,ln}catch(Wi){if(Wi===Ch||Wi===Dd)throw Wi;var fr=Lo(29,Wi,null,xt.mode);return fr.lanes=Jt,fr.return=xt,fr}finally{}}}var Rl=Fc(!0),nm=Fc(!1),Bo=!1;function Ld(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Rh(l,p){l=l.updateQueue,p.updateQueue===l&&(p.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function Ml(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function ac(l,p,x){var A=l.updateQueue;if(A===null)return null;if(A=A.shared,(Pe&2)!==0){var k=A.pending;return k===null?p.next=p:(p.next=k.next,k.next=p),A.pending=p,p=gh(l),Pf(l,null,x),p}return wo(l,A,p,x),gh(l)}function xu(l,p,x){if(p=p.updateQueue,p!==null&&(p=p.shared,(x&4194048)!==0)){var A=p.lanes;A&=l.pendingLanes,x|=A,p.lanes=x,or(l,x)}}function Mh(l,p){var x=l.updateQueue,A=l.alternate;if(A!==null&&(A=A.updateQueue,x===A)){var k=null,j=null;if(x=x.firstBaseUpdate,x!==null){do{var oe={lane:x.lane,tag:x.tag,payload:x.payload,callback:null,next:null};j===null?k=j=oe:j=j.next=oe,x=x.next}while(x!==null);j===null?k=j=p:j=j.next=p}else k=j=p;x={baseState:A.baseState,firstBaseUpdate:k,lastBaseUpdate:j,shared:A.shared,callbacks:A.callbacks},l.updateQueue=x;return}l=x.lastBaseUpdate,l===null?x.firstBaseUpdate=p:l.next=p,x.lastBaseUpdate=p}var jf=!1;function bu(){if(jf){var l=Lc;if(l!==null)throw l}}function lc(l,p,x,A){jf=!1;var k=l.updateQueue;Bo=!1;var j=k.firstBaseUpdate,oe=k.lastBaseUpdate,Ie=k.shared.pending;if(Ie!==null){k.shared.pending=null;var et=Ie,Ot=et.next;et.next=null,oe===null?j=Ot:oe.next=Ot,oe=et;var Xt=l.alternate;Xt!==null&&(Xt=Xt.updateQueue,Ie=Xt.lastBaseUpdate,Ie!==oe&&(Ie===null?Xt.firstBaseUpdate=Ot:Ie.next=Ot,Xt.lastBaseUpdate=et))}if(j!==null){var ti=k.baseState;oe=0,Xt=Ot=et=null,Ie=j;do{var Lt=Ie.lane&-536870913,Vt=Lt!==Ie.lane;if(Vt?(Ve&Lt)===Lt:(A&Lt)===Lt){Lt!==0&&Lt===rc&&(jf=!0),Xt!==null&&(Xt=Xt.next={lane:0,tag:Ie.tag,payload:Ie.payload,callback:null,next:null});e:{var Vi=l,nn=Ie;Lt=p;var Ar=x;switch(nn.tag){case 1:if(Vi=nn.payload,typeof Vi=="function"){ti=Vi.call(Ar,ti,Lt);break e}ti=Vi;break e;case 3:Vi.flags=Vi.flags&-65537|128;case 0:if(Vi=nn.payload,Lt=typeof Vi=="function"?Vi.call(Ar,ti,Lt):Vi,Lt==null)break e;ti=Q({},ti,Lt);break e;case 2:Bo=!0}}Lt=Ie.callback,Lt!==null&&(l.flags|=64,Vt&&(l.flags|=8192),Vt=k.callbacks,Vt===null?k.callbacks=[Lt]:Vt.push(Lt))}else Vt={lane:Lt,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},Xt===null?(Ot=Xt=Vt,et=ti):Xt=Xt.next=Vt,oe|=Lt;if(Ie=Ie.next,Ie===null){if(Ie=k.shared.pending,Ie===null)break;Vt=Ie,Ie=Vt.next,Vt.next=null,k.lastBaseUpdate=Vt,k.shared.pending=null}}while(!0);Xt===null&&(et=ti),k.baseState=et,k.firstBaseUpdate=Ot,k.lastBaseUpdate=Xt,j===null&&(k.shared.lanes=0),St|=oe,l.lanes=oe,l.memoizedState=ti}}function wu(l,p){if(typeof l!="function")throw Error(T(191,l));l.call(p)}function Mg(l,p){var x=l.callbacks;if(x!==null)for(l.callbacks=null,l=0;l<x.length;l++)wu(x[l],p)}var Tu=Fe(null),Uf=Fe(0);function kd(l,p){l=Ze,bt(Uf,l),bt(Tu,p),Ze=l|p.baseLanes}function Su(){bt(Uf,Ze),bt(Tu,Tu.current)}function Dl(){Ze=Uf.current,wt(Tu),wt(Uf)}var lo=Fe(null),Ws=null;function el(l){var p=l.alternate;bt(ps,ps.current&1),bt(lo,l),Ws===null&&(p===null||Tu.current!==null||p.memoizedState!==null)&&(Ws=l)}function Eu(l){bt(ps,ps.current),bt(lo,l),Ws===null&&(Ws=l)}function Bd(l){l.tag===22?(bt(ps,ps.current),bt(lo,l),Ws===null&&(Ws=l)):co()}function co(){bt(ps,ps.current),bt(lo,lo.current)}function ia(l){wt(lo),Ws===l&&(Ws=null),wt(ps)}var ps=Fe(0);function Ol(l){for(var p=l;p!==null;){if(p.tag===13){var x=p.memoizedState;if(x!==null&&(x=x.dehydrated,x===null||ay(x)||ly(x)))return p}else if(p.tag===19&&(p.memoizedProps.revealOrder==="forwards"||p.memoizedProps.revealOrder==="backwards"||p.memoizedProps.revealOrder==="unstable_legacy-backwards"||p.memoizedProps.revealOrder==="together")){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===l)break;for(;p.sibling===null;){if(p.return===null||p.return===l)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var Ba=0,Mt=null,Tr=null,Sr=null,Fa=!1,Au=!1,Nc=!1,Cu=0,jc=0,Uc=null,rm=0;function zr(){throw Error(T(321))}function Vc(l,p){if(p===null)return!1;for(var x=0;x<p.length&&x<l.length;x++)if(!zo(l[x],p[x]))return!1;return!0}function Iu(l,p,x,A,k,j){return Ba=j,Mt=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,Xe.H=l===null||l.memoizedState===null?ep:Wd,Nc=!1,j=x(A,k),Nc=!1,Au&&(j=sm(p,x,A,k)),tl(l),j}function tl(l){Xe.H=nl;var p=Tr!==null&&Tr.next!==null;if(Ba=0,Sr=Tr=Mt=null,Fa=!1,jc=0,Uc=null,p)throw Error(T(300));l===null||ss||(l=l.dependencies,l!==null&&xh(l)&&(ss=!0))}function sm(l,p,x,A){Mt=l;var k=0;do{if(Au&&(Uc=null),jc=0,Au=!1,25<=k)throw Error(T(301));if(k+=1,Sr=Tr=null,l.updateQueue!=null){var j=l.updateQueue;j.lastEffect=null,j.events=null,j.stores=null,j.memoCache!=null&&(j.memoCache.index=0)}Xe.H=_m,j=p(x,A)}while(Au);return j}function Dg(){var l=Xe.H,p=l.useState()[0];return p=typeof p.then=="function"?Gc(p):p,l=l.useState()[0],(Tr!==null?Tr.memoizedState:null)!==l&&(Mt.flags|=1024),p}function Vf(){var l=Cu!==0;return Cu=0,l}function Gf(l,p,x){p.updateQueue=l.updateQueue,p.flags&=-2053,l.lanes&=~x}function Fd(l){if(Fa){for(l=l.memoizedState;l!==null;){var p=l.queue;p!==null&&(p.pending=null),l=l.next}Fa=!1}Ba=0,Sr=Tr=Mt=null,Au=!1,jc=Cu=0,Uc=null}function Is(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Sr===null?Mt.memoizedState=Sr=l:Sr=Sr.next=l,Sr}function Yr(){if(Tr===null){var l=Mt.alternate;l=l!==null?l.memoizedState:null}else l=Tr.next;var p=Sr===null?Mt.memoizedState:Sr.next;if(p!==null)Sr=p,Tr=l;else{if(l===null)throw Mt.alternate===null?Error(T(467)):Error(T(310));Tr=l,l={memoizedState:Tr.memoizedState,baseState:Tr.baseState,baseQueue:Tr.baseQueue,queue:Tr.queue,next:null},Sr===null?Mt.memoizedState=Sr=l:Sr=Sr.next=l}return Sr}function Dh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Gc(l){var p=jc;return jc+=1,Uc===null&&(Uc=[]),l=Rg(Uc,l,p),p=Mt,(Sr===null?p.memoizedState:Sr.next)===null&&(p=p.alternate,Xe.H=p===null||p.memoizedState===null?ep:Wd),l}function Nd(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return Gc(l);if(l.$$typeof===Ue)return Zs(l)}throw Error(T(438,String(l)))}function qf(l){var p=null,x=Mt.updateQueue;if(x!==null&&(p=x.memoCache),p==null){var A=Mt.alternate;A!==null&&(A=A.updateQueue,A!==null&&(A=A.memoCache,A!=null&&(p={data:A.data.map(function(k){return k.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),x===null&&(x=Dh(),Mt.updateQueue=x),x.memoCache=p,x=p.data[p.index],x===void 0)for(x=p.data[p.index]=Array(l),A=0;A<l;A++)x[A]=rn;return p.index++,x}function il(l,p){return typeof p=="function"?p(l):p}function jd(l){var p=Yr();return Ud(p,Tr,l)}function Ud(l,p,x){var A=l.queue;if(A===null)throw Error(T(311));A.lastRenderedReducer=x;var k=l.baseQueue,j=A.pending;if(j!==null){if(k!==null){var oe=k.next;k.next=j.next,j.next=oe}p.baseQueue=k=j,A.pending=null}if(j=l.baseState,k===null)l.memoizedState=j;else{p=k.next;var Ie=oe=null,et=null,Ot=p,Xt=!1;do{var ti=Ot.lane&-536870913;if(ti!==Ot.lane?(Ve&ti)===ti:(Ba&ti)===ti){var Lt=Ot.revertLane;if(Lt===0)et!==null&&(et=et.next={lane:0,revertLane:0,gesture:null,action:Ot.action,hasEagerState:Ot.hasEagerState,eagerState:Ot.eagerState,next:null}),ti===rc&&(Xt=!0);else if((Ba&Lt)===Lt){Ot=Ot.next,Lt===rc&&(Xt=!0);continue}else ti={lane:0,revertLane:Ot.revertLane,gesture:null,action:Ot.action,hasEagerState:Ot.hasEagerState,eagerState:Ot.eagerState,next:null},et===null?(Ie=et=ti,oe=j):et=et.next=ti,Mt.lanes|=Lt,St|=Lt;ti=Ot.action,Nc&&x(j,ti),j=Ot.hasEagerState?Ot.eagerState:x(j,ti)}else Lt={lane:ti,revertLane:Ot.revertLane,gesture:Ot.gesture,action:Ot.action,hasEagerState:Ot.hasEagerState,eagerState:Ot.eagerState,next:null},et===null?(Ie=et=Lt,oe=j):et=et.next=Lt,Mt.lanes|=ti,St|=ti;Ot=Ot.next}while(Ot!==null&&Ot!==p);if(et===null?oe=j:et.next=Ie,!zo(j,l.memoizedState)&&(ss=!0,Xt&&(x=Lc,x!==null)))throw x;l.memoizedState=j,l.baseState=oe,l.baseQueue=et,A.lastRenderedState=j}return k===null&&(A.lanes=0),[l.memoizedState,A.dispatch]}function Hf(l){var p=Yr(),x=p.queue;if(x===null)throw Error(T(311));x.lastRenderedReducer=l;var A=x.dispatch,k=x.pending,j=p.memoizedState;if(k!==null){x.pending=null;var oe=k=k.next;do j=l(j,oe.action),oe=oe.next;while(oe!==k);zo(j,p.memoizedState)||(ss=!0),p.memoizedState=j,p.baseQueue===null&&(p.baseState=j),x.lastRenderedState=j}return[j,A]}function $f(l,p,x){var A=Mt,k=Yr(),j=Zn;if(j){if(x===void 0)throw Error(T(407));x=x()}else x=p();var oe=!zo((Tr||k).memoizedState,x);if(oe&&(k.memoizedState=x,ss=!0),k=k.queue,Ru(Og.bind(null,A,k,l),[l]),k.getSnapshot!==p||oe||Sr!==null&&Sr.memoizedState.tag&1){if(A.flags|=2048,qc(9,{destroy:void 0},Wf.bind(null,A,k,x,p),null),Be===null)throw Error(T(349));j||(Ba&127)!==0||Zf(A,p,x)}return x}function Zf(l,p,x){l.flags|=16384,l={getSnapshot:p,value:x},p=Mt.updateQueue,p===null?(p=Dh(),Mt.updateQueue=p,p.stores=[l]):(x=p.stores,x===null?p.stores=[l]:x.push(l))}function Wf(l,p,x,A){p.value=x,p.getSnapshot=A,Pg(p)&&om(l)}function Og(l,p,x){return x(function(){Pg(p)&&om(l)})}function Pg(l){var p=l.getSnapshot;l=l.value;try{var x=p();return!zo(l,x)}catch{return!0}}function om(l){var p=zt(l,2);p!==null&&Di(p,l,2)}function Pl(l){var p=Is();if(typeof l=="function"){var x=l;if(l=x(),Nc){yr(!0);try{x()}finally{yr(!1)}}}return p.memoizedState=p.baseState=l,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:il,lastRenderedState:l},p}function am(l,p,x,A){return l.baseState=x,Ud(l,Tr,typeof A=="function"?A:il)}function lm(l,p,x,A,k){if($d(l))throw Error(T(485));if(l=p.action,l!==null){var j={payload:k,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(oe){j.listeners.push(oe)}};Xe.T!==null?x(!0):j.isTransition=!1,A(j),x=p.pending,x===null?(j.next=p.pending=j,Vd(p,j)):(j.next=x.next,p.pending=x.next=j)}}function Vd(l,p){var x=p.action,A=p.payload,k=l.state;if(p.isTransition){var j=Xe.T,oe={};Xe.T=oe;try{var Ie=x(k,A),et=Xe.S;et!==null&&et(oe,Ie),cm(l,p,Ie)}catch(Ot){zl(l,p,Ot)}finally{j!==null&&oe.types!==null&&(j.types=oe.types),Xe.T=j}}else try{j=x(k,A),cm(l,p,j)}catch(Ot){zl(l,p,Ot)}}function cm(l,p,x){x!==null&&typeof x=="object"&&typeof x.then=="function"?x.then(function(A){zg(l,p,A)},function(A){return zl(l,p,A)}):zg(l,p,x)}function zg(l,p,x){p.status="fulfilled",p.value=x,To(p),l.state=x,p=l.pending,p!==null&&(x=p.next,x===p?l.pending=null:(x=x.next,p.next=x,Vd(l,x)))}function zl(l,p,x){var A=l.pending;if(l.pending=null,A!==null){A=A.next;do p.status="rejected",p.reason=x,To(p),p=p.next;while(p!==A)}l.action=null}function To(l){l=l.listeners;for(var p=0;p<l.length;p++)(0,l[p])()}function cc(l,p){return p}function uo(l,p){if(Zn){var x=Be.formState;if(x!==null){e:{var A=Mt;if(Zn){if(wr){t:{for(var k=wr,j=_a;k.nodeType!==8;){if(!j){k=null;break t}if(k=Nl(k.nextSibling),k===null){k=null;break t}}j=k.data,k=j==="F!"||j==="F"?k:null}if(k){wr=Nl(k.nextSibling),A=k.data==="F!";break e}}Ka(A)}A=!1}A&&(p=x[0])}}return x=Is(),x.memoizedState=x.baseState=p,A={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cc,lastRenderedState:p},x.queue=A,x=zh.bind(null,Mt,A),A.dispatch=x,A=Pl(!1),j=Hd.bind(null,Mt,!1,A.queue),A=Is(),k={state:p,dispatch:null,action:l,pending:null},A.queue=k,x=lm.bind(null,Mt,k,j,x),k.dispatch=x,A.memoizedState=l,[p,x,!1]}function uc(l){var p=Yr();return um(p,Tr,l)}function um(l,p,x){if(p=Ud(l,p,cc)[0],l=jd(il)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var A=Gc(p)}catch(oe){throw oe===Ch?Dd:oe}else A=p;p=Yr();var k=p.queue,j=k.dispatch;return x!==p.memoizedState&&(Mt.flags|=2048,qc(9,{destroy:void 0},hm.bind(null,k,x),null)),[A,j,l]}function hm(l,p){l.action=p}function Xf(l){var p=Yr(),x=Tr;if(x!==null)return um(p,x,l);Yr(),p=p.memoizedState,x=Yr();var A=x.queue.dispatch;return x.memoizedState=l,[p,A,!1]}function qc(l,p,x,A){return l={tag:l,create:x,deps:A,inst:p,next:null},p=Mt.updateQueue,p===null&&(p=Dh(),Mt.updateQueue=p),x=p.lastEffect,x===null?p.lastEffect=l.next=l:(A=x.next,x.next=l,l.next=A,p.lastEffect=l),l}function Yf(){return Yr().memoizedState}function na(l,p,x,A){var k=Is();Mt.flags|=l,k.memoizedState=qc(1|p,{destroy:void 0},x,A===void 0?null:A)}function bn(l,p,x,A){var k=Yr();A=A===void 0?null:A;var j=k.memoizedState.inst;Tr!==null&&A!==null&&Vc(A,Tr.memoizedState.deps)?k.memoizedState=qc(p,j,x,A):(Mt.flags|=l,k.memoizedState=qc(1|p,j,x,A))}function Oh(l,p){na(8390656,8,l,p)}function Ru(l,p){bn(2048,8,l,p)}function Ph(l){Mt.flags|=4;var p=Mt.updateQueue;if(p===null)p=Dh(),Mt.updateQueue=p,p.events=[l];else{var x=p.events;x===null?p.events=[l]:x.push(l)}}function dm(l){var p=Yr().memoizedState;return Ph({ref:p,nextImpl:l}),function(){if((Pe&2)!==0)throw Error(T(440));return p.impl.apply(void 0,arguments)}}function fm(l,p){return bn(4,2,l,p)}function Kf(l,p){return bn(4,4,l,p)}function Hc(l,p){if(typeof p=="function"){l=l();var x=p(l);return function(){typeof x=="function"?x():p(null)}}if(p!=null)return l=l(),p.current=l,function(){p.current=null}}function ho(l,p,x){x=x!=null?x.concat([l]):null,bn(4,4,Hc.bind(null,p,l),x)}function Dt(){}function Ut(l,p){var x=Yr();p=p===void 0?null:p;var A=x.memoizedState;return p!==null&&Vc(p,A[1])?A[0]:(x.memoizedState=[l,p],l)}function Mu(l,p){var x=Yr();p=p===void 0?null:p;var A=x.memoizedState;if(p!==null&&Vc(p,A[1]))return A[0];if(A=l(),Nc){yr(!0);try{l()}finally{yr(!1)}}return x.memoizedState=[A,p],A}function nr(l,p,x){return x===void 0||(Ba&1073741824)!==0&&(Ve&261930)===0?l.memoizedState=p:(l.memoizedState=x,l=pn(),Mt.lanes|=l,St|=l,x)}function qe(l,p,x,A){return zo(x,p)?x:Tu.current!==null?(l=nr(l,x,A),zo(l,p)||(ss=!0),l):(Ba&42)===0||(Ba&1073741824)!==0&&(Ve&261930)===0?(ss=!0,l.memoizedState=x):(l=pn(),Mt.lanes|=l,St|=l,p)}function pm(l,p,x,A,k){var j=gt.p;gt.p=j!==0&&8>j?j:8;var oe=Xe.T,Ie={};Xe.T=Ie,Hd(l,!1,p,x);try{var et=k(),Ot=Xe.S;if(Ot!==null&&Ot(Ie,et),et!==null&&typeof et=="object"&&typeof et.then=="function"){var Xt=Id(et,A);ra(l,p,Xt,Tn(l))}else ra(l,p,A,Tn(l))}catch(ti){ra(l,p,{then:function(){},status:"rejected",reason:ti},Tn())}finally{gt.p=j,oe!==null&&Ie.types!==null&&(oe.types=Ie.types),Xe.T=oe}}function Jf(){}function Gd(l,p,x,A){if(l.tag!==5)throw Error(T(476));var k=Qf(l).queue;pm(l,k,p,yt,x===null?Jf:function(){return mm(l),x(A)})}function Qf(l){var p=l.memoizedState;if(p!==null)return p;p={memoizedState:yt,baseState:yt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:il,lastRenderedState:yt},next:null};var x={};return p.next={memoizedState:x,baseState:x,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:il,lastRenderedState:x},next:null},l.memoizedState=p,l=l.alternate,l!==null&&(l.memoizedState=p),p}function mm(l){var p=Qf(l);p.next===null&&(p=l.alternate.memoizedState),ra(l,p.next.queue,{},Tn())}function qd(){return Zs(Ul)}function Du(){return Yr().memoizedState}function Lg(){return Yr().memoizedState}function Y_(l){for(var p=l.return;p!==null;){switch(p.tag){case 24:case 3:var x=Tn();l=Ml(x);var A=ac(p,l,x);A!==null&&(Di(A,p,x),xu(A,p,x)),p={cache:wh()},l.payload=p;return}p=p.return}}function gm(l,p,x){var A=Tn();x={lane:A,revertLane:0,gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null},$d(l)?Zd(p,x):(x=pu(l,p,x,A),x!==null&&(Di(x,l,A),Lh(x,p,A)))}function zh(l,p,x){var A=Tn();ra(l,p,x,A)}function ra(l,p,x,A){var k={lane:A,revertLane:0,gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null};if($d(l))Zd(p,k);else{var j=l.alternate;if(l.lanes===0&&(j===null||j.lanes===0)&&(j=p.lastRenderedReducer,j!==null))try{var oe=p.lastRenderedState,Ie=j(oe,x);if(k.hasEagerState=!0,k.eagerState=Ie,zo(Ie,oe))return wo(l,p,k,0),Be===null&&fu(),!1}catch{}finally{}if(x=pu(l,p,k,A),x!==null)return Di(x,l,A),Lh(x,p,A),!0}return!1}function Hd(l,p,x,A){if(A={lane:2,revertLane:Im(),gesture:null,action:A,hasEagerState:!1,eagerState:null,next:null},$d(l)){if(p)throw Error(T(479))}else p=pu(l,x,A,2),p!==null&&Di(p,l,2)}function $d(l){var p=l.alternate;return l===Mt||p!==null&&p===Mt}function Zd(l,p){Au=Fa=!0;var x=l.pending;x===null?p.next=p:(p.next=x.next,x.next=p),l.pending=p}function Lh(l,p,x){if((x&4194048)!==0){var A=p.lanes;A&=l.pendingLanes,x|=A,p.lanes=x,or(l,x)}}var nl={readContext:Zs,use:Nd,useCallback:zr,useContext:zr,useEffect:zr,useImperativeHandle:zr,useLayoutEffect:zr,useInsertionEffect:zr,useMemo:zr,useReducer:zr,useRef:zr,useState:zr,useDebugValue:zr,useDeferredValue:zr,useTransition:zr,useSyncExternalStore:zr,useId:zr,useHostTransitionStatus:zr,useFormState:zr,useActionState:zr,useOptimistic:zr,useMemoCache:zr,useCacheRefresh:zr};nl.useEffectEvent=zr;var ep={readContext:Zs,use:Nd,useCallback:function(l,p){return Is().memoizedState=[l,p===void 0?null:p],l},useContext:Zs,useEffect:Oh,useImperativeHandle:function(l,p,x){x=x!=null?x.concat([l]):null,na(4194308,4,Hc.bind(null,p,l),x)},useLayoutEffect:function(l,p){return na(4194308,4,l,p)},useInsertionEffect:function(l,p){na(4,2,l,p)},useMemo:function(l,p){var x=Is();p=p===void 0?null:p;var A=l();if(Nc){yr(!0);try{l()}finally{yr(!1)}}return x.memoizedState=[A,p],A},useReducer:function(l,p,x){var A=Is();if(x!==void 0){var k=x(p);if(Nc){yr(!0);try{x(p)}finally{yr(!1)}}}else k=p;return A.memoizedState=A.baseState=k,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:k},A.queue=l,l=l.dispatch=gm.bind(null,Mt,l),[A.memoizedState,l]},useRef:function(l){var p=Is();return l={current:l},p.memoizedState=l},useState:function(l){l=Pl(l);var p=l.queue,x=zh.bind(null,Mt,p);return p.dispatch=x,[l.memoizedState,x]},useDebugValue:Dt,useDeferredValue:function(l,p){var x=Is();return nr(x,l,p)},useTransition:function(){var l=Pl(!1);return l=pm.bind(null,Mt,l.queue,!0,!1),Is().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,p,x){var A=Mt,k=Is();if(Zn){if(x===void 0)throw Error(T(407));x=x()}else{if(x=p(),Be===null)throw Error(T(349));(Ve&127)!==0||Zf(A,p,x)}k.memoizedState=x;var j={value:x,getSnapshot:p};return k.queue=j,Oh(Og.bind(null,A,j,l),[l]),A.flags|=2048,qc(9,{destroy:void 0},Wf.bind(null,A,j,x,p),null),x},useId:function(){var l=Is(),p=Be.identifierPrefix;if(Zn){var x=Xa,A=El;x=(A&~(1<<32-Gr(A)-1)).toString(32)+x,p="_"+p+"R_"+x,x=Cu++,0<x&&(p+="H"+x.toString(32)),p+="_"}else x=rm++,p="_"+p+"r_"+x.toString(32)+"_";return l.memoizedState=p},useHostTransitionStatus:qd,useFormState:uo,useActionState:uo,useOptimistic:function(l){var p=Is();p.memoizedState=p.baseState=l;var x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=x,p=Hd.bind(null,Mt,!0,x),x.dispatch=p,[l,p]},useMemoCache:qf,useCacheRefresh:function(){return Is().memoizedState=Y_.bind(null,Mt)},useEffectEvent:function(l){var p=Is(),x={impl:l};return p.memoizedState=x,function(){if((Pe&2)!==0)throw Error(T(440));return x.impl.apply(void 0,arguments)}}},Wd={readContext:Zs,use:Nd,useCallback:Ut,useContext:Zs,useEffect:Ru,useImperativeHandle:ho,useInsertionEffect:fm,useLayoutEffect:Kf,useMemo:Mu,useReducer:jd,useRef:Yf,useState:function(){return jd(il)},useDebugValue:Dt,useDeferredValue:function(l,p){var x=Yr();return qe(x,Tr.memoizedState,l,p)},useTransition:function(){var l=jd(il)[0],p=Yr().memoizedState;return[typeof l=="boolean"?l:Gc(l),p]},useSyncExternalStore:$f,useId:Du,useHostTransitionStatus:qd,useFormState:uc,useActionState:uc,useOptimistic:function(l,p){var x=Yr();return am(x,Tr,l,p)},useMemoCache:qf,useCacheRefresh:Lg};Wd.useEffectEvent=dm;var _m={readContext:Zs,use:Nd,useCallback:Ut,useContext:Zs,useEffect:Ru,useImperativeHandle:ho,useInsertionEffect:fm,useLayoutEffect:Kf,useMemo:Mu,useReducer:Hf,useRef:Yf,useState:function(){return Hf(il)},useDebugValue:Dt,useDeferredValue:function(l,p){var x=Yr();return Tr===null?nr(x,l,p):qe(x,Tr.memoizedState,l,p)},useTransition:function(){var l=Hf(il)[0],p=Yr().memoizedState;return[typeof l=="boolean"?l:Gc(l),p]},useSyncExternalStore:$f,useId:Du,useHostTransitionStatus:qd,useFormState:Xf,useActionState:Xf,useOptimistic:function(l,p){var x=Yr();return Tr!==null?am(x,Tr,l,p):(x.baseState=l,[l,x.queue.dispatch])},useMemoCache:qf,useCacheRefresh:Lg};_m.useEffectEvent=dm;function tp(l,p,x,A){p=l.memoizedState,x=x(A,p),x=x==null?p:Q({},p,x),l.memoizedState=x,l.lanes===0&&(l.updateQueue.baseState=x)}var ip={enqueueSetState:function(l,p,x){l=l._reactInternals;var A=Tn(),k=Ml(A);k.payload=p,x!=null&&(k.callback=x),p=ac(l,k,A),p!==null&&(Di(p,l,A),xu(p,l,A))},enqueueReplaceState:function(l,p,x){l=l._reactInternals;var A=Tn(),k=Ml(A);k.tag=1,k.payload=p,x!=null&&(k.callback=x),p=ac(l,k,A),p!==null&&(Di(p,l,A),xu(p,l,A))},enqueueForceUpdate:function(l,p){l=l._reactInternals;var x=Tn(),A=Ml(x);A.tag=2,p!=null&&(A.callback=p),p=ac(l,A,x),p!==null&&(Di(p,l,x),xu(p,l,x))}};function fo(l,p,x,A,k,j,oe){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(A,j,oe):p.prototype&&p.prototype.isPureReactComponent?!ea(x,A)||!ea(k,j):!0}function ym(l,p,x,A){l=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(x,A),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(x,A),p.state!==l&&ip.enqueueReplaceState(p,p.state,null)}function sa(l,p){var x=p;if("ref"in p){x={};for(var A in p)A!=="ref"&&(x[A]=p[A])}if(l=l.defaultProps){x===p&&(x=Q({},x));for(var k in l)x[k]===void 0&&(x[k]=l[k])}return x}function kg(l){mh(l)}function qn(l){console.error(l)}function $i(l){mh(l)}function Xd(l,p){try{var x=l.onUncaughtError;x(p.value,{componentStack:p.stack})}catch(A){setTimeout(function(){throw A})}}function hc(l,p,x){try{var A=l.onCaughtError;A(x.value,{componentStack:x.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(k){setTimeout(function(){throw k})}}function rl(l,p,x){return x=Ml(x),x.tag=3,x.payload={element:null},x.callback=function(){Xd(l,p)},x}function Ll(l){return l=Ml(l),l.tag=3,l}function ms(l,p,x,A){var k=x.type.getDerivedStateFromError;if(typeof k=="function"){var j=A.value;l.payload=function(){return k(j)},l.callback=function(){hc(p,x,A)}}var oe=x.stateNode;oe!==null&&typeof oe.componentDidCatch=="function"&&(l.callback=function(){hc(p,x,A),typeof k!="function"&&(yi===null?yi=new Set([this]):yi.add(this));var Ie=A.stack;this.componentDidCatch(A.value,{componentStack:Ie!==null?Ie:""})})}function kh(l,p,x,A,k){if(x.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){if(p=x.alternate,p!==null&&zc(p,x,k,!0),x=lo.current,x!==null){switch(x.tag){case 31:case 13:return Ws===null?Ys():x.alternate===null&&lt===0&&(lt=3),x.flags&=-257,x.flags|=65536,x.lanes=k,A===Od?x.flags|=16384:(p=x.updateQueue,p===null?x.updateQueue=new Set([A]):p.add(A),mc(l,A,k)),!1;case 22:return x.flags|=65536,A===Od?x.flags|=16384:(p=x.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([A])},x.updateQueue=p):(x=p.retryQueue,x===null?p.retryQueue=new Set([A]):x.add(A)),mc(l,A,k)),!1}throw Error(T(435,x.tag))}return mc(l,A,k),Ys(),!1}if(Zn)return p=lo.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=k,A!==Oc&&(l=Error(T(422),{cause:A}),vh(zs(l,x)))):(A!==Oc&&(p=Error(T(423),{cause:A}),vh(zs(p,x))),l=l.current.alternate,l.flags|=65536,k&=-k,l.lanes|=k,A=zs(A,x),k=rl(l.stateNode,A,k),Mh(l,k),lt!==4&&(lt=2)),!1;var j=Error(T(520),{cause:A});if(j=zs(j,x),Yt===null?Yt=[j]:Yt.push(j),lt!==4&&(lt=2),p===null)return!0;A=zs(A,x),x=p;do{switch(x.tag){case 3:return x.flags|=65536,l=k&-k,x.lanes|=l,l=rl(x.stateNode,A,l),Mh(x,l),!1;case 1:if(p=x.type,j=x.stateNode,(x.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||j!==null&&typeof j.componentDidCatch=="function"&&(yi===null||!yi.has(j))))return x.flags|=65536,k&=-k,x.lanes|=k,k=Ll(k),ms(k,l,x,A),Mh(x,k),!1}x=x.return}while(x!==null);return!1}var Yd=Error(T(461)),ss=!1;function Ls(l,p,x,A){p.child=l===null?nm(p,null,x,A):Rl(p,l.child,x,A)}function va(l,p,x,A,k){x=x.render;var j=p.ref;if("ref"in A){var oe={};for(var Ie in A)Ie!=="ref"&&(oe[Ie]=A[Ie])}else oe=A;return ic(p),A=Iu(l,p,x,oe,j,k),Ie=Vf(),l!==null&&!ss?(Gf(l,p,k),al(l,p,k)):(Zn&&Ie&&Td(p),p.flags|=1,Ls(l,p,A,k),p.child)}function sl(l,p,x,A,k){if(l===null){var j=x.type;return typeof j=="function"&&!Kl(j)&&j.defaultProps===void 0&&x.compare===null?(p.tag=15,p.type=j,Ou(l,p,j,A,k)):(l=mu(x.type,null,A,p,p.mode,k),l.ref=p.ref,l.return=p,p.child=l)}if(j=l.child,!Bu(l,k)){var oe=j.memoizedProps;if(x=x.compare,x=x!==null?x:ea,x(oe,A)&&l.ref===p.ref)return al(l,p,k)}return p.flags|=1,l=ko(j,A),l.ref=p.ref,l.return=p,p.child=l}function Ou(l,p,x,A,k){if(l!==null){var j=l.memoizedProps;if(ea(j,A)&&l.ref===p.ref)if(ss=!1,p.pendingProps=A=j,Bu(l,k))(l.flags&131072)!==0&&(ss=!0);else return p.lanes=l.lanes,al(l,p,k)}return Bh(l,p,x,A,k)}function Pu(l,p,x,A){var k=A.children,j=l!==null?l.memoizedState:null;if(l===null&&p.stateNode===null&&(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),A.mode==="hidden"){if((p.flags&128)!==0){if(j=j!==null?j.baseLanes|x:x,l!==null){for(A=p.child=l.child,k=0;A!==null;)k=k|A.lanes|A.childLanes,A=A.sibling;A=k&~j}else A=0,p.child=null;return np(l,p,j,x,A)}if((x&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},l!==null&&Ah(p,j!==null?j.cachePool:null),j!==null?kd(p,j):Su(),Bd(p);else return A=p.lanes=536870912,np(l,p,j!==null?j.baseLanes|x:x,x,A)}else j!==null?(Ah(p,j.cachePool),kd(p,j),co(),p.memoizedState=null):(l!==null&&Ah(p,null),Su(),co());return Ls(l,p,k,x),p.child}function zu(l,p){return l!==null&&l.tag===22||p.stateNode!==null||(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.sibling}function np(l,p,x,A,k){var j=Md();return j=j===null?null:{parent:ar._currentValue,pool:j},p.memoizedState={baseLanes:x,cachePool:j},l!==null&&Ah(p,null),Su(),Bd(p),l!==null&&zc(l,p,A,!0),p.childLanes=k,null}function ol(l,p){return p=jh({mode:p.mode,children:p.children},l.mode),p.ref=l.ref,l.child=p,p.return=l,p}function rp(l,p,x){return Rl(p,l.child,null,x),l=ol(p,p.pendingProps),l.flags|=2,ia(p),p.memoizedState=null,l}function xa(l,p,x){var A=p.pendingProps,k=(p.flags&128)!==0;if(p.flags&=-129,l===null){if(Zn){if(A.mode==="hidden")return l=ol(p,A),p.lanes=536870912,zu(null,l);if(Eu(p),(l=wr)?(l=Nv(l,_a),l=l!==null&&l.data==="&"?l:null,l!==null&&(p.memoizedState={dehydrated:l,treeContext:zn!==null?{id:El,overflow:Xa}:null,retryLane:536870912,hydrationErrors:null},x=Cg(l),x.return=p,p.child=x,fs=p,wr=null)):l=null,l===null)throw Ka(p);return p.lanes=536870912,null}return ol(p,A)}var j=l.memoizedState;if(j!==null){var oe=j.dehydrated;if(Eu(p),k)if(p.flags&256)p.flags&=-257,p=rp(l,p,x);else if(p.memoizedState!==null)p.child=l.child,p.flags|=128,p=null;else throw Error(T(558));else if(ss||zc(l,p,x,!1),k=(x&l.childLanes)!==0,ss||k){if(A=Be,A!==null&&(oe=vr(A,x),oe!==0&&oe!==j.retryLane))throw j.retryLane=oe,zt(l,oe),Di(A,l,oe),Yd;Ys(),p=rp(l,p,x)}else l=j.treeContext,wr=Nl(oe.nextSibling),fs=p,Zn=!0,Al=null,_a=!1,l!==null&&gu(p,l),p=ol(p,A),p.flags|=4096;return p}return l=ko(l.child,{mode:A.mode,children:A.children}),l.ref=p.ref,p.child=l,l.return=p,l}function $c(l,p){var x=p.ref;if(x===null)l!==null&&l.ref!==null&&(p.flags|=4194816);else{if(typeof x!="function"&&typeof x!="object")throw Error(T(284));(l===null||l.ref!==x)&&(p.flags|=4194816)}}function Bh(l,p,x,A,k){return ic(p),x=Iu(l,p,x,A,void 0,k),A=Vf(),l!==null&&!ss?(Gf(l,p,k),al(l,p,k)):(Zn&&A&&Td(p),p.flags|=1,Ls(l,p,x,k),p.child)}function Kd(l,p,x,A,k,j){return ic(p),p.updateQueue=null,x=sm(p,A,x,k),tl(l),A=Vf(),l!==null&&!ss?(Gf(l,p,j),al(l,p,j)):(Zn&&A&&Td(p),p.flags|=1,Ls(l,p,x,j),p.child)}function Jd(l,p,x,A,k){if(ic(p),p.stateNode===null){var j=Tl,oe=x.contextType;typeof oe=="object"&&oe!==null&&(j=Zs(oe)),j=new x(A,j),p.memoizedState=j.state!==null&&j.state!==void 0?j.state:null,j.updater=ip,p.stateNode=j,j._reactInternals=p,j=p.stateNode,j.props=A,j.state=p.memoizedState,j.refs={},Ld(p),oe=x.contextType,j.context=typeof oe=="object"&&oe!==null?Zs(oe):Tl,j.state=p.memoizedState,oe=x.getDerivedStateFromProps,typeof oe=="function"&&(tp(p,x,oe,A),j.state=p.memoizedState),typeof x.getDerivedStateFromProps=="function"||typeof j.getSnapshotBeforeUpdate=="function"||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(oe=j.state,typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount(),oe!==j.state&&ip.enqueueReplaceState(j,j.state,null),lc(p,A,j,k),bu(),j.state=p.memoizedState),typeof j.componentDidMount=="function"&&(p.flags|=4194308),A=!0}else if(l===null){j=p.stateNode;var Ie=p.memoizedProps,et=sa(x,Ie);j.props=et;var Ot=j.context,Xt=x.contextType;oe=Tl,typeof Xt=="object"&&Xt!==null&&(oe=Zs(Xt));var ti=x.getDerivedStateFromProps;Xt=typeof ti=="function"||typeof j.getSnapshotBeforeUpdate=="function",Ie=p.pendingProps!==Ie,Xt||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(Ie||Ot!==oe)&&ym(p,j,A,oe),Bo=!1;var Lt=p.memoizedState;j.state=Lt,lc(p,A,j,k),bu(),Ot=p.memoizedState,Ie||Lt!==Ot||Bo?(typeof ti=="function"&&(tp(p,x,ti,A),Ot=p.memoizedState),(et=Bo||fo(p,x,et,A,Lt,Ot,oe))?(Xt||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount()),typeof j.componentDidMount=="function"&&(p.flags|=4194308)):(typeof j.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=A,p.memoizedState=Ot),j.props=A,j.state=Ot,j.context=oe,A=et):(typeof j.componentDidMount=="function"&&(p.flags|=4194308),A=!1)}else{j=p.stateNode,Rh(l,p),oe=p.memoizedProps,Xt=sa(x,oe),j.props=Xt,ti=p.pendingProps,Lt=j.context,Ot=x.contextType,et=Tl,typeof Ot=="object"&&Ot!==null&&(et=Zs(Ot)),Ie=x.getDerivedStateFromProps,(Ot=typeof Ie=="function"||typeof j.getSnapshotBeforeUpdate=="function")||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(oe!==ti||Lt!==et)&&ym(p,j,A,et),Bo=!1,Lt=p.memoizedState,j.state=Lt,lc(p,A,j,k),bu();var Vt=p.memoizedState;oe!==ti||Lt!==Vt||Bo||l!==null&&l.dependencies!==null&&xh(l.dependencies)?(typeof Ie=="function"&&(tp(p,x,Ie,A),Vt=p.memoizedState),(Xt=Bo||fo(p,x,Xt,A,Lt,Vt,et)||l!==null&&l.dependencies!==null&&xh(l.dependencies))?(Ot||typeof j.UNSAFE_componentWillUpdate!="function"&&typeof j.componentWillUpdate!="function"||(typeof j.componentWillUpdate=="function"&&j.componentWillUpdate(A,Vt,et),typeof j.UNSAFE_componentWillUpdate=="function"&&j.UNSAFE_componentWillUpdate(A,Vt,et)),typeof j.componentDidUpdate=="function"&&(p.flags|=4),typeof j.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof j.componentDidUpdate!="function"||oe===l.memoizedProps&&Lt===l.memoizedState||(p.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||oe===l.memoizedProps&&Lt===l.memoizedState||(p.flags|=1024),p.memoizedProps=A,p.memoizedState=Vt),j.props=A,j.state=Vt,j.context=et,A=Xt):(typeof j.componentDidUpdate!="function"||oe===l.memoizedProps&&Lt===l.memoizedState||(p.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||oe===l.memoizedProps&&Lt===l.memoizedState||(p.flags|=1024),A=!1)}return j=A,$c(l,p),A=(p.flags&128)!==0,j||A?(j=p.stateNode,x=A&&typeof x.getDerivedStateFromError!="function"?null:j.render(),p.flags|=1,l!==null&&A?(p.child=Rl(p,l.child,null,k),p.child=Rl(p,null,x,k)):Ls(l,p,x,k),p.memoizedState=j.state,l=p.child):l=al(l,p,k),l}function Kr(l,p,x,A){return Ja(),p.flags|=256,Ls(l,p,x,A),p.child}var Lu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Zc(l){return{baseLanes:l,cachePool:yu()}}function Fh(l,p,x){return l=l!==null?l.childLanes&~x:0,p&&(l|=Et),l}function Wc(l,p,x){var A=p.pendingProps,k=!1,j=(p.flags&128)!==0,oe;if((oe=j)||(oe=l!==null&&l.memoizedState===null?!1:(ps.current&2)!==0),oe&&(k=!0,p.flags&=-129),oe=(p.flags&32)!==0,p.flags&=-33,l===null){if(Zn){if(k?el(p):co(),(l=wr)?(l=Nv(l,_a),l=l!==null&&l.data!=="&"?l:null,l!==null&&(p.memoizedState={dehydrated:l,treeContext:zn!==null?{id:El,overflow:Xa}:null,retryLane:536870912,hydrationErrors:null},x=Cg(l),x.return=p,p.child=x,fs=p,wr=null)):l=null,l===null)throw Ka(p);return ly(l)?p.lanes=32:p.lanes=536870912,null}var Ie=A.children;return A=A.fallback,k?(co(),k=p.mode,Ie=jh({mode:"hidden",children:Ie},k),A=Dc(A,k,x,null),Ie.return=p,A.return=p,Ie.sibling=A,p.child=Ie,A=p.child,A.memoizedState=Zc(x),A.childLanes=Fh(l,oe,x),p.memoizedState=Lu,zu(null,A)):(el(p),Nh(p,Ie))}var et=l.memoizedState;if(et!==null&&(Ie=et.dehydrated,Ie!==null)){if(j)p.flags&256?(el(p),p.flags&=-257,p=ku(l,p,x)):p.memoizedState!==null?(co(),p.child=l.child,p.flags|=128,p=null):(co(),Ie=A.fallback,k=p.mode,A=jh({mode:"visible",children:A.children},k),Ie=Dc(Ie,k,x,null),Ie.flags|=2,A.return=p,Ie.return=p,A.sibling=Ie,p.child=A,Rl(p,l.child,null,x),A=p.child,A.memoizedState=Zc(x),A.childLanes=Fh(l,oe,x),p.memoizedState=Lu,p=zu(null,A));else if(el(p),ly(Ie)){if(oe=Ie.nextSibling&&Ie.nextSibling.dataset,oe)var Ot=oe.dgst;oe=Ot,A=Error(T(419)),A.stack="",A.digest=oe,vh({value:A,source:null,stack:null}),p=ku(l,p,x)}else if(ss||zc(l,p,x,!1),oe=(x&l.childLanes)!==0,ss||oe){if(oe=Be,oe!==null&&(A=vr(oe,x),A!==0&&A!==et.retryLane))throw et.retryLane=A,zt(l,A),Di(oe,l,A),Yd;ay(Ie)||Ys(),p=ku(l,p,x)}else ay(Ie)?(p.flags|=192,p.child=l.child,p=null):(l=et.treeContext,wr=Nl(Ie.nextSibling),fs=p,Zn=!0,Al=null,_a=!1,l!==null&&gu(p,l),p=Nh(p,A.children),p.flags|=4096);return p}return k?(co(),Ie=A.fallback,k=p.mode,et=l.child,Ot=et.sibling,A=ko(et,{mode:"hidden",children:A.children}),A.subtreeFlags=et.subtreeFlags&65011712,Ot!==null?Ie=ko(Ot,Ie):(Ie=Dc(Ie,k,x,null),Ie.flags|=2),Ie.return=p,A.return=p,A.sibling=Ie,p.child=A,zu(null,A),A=p.child,Ie=l.child.memoizedState,Ie===null?Ie=Zc(x):(k=Ie.cachePool,k!==null?(et=ar._currentValue,k=k.parent!==et?{parent:et,pool:et}:k):k=yu(),Ie={baseLanes:Ie.baseLanes|x,cachePool:k}),A.memoizedState=Ie,A.childLanes=Fh(l,oe,x),p.memoizedState=Lu,zu(l.child,A)):(el(p),x=l.child,l=x.sibling,x=ko(x,{mode:"visible",children:A.children}),x.return=p,x.sibling=null,l!==null&&(oe=p.deletions,oe===null?(p.deletions=[l],p.flags|=16):oe.push(l)),p.child=x,p.memoizedState=null,x)}function Nh(l,p){return p=jh({mode:"visible",children:p},l.mode),p.return=l,l.child=p}function jh(l,p){return l=Lo(22,l,null,p),l.lanes=0,l}function ku(l,p,x){return Rl(p,l.child,null,x),l=Nh(p,p.pendingProps.children),l.flags|=2,p.memoizedState=null,l}function Xc(l,p,x){l.lanes|=p;var A=l.alternate;A!==null&&(A.lanes|=p),em(l.return,p,x)}function Qd(l,p,x,A,k,j){var oe=l.memoizedState;oe===null?l.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:A,tail:x,tailMode:k,treeForkCount:j}:(oe.isBackwards=p,oe.rendering=null,oe.renderingStartTime=0,oe.last=A,oe.tail=x,oe.tailMode=k,oe.treeForkCount=j)}function Uh(l,p,x){var A=p.pendingProps,k=A.revealOrder,j=A.tail;A=A.children;var oe=ps.current,Ie=(oe&2)!==0;if(Ie?(oe=oe&1|2,p.flags|=128):oe&=1,bt(ps,oe),Ls(l,p,A,x),A=Zn?bd:0,!Ie&&l!==null&&(l.flags&128)!==0)e:for(l=p.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&Xc(l,x,p);else if(l.tag===19)Xc(l,x,p);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===p)break e;for(;l.sibling===null;){if(l.return===null||l.return===p)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}switch(k){case"forwards":for(x=p.child,k=null;x!==null;)l=x.alternate,l!==null&&Ol(l)===null&&(k=x),x=x.sibling;x=k,x===null?(k=p.child,p.child=null):(k=x.sibling,x.sibling=null),Qd(p,!1,k,x,j,A);break;case"backwards":case"unstable_legacy-backwards":for(x=null,k=p.child,p.child=null;k!==null;){if(l=k.alternate,l!==null&&Ol(l)===null){p.child=k;break}l=k.sibling,k.sibling=x,x=k,k=l}Qd(p,!0,x,null,j,A);break;case"together":Qd(p,!1,null,null,void 0,A);break;default:p.memoizedState=null}return p.child}function al(l,p,x){if(l!==null&&(p.dependencies=l.dependencies),St|=p.lanes,(x&p.childLanes)===0)if(l!==null){if(zc(l,p,x,!1),(x&p.childLanes)===0)return null}else return null;if(l!==null&&p.child!==l.child)throw Error(T(153));if(p.child!==null){for(l=p.child,x=ko(l,l.pendingProps),p.child=x,x.return=p;l.sibling!==null;)l=l.sibling,x=x.sibling=ko(l,l.pendingProps),x.return=p;x.sibling=null}return p.child}function Bu(l,p){return(l.lanes&p)!==0?!0:(l=l.dependencies,!!(l!==null&&xh(l)))}function vm(l,p,x){switch(p.tag){case 3:Ii(p,p.stateNode.containerInfo),Pc(p,ar,l.memoizedState.cache),Ja();break;case 27:case 5:Ri(p);break;case 4:Ii(p,p.stateNode.containerInfo);break;case 10:Pc(p,p.type,p.memoizedProps.value);break;case 31:if(p.memoizedState!==null)return p.flags|=128,Eu(p),null;break;case 13:var A=p.memoizedState;if(A!==null)return A.dehydrated!==null?(el(p),p.flags|=128,null):(x&p.child.childLanes)!==0?Wc(l,p,x):(el(p),l=al(l,p,x),l!==null?l.sibling:null);el(p);break;case 19:var k=(l.flags&128)!==0;if(A=(x&p.childLanes)!==0,A||(zc(l,p,x,!1),A=(x&p.childLanes)!==0),k){if(A)return Uh(l,p,x);p.flags|=128}if(k=p.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),bt(ps,ps.current),A)break;return null;case 22:return p.lanes=0,Pu(l,p,x,p.pendingProps);case 24:Pc(p,ar,l.memoizedState.cache)}return al(l,p,x)}function ef(l,p,x){if(l!==null)if(l.memoizedProps!==p.pendingProps)ss=!0;else{if(!Bu(l,x)&&(p.flags&128)===0)return ss=!1,vm(l,p,x);ss=(l.flags&131072)!==0}else ss=!1,Zn&&(p.flags&1048576)!==0&&wd(p,bd,p.index);switch(p.lanes=0,p.tag){case 16:e:{var A=p.pendingProps;if(l=Il(p.elementType),p.type=l,typeof l=="function")Kl(l)?(A=sa(l,A),p.tag=1,p=Jd(null,p,l,A,x)):(p.tag=0,p=Bh(null,p,l,A,x));else{if(l!=null){var k=l.$$typeof;if(k===rt){p.tag=11,p=va(null,p,l,A,x);break e}else if(k===Tt){p.tag=14,p=sl(null,p,l,A,x);break e}}throw p=Ji(l)||l,Error(T(306,p,""))}}return p;case 0:return Bh(l,p,p.type,p.pendingProps,x);case 1:return A=p.type,k=sa(A,p.pendingProps),Jd(l,p,A,k,x);case 3:e:{if(Ii(p,p.stateNode.containerInfo),l===null)throw Error(T(387));A=p.pendingProps;var j=p.memoizedState;k=j.element,Rh(l,p),lc(p,A,null,x);var oe=p.memoizedState;if(A=oe.cache,Pc(p,ar,A),A!==j.cache&&Ed(p,[ar],x,!0),bu(),A=oe.element,j.isDehydrated)if(j={element:A,isDehydrated:!1,cache:oe.cache},p.updateQueue.baseState=j,p.memoizedState=j,p.flags&256){p=Kr(l,p,A,x);break e}else if(A!==k){k=zs(Error(T(424)),p),vh(k),p=Kr(l,p,A,x);break e}else{switch(l=p.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(wr=Nl(l.firstChild),fs=p,Zn=!0,Al=null,_a=!0,x=nm(p,null,A,x),p.child=x;x;)x.flags=x.flags&-3|4096,x=x.sibling}else{if(Ja(),A===k){p=al(l,p,x);break e}Ls(l,p,A,x)}p=p.child}return p;case 26:return $c(l,p),l===null?(x=Qc(p.type,null,p.pendingProps,null))?p.memoizedState=x:Zn||(x=p.type,l=p.pendingProps,A=zm(Bi.current).createElement(x),A[Me]=p,A[_e]=l,Vo(A,x,l),li(A),p.stateNode=A):p.memoizedState=Qc(p.type,l.memoizedProps,p.pendingProps,l.memoizedState),null;case 27:return Ri(p),l===null&&Zn&&(A=p.stateNode=dp(p.type,p.pendingProps,Bi.current),fs=p,_a=!0,k=wr,hl(p.type)?(Lm=k,wr=Nl(A.firstChild)):wr=k),Ls(l,p,p.pendingProps.children,x),$c(l,p),l===null&&(p.flags|=4194304),p.child;case 5:return l===null&&Zn&&((k=A=wr)&&(A=Kx(A,p.type,p.pendingProps,_a),A!==null?(p.stateNode=A,fs=p,wr=Nl(A.firstChild),_a=!1,k=!0):k=!1),k||Ka(p)),Ri(p),k=p.type,j=p.pendingProps,oe=l!==null?l.memoizedProps:null,A=j.children,Jc(k,j)?A=null:oe!==null&&Jc(k,oe)&&(p.flags|=32),p.memoizedState!==null&&(k=Iu(l,p,Dg,null,null,x),Ul._currentValue=k),$c(l,p),Ls(l,p,A,x),p.child;case 6:return l===null&&Zn&&((l=x=wr)&&(x=Jx(x,p.pendingProps,_a),x!==null?(p.stateNode=x,fs=p,wr=null,l=!0):l=!1),l||Ka(p)),null;case 13:return Wc(l,p,x);case 4:return Ii(p,p.stateNode.containerInfo),A=p.pendingProps,l===null?p.child=Rl(p,null,A,x):Ls(l,p,A,x),p.child;case 11:return va(l,p,p.type,p.pendingProps,x);case 7:return Ls(l,p,p.pendingProps,x),p.child;case 8:return Ls(l,p,p.pendingProps.children,x),p.child;case 12:return Ls(l,p,p.pendingProps.children,x),p.child;case 10:return A=p.pendingProps,Pc(p,p.type,A.value),Ls(l,p,A.children,x),p.child;case 9:return k=p.type._context,A=p.pendingProps.children,ic(p),k=Zs(k),A=A(k),p.flags|=1,Ls(l,p,A,x),p.child;case 14:return sl(l,p,p.type,p.pendingProps,x);case 15:return Ou(l,p,p.type,p.pendingProps,x);case 19:return Uh(l,p,x);case 31:return xa(l,p,x);case 22:return Pu(l,p,x,p.pendingProps);case 24:return ic(p),A=Zs(ar),l===null?(k=Md(),k===null&&(k=Be,j=wh(),k.pooledCache=j,j.refCount++,j!==null&&(k.pooledCacheLanes|=x),k=j),p.memoizedState={parent:A,cache:k},Ld(p),Pc(p,ar,k)):((l.lanes&x)!==0&&(Rh(l,p),lc(p,null,null,x),bu()),k=l.memoizedState,j=p.memoizedState,k.parent!==A?(k={parent:A,cache:A},p.memoizedState=k,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=k),Pc(p,ar,A)):(A=j.cache,Pc(p,ar,A),A!==k.cache&&Ed(p,[ar],x,!0))),Ls(l,p,p.pendingProps.children,x),p.child;case 29:throw p.pendingProps}throw Error(T(156,p.tag))}function kl(l){l.flags|=4}function sp(l,p,x,A,k){if((p=(l.mode&32)!==0)&&(p=!1),p){if(l.flags|=16777216,(k&335544128)===k)if(l.stateNode.complete)l.flags|=8192;else if(mn())l.flags|=8192;else throw oc=Od,tm}else l.flags&=-16777217}function xm(l,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!yy(p))if(mn())l.flags|=8192;else throw oc=Od,tm}function tf(l,p){p!==null&&(l.flags|=4),l.flags&16384&&(p=l.tag!==22?In():536870912,l.lanes|=p,ei|=p)}function Vh(l,p){if(!Zn)switch(l.tailMode){case"hidden":p=l.tail;for(var x=null;p!==null;)p.alternate!==null&&(x=p),p=p.sibling;x===null?l.tail=null:x.sibling=null;break;case"collapsed":x=l.tail;for(var A=null;x!==null;)x.alternate!==null&&(A=x),x=x.sibling;A===null?p||l.tail===null?l.tail=null:l.tail.sibling=null:A.sibling=null}}function qr(l){var p=l.alternate!==null&&l.alternate.child===l.child,x=0,A=0;if(p)for(var k=l.child;k!==null;)x|=k.lanes|k.childLanes,A|=k.subtreeFlags&65011712,A|=k.flags&65011712,k.return=l,k=k.sibling;else for(k=l.child;k!==null;)x|=k.lanes|k.childLanes,A|=k.subtreeFlags,A|=k.flags,k.return=l,k=k.sibling;return l.subtreeFlags|=A,l.childLanes=x,p}function nf(l,p,x){var A=p.pendingProps;switch(Ql(p),p.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qr(p),null;case 1:return qr(p),null;case 3:return x=p.stateNode,A=null,l!==null&&(A=l.memoizedState.cache),p.memoizedState.cache!==A&&(p.flags|=2048),tc(ar),fi(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(l===null||l.child===null)&&(ec(p)?kl(p):l===null||l.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,Ff())),qr(p),null;case 26:var k=p.type,j=p.memoizedState;return l===null?(kl(p),j!==null?(qr(p),xm(p,j)):(qr(p),sp(p,k,null,A,x))):j?j!==l.memoizedState?(kl(p),qr(p),xm(p,j)):(qr(p),p.flags&=-16777217):(l=l.memoizedProps,l!==A&&kl(p),qr(p),sp(p,k,l,A,x)),null;case 27:if(Fi(p),x=Bi.current,k=p.type,l!==null&&p.stateNode!=null)l.memoizedProps!==A&&kl(p);else{if(!A){if(p.stateNode===null)throw Error(T(166));return qr(p),null}l=Gt.current,ec(p)?Sd(p):(l=dp(k,A,x),p.stateNode=l,kl(p))}return qr(p),null;case 5:if(Fi(p),k=p.type,l!==null&&p.stateNode!=null)l.memoizedProps!==A&&kl(p);else{if(!A){if(p.stateNode===null)throw Error(T(166));return qr(p),null}if(j=Gt.current,ec(p))Sd(p);else{var oe=zm(Bi.current);switch(j){case 1:j=oe.createElementNS("http://www.w3.org/2000/svg",k);break;case 2:j=oe.createElementNS("http://www.w3.org/1998/Math/MathML",k);break;default:switch(k){case"svg":j=oe.createElementNS("http://www.w3.org/2000/svg",k);break;case"math":j=oe.createElementNS("http://www.w3.org/1998/Math/MathML",k);break;case"script":j=oe.createElement("div"),j.innerHTML="<script><\/script>",j=j.removeChild(j.firstChild);break;case"select":j=typeof A.is=="string"?oe.createElement("select",{is:A.is}):oe.createElement("select"),A.multiple?j.multiple=!0:A.size&&(j.size=A.size);break;default:j=typeof A.is=="string"?oe.createElement(k,{is:A.is}):oe.createElement(k)}}j[Me]=p,j[_e]=A;e:for(oe=p.child;oe!==null;){if(oe.tag===5||oe.tag===6)j.appendChild(oe.stateNode);else if(oe.tag!==4&&oe.tag!==27&&oe.child!==null){oe.child.return=oe,oe=oe.child;continue}if(oe===p)break e;for(;oe.sibling===null;){if(oe.return===null||oe.return===p)break e;oe=oe.return}oe.sibling.return=oe.return,oe=oe.sibling}p.stateNode=j;e:switch(Vo(j,k,A),k){case"button":case"input":case"select":case"textarea":A=!!A.autoFocus;break e;case"img":A=!0;break e;default:A=!1}A&&kl(p)}}return qr(p),sp(p,p.type,l===null?null:l.memoizedProps,p.pendingProps,x),null;case 6:if(l&&p.stateNode!=null)l.memoizedProps!==A&&kl(p);else{if(typeof A!="string"&&p.stateNode===null)throw Error(T(166));if(l=Bi.current,ec(p)){if(l=p.stateNode,x=p.memoizedProps,A=null,k=fs,k!==null)switch(k.tag){case 27:case 5:A=k.memoizedProps}l[Me]=p,l=!!(l.nodeValue===x||A!==null&&A.suppressHydrationWarning===!0||zv(l.nodeValue,x)),l||Ka(p,!0)}else l=zm(l).createTextNode(A),l[Me]=p,p.stateNode=l}return qr(p),null;case 31:if(x=p.memoizedState,l===null||l.memoizedState!==null){if(A=ec(p),x!==null){if(l===null){if(!A)throw Error(T(318));if(l=p.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(T(557));l[Me]=p}else Ja(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;qr(p),l=!1}else x=Ff(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=x),l=!0;if(!l)return p.flags&256?(ia(p),p):(ia(p),null);if((p.flags&128)!==0)throw Error(T(558))}return qr(p),null;case 13:if(A=p.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(k=ec(p),A!==null&&A.dehydrated!==null){if(l===null){if(!k)throw Error(T(318));if(k=p.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(T(317));k[Me]=p}else Ja(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;qr(p),k=!1}else k=Ff(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=k),k=!0;if(!k)return p.flags&256?(ia(p),p):(ia(p),null)}return ia(p),(p.flags&128)!==0?(p.lanes=x,p):(x=A!==null,l=l!==null&&l.memoizedState!==null,x&&(A=p.child,k=null,A.alternate!==null&&A.alternate.memoizedState!==null&&A.alternate.memoizedState.cachePool!==null&&(k=A.alternate.memoizedState.cachePool.pool),j=null,A.memoizedState!==null&&A.memoizedState.cachePool!==null&&(j=A.memoizedState.cachePool.pool),j!==k&&(A.flags|=2048)),x!==l&&x&&(p.child.flags|=8192),tf(p,p.updateQueue),qr(p),null);case 4:return fi(),l===null&&jg(p.stateNode.containerInfo),qr(p),null;case 10:return tc(p.type),qr(p),null;case 19:if(wt(ps),A=p.memoizedState,A===null)return qr(p),null;if(k=(p.flags&128)!==0,j=A.rendering,j===null)if(k)Vh(A,!1);else{if(lt!==0||l!==null&&(l.flags&128)!==0)for(l=p.child;l!==null;){if(j=Ol(l),j!==null){for(p.flags|=128,Vh(A,!1),l=j.updateQueue,p.updateQueue=l,tf(p,l),p.subtreeFlags=0,l=x,x=p.child;x!==null;)Jl(x,l),x=x.sibling;return bt(ps,ps.current&1|2),Zn&&Ya(p,A.treeForkCount),p.child}l=l.sibling}A.tail!==null&&tr()>Pi&&(p.flags|=128,k=!0,Vh(A,!1),p.lanes=4194304)}else{if(!k)if(l=Ol(j),l!==null){if(p.flags|=128,k=!0,l=l.updateQueue,p.updateQueue=l,tf(p,l),Vh(A,!0),A.tail===null&&A.tailMode==="hidden"&&!j.alternate&&!Zn)return qr(p),null}else 2*tr()-A.renderingStartTime>Pi&&x!==536870912&&(p.flags|=128,k=!0,Vh(A,!1),p.lanes=4194304);A.isBackwards?(j.sibling=p.child,p.child=j):(l=A.last,l!==null?l.sibling=j:p.child=j,A.last=j)}return A.tail!==null?(l=A.tail,A.rendering=l,A.tail=l.sibling,A.renderingStartTime=tr(),l.sibling=null,x=ps.current,bt(ps,k?x&1|2:x&1),Zn&&Ya(p,A.treeForkCount),l):(qr(p),null);case 22:case 23:return ia(p),Dl(),A=p.memoizedState!==null,l!==null?l.memoizedState!==null!==A&&(p.flags|=8192):A&&(p.flags|=8192),A?(x&536870912)!==0&&(p.flags&128)===0&&(qr(p),p.subtreeFlags&6&&(p.flags|=8192)):qr(p),x=p.updateQueue,x!==null&&tf(p,x.retryQueue),x=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(x=l.memoizedState.cachePool.pool),A=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(A=p.memoizedState.cachePool.pool),A!==x&&(p.flags|=2048),l!==null&&wt(sc),null;case 24:return x=null,l!==null&&(x=l.memoizedState.cache),p.memoizedState.cache!==x&&(p.flags|=2048),tc(ar),qr(p),null;case 25:return null;case 30:return null}throw Error(T(156,p.tag))}function Bg(l,p){switch(Ql(p),p.tag){case 1:return l=p.flags,l&65536?(p.flags=l&-65537|128,p):null;case 3:return tc(ar),fi(),l=p.flags,(l&65536)!==0&&(l&128)===0?(p.flags=l&-65537|128,p):null;case 26:case 27:case 5:return Fi(p),null;case 31:if(p.memoizedState!==null){if(ia(p),p.alternate===null)throw Error(T(340));Ja()}return l=p.flags,l&65536?(p.flags=l&-65537|128,p):null;case 13:if(ia(p),l=p.memoizedState,l!==null&&l.dehydrated!==null){if(p.alternate===null)throw Error(T(340));Ja()}return l=p.flags,l&65536?(p.flags=l&-65537|128,p):null;case 19:return wt(ps),null;case 4:return fi(),null;case 10:return tc(p.type),null;case 22:case 23:return ia(p),Dl(),l!==null&&wt(sc),l=p.flags,l&65536?(p.flags=l&-65537|128,p):null;case 24:return tc(ar),null;case 25:return null;default:return null}}function bm(l,p){switch(Ql(p),p.tag){case 3:tc(ar),fi();break;case 26:case 27:case 5:Fi(p);break;case 4:fi();break;case 31:p.memoizedState!==null&&ia(p);break;case 13:ia(p);break;case 19:wt(ps);break;case 10:tc(p.type);break;case 22:case 23:ia(p),Dl(),l!==null&&wt(sc);break;case 24:tc(ar)}}function dc(l,p){try{var x=p.updateQueue,A=x!==null?x.lastEffect:null;if(A!==null){var k=A.next;x=k;do{if((x.tag&l)===l){A=void 0;var j=x.create,oe=x.inst;A=j(),oe.destroy=A}x=x.next}while(x!==k)}}catch(Ie){Hn(p,p.return,Ie)}}function fc(l,p,x){try{var A=p.updateQueue,k=A!==null?A.lastEffect:null;if(k!==null){var j=k.next;A=j;do{if((A.tag&l)===l){var oe=A.inst,Ie=oe.destroy;if(Ie!==void 0){oe.destroy=void 0,k=p;var et=x,Ot=Ie;try{Ot()}catch(Xt){Hn(k,et,Xt)}}}A=A.next}while(A!==j)}}catch(Xt){Hn(p,p.return,Xt)}}function op(l){var p=l.updateQueue;if(p!==null){var x=l.stateNode;try{Mg(p,x)}catch(A){Hn(l,l.return,A)}}}function wm(l,p,x){x.props=sa(l.type,l.memoizedProps),x.state=l.memoizedState;try{x.componentWillUnmount()}catch(A){Hn(l,p,A)}}function Gh(l,p){try{var x=l.ref;if(x!==null){switch(l.tag){case 26:case 27:case 5:var A=l.stateNode;break;case 30:A=l.stateNode;break;default:A=l.stateNode}typeof x=="function"?l.refCleanup=x(A):x.current=A}}catch(k){Hn(l,p,k)}}function ll(l,p){var x=l.ref,A=l.refCleanup;if(x!==null)if(typeof A=="function")try{A()}catch(k){Hn(l,p,k)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof x=="function")try{x(null)}catch(k){Hn(l,p,k)}else x.current=null}function Tm(l){var p=l.type,x=l.memoizedProps,A=l.stateNode;try{e:switch(p){case"button":case"input":case"select":case"textarea":x.autoFocus&&A.focus();break e;case"img":x.src?A.src=x.src:x.srcSet&&(A.srcset=x.srcSet)}}catch(k){Hn(l,l.return,k)}}function Wn(l,p,x){try{var A=l.stateNode;Lv(A,l.type,x,p),A[_e]=p}catch(k){Hn(l,l.return,k)}}function Sm(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&hl(l.type)||l.tag===4}function ap(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||Sm(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&hl(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function Em(l,p,x){var A=l.tag;if(A===5||A===6)l=l.stateNode,p?(x.nodeType===9?x.body:x.nodeName==="HTML"?x.ownerDocument.body:x).insertBefore(l,p):(p=x.nodeType===9?x.body:x.nodeName==="HTML"?x.ownerDocument.body:x,p.appendChild(l),x=x._reactRootContainer,x!=null||p.onclick!==null||(p.onclick=ds));else if(A!==4&&(A===27&&hl(l.type)&&(x=l.stateNode,p=null),l=l.child,l!==null))for(Em(l,p,x),l=l.sibling;l!==null;)Em(l,p,x),l=l.sibling}function lp(l,p,x){var A=l.tag;if(A===5||A===6)l=l.stateNode,p?x.insertBefore(l,p):x.appendChild(l);else if(A!==4&&(A===27&&hl(l.type)&&(x=l.stateNode),l=l.child,l!==null))for(lp(l,p,x),l=l.sibling;l!==null;)lp(l,p,x),l=l.sibling}function qh(l){var p=l.stateNode,x=l.memoizedProps;try{for(var A=l.type,k=p.attributes;k.length;)p.removeAttributeNode(k[0]);Vo(p,A,x),p[Me]=l,p[_e]=x}catch(j){Hn(l,l.return,j)}}var Bl=!1,os=!1,Fu=!1,Na=typeof WeakSet=="function"?WeakSet:Set,Er=null;function Hr(l,p){if(l=l.containerInfo,Vg=Vm,l=Tg(l),hu(l)){if("selectionStart"in l)var x={start:l.selectionStart,end:l.selectionEnd};else e:{x=(x=l.ownerDocument)&&x.defaultView||window;var A=x.getSelection&&x.getSelection();if(A&&A.rangeCount!==0){x=A.anchorNode;var k=A.anchorOffset,j=A.focusNode;A=A.focusOffset;try{x.nodeType,j.nodeType}catch{x=null;break e}var oe=0,Ie=-1,et=-1,Ot=0,Xt=0,ti=l,Lt=null;t:for(;;){for(var Vt;ti!==x||k!==0&&ti.nodeType!==3||(Ie=oe+k),ti!==j||A!==0&&ti.nodeType!==3||(et=oe+A),ti.nodeType===3&&(oe+=ti.nodeValue.length),(Vt=ti.firstChild)!==null;)Lt=ti,ti=Vt;for(;;){if(ti===l)break t;if(Lt===x&&++Ot===k&&(Ie=oe),Lt===j&&++Xt===A&&(et=oe),(Vt=ti.nextSibling)!==null)break;ti=Lt,Lt=ti.parentNode}ti=Vt}x=Ie===-1||et===-1?null:{start:Ie,end:et}}else x=null}x=x||{start:0,end:0}}else x=null;for(Gg={focusedElem:l,selectionRange:x},Vm=!1,Er=p;Er!==null;)if(p=Er,l=p.child,(p.subtreeFlags&1028)!==0&&l!==null)l.return=p,Er=l;else for(;Er!==null;){switch(p=Er,j=p.alternate,l=p.flags,p.tag){case 0:if((l&4)!==0&&(l=p.updateQueue,l=l!==null?l.events:null,l!==null))for(x=0;x<l.length;x++)k=l[x],k.ref.impl=k.nextImpl;break;case 11:case 15:break;case 1:if((l&1024)!==0&&j!==null){l=void 0,x=p,k=j.memoizedProps,j=j.memoizedState,A=x.stateNode;try{var Vi=sa(x.type,k);l=A.getSnapshotBeforeUpdate(Vi,j),A.__reactInternalSnapshotBeforeUpdate=l}catch(nn){Hn(x,x.return,nn)}}break;case 3:if((l&1024)!==0){if(l=p.stateNode.containerInfo,x=l.nodeType,x===9)sf(l);else if(x===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":sf(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(T(163))}if(l=p.sibling,l!==null){l.return=p.return,Er=l;break}Er=p.return}}function oa(l,p,x){var A=x.flags;switch(x.tag){case 0:case 11:case 15:C(l,x),A&4&&dc(5,x);break;case 1:if(C(l,x),A&4)if(l=x.stateNode,p===null)try{l.componentDidMount()}catch(oe){Hn(x,x.return,oe)}else{var k=sa(x.type,p.memoizedProps);p=p.memoizedState;try{l.componentDidUpdate(k,p,l.__reactInternalSnapshotBeforeUpdate)}catch(oe){Hn(x,x.return,oe)}}A&64&&op(x),A&512&&Gh(x,x.return);break;case 3:if(C(l,x),A&64&&(l=x.updateQueue,l!==null)){if(p=null,x.child!==null)switch(x.child.tag){case 27:case 5:p=x.child.stateNode;break;case 1:p=x.child.stateNode}try{Mg(l,p)}catch(oe){Hn(x,x.return,oe)}}break;case 27:p===null&&A&4&&qh(x);case 26:case 5:C(l,x),p===null&&A&4&&Tm(x),A&512&&Gh(x,x.return);break;case 12:C(l,x);break;case 31:C(l,x),A&4&&K_(l,x);break;case 13:C(l,x),A&4&&c(l,x),A&64&&(l=x.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(x=Av.bind(null,x),Qx(l,x))));break;case 22:if(A=x.memoizedState!==null||Bl,!A){p=p!==null&&p.memoizedState!==null||os,k=Bl;var j=os;Bl=A,(os=p)&&!j?z(l,x,(x.subtreeFlags&8772)!==0):C(l,x),Bl=k,os=j}break;case 30:break;default:C(l,x)}}function Hh(l){var p=l.alternate;p!==null&&(l.alternate=null,Hh(p)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(p=l.stateNode,p!==null&&Zt(p)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var Lr=null,Fo=!1;function pc(l,p,x){for(x=x.child;x!==null;)Nu(l,p,x),x=x.sibling}function Nu(l,p,x){if($r&&typeof $r.onCommitFiberUnmount=="function")try{$r.onCommitFiberUnmount(Yo,x)}catch{}switch(x.tag){case 26:os||ll(x,p),pc(l,p,x),x.memoizedState?x.memoizedState.count--:x.stateNode&&(x=x.stateNode,x.parentNode.removeChild(x));break;case 27:os||ll(x,p);var A=Lr,k=Fo;hl(x.type)&&(Lr=x.stateNode,Fo=!1),pc(l,p,x),km(x.stateNode),Lr=A,Fo=k;break;case 5:os||ll(x,p);case 6:if(A=Lr,k=Fo,Lr=null,pc(l,p,x),Lr=A,Fo=k,Lr!==null)if(Fo)try{(Lr.nodeType===9?Lr.body:Lr.nodeName==="HTML"?Lr.ownerDocument.body:Lr).removeChild(x.stateNode)}catch(j){Hn(x,p,j)}else try{Lr.removeChild(x.stateNode)}catch(j){Hn(x,p,j)}break;case 18:Lr!==null&&(Fo?(l=Lr,oy(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,x.stateNode),yp(l)):oy(Lr,x.stateNode));break;case 4:A=Lr,k=Fo,Lr=x.stateNode.containerInfo,Fo=!0,pc(l,p,x),Lr=A,Fo=k;break;case 0:case 11:case 14:case 15:fc(2,x,p),os||fc(4,x,p),pc(l,p,x);break;case 1:os||(ll(x,p),A=x.stateNode,typeof A.componentWillUnmount=="function"&&wm(x,p,A)),pc(l,p,x);break;case 21:pc(l,p,x);break;case 22:os=(A=os)||x.memoizedState!==null,pc(l,p,x),os=A;break;default:pc(l,p,x)}}function K_(l,p){if(p.memoizedState===null&&(l=p.alternate,l!==null&&(l=l.memoizedState,l!==null))){l=l.dehydrated;try{yp(l)}catch(x){Hn(p,p.return,x)}}}function c(l,p){if(p.memoizedState===null&&(l=p.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{yp(l)}catch(x){Hn(p,p.return,x)}}function t(l){switch(l.tag){case 31:case 13:case 19:var p=l.stateNode;return p===null&&(p=l.stateNode=new Na),p;case 22:return l=l.stateNode,p=l._retryCache,p===null&&(p=l._retryCache=new Na),p;default:throw Error(T(435,l.tag))}}function o(l,p){var x=t(l);p.forEach(function(A){if(!x.has(A)){x.add(A);var k=Cv.bind(null,l,A);A.then(k,k)}})}function u(l,p){var x=p.deletions;if(x!==null)for(var A=0;A<x.length;A++){var k=x[A],j=l,oe=p,Ie=oe;e:for(;Ie!==null;){switch(Ie.tag){case 27:if(hl(Ie.type)){Lr=Ie.stateNode,Fo=!1;break e}break;case 5:Lr=Ie.stateNode,Fo=!1;break e;case 3:case 4:Lr=Ie.stateNode.containerInfo,Fo=!0;break e}Ie=Ie.return}if(Lr===null)throw Error(T(160));Nu(j,oe,k),Lr=null,Fo=!1,j=k.alternate,j!==null&&(j.return=null),k.return=null}if(p.subtreeFlags&13886)for(p=p.child;p!==null;)v(p,l),p=p.sibling}var g=null;function v(l,p){var x=l.alternate,A=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:u(p,l),b(l),A&4&&(fc(3,l,l.return),dc(3,l),fc(5,l,l.return));break;case 1:u(p,l),b(l),A&512&&(os||x===null||ll(x,x.return)),A&64&&Bl&&(l=l.updateQueue,l!==null&&(A=l.callbacks,A!==null&&(x=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=x===null?A:x.concat(A))));break;case 26:var k=g;if(u(p,l),b(l),A&512&&(os||x===null||ll(x,x.return)),A&4){var j=x!==null?x.memoizedState:null;if(A=l.memoizedState,x===null)if(A===null)if(l.stateNode===null){e:{A=l.type,x=l.memoizedProps,k=k.ownerDocument||k;t:switch(A){case"title":j=k.getElementsByTagName("title")[0],(!j||j[vt]||j[Me]||j.namespaceURI==="http://www.w3.org/2000/svg"||j.hasAttribute("itemprop"))&&(j=k.createElement(A),k.head.insertBefore(j,k.querySelector("head > title"))),Vo(j,A,x),j[Me]=l,li(j),A=j;break e;case"link":var oe=cf("link","href",k).get(A+(x.href||""));if(oe){for(var Ie=0;Ie<oe.length;Ie++)if(j=oe[Ie],j.getAttribute("href")===(x.href==null||x.href===""?null:x.href)&&j.getAttribute("rel")===(x.rel==null?null:x.rel)&&j.getAttribute("title")===(x.title==null?null:x.title)&&j.getAttribute("crossorigin")===(x.crossOrigin==null?null:x.crossOrigin)){oe.splice(Ie,1);break t}}j=k.createElement(A),Vo(j,A,x),k.head.appendChild(j);break;case"meta":if(oe=cf("meta","content",k).get(A+(x.content||""))){for(Ie=0;Ie<oe.length;Ie++)if(j=oe[Ie],j.getAttribute("content")===(x.content==null?null:""+x.content)&&j.getAttribute("name")===(x.name==null?null:x.name)&&j.getAttribute("property")===(x.property==null?null:x.property)&&j.getAttribute("http-equiv")===(x.httpEquiv==null?null:x.httpEquiv)&&j.getAttribute("charset")===(x.charSet==null?null:x.charSet)){oe.splice(Ie,1);break t}}j=k.createElement(A),Vo(j,A,x),k.head.appendChild(j);break;default:throw Error(T(468,A))}j[Me]=l,li(j),A=j}l.stateNode=A}else _y(k,l.type,l.stateNode);else l.stateNode=my(k,A,l.memoizedProps);else j!==A?(j===null?x.stateNode!==null&&(x=x.stateNode,x.parentNode.removeChild(x)):j.count--,A===null?_y(k,l.type,l.stateNode):my(k,A,l.memoizedProps)):A===null&&l.stateNode!==null&&Wn(l,l.memoizedProps,x.memoizedProps)}break;case 27:u(p,l),b(l),A&512&&(os||x===null||ll(x,x.return)),x!==null&&A&4&&Wn(l,l.memoizedProps,x.memoizedProps);break;case 5:if(u(p,l),b(l),A&512&&(os||x===null||ll(x,x.return)),l.flags&32){k=l.stateNode;try{vl(k,"")}catch(Vi){Hn(l,l.return,Vi)}}A&4&&l.stateNode!=null&&(k=l.memoizedProps,Wn(l,k,x!==null?x.memoizedProps:k)),A&1024&&(Fu=!0);break;case 6:if(u(p,l),b(l),A&4){if(l.stateNode===null)throw Error(T(162));A=l.memoizedProps,x=l.stateNode;try{x.nodeValue=A}catch(Vi){Hn(l,l.return,Vi)}}break;case 3:if(Qh=null,k=g,g=Bm(p.containerInfo),u(p,l),g=k,b(l),A&4&&x!==null&&x.memoizedState.isDehydrated)try{yp(p.containerInfo)}catch(Vi){Hn(l,l.return,Vi)}Fu&&(Fu=!1,E(l));break;case 4:A=g,g=Bm(l.stateNode.containerInfo),u(p,l),b(l),g=A;break;case 12:u(p,l),b(l);break;case 31:u(p,l),b(l),A&4&&(A=l.updateQueue,A!==null&&(l.updateQueue=null,o(l,A)));break;case 13:u(p,l),b(l),l.child.flags&8192&&l.memoizedState!==null!=(x!==null&&x.memoizedState!==null)&&(ai=tr()),A&4&&(A=l.updateQueue,A!==null&&(l.updateQueue=null,o(l,A)));break;case 22:k=l.memoizedState!==null;var et=x!==null&&x.memoizedState!==null,Ot=Bl,Xt=os;if(Bl=Ot||k,os=Xt||et,u(p,l),os=Xt,Bl=Ot,b(l),A&8192)e:for(p=l.stateNode,p._visibility=k?p._visibility&-2:p._visibility|1,k&&(x===null||et||Bl||os||P(l)),x=null,p=l;;){if(p.tag===5||p.tag===26){if(x===null){et=x=p;try{if(j=et.stateNode,k)oe=j.style,typeof oe.setProperty=="function"?oe.setProperty("display","none","important"):oe.display="none";else{Ie=et.stateNode;var ti=et.memoizedProps.style,Lt=ti!=null&&ti.hasOwnProperty("display")?ti.display:null;Ie.style.display=Lt==null||typeof Lt=="boolean"?"":(""+Lt).trim()}}catch(Vi){Hn(et,et.return,Vi)}}}else if(p.tag===6){if(x===null){et=p;try{et.stateNode.nodeValue=k?"":et.memoizedProps}catch(Vi){Hn(et,et.return,Vi)}}}else if(p.tag===18){if(x===null){et=p;try{var Vt=et.stateNode;k?Kh(Vt,!0):Kh(et.stateNode,!1)}catch(Vi){Hn(et,et.return,Vi)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===l)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===l)break e;for(;p.sibling===null;){if(p.return===null||p.return===l)break e;x===p&&(x=null),p=p.return}x===p&&(x=null),p.sibling.return=p.return,p=p.sibling}A&4&&(A=l.updateQueue,A!==null&&(x=A.retryQueue,x!==null&&(A.retryQueue=null,o(l,x))));break;case 19:u(p,l),b(l),A&4&&(A=l.updateQueue,A!==null&&(l.updateQueue=null,o(l,A)));break;case 30:break;case 21:break;default:u(p,l),b(l)}}function b(l){var p=l.flags;if(p&2){try{for(var x,A=l.return;A!==null;){if(Sm(A)){x=A;break}A=A.return}if(x==null)throw Error(T(160));switch(x.tag){case 27:var k=x.stateNode,j=ap(l);lp(l,j,k);break;case 5:var oe=x.stateNode;x.flags&32&&(vl(oe,""),x.flags&=-33);var Ie=ap(l);lp(l,Ie,oe);break;case 3:case 4:var et=x.stateNode.containerInfo,Ot=ap(l);Em(l,Ot,et);break;default:throw Error(T(161))}}catch(Xt){Hn(l,l.return,Xt)}l.flags&=-3}p&4096&&(l.flags&=-4097)}function E(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var p=l;E(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),l=l.sibling}}function C(l,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)oa(l,p.alternate,p),p=p.sibling}function P(l){for(l=l.child;l!==null;){var p=l;switch(p.tag){case 0:case 11:case 14:case 15:fc(4,p,p.return),P(p);break;case 1:ll(p,p.return);var x=p.stateNode;typeof x.componentWillUnmount=="function"&&wm(p,p.return,x),P(p);break;case 27:km(p.stateNode);case 26:case 5:ll(p,p.return),P(p);break;case 22:p.memoizedState===null&&P(p);break;case 30:P(p);break;default:P(p)}l=l.sibling}}function z(l,p,x){for(x=x&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var A=p.alternate,k=l,j=p,oe=j.flags;switch(j.tag){case 0:case 11:case 15:z(k,j,x),dc(4,j);break;case 1:if(z(k,j,x),A=j,k=A.stateNode,typeof k.componentDidMount=="function")try{k.componentDidMount()}catch(Ot){Hn(A,A.return,Ot)}if(A=j,k=A.updateQueue,k!==null){var Ie=A.stateNode;try{var et=k.shared.hiddenCallbacks;if(et!==null)for(k.shared.hiddenCallbacks=null,k=0;k<et.length;k++)wu(et[k],Ie)}catch(Ot){Hn(A,A.return,Ot)}}x&&oe&64&&op(j),Gh(j,j.return);break;case 27:qh(j);case 26:case 5:z(k,j,x),x&&A===null&&oe&4&&Tm(j),Gh(j,j.return);break;case 12:z(k,j,x);break;case 31:z(k,j,x),x&&oe&4&&K_(k,j);break;case 13:z(k,j,x),x&&oe&4&&c(k,j);break;case 22:j.memoizedState===null&&z(k,j,x),Gh(j,j.return);break;case 30:break;default:z(k,j,x)}p=p.sibling}}function U(l,p){var x=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(x=l.memoizedState.cachePool.pool),l=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(l=p.memoizedState.cachePool.pool),l!==x&&(l!=null&&l.refCount++,x!=null&&nc(x))}function N(l,p){l=null,p.alternate!==null&&(l=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==l&&(p.refCount++,l!=null&&nc(l))}function V(l,p,x,A){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)X(l,p,x,A),p=p.sibling}function X(l,p,x,A){var k=p.flags;switch(p.tag){case 0:case 11:case 15:V(l,p,x,A),k&2048&&dc(9,p);break;case 1:V(l,p,x,A);break;case 3:V(l,p,x,A),k&2048&&(l=null,p.alternate!==null&&(l=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==l&&(p.refCount++,l!=null&&nc(l)));break;case 12:if(k&2048){V(l,p,x,A),l=p.stateNode;try{var j=p.memoizedProps,oe=j.id,Ie=j.onPostCommit;typeof Ie=="function"&&Ie(oe,p.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(et){Hn(p,p.return,et)}}else V(l,p,x,A);break;case 31:V(l,p,x,A);break;case 13:V(l,p,x,A);break;case 23:break;case 22:j=p.stateNode,oe=p.alternate,p.memoizedState!==null?j._visibility&2?V(l,p,x,A):Y(l,p):j._visibility&2?V(l,p,x,A):(j._visibility|=2,Z(l,p,x,A,(p.subtreeFlags&10256)!==0||!1)),k&2048&&U(oe,p);break;case 24:V(l,p,x,A),k&2048&&N(p.alternate,p);break;default:V(l,p,x,A)}}function Z(l,p,x,A,k){for(k=k&&((p.subtreeFlags&10256)!==0||!1),p=p.child;p!==null;){var j=l,oe=p,Ie=x,et=A,Ot=oe.flags;switch(oe.tag){case 0:case 11:case 15:Z(j,oe,Ie,et,k),dc(8,oe);break;case 23:break;case 22:var Xt=oe.stateNode;oe.memoizedState!==null?Xt._visibility&2?Z(j,oe,Ie,et,k):Y(j,oe):(Xt._visibility|=2,Z(j,oe,Ie,et,k)),k&&Ot&2048&&U(oe.alternate,oe);break;case 24:Z(j,oe,Ie,et,k),k&&Ot&2048&&N(oe.alternate,oe);break;default:Z(j,oe,Ie,et,k)}p=p.sibling}}function Y(l,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var x=l,A=p,k=A.flags;switch(A.tag){case 22:Y(x,A),k&2048&&U(A.alternate,A);break;case 24:Y(x,A),k&2048&&N(A.alternate,A);break;default:Y(x,A)}p=p.sibling}}var ne=8192;function ue(l,p,x){if(l.subtreeFlags&ne)for(l=l.child;l!==null;)ce(l,p,x),l=l.sibling}function ce(l,p,x){switch(l.tag){case 26:ue(l,p,x),l.flags&ne&&l.memoizedState!==null&&wa(x,g,l.memoizedState,l.memoizedProps);break;case 5:ue(l,p,x);break;case 3:case 4:var A=g;g=Bm(l.stateNode.containerInfo),ue(l,p,x),g=A;break;case 22:l.memoizedState===null&&(A=l.alternate,A!==null&&A.memoizedState!==null?(A=ne,ne=16777216,ue(l,p,x),ne=A):ue(l,p,x));break;default:ue(l,p,x)}}function ae(l){var p=l.alternate;if(p!==null&&(l=p.child,l!==null)){p.child=null;do p=l.sibling,l.sibling=null,l=p;while(l!==null)}}function Ee(l){var p=l.deletions;if((l.flags&16)!==0){if(p!==null)for(var x=0;x<p.length;x++){var A=p[x];Er=A,ye(A,l)}ae(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)xe(l),l=l.sibling}function xe(l){switch(l.tag){case 0:case 11:case 15:Ee(l),l.flags&2048&&fc(9,l,l.return);break;case 3:Ee(l);break;case 12:Ee(l);break;case 22:var p=l.stateNode;l.memoizedState!==null&&p._visibility&2&&(l.return===null||l.return.tag!==13)?(p._visibility&=-3,Se(l)):Ee(l);break;default:Ee(l)}}function Se(l){var p=l.deletions;if((l.flags&16)!==0){if(p!==null)for(var x=0;x<p.length;x++){var A=p[x];Er=A,ye(A,l)}ae(l)}for(l=l.child;l!==null;){switch(p=l,p.tag){case 0:case 11:case 15:fc(8,p,p.return),Se(p);break;case 22:x=p.stateNode,x._visibility&2&&(x._visibility&=-3,Se(p));break;default:Se(p)}l=l.sibling}}function ye(l,p){for(;Er!==null;){var x=Er;switch(x.tag){case 0:case 11:case 15:fc(8,x,p);break;case 23:case 22:if(x.memoizedState!==null&&x.memoizedState.cachePool!==null){var A=x.memoizedState.cachePool.pool;A!=null&&A.refCount++}break;case 24:nc(x.memoizedState.cache)}if(A=x.child,A!==null)A.return=x,Er=A;else e:for(x=l;Er!==null;){A=Er;var k=A.sibling,j=A.return;if(Hh(A),A===x){Er=null;break e}if(k!==null){k.return=j,Er=k;break e}Er=j}}}var fe={getCacheForType:function(l){var p=Zs(ar),x=p.data.get(l);return x===void 0&&(x=l(),p.data.set(l,x)),x},cacheSignal:function(){return Zs(ar).controller.signal}},De=typeof WeakMap=="function"?WeakMap:Map,Pe=0,Be=null,He=null,Ve=0,Qe=0,ct=null,$e=!1,Oe=!1,nt=!1,Ze=0,lt=0,St=0,kt=0,Ct=0,Et=0,ei=0,Yt=null,Nt=null,Kt=!1,ai=0,_i=0,Pi=1/0,Zi=null,yi=null,zi=0,Ti=null,dn=null,an=0,wn=0,tn=null,Li=null,un=0,Xn=null;function Tn(){return(Pe&2)!==0&&Ve!==0?Ve&-Ve:Xe.T!==null?Im():J()}function pn(){if(Et===0)if((Ve&536870912)===0||Zn){var l=Ro;Ro<<=1,(Ro&3932160)===0&&(Ro=262144),Et=l}else Et=536870912;return l=lo.current,l!==null&&(l.flags|=32),Et}function Di(l,p,x){(l===Be&&(Qe===2||Qe===9)||l.cancelPendingCommit!==null)&&(Rs(l,0),Rn(l,Ve,Et,!1)),Gn(l,x),((Pe&2)===0||l!==Be)&&(l===Be&&((Pe&2)===0&&(kt|=x),lt===4&&Rn(l,Ve,Et,!1)),Yc(l))}function ki(l,p,x){if((Pe&6)!==0)throw Error(T(327));var A=!x&&(p&127)===0&&(p&l.expiredLanes)===0||ui(l,p),k=A?rr(l,p):aa(l,p,!0),j=A;do{if(k===0){Oe&&!A&&Rn(l,p,0,!1);break}else{if(x=l.current.alternate,j&&!dr(x)){k=aa(l,p,!1),j=!1;continue}if(k===2){if(j=p,l.errorRecoveryDisabledLanes&j)var oe=0;else oe=l.pendingLanes&-536870913,oe=oe!==0?oe:oe&536870912?536870912:0;if(oe!==0){p=oe;e:{var Ie=l;k=Yt;var et=Ie.current.memoizedState.isDehydrated;if(et&&(Rs(Ie,oe).flags|=256),oe=aa(Ie,oe,!1),oe!==2){if(nt&&!et){Ie.errorRecoveryDisabledLanes|=j,kt|=j,k=4;break e}j=Nt,Nt=k,j!==null&&(Nt===null?Nt=j:Nt.push.apply(Nt,j))}k=oe}if(j=!1,k!==2)continue}}if(k===1){Rs(l,0),Rn(l,p,0,!0);break}e:{switch(A=l,j=k,j){case 0:case 1:throw Error(T(345));case 4:if((p&4194048)!==p)break;case 6:Rn(A,p,Et,!$e);break e;case 2:Nt=null;break;case 3:case 5:break;default:throw Error(T(329))}if((p&62914560)===p&&(k=ai+300-tr(),10<k)){if(Rn(A,p,Et,!$e),It(A,0,!0)!==0)break e;an=p,A.timeoutHandle=hp(Bn.bind(null,A,x,Nt,Zi,Kt,p,Et,kt,ei,$e,j,"Throttled",-0,0),k);break e}Bn(A,x,Nt,Zi,Kt,p,Et,kt,ei,$e,j,null,-0,0)}}break}while(!0);Yc(l)}function Bn(l,p,x,A,k,j,oe,Ie,et,Ot,Xt,ti,Lt,Vt){if(l.timeoutHandle=-1,ti=p.subtreeFlags,ti&8192||(ti&16785408)===16785408){ti={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ds},ce(p,j,ti);var Vi=(j&62914560)===j?ai-tr():(j&4194048)===j?_i-tr():0;if(Vi=qv(ti,Vi),Vi!==null){an=j,l.cancelPendingCommit=Vi($h.bind(null,l,p,j,x,A,k,oe,Ie,et,Xt,ti,null,Lt,Vt)),Rn(l,j,oe,!Ot);return}}$h(l,p,j,x,A,k,oe,Ie,et)}function dr(l){for(var p=l;;){var x=p.tag;if((x===0||x===11||x===15)&&p.flags&16384&&(x=p.updateQueue,x!==null&&(x=x.stores,x!==null)))for(var A=0;A<x.length;A++){var k=x[A],j=k.getSnapshot;k=k.value;try{if(!zo(j(),k))return!1}catch{return!1}}if(x=p.child,p.subtreeFlags&16384&&x!==null)x.return=p,p=x;else{if(p===l)break;for(;p.sibling===null;){if(p.return===null||p.return===l)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function Rn(l,p,x,A){p&=~Ct,p&=~kt,l.suspendedLanes|=p,l.pingedLanes&=~p,A&&(l.warmLanes|=p),A=l.expirationTimes;for(var k=p;0<k;){var j=31-Gr(k),oe=1<<j;A[j]=-1,k&=~oe}x!==0&&Yn(l,x,p)}function Fn(){return(Pe&6)===0?(Xh(0),!1):!0}function Xs(){if(He!==null){if(Qe===0)var l=He.return;else l=He,Cl=ka=null,Fd(l),Bc=null,Ih=0,l=He;for(;l!==null;)bm(l.alternate,l),l=l.return;He=null}}function Rs(l,p){var x=l.timeoutHandle;x!==-1&&(l.timeoutHandle=-1,Wx(x)),x=l.cancelPendingCommit,x!==null&&(l.cancelPendingCommit=null,x()),an=0,Xs(),Be=l,He=x=ko(l.current,null),Ve=p,Qe=0,ct=null,$e=!1,Oe=ui(l,p),nt=!1,ei=Et=Ct=kt=St=lt=0,Nt=Yt=null,Kt=!1,(p&8)!==0&&(p|=p&32);var A=l.entangledLanes;if(A!==0)for(l=l.entanglements,A&=p;0<A;){var k=31-Gr(A),j=1<<k;p|=l[k],A&=~j}return Ze=p,fu(),x}function as(l,p){Mt=null,Xe.H=nl,p===Ch||p===Dd?(p=im(),Qe=3):p===tm?(p=im(),Qe=4):Qe=p===Yd?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,ct=p,He===null&&(lt=1,Xd(l,zs(p,l.current)))}function mn(){var l=lo.current;return l===null?!0:(Ve&4194048)===Ve?Ws===null:(Ve&62914560)===Ve||(Ve&536870912)!==0?l===Ws:!1}function No(){var l=Xe.H;return Xe.H=nl,l===null?nl:l}function Ms(){var l=Xe.A;return Xe.A=fe,l}function Ys(){lt=4,$e||(Ve&4194048)!==Ve&&lo.current!==null||(Oe=!0),(St&134217727)===0&&(kt&134217727)===0||Be===null||Rn(Be,Ve,Et,!1)}function aa(l,p,x){var A=Pe;Pe|=2;var k=No(),j=Ms();(Be!==l||Ve!==p)&&(Zi=null,Rs(l,p)),p=!1;var oe=lt;e:do try{if(Qe!==0&&He!==null){var Ie=He,et=ct;switch(Qe){case 8:Xs(),oe=6;break e;case 3:case 2:case 9:case 6:lo.current===null&&(p=!0);var Ot=Qe;if(Qe=0,ct=null,is(l,Ie,et,Ot),x&&Oe){oe=0;break e}break;default:Ot=Qe,Qe=0,ct=null,is(l,Ie,et,Ot)}}So(),oe=lt;break}catch(Xt){as(l,Xt)}while(!0);return p&&l.shellSuspendCounter++,Cl=ka=null,Pe=A,Xe.H=k,Xe.A=j,He===null&&(Be=null,Ve=0,fu()),oe}function So(){for(;He!==null;)Vn(He)}function rr(l,p){var x=Pe;Pe|=2;var A=No(),k=Ms();Be!==l||Ve!==p?(Zi=null,Pi=tr()+500,Rs(l,p)):Oe=ui(l,p);e:do try{if(Qe!==0&&He!==null){p=He;var j=ct;t:switch(Qe){case 1:Qe=0,ct=null,is(l,p,j,1);break;case 2:case 9:if(Pd(j)){Qe=0,ct=null,kr(p);break}p=function(){Qe!==2&&Qe!==9||Be!==l||(Qe=7),Yc(l)},j.then(p,p);break e;case 3:Qe=7;break e;case 4:Qe=5;break e;case 7:Pd(j)?(Qe=0,ct=null,kr(p)):(Qe=0,ct=null,is(l,p,j,7));break;case 5:var oe=null;switch(He.tag){case 26:oe=He.memoizedState;case 5:case 27:var Ie=He;if(oe?yy(oe):Ie.stateNode.complete){Qe=0,ct=null;var et=Ie.sibling;if(et!==null)He=et;else{var Ot=Ie.return;Ot!==null?(He=Ot,lr(Ot)):He=null}break t}}Qe=0,ct=null,is(l,p,j,5);break;case 6:Qe=0,ct=null,is(l,p,j,6);break;case 8:Xs(),lt=6;break e;default:throw Error(T(462))}}Dr();break}catch(Xt){as(l,Xt)}while(!0);return Cl=ka=null,Xe.H=A,Xe.A=k,Pe=x,He!==null?0:(Be=null,Ve=0,fu(),lt)}function Dr(){for(;He!==null&&!_r();)Vn(He)}function Vn(l){var p=ef(l.alternate,l,Ze);l.memoizedProps=l.pendingProps,p===null?lr(l):He=p}function kr(l){var p=l,x=p.alternate;switch(p.tag){case 15:case 0:p=Kd(x,p,p.pendingProps,p.type,void 0,Ve);break;case 11:p=Kd(x,p,p.pendingProps,p.type.render,p.ref,Ve);break;case 5:Fd(p);default:bm(x,p),p=He=Jl(p,Ze),p=ef(x,p,Ze)}l.memoizedProps=l.pendingProps,p===null?lr(l):He=p}function is(l,p,x,A){Cl=ka=null,Fd(p),Bc=null,Ih=0;var k=p.return;try{if(kh(l,k,p,x,Ve)){lt=1,Xd(l,zs(x,l.current)),He=null;return}}catch(j){if(k!==null)throw He=k,j;lt=1,Xd(l,zs(x,l.current)),He=null;return}p.flags&32768?(Zn||A===1?l=!0:Oe||(Ve&536870912)!==0?l=!1:($e=l=!0,(A===2||A===9||A===3||A===6)&&(A=lo.current,A!==null&&A.tag===13&&(A.flags|=16384))),jo(p,l)):lr(p)}function lr(l){var p=l;do{if((p.flags&32768)!==0){jo(p,$e);return}l=p.return;var x=nf(p.alternate,p,Ze);if(x!==null){He=x;return}if(p=p.sibling,p!==null){He=p;return}He=p=l}while(p!==null);lt===0&&(lt=5)}function jo(l,p){do{var x=Bg(l.alternate,l);if(x!==null){x.flags&=32767,He=x;return}if(x=l.return,x!==null&&(x.flags|=32768,x.subtreeFlags=0,x.deletions=null),!p&&(l=l.sibling,l!==null)){He=l;return}He=l=x}while(l!==null);lt=6,He=null}function $h(l,p,x,A,k,j,oe,Ie,et){l.cancelPendingCommit=null;do ba();while(zi!==0);if((Pe&6)!==0)throw Error(T(327));if(p!==null){if(p===l.current)throw Error(T(177));if(j=p.lanes|p.childLanes,j|=xd,pt(l,x,j,oe,Ie,et),l===Be&&(He=Be=null,Ve=0),dn=p,Ti=l,an=x,wn=j,tn=k,Li=A,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,Iv(io,function(){return ul(),null})):(l.callbackNode=null,l.callbackPriority=0),A=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||A){A=Xe.T,Xe.T=null,k=gt.p,gt.p=2,oe=Pe,Pe|=4;try{Hr(l,p,x)}finally{Pe=oe,gt.p=k,Xe.T=A}}zi=1,cl(),ju(),Uu()}}function cl(){if(zi===1){zi=0;var l=Ti,p=dn,x=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||x){x=Xe.T,Xe.T=null;var A=gt.p;gt.p=2;var k=Pe;Pe|=4;try{v(p,l);var j=Gg,oe=Tg(l.containerInfo),Ie=j.focusedElem,et=j.selectionRange;if(oe!==Ie&&Ie&&Ie.ownerDocument&&Wl(Ie.ownerDocument.documentElement,Ie)){if(et!==null&&hu(Ie)){var Ot=et.start,Xt=et.end;if(Xt===void 0&&(Xt=Ot),"selectionStart"in Ie)Ie.selectionStart=Ot,Ie.selectionEnd=Math.min(Xt,Ie.value.length);else{var ti=Ie.ownerDocument||document,Lt=ti&&ti.defaultView||window;if(Lt.getSelection){var Vt=Lt.getSelection(),Vi=Ie.textContent.length,nn=Math.min(et.start,Vi),Ar=et.end===void 0?nn:Math.min(et.end,Vi);!Vt.extend&&nn>Ar&&(oe=Ar,Ar=nn,nn=oe);var xt=pa(Ie,nn),st=pa(Ie,Ar);if(xt&&st&&(Vt.rangeCount!==1||Vt.anchorNode!==xt.node||Vt.anchorOffset!==xt.offset||Vt.focusNode!==st.node||Vt.focusOffset!==st.offset)){var Rt=ti.createRange();Rt.setStart(xt.node,xt.offset),Vt.removeAllRanges(),nn>Ar?(Vt.addRange(Rt),Vt.extend(st.node,st.offset)):(Rt.setEnd(st.node,st.offset),Vt.addRange(Rt))}}}}for(ti=[],Vt=Ie;Vt=Vt.parentNode;)Vt.nodeType===1&&ti.push({element:Vt,left:Vt.scrollLeft,top:Vt.scrollTop});for(typeof Ie.focus=="function"&&Ie.focus(),Ie=0;Ie<ti.length;Ie++){var Jt=ti[Ie];Jt.element.scrollLeft=Jt.left,Jt.element.scrollTop=Jt.top}}Vm=!!Vg,Gg=Vg=null}finally{Pe=k,gt.p=A,Xe.T=x}}l.current=p,zi=2}}function ju(){if(zi===2){zi=0;var l=Ti,p=dn,x=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||x){x=Xe.T,Xe.T=null;var A=gt.p;gt.p=2;var k=Pe;Pe|=4;try{oa(l,p.alternate,p)}finally{Pe=k,gt.p=A,Xe.T=x}}zi=3}}function Uu(){if(zi===4||zi===3){zi=0,go();var l=Ti,p=dn,x=an,A=Li;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?zi=5:(zi=0,dn=Ti=null,Uo(l,l.pendingLanes));var k=l.pendingLanes;if(k===0&&(yi=null),Le(x),p=p.stateNode,$r&&typeof $r.onCommitFiberRoot=="function")try{$r.onCommitFiberRoot(Yo,p,void 0,(p.current.flags&128)===128)}catch{}if(A!==null){p=Xe.T,k=gt.p,gt.p=2,Xe.T=null;try{for(var j=l.onRecoverableError,oe=0;oe<A.length;oe++){var Ie=A[oe];j(Ie.value,{componentStack:Ie.stack})}}finally{Xe.T=p,gt.p=k}}(an&3)!==0&&ba(),Yc(l),k=l.pendingLanes,(x&261930)!==0&&(k&42)!==0?l===Xn?un++:(un=0,Xn=l):un=0,Xh(0)}}function Uo(l,p){(l.pooledCacheLanes&=p)===0&&(p=l.pooledCache,p!=null&&(l.pooledCache=null,nc(p)))}function ba(){return cl(),ju(),Uu(),ul()}function ul(){if(zi!==5)return!1;var l=Ti,p=wn;wn=0;var x=Le(an),A=Xe.T,k=gt.p;try{gt.p=32>x?32:x,Xe.T=null,x=tn,tn=null;var j=Ti,oe=an;if(zi=0,dn=Ti=null,an=0,(Pe&6)!==0)throw Error(T(331));var Ie=Pe;if(Pe|=4,xe(j.current),X(j,j.current,oe,x),Pe=Ie,Xh(0,!1),$r&&typeof $r.onPostCommitFiberRoot=="function")try{$r.onPostCommitFiberRoot(Yo,j)}catch{}return!0}finally{gt.p=k,Xe.T=A,Uo(l,p)}}function la(l,p,x){p=zs(x,p),p=rl(l.stateNode,p,2),l=ac(l,p,2),l!==null&&(Gn(l,2),Yc(l))}function Hn(l,p,x){if(l.tag===3)la(l,l,x);else for(;p!==null;){if(p.tag===3){la(p,l,x);break}else if(p.tag===1){var A=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(yi===null||!yi.has(A))){l=zs(x,l),x=Ll(2),A=ac(p,x,2),A!==null&&(ms(x,A,p,l),Gn(A,2),Yc(A));break}}p=p.return}}function mc(l,p,x){var A=l.pingCache;if(A===null){A=l.pingCache=new De;var k=new Set;A.set(p,k)}else k=A.get(p),k===void 0&&(k=new Set,A.set(p,k));k.has(x)||(nt=!0,k.add(x),l=cp.bind(null,l,p,x),p.then(l,l))}function cp(l,p,x){var A=l.pingCache;A!==null&&A.delete(p),l.pingedLanes|=l.suspendedLanes&x,l.warmLanes&=~x,Be===l&&(Ve&x)===x&&(lt===4||lt===3&&(Ve&62914560)===Ve&&300>tr()-ai?(Pe&2)===0&&Rs(l,0):Ct|=x,ei===Ve&&(ei=0)),Yc(l)}function J_(l,p){p===0&&(p=In()),l=zt(l,p),l!==null&&(Gn(l,p),Yc(l))}function Av(l){var p=l.memoizedState,x=0;p!==null&&(x=p.retryLane),J_(l,x)}function Cv(l,p){var x=0;switch(l.tag){case 31:case 13:var A=l.stateNode,k=l.memoizedState;k!==null&&(x=k.retryLane);break;case 19:A=l.stateNode;break;case 22:A=l.stateNode._retryCache;break;default:throw Error(T(314))}A!==null&&A.delete(p),J_(l,x)}function Iv(l,p){return Ts(l,p)}var Am=null,Fl=null,Fg=!1,ks=!1,Zh=!1,Wh=0;function Yc(l){l!==Fl&&l.next===null&&(Fl===null?Am=Fl=l:Fl=Fl.next=l),ks=!0,Fg||(Fg=!0,Hx())}function Xh(l,p){if(!Zh&&ks){Zh=!0;do for(var x=!1,A=Am;A!==null;){if(l!==0){var k=A.pendingLanes;if(k===0)var j=0;else{var oe=A.suspendedLanes,Ie=A.pingedLanes;j=(1<<31-Gr(42|l)+1)-1,j&=k&~(oe&~Ie),j=j&201326741?j&201326741|1:j?j|2:0}j!==0&&(x=!0,ey(A,j))}else j=Ve,j=It(A,A===Be?j:0,A.cancelPendingCommit!==null||A.timeoutHandle!==-1),(j&3)===0||ui(A,j)||(x=!0,ey(A,j));A=A.next}while(x);Zh=!1}}function qx(){Q_()}function Q_(){ks=Fg=!1;var l=0;Wh!==0&&Bv()&&(l=Wh);for(var p=tr(),x=null,A=Am;A!==null;){var k=A.next,j=Cm(A,p);j===0?(A.next=null,x===null?Am=k:x.next=k,k===null&&(Fl=x)):(x=A,(l!==0||(j&3)!==0)&&(ks=!0)),A=k}zi!==0&&zi!==5||Xh(l),Wh!==0&&(Wh=0)}function Cm(l,p){for(var x=l.suspendedLanes,A=l.pingedLanes,k=l.expirationTimes,j=l.pendingLanes&-62914561;0<j;){var oe=31-Gr(j),Ie=1<<oe,et=k[oe];et===-1?((Ie&x)===0||(Ie&A)!==0)&&(k[oe]=Mn(Ie,p)):et<=p&&(l.expiredLanes|=Ie),j&=~Ie}if(p=Be,x=Ve,x=It(l,l===p?x:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),A=l.callbackNode,x===0||l===p&&(Qe===2||Qe===9)||l.cancelPendingCommit!==null)return A!==null&&A!==null&&Aa(A),l.callbackNode=null,l.callbackPriority=0;if((x&3)===0||ui(l,x)){if(p=x&-x,p===l.callbackPriority)return p;switch(A!==null&&Aa(A),Le(x)){case 2:case 8:x=Xo;break;case 32:x=io;break;case 268435456:x=Vr;break;default:x=io}return A=Rv.bind(null,l),x=Ts(x,A),l.callbackPriority=p,l.callbackNode=x,p}return A!==null&&A!==null&&Aa(A),l.callbackPriority=2,l.callbackNode=null,2}function Rv(l,p){if(zi!==0&&zi!==5)return l.callbackNode=null,l.callbackPriority=0,null;var x=l.callbackNode;if(ba()&&l.callbackNode!==x)return null;var A=Ve;return A=It(l,l===Be?A:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),A===0?null:(ki(l,A,p),Cm(l,tr()),l.callbackNode!=null&&l.callbackNode===x?Rv.bind(null,l):null)}function ey(l,p){if(ba())return null;ki(l,p,!0)}function Hx(){Xx(function(){(Pe&6)!==0?Ts(Ur,qx):Q_()})}function Im(){if(Wh===0){var l=rc;l===0&&(l=Io,Io<<=1,(Io&261888)===0&&(Io=256)),Wh=l}return Wh}function gc(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:Ra(""+l)}function Kc(l,p){var x=p.ownerDocument.createElement("input");return x.name=p.name,x.value=p.value,l.id&&x.setAttribute("form",l.id),p.parentNode.insertBefore(x,p),l=new FormData(l),x.parentNode.removeChild(x),l}function Mv(l,p,x,A,k){if(p==="submit"&&x&&x.stateNode===k){var j=gc((k[_e]||null).action),oe=A.submitter;oe&&(p=(p=oe[_e]||null)?gc(p.formAction):oe.getAttribute("formAction"),p!==null&&(j=p,oe=null));var Ie=new Ic("action","action",null,A,k);l.push({event:Ie,listeners:[{instance:null,listener:function(){if(A.defaultPrevented){if(Wh!==0){var et=oe?Kc(k,oe):new FormData(k);Gd(x,{pending:!0,data:et,method:k.method,action:j},null,et)}}else typeof j=="function"&&(Ie.preventDefault(),et=oe?Kc(k,oe):new FormData(k),Gd(x,{pending:!0,data:et,method:k.method,action:j},j,et))},currentTarget:k}]})}}for(var Ng=0;Ng<bo.length;Ng++){var up=bo[Ng],ty=up.toLowerCase(),Rm=up[0].toUpperCase()+up.slice(1);ga(ty,"on"+Rm)}ga(Mf,"onAnimationEnd"),ga(Sg,"onAnimationIteration"),ga(wl,"onAnimationStart"),ga("dblclick","onDoubleClick"),ga("focusin","onFocus"),ga("focusout","onBlur"),ga(Eg,"onTransitionRun"),ga(Ag,"onTransitionStart"),ga(Df,"onTransitionCancel"),ga(Of,"onTransitionEnd"),Qn("onMouseEnter",["mouseout","mouseover"]),Qn("onMouseLeave",["mouseout","mouseover"]),Qn("onPointerEnter",["pointerout","pointerover"]),Qn("onPointerLeave",["pointerout","pointerover"]),xr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),xr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),xr("onBeforeInput",["compositionend","keypress","textInput","paste"]),xr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),xr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),xr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Yh));function Mm(l,p){p=(p&4)!==0;for(var x=0;x<l.length;x++){var A=l[x],k=A.event;A=A.listeners;e:{var j=void 0;if(p)for(var oe=A.length-1;0<=oe;oe--){var Ie=A[oe],et=Ie.instance,Ot=Ie.currentTarget;if(Ie=Ie.listener,et!==j&&k.isPropagationStopped())break e;j=Ie,k.currentTarget=Ot;try{j(k)}catch(Xt){mh(Xt)}k.currentTarget=null,j=et}else for(oe=0;oe<A.length;oe++){if(Ie=A[oe],et=Ie.instance,Ot=Ie.currentTarget,Ie=Ie.listener,et!==j&&k.isPropagationStopped())break e;j=Ie,k.currentTarget=Ot;try{j(k)}catch(Xt){mh(Xt)}k.currentTarget=null,j=et}}}}function $n(l,p){var x=p[We];x===void 0&&(x=p[We]=new Set);var A=l+"__bubble";x.has(A)||(Vu(p,l,2,!1),x.add(A))}function Dm(l,p,x){var A=0;p&&(A|=4),Vu(x,l,A,p)}var Om="_reactListening"+Math.random().toString(36).slice(2);function jg(l){if(!l[Om]){l[Om]=!0,bi.forEach(function(x){x!=="selectionchange"&&(Dv.has(x)||Dm(x,!1,l),Dm(x,!0,l))});var p=l.nodeType===9?l:l.ownerDocument;p===null||p[Om]||(p[Om]=!0,Dm("selectionchange",!1,p))}}function Vu(l,p,x,A){switch(Xv(p)){case 2:var k=Xg;break;case 8:k=Wv;break;default:k=mp}x=k.bind(null,p,x,l),k=void 0,!su||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(k=!0),A?k!==void 0?l.addEventListener(p,x,{capture:!0,passive:k}):l.addEventListener(p,x,!0):k!==void 0?l.addEventListener(p,x,{passive:k}):l.addEventListener(p,x,!1)}function Ug(l,p,x,A,k){var j=A;if((p&1)===0&&(p&2)===0&&A!==null)e:for(;;){if(A===null)return;var oe=A.tag;if(oe===3||oe===4){var Ie=A.stateNode.containerInfo;if(Ie===k)break;if(oe===4)for(oe=A.return;oe!==null;){var et=oe.tag;if((et===3||et===4)&&oe.stateNode.containerInfo===k)return;oe=oe.return}for(;Ie!==null;){if(oe=oi(Ie),oe===null)return;if(et=oe.tag,et===5||et===6||et===26||et===27){A=j=oe;continue e}Ie=Ie.parentNode}}A=A.return}Gp(function(){var Ot=j,Xt=Ac(x),ti=[];e:{var Lt=Yl.get(l);if(Lt!==void 0){var Vt=Ic,Vi=l;switch(l){case"keypress":if(on(x)===0)break e;case"keydown":case"keyup":Vt=Do;break;case"focusin":Vi="focus",Vt=so;break;case"focusout":Vi="blur",Vt=so;break;case"beforeblur":case"afterblur":Vt=so;break;case"click":if(x.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Vt=lh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Vt=au;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Vt=vo;break;case Mf:case Sg:case wl:Vt=Tf;break;case Of:Vt=An;break;case"scroll":case"scrollend":Vt=pd;break;case"wheel":Vt=uh;break;case"copy":case"cut":case"paste":Vt=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Vt=_n;break;case"toggle":case"beforetoggle":Vt=oo}var nn=(p&4)!==0,Ar=!nn&&(l==="scroll"||l==="scrollend"),xt=nn?Lt!==null?Lt+"Capture":null:Lt;nn=[];for(var st=Ot,Rt;st!==null;){var Jt=st;if(Rt=Jt.stateNode,Jt=Jt.tag,Jt!==5&&Jt!==26&&Jt!==27||Rt===null||xt===null||(Jt=oh(st,xt),Jt!=null&&nn.push(rf(st,Jt,Rt))),Ar)break;st=st.return}0<nn.length&&(Lt=new Vt(Lt,Vi,null,x,Xt),ti.push({event:Lt,listeners:nn}))}}if((p&7)===0){e:{if(Lt=l==="mouseover"||l==="pointerover",Vt=l==="mouseout"||l==="pointerout",Lt&&x!==Ma&&(Vi=x.relatedTarget||x.fromElement)&&(oi(Vi)||Vi[ke]))break e;if((Vt||Lt)&&(Lt=Xt.window===Xt?Xt:(Lt=Xt.ownerDocument)?Lt.defaultView||Lt.parentWindow:window,Vt?(Vi=x.relatedTarget||x.toElement,Vt=Ot,Vi=Vi?oi(Vi):null,Vi!==null&&(Ar=D(Vi),nn=Vi.tag,Vi!==Ar||nn!==5&&nn!==27&&nn!==6)&&(Vi=null)):(Vt=null,Vi=Ot),Vt!==Vi)){if(nn=lh,Jt="onMouseLeave",xt="onMouseEnter",st="mouse",(l==="pointerout"||l==="pointerover")&&(nn=_n,Jt="onPointerLeave",xt="onPointerEnter",st="pointer"),Ar=Vt==null?Lt:Mi(Vt),Rt=Vi==null?Lt:Mi(Vi),Lt=new nn(Jt,st+"leave",Vt,x,Xt),Lt.target=Ar,Lt.relatedTarget=Rt,Jt=null,oi(Xt)===Ot&&(nn=new nn(xt,st+"enter",Vi,x,Xt),nn.target=Rt,nn.relatedTarget=Ar,Jt=nn),Ar=Jt,Vt&&Vi)t:{for(nn=$x,xt=Vt,st=Vi,Rt=0,Jt=xt;Jt;Jt=nn(Jt))Rt++;Jt=0;for(var ln=st;ln;ln=nn(ln))Jt++;for(;0<Rt-Jt;)xt=nn(xt),Rt--;for(;0<Jt-Rt;)st=nn(st),Jt--;for(;Rt--;){if(xt===st||st!==null&&xt===st.alternate){nn=xt;break t}xt=nn(xt),st=nn(st)}nn=null}else nn=null;Vt!==null&&Ov(ti,Lt,Vt,nn,!1),Vi!==null&&Ar!==null&&Ov(ti,Ar,Vi,nn,!0)}}e:{if(Lt=Ot?Mi(Ot):window,Vt=Lt.nodeName&&Lt.nodeName.toLowerCase(),Vt==="select"||Vt==="input"&&Lt.type==="file")var fr=ii;else if(ts(Lt))if(uu)fr=ph;else{fr=bl;var Wi=Kp}else Vt=Lt.nodeName,!Vt||Vt.toLowerCase()!=="input"||Lt.type!=="checkbox"&&Lt.type!=="radio"?Ot&&dd(Ot.elementType)&&(fr=ii):fr=wg;if(fr&&(fr=fr(l,Ot))){$a(ti,fr,x,Xt);break e}Wi&&Wi(l,Lt,Ot),l==="focusout"&&Ot&&Lt.type==="number"&&Ot.memoizedProps.value!=null&&qa(Lt,"number",Lt.value)}switch(Wi=Ot?Mi(Ot):window,l){case"focusin":(ts(Wi)||Wi.contentEditable==="true")&&(Xl=Wi,If=Ot,xo=null);break;case"focusout":xo=If=Xl=null;break;case"mousedown":Rf=!0;break;case"contextmenu":case"mouseup":case"dragend":Rf=!1,vd(ti,x,Xt);break;case"selectionchange":if(yd)break;case"keydown":case"keyup":vd(ti,x,Xt)}var Nn;if(Wp)e:{switch(l){case"compositionstart":var er="onCompositionStart";break e;case"compositionend":er="onCompositionEnd";break e;case"compositionupdate":er="onCompositionUpdate";break e}er=void 0}else Cs?gd(l,x)&&(er="onCompositionEnd"):l==="keydown"&&x.keyCode===229&&(er="onCompositionStart");er&&(hh&&x.locale!=="ko"&&(Cs||er!=="onCompositionStart"?er==="onCompositionEnd"&&Cs&&(Nn=wf()):(yo=Xt,ou="value"in yo?yo.value:yo.textContent,Cs=!0)),Wi=Pm(Ot,er),0<Wi.length&&(er=new $p(er,l,null,x,Xt),ti.push({event:er,listeners:Wi}),Nn?er.data=Nn:(Nn=$s(x),Nn!==null&&(er.data=Nn)))),(Nn=Xp?Oo(l,x):Yp(l,x))&&(er=Pm(Ot,"onBeforeInput"),0<er.length&&(Wi=new $p("onBeforeInput","beforeinput",null,x,Xt),ti.push({event:Wi,listeners:er}),Wi.data=Nn)),Mv(ti,l,Ot,x,Xt)}Mm(ti,p)})}function rf(l,p,x){return{instance:l,listener:p,currentTarget:x}}function Pm(l,p){for(var x=p+"Capture",A=[];l!==null;){var k=l,j=k.stateNode;if(k=k.tag,k!==5&&k!==26&&k!==27||j===null||(k=oh(l,x),k!=null&&A.unshift(rf(l,k,j)),k=oh(l,p),k!=null&&A.push(rf(l,k,j))),l.tag===3)return A;l=l.return}return[]}function $x(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function Ov(l,p,x,A,k){for(var j=p._reactName,oe=[];x!==null&&x!==A;){var Ie=x,et=Ie.alternate,Ot=Ie.stateNode;if(Ie=Ie.tag,et!==null&&et===A)break;Ie!==5&&Ie!==26&&Ie!==27||Ot===null||(et=Ot,k?(Ot=oh(x,j),Ot!=null&&oe.unshift(rf(x,Ot,et))):k||(Ot=oh(x,j),Ot!=null&&oe.push(rf(x,Ot,et)))),x=x.return}oe.length!==0&&l.push({event:p,listeners:oe})}var Zx=/\r\n?/g,Pv=/\u0000|\uFFFD/g;function iy(l){return(typeof l=="string"?l:""+l).replace(Zx,`
`).replace(Pv,"")}function zv(l,p){return p=iy(p),iy(l)===p}function Br(l,p,x,A,k,j){switch(x){case"children":typeof A=="string"?p==="body"||p==="textarea"&&A===""||vl(l,A):(typeof A=="number"||typeof A=="bigint")&&p!=="body"&&vl(l,""+A);break;case"className":On(l,"class",A);break;case"tabIndex":On(l,"tabindex",A);break;case"dir":case"role":case"viewBox":case"width":case"height":On(l,x,A);break;case"style":xf(l,A,j);break;case"data":if(p!=="object"){On(l,"data",A);break}case"src":case"href":if(A===""&&(p!=="a"||x!=="href")){l.removeAttribute(x);break}if(A==null||typeof A=="function"||typeof A=="symbol"||typeof A=="boolean"){l.removeAttribute(x);break}A=Ra(""+A),l.setAttribute(x,A);break;case"action":case"formAction":if(typeof A=="function"){l.setAttribute(x,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof j=="function"&&(x==="formAction"?(p!=="input"&&Br(l,p,"name",k.name,k,null),Br(l,p,"formEncType",k.formEncType,k,null),Br(l,p,"formMethod",k.formMethod,k,null),Br(l,p,"formTarget",k.formTarget,k,null)):(Br(l,p,"encType",k.encType,k,null),Br(l,p,"method",k.method,k,null),Br(l,p,"target",k.target,k,null)));if(A==null||typeof A=="symbol"||typeof A=="boolean"){l.removeAttribute(x);break}A=Ra(""+A),l.setAttribute(x,A);break;case"onClick":A!=null&&(l.onclick=ds);break;case"onScroll":A!=null&&$n("scroll",l);break;case"onScrollEnd":A!=null&&$n("scrollend",l);break;case"dangerouslySetInnerHTML":if(A!=null){if(typeof A!="object"||!("__html"in A))throw Error(T(61));if(x=A.__html,x!=null){if(k.children!=null)throw Error(T(60));l.innerHTML=x}}break;case"multiple":l.multiple=A&&typeof A!="function"&&typeof A!="symbol";break;case"muted":l.muted=A&&typeof A!="function"&&typeof A!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(A==null||typeof A=="function"||typeof A=="boolean"||typeof A=="symbol"){l.removeAttribute("xlink:href");break}x=Ra(""+A),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",x);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":A!=null&&typeof A!="function"&&typeof A!="symbol"?l.setAttribute(x,""+A):l.removeAttribute(x);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":A&&typeof A!="function"&&typeof A!="symbol"?l.setAttribute(x,""):l.removeAttribute(x);break;case"capture":case"download":A===!0?l.setAttribute(x,""):A!==!1&&A!=null&&typeof A!="function"&&typeof A!="symbol"?l.setAttribute(x,A):l.removeAttribute(x);break;case"cols":case"rows":case"size":case"span":A!=null&&typeof A!="function"&&typeof A!="symbol"&&!isNaN(A)&&1<=A?l.setAttribute(x,A):l.removeAttribute(x);break;case"rowSpan":case"start":A==null||typeof A=="function"||typeof A=="symbol"||isNaN(A)?l.removeAttribute(x):l.setAttribute(x,A);break;case"popover":$n("beforetoggle",l),$n("toggle",l),Dn(l,"popover",A);break;case"xlinkActuate":Un(l,"http://www.w3.org/1999/xlink","xlink:actuate",A);break;case"xlinkArcrole":Un(l,"http://www.w3.org/1999/xlink","xlink:arcrole",A);break;case"xlinkRole":Un(l,"http://www.w3.org/1999/xlink","xlink:role",A);break;case"xlinkShow":Un(l,"http://www.w3.org/1999/xlink","xlink:show",A);break;case"xlinkTitle":Un(l,"http://www.w3.org/1999/xlink","xlink:title",A);break;case"xlinkType":Un(l,"http://www.w3.org/1999/xlink","xlink:type",A);break;case"xmlBase":Un(l,"http://www.w3.org/XML/1998/namespace","xml:base",A);break;case"xmlLang":Un(l,"http://www.w3.org/XML/1998/namespace","xml:lang",A);break;case"xmlSpace":Un(l,"http://www.w3.org/XML/1998/namespace","xml:space",A);break;case"is":Dn(l,"is",A);break;case"innerText":case"textContent":break;default:(!(2<x.length)||x[0]!=="o"&&x[0]!=="O"||x[1]!=="n"&&x[1]!=="N")&&(x=As.get(x)||x,Dn(l,x,A))}}function ny(l,p,x,A,k,j){switch(x){case"style":xf(l,A,j);break;case"dangerouslySetInnerHTML":if(A!=null){if(typeof A!="object"||!("__html"in A))throw Error(T(61));if(x=A.__html,x!=null){if(k.children!=null)throw Error(T(60));l.innerHTML=x}}break;case"children":typeof A=="string"?vl(l,A):(typeof A=="number"||typeof A=="bigint")&&vl(l,""+A);break;case"onScroll":A!=null&&$n("scroll",l);break;case"onScrollEnd":A!=null&&$n("scrollend",l);break;case"onClick":A!=null&&(l.onclick=ds);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!jn.hasOwnProperty(x))e:{if(x[0]==="o"&&x[1]==="n"&&(k=x.endsWith("Capture"),p=x.slice(2,k?x.length-7:void 0),j=l[_e]||null,j=j!=null?j[x]:null,typeof j=="function"&&l.removeEventListener(p,j,k),typeof A=="function")){typeof j!="function"&&j!==null&&(x in l?l[x]=null:l.hasAttribute(x)&&l.removeAttribute(x)),l.addEventListener(p,A,k);break e}x in l?l[x]=A:A===!0?l.setAttribute(x,""):Dn(l,x,A)}}}function Vo(l,p,x){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":$n("error",l),$n("load",l);var A=!1,k=!1,j;for(j in x)if(x.hasOwnProperty(j)){var oe=x[j];if(oe!=null)switch(j){case"src":A=!0;break;case"srcSet":k=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(T(137,p));default:Br(l,p,j,oe,x,null)}}k&&Br(l,p,"srcSet",x.srcSet,x,null),A&&Br(l,p,"src",x.src,x,null);return;case"input":$n("invalid",l);var Ie=j=oe=k=null,et=null,Ot=null;for(A in x)if(x.hasOwnProperty(A)){var Xt=x[A];if(Xt!=null)switch(A){case"name":k=Xt;break;case"type":oe=Xt;break;case"checked":et=Xt;break;case"defaultChecked":Ot=Xt;break;case"value":j=Xt;break;case"defaultValue":Ie=Xt;break;case"children":case"dangerouslySetInnerHTML":if(Xt!=null)throw Error(T(137,p));break;default:Br(l,p,A,Xt,x,null)}}ro(l,j,Ie,et,Ot,oe,k,!1);return;case"select":$n("invalid",l),A=oe=j=null;for(k in x)if(x.hasOwnProperty(k)&&(Ie=x[k],Ie!=null))switch(k){case"value":j=Ie;break;case"defaultValue":oe=Ie;break;case"multiple":A=Ie;default:Br(l,p,k,Ie,x,null)}p=j,x=oe,l.multiple=!!A,p!=null?Ia(l,!!A,p,!1):x!=null&&Ia(l,!!A,x,!0);return;case"textarea":$n("invalid",l),j=k=A=null;for(oe in x)if(x.hasOwnProperty(oe)&&(Ie=x[oe],Ie!=null))switch(oe){case"value":A=Ie;break;case"defaultValue":k=Ie;break;case"children":j=Ie;break;case"dangerouslySetInnerHTML":if(Ie!=null)throw Error(T(91));break;default:Br(l,p,oe,Ie,x,null)}rh(l,A,k,j);return;case"option":for(et in x)if(x.hasOwnProperty(et)&&(A=x[et],A!=null))switch(et){case"selected":l.selected=A&&typeof A!="function"&&typeof A!="symbol";break;default:Br(l,p,et,A,x,null)}return;case"dialog":$n("beforetoggle",l),$n("toggle",l),$n("cancel",l),$n("close",l);break;case"iframe":case"object":$n("load",l);break;case"video":case"audio":for(A=0;A<Yh.length;A++)$n(Yh[A],l);break;case"image":$n("error",l),$n("load",l);break;case"details":$n("toggle",l);break;case"embed":case"source":case"link":$n("error",l),$n("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ot in x)if(x.hasOwnProperty(Ot)&&(A=x[Ot],A!=null))switch(Ot){case"children":case"dangerouslySetInnerHTML":throw Error(T(137,p));default:Br(l,p,Ot,A,x,null)}return;default:if(dd(p)){for(Xt in x)x.hasOwnProperty(Xt)&&(A=x[Xt],A!==void 0&&ny(l,p,Xt,A,x,void 0));return}}for(Ie in x)x.hasOwnProperty(Ie)&&(A=x[Ie],A!=null&&Br(l,p,Ie,A,x,null))}function Lv(l,p,x,A){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var k=null,j=null,oe=null,Ie=null,et=null,Ot=null,Xt=null;for(Vt in x){var ti=x[Vt];if(x.hasOwnProperty(Vt)&&ti!=null)switch(Vt){case"checked":break;case"value":break;case"defaultValue":et=ti;default:A.hasOwnProperty(Vt)||Br(l,p,Vt,null,A,ti)}}for(var Lt in A){var Vt=A[Lt];if(ti=x[Lt],A.hasOwnProperty(Lt)&&(Vt!=null||ti!=null))switch(Lt){case"type":j=Vt;break;case"name":k=Vt;break;case"checked":Ot=Vt;break;case"defaultChecked":Xt=Vt;break;case"value":oe=Vt;break;case"defaultValue":Ie=Vt;break;case"children":case"dangerouslySetInnerHTML":if(Vt!=null)throw Error(T(137,p));break;default:Vt!==ti&&Br(l,p,Lt,Vt,A,ti)}}_o(l,oe,Ie,et,Ot,Xt,j,k);return;case"select":Vt=oe=Ie=Lt=null;for(j in x)if(et=x[j],x.hasOwnProperty(j)&&et!=null)switch(j){case"value":break;case"multiple":Vt=et;default:A.hasOwnProperty(j)||Br(l,p,j,null,A,et)}for(k in A)if(j=A[k],et=x[k],A.hasOwnProperty(k)&&(j!=null||et!=null))switch(k){case"value":Lt=j;break;case"defaultValue":Ie=j;break;case"multiple":oe=j;default:j!==et&&Br(l,p,k,j,A,et)}p=Ie,x=oe,A=Vt,Lt!=null?Ia(l,!!x,Lt,!1):!!A!=!!x&&(p!=null?Ia(l,!!x,p,!0):Ia(l,!!x,x?[]:"",!1));return;case"textarea":Vt=Lt=null;for(Ie in x)if(k=x[Ie],x.hasOwnProperty(Ie)&&k!=null&&!A.hasOwnProperty(Ie))switch(Ie){case"value":break;case"children":break;default:Br(l,p,Ie,null,A,k)}for(oe in A)if(k=A[oe],j=x[oe],A.hasOwnProperty(oe)&&(k!=null||j!=null))switch(oe){case"value":Lt=k;break;case"defaultValue":Vt=k;break;case"children":break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(T(91));break;default:k!==j&&Br(l,p,oe,k,A,j)}Qo(l,Lt,Vt);return;case"option":for(var Vi in x)if(Lt=x[Vi],x.hasOwnProperty(Vi)&&Lt!=null&&!A.hasOwnProperty(Vi))switch(Vi){case"selected":l.selected=!1;break;default:Br(l,p,Vi,null,A,Lt)}for(et in A)if(Lt=A[et],Vt=x[et],A.hasOwnProperty(et)&&Lt!==Vt&&(Lt!=null||Vt!=null))switch(et){case"selected":l.selected=Lt&&typeof Lt!="function"&&typeof Lt!="symbol";break;default:Br(l,p,et,Lt,A,Vt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var nn in x)Lt=x[nn],x.hasOwnProperty(nn)&&Lt!=null&&!A.hasOwnProperty(nn)&&Br(l,p,nn,null,A,Lt);for(Ot in A)if(Lt=A[Ot],Vt=x[Ot],A.hasOwnProperty(Ot)&&Lt!==Vt&&(Lt!=null||Vt!=null))switch(Ot){case"children":case"dangerouslySetInnerHTML":if(Lt!=null)throw Error(T(137,p));break;default:Br(l,p,Ot,Lt,A,Vt)}return;default:if(dd(p)){for(var Ar in x)Lt=x[Ar],x.hasOwnProperty(Ar)&&Lt!==void 0&&!A.hasOwnProperty(Ar)&&ny(l,p,Ar,void 0,A,Lt);for(Xt in A)Lt=A[Xt],Vt=x[Xt],!A.hasOwnProperty(Xt)||Lt===Vt||Lt===void 0&&Vt===void 0||ny(l,p,Xt,Lt,A,Vt);return}}for(var xt in x)Lt=x[xt],x.hasOwnProperty(xt)&&Lt!=null&&!A.hasOwnProperty(xt)&&Br(l,p,xt,null,A,Lt);for(ti in A)Lt=A[ti],Vt=x[ti],!A.hasOwnProperty(ti)||Lt===Vt||Lt==null&&Vt==null||Br(l,p,ti,Lt,A,Vt)}function ry(l){switch(l){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function kv(){if(typeof performance.getEntriesByType=="function"){for(var l=0,p=0,x=performance.getEntriesByType("resource"),A=0;A<x.length;A++){var k=x[A],j=k.transferSize,oe=k.initiatorType,Ie=k.duration;if(j&&Ie&&ry(oe)){for(oe=0,Ie=k.responseEnd,A+=1;A<x.length;A++){var et=x[A],Ot=et.startTime;if(Ot>Ie)break;var Xt=et.transferSize,ti=et.initiatorType;Xt&&ry(ti)&&(et=et.responseEnd,oe+=Xt*(et<Ie?1:(Ie-Ot)/(et-Ot)))}if(--A,p+=8*(j+oe)/(k.duration/1e3),l++,10<l)break}}if(0<l)return p/l/1e6}return navigator.connection&&(l=navigator.connection.downlink,typeof l=="number")?l:5}var Vg=null,Gg=null;function zm(l){return l.nodeType===9?l:l.ownerDocument}function sy(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function qg(l,p){if(l===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&p==="foreignObject"?0:l}function Jc(l,p){return l==="textarea"||l==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var Ds=null;function Bv(){var l=window.event;return l&&l.type==="popstate"?l===Ds?!1:(Ds=l,!0):(Ds=null,!1)}var hp=typeof setTimeout=="function"?setTimeout:void 0,Wx=typeof clearTimeout=="function"?clearTimeout:void 0,Fv=typeof Promise=="function"?Promise:void 0,Xx=typeof queueMicrotask=="function"?queueMicrotask:typeof Fv<"u"?function(l){return Fv.resolve(null).then(l).catch(Yx)}:hp;function Yx(l){setTimeout(function(){throw l})}function hl(l){return l==="head"}function oy(l,p){var x=p,A=0;do{var k=x.nextSibling;if(l.removeChild(x),k&&k.nodeType===8)if(x=k.data,x==="/$"||x==="/&"){if(A===0){l.removeChild(k),yp(p);return}A--}else if(x==="$"||x==="$?"||x==="$~"||x==="$!"||x==="&")A++;else if(x==="html")km(l.ownerDocument.documentElement);else if(x==="head"){x=l.ownerDocument.head,km(x);for(var j=x.firstChild;j;){var oe=j.nextSibling,Ie=j.nodeName;j[vt]||Ie==="SCRIPT"||Ie==="STYLE"||Ie==="LINK"&&j.rel.toLowerCase()==="stylesheet"||x.removeChild(j),j=oe}}else x==="body"&&km(l.ownerDocument.body);x=k}while(x);yp(p)}function Kh(l,p){var x=l;l=0;do{var A=x.nextSibling;if(x.nodeType===1?p?(x._stashedDisplay=x.style.display,x.style.display="none"):(x.style.display=x._stashedDisplay||"",x.getAttribute("style")===""&&x.removeAttribute("style")):x.nodeType===3&&(p?(x._stashedText=x.nodeValue,x.nodeValue=""):x.nodeValue=x._stashedText||""),A&&A.nodeType===8)if(x=A.data,x==="/$"){if(l===0)break;l--}else x!=="$"&&x!=="$?"&&x!=="$~"&&x!=="$!"||l++;x=A}while(x)}function sf(l){var p=l.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var x=p;switch(p=p.nextSibling,x.nodeName){case"HTML":case"HEAD":case"BODY":sf(x),Zt(x);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(x.rel.toLowerCase()==="stylesheet")continue}l.removeChild(x)}}function Kx(l,p,x,A){for(;l.nodeType===1;){var k=x;if(l.nodeName.toLowerCase()!==p.toLowerCase()){if(!A&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(A){if(!l[vt])switch(p){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(j=l.getAttribute("rel"),j==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(j!==k.rel||l.getAttribute("href")!==(k.href==null||k.href===""?null:k.href)||l.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin)||l.getAttribute("title")!==(k.title==null?null:k.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(j=l.getAttribute("src"),(j!==(k.src==null?null:k.src)||l.getAttribute("type")!==(k.type==null?null:k.type)||l.getAttribute("crossorigin")!==(k.crossOrigin==null?null:k.crossOrigin))&&j&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(p==="input"&&l.type==="hidden"){var j=k.name==null?null:""+k.name;if(k.type==="hidden"&&l.getAttribute("name")===j)return l}else return l;if(l=Nl(l.nextSibling),l===null)break}return null}function Jx(l,p,x){if(p==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!x||(l=Nl(l.nextSibling),l===null))return null;return l}function Nv(l,p){for(;l.nodeType!==8;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!p||(l=Nl(l.nextSibling),l===null))return null;return l}function ay(l){return l.data==="$?"||l.data==="$~"}function ly(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState!=="loading"}function Qx(l,p){var x=l.ownerDocument;if(l.data==="$~")l._reactRetry=p;else if(l.data!=="$?"||x.readyState!=="loading")p();else{var A=function(){p(),x.removeEventListener("DOMContentLoaded",A)};x.addEventListener("DOMContentLoaded",A),l._reactRetry=A}}function Nl(l){for(;l!=null;l=l.nextSibling){var p=l.nodeType;if(p===1||p===3)break;if(p===8){if(p=l.data,p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"||p==="F!"||p==="F")break;if(p==="/$"||p==="/&")return null}}return l}var Lm=null;function jv(l){l=l.nextSibling;for(var p=0;l;){if(l.nodeType===8){var x=l.data;if(x==="/$"||x==="/&"){if(p===0)return Nl(l.nextSibling);p--}else x!=="$"&&x!=="$!"&&x!=="$?"&&x!=="$~"&&x!=="&"||p++}l=l.nextSibling}return null}function cy(l){l=l.previousSibling;for(var p=0;l;){if(l.nodeType===8){var x=l.data;if(x==="$"||x==="$!"||x==="$?"||x==="$~"||x==="&"){if(p===0)return l;p--}else x!=="/$"&&x!=="/&"||p++}l=l.previousSibling}return null}function dp(l,p,x){switch(p=zm(x),l){case"html":if(l=p.documentElement,!l)throw Error(T(452));return l;case"head":if(l=p.head,!l)throw Error(T(453));return l;case"body":if(l=p.body,!l)throw Error(T(454));return l;default:throw Error(T(451))}}function km(l){for(var p=l.attributes;p.length;)l.removeAttributeNode(p[0]);Zt(l)}var cr=new Map,of=new Set;function Bm(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var jl=gt.d;gt.d={f:Hg,r:Fm,D:Nm,C:hy,L:jm,m:eb,X:dy,S:Uv,M:fy};function Hg(){var l=jl.f(),p=Fn();return l||p}function Fm(l){var p=hi(l);p!==null&&p.tag===5&&p.type==="form"?mm(p):jl.r(l)}var af=typeof document>"u"?null:document;function uy(l,p,x){var A=af;if(A&&typeof p=="string"&&p){var k=rs(p);k='link[rel="'+l+'"][href="'+k+'"]',typeof x=="string"&&(k+='[crossorigin="'+x+'"]'),of.has(k)||(of.add(k),l={rel:l,crossOrigin:x,href:p},A.querySelector(k)===null&&(p=A.createElement("link"),Vo(p,"link",l),li(p),A.head.appendChild(p)))}}function Nm(l){jl.D(l),uy("dns-prefetch",l,null)}function hy(l,p){jl.C(l,p),uy("preconnect",l,p)}function jm(l,p,x){jl.L(l,p,x);var A=af;if(A&&l&&p){var k='link[rel="preload"][as="'+rs(p)+'"]';p==="image"&&x&&x.imageSrcSet?(k+='[imagesrcset="'+rs(x.imageSrcSet)+'"]',typeof x.imageSizes=="string"&&(k+='[imagesizes="'+rs(x.imageSizes)+'"]')):k+='[href="'+rs(l)+'"]';var j=k;switch(p){case"style":j=fp(l);break;case"script":j=Jh(l)}cr.has(j)||(l=Q({rel:"preload",href:p==="image"&&x&&x.imageSrcSet?void 0:l,as:p},x),cr.set(j,l),A.querySelector(k)!==null||p==="style"&&A.querySelector(po(j))||p==="script"&&A.querySelector(lf(j))||(p=A.createElement("link"),Vo(p,"link",l),li(p),A.head.appendChild(p)))}}function eb(l,p){jl.m(l,p);var x=af;if(x&&l){var A=p&&typeof p.as=="string"?p.as:"script",k='link[rel="modulepreload"][as="'+rs(A)+'"][href="'+rs(l)+'"]',j=k;switch(A){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":j=Jh(l)}if(!cr.has(j)&&(l=Q({rel:"modulepreload",href:l},p),cr.set(j,l),x.querySelector(k)===null)){switch(A){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(x.querySelector(lf(j)))return}A=x.createElement("link"),Vo(A,"link",l),li(A),x.head.appendChild(A)}}}function Uv(l,p,x){jl.S(l,p,x);var A=af;if(A&&l){var k=ji(A).hoistableStyles,j=fp(l);p=p||"default";var oe=k.get(j);if(!oe){var Ie={loading:0,preload:null};if(oe=A.querySelector(po(j)))Ie.loading=5;else{l=Q({rel:"stylesheet",href:l,"data-precedence":p},x),(x=cr.get(j))&&gy(l,x);var et=oe=A.createElement("link");li(et),Vo(et,"link",l),et._p=new Promise(function(Ot,Xt){et.onload=Ot,et.onerror=Xt}),et.addEventListener("load",function(){Ie.loading|=1}),et.addEventListener("error",function(){Ie.loading|=2}),Ie.loading|=4,mo(oe,p,A)}oe={type:"stylesheet",instance:oe,count:1,state:Ie},k.set(j,oe)}}}function dy(l,p){jl.X(l,p);var x=af;if(x&&l){var A=ji(x).hoistableScripts,k=Jh(l),j=A.get(k);j||(j=x.querySelector(lf(k)),j||(l=Q({src:l,async:!0},p),(p=cr.get(k))&&Um(l,p),j=x.createElement("script"),li(j),Vo(j,"link",l),x.head.appendChild(j)),j={type:"script",instance:j,count:1,state:null},A.set(k,j))}}function fy(l,p){jl.M(l,p);var x=af;if(x&&l){var A=ji(x).hoistableScripts,k=Jh(l),j=A.get(k);j||(j=x.querySelector(lf(k)),j||(l=Q({src:l,async:!0,type:"module"},p),(p=cr.get(k))&&Um(l,p),j=x.createElement("script"),li(j),Vo(j,"link",l),x.head.appendChild(j)),j={type:"script",instance:j,count:1,state:null},A.set(k,j))}}function Qc(l,p,x,A){var k=(k=Bi.current)?Bm(k):null;if(!k)throw Error(T(446));switch(l){case"meta":case"title":return null;case"style":return typeof x.precedence=="string"&&typeof x.href=="string"?(p=fp(x.href),x=ji(k).hoistableStyles,A=x.get(p),A||(A={type:"style",instance:null,count:0,state:null},x.set(p,A)),A):{type:"void",instance:null,count:0,state:null};case"link":if(x.rel==="stylesheet"&&typeof x.href=="string"&&typeof x.precedence=="string"){l=fp(x.href);var j=ji(k).hoistableStyles,oe=j.get(l);if(oe||(k=k.ownerDocument||k,oe={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},j.set(l,oe),(j=k.querySelector(po(l)))&&!j._p&&(oe.instance=j,oe.state.loading=5),cr.has(l)||(x={rel:"preload",as:"style",href:x.href,crossOrigin:x.crossOrigin,integrity:x.integrity,media:x.media,hrefLang:x.hrefLang,referrerPolicy:x.referrerPolicy},cr.set(l,x),j||py(k,l,x,oe.state))),p&&A===null)throw Error(T(528,""));return oe}if(p&&A!==null)throw Error(T(529,""));return null;case"script":return p=x.async,x=x.src,typeof x=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=Jh(x),x=ji(k).hoistableScripts,A=x.get(p),A||(A={type:"script",instance:null,count:0,state:null},x.set(p,A)),A):{type:"void",instance:null,count:0,state:null};default:throw Error(T(444,l))}}function fp(l){return'href="'+rs(l)+'"'}function po(l){return'link[rel="stylesheet"]['+l+"]"}function Vv(l){return Q({},l,{"data-precedence":l.precedence,precedence:null})}function py(l,p,x,A){l.querySelector('link[rel="preload"][as="style"]['+p+"]")?A.loading=1:(p=l.createElement("link"),A.preload=p,p.addEventListener("load",function(){return A.loading|=1}),p.addEventListener("error",function(){return A.loading|=2}),Vo(p,"link",x),li(p),l.head.appendChild(p))}function Jh(l){return'[src="'+rs(l)+'"]'}function lf(l){return"script[async]"+l}function my(l,p,x){if(p.count++,p.instance===null)switch(p.type){case"style":var A=l.querySelector('style[data-href~="'+rs(x.href)+'"]');if(A)return p.instance=A,li(A),A;var k=Q({},x,{"data-href":x.href,"data-precedence":x.precedence,href:null,precedence:null});return A=(l.ownerDocument||l).createElement("style"),li(A),Vo(A,"style",k),mo(A,x.precedence,l),p.instance=A;case"stylesheet":k=fp(x.href);var j=l.querySelector(po(k));if(j)return p.state.loading|=4,p.instance=j,li(j),j;A=Vv(x),(k=cr.get(k))&&gy(A,k),j=(l.ownerDocument||l).createElement("link"),li(j);var oe=j;return oe._p=new Promise(function(Ie,et){oe.onload=Ie,oe.onerror=et}),Vo(j,"link",A),p.state.loading|=4,mo(j,x.precedence,l),p.instance=j;case"script":return j=Jh(x.src),(k=l.querySelector(lf(j)))?(p.instance=k,li(k),k):(A=x,(k=cr.get(j))&&(A=Q({},x),Um(A,k)),l=l.ownerDocument||l,k=l.createElement("script"),li(k),Vo(k,"link",A),l.head.appendChild(k),p.instance=k);case"void":return null;default:throw Error(T(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(A=p.instance,p.state.loading|=4,mo(A,x.precedence,l));return p.instance}function mo(l,p,x){for(var A=x.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),k=A.length?A[A.length-1]:null,j=k,oe=0;oe<A.length;oe++){var Ie=A[oe];if(Ie.dataset.precedence===p)j=Ie;else if(j!==k)break}j?j.parentNode.insertBefore(l,j.nextSibling):(p=x.nodeType===9?x.head:x,p.insertBefore(l,p.firstChild))}function gy(l,p){l.crossOrigin==null&&(l.crossOrigin=p.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=p.referrerPolicy),l.title==null&&(l.title=p.title)}function Um(l,p){l.crossOrigin==null&&(l.crossOrigin=p.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=p.referrerPolicy),l.integrity==null&&(l.integrity=p.integrity)}var Qh=null;function cf(l,p,x){if(Qh===null){var A=new Map,k=Qh=new Map;k.set(x,A)}else k=Qh,A=k.get(x),A||(A=new Map,k.set(x,A));if(A.has(l))return A;for(A.set(l,null),x=x.getElementsByTagName(l),k=0;k<x.length;k++){var j=x[k];if(!(j[vt]||j[Me]||l==="link"&&j.getAttribute("rel")==="stylesheet")&&j.namespaceURI!=="http://www.w3.org/2000/svg"){var oe=j.getAttribute(p)||"";oe=l+oe;var Ie=A.get(oe);Ie?Ie.push(j):A.set(oe,[j])}}return A}function _y(l,p,x){l=l.ownerDocument||l,l.head.insertBefore(x,p==="title"?l.querySelector("head > title"):null)}function Gv(l,p,x){if(x===1||p.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;switch(p.rel){case"stylesheet":return l=p.disabled,typeof p.precedence=="string"&&l==null;default:return!0}case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function yy(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}function wa(l,p,x,A){if(x.type==="stylesheet"&&(typeof A.media!="string"||matchMedia(A.media).matches!==!1)&&(x.state.loading&4)===0){if(x.instance===null){var k=fp(A.href),j=p.querySelector(po(k));if(j){p=j._p,p!==null&&typeof p=="object"&&typeof p.then=="function"&&(l.count++,l=Gu.bind(l),p.then(l,l)),x.state.loading|=4,x.instance=j,li(j);return}j=p.ownerDocument||p,A=Vv(A),(k=cr.get(k))&&gy(A,k),j=j.createElement("link"),li(j);var oe=j;oe._p=new Promise(function(Ie,et){oe.onload=Ie,oe.onerror=et}),Vo(j,"link",A),x.instance=j}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(x,p),(p=x.state.preload)&&(x.state.loading&3)===0&&(l.count++,x=Gu.bind(l),p.addEventListener("load",x),p.addEventListener("error",x))}}var uf=0;function qv(l,p){return l.stylesheets&&l.count===0&&pp(l,l.stylesheets),0<l.count||0<l.imgCount?function(x){var A=setTimeout(function(){if(l.stylesheets&&pp(l,l.stylesheets),l.unsuspend){var j=l.unsuspend;l.unsuspend=null,j()}},6e4+p);0<l.imgBytes&&uf===0&&(uf=62500*kv());var k=setTimeout(function(){if(l.waitingForImages=!1,l.count===0&&(l.stylesheets&&pp(l,l.stylesheets),l.unsuspend)){var j=l.unsuspend;l.unsuspend=null,j()}},(l.imgBytes>uf?50:800)+p);return l.unsuspend=x,function(){l.unsuspend=null,clearTimeout(A),clearTimeout(k)}}:null}function Gu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)pp(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var dl=null;function pp(l,p){l.stylesheets=null,l.unsuspend!==null&&(l.count++,dl=new Map,p.forEach(ed,l),dl=null,Gu.call(l))}function ed(l,p){if(!(p.state.loading&4)){var x=dl.get(l);if(x)var A=x.get(null);else{x=new Map,dl.set(l,x);for(var k=l.querySelectorAll("link[data-precedence],style[data-precedence]"),j=0;j<k.length;j++){var oe=k[j];(oe.nodeName==="LINK"||oe.getAttribute("media")!=="not all")&&(x.set(oe.dataset.precedence,oe),A=oe)}A&&x.set(null,A)}k=p.instance,oe=k.getAttribute("data-precedence"),j=x.get(oe)||A,j===A&&x.set(null,k),x.set(oe,k),this.count++,A=Gu.bind(this),k.addEventListener("load",A),k.addEventListener("error",A),j?j.parentNode.insertBefore(k,j.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(k,l.firstChild)),p.state.loading|=4}}var Ul={$$typeof:Ue,Provider:null,Consumer:null,_currentValue:yt,_currentValue2:yt,_threadCount:0};function $g(l,p,x,A,k,j,oe,Ie,et){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Xr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xr(0),this.hiddenUpdates=Xr(null),this.identifierPrefix=A,this.onUncaughtError=k,this.onCaughtError=j,this.onRecoverableError=oe,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=et,this.incompleteTransitions=new Map}function Zg(l,p,x,A,k,j,oe,Ie,et,Ot,Xt,ti){return l=new $g(l,p,x,oe,et,Ot,Xt,ti,Ie),p=1,j===!0&&(p|=24),j=Lo(3,null,null,p),l.current=j,j.stateNode=l,p=wh(),p.refCount++,l.pooledCache=p,p.refCount++,j.memoizedState={element:A,isDehydrated:x,cache:p},Ld(j),l}function Wg(l){return l?(l=Tl,l):Tl}function Hv(l,p,x,A,k,j){k=Wg(k),A.context===null?A.context=k:A.pendingContext=k,A=Ml(p),A.payload={element:x},j=j===void 0?null:j,j!==null&&(A.callback=j),x=ac(l,A,p),x!==null&&(Di(x,l,p),xu(x,l,p))}function $v(l,p){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var x=l.retryLane;l.retryLane=x!==0&&x<p?x:p}}function vy(l,p){$v(l,p),(l=l.alternate)&&$v(l,p)}function Zv(l){if(l.tag===13||l.tag===31){var p=zt(l,67108864);p!==null&&Di(p,l,67108864),vy(l,67108864)}}function xy(l){if(l.tag===13||l.tag===31){var p=Tn();p=Ni(p);var x=zt(l,p);x!==null&&Di(x,l,p),vy(l,p)}}var Vm=!0;function Xg(l,p,x,A){var k=Xe.T;Xe.T=null;var j=gt.p;try{gt.p=2,mp(l,p,x,A)}finally{gt.p=j,Xe.T=k}}function Wv(l,p,x,A){var k=Xe.T;Xe.T=null;var j=gt.p;try{gt.p=8,mp(l,p,x,A)}finally{gt.p=j,Xe.T=k}}function mp(l,p,x,A){if(Vm){var k=Yg(A);if(k===null)Ug(l,p,A,hf,x),qm(l,A);else if(Kv(k,l,p,x,A))A.stopPropagation();else if(qm(l,A),p&4&&-1<Yv.indexOf(l)){for(;k!==null;){var j=hi(k);if(j!==null)switch(j.tag){case 3:if(j=j.stateNode,j.current.memoizedState.isDehydrated){var oe=ot(j.pendingLanes);if(oe!==0){var Ie=j;for(Ie.pendingLanes|=2,Ie.entangledLanes|=2;oe;){var et=1<<31-Gr(oe);Ie.entanglements[1]|=et,oe&=~et}Yc(j),(Pe&6)===0&&(Pi=tr()+500,Xh(0))}}break;case 31:case 13:Ie=zt(j,2),Ie!==null&&Di(Ie,j,2),Fn(),vy(j,2)}if(j=Yg(A),j===null&&Ug(l,p,A,hf,x),j===k)break;k=j}k!==null&&A.stopPropagation()}else Ug(l,p,A,null,x)}}function Yg(l){return l=Ac(l),by(l)}var hf=null;function by(l){if(hf=null,l=oi(l),l!==null){var p=D(l);if(p===null)l=null;else{var x=p.tag;if(x===13){if(l=B(p),l!==null)return l;l=null}else if(x===31){if(l=r(p),l!==null)return l;l=null}else if(x===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;l=null}else p!==l&&(l=null)}}return hf=l,null}function Xv(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ss()){case Ur:return 2;case Xo:return 8;case io:case Co:return 32;case Vr:return 268435456;default:return 32}default:return 32}}var Gm=!1,qu=null,eu=null,tu=null,gp=new Map,_p=new Map,Hu=[],Yv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function qm(l,p){switch(l){case"focusin":case"focusout":qu=null;break;case"dragenter":case"dragleave":eu=null;break;case"mouseover":case"mouseout":tu=null;break;case"pointerover":case"pointerout":gp.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":_p.delete(p.pointerId)}}function ja(l,p,x,A,k,j){return l===null||l.nativeEvent!==j?(l={blockedOn:p,domEventName:x,eventSystemFlags:A,nativeEvent:j,targetContainers:[k]},p!==null&&(p=hi(p),p!==null&&Zv(p)),l):(l.eventSystemFlags|=A,p=l.targetContainers,k!==null&&p.indexOf(k)===-1&&p.push(k),l)}function Kv(l,p,x,A,k){switch(p){case"focusin":return qu=ja(qu,l,p,x,A,k),!0;case"dragenter":return eu=ja(eu,l,p,x,A,k),!0;case"mouseover":return tu=ja(tu,l,p,x,A,k),!0;case"pointerover":var j=k.pointerId;return gp.set(j,ja(gp.get(j)||null,l,p,x,A,k)),!0;case"gotpointercapture":return j=k.pointerId,_p.set(j,ja(_p.get(j)||null,l,p,x,A,k)),!0}return!1}function Jv(l){var p=oi(l.target);if(p!==null){var x=D(p);if(x!==null){if(p=x.tag,p===13){if(p=B(x),p!==null){l.blockedOn=p,re(l.priority,function(){xy(x)});return}}else if(p===31){if(p=r(x),p!==null){l.blockedOn=p,re(l.priority,function(){xy(x)});return}}else if(p===3&&x.stateNode.current.memoizedState.isDehydrated){l.blockedOn=x.tag===3?x.stateNode.containerInfo:null;return}}}l.blockedOn=null}function Kg(l){if(l.blockedOn!==null)return!1;for(var p=l.targetContainers;0<p.length;){var x=Yg(l.nativeEvent);if(x===null){x=l.nativeEvent;var A=new x.constructor(x.type,x);Ma=A,x.target.dispatchEvent(A),Ma=null}else return p=hi(x),p!==null&&Zv(p),l.blockedOn=x,!1;p.shift()}return!0}function Qv(l,p,x){Kg(l)&&x.delete(p)}function tb(){Gm=!1,qu!==null&&Kg(qu)&&(qu=null),eu!==null&&Kg(eu)&&(eu=null),tu!==null&&Kg(tu)&&(tu=null),gp.forEach(Qv),_p.forEach(Qv)}function Jg(l,p){l.blockedOn===p&&(l.blockedOn=null,Gm||(Gm=!0,d.unstable_scheduleCallback(d.unstable_NormalPriority,tb)))}var Qg=null;function e0(l){Qg!==l&&(Qg=l,d.unstable_scheduleCallback(d.unstable_NormalPriority,function(){Qg===l&&(Qg=null);for(var p=0;p<l.length;p+=3){var x=l[p],A=l[p+1],k=l[p+2];if(typeof A!="function"){if(by(A||x)===null)continue;break}var j=hi(x);j!==null&&(l.splice(p,3),p-=3,Gd(j,{pending:!0,data:k,method:x.method,action:A},A,k))}}))}function yp(l){function p(et){return Jg(et,l)}qu!==null&&Jg(qu,l),eu!==null&&Jg(eu,l),tu!==null&&Jg(tu,l),gp.forEach(p),_p.forEach(p);for(var x=0;x<Hu.length;x++){var A=Hu[x];A.blockedOn===l&&(A.blockedOn=null)}for(;0<Hu.length&&(x=Hu[0],x.blockedOn===null);)Jv(x),x.blockedOn===null&&Hu.shift();if(x=(l.ownerDocument||l).$$reactFormReplay,x!=null)for(A=0;A<x.length;A+=3){var k=x[A],j=x[A+1],oe=k[_e]||null;if(typeof j=="function")oe||e0(x);else if(oe){var Ie=null;if(j&&j.hasAttribute("formAction")){if(k=j,oe=j[_e]||null)Ie=oe.formAction;else if(by(k)!==null)continue}else Ie=oe.action;typeof Ie=="function"?x[A+1]=Ie:(x.splice(A,3),A-=3),e0(x)}}}function vp(){function l(j){j.canIntercept&&j.info==="react-transition"&&j.intercept({handler:function(){return new Promise(function(oe){return k=oe})},focusReset:"manual",scroll:"manual"})}function p(){k!==null&&(k(),k=null),A||setTimeout(x,20)}function x(){if(!A&&!navigation.transition){var j=navigation.currentEntry;j&&j.url!=null&&navigation.navigate(j.url,{state:j.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var A=!1,k=null;return navigation.addEventListener("navigate",l),navigation.addEventListener("navigatesuccess",p),navigation.addEventListener("navigateerror",p),setTimeout(x,100),function(){A=!0,navigation.removeEventListener("navigate",l),navigation.removeEventListener("navigatesuccess",p),navigation.removeEventListener("navigateerror",p),k!==null&&(k(),k=null)}}}function wy(l){this._internalRoot=l}Hm.prototype.render=wy.prototype.render=function(l){var p=this._internalRoot;if(p===null)throw Error(T(409));var x=p.current,A=Tn();Hv(x,A,l,p,null,null)},Hm.prototype.unmount=wy.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var p=l.containerInfo;Hv(l.current,2,null,l,null,null),Fn(),p[ke]=null}};function Hm(l){this._internalRoot=l}Hm.prototype.unstable_scheduleHydration=function(l){if(l){var p=J();l={blockedOn:null,target:l,priority:p};for(var x=0;x<Hu.length&&p!==0&&p<Hu[x].priority;x++);Hu.splice(x,0,l),x===0&&Jv(l)}};var $m=h.version;if($m!=="19.2.1")throw Error(T(527,$m,"19.2.1"));gt.findDOMNode=function(l){var p=l._reactInternals;if(p===void 0)throw typeof l.render=="function"?Error(T(188)):(l=Object.keys(l).join(","),Error(T(268,l)));return l=H(p),l=l!==null?ie(l):null,l=l===null?null:l.stateNode,l};var t0={bundleType:0,version:"19.2.1",rendererPackageName:"react-dom",currentDispatcherRef:Xe,reconcilerVersion:"19.2.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xp.isDisabled&&xp.supportsFiber)try{Yo=xp.inject(t0),$r=xp}catch{}}return tv.createRoot=function(l,p){if(!R(l))throw Error(T(299));var x=!1,A="",k=kg,j=qn,oe=$i;return p!=null&&(p.unstable_strictMode===!0&&(x=!0),p.identifierPrefix!==void 0&&(A=p.identifierPrefix),p.onUncaughtError!==void 0&&(k=p.onUncaughtError),p.onCaughtError!==void 0&&(j=p.onCaughtError),p.onRecoverableError!==void 0&&(oe=p.onRecoverableError)),p=Zg(l,1,!1,null,null,x,A,null,k,j,oe,vp),l[ke]=p.current,jg(l),new wy(p)},tv.hydrateRoot=function(l,p,x){if(!R(l))throw Error(T(299));var A=!1,k="",j=kg,oe=qn,Ie=$i,et=null;return x!=null&&(x.unstable_strictMode===!0&&(A=!0),x.identifierPrefix!==void 0&&(k=x.identifierPrefix),x.onUncaughtError!==void 0&&(j=x.onUncaughtError),x.onCaughtError!==void 0&&(oe=x.onCaughtError),x.onRecoverableError!==void 0&&(Ie=x.onRecoverableError),x.formState!==void 0&&(et=x.formState)),p=Zg(l,1,!0,p,x??null,A,k,et,j,oe,Ie,vp),p.context=Wg(null),x=p.current,A=Tn(),A=Ni(A),k=Ml(A),k.callback=null,ac(x,k,A),x=A,p.current.lanes=x,Gn(p,x),Yc(p),l[ke]=p.current,jg(l),new Hm(p)},tv.version="19.2.1",tv}var w2;function BP(){if(w2)return lw.exports;w2=1;function d(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(d)}catch(h){console.error(h)}}return d(),lw.exports=kP(),lw.exports}var FP=BP(),NP=(d,h,_,T,R,D,B,r)=>{let q=document.documentElement,H=["light","dark"];function ie(we){(Array.isArray(d)?d:[d]).forEach(Ae=>{let he=Ae==="class",Re=he&&D?R.map(Ne=>D[Ne]||Ne):R;he?(q.classList.remove(...Re),q.classList.add(D&&D[we]?D[we]:we)):q.setAttribute(Ae,we)}),Q(we)}function Q(we){r&&H.includes(we)&&(q.style.colorScheme=we)}function me(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(T)ie(T);else try{let we=localStorage.getItem(h)||_,Ae=B&&we==="system"?me():we;ie(Ae)}catch{}},jP=le.createContext(void 0),UP={setTheme:d=>{},themes:[]},VP=()=>{var d;return(d=le.useContext(jP))!=null?d:UP};le.memo(({forcedTheme:d,storageKey:h,attribute:_,enableSystem:T,enableColorScheme:R,defaultTheme:D,value:B,themes:r,nonce:q,scriptProps:H})=>{let ie=JSON.stringify([_,h,D,d,r,B,T,R]).slice(1,-1);return le.createElement("script",{...H,suppressHydrationWarning:!0,nonce:typeof window>"u"?q:"",dangerouslySetInnerHTML:{__html:`(${NP.toString()})(${ie})`}})});var bv=XA();const YA=_1(bv);function GP(d){if(typeof document>"u")return;let h=document.head||document.getElementsByTagName("head")[0],_=document.createElement("style");_.type="text/css",h.appendChild(_),_.styleSheet?_.styleSheet.cssText=d:_.appendChild(document.createTextNode(d))}const qP=d=>{switch(d){case"success":return ZP;case"info":return XP;case"warning":return WP;case"error":return YP;default:return null}},HP=Array(12).fill(0),$P=({visible:d,className:h})=>pi.createElement("div",{className:["sonner-loading-wrapper",h].filter(Boolean).join(" "),"data-visible":d},pi.createElement("div",{className:"sonner-spinner"},HP.map((_,T)=>pi.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${T}`})))),ZP=pi.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},pi.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),WP=pi.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},pi.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),XP=pi.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},pi.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),YP=pi.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},pi.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),KP=pi.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},pi.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),pi.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),JP=()=>{const[d,h]=pi.useState(document.hidden);return pi.useEffect(()=>{const _=()=>{h(document.hidden)};return document.addEventListener("visibilitychange",_),()=>window.removeEventListener("visibilitychange",_)},[]),d};let jw=1;class QP{constructor(){this.subscribe=h=>(this.subscribers.push(h),()=>{const _=this.subscribers.indexOf(h);this.subscribers.splice(_,1)}),this.publish=h=>{this.subscribers.forEach(_=>_(h))},this.addToast=h=>{this.publish(h),this.toasts=[...this.toasts,h]},this.create=h=>{var _;const{message:T,...R}=h,D=typeof h?.id=="number"||((_=h.id)==null?void 0:_.length)>0?h.id:jw++,B=this.toasts.find(q=>q.id===D),r=h.dismissible===void 0?!0:h.dismissible;return this.dismissedToasts.has(D)&&this.dismissedToasts.delete(D),B?this.toasts=this.toasts.map(q=>q.id===D?(this.publish({...q,...h,id:D,title:T}),{...q,...h,id:D,dismissible:r,title:T}):q):this.addToast({title:T,...R,dismissible:r,id:D}),D},this.dismiss=h=>(h?(this.dismissedToasts.add(h),requestAnimationFrame(()=>this.subscribers.forEach(_=>_({id:h,dismiss:!0})))):this.toasts.forEach(_=>{this.subscribers.forEach(T=>T({id:_.id,dismiss:!0}))}),h),this.message=(h,_)=>this.create({..._,message:h}),this.error=(h,_)=>this.create({..._,message:h,type:"error"}),this.success=(h,_)=>this.create({..._,type:"success",message:h}),this.info=(h,_)=>this.create({..._,type:"info",message:h}),this.warning=(h,_)=>this.create({..._,type:"warning",message:h}),this.loading=(h,_)=>this.create({..._,type:"loading",message:h}),this.promise=(h,_)=>{if(!_)return;let T;_.loading!==void 0&&(T=this.create({..._,promise:h,type:"loading",message:_.loading,description:typeof _.description!="function"?_.description:void 0}));const R=Promise.resolve(h instanceof Function?h():h);let D=T!==void 0,B;const r=R.then(async H=>{if(B=["resolve",H],pi.isValidElement(H))D=!1,this.create({id:T,type:"default",message:H});else if(tz(H)&&!H.ok){D=!1;const Q=typeof _.error=="function"?await _.error(`HTTP error! status: ${H.status}`):_.error,me=typeof _.description=="function"?await _.description(`HTTP error! status: ${H.status}`):_.description,Ae=typeof Q=="object"&&!pi.isValidElement(Q)?Q:{message:Q};this.create({id:T,type:"error",description:me,...Ae})}else if(H instanceof Error){D=!1;const Q=typeof _.error=="function"?await _.error(H):_.error,me=typeof _.description=="function"?await _.description(H):_.description,Ae=typeof Q=="object"&&!pi.isValidElement(Q)?Q:{message:Q};this.create({id:T,type:"error",description:me,...Ae})}else if(_.success!==void 0){D=!1;const Q=typeof _.success=="function"?await _.success(H):_.success,me=typeof _.description=="function"?await _.description(H):_.description,Ae=typeof Q=="object"&&!pi.isValidElement(Q)?Q:{message:Q};this.create({id:T,type:"success",description:me,...Ae})}}).catch(async H=>{if(B=["reject",H],_.error!==void 0){D=!1;const ie=typeof _.error=="function"?await _.error(H):_.error,Q=typeof _.description=="function"?await _.description(H):_.description,we=typeof ie=="object"&&!pi.isValidElement(ie)?ie:{message:ie};this.create({id:T,type:"error",description:Q,...we})}}).finally(()=>{D&&(this.dismiss(T),T=void 0),_.finally==null||_.finally.call(_)}),q=()=>new Promise((H,ie)=>r.then(()=>B[0]==="reject"?ie(B[1]):H(B[1])).catch(ie));return typeof T!="string"&&typeof T!="number"?{unwrap:q}:Object.assign(T,{unwrap:q})},this.custom=(h,_)=>{const T=_?.id||jw++;return this.create({jsx:h(T),id:T,..._}),T},this.getActiveToasts=()=>this.toasts.filter(h=>!this.dismissedToasts.has(h.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Vl=new QP,ez=(d,h)=>{const _=h?.id||jw++;return Vl.addToast({title:d,...h,id:_}),_},tz=d=>d&&typeof d=="object"&&"ok"in d&&typeof d.ok=="boolean"&&"status"in d&&typeof d.status=="number",iz=ez,nz=()=>Vl.toasts,rz=()=>Vl.getActiveToasts(),ns=Object.assign(iz,{success:Vl.success,info:Vl.info,warning:Vl.warning,error:Vl.error,custom:Vl.custom,message:Vl.message,promise:Vl.promise,dismiss:Vl.dismiss,loading:Vl.loading},{getHistory:nz,getToasts:rz});GP("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function U0(d){return d.label!==void 0}const sz=3,oz="24px",az="16px",T2=4e3,lz=356,cz=14,uz=45,hz=200;function sd(...d){return d.filter(Boolean).join(" ")}function dz(d){const[h,_]=d.split("-"),T=[];return h&&T.push(h),_&&T.push(_),T}const fz=d=>{var h,_,T,R,D,B,r,q,H;const{invert:ie,toast:Q,unstyled:me,interacting:we,setHeights:Ae,visibleToasts:he,heights:Re,index:Ne,toasts:Ge,expanded:Ue,removeToast:rt,defaultRichColors:Pt,closeButton:Bt,style:Tt,cancelButtonStyle:Ht,actionButtonStyle:Ei,className:rn="",descriptionClassName:en="",duration:Ui,position:si,gap:Ji,expandByDefault:Si,classNames:Xe,icons:gt,closeButtonAriaLabel:yt="Close toast"}=d,[mi,Ci]=pi.useState(null),[Fe,wt]=pi.useState(null),[bt,Gt]=pi.useState(!1),[ci,Bi]=pi.useState(!1),[Qt,Ii]=pi.useState(!1),[fi,Ri]=pi.useState(!1),[Fi,Oi]=pi.useState(!1),[vn,Mr]=pi.useState(0),[Vs,Gs]=pi.useState(0),Jr=pi.useRef(Q.duration||Ui||T2),Cn=pi.useRef(null),ws=pi.useRef(null),Ts=Ne===0,Aa=Ne+1<=he,_r=Q.type,go=Q.dismissible!==!1,tr=Q.className||"",Ss=Q.descriptionClassName||"",Ur=pi.useMemo(()=>Re.findIndex(It=>It.toastId===Q.id)||0,[Re,Q.id]),Xo=pi.useMemo(()=>{var It;return(It=Q.closeButton)!=null?It:Bt},[Q.closeButton,Bt]),io=pi.useMemo(()=>Q.duration||Ui||T2,[Q.duration,Ui]),Co=pi.useRef(0),Vr=pi.useRef(0),Ps=pi.useRef(0),Wr=pi.useRef(null),[Yo,$r]=si.split("-"),yr=pi.useMemo(()=>Re.reduce((It,ui,Mn)=>Mn>=Ur?It:It+ui.height,0),[Re,Ur]),Gr=JP(),ha=Q.invert||ie,Ko=_r==="loading";Vr.current=pi.useMemo(()=>Ur*Ji+yr,[Ur,yr]),pi.useEffect(()=>{Jr.current=io},[io]),pi.useEffect(()=>{Gt(!0)},[]),pi.useEffect(()=>{const It=ws.current;if(It){const ui=It.getBoundingClientRect().height;return Gs(ui),Ae(Mn=>[{toastId:Q.id,height:ui,position:Q.position},...Mn]),()=>Ae(Mn=>Mn.filter(In=>In.toastId!==Q.id))}},[Ae,Q.id]),pi.useLayoutEffect(()=>{if(!bt)return;const It=ws.current,ui=It.style.height;It.style.height="auto";const Mn=It.getBoundingClientRect().height;It.style.height=ui,Gs(Mn),Ae(In=>In.find(Gn=>Gn.toastId===Q.id)?In.map(Gn=>Gn.toastId===Q.id?{...Gn,height:Mn}:Gn):[{toastId:Q.id,height:Mn,position:Q.position},...In])},[bt,Q.title,Q.description,Ae,Q.id,Q.jsx,Q.action,Q.cancel]);const Es=pi.useCallback(()=>{Bi(!0),Mr(Vr.current),Ae(It=>It.filter(ui=>ui.toastId!==Q.id)),setTimeout(()=>{rt(Q)},hz)},[Q,rt,Ae,Vr]);pi.useEffect(()=>{if(Q.promise&&_r==="loading"||Q.duration===1/0||Q.type==="loading")return;let It;return Ue||we||Gr?(()=>{if(Ps.current<Co.current){const In=new Date().getTime()-Co.current;Jr.current=Jr.current-In}Ps.current=new Date().getTime()})():(()=>{Jr.current!==1/0&&(Co.current=new Date().getTime(),It=setTimeout(()=>{Q.onAutoClose==null||Q.onAutoClose.call(Q,Q),Es()},Jr.current))})(),()=>clearTimeout(It)},[Ue,we,Q,_r,Gr,Es]),pi.useEffect(()=>{Q.delete&&(Es(),Q.onDismiss==null||Q.onDismiss.call(Q,Q))},[Es,Q.delete]);function Io(){var It;if(gt?.loading){var ui;return pi.createElement("div",{className:sd(Xe?.loader,Q==null||(ui=Q.classNames)==null?void 0:ui.loader,"sonner-loader"),"data-visible":_r==="loading"},gt.loading)}return pi.createElement($P,{className:sd(Xe?.loader,Q==null||(It=Q.classNames)==null?void 0:It.loader),visible:_r==="loading"})}const Ro=Q.icon||gt?.[_r]||qP(_r);var Jo,ot;return pi.createElement("li",{tabIndex:0,ref:ws,className:sd(rn,tr,Xe?.toast,Q==null||(h=Q.classNames)==null?void 0:h.toast,Xe?.default,Xe?.[_r],Q==null||(_=Q.classNames)==null?void 0:_[_r]),"data-sonner-toast":"","data-rich-colors":(Jo=Q.richColors)!=null?Jo:Pt,"data-styled":!(Q.jsx||Q.unstyled||me),"data-mounted":bt,"data-promise":!!Q.promise,"data-swiped":Fi,"data-removed":ci,"data-visible":Aa,"data-y-position":Yo,"data-x-position":$r,"data-index":Ne,"data-front":Ts,"data-swiping":Qt,"data-dismissible":go,"data-type":_r,"data-invert":ha,"data-swipe-out":fi,"data-swipe-direction":Fe,"data-expanded":!!(Ue||Si&&bt),"data-testid":Q.testId,style:{"--index":Ne,"--toasts-before":Ne,"--z-index":Ge.length-Ne,"--offset":`${ci?vn:Vr.current}px`,"--initial-height":Si?"auto":`${Vs}px`,...Tt,...Q.style},onDragEnd:()=>{Ii(!1),Ci(null),Wr.current=null},onPointerDown:It=>{It.button!==2&&(Ko||!go||(Cn.current=new Date,Mr(Vr.current),It.target.setPointerCapture(It.pointerId),It.target.tagName!=="BUTTON"&&(Ii(!0),Wr.current={x:It.clientX,y:It.clientY})))},onPointerUp:()=>{var It,ui,Mn;if(fi||!go)return;Wr.current=null;const In=Number(((It=ws.current)==null?void 0:It.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Xr=Number(((ui=ws.current)==null?void 0:ui.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Gn=new Date().getTime()-((Mn=Cn.current)==null?void 0:Mn.getTime()),pt=mi==="x"?In:Xr,Yn=Math.abs(pt)/Gn;if(Math.abs(pt)>=uz||Yn>.11){Mr(Vr.current),Q.onDismiss==null||Q.onDismiss.call(Q,Q),wt(mi==="x"?In>0?"right":"left":Xr>0?"down":"up"),Es(),Ri(!0);return}else{var or,vr;(or=ws.current)==null||or.style.setProperty("--swipe-amount-x","0px"),(vr=ws.current)==null||vr.style.setProperty("--swipe-amount-y","0px")}Oi(!1),Ii(!1),Ci(null)},onPointerMove:It=>{var ui,Mn,In;if(!Wr.current||!go||((ui=window.getSelection())==null?void 0:ui.toString().length)>0)return;const Gn=It.clientY-Wr.current.y,pt=It.clientX-Wr.current.x;var Yn;const or=(Yn=d.swipeDirections)!=null?Yn:dz(si);!mi&&(Math.abs(pt)>1||Math.abs(Gn)>1)&&Ci(Math.abs(pt)>Math.abs(Gn)?"x":"y");let vr={x:0,y:0};const Ni=Le=>1/(1.5+Math.abs(Le)/20);if(mi==="y"){if(or.includes("top")||or.includes("bottom"))if(or.includes("top")&&Gn<0||or.includes("bottom")&&Gn>0)vr.y=Gn;else{const Le=Gn*Ni(Gn);vr.y=Math.abs(Le)<Math.abs(Gn)?Le:Gn}}else if(mi==="x"&&(or.includes("left")||or.includes("right")))if(or.includes("left")&&pt<0||or.includes("right")&&pt>0)vr.x=pt;else{const Le=pt*Ni(pt);vr.x=Math.abs(Le)<Math.abs(pt)?Le:pt}(Math.abs(vr.x)>0||Math.abs(vr.y)>0)&&Oi(!0),(Mn=ws.current)==null||Mn.style.setProperty("--swipe-amount-x",`${vr.x}px`),(In=ws.current)==null||In.style.setProperty("--swipe-amount-y",`${vr.y}px`)}},Xo&&!Q.jsx&&_r!=="loading"?pi.createElement("button",{"aria-label":yt,"data-disabled":Ko,"data-close-button":!0,onClick:Ko||!go?()=>{}:()=>{Es(),Q.onDismiss==null||Q.onDismiss.call(Q,Q)},className:sd(Xe?.closeButton,Q==null||(T=Q.classNames)==null?void 0:T.closeButton)},(ot=gt?.close)!=null?ot:KP):null,(_r||Q.icon||Q.promise)&&Q.icon!==null&&(gt?.[_r]!==null||Q.icon)?pi.createElement("div",{"data-icon":"",className:sd(Xe?.icon,Q==null||(R=Q.classNames)==null?void 0:R.icon)},Q.promise||Q.type==="loading"&&!Q.icon?Q.icon||Io():null,Q.type!=="loading"?Ro:null):null,pi.createElement("div",{"data-content":"",className:sd(Xe?.content,Q==null||(D=Q.classNames)==null?void 0:D.content)},pi.createElement("div",{"data-title":"",className:sd(Xe?.title,Q==null||(B=Q.classNames)==null?void 0:B.title)},Q.jsx?Q.jsx:typeof Q.title=="function"?Q.title():Q.title),Q.description?pi.createElement("div",{"data-description":"",className:sd(en,Ss,Xe?.description,Q==null||(r=Q.classNames)==null?void 0:r.description)},typeof Q.description=="function"?Q.description():Q.description):null),pi.isValidElement(Q.cancel)?Q.cancel:Q.cancel&&U0(Q.cancel)?pi.createElement("button",{"data-button":!0,"data-cancel":!0,style:Q.cancelButtonStyle||Ht,onClick:It=>{U0(Q.cancel)&&go&&(Q.cancel.onClick==null||Q.cancel.onClick.call(Q.cancel,It),Es())},className:sd(Xe?.cancelButton,Q==null||(q=Q.classNames)==null?void 0:q.cancelButton)},Q.cancel.label):null,pi.isValidElement(Q.action)?Q.action:Q.action&&U0(Q.action)?pi.createElement("button",{"data-button":!0,"data-action":!0,style:Q.actionButtonStyle||Ei,onClick:It=>{U0(Q.action)&&(Q.action.onClick==null||Q.action.onClick.call(Q.action,It),!It.defaultPrevented&&Es())},className:sd(Xe?.actionButton,Q==null||(H=Q.classNames)==null?void 0:H.actionButton)},Q.action.label):null)};function S2(){if(typeof window>"u"||typeof document>"u")return"ltr";const d=document.documentElement.getAttribute("dir");return d==="auto"||!d?window.getComputedStyle(document.documentElement).direction:d}function pz(d,h){const _={};return[d,h].forEach((T,R)=>{const D=R===1,B=D?"--mobile-offset":"--offset",r=D?az:oz;function q(H){["top","right","bottom","left"].forEach(ie=>{_[`${B}-${ie}`]=typeof H=="number"?`${H}px`:H})}typeof T=="number"||typeof T=="string"?q(T):typeof T=="object"?["top","right","bottom","left"].forEach(H=>{T[H]===void 0?_[`${B}-${H}`]=r:_[`${B}-${H}`]=typeof T[H]=="number"?`${T[H]}px`:T[H]}):q(r)}),_}const mz=pi.forwardRef(function(h,_){const{id:T,invert:R,position:D="bottom-right",hotkey:B=["altKey","KeyT"],expand:r,closeButton:q,className:H,offset:ie,mobileOffset:Q,theme:me="light",richColors:we,duration:Ae,style:he,visibleToasts:Re=sz,toastOptions:Ne,dir:Ge=S2(),gap:Ue=cz,icons:rt,containerAriaLabel:Pt="Notifications"}=h,[Bt,Tt]=pi.useState([]),Ht=pi.useMemo(()=>T?Bt.filter(bt=>bt.toasterId===T):Bt.filter(bt=>!bt.toasterId),[Bt,T]),Ei=pi.useMemo(()=>Array.from(new Set([D].concat(Ht.filter(bt=>bt.position).map(bt=>bt.position)))),[Ht,D]),[rn,en]=pi.useState([]),[Ui,si]=pi.useState(!1),[Ji,Si]=pi.useState(!1),[Xe,gt]=pi.useState(me!=="system"?me:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),yt=pi.useRef(null),mi=B.join("+").replace(/Key/g,"").replace(/Digit/g,""),Ci=pi.useRef(null),Fe=pi.useRef(!1),wt=pi.useCallback(bt=>{Tt(Gt=>{var ci;return(ci=Gt.find(Bi=>Bi.id===bt.id))!=null&&ci.delete||Vl.dismiss(bt.id),Gt.filter(({id:Bi})=>Bi!==bt.id)})},[]);return pi.useEffect(()=>Vl.subscribe(bt=>{if(bt.dismiss){requestAnimationFrame(()=>{Tt(Gt=>Gt.map(ci=>ci.id===bt.id?{...ci,delete:!0}:ci))});return}setTimeout(()=>{YA.flushSync(()=>{Tt(Gt=>{const ci=Gt.findIndex(Bi=>Bi.id===bt.id);return ci!==-1?[...Gt.slice(0,ci),{...Gt[ci],...bt},...Gt.slice(ci+1)]:[bt,...Gt]})})})}),[Bt]),pi.useEffect(()=>{if(me!=="system"){gt(me);return}if(me==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?gt("dark"):gt("light")),typeof window>"u")return;const bt=window.matchMedia("(prefers-color-scheme: dark)");try{bt.addEventListener("change",({matches:Gt})=>{gt(Gt?"dark":"light")})}catch{bt.addListener(({matches:ci})=>{try{gt(ci?"dark":"light")}catch(Bi){console.error(Bi)}})}},[me]),pi.useEffect(()=>{Bt.length<=1&&si(!1)},[Bt]),pi.useEffect(()=>{const bt=Gt=>{var ci;if(B.every(Ii=>Gt[Ii]||Gt.code===Ii)){var Qt;si(!0),(Qt=yt.current)==null||Qt.focus()}Gt.code==="Escape"&&(document.activeElement===yt.current||(ci=yt.current)!=null&&ci.contains(document.activeElement))&&si(!1)};return document.addEventListener("keydown",bt),()=>document.removeEventListener("keydown",bt)},[B]),pi.useEffect(()=>{if(yt.current)return()=>{Ci.current&&(Ci.current.focus({preventScroll:!0}),Ci.current=null,Fe.current=!1)}},[yt.current]),pi.createElement("section",{ref:_,"aria-label":`${Pt} ${mi}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},Ei.map((bt,Gt)=>{var ci;const[Bi,Qt]=bt.split("-");return Ht.length?pi.createElement("ol",{key:bt,dir:Ge==="auto"?S2():Ge,tabIndex:-1,ref:yt,className:H,"data-sonner-toaster":!0,"data-sonner-theme":Xe,"data-y-position":Bi,"data-x-position":Qt,style:{"--front-toast-height":`${((ci=rn[0])==null?void 0:ci.height)||0}px`,"--width":`${lz}px`,"--gap":`${Ue}px`,...he,...pz(ie,Q)},onBlur:Ii=>{Fe.current&&!Ii.currentTarget.contains(Ii.relatedTarget)&&(Fe.current=!1,Ci.current&&(Ci.current.focus({preventScroll:!0}),Ci.current=null))},onFocus:Ii=>{Ii.target instanceof HTMLElement&&Ii.target.dataset.dismissible==="false"||Fe.current||(Fe.current=!0,Ci.current=Ii.relatedTarget)},onMouseEnter:()=>si(!0),onMouseMove:()=>si(!0),onMouseLeave:()=>{Ji||si(!1)},onDragEnd:()=>si(!1),onPointerDown:Ii=>{Ii.target instanceof HTMLElement&&Ii.target.dataset.dismissible==="false"||Si(!0)},onPointerUp:()=>Si(!1)},Ht.filter(Ii=>!Ii.position&&Gt===0||Ii.position===bt).map((Ii,fi)=>{var Ri,Fi;return pi.createElement(fz,{key:Ii.id,icons:rt,index:fi,toast:Ii,defaultRichColors:we,duration:(Ri=Ne?.duration)!=null?Ri:Ae,className:Ne?.className,descriptionClassName:Ne?.descriptionClassName,invert:R,visibleToasts:Re,closeButton:(Fi=Ne?.closeButton)!=null?Fi:q,interacting:Ji,position:bt,style:Ne?.style,unstyled:Ne?.unstyled,classNames:Ne?.classNames,cancelButtonStyle:Ne?.cancelButtonStyle,actionButtonStyle:Ne?.actionButtonStyle,closeButtonAriaLabel:Ne?.closeButtonAriaLabel,removeToast:wt,toasts:Ht.filter(Oi=>Oi.position==Ii.position),heights:rn.filter(Oi=>Oi.position==Ii.position),setHeights:en,expandByDefault:r,gap:Ue,expanded:Ui,swipeDirections:h.swipeDirections})})):null}))}),gz=({...d})=>{const{theme:h="system"}=VP();return ee.jsx(mz,{theme:h,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...d})};function Rr(d,h,{checkForDefaultPrevented:_=!0}={}){return function(R){if(d?.(R),_===!1||!R.defaultPrevented)return h?.(R)}}function E2(d,h){if(typeof d=="function")return d(h);d!=null&&(d.current=h)}function KA(...d){return h=>{let _=!1;const T=d.map(R=>{const D=E2(R,h);return!_&&typeof D=="function"&&(_=!0),D});if(_)return()=>{for(let R=0;R<T.length;R++){const D=T[R];typeof D=="function"?D():E2(d[R],null)}}}}function xs(...d){return le.useCallback(KA(...d),d)}function _z(d,h){const _=le.createContext(h),T=D=>{const{children:B,...r}=D,q=le.useMemo(()=>r,Object.values(r));return ee.jsx(_.Provider,{value:q,children:B})};T.displayName=d+"Provider";function R(D){const B=le.useContext(_);if(B)return B;if(h!==void 0)return h;throw new Error(`\`${D}\` must be used within \`${d}\``)}return[T,R]}function Np(d,h=[]){let _=[];function T(D,B){const r=le.createContext(B),q=_.length;_=[..._,B];const H=Q=>{const{scope:me,children:we,...Ae}=Q,he=me?.[d]?.[q]||r,Re=le.useMemo(()=>Ae,Object.values(Ae));return ee.jsx(he.Provider,{value:Re,children:we})};H.displayName=D+"Provider";function ie(Q,me){const we=me?.[d]?.[q]||r,Ae=le.useContext(we);if(Ae)return Ae;if(B!==void 0)return B;throw new Error(`\`${Q}\` must be used within \`${D}\``)}return[H,ie]}const R=()=>{const D=_.map(B=>le.createContext(B));return function(r){const q=r?.[d]||D;return le.useMemo(()=>({[`__scope${d}`]:{...r,[d]:q}}),[r,q])}};return R.scopeName=d,[T,yz(R,...h)]}function yz(...d){const h=d[0];if(d.length===1)return h;const _=()=>{const T=d.map(R=>({useScope:R(),scopeName:R.scopeName}));return function(D){const B=T.reduce((r,{useScope:q,scopeName:H})=>{const Q=q(D)[`__scope${H}`];return{...r,...Q}},{});return le.useMemo(()=>({[`__scope${h.scopeName}`]:B}),[B])}};return _.scopeName=h.scopeName,_}function N_(d){const h=vz(d),_=le.forwardRef((T,R)=>{const{children:D,...B}=T,r=le.Children.toArray(D),q=r.find(bz);if(q){const H=q.props.children,ie=r.map(Q=>Q===q?le.Children.count(H)>1?le.Children.only(null):le.isValidElement(H)?H.props.children:null:Q);return ee.jsx(h,{...B,ref:R,children:le.isValidElement(H)?le.cloneElement(H,void 0,ie):null})}return ee.jsx(h,{...B,ref:R,children:D})});return _.displayName=`${d}.Slot`,_}var JA=N_("Slot");function vz(d){const h=le.forwardRef((_,T)=>{const{children:R,...D}=_;if(le.isValidElement(R)){const B=Tz(R),r=wz(D,R.props);return R.type!==le.Fragment&&(r.ref=T?KA(T,B):B),le.cloneElement(R,r)}return le.Children.count(R)>1?le.Children.only(null):null});return h.displayName=`${d}.SlotClone`,h}var QA=Symbol("radix.slottable");function xz(d){const h=({children:_})=>ee.jsx(ee.Fragment,{children:_});return h.displayName=`${d}.Slottable`,h.__radixId=QA,h}function bz(d){return le.isValidElement(d)&&typeof d.type=="function"&&"__radixId"in d.type&&d.type.__radixId===QA}function wz(d,h){const _={...h};for(const T in h){const R=d[T],D=h[T];/^on[A-Z]/.test(T)?R&&D?_[T]=(...r)=>{const q=D(...r);return R(...r),q}:R&&(_[T]=R):T==="style"?_[T]={...R,...D}:T==="className"&&(_[T]=[R,D].filter(Boolean).join(" "))}return{...d,..._}}function Tz(d){let h=Object.getOwnPropertyDescriptor(d.props,"ref")?.get,_=h&&"isReactWarning"in h&&h.isReactWarning;return _?d.ref:(h=Object.getOwnPropertyDescriptor(d,"ref")?.get,_=h&&"isReactWarning"in h&&h.isReactWarning,_?d.props.ref:d.props.ref||d.ref)}var Sz=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],hr=Sz.reduce((d,h)=>{const _=N_(`Primitive.${h}`),T=le.forwardRef((R,D)=>{const{asChild:B,...r}=R,q=B?_:h;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),ee.jsx(q,{...r,ref:D})});return T.displayName=`Primitive.${h}`,{...d,[h]:T}},{});function Ez(d,h){d&&bv.flushSync(()=>d.dispatchEvent(h))}function kp(d){const h=le.useRef(d);return le.useEffect(()=>{h.current=d}),le.useMemo(()=>(..._)=>h.current?.(..._),[])}function Az(d,h=globalThis?.document){const _=kp(d);le.useEffect(()=>{const T=R=>{R.key==="Escape"&&_(R)};return h.addEventListener("keydown",T,{capture:!0}),()=>h.removeEventListener("keydown",T,{capture:!0})},[_,h])}var Cz="DismissableLayer",Uw="dismissableLayer.update",Iz="dismissableLayer.pointerDownOutside",Rz="dismissableLayer.focusOutside",A2,eC=le.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ax=le.forwardRef((d,h)=>{const{disableOutsidePointerEvents:_=!1,onEscapeKeyDown:T,onPointerDownOutside:R,onFocusOutside:D,onInteractOutside:B,onDismiss:r,...q}=d,H=le.useContext(eC),[ie,Q]=le.useState(null),me=ie?.ownerDocument??globalThis?.document,[,we]=le.useState({}),Ae=xs(h,Tt=>Q(Tt)),he=Array.from(H.layers),[Re]=[...H.layersWithOutsidePointerEventsDisabled].slice(-1),Ne=he.indexOf(Re),Ge=ie?he.indexOf(ie):-1,Ue=H.layersWithOutsidePointerEventsDisabled.size>0,rt=Ge>=Ne,Pt=Oz(Tt=>{const Ht=Tt.target,Ei=[...H.branches].some(rn=>rn.contains(Ht));!rt||Ei||(R?.(Tt),B?.(Tt),Tt.defaultPrevented||r?.())},me),Bt=Pz(Tt=>{const Ht=Tt.target;[...H.branches].some(rn=>rn.contains(Ht))||(D?.(Tt),B?.(Tt),Tt.defaultPrevented||r?.())},me);return Az(Tt=>{Ge===H.layers.size-1&&(T?.(Tt),!Tt.defaultPrevented&&r&&(Tt.preventDefault(),r()))},me),le.useEffect(()=>{if(ie)return _&&(H.layersWithOutsidePointerEventsDisabled.size===0&&(A2=me.body.style.pointerEvents,me.body.style.pointerEvents="none"),H.layersWithOutsidePointerEventsDisabled.add(ie)),H.layers.add(ie),C2(),()=>{_&&H.layersWithOutsidePointerEventsDisabled.size===1&&(me.body.style.pointerEvents=A2)}},[ie,me,_,H]),le.useEffect(()=>()=>{ie&&(H.layers.delete(ie),H.layersWithOutsidePointerEventsDisabled.delete(ie),C2())},[ie,H]),le.useEffect(()=>{const Tt=()=>we({});return document.addEventListener(Uw,Tt),()=>document.removeEventListener(Uw,Tt)},[]),ee.jsx(hr.div,{...q,ref:Ae,style:{pointerEvents:Ue?rt?"auto":"none":void 0,...d.style},onFocusCapture:Rr(d.onFocusCapture,Bt.onFocusCapture),onBlurCapture:Rr(d.onBlurCapture,Bt.onBlurCapture),onPointerDownCapture:Rr(d.onPointerDownCapture,Pt.onPointerDownCapture)})});Ax.displayName=Cz;var Mz="DismissableLayerBranch",Dz=le.forwardRef((d,h)=>{const _=le.useContext(eC),T=le.useRef(null),R=xs(h,T);return le.useEffect(()=>{const D=T.current;if(D)return _.branches.add(D),()=>{_.branches.delete(D)}},[_.branches]),ee.jsx(hr.div,{...d,ref:R})});Dz.displayName=Mz;function Oz(d,h=globalThis?.document){const _=kp(d),T=le.useRef(!1),R=le.useRef(()=>{});return le.useEffect(()=>{const D=r=>{if(r.target&&!T.current){let q=function(){tC(Iz,_,H,{discrete:!0})};const H={originalEvent:r};r.pointerType==="touch"?(h.removeEventListener("click",R.current),R.current=q,h.addEventListener("click",R.current,{once:!0})):q()}else h.removeEventListener("click",R.current);T.current=!1},B=window.setTimeout(()=>{h.addEventListener("pointerdown",D)},0);return()=>{window.clearTimeout(B),h.removeEventListener("pointerdown",D),h.removeEventListener("click",R.current)}},[h,_]),{onPointerDownCapture:()=>T.current=!0}}function Pz(d,h=globalThis?.document){const _=kp(d),T=le.useRef(!1);return le.useEffect(()=>{const R=D=>{D.target&&!T.current&&tC(Rz,_,{originalEvent:D},{discrete:!1})};return h.addEventListener("focusin",R),()=>h.removeEventListener("focusin",R)},[h,_]),{onFocusCapture:()=>T.current=!0,onBlurCapture:()=>T.current=!1}}function C2(){const d=new CustomEvent(Uw);document.dispatchEvent(d)}function tC(d,h,_,{discrete:T}){const R=_.originalEvent.target,D=new CustomEvent(d,{bubbles:!1,cancelable:!0,detail:_});h&&R.addEventListener(d,h,{once:!0}),T?Ez(R,D):R.dispatchEvent(D)}var Wo=globalThis?.document?le.useLayoutEffect:()=>{},zz=x1[" useId ".trim().toString()]||(()=>{}),Lz=0;function z_(d){const[h,_]=le.useState(zz());return Wo(()=>{_(T=>T??String(Lz++))},[d]),d||(h?`radix-${h}`:"")}const kz=["top","right","bottom","left"],Bp=Math.min,wc=Math.max,ux=Math.round,V0=Math.floor,ld=d=>({x:d,y:d}),Bz={left:"right",right:"left",bottom:"top",top:"bottom"},Fz={start:"end",end:"start"};function Vw(d,h,_){return wc(d,Bp(h,_))}function _f(d,h){return typeof d=="function"?d(h):d}function yf(d){return d.split("-")[0]}function V_(d){return d.split("-")[1]}function b1(d){return d==="x"?"y":"x"}function w1(d){return d==="y"?"height":"width"}const Nz=new Set(["top","bottom"]);function ad(d){return Nz.has(yf(d))?"y":"x"}function T1(d){return b1(ad(d))}function jz(d,h,_){_===void 0&&(_=!1);const T=V_(d),R=T1(d),D=w1(R);let B=R==="x"?T===(_?"end":"start")?"right":"left":T==="start"?"bottom":"top";return h.reference[D]>h.floating[D]&&(B=hx(B)),[B,hx(B)]}function Uz(d){const h=hx(d);return[Gw(d),h,Gw(h)]}function Gw(d){return d.replace(/start|end/g,h=>Fz[h])}const I2=["left","right"],R2=["right","left"],Vz=["top","bottom"],Gz=["bottom","top"];function qz(d,h,_){switch(d){case"top":case"bottom":return _?h?R2:I2:h?I2:R2;case"left":case"right":return h?Vz:Gz;default:return[]}}function Hz(d,h,_,T){const R=V_(d);let D=qz(yf(d),_==="start",T);return R&&(D=D.map(B=>B+"-"+R),h&&(D=D.concat(D.map(Gw)))),D}function hx(d){return d.replace(/left|right|bottom|top/g,h=>Bz[h])}function $z(d){return{top:0,right:0,bottom:0,left:0,...d}}function iC(d){return typeof d!="number"?$z(d):{top:d,right:d,bottom:d,left:d}}function dx(d){const{x:h,y:_,width:T,height:R}=d;return{width:T,height:R,top:_,left:h,right:h+T,bottom:_+R,x:h,y:_}}function M2(d,h,_){let{reference:T,floating:R}=d;const D=ad(h),B=T1(h),r=w1(B),q=yf(h),H=D==="y",ie=T.x+T.width/2-R.width/2,Q=T.y+T.height/2-R.height/2,me=T[r]/2-R[r]/2;let we;switch(q){case"top":we={x:ie,y:T.y-R.height};break;case"bottom":we={x:ie,y:T.y+T.height};break;case"right":we={x:T.x+T.width,y:Q};break;case"left":we={x:T.x-R.width,y:Q};break;default:we={x:T.x,y:T.y}}switch(V_(h)){case"start":we[B]-=me*(_&&H?-1:1);break;case"end":we[B]+=me*(_&&H?-1:1);break}return we}const Zz=async(d,h,_)=>{const{placement:T="bottom",strategy:R="absolute",middleware:D=[],platform:B}=_,r=D.filter(Boolean),q=await(B.isRTL==null?void 0:B.isRTL(h));let H=await B.getElementRects({reference:d,floating:h,strategy:R}),{x:ie,y:Q}=M2(H,T,q),me=T,we={},Ae=0;for(let he=0;he<r.length;he++){const{name:Re,fn:Ne}=r[he],{x:Ge,y:Ue,data:rt,reset:Pt}=await Ne({x:ie,y:Q,initialPlacement:T,placement:me,strategy:R,middlewareData:we,rects:H,platform:B,elements:{reference:d,floating:h}});ie=Ge??ie,Q=Ue??Q,we={...we,[Re]:{...we[Re],...rt}},Pt&&Ae<=50&&(Ae++,typeof Pt=="object"&&(Pt.placement&&(me=Pt.placement),Pt.rects&&(H=Pt.rects===!0?await B.getElementRects({reference:d,floating:h,strategy:R}):Pt.rects),{x:ie,y:Q}=M2(H,me,q)),he=-1)}return{x:ie,y:Q,placement:me,strategy:R,middlewareData:we}};async function fv(d,h){var _;h===void 0&&(h={});const{x:T,y:R,platform:D,rects:B,elements:r,strategy:q}=d,{boundary:H="clippingAncestors",rootBoundary:ie="viewport",elementContext:Q="floating",altBoundary:me=!1,padding:we=0}=_f(h,d),Ae=iC(we),Re=r[me?Q==="floating"?"reference":"floating":Q],Ne=dx(await D.getClippingRect({element:(_=await(D.isElement==null?void 0:D.isElement(Re)))==null||_?Re:Re.contextElement||await(D.getDocumentElement==null?void 0:D.getDocumentElement(r.floating)),boundary:H,rootBoundary:ie,strategy:q})),Ge=Q==="floating"?{x:T,y:R,width:B.floating.width,height:B.floating.height}:B.reference,Ue=await(D.getOffsetParent==null?void 0:D.getOffsetParent(r.floating)),rt=await(D.isElement==null?void 0:D.isElement(Ue))?await(D.getScale==null?void 0:D.getScale(Ue))||{x:1,y:1}:{x:1,y:1},Pt=dx(D.convertOffsetParentRelativeRectToViewportRelativeRect?await D.convertOffsetParentRelativeRectToViewportRelativeRect({elements:r,rect:Ge,offsetParent:Ue,strategy:q}):Ge);return{top:(Ne.top-Pt.top+Ae.top)/rt.y,bottom:(Pt.bottom-Ne.bottom+Ae.bottom)/rt.y,left:(Ne.left-Pt.left+Ae.left)/rt.x,right:(Pt.right-Ne.right+Ae.right)/rt.x}}const Wz=d=>({name:"arrow",options:d,async fn(h){const{x:_,y:T,placement:R,rects:D,platform:B,elements:r,middlewareData:q}=h,{element:H,padding:ie=0}=_f(d,h)||{};if(H==null)return{};const Q=iC(ie),me={x:_,y:T},we=T1(R),Ae=w1(we),he=await B.getDimensions(H),Re=we==="y",Ne=Re?"top":"left",Ge=Re?"bottom":"right",Ue=Re?"clientHeight":"clientWidth",rt=D.reference[Ae]+D.reference[we]-me[we]-D.floating[Ae],Pt=me[we]-D.reference[we],Bt=await(B.getOffsetParent==null?void 0:B.getOffsetParent(H));let Tt=Bt?Bt[Ue]:0;(!Tt||!await(B.isElement==null?void 0:B.isElement(Bt)))&&(Tt=r.floating[Ue]||D.floating[Ae]);const Ht=rt/2-Pt/2,Ei=Tt/2-he[Ae]/2-1,rn=Bp(Q[Ne],Ei),en=Bp(Q[Ge],Ei),Ui=rn,si=Tt-he[Ae]-en,Ji=Tt/2-he[Ae]/2+Ht,Si=Vw(Ui,Ji,si),Xe=!q.arrow&&V_(R)!=null&&Ji!==Si&&D.reference[Ae]/2-(Ji<Ui?rn:en)-he[Ae]/2<0,gt=Xe?Ji<Ui?Ji-Ui:Ji-si:0;return{[we]:me[we]+gt,data:{[we]:Si,centerOffset:Ji-Si-gt,...Xe&&{alignmentOffset:gt}},reset:Xe}}}),Xz=function(d){return d===void 0&&(d={}),{name:"flip",options:d,async fn(h){var _,T;const{placement:R,middlewareData:D,rects:B,initialPlacement:r,platform:q,elements:H}=h,{mainAxis:ie=!0,crossAxis:Q=!0,fallbackPlacements:me,fallbackStrategy:we="bestFit",fallbackAxisSideDirection:Ae="none",flipAlignment:he=!0,...Re}=_f(d,h);if((_=D.arrow)!=null&&_.alignmentOffset)return{};const Ne=yf(R),Ge=ad(r),Ue=yf(r)===r,rt=await(q.isRTL==null?void 0:q.isRTL(H.floating)),Pt=me||(Ue||!he?[hx(r)]:Uz(r)),Bt=Ae!=="none";!me&&Bt&&Pt.push(...Hz(r,he,Ae,rt));const Tt=[r,...Pt],Ht=await fv(h,Re),Ei=[];let rn=((T=D.flip)==null?void 0:T.overflows)||[];if(ie&&Ei.push(Ht[Ne]),Q){const Ji=jz(R,B,rt);Ei.push(Ht[Ji[0]],Ht[Ji[1]])}if(rn=[...rn,{placement:R,overflows:Ei}],!Ei.every(Ji=>Ji<=0)){var en,Ui;const Ji=(((en=D.flip)==null?void 0:en.index)||0)+1,Si=Tt[Ji];if(Si&&(!(Q==="alignment"?Ge!==ad(Si):!1)||rn.every(yt=>ad(yt.placement)===Ge?yt.overflows[0]>0:!0)))return{data:{index:Ji,overflows:rn},reset:{placement:Si}};let Xe=(Ui=rn.filter(gt=>gt.overflows[0]<=0).sort((gt,yt)=>gt.overflows[1]-yt.overflows[1])[0])==null?void 0:Ui.placement;if(!Xe)switch(we){case"bestFit":{var si;const gt=(si=rn.filter(yt=>{if(Bt){const mi=ad(yt.placement);return mi===Ge||mi==="y"}return!0}).map(yt=>[yt.placement,yt.overflows.filter(mi=>mi>0).reduce((mi,Ci)=>mi+Ci,0)]).sort((yt,mi)=>yt[1]-mi[1])[0])==null?void 0:si[0];gt&&(Xe=gt);break}case"initialPlacement":Xe=r;break}if(R!==Xe)return{reset:{placement:Xe}}}return{}}}};function D2(d,h){return{top:d.top-h.height,right:d.right-h.width,bottom:d.bottom-h.height,left:d.left-h.width}}function O2(d){return kz.some(h=>d[h]>=0)}const Yz=function(d){return d===void 0&&(d={}),{name:"hide",options:d,async fn(h){const{rects:_}=h,{strategy:T="referenceHidden",...R}=_f(d,h);switch(T){case"referenceHidden":{const D=await fv(h,{...R,elementContext:"reference"}),B=D2(D,_.reference);return{data:{referenceHiddenOffsets:B,referenceHidden:O2(B)}}}case"escaped":{const D=await fv(h,{...R,altBoundary:!0}),B=D2(D,_.floating);return{data:{escapedOffsets:B,escaped:O2(B)}}}default:return{}}}}},nC=new Set(["left","top"]);async function Kz(d,h){const{placement:_,platform:T,elements:R}=d,D=await(T.isRTL==null?void 0:T.isRTL(R.floating)),B=yf(_),r=V_(_),q=ad(_)==="y",H=nC.has(B)?-1:1,ie=D&&q?-1:1,Q=_f(h,d);let{mainAxis:me,crossAxis:we,alignmentAxis:Ae}=typeof Q=="number"?{mainAxis:Q,crossAxis:0,alignmentAxis:null}:{mainAxis:Q.mainAxis||0,crossAxis:Q.crossAxis||0,alignmentAxis:Q.alignmentAxis};return r&&typeof Ae=="number"&&(we=r==="end"?Ae*-1:Ae),q?{x:we*ie,y:me*H}:{x:me*H,y:we*ie}}const Jz=function(d){return d===void 0&&(d=0),{name:"offset",options:d,async fn(h){var _,T;const{x:R,y:D,placement:B,middlewareData:r}=h,q=await Kz(h,d);return B===((_=r.offset)==null?void 0:_.placement)&&(T=r.arrow)!=null&&T.alignmentOffset?{}:{x:R+q.x,y:D+q.y,data:{...q,placement:B}}}}},Qz=function(d){return d===void 0&&(d={}),{name:"shift",options:d,async fn(h){const{x:_,y:T,placement:R}=h,{mainAxis:D=!0,crossAxis:B=!1,limiter:r={fn:Re=>{let{x:Ne,y:Ge}=Re;return{x:Ne,y:Ge}}},...q}=_f(d,h),H={x:_,y:T},ie=await fv(h,q),Q=ad(yf(R)),me=b1(Q);let we=H[me],Ae=H[Q];if(D){const Re=me==="y"?"top":"left",Ne=me==="y"?"bottom":"right",Ge=we+ie[Re],Ue=we-ie[Ne];we=Vw(Ge,we,Ue)}if(B){const Re=Q==="y"?"top":"left",Ne=Q==="y"?"bottom":"right",Ge=Ae+ie[Re],Ue=Ae-ie[Ne];Ae=Vw(Ge,Ae,Ue)}const he=r.fn({...h,[me]:we,[Q]:Ae});return{...he,data:{x:he.x-_,y:he.y-T,enabled:{[me]:D,[Q]:B}}}}}},eL=function(d){return d===void 0&&(d={}),{options:d,fn(h){const{x:_,y:T,placement:R,rects:D,middlewareData:B}=h,{offset:r=0,mainAxis:q=!0,crossAxis:H=!0}=_f(d,h),ie={x:_,y:T},Q=ad(R),me=b1(Q);let we=ie[me],Ae=ie[Q];const he=_f(r,h),Re=typeof he=="number"?{mainAxis:he,crossAxis:0}:{mainAxis:0,crossAxis:0,...he};if(q){const Ue=me==="y"?"height":"width",rt=D.reference[me]-D.floating[Ue]+Re.mainAxis,Pt=D.reference[me]+D.reference[Ue]-Re.mainAxis;we<rt?we=rt:we>Pt&&(we=Pt)}if(H){var Ne,Ge;const Ue=me==="y"?"width":"height",rt=nC.has(yf(R)),Pt=D.reference[Q]-D.floating[Ue]+(rt&&((Ne=B.offset)==null?void 0:Ne[Q])||0)+(rt?0:Re.crossAxis),Bt=D.reference[Q]+D.reference[Ue]+(rt?0:((Ge=B.offset)==null?void 0:Ge[Q])||0)-(rt?Re.crossAxis:0);Ae<Pt?Ae=Pt:Ae>Bt&&(Ae=Bt)}return{[me]:we,[Q]:Ae}}}},tL=function(d){return d===void 0&&(d={}),{name:"size",options:d,async fn(h){var _,T;const{placement:R,rects:D,platform:B,elements:r}=h,{apply:q=()=>{},...H}=_f(d,h),ie=await fv(h,H),Q=yf(R),me=V_(R),we=ad(R)==="y",{width:Ae,height:he}=D.floating;let Re,Ne;Q==="top"||Q==="bottom"?(Re=Q,Ne=me===(await(B.isRTL==null?void 0:B.isRTL(r.floating))?"start":"end")?"left":"right"):(Ne=Q,Re=me==="end"?"top":"bottom");const Ge=he-ie.top-ie.bottom,Ue=Ae-ie.left-ie.right,rt=Bp(he-ie[Re],Ge),Pt=Bp(Ae-ie[Ne],Ue),Bt=!h.middlewareData.shift;let Tt=rt,Ht=Pt;if((_=h.middlewareData.shift)!=null&&_.enabled.x&&(Ht=Ue),(T=h.middlewareData.shift)!=null&&T.enabled.y&&(Tt=Ge),Bt&&!me){const rn=wc(ie.left,0),en=wc(ie.right,0),Ui=wc(ie.top,0),si=wc(ie.bottom,0);we?Ht=Ae-2*(rn!==0||en!==0?rn+en:wc(ie.left,ie.right)):Tt=he-2*(Ui!==0||si!==0?Ui+si:wc(ie.top,ie.bottom))}await q({...h,availableWidth:Ht,availableHeight:Tt});const Ei=await B.getDimensions(r.floating);return Ae!==Ei.width||he!==Ei.height?{reset:{rects:!0}}:{}}}};function Cx(){return typeof window<"u"}function G_(d){return rC(d)?(d.nodeName||"").toLowerCase():"#document"}function Ec(d){var h;return(d==null||(h=d.ownerDocument)==null?void 0:h.defaultView)||window}function ud(d){var h;return(h=(rC(d)?d.ownerDocument:d.document)||window.document)==null?void 0:h.documentElement}function rC(d){return Cx()?d instanceof Node||d instanceof Ec(d).Node:!1}function th(d){return Cx()?d instanceof Element||d instanceof Ec(d).Element:!1}function cd(d){return Cx()?d instanceof HTMLElement||d instanceof Ec(d).HTMLElement:!1}function P2(d){return!Cx()||typeof ShadowRoot>"u"?!1:d instanceof ShadowRoot||d instanceof Ec(d).ShadowRoot}const iL=new Set(["inline","contents"]);function wv(d){const{overflow:h,overflowX:_,overflowY:T,display:R}=ih(d);return/auto|scroll|overlay|hidden|clip/.test(h+T+_)&&!iL.has(R)}const nL=new Set(["table","td","th"]);function rL(d){return nL.has(G_(d))}const sL=[":popover-open",":modal"];function Ix(d){return sL.some(h=>{try{return d.matches(h)}catch{return!1}})}const oL=["transform","translate","scale","rotate","perspective"],aL=["transform","translate","scale","rotate","perspective","filter"],lL=["paint","layout","strict","content"];function S1(d){const h=E1(),_=th(d)?ih(d):d;return oL.some(T=>_[T]?_[T]!=="none":!1)||(_.containerType?_.containerType!=="normal":!1)||!h&&(_.backdropFilter?_.backdropFilter!=="none":!1)||!h&&(_.filter?_.filter!=="none":!1)||aL.some(T=>(_.willChange||"").includes(T))||lL.some(T=>(_.contain||"").includes(T))}function cL(d){let h=Fp(d);for(;cd(h)&&!j_(h);){if(S1(h))return h;if(Ix(h))return null;h=Fp(h)}return null}function E1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const uL=new Set(["html","body","#document"]);function j_(d){return uL.has(G_(d))}function ih(d){return Ec(d).getComputedStyle(d)}function Rx(d){return th(d)?{scrollLeft:d.scrollLeft,scrollTop:d.scrollTop}:{scrollLeft:d.scrollX,scrollTop:d.scrollY}}function Fp(d){if(G_(d)==="html")return d;const h=d.assignedSlot||d.parentNode||P2(d)&&d.host||ud(d);return P2(h)?h.host:h}function sC(d){const h=Fp(d);return j_(h)?d.ownerDocument?d.ownerDocument.body:d.body:cd(h)&&wv(h)?h:sC(h)}function pv(d,h,_){var T;h===void 0&&(h=[]),_===void 0&&(_=!0);const R=sC(d),D=R===((T=d.ownerDocument)==null?void 0:T.body),B=Ec(R);if(D){const r=qw(B);return h.concat(B,B.visualViewport||[],wv(R)?R:[],r&&_?pv(r):[])}return h.concat(R,pv(R,[],_))}function qw(d){return d.parent&&Object.getPrototypeOf(d.parent)?d.frameElement:null}function oC(d){const h=ih(d);let _=parseFloat(h.width)||0,T=parseFloat(h.height)||0;const R=cd(d),D=R?d.offsetWidth:_,B=R?d.offsetHeight:T,r=ux(_)!==D||ux(T)!==B;return r&&(_=D,T=B),{width:_,height:T,$:r}}function A1(d){return th(d)?d:d.contextElement}function L_(d){const h=A1(d);if(!cd(h))return ld(1);const _=h.getBoundingClientRect(),{width:T,height:R,$:D}=oC(h);let B=(D?ux(_.width):_.width)/T,r=(D?ux(_.height):_.height)/R;return(!B||!Number.isFinite(B))&&(B=1),(!r||!Number.isFinite(r))&&(r=1),{x:B,y:r}}const hL=ld(0);function aC(d){const h=Ec(d);return!E1()||!h.visualViewport?hL:{x:h.visualViewport.offsetLeft,y:h.visualViewport.offsetTop}}function dL(d,h,_){return h===void 0&&(h=!1),!_||h&&_!==Ec(d)?!1:h}function pg(d,h,_,T){h===void 0&&(h=!1),_===void 0&&(_=!1);const R=d.getBoundingClientRect(),D=A1(d);let B=ld(1);h&&(T?th(T)&&(B=L_(T)):B=L_(d));const r=dL(D,_,T)?aC(D):ld(0);let q=(R.left+r.x)/B.x,H=(R.top+r.y)/B.y,ie=R.width/B.x,Q=R.height/B.y;if(D){const me=Ec(D),we=T&&th(T)?Ec(T):T;let Ae=me,he=qw(Ae);for(;he&&T&&we!==Ae;){const Re=L_(he),Ne=he.getBoundingClientRect(),Ge=ih(he),Ue=Ne.left+(he.clientLeft+parseFloat(Ge.paddingLeft))*Re.x,rt=Ne.top+(he.clientTop+parseFloat(Ge.paddingTop))*Re.y;q*=Re.x,H*=Re.y,ie*=Re.x,Q*=Re.y,q+=Ue,H+=rt,Ae=Ec(he),he=qw(Ae)}}return dx({width:ie,height:Q,x:q,y:H})}function Mx(d,h){const _=Rx(d).scrollLeft;return h?h.left+_:pg(ud(d)).left+_}function lC(d,h){const _=d.getBoundingClientRect(),T=_.left+h.scrollLeft-Mx(d,_),R=_.top+h.scrollTop;return{x:T,y:R}}function fL(d){let{elements:h,rect:_,offsetParent:T,strategy:R}=d;const D=R==="fixed",B=ud(T),r=h?Ix(h.floating):!1;if(T===B||r&&D)return _;let q={scrollLeft:0,scrollTop:0},H=ld(1);const ie=ld(0),Q=cd(T);if((Q||!Q&&!D)&&((G_(T)!=="body"||wv(B))&&(q=Rx(T)),cd(T))){const we=pg(T);H=L_(T),ie.x=we.x+T.clientLeft,ie.y=we.y+T.clientTop}const me=B&&!Q&&!D?lC(B,q):ld(0);return{width:_.width*H.x,height:_.height*H.y,x:_.x*H.x-q.scrollLeft*H.x+ie.x+me.x,y:_.y*H.y-q.scrollTop*H.y+ie.y+me.y}}function pL(d){return Array.from(d.getClientRects())}function mL(d){const h=ud(d),_=Rx(d),T=d.ownerDocument.body,R=wc(h.scrollWidth,h.clientWidth,T.scrollWidth,T.clientWidth),D=wc(h.scrollHeight,h.clientHeight,T.scrollHeight,T.clientHeight);let B=-_.scrollLeft+Mx(d);const r=-_.scrollTop;return ih(T).direction==="rtl"&&(B+=wc(h.clientWidth,T.clientWidth)-R),{width:R,height:D,x:B,y:r}}const z2=25;function gL(d,h){const _=Ec(d),T=ud(d),R=_.visualViewport;let D=T.clientWidth,B=T.clientHeight,r=0,q=0;if(R){D=R.width,B=R.height;const ie=E1();(!ie||ie&&h==="fixed")&&(r=R.offsetLeft,q=R.offsetTop)}const H=Mx(T);if(H<=0){const ie=T.ownerDocument,Q=ie.body,me=getComputedStyle(Q),we=ie.compatMode==="CSS1Compat"&&parseFloat(me.marginLeft)+parseFloat(me.marginRight)||0,Ae=Math.abs(T.clientWidth-Q.clientWidth-we);Ae<=z2&&(D-=Ae)}else H<=z2&&(D+=H);return{width:D,height:B,x:r,y:q}}const _L=new Set(["absolute","fixed"]);function yL(d,h){const _=pg(d,!0,h==="fixed"),T=_.top+d.clientTop,R=_.left+d.clientLeft,D=cd(d)?L_(d):ld(1),B=d.clientWidth*D.x,r=d.clientHeight*D.y,q=R*D.x,H=T*D.y;return{width:B,height:r,x:q,y:H}}function L2(d,h,_){let T;if(h==="viewport")T=gL(d,_);else if(h==="document")T=mL(ud(d));else if(th(h))T=yL(h,_);else{const R=aC(d);T={x:h.x-R.x,y:h.y-R.y,width:h.width,height:h.height}}return dx(T)}function cC(d,h){const _=Fp(d);return _===h||!th(_)||j_(_)?!1:ih(_).position==="fixed"||cC(_,h)}function vL(d,h){const _=h.get(d);if(_)return _;let T=pv(d,[],!1).filter(r=>th(r)&&G_(r)!=="body"),R=null;const D=ih(d).position==="fixed";let B=D?Fp(d):d;for(;th(B)&&!j_(B);){const r=ih(B),q=S1(B);!q&&r.position==="fixed"&&(R=null),(D?!q&&!R:!q&&r.position==="static"&&!!R&&_L.has(R.position)||wv(B)&&!q&&cC(d,B))?T=T.filter(ie=>ie!==B):R=r,B=Fp(B)}return h.set(d,T),T}function xL(d){let{element:h,boundary:_,rootBoundary:T,strategy:R}=d;const B=[..._==="clippingAncestors"?Ix(h)?[]:vL(h,this._c):[].concat(_),T],r=B[0],q=B.reduce((H,ie)=>{const Q=L2(h,ie,R);return H.top=wc(Q.top,H.top),H.right=Bp(Q.right,H.right),H.bottom=Bp(Q.bottom,H.bottom),H.left=wc(Q.left,H.left),H},L2(h,r,R));return{width:q.right-q.left,height:q.bottom-q.top,x:q.left,y:q.top}}function bL(d){const{width:h,height:_}=oC(d);return{width:h,height:_}}function wL(d,h,_){const T=cd(h),R=ud(h),D=_==="fixed",B=pg(d,!0,D,h);let r={scrollLeft:0,scrollTop:0};const q=ld(0);function H(){q.x=Mx(R)}if(T||!T&&!D)if((G_(h)!=="body"||wv(R))&&(r=Rx(h)),T){const we=pg(h,!0,D,h);q.x=we.x+h.clientLeft,q.y=we.y+h.clientTop}else R&&H();D&&!T&&R&&H();const ie=R&&!T&&!D?lC(R,r):ld(0),Q=B.left+r.scrollLeft-q.x-ie.x,me=B.top+r.scrollTop-q.y-ie.y;return{x:Q,y:me,width:B.width,height:B.height}}function dw(d){return ih(d).position==="static"}function k2(d,h){if(!cd(d)||ih(d).position==="fixed")return null;if(h)return h(d);let _=d.offsetParent;return ud(d)===_&&(_=_.ownerDocument.body),_}function uC(d,h){const _=Ec(d);if(Ix(d))return _;if(!cd(d)){let R=Fp(d);for(;R&&!j_(R);){if(th(R)&&!dw(R))return R;R=Fp(R)}return _}let T=k2(d,h);for(;T&&rL(T)&&dw(T);)T=k2(T,h);return T&&j_(T)&&dw(T)&&!S1(T)?_:T||cL(d)||_}const TL=async function(d){const h=this.getOffsetParent||uC,_=this.getDimensions,T=await _(d.floating);return{reference:wL(d.reference,await h(d.floating),d.strategy),floating:{x:0,y:0,width:T.width,height:T.height}}};function SL(d){return ih(d).direction==="rtl"}const EL={convertOffsetParentRelativeRectToViewportRelativeRect:fL,getDocumentElement:ud,getClippingRect:xL,getOffsetParent:uC,getElementRects:TL,getClientRects:pL,getDimensions:bL,getScale:L_,isElement:th,isRTL:SL};function hC(d,h){return d.x===h.x&&d.y===h.y&&d.width===h.width&&d.height===h.height}function AL(d,h){let _=null,T;const R=ud(d);function D(){var r;clearTimeout(T),(r=_)==null||r.disconnect(),_=null}function B(r,q){r===void 0&&(r=!1),q===void 0&&(q=1),D();const H=d.getBoundingClientRect(),{left:ie,top:Q,width:me,height:we}=H;if(r||h(),!me||!we)return;const Ae=V0(Q),he=V0(R.clientWidth-(ie+me)),Re=V0(R.clientHeight-(Q+we)),Ne=V0(ie),Ue={rootMargin:-Ae+"px "+-he+"px "+-Re+"px "+-Ne+"px",threshold:wc(0,Bp(1,q))||1};let rt=!0;function Pt(Bt){const Tt=Bt[0].intersectionRatio;if(Tt!==q){if(!rt)return B();Tt?B(!1,Tt):T=setTimeout(()=>{B(!1,1e-7)},1e3)}Tt===1&&!hC(H,d.getBoundingClientRect())&&B(),rt=!1}try{_=new IntersectionObserver(Pt,{...Ue,root:R.ownerDocument})}catch{_=new IntersectionObserver(Pt,Ue)}_.observe(d)}return B(!0),D}function CL(d,h,_,T){T===void 0&&(T={});const{ancestorScroll:R=!0,ancestorResize:D=!0,elementResize:B=typeof ResizeObserver=="function",layoutShift:r=typeof IntersectionObserver=="function",animationFrame:q=!1}=T,H=A1(d),ie=R||D?[...H?pv(H):[],...pv(h)]:[];ie.forEach(Ne=>{R&&Ne.addEventListener("scroll",_,{passive:!0}),D&&Ne.addEventListener("resize",_)});const Q=H&&r?AL(H,_):null;let me=-1,we=null;B&&(we=new ResizeObserver(Ne=>{let[Ge]=Ne;Ge&&Ge.target===H&&we&&(we.unobserve(h),cancelAnimationFrame(me),me=requestAnimationFrame(()=>{var Ue;(Ue=we)==null||Ue.observe(h)})),_()}),H&&!q&&we.observe(H),we.observe(h));let Ae,he=q?pg(d):null;q&&Re();function Re(){const Ne=pg(d);he&&!hC(he,Ne)&&_(),he=Ne,Ae=requestAnimationFrame(Re)}return _(),()=>{var Ne;ie.forEach(Ge=>{R&&Ge.removeEventListener("scroll",_),D&&Ge.removeEventListener("resize",_)}),Q?.(),(Ne=we)==null||Ne.disconnect(),we=null,q&&cancelAnimationFrame(Ae)}}const IL=Jz,RL=Qz,ML=Xz,DL=tL,OL=Yz,B2=Wz,PL=eL,zL=(d,h,_)=>{const T=new Map,R={platform:EL,..._},D={...R.platform,_c:T};return Zz(d,h,{...R,platform:D})};var LL=typeof document<"u",kL=function(){},rx=LL?le.useLayoutEffect:kL;function fx(d,h){if(d===h)return!0;if(typeof d!=typeof h)return!1;if(typeof d=="function"&&d.toString()===h.toString())return!0;let _,T,R;if(d&&h&&typeof d=="object"){if(Array.isArray(d)){if(_=d.length,_!==h.length)return!1;for(T=_;T--!==0;)if(!fx(d[T],h[T]))return!1;return!0}if(R=Object.keys(d),_=R.length,_!==Object.keys(h).length)return!1;for(T=_;T--!==0;)if(!{}.hasOwnProperty.call(h,R[T]))return!1;for(T=_;T--!==0;){const D=R[T];if(!(D==="_owner"&&d.$$typeof)&&!fx(d[D],h[D]))return!1}return!0}return d!==d&&h!==h}function dC(d){return typeof window>"u"?1:(d.ownerDocument.defaultView||window).devicePixelRatio||1}function F2(d,h){const _=dC(d);return Math.round(h*_)/_}function fw(d){const h=le.useRef(d);return rx(()=>{h.current=d}),h}function BL(d){d===void 0&&(d={});const{placement:h="bottom",strategy:_="absolute",middleware:T=[],platform:R,elements:{reference:D,floating:B}={},transform:r=!0,whileElementsMounted:q,open:H}=d,[ie,Q]=le.useState({x:0,y:0,strategy:_,placement:h,middlewareData:{},isPositioned:!1}),[me,we]=le.useState(T);fx(me,T)||we(T);const[Ae,he]=le.useState(null),[Re,Ne]=le.useState(null),Ge=le.useCallback(yt=>{yt!==Bt.current&&(Bt.current=yt,he(yt))},[]),Ue=le.useCallback(yt=>{yt!==Tt.current&&(Tt.current=yt,Ne(yt))},[]),rt=D||Ae,Pt=B||Re,Bt=le.useRef(null),Tt=le.useRef(null),Ht=le.useRef(ie),Ei=q!=null,rn=fw(q),en=fw(R),Ui=fw(H),si=le.useCallback(()=>{if(!Bt.current||!Tt.current)return;const yt={placement:h,strategy:_,middleware:me};en.current&&(yt.platform=en.current),zL(Bt.current,Tt.current,yt).then(mi=>{const Ci={...mi,isPositioned:Ui.current!==!1};Ji.current&&!fx(Ht.current,Ci)&&(Ht.current=Ci,bv.flushSync(()=>{Q(Ci)}))})},[me,h,_,en,Ui]);rx(()=>{H===!1&&Ht.current.isPositioned&&(Ht.current.isPositioned=!1,Q(yt=>({...yt,isPositioned:!1})))},[H]);const Ji=le.useRef(!1);rx(()=>(Ji.current=!0,()=>{Ji.current=!1}),[]),rx(()=>{if(rt&&(Bt.current=rt),Pt&&(Tt.current=Pt),rt&&Pt){if(rn.current)return rn.current(rt,Pt,si);si()}},[rt,Pt,si,rn,Ei]);const Si=le.useMemo(()=>({reference:Bt,floating:Tt,setReference:Ge,setFloating:Ue}),[Ge,Ue]),Xe=le.useMemo(()=>({reference:rt,floating:Pt}),[rt,Pt]),gt=le.useMemo(()=>{const yt={position:_,left:0,top:0};if(!Xe.floating)return yt;const mi=F2(Xe.floating,ie.x),Ci=F2(Xe.floating,ie.y);return r?{...yt,transform:"translate("+mi+"px, "+Ci+"px)",...dC(Xe.floating)>=1.5&&{willChange:"transform"}}:{position:_,left:mi,top:Ci}},[_,r,Xe.floating,ie.x,ie.y]);return le.useMemo(()=>({...ie,update:si,refs:Si,elements:Xe,floatingStyles:gt}),[ie,si,Si,Xe,gt])}const FL=d=>{function h(_){return{}.hasOwnProperty.call(_,"current")}return{name:"arrow",options:d,fn(_){const{element:T,padding:R}=typeof d=="function"?d(_):d;return T&&h(T)?T.current!=null?B2({element:T.current,padding:R}).fn(_):{}:T?B2({element:T,padding:R}).fn(_):{}}}},NL=(d,h)=>({...IL(d),options:[d,h]}),jL=(d,h)=>({...RL(d),options:[d,h]}),UL=(d,h)=>({...PL(d),options:[d,h]}),VL=(d,h)=>({...ML(d),options:[d,h]}),GL=(d,h)=>({...DL(d),options:[d,h]}),qL=(d,h)=>({...OL(d),options:[d,h]}),HL=(d,h)=>({...FL(d),options:[d,h]});var $L="Arrow",fC=le.forwardRef((d,h)=>{const{children:_,width:T=10,height:R=5,...D}=d;return ee.jsx(hr.svg,{...D,ref:h,width:T,height:R,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:d.asChild?_:ee.jsx("polygon",{points:"0,0 30,0 15,10"})})});fC.displayName=$L;var ZL=fC;function pC(d){const[h,_]=le.useState(void 0);return Wo(()=>{if(d){_({width:d.offsetWidth,height:d.offsetHeight});const T=new ResizeObserver(R=>{if(!Array.isArray(R)||!R.length)return;const D=R[0];let B,r;if("borderBoxSize"in D){const q=D.borderBoxSize,H=Array.isArray(q)?q[0]:q;B=H.inlineSize,r=H.blockSize}else B=d.offsetWidth,r=d.offsetHeight;_({width:B,height:r})});return T.observe(d,{box:"border-box"}),()=>T.unobserve(d)}else _(void 0)},[d]),h}var C1="Popper",[mC,Dx]=Np(C1),[WL,gC]=mC(C1),_C=d=>{const{__scopePopper:h,children:_}=d,[T,R]=le.useState(null);return ee.jsx(WL,{scope:h,anchor:T,onAnchorChange:R,children:_})};_C.displayName=C1;var yC="PopperAnchor",vC=le.forwardRef((d,h)=>{const{__scopePopper:_,virtualRef:T,...R}=d,D=gC(yC,_),B=le.useRef(null),r=xs(h,B),q=le.useRef(null);return le.useEffect(()=>{const H=q.current;q.current=T?.current||B.current,H!==q.current&&D.onAnchorChange(q.current)}),T?null:ee.jsx(hr.div,{...R,ref:r})});vC.displayName=yC;var I1="PopperContent",[XL,YL]=mC(I1),xC=le.forwardRef((d,h)=>{const{__scopePopper:_,side:T="bottom",sideOffset:R=0,align:D="center",alignOffset:B=0,arrowPadding:r=0,avoidCollisions:q=!0,collisionBoundary:H=[],collisionPadding:ie=0,sticky:Q="partial",hideWhenDetached:me=!1,updatePositionStrategy:we="optimized",onPlaced:Ae,...he}=d,Re=gC(I1,_),[Ne,Ge]=le.useState(null),Ue=xs(h,Qt=>Ge(Qt)),[rt,Pt]=le.useState(null),Bt=pC(rt),Tt=Bt?.width??0,Ht=Bt?.height??0,Ei=T+(D!=="center"?"-"+D:""),rn=typeof ie=="number"?ie:{top:0,right:0,bottom:0,left:0,...ie},en=Array.isArray(H)?H:[H],Ui=en.length>0,si={padding:rn,boundary:en.filter(JL),altBoundary:Ui},{refs:Ji,floatingStyles:Si,placement:Xe,isPositioned:gt,middlewareData:yt}=BL({strategy:"fixed",placement:Ei,whileElementsMounted:(...Qt)=>CL(...Qt,{animationFrame:we==="always"}),elements:{reference:Re.anchor},middleware:[NL({mainAxis:R+Ht,alignmentAxis:B}),q&&jL({mainAxis:!0,crossAxis:!1,limiter:Q==="partial"?UL():void 0,...si}),q&&VL({...si}),GL({...si,apply:({elements:Qt,rects:Ii,availableWidth:fi,availableHeight:Ri})=>{const{width:Fi,height:Oi}=Ii.reference,vn=Qt.floating.style;vn.setProperty("--radix-popper-available-width",`${fi}px`),vn.setProperty("--radix-popper-available-height",`${Ri}px`),vn.setProperty("--radix-popper-anchor-width",`${Fi}px`),vn.setProperty("--radix-popper-anchor-height",`${Oi}px`)}}),rt&&HL({element:rt,padding:r}),QL({arrowWidth:Tt,arrowHeight:Ht}),me&&qL({strategy:"referenceHidden",...si})]}),[mi,Ci]=TC(Xe),Fe=kp(Ae);Wo(()=>{gt&&Fe?.()},[gt,Fe]);const wt=yt.arrow?.x,bt=yt.arrow?.y,Gt=yt.arrow?.centerOffset!==0,[ci,Bi]=le.useState();return Wo(()=>{Ne&&Bi(window.getComputedStyle(Ne).zIndex)},[Ne]),ee.jsx("div",{ref:Ji.setFloating,"data-radix-popper-content-wrapper":"",style:{...Si,transform:gt?Si.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ci,"--radix-popper-transform-origin":[yt.transformOrigin?.x,yt.transformOrigin?.y].join(" "),...yt.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:d.dir,children:ee.jsx(XL,{scope:_,placedSide:mi,onArrowChange:Pt,arrowX:wt,arrowY:bt,shouldHideArrow:Gt,children:ee.jsx(hr.div,{"data-side":mi,"data-align":Ci,...he,ref:Ue,style:{...he.style,animation:gt?void 0:"none"}})})})});xC.displayName=I1;var bC="PopperArrow",KL={top:"bottom",right:"left",bottom:"top",left:"right"},wC=le.forwardRef(function(h,_){const{__scopePopper:T,...R}=h,D=YL(bC,T),B=KL[D.placedSide];return ee.jsx("span",{ref:D.onArrowChange,style:{position:"absolute",left:D.arrowX,top:D.arrowY,[B]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[D.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[D.placedSide],visibility:D.shouldHideArrow?"hidden":void 0},children:ee.jsx(ZL,{...R,ref:_,style:{...R.style,display:"block"}})})});wC.displayName=bC;function JL(d){return d!==null}var QL=d=>({name:"transformOrigin",options:d,fn(h){const{placement:_,rects:T,middlewareData:R}=h,B=R.arrow?.centerOffset!==0,r=B?0:d.arrowWidth,q=B?0:d.arrowHeight,[H,ie]=TC(_),Q={start:"0%",center:"50%",end:"100%"}[ie],me=(R.arrow?.x??0)+r/2,we=(R.arrow?.y??0)+q/2;let Ae="",he="";return H==="bottom"?(Ae=B?Q:`${me}px`,he=`${-q}px`):H==="top"?(Ae=B?Q:`${me}px`,he=`${T.floating.height+q}px`):H==="right"?(Ae=`${-q}px`,he=B?Q:`${we}px`):H==="left"&&(Ae=`${T.floating.width+q}px`,he=B?Q:`${we}px`),{data:{x:Ae,y:he}}}});function TC(d){const[h,_="center"]=d.split("-");return[h,_]}var ek=_C,SC=vC,EC=xC,AC=wC,tk="Portal",R1=le.forwardRef((d,h)=>{const{container:_,...T}=d,[R,D]=le.useState(!1);Wo(()=>D(!0),[]);const B=_||R&&globalThis?.document?.body;return B?YA.createPortal(ee.jsx(hr.div,{...T,ref:h}),B):null});R1.displayName=tk;function ik(d,h){return le.useReducer((_,T)=>h[_][T]??_,d)}var q_=d=>{const{present:h,children:_}=d,T=nk(h),R=typeof _=="function"?_({present:T.isPresent}):le.Children.only(_),D=xs(T.ref,rk(R));return typeof _=="function"||T.isPresent?le.cloneElement(R,{ref:D}):null};q_.displayName="Presence";function nk(d){const[h,_]=le.useState(),T=le.useRef(null),R=le.useRef(d),D=le.useRef("none"),B=d?"mounted":"unmounted",[r,q]=ik(B,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return le.useEffect(()=>{const H=G0(T.current);D.current=r==="mounted"?H:"none"},[r]),Wo(()=>{const H=T.current,ie=R.current;if(ie!==d){const me=D.current,we=G0(H);d?q("MOUNT"):we==="none"||H?.display==="none"?q("UNMOUNT"):q(ie&&me!==we?"ANIMATION_OUT":"UNMOUNT"),R.current=d}},[d,q]),Wo(()=>{if(h){let H;const ie=h.ownerDocument.defaultView??window,Q=we=>{const he=G0(T.current).includes(CSS.escape(we.animationName));if(we.target===h&&he&&(q("ANIMATION_END"),!R.current)){const Re=h.style.animationFillMode;h.style.animationFillMode="forwards",H=ie.setTimeout(()=>{h.style.animationFillMode==="forwards"&&(h.style.animationFillMode=Re)})}},me=we=>{we.target===h&&(D.current=G0(T.current))};return h.addEventListener("animationstart",me),h.addEventListener("animationcancel",Q),h.addEventListener("animationend",Q),()=>{ie.clearTimeout(H),h.removeEventListener("animationstart",me),h.removeEventListener("animationcancel",Q),h.removeEventListener("animationend",Q)}}else q("ANIMATION_END")},[h,q]),{isPresent:["mounted","unmountSuspended"].includes(r),ref:le.useCallback(H=>{T.current=H?getComputedStyle(H):null,_(H)},[])}}function G0(d){return d?.animationName||"none"}function rk(d){let h=Object.getOwnPropertyDescriptor(d.props,"ref")?.get,_=h&&"isReactWarning"in h&&h.isReactWarning;return _?d.ref:(h=Object.getOwnPropertyDescriptor(d,"ref")?.get,_=h&&"isReactWarning"in h&&h.isReactWarning,_?d.props.ref:d.props.ref||d.ref)}var sk=x1[" useInsertionEffect ".trim().toString()]||Wo;function px({prop:d,defaultProp:h,onChange:_=()=>{},caller:T}){const[R,D,B]=ok({defaultProp:h,onChange:_}),r=d!==void 0,q=r?d:R;{const ie=le.useRef(d!==void 0);le.useEffect(()=>{const Q=ie.current;Q!==r&&console.warn(`${T} is changing from ${Q?"controlled":"uncontrolled"} to ${r?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),ie.current=r},[r,T])}const H=le.useCallback(ie=>{if(r){const Q=ak(ie)?ie(d):ie;Q!==d&&B.current?.(Q)}else D(ie)},[r,d,D,B]);return[q,H]}function ok({defaultProp:d,onChange:h}){const[_,T]=le.useState(d),R=le.useRef(_),D=le.useRef(h);return sk(()=>{D.current=h},[h]),le.useEffect(()=>{R.current!==_&&(D.current?.(_),R.current=_)},[_,R]),[_,T,D]}function ak(d){return typeof d=="function"}var CC=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),lk="VisuallyHidden",IC=le.forwardRef((d,h)=>ee.jsx(hr.span,{...d,ref:h,style:{...CC,...d.style}}));IC.displayName=lk;var ck=IC,[Ox]=Np("Tooltip",[Dx]),M1=Dx(),RC="TooltipProvider",uk=700,N2="tooltip.open",[hk,MC]=Ox(RC),DC=d=>{const{__scopeTooltip:h,delayDuration:_=uk,skipDelayDuration:T=300,disableHoverableContent:R=!1,children:D}=d,B=le.useRef(!0),r=le.useRef(!1),q=le.useRef(0);return le.useEffect(()=>{const H=q.current;return()=>window.clearTimeout(H)},[]),ee.jsx(hk,{scope:h,isOpenDelayedRef:B,delayDuration:_,onOpen:le.useCallback(()=>{window.clearTimeout(q.current),B.current=!1},[]),onClose:le.useCallback(()=>{window.clearTimeout(q.current),q.current=window.setTimeout(()=>B.current=!0,T)},[T]),isPointerInTransitRef:r,onPointerInTransitChange:le.useCallback(H=>{r.current=H},[]),disableHoverableContent:R,children:D})};DC.displayName=RC;var OC="Tooltip",[B4,Px]=Ox(OC),Hw="TooltipTrigger",dk=le.forwardRef((d,h)=>{const{__scopeTooltip:_,...T}=d,R=Px(Hw,_),D=MC(Hw,_),B=M1(_),r=le.useRef(null),q=xs(h,r,R.onTriggerChange),H=le.useRef(!1),ie=le.useRef(!1),Q=le.useCallback(()=>H.current=!1,[]);return le.useEffect(()=>()=>document.removeEventListener("pointerup",Q),[Q]),ee.jsx(SC,{asChild:!0,...B,children:ee.jsx(hr.button,{"aria-describedby":R.open?R.contentId:void 0,"data-state":R.stateAttribute,...T,ref:q,onPointerMove:Rr(d.onPointerMove,me=>{me.pointerType!=="touch"&&!ie.current&&!D.isPointerInTransitRef.current&&(R.onTriggerEnter(),ie.current=!0)}),onPointerLeave:Rr(d.onPointerLeave,()=>{R.onTriggerLeave(),ie.current=!1}),onPointerDown:Rr(d.onPointerDown,()=>{R.open&&R.onClose(),H.current=!0,document.addEventListener("pointerup",Q,{once:!0})}),onFocus:Rr(d.onFocus,()=>{H.current||R.onOpen()}),onBlur:Rr(d.onBlur,R.onClose),onClick:Rr(d.onClick,R.onClose)})})});dk.displayName=Hw;var fk="TooltipPortal",[F4,pk]=Ox(fk,{forceMount:void 0}),U_="TooltipContent",mk=le.forwardRef((d,h)=>{const _=pk(U_,d.__scopeTooltip),{forceMount:T=_.forceMount,side:R="top",...D}=d,B=Px(U_,d.__scopeTooltip);return ee.jsx(q_,{present:T||B.open,children:B.disableHoverableContent?ee.jsx(PC,{side:R,...D,ref:h}):ee.jsx(gk,{side:R,...D,ref:h})})}),gk=le.forwardRef((d,h)=>{const _=Px(U_,d.__scopeTooltip),T=MC(U_,d.__scopeTooltip),R=le.useRef(null),D=xs(h,R),[B,r]=le.useState(null),{trigger:q,onClose:H}=_,ie=R.current,{onPointerInTransitChange:Q}=T,me=le.useCallback(()=>{r(null),Q(!1)},[Q]),we=le.useCallback((Ae,he)=>{const Re=Ae.currentTarget,Ne={x:Ae.clientX,y:Ae.clientY},Ge=bk(Ne,Re.getBoundingClientRect()),Ue=wk(Ne,Ge),rt=Tk(he.getBoundingClientRect()),Pt=Ek([...Ue,...rt]);r(Pt),Q(!0)},[Q]);return le.useEffect(()=>()=>me(),[me]),le.useEffect(()=>{if(q&&ie){const Ae=Re=>we(Re,ie),he=Re=>we(Re,q);return q.addEventListener("pointerleave",Ae),ie.addEventListener("pointerleave",he),()=>{q.removeEventListener("pointerleave",Ae),ie.removeEventListener("pointerleave",he)}}},[q,ie,we,me]),le.useEffect(()=>{if(B){const Ae=he=>{const Re=he.target,Ne={x:he.clientX,y:he.clientY},Ge=q?.contains(Re)||ie?.contains(Re),Ue=!Sk(Ne,B);Ge?me():Ue&&(me(),H())};return document.addEventListener("pointermove",Ae),()=>document.removeEventListener("pointermove",Ae)}},[q,ie,B,H,me]),ee.jsx(PC,{...d,ref:D})}),[_k,yk]=Ox(OC,{isInside:!1}),vk=xz("TooltipContent"),PC=le.forwardRef((d,h)=>{const{__scopeTooltip:_,children:T,"aria-label":R,onEscapeKeyDown:D,onPointerDownOutside:B,...r}=d,q=Px(U_,_),H=M1(_),{onClose:ie}=q;return le.useEffect(()=>(document.addEventListener(N2,ie),()=>document.removeEventListener(N2,ie)),[ie]),le.useEffect(()=>{if(q.trigger){const Q=me=>{me.target?.contains(q.trigger)&&ie()};return window.addEventListener("scroll",Q,{capture:!0}),()=>window.removeEventListener("scroll",Q,{capture:!0})}},[q.trigger,ie]),ee.jsx(Ax,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:D,onPointerDownOutside:B,onFocusOutside:Q=>Q.preventDefault(),onDismiss:ie,children:ee.jsxs(EC,{"data-state":q.stateAttribute,...H,...r,ref:h,style:{...r.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[ee.jsx(vk,{children:T}),ee.jsx(_k,{scope:_,isInside:!0,children:ee.jsx(ck,{id:q.contentId,role:"tooltip",children:R||T})})]})})});mk.displayName=U_;var zC="TooltipArrow",xk=le.forwardRef((d,h)=>{const{__scopeTooltip:_,...T}=d,R=M1(_);return yk(zC,_).isInside?null:ee.jsx(AC,{...R,...T,ref:h})});xk.displayName=zC;function bk(d,h){const _=Math.abs(h.top-d.y),T=Math.abs(h.bottom-d.y),R=Math.abs(h.right-d.x),D=Math.abs(h.left-d.x);switch(Math.min(_,T,R,D)){case D:return"left";case R:return"right";case _:return"top";case T:return"bottom";default:throw new Error("unreachable")}}function wk(d,h,_=5){const T=[];switch(h){case"top":T.push({x:d.x-_,y:d.y+_},{x:d.x+_,y:d.y+_});break;case"bottom":T.push({x:d.x-_,y:d.y-_},{x:d.x+_,y:d.y-_});break;case"left":T.push({x:d.x+_,y:d.y-_},{x:d.x+_,y:d.y+_});break;case"right":T.push({x:d.x-_,y:d.y-_},{x:d.x-_,y:d.y+_});break}return T}function Tk(d){const{top:h,right:_,bottom:T,left:R}=d;return[{x:R,y:h},{x:_,y:h},{x:_,y:T},{x:R,y:T}]}function Sk(d,h){const{x:_,y:T}=d;let R=!1;for(let D=0,B=h.length-1;D<h.length;B=D++){const r=h[D],q=h[B],H=r.x,ie=r.y,Q=q.x,me=q.y;ie>T!=me>T&&_<(Q-H)*(T-ie)/(me-ie)+H&&(R=!R)}return R}function Ek(d){const h=d.slice();return h.sort((_,T)=>_.x<T.x?-1:_.x>T.x?1:_.y<T.y?-1:_.y>T.y?1:0),Ak(h)}function Ak(d){if(d.length<=1)return d.slice();const h=[];for(let T=0;T<d.length;T++){const R=d[T];for(;h.length>=2;){const D=h[h.length-1],B=h[h.length-2];if((D.x-B.x)*(R.y-B.y)>=(D.y-B.y)*(R.x-B.x))h.pop();else break}h.push(R)}h.pop();const _=[];for(let T=d.length-1;T>=0;T--){const R=d[T];for(;_.length>=2;){const D=_[_.length-1],B=_[_.length-2];if((D.x-B.x)*(R.y-B.y)>=(D.y-B.y)*(R.x-B.x))_.pop();else break}_.push(R)}return _.pop(),h.length===1&&_.length===1&&h[0].x===_[0].x&&h[0].y===_[0].y?h:h.concat(_)}var Ck=DC;function LC(d){var h,_,T="";if(typeof d=="string"||typeof d=="number")T+=d;else if(typeof d=="object")if(Array.isArray(d)){var R=d.length;for(h=0;h<R;h++)d[h]&&(_=LC(d[h]))&&(T&&(T+=" "),T+=_)}else for(_ in d)d[_]&&(T&&(T+=" "),T+=_);return T}function kC(){for(var d,h,_=0,T="",R=arguments.length;_<R;_++)(d=arguments[_])&&(h=LC(d))&&(T&&(T+=" "),T+=h);return T}const D1="-",Ik=d=>{const h=Mk(d),{conflictingClassGroups:_,conflictingClassGroupModifiers:T}=d;return{getClassGroupId:B=>{const r=B.split(D1);return r[0]===""&&r.length!==1&&r.shift(),BC(r,h)||Rk(B)},getConflictingClassGroupIds:(B,r)=>{const q=_[B]||[];return r&&T[B]?[...q,...T[B]]:q}}},BC=(d,h)=>{if(d.length===0)return h.classGroupId;const _=d[0],T=h.nextPart.get(_),R=T?BC(d.slice(1),T):void 0;if(R)return R;if(h.validators.length===0)return;const D=d.join(D1);return h.validators.find(({validator:B})=>B(D))?.classGroupId},j2=/^\[(.+)\]$/,Rk=d=>{if(j2.test(d)){const h=j2.exec(d)[1],_=h?.substring(0,h.indexOf(":"));if(_)return"arbitrary.."+_}},Mk=d=>{const{theme:h,classGroups:_}=d,T={nextPart:new Map,validators:[]};for(const R in _)$w(_[R],T,R,h);return T},$w=(d,h,_,T)=>{d.forEach(R=>{if(typeof R=="string"){const D=R===""?h:U2(h,R);D.classGroupId=_;return}if(typeof R=="function"){if(Dk(R)){$w(R(T),h,_,T);return}h.validators.push({validator:R,classGroupId:_});return}Object.entries(R).forEach(([D,B])=>{$w(B,U2(h,D),_,T)})})},U2=(d,h)=>{let _=d;return h.split(D1).forEach(T=>{_.nextPart.has(T)||_.nextPart.set(T,{nextPart:new Map,validators:[]}),_=_.nextPart.get(T)}),_},Dk=d=>d.isThemeGetter,Ok=d=>{if(d<1)return{get:()=>{},set:()=>{}};let h=0,_=new Map,T=new Map;const R=(D,B)=>{_.set(D,B),h++,h>d&&(h=0,T=_,_=new Map)};return{get(D){let B=_.get(D);if(B!==void 0)return B;if((B=T.get(D))!==void 0)return R(D,B),B},set(D,B){_.has(D)?_.set(D,B):R(D,B)}}},Zw="!",Ww=":",Pk=Ww.length,zk=d=>{const{prefix:h,experimentalParseClassName:_}=d;let T=R=>{const D=[];let B=0,r=0,q=0,H;for(let Ae=0;Ae<R.length;Ae++){let he=R[Ae];if(B===0&&r===0){if(he===Ww){D.push(R.slice(q,Ae)),q=Ae+Pk;continue}if(he==="/"){H=Ae;continue}}he==="["?B++:he==="]"?B--:he==="("?r++:he===")"&&r--}const ie=D.length===0?R:R.substring(q),Q=Lk(ie),me=Q!==ie,we=H&&H>q?H-q:void 0;return{modifiers:D,hasImportantModifier:me,baseClassName:Q,maybePostfixModifierPosition:we}};if(h){const R=h+Ww,D=T;T=B=>B.startsWith(R)?D(B.substring(R.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:B,maybePostfixModifierPosition:void 0}}if(_){const R=T;T=D=>_({className:D,parseClassName:R})}return T},Lk=d=>d.endsWith(Zw)?d.substring(0,d.length-1):d.startsWith(Zw)?d.substring(1):d,kk=d=>{const h=Object.fromEntries(d.orderSensitiveModifiers.map(T=>[T,!0]));return T=>{if(T.length<=1)return T;const R=[];let D=[];return T.forEach(B=>{B[0]==="["||h[B]?(R.push(...D.sort(),B),D=[]):D.push(B)}),R.push(...D.sort()),R}},Bk=d=>({cache:Ok(d.cacheSize),parseClassName:zk(d),sortModifiers:kk(d),...Ik(d)}),Fk=/\s+/,Nk=(d,h)=>{const{parseClassName:_,getClassGroupId:T,getConflictingClassGroupIds:R,sortModifiers:D}=h,B=[],r=d.trim().split(Fk);let q="";for(let H=r.length-1;H>=0;H-=1){const ie=r[H],{isExternal:Q,modifiers:me,hasImportantModifier:we,baseClassName:Ae,maybePostfixModifierPosition:he}=_(ie);if(Q){q=ie+(q.length>0?" "+q:q);continue}let Re=!!he,Ne=T(Re?Ae.substring(0,he):Ae);if(!Ne){if(!Re){q=ie+(q.length>0?" "+q:q);continue}if(Ne=T(Ae),!Ne){q=ie+(q.length>0?" "+q:q);continue}Re=!1}const Ge=D(me).join(":"),Ue=we?Ge+Zw:Ge,rt=Ue+Ne;if(B.includes(rt))continue;B.push(rt);const Pt=R(Ne,Re);for(let Bt=0;Bt<Pt.length;++Bt){const Tt=Pt[Bt];B.push(Ue+Tt)}q=ie+(q.length>0?" "+q:q)}return q};function jk(){let d=0,h,_,T="";for(;d<arguments.length;)(h=arguments[d++])&&(_=FC(h))&&(T&&(T+=" "),T+=_);return T}const FC=d=>{if(typeof d=="string")return d;let h,_="";for(let T=0;T<d.length;T++)d[T]&&(h=FC(d[T]))&&(_&&(_+=" "),_+=h);return _};function Uk(d,...h){let _,T,R,D=B;function B(q){const H=h.reduce((ie,Q)=>Q(ie),d());return _=Bk(H),T=_.cache.get,R=_.cache.set,D=r,r(q)}function r(q){const H=T(q);if(H)return H;const ie=Nk(q,_);return R(q,ie),ie}return function(){return D(jk.apply(null,arguments))}}const $o=d=>{const h=_=>_[d]||[];return h.isThemeGetter=!0,h},NC=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,jC=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Vk=/^\d+\/\d+$/,Gk=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,qk=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Hk=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,$k=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Zk=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,x_=d=>Vk.test(d),Jn=d=>!!d&&!Number.isNaN(Number(d)),Cp=d=>!!d&&Number.isInteger(Number(d)),pw=d=>d.endsWith("%")&&Jn(d.slice(0,-1)),mf=d=>Gk.test(d),Wk=()=>!0,Xk=d=>qk.test(d)&&!Hk.test(d),UC=()=>!1,Yk=d=>$k.test(d),Kk=d=>Zk.test(d),Jk=d=>!Yi(d)&&!Ki(d),Qk=d=>H_(d,qC,UC),Yi=d=>NC.test(d),ig=d=>H_(d,HC,Xk),mw=d=>H_(d,r3,Jn),V2=d=>H_(d,VC,UC),e3=d=>H_(d,GC,Kk),q0=d=>H_(d,$C,Yk),Ki=d=>jC.test(d),iv=d=>$_(d,HC),t3=d=>$_(d,s3),G2=d=>$_(d,VC),i3=d=>$_(d,qC),n3=d=>$_(d,GC),H0=d=>$_(d,$C,!0),H_=(d,h,_)=>{const T=NC.exec(d);return T?T[1]?h(T[1]):_(T[2]):!1},$_=(d,h,_=!1)=>{const T=jC.exec(d);return T?T[1]?h(T[1]):_:!1},VC=d=>d==="position"||d==="percentage",GC=d=>d==="image"||d==="url",qC=d=>d==="length"||d==="size"||d==="bg-size",HC=d=>d==="length",r3=d=>d==="number",s3=d=>d==="family-name",$C=d=>d==="shadow",o3=()=>{const d=$o("color"),h=$o("font"),_=$o("text"),T=$o("font-weight"),R=$o("tracking"),D=$o("leading"),B=$o("breakpoint"),r=$o("container"),q=$o("spacing"),H=$o("radius"),ie=$o("shadow"),Q=$o("inset-shadow"),me=$o("text-shadow"),we=$o("drop-shadow"),Ae=$o("blur"),he=$o("perspective"),Re=$o("aspect"),Ne=$o("ease"),Ge=$o("animate"),Ue=()=>["auto","avoid","all","avoid-page","page","left","right","column"],rt=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],Pt=()=>[...rt(),Ki,Yi],Bt=()=>["auto","hidden","clip","visible","scroll"],Tt=()=>["auto","contain","none"],Ht=()=>[Ki,Yi,q],Ei=()=>[x_,"full","auto",...Ht()],rn=()=>[Cp,"none","subgrid",Ki,Yi],en=()=>["auto",{span:["full",Cp,Ki,Yi]},Cp,Ki,Yi],Ui=()=>[Cp,"auto",Ki,Yi],si=()=>["auto","min","max","fr",Ki,Yi],Ji=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],Si=()=>["start","end","center","stretch","center-safe","end-safe"],Xe=()=>["auto",...Ht()],gt=()=>[x_,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...Ht()],yt=()=>[d,Ki,Yi],mi=()=>[...rt(),G2,V2,{position:[Ki,Yi]}],Ci=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Fe=()=>["auto","cover","contain",i3,Qk,{size:[Ki,Yi]}],wt=()=>[pw,iv,ig],bt=()=>["","none","full",H,Ki,Yi],Gt=()=>["",Jn,iv,ig],ci=()=>["solid","dashed","dotted","double"],Bi=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Qt=()=>[Jn,pw,G2,V2],Ii=()=>["","none",Ae,Ki,Yi],fi=()=>["none",Jn,Ki,Yi],Ri=()=>["none",Jn,Ki,Yi],Fi=()=>[Jn,Ki,Yi],Oi=()=>[x_,"full",...Ht()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[mf],breakpoint:[mf],color:[Wk],container:[mf],"drop-shadow":[mf],ease:["in","out","in-out"],font:[Jk],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[mf],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[mf],shadow:[mf],spacing:["px",Jn],text:[mf],"text-shadow":[mf],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",x_,Yi,Ki,Re]}],container:["container"],columns:[{columns:[Jn,Yi,Ki,r]}],"break-after":[{"break-after":Ue()}],"break-before":[{"break-before":Ue()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:Pt()}],overflow:[{overflow:Bt()}],"overflow-x":[{"overflow-x":Bt()}],"overflow-y":[{"overflow-y":Bt()}],overscroll:[{overscroll:Tt()}],"overscroll-x":[{"overscroll-x":Tt()}],"overscroll-y":[{"overscroll-y":Tt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Ei()}],"inset-x":[{"inset-x":Ei()}],"inset-y":[{"inset-y":Ei()}],start:[{start:Ei()}],end:[{end:Ei()}],top:[{top:Ei()}],right:[{right:Ei()}],bottom:[{bottom:Ei()}],left:[{left:Ei()}],visibility:["visible","invisible","collapse"],z:[{z:[Cp,"auto",Ki,Yi]}],basis:[{basis:[x_,"full","auto",r,...Ht()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Jn,x_,"auto","initial","none",Yi]}],grow:[{grow:["",Jn,Ki,Yi]}],shrink:[{shrink:["",Jn,Ki,Yi]}],order:[{order:[Cp,"first","last","none",Ki,Yi]}],"grid-cols":[{"grid-cols":rn()}],"col-start-end":[{col:en()}],"col-start":[{"col-start":Ui()}],"col-end":[{"col-end":Ui()}],"grid-rows":[{"grid-rows":rn()}],"row-start-end":[{row:en()}],"row-start":[{"row-start":Ui()}],"row-end":[{"row-end":Ui()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":si()}],"auto-rows":[{"auto-rows":si()}],gap:[{gap:Ht()}],"gap-x":[{"gap-x":Ht()}],"gap-y":[{"gap-y":Ht()}],"justify-content":[{justify:[...Ji(),"normal"]}],"justify-items":[{"justify-items":[...Si(),"normal"]}],"justify-self":[{"justify-self":["auto",...Si()]}],"align-content":[{content:["normal",...Ji()]}],"align-items":[{items:[...Si(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...Si(),{baseline:["","last"]}]}],"place-content":[{"place-content":Ji()}],"place-items":[{"place-items":[...Si(),"baseline"]}],"place-self":[{"place-self":["auto",...Si()]}],p:[{p:Ht()}],px:[{px:Ht()}],py:[{py:Ht()}],ps:[{ps:Ht()}],pe:[{pe:Ht()}],pt:[{pt:Ht()}],pr:[{pr:Ht()}],pb:[{pb:Ht()}],pl:[{pl:Ht()}],m:[{m:Xe()}],mx:[{mx:Xe()}],my:[{my:Xe()}],ms:[{ms:Xe()}],me:[{me:Xe()}],mt:[{mt:Xe()}],mr:[{mr:Xe()}],mb:[{mb:Xe()}],ml:[{ml:Xe()}],"space-x":[{"space-x":Ht()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Ht()}],"space-y-reverse":["space-y-reverse"],size:[{size:gt()}],w:[{w:[r,"screen",...gt()]}],"min-w":[{"min-w":[r,"screen","none",...gt()]}],"max-w":[{"max-w":[r,"screen","none","prose",{screen:[B]},...gt()]}],h:[{h:["screen","lh",...gt()]}],"min-h":[{"min-h":["screen","lh","none",...gt()]}],"max-h":[{"max-h":["screen","lh",...gt()]}],"font-size":[{text:["base",_,iv,ig]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[T,Ki,mw]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",pw,Yi]}],"font-family":[{font:[t3,Yi,h]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[R,Ki,Yi]}],"line-clamp":[{"line-clamp":[Jn,"none",Ki,mw]}],leading:[{leading:[D,...Ht()]}],"list-image":[{"list-image":["none",Ki,Yi]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Ki,Yi]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:yt()}],"text-color":[{text:yt()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ci(),"wavy"]}],"text-decoration-thickness":[{decoration:[Jn,"from-font","auto",Ki,ig]}],"text-decoration-color":[{decoration:yt()}],"underline-offset":[{"underline-offset":[Jn,"auto",Ki,Yi]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ht()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ki,Yi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ki,Yi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:mi()}],"bg-repeat":[{bg:Ci()}],"bg-size":[{bg:Fe()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Cp,Ki,Yi],radial:["",Ki,Yi],conic:[Cp,Ki,Yi]},n3,e3]}],"bg-color":[{bg:yt()}],"gradient-from-pos":[{from:wt()}],"gradient-via-pos":[{via:wt()}],"gradient-to-pos":[{to:wt()}],"gradient-from":[{from:yt()}],"gradient-via":[{via:yt()}],"gradient-to":[{to:yt()}],rounded:[{rounded:bt()}],"rounded-s":[{"rounded-s":bt()}],"rounded-e":[{"rounded-e":bt()}],"rounded-t":[{"rounded-t":bt()}],"rounded-r":[{"rounded-r":bt()}],"rounded-b":[{"rounded-b":bt()}],"rounded-l":[{"rounded-l":bt()}],"rounded-ss":[{"rounded-ss":bt()}],"rounded-se":[{"rounded-se":bt()}],"rounded-ee":[{"rounded-ee":bt()}],"rounded-es":[{"rounded-es":bt()}],"rounded-tl":[{"rounded-tl":bt()}],"rounded-tr":[{"rounded-tr":bt()}],"rounded-br":[{"rounded-br":bt()}],"rounded-bl":[{"rounded-bl":bt()}],"border-w":[{border:Gt()}],"border-w-x":[{"border-x":Gt()}],"border-w-y":[{"border-y":Gt()}],"border-w-s":[{"border-s":Gt()}],"border-w-e":[{"border-e":Gt()}],"border-w-t":[{"border-t":Gt()}],"border-w-r":[{"border-r":Gt()}],"border-w-b":[{"border-b":Gt()}],"border-w-l":[{"border-l":Gt()}],"divide-x":[{"divide-x":Gt()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Gt()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...ci(),"hidden","none"]}],"divide-style":[{divide:[...ci(),"hidden","none"]}],"border-color":[{border:yt()}],"border-color-x":[{"border-x":yt()}],"border-color-y":[{"border-y":yt()}],"border-color-s":[{"border-s":yt()}],"border-color-e":[{"border-e":yt()}],"border-color-t":[{"border-t":yt()}],"border-color-r":[{"border-r":yt()}],"border-color-b":[{"border-b":yt()}],"border-color-l":[{"border-l":yt()}],"divide-color":[{divide:yt()}],"outline-style":[{outline:[...ci(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Jn,Ki,Yi]}],"outline-w":[{outline:["",Jn,iv,ig]}],"outline-color":[{outline:yt()}],shadow:[{shadow:["","none",ie,H0,q0]}],"shadow-color":[{shadow:yt()}],"inset-shadow":[{"inset-shadow":["none",Q,H0,q0]}],"inset-shadow-color":[{"inset-shadow":yt()}],"ring-w":[{ring:Gt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:yt()}],"ring-offset-w":[{"ring-offset":[Jn,ig]}],"ring-offset-color":[{"ring-offset":yt()}],"inset-ring-w":[{"inset-ring":Gt()}],"inset-ring-color":[{"inset-ring":yt()}],"text-shadow":[{"text-shadow":["none",me,H0,q0]}],"text-shadow-color":[{"text-shadow":yt()}],opacity:[{opacity:[Jn,Ki,Yi]}],"mix-blend":[{"mix-blend":[...Bi(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Bi()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Jn]}],"mask-image-linear-from-pos":[{"mask-linear-from":Qt()}],"mask-image-linear-to-pos":[{"mask-linear-to":Qt()}],"mask-image-linear-from-color":[{"mask-linear-from":yt()}],"mask-image-linear-to-color":[{"mask-linear-to":yt()}],"mask-image-t-from-pos":[{"mask-t-from":Qt()}],"mask-image-t-to-pos":[{"mask-t-to":Qt()}],"mask-image-t-from-color":[{"mask-t-from":yt()}],"mask-image-t-to-color":[{"mask-t-to":yt()}],"mask-image-r-from-pos":[{"mask-r-from":Qt()}],"mask-image-r-to-pos":[{"mask-r-to":Qt()}],"mask-image-r-from-color":[{"mask-r-from":yt()}],"mask-image-r-to-color":[{"mask-r-to":yt()}],"mask-image-b-from-pos":[{"mask-b-from":Qt()}],"mask-image-b-to-pos":[{"mask-b-to":Qt()}],"mask-image-b-from-color":[{"mask-b-from":yt()}],"mask-image-b-to-color":[{"mask-b-to":yt()}],"mask-image-l-from-pos":[{"mask-l-from":Qt()}],"mask-image-l-to-pos":[{"mask-l-to":Qt()}],"mask-image-l-from-color":[{"mask-l-from":yt()}],"mask-image-l-to-color":[{"mask-l-to":yt()}],"mask-image-x-from-pos":[{"mask-x-from":Qt()}],"mask-image-x-to-pos":[{"mask-x-to":Qt()}],"mask-image-x-from-color":[{"mask-x-from":yt()}],"mask-image-x-to-color":[{"mask-x-to":yt()}],"mask-image-y-from-pos":[{"mask-y-from":Qt()}],"mask-image-y-to-pos":[{"mask-y-to":Qt()}],"mask-image-y-from-color":[{"mask-y-from":yt()}],"mask-image-y-to-color":[{"mask-y-to":yt()}],"mask-image-radial":[{"mask-radial":[Ki,Yi]}],"mask-image-radial-from-pos":[{"mask-radial-from":Qt()}],"mask-image-radial-to-pos":[{"mask-radial-to":Qt()}],"mask-image-radial-from-color":[{"mask-radial-from":yt()}],"mask-image-radial-to-color":[{"mask-radial-to":yt()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":rt()}],"mask-image-conic-pos":[{"mask-conic":[Jn]}],"mask-image-conic-from-pos":[{"mask-conic-from":Qt()}],"mask-image-conic-to-pos":[{"mask-conic-to":Qt()}],"mask-image-conic-from-color":[{"mask-conic-from":yt()}],"mask-image-conic-to-color":[{"mask-conic-to":yt()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:mi()}],"mask-repeat":[{mask:Ci()}],"mask-size":[{mask:Fe()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Ki,Yi]}],filter:[{filter:["","none",Ki,Yi]}],blur:[{blur:Ii()}],brightness:[{brightness:[Jn,Ki,Yi]}],contrast:[{contrast:[Jn,Ki,Yi]}],"drop-shadow":[{"drop-shadow":["","none",we,H0,q0]}],"drop-shadow-color":[{"drop-shadow":yt()}],grayscale:[{grayscale:["",Jn,Ki,Yi]}],"hue-rotate":[{"hue-rotate":[Jn,Ki,Yi]}],invert:[{invert:["",Jn,Ki,Yi]}],saturate:[{saturate:[Jn,Ki,Yi]}],sepia:[{sepia:["",Jn,Ki,Yi]}],"backdrop-filter":[{"backdrop-filter":["","none",Ki,Yi]}],"backdrop-blur":[{"backdrop-blur":Ii()}],"backdrop-brightness":[{"backdrop-brightness":[Jn,Ki,Yi]}],"backdrop-contrast":[{"backdrop-contrast":[Jn,Ki,Yi]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Jn,Ki,Yi]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Jn,Ki,Yi]}],"backdrop-invert":[{"backdrop-invert":["",Jn,Ki,Yi]}],"backdrop-opacity":[{"backdrop-opacity":[Jn,Ki,Yi]}],"backdrop-saturate":[{"backdrop-saturate":[Jn,Ki,Yi]}],"backdrop-sepia":[{"backdrop-sepia":["",Jn,Ki,Yi]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Ht()}],"border-spacing-x":[{"border-spacing-x":Ht()}],"border-spacing-y":[{"border-spacing-y":Ht()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Ki,Yi]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Jn,"initial",Ki,Yi]}],ease:[{ease:["linear","initial",Ne,Ki,Yi]}],delay:[{delay:[Jn,Ki,Yi]}],animate:[{animate:["none",Ge,Ki,Yi]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[he,Ki,Yi]}],"perspective-origin":[{"perspective-origin":Pt()}],rotate:[{rotate:fi()}],"rotate-x":[{"rotate-x":fi()}],"rotate-y":[{"rotate-y":fi()}],"rotate-z":[{"rotate-z":fi()}],scale:[{scale:Ri()}],"scale-x":[{"scale-x":Ri()}],"scale-y":[{"scale-y":Ri()}],"scale-z":[{"scale-z":Ri()}],"scale-3d":["scale-3d"],skew:[{skew:Fi()}],"skew-x":[{"skew-x":Fi()}],"skew-y":[{"skew-y":Fi()}],transform:[{transform:[Ki,Yi,"","none","gpu","cpu"]}],"transform-origin":[{origin:Pt()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Oi()}],"translate-x":[{"translate-x":Oi()}],"translate-y":[{"translate-y":Oi()}],"translate-z":[{"translate-z":Oi()}],"translate-none":["translate-none"],accent:[{accent:yt()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:yt()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ki,Yi]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ht()}],"scroll-mx":[{"scroll-mx":Ht()}],"scroll-my":[{"scroll-my":Ht()}],"scroll-ms":[{"scroll-ms":Ht()}],"scroll-me":[{"scroll-me":Ht()}],"scroll-mt":[{"scroll-mt":Ht()}],"scroll-mr":[{"scroll-mr":Ht()}],"scroll-mb":[{"scroll-mb":Ht()}],"scroll-ml":[{"scroll-ml":Ht()}],"scroll-p":[{"scroll-p":Ht()}],"scroll-px":[{"scroll-px":Ht()}],"scroll-py":[{"scroll-py":Ht()}],"scroll-ps":[{"scroll-ps":Ht()}],"scroll-pe":[{"scroll-pe":Ht()}],"scroll-pt":[{"scroll-pt":Ht()}],"scroll-pr":[{"scroll-pr":Ht()}],"scroll-pb":[{"scroll-pb":Ht()}],"scroll-pl":[{"scroll-pl":Ht()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ki,Yi]}],fill:[{fill:["none",...yt()]}],"stroke-w":[{stroke:[Jn,iv,ig,mw]}],stroke:[{stroke:["none",...yt()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},a3=Uk(o3);function bs(...d){return a3(kC(d))}function l3({delayDuration:d=0,...h}){return ee.jsx(Ck,{"data-slot":"tooltip-provider",delayDuration:d,...h})}const q2=d=>typeof d=="boolean"?`${d}`:d===0?"0":d,H2=kC,ZC=(d,h)=>_=>{var T;if(h?.variants==null)return H2(d,_?.class,_?.className);const{variants:R,defaultVariants:D}=h,B=Object.keys(R).map(H=>{const ie=_?.[H],Q=D?.[H];if(ie===null)return null;const me=q2(ie)||q2(Q);return R[H][me]}),r=_&&Object.entries(_).reduce((H,ie)=>{let[Q,me]=ie;return me===void 0||(H[Q]=me),H},{}),q=h==null||(T=h.compoundVariants)===null||T===void 0?void 0:T.reduce((H,ie)=>{let{class:Q,className:me,...we}=ie;return Object.entries(we).every(Ae=>{let[he,Re]=Ae;return Array.isArray(Re)?Re.includes({...D,...r}[he]):{...D,...r}[he]===Re})?[...H,Q,me]:H},[]);return H2(d,B,q,_?.class,_?.className)},c3=ZC("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-[2rem_1.1rem_2rem_1.1rem] px-5 py-2 text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-transparent focus-visible:ring-[3px] focus-visible:ring-white/40 shadow-sm",{variants:{variant:{default:"bg-[var(--snail-green)] text-white hover:bg-[var(--snail-green)]/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border border-white/50 bg-white/30 backdrop-blur hover:bg-white/50 text-foreground",secondary:"bg-white/40 text-foreground hover:bg-white/60",ghost:"bg-transparent text-foreground hover:bg-white/30",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 has-[>svg]:px-4",sm:"h-9 gap-1.5 px-4",lg:"h-12 px-7",icon:"size-11","icon-sm":"size-9","icon-lg":"size-12"}},defaultVariants:{variant:"default",size:"default"}});function Us({className:d,variant:h,size:_,asChild:T=!1,...R}){const D=T?JA:"button";return ee.jsx(D,{"data-slot":"button",className:bs(c3({variant:h,size:_,className:d})),...R})}function u3({className:d,...h}){return ee.jsx("div",{"data-slot":"card",className:bs("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",d),...h})}function h3({className:d,...h}){return ee.jsx("div",{"data-slot":"card-content",className:bs("px-6",d),...h})}/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d3=d=>d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),WC=(...d)=>d.filter((h,_,T)=>!!h&&T.indexOf(h)===_).join(" ");/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var f3={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p3=le.forwardRef(({color:d="currentColor",size:h=24,strokeWidth:_=2,absoluteStrokeWidth:T,className:R="",children:D,iconNode:B,...r},q)=>le.createElement("svg",{ref:q,...f3,width:h,height:h,stroke:d,strokeWidth:T?Number(_)*24/Number(h):_,className:WC("lucide",R),...r},[...B.map(([H,ie])=>le.createElement(H,ie)),...Array.isArray(D)?D:[D]]));/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _l=(d,h)=>{const _=le.forwardRef(({className:T,...R},D)=>le.createElement(p3,{ref:D,iconNode:h,className:WC(`lucide-${d3(d)}`,T),...R}));return _.displayName=`${d}`,_};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m3=_l("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O1=_l("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XC=_l("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g3=_l("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _3=_l("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y3=_l("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pp=_l("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v3=_l("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x3=_l("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b3=_l("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w3=_l("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T3=_l("Shell",[["path",{d:"M14 11a2 2 0 1 1-4 0 4 4 0 0 1 8 0 6 6 0 0 1-12 0 8 8 0 0 1 16 0 10 10 0 1 1-20 0 11.93 11.93 0 0 1 2.42-7.22 2 2 0 1 1 3.16 2.44",key:"1cn552"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S3=_l("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E3=_l("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YC=_l("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function A3(d,h){if(d instanceof RegExp)return{keys:!1,pattern:d};var _,T,R,D,B=[],r="",q=d.split("/");for(q[0]||q.shift();R=q.shift();)_=R[0],_==="*"?(B.push(_),r+=R[1]==="?"?"(?:/(.*))?":"/(.*)"):_===":"?(T=R.indexOf("?",1),D=R.indexOf(".",1),B.push(R.substring(1,~T?T:~D?D:R.length)),r+=~T&&!~D?"(?:/([^/]+?))?":"/([^/]+?)",~D&&(r+=(~T?"?":"")+"\\"+R.substring(D))):r+="/"+R;return{keys:B,pattern:new RegExp("^"+r+(h?"(?=$|/)":"/?$"),"i")}}var gw={exports:{}},_w={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $2;function C3(){if($2)return _w;$2=1;var d=Ex();function h(Q,me){return Q===me&&(Q!==0||1/Q===1/me)||Q!==Q&&me!==me}var _=typeof Object.is=="function"?Object.is:h,T=d.useState,R=d.useEffect,D=d.useLayoutEffect,B=d.useDebugValue;function r(Q,me){var we=me(),Ae=T({inst:{value:we,getSnapshot:me}}),he=Ae[0].inst,Re=Ae[1];return D(function(){he.value=we,he.getSnapshot=me,q(he)&&Re({inst:he})},[Q,we,me]),R(function(){return q(he)&&Re({inst:he}),Q(function(){q(he)&&Re({inst:he})})},[Q]),B(we),we}function q(Q){var me=Q.getSnapshot;Q=Q.value;try{var we=me();return!_(Q,we)}catch{return!0}}function H(Q,me){return me()}var ie=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?H:r;return _w.useSyncExternalStore=d.useSyncExternalStore!==void 0?d.useSyncExternalStore:ie,_w}var Z2;function I3(){return Z2||(Z2=1,gw.exports=C3()),gw.exports}var KC=I3();const R3=x1.useInsertionEffect,M3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",JC=M3?le.useLayoutEffect:le.useEffect,D3=R3||JC,P1=d=>{const h=le.useRef([d,(..._)=>h[0](..._)]).current;return D3(()=>{h[0]=d}),h[1]},O3="popstate",z1="pushState",L1="replaceState",P3="hashchange",W2=[O3,z1,L1,P3],z3=d=>{for(const h of W2)addEventListener(h,d);return()=>{for(const h of W2)removeEventListener(h,d)}},QC=(d,h)=>KC.useSyncExternalStore(z3,d,h),L3=()=>location.search,k3=({ssrSearch:d=""}={})=>QC(L3,()=>d),X2=()=>location.pathname,B3=({ssrPath:d}={})=>QC(X2,d?()=>d:X2),F3=(d,{replace:h=!1,state:_=null}={})=>history[h?L1:z1](_,"",d),N3=(d={})=>[B3(d),F3],Y2=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[Y2]>"u"){for(const d of[z1,L1]){const h=history[d];history[d]=function(){const _=h.apply(this,arguments),T=new Event(d);return T.arguments=arguments,dispatchEvent(T),_}}Object.defineProperty(window,Y2,{value:!0})}const j3=(d,h)=>h.toLowerCase().indexOf(d.toLowerCase())?"~"+h:h.slice(d.length)||"/",eI=(d="")=>d==="/"?"":d,U3=(d,h)=>d[0]==="~"?d.slice(1):eI(h)+d,V3=(d="",h)=>j3(K2(eI(d)),K2(h)),K2=d=>{try{return decodeURI(d)}catch{return d}},tI={hook:N3,searchHook:k3,parser:A3,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:d=>d},iI=le.createContext(tI),Z_=()=>le.useContext(iI),nI={},rI=le.createContext(nI),G3=()=>le.useContext(rI),Tv=d=>{const[h,_]=d.hook(d);return[V3(d.base,h),P1((T,R)=>_(U3(T,d.base),R))]},zx=()=>Tv(Z_()),sI=(d,h,_,T)=>{const{pattern:R,keys:D}=h instanceof RegExp?{keys:!1,pattern:h}:d(h||"*",T),B=R.exec(_)||[],[r,...q]=B;return r!==void 0?[!0,(()=>{const H=D!==!1?Object.fromEntries(D.map((Q,me)=>[Q,q[me]])):B.groups;let ie={...q};return H&&Object.assign(ie,H),ie})(),...T?[r]:[]]:[!1,null]},q3=({children:d,...h})=>{const _=Z_(),T=h.hook?tI:_;let R=T;const[D,B]=h.ssrPath?.split("?")??[];B&&(h.ssrSearch=B,h.ssrPath=D),h.hrefs=h.hrefs??h.hook?.hrefs;let r=le.useRef({}),q=r.current,H=q;for(let ie in T){const Q=ie==="base"?T[ie]+(h[ie]||""):h[ie]||T[ie];q===H&&Q!==H[ie]&&(r.current=H={...H}),H[ie]=Q,(Q!==T[ie]||Q!==R[ie])&&(R=H)}return le.createElement(iI.Provider,{value:R,children:d})},J2=({children:d,component:h},_)=>h?le.createElement(h,{params:_}):typeof d=="function"?d(_):d,H3=d=>{let h=le.useRef(nI);const _=h.current;return h.current=Object.keys(d).length!==Object.keys(_).length||Object.entries(d).some(([T,R])=>R!==_[T])?d:_},Ip=({path:d,nest:h,match:_,...T})=>{const R=Z_(),[D]=Tv(R),[B,r,q]=_??sI(R.parser,d,D,h),H=H3({...G3(),...r});if(!B)return null;const ie=q?le.createElement(q3,{base:q},J2(T,H)):J2(T,H);return le.createElement(rI.Provider,{value:H,children:ie})},$3=le.forwardRef((d,h)=>{const _=Z_(),[T,R]=Tv(_),{to:D="",href:B=D,onClick:r,asChild:q,children:H,className:ie,replace:Q,state:me,...we}=d,Ae=P1(Re=>{Re.ctrlKey||Re.metaKey||Re.altKey||Re.shiftKey||Re.button!==0||(r?.(Re),Re.defaultPrevented||(Re.preventDefault(),R(B,d)))}),he=_.hrefs(B[0]==="~"?B.slice(1):_.base+B,_);return q&&le.isValidElement(H)?le.cloneElement(H,{onClick:Ae,href:he}):le.createElement("a",{...we,onClick:Ae,href:he,className:ie?.call?ie(T===B):ie,children:H,ref:h})}),Xw=d=>Array.isArray(d)?d.flatMap(h=>Xw(h&&h.type===le.Fragment?h.props.children:h)):[d],Z3=({children:d,location:h})=>{const _=Z_(),[T]=Tv(_);typeof window<"u"&&(window.__WOUTER_ROUTES__||(window.__WOUTER_ROUTES__=[]),Xw(d).forEach(D=>{if(le.isValidElement(D)&&D.props.path){const B=D.props.path;window.__WOUTER_ROUTES__.includes(B)||window.__WOUTER_ROUTES__.push(B)}}));for(const R of Xw(d)){let D=0;if(le.isValidElement(R)&&(D=sI(_.parser,R.props.path,h||T,R.props.nest))[0])return le.cloneElement(R,{match:D})}return null},mx=d=>{const{to:h,href:_=h}=d,T=Z_(),[,R]=Tv(T),D=P1(()=>R(h||_,d)),{ssrContext:B}=T;return JC(()=>{D()},[]),B&&(B.redirectTo=h),null};function Q2(){const[,d]=zx(),h=()=>{d("/")};return ee.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100",children:ee.jsx(u3,{className:"w-full max-w-lg mx-4 shadow-lg border-0 bg-white/80 backdrop-blur-sm",children:ee.jsxs(h3,{className:"pt-8 pb-8 text-center",children:[ee.jsx("div",{className:"flex justify-center mb-6",children:ee.jsxs("div",{className:"relative",children:[ee.jsx("div",{className:"absolute inset-0 bg-red-100 rounded-full animate-pulse"}),ee.jsx(_3,{className:"relative h-16 w-16 text-red-500"})]})}),ee.jsx("h1",{className:"text-4xl font-bold text-slate-900 mb-2",children:"404"}),ee.jsx("h2",{className:"text-xl font-semibold text-slate-700 mb-4",children:"Page Not Found"}),ee.jsxs("p",{className:"text-slate-600 mb-8 leading-relaxed",children:["Sorry, the page you are looking for doesn't exist.",ee.jsx("br",{}),"It may have been moved or deleted."]}),ee.jsx("div",{id:"not-found-button-group",className:"flex flex-col sm:flex-row gap-3 justify-center",children:ee.jsxs(Us,{onClick:h,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg",children:[ee.jsx(y3,{className:"w-4 h-4 mr-2"}),"Go Home"]})})]})})})}var od=function(){return od=Object.assign||function(h){for(var _,T=1,R=arguments.length;T<R;T++){_=arguments[T];for(var D in _)Object.prototype.hasOwnProperty.call(_,D)&&(h[D]=_[D])}return h},od.apply(this,arguments)};function W_(d,h){var _={};for(var T in d)Object.prototype.hasOwnProperty.call(d,T)&&h.indexOf(T)<0&&(_[T]=d[T]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var R=0,T=Object.getOwnPropertySymbols(d);R<T.length;R++)h.indexOf(T[R])<0&&Object.prototype.propertyIsEnumerable.call(d,T[R])&&(_[T[R]]=d[T[R]]);return _}function W3(d,h,_,T){function R(D){return D instanceof _?D:new _(function(B){B(D)})}return new(_||(_=Promise))(function(D,B){function r(ie){try{H(T.next(ie))}catch(Q){B(Q)}}function q(ie){try{H(T.throw(ie))}catch(Q){B(Q)}}function H(ie){ie.done?D(ie.value):R(ie.value).then(r,q)}H((T=T.apply(d,h||[])).next())})}function X3(d,h,_){if(_||arguments.length===2)for(var T=0,R=h.length,D;T<R;T++)(D||!(T in h))&&(D||(D=Array.prototype.slice.call(h,0,T)),D[T]=h[T]);return d.concat(D||Array.prototype.slice.call(h))}const Y3=d=>d?(...h)=>d(...h):(...h)=>fetch(...h);class k1 extends Error{constructor(h,_="FunctionsError",T){super(h),this.name=_,this.context=T}}class K3 extends k1{constructor(h){super("Failed to send a request to the Edge Function","FunctionsFetchError",h)}}class eA extends k1{constructor(h){super("Relay Error invoking the Edge Function","FunctionsRelayError",h)}}class tA extends k1{constructor(h){super("Edge Function returned a non-2xx status code","FunctionsHttpError",h)}}var Yw;(function(d){d.Any="any",d.ApNortheast1="ap-northeast-1",d.ApNortheast2="ap-northeast-2",d.ApSouth1="ap-south-1",d.ApSoutheast1="ap-southeast-1",d.ApSoutheast2="ap-southeast-2",d.CaCentral1="ca-central-1",d.EuCentral1="eu-central-1",d.EuWest1="eu-west-1",d.EuWest2="eu-west-2",d.EuWest3="eu-west-3",d.SaEast1="sa-east-1",d.UsEast1="us-east-1",d.UsWest1="us-west-1",d.UsWest2="us-west-2"})(Yw||(Yw={}));class J3{constructor(h,{headers:_={},customFetch:T,region:R=Yw.Any}={}){this.url=h,this.headers=_,this.region=R,this.fetch=Y3(T)}setAuth(h){this.headers.Authorization=`Bearer ${h}`}invoke(h){return W3(this,arguments,void 0,function*(_,T={}){var R;let D,B;try{const{headers:r,method:q,body:H,signal:ie,timeout:Q}=T;let me={},{region:we}=T;we||(we=this.region);const Ae=new URL(`${this.url}/${_}`);we&&we!=="any"&&(me["x-region"]=we,Ae.searchParams.set("forceFunctionRegion",we));let he;H&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)?typeof Blob<"u"&&H instanceof Blob||H instanceof ArrayBuffer?(me["Content-Type"]="application/octet-stream",he=H):typeof H=="string"?(me["Content-Type"]="text/plain",he=H):typeof FormData<"u"&&H instanceof FormData?he=H:(me["Content-Type"]="application/json",he=JSON.stringify(H)):H&&typeof H!="string"&&!(typeof Blob<"u"&&H instanceof Blob)&&!(H instanceof ArrayBuffer)&&!(typeof FormData<"u"&&H instanceof FormData)?he=JSON.stringify(H):he=H;let Re=ie;Q&&(B=new AbortController,D=setTimeout(()=>B.abort(),Q),ie?(Re=B.signal,ie.addEventListener("abort",()=>B.abort())):Re=B.signal);const Ne=yield this.fetch(Ae.toString(),{method:q||"POST",headers:Object.assign(Object.assign(Object.assign({},me),this.headers),r),body:he,signal:Re}).catch(Pt=>{throw new K3(Pt)}),Ge=Ne.headers.get("x-relay-error");if(Ge&&Ge==="true")throw new eA(Ne);if(!Ne.ok)throw new tA(Ne);let Ue=((R=Ne.headers.get("Content-Type"))!==null&&R!==void 0?R:"text/plain").split(";")[0].trim(),rt;return Ue==="application/json"?rt=yield Ne.json():Ue==="application/octet-stream"||Ue==="application/pdf"?rt=yield Ne.blob():Ue==="text/event-stream"?rt=Ne:Ue==="multipart/form-data"?rt=yield Ne.formData():rt=yield Ne.text(),{data:rt,error:null,response:Ne}}catch(r){return{data:null,error:r,response:r instanceof tA||r instanceof eA?r.context:void 0}}finally{D&&clearTimeout(D)}})}}var Q3=class extends Error{constructor(d){super(d.message),this.name="PostgrestError",this.details=d.details,this.hint=d.hint,this.code=d.code}},eB=class{constructor(d){var h,_;this.shouldThrowOnError=!1,this.method=d.method,this.url=d.url,this.headers=new Headers(d.headers),this.schema=d.schema,this.body=d.body,this.shouldThrowOnError=(h=d.shouldThrowOnError)!==null&&h!==void 0?h:!1,this.signal=d.signal,this.isMaybeSingle=(_=d.isMaybeSingle)!==null&&_!==void 0?_:!1,d.fetch?this.fetch=d.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(d,h){return this.headers=new Headers(this.headers),this.headers.set(d,h),this}then(d,h){var _=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const T=this.fetch;let R=T(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async D=>{let B=null,r=null,q=null,H=D.status,ie=D.statusText;if(D.ok){var Q,me;if(_.method!=="HEAD"){var we;const Ne=await D.text();Ne===""||(_.headers.get("Accept")==="text/csv"||_.headers.get("Accept")&&(!((we=_.headers.get("Accept"))===null||we===void 0)&&we.includes("application/vnd.pgrst.plan+text"))?r=Ne:r=JSON.parse(Ne))}const he=(Q=_.headers.get("Prefer"))===null||Q===void 0?void 0:Q.match(/count=(exact|planned|estimated)/),Re=(me=D.headers.get("content-range"))===null||me===void 0?void 0:me.split("/");he&&Re&&Re.length>1&&(q=parseInt(Re[1])),_.isMaybeSingle&&_.method==="GET"&&Array.isArray(r)&&(r.length>1?(B={code:"PGRST116",details:`Results contain ${r.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},r=null,q=null,H=406,ie="Not Acceptable"):r.length===1?r=r[0]:r=null)}else{var Ae;const he=await D.text();try{B=JSON.parse(he),Array.isArray(B)&&D.status===404&&(r=[],B=null,H=200,ie="OK")}catch{D.status===404&&he===""?(H=204,ie="No Content"):B={message:he}}if(B&&_.isMaybeSingle&&(!(B==null||(Ae=B.details)===null||Ae===void 0)&&Ae.includes("0 rows"))&&(B=null,H=200,ie="OK"),B&&_.shouldThrowOnError)throw new Q3(B)}return{error:B,data:r,count:q,status:H,statusText:ie}});return this.shouldThrowOnError||(R=R.catch(D=>{var B;let r="";const q=D?.cause;if(q){var H,ie,Q,me;const Ae=(H=q?.message)!==null&&H!==void 0?H:"",he=(ie=q?.code)!==null&&ie!==void 0?ie:"";r=`${(Q=D?.name)!==null&&Q!==void 0?Q:"FetchError"}: ${D?.message}`,r+=`

Caused by: ${(me=q?.name)!==null&&me!==void 0?me:"Error"}: ${Ae}`,he&&(r+=` (${he})`),q?.stack&&(r+=`
${q.stack}`)}else{var we;r=(we=D?.stack)!==null&&we!==void 0?we:""}return{error:{message:`${(B=D?.name)!==null&&B!==void 0?B:"FetchError"}: ${D?.message}`,details:r,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),R.then(d,h)}returns(){return this}overrideTypes(){return this}},tB=class extends eB{select(d){let h=!1;const _=(d??"*").split("").map(T=>/\s/.test(T)&&!h?"":(T==='"'&&(h=!h),T)).join("");return this.url.searchParams.set("select",_),this.headers.append("Prefer","return=representation"),this}order(d,{ascending:h=!0,nullsFirst:_,foreignTable:T,referencedTable:R=T}={}){const D=R?`${R}.order`:"order",B=this.url.searchParams.get(D);return this.url.searchParams.set(D,`${B?`${B},`:""}${d}.${h?"asc":"desc"}${_===void 0?"":_?".nullsfirst":".nullslast"}`),this}limit(d,{foreignTable:h,referencedTable:_=h}={}){const T=typeof _>"u"?"limit":`${_}.limit`;return this.url.searchParams.set(T,`${d}`),this}range(d,h,{foreignTable:_,referencedTable:T=_}={}){const R=typeof T>"u"?"offset":`${T}.offset`,D=typeof T>"u"?"limit":`${T}.limit`;return this.url.searchParams.set(R,`${d}`),this.url.searchParams.set(D,`${h-d+1}`),this}abortSignal(d){return this.signal=d,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:d=!1,verbose:h=!1,settings:_=!1,buffers:T=!1,wal:R=!1,format:D="text"}={}){var B;const r=[d?"analyze":null,h?"verbose":null,_?"settings":null,T?"buffers":null,R?"wal":null].filter(Boolean).join("|"),q=(B=this.headers.get("Accept"))!==null&&B!==void 0?B:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${D}; for="${q}"; options=${r};`),D==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(d){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${d}`),this}};const iA=new RegExp("[,()]");var M_=class extends tB{eq(d,h){return this.url.searchParams.append(d,`eq.${h}`),this}neq(d,h){return this.url.searchParams.append(d,`neq.${h}`),this}gt(d,h){return this.url.searchParams.append(d,`gt.${h}`),this}gte(d,h){return this.url.searchParams.append(d,`gte.${h}`),this}lt(d,h){return this.url.searchParams.append(d,`lt.${h}`),this}lte(d,h){return this.url.searchParams.append(d,`lte.${h}`),this}like(d,h){return this.url.searchParams.append(d,`like.${h}`),this}likeAllOf(d,h){return this.url.searchParams.append(d,`like(all).{${h.join(",")}}`),this}likeAnyOf(d,h){return this.url.searchParams.append(d,`like(any).{${h.join(",")}}`),this}ilike(d,h){return this.url.searchParams.append(d,`ilike.${h}`),this}ilikeAllOf(d,h){return this.url.searchParams.append(d,`ilike(all).{${h.join(",")}}`),this}ilikeAnyOf(d,h){return this.url.searchParams.append(d,`ilike(any).{${h.join(",")}}`),this}regexMatch(d,h){return this.url.searchParams.append(d,`match.${h}`),this}regexIMatch(d,h){return this.url.searchParams.append(d,`imatch.${h}`),this}is(d,h){return this.url.searchParams.append(d,`is.${h}`),this}isDistinct(d,h){return this.url.searchParams.append(d,`isdistinct.${h}`),this}in(d,h){const _=Array.from(new Set(h)).map(T=>typeof T=="string"&&iA.test(T)?`"${T}"`:`${T}`).join(",");return this.url.searchParams.append(d,`in.(${_})`),this}notIn(d,h){const _=Array.from(new Set(h)).map(T=>typeof T=="string"&&iA.test(T)?`"${T}"`:`${T}`).join(",");return this.url.searchParams.append(d,`not.in.(${_})`),this}contains(d,h){return typeof h=="string"?this.url.searchParams.append(d,`cs.${h}`):Array.isArray(h)?this.url.searchParams.append(d,`cs.{${h.join(",")}}`):this.url.searchParams.append(d,`cs.${JSON.stringify(h)}`),this}containedBy(d,h){return typeof h=="string"?this.url.searchParams.append(d,`cd.${h}`):Array.isArray(h)?this.url.searchParams.append(d,`cd.{${h.join(",")}}`):this.url.searchParams.append(d,`cd.${JSON.stringify(h)}`),this}rangeGt(d,h){return this.url.searchParams.append(d,`sr.${h}`),this}rangeGte(d,h){return this.url.searchParams.append(d,`nxl.${h}`),this}rangeLt(d,h){return this.url.searchParams.append(d,`sl.${h}`),this}rangeLte(d,h){return this.url.searchParams.append(d,`nxr.${h}`),this}rangeAdjacent(d,h){return this.url.searchParams.append(d,`adj.${h}`),this}overlaps(d,h){return typeof h=="string"?this.url.searchParams.append(d,`ov.${h}`):this.url.searchParams.append(d,`ov.{${h.join(",")}}`),this}textSearch(d,h,{config:_,type:T}={}){let R="";T==="plain"?R="pl":T==="phrase"?R="ph":T==="websearch"&&(R="w");const D=_===void 0?"":`(${_})`;return this.url.searchParams.append(d,`${R}fts${D}.${h}`),this}match(d){return Object.entries(d).forEach(([h,_])=>{this.url.searchParams.append(h,`eq.${_}`)}),this}not(d,h,_){return this.url.searchParams.append(d,`not.${h}.${_}`),this}or(d,{foreignTable:h,referencedTable:_=h}={}){const T=_?`${_}.or`:"or";return this.url.searchParams.append(T,`(${d})`),this}filter(d,h,_){return this.url.searchParams.append(d,`${h}.${_}`),this}},iB=class{constructor(d,{headers:h={},schema:_,fetch:T}){this.url=d,this.headers=new Headers(h),this.schema=_,this.fetch=T}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(d,h){const{head:_=!1,count:T}=h??{},R=_?"HEAD":"GET";let D=!1;const B=(d??"*").split("").map(H=>/\s/.test(H)&&!D?"":(H==='"'&&(D=!D),H)).join(""),{url:r,headers:q}=this.cloneRequestState();return r.searchParams.set("select",B),T&&q.append("Prefer",`count=${T}`),new M_({method:R,url:r,headers:q,schema:this.schema,fetch:this.fetch})}insert(d,{count:h,defaultToNull:_=!0}={}){var T;const R="POST",{url:D,headers:B}=this.cloneRequestState();if(h&&B.append("Prefer",`count=${h}`),_||B.append("Prefer","missing=default"),Array.isArray(d)){const r=d.reduce((q,H)=>q.concat(Object.keys(H)),[]);if(r.length>0){const q=[...new Set(r)].map(H=>`"${H}"`);D.searchParams.set("columns",q.join(","))}}return new M_({method:R,url:D,headers:B,schema:this.schema,body:d,fetch:(T=this.fetch)!==null&&T!==void 0?T:fetch})}upsert(d,{onConflict:h,ignoreDuplicates:_=!1,count:T,defaultToNull:R=!0}={}){var D;const B="POST",{url:r,headers:q}=this.cloneRequestState();if(q.append("Prefer",`resolution=${_?"ignore":"merge"}-duplicates`),h!==void 0&&r.searchParams.set("on_conflict",h),T&&q.append("Prefer",`count=${T}`),R||q.append("Prefer","missing=default"),Array.isArray(d)){const H=d.reduce((ie,Q)=>ie.concat(Object.keys(Q)),[]);if(H.length>0){const ie=[...new Set(H)].map(Q=>`"${Q}"`);r.searchParams.set("columns",ie.join(","))}}return new M_({method:B,url:r,headers:q,schema:this.schema,body:d,fetch:(D=this.fetch)!==null&&D!==void 0?D:fetch})}update(d,{count:h}={}){var _;const T="PATCH",{url:R,headers:D}=this.cloneRequestState();return h&&D.append("Prefer",`count=${h}`),new M_({method:T,url:R,headers:D,schema:this.schema,body:d,fetch:(_=this.fetch)!==null&&_!==void 0?_:fetch})}delete({count:d}={}){var h;const _="DELETE",{url:T,headers:R}=this.cloneRequestState();return d&&R.append("Prefer",`count=${d}`),new M_({method:_,url:T,headers:R,schema:this.schema,fetch:(h=this.fetch)!==null&&h!==void 0?h:fetch})}},nB=class oI{constructor(h,{headers:_={},schema:T,fetch:R}={}){this.url=h,this.headers=new Headers(_),this.schemaName=T,this.fetch=R}from(h){if(!h||typeof h!="string"||h.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new iB(new URL(`${this.url}/${h}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(h){return new oI(this.url,{headers:this.headers,schema:h,fetch:this.fetch})}rpc(h,_={},{head:T=!1,get:R=!1,count:D}={}){var B;let r;const q=new URL(`${this.url}/rpc/${h}`);let H;const ie=we=>we!==null&&typeof we=="object"&&(!Array.isArray(we)||we.some(ie)),Q=T&&Object.values(_).some(ie);Q?(r="POST",H=_):T||R?(r=T?"HEAD":"GET",Object.entries(_).filter(([we,Ae])=>Ae!==void 0).map(([we,Ae])=>[we,Array.isArray(Ae)?`{${Ae.join(",")}}`:`${Ae}`]).forEach(([we,Ae])=>{q.searchParams.append(we,Ae)})):(r="POST",H=_);const me=new Headers(this.headers);return Q?me.set("Prefer",D?`count=${D},return=minimal`:"return=minimal"):D&&me.set("Prefer",`count=${D}`),new M_({method:r,url:q,headers:me,schema:this.schemaName,body:H,fetch:(B=this.fetch)!==null&&B!==void 0?B:fetch})}};class rB{constructor(){}static detectEnvironment(){var h;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((h=navigator.userAgent)===null||h===void 0)&&h.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const _=globalThis.process;if(_){const T=_.versions;if(T&&T.node){const R=T.node,D=parseInt(R.replace(/^v/,"").split(".")[0]);return D>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${D} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${D} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const h=this.detectEnvironment();if(h.constructor)return h.constructor;let _=h.error||"WebSocket not supported in this environment.";throw h.workaround&&(_+=`

Suggested solution: ${h.workaround}`),new Error(_)}static createWebSocket(h,_){const T=this.getWebSocketConstructor();return new T(h,_)}static isWebSocketSupported(){try{const h=this.detectEnvironment();return h.type==="native"||h.type==="ws"}catch{return!1}}}const sB="2.90.1",oB=`realtime-js/${sB}`,aI="1.0.0",aB="2.0.0",nA=aI,Kw=1e4,lB=1e3,cB=100;var Dp;(function(d){d[d.connecting=0]="connecting",d[d.open=1]="open",d[d.closing=2]="closing",d[d.closed=3]="closed"})(Dp||(Dp={}));var Zo;(function(d){d.closed="closed",d.errored="errored",d.joined="joined",d.joining="joining",d.leaving="leaving"})(Zo||(Zo={}));var eh;(function(d){d.close="phx_close",d.error="phx_error",d.join="phx_join",d.reply="phx_reply",d.leave="phx_leave",d.access_token="access_token"})(eh||(eh={}));var Jw;(function(d){d.websocket="websocket"})(Jw||(Jw={}));var og;(function(d){d.Connecting="connecting",d.Open="open",d.Closing="closing",d.Closed="closed"})(og||(og={}));class uB{constructor(h){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=h??[]}encode(h,_){if(h.event===this.BROADCAST_EVENT&&!(h.payload instanceof ArrayBuffer)&&typeof h.payload.event=="string")return _(this._binaryEncodeUserBroadcastPush(h));let T=[h.join_ref,h.ref,h.topic,h.event,h.payload];return _(JSON.stringify(T))}_binaryEncodeUserBroadcastPush(h){var _;return this._isArrayBuffer((_=h.payload)===null||_===void 0?void 0:_.payload)?this._encodeBinaryUserBroadcastPush(h):this._encodeJsonUserBroadcastPush(h)}_encodeBinaryUserBroadcastPush(h){var _,T;const R=(T=(_=h.payload)===null||_===void 0?void 0:_.payload)!==null&&T!==void 0?T:new ArrayBuffer(0);return this._encodeUserBroadcastPush(h,this.BINARY_ENCODING,R)}_encodeJsonUserBroadcastPush(h){var _,T;const R=(T=(_=h.payload)===null||_===void 0?void 0:_.payload)!==null&&T!==void 0?T:{},B=new TextEncoder().encode(JSON.stringify(R)).buffer;return this._encodeUserBroadcastPush(h,this.JSON_ENCODING,B)}_encodeUserBroadcastPush(h,_,T){var R,D;const B=h.topic,r=(R=h.ref)!==null&&R!==void 0?R:"",q=(D=h.join_ref)!==null&&D!==void 0?D:"",H=h.payload.event,ie=this.allowedMetadataKeys?this._pick(h.payload,this.allowedMetadataKeys):{},Q=Object.keys(ie).length===0?"":JSON.stringify(ie);if(q.length>255)throw new Error(`joinRef length ${q.length} exceeds maximum of 255`);if(r.length>255)throw new Error(`ref length ${r.length} exceeds maximum of 255`);if(B.length>255)throw new Error(`topic length ${B.length} exceeds maximum of 255`);if(H.length>255)throw new Error(`userEvent length ${H.length} exceeds maximum of 255`);if(Q.length>255)throw new Error(`metadata length ${Q.length} exceeds maximum of 255`);const me=this.USER_BROADCAST_PUSH_META_LENGTH+q.length+r.length+B.length+H.length+Q.length,we=new ArrayBuffer(this.HEADER_LENGTH+me);let Ae=new DataView(we),he=0;Ae.setUint8(he++,this.KINDS.userBroadcastPush),Ae.setUint8(he++,q.length),Ae.setUint8(he++,r.length),Ae.setUint8(he++,B.length),Ae.setUint8(he++,H.length),Ae.setUint8(he++,Q.length),Ae.setUint8(he++,_),Array.from(q,Ne=>Ae.setUint8(he++,Ne.charCodeAt(0))),Array.from(r,Ne=>Ae.setUint8(he++,Ne.charCodeAt(0))),Array.from(B,Ne=>Ae.setUint8(he++,Ne.charCodeAt(0))),Array.from(H,Ne=>Ae.setUint8(he++,Ne.charCodeAt(0))),Array.from(Q,Ne=>Ae.setUint8(he++,Ne.charCodeAt(0)));var Re=new Uint8Array(we.byteLength+T.byteLength);return Re.set(new Uint8Array(we),0),Re.set(new Uint8Array(T),we.byteLength),Re.buffer}decode(h,_){if(this._isArrayBuffer(h)){let T=this._binaryDecode(h);return _(T)}if(typeof h=="string"){const T=JSON.parse(h),[R,D,B,r,q]=T;return _({join_ref:R,ref:D,topic:B,event:r,payload:q})}return _({})}_binaryDecode(h){const _=new DataView(h),T=_.getUint8(0),R=new TextDecoder;switch(T){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(h,_,R)}}_decodeUserBroadcast(h,_,T){const R=_.getUint8(1),D=_.getUint8(2),B=_.getUint8(3),r=_.getUint8(4);let q=this.HEADER_LENGTH+4;const H=T.decode(h.slice(q,q+R));q=q+R;const ie=T.decode(h.slice(q,q+D));q=q+D;const Q=T.decode(h.slice(q,q+B));q=q+B;const me=h.slice(q,h.byteLength),we=r===this.JSON_ENCODING?JSON.parse(T.decode(me)):me,Ae={type:this.BROADCAST_EVENT,event:ie,payload:we};return B>0&&(Ae.meta=JSON.parse(Q)),{join_ref:null,ref:null,topic:H,event:this.BROADCAST_EVENT,payload:Ae}}_isArrayBuffer(h){var _;return h instanceof ArrayBuffer||((_=h?.constructor)===null||_===void 0?void 0:_.name)==="ArrayBuffer"}_pick(h,_){return!h||typeof h!="object"?{}:Object.fromEntries(Object.entries(h).filter(([T])=>_.includes(T)))}}class lI{constructor(h,_){this.callback=h,this.timerCalc=_,this.timer=void 0,this.tries=0,this.callback=h,this.timerCalc=_}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var us;(function(d){d.abstime="abstime",d.bool="bool",d.date="date",d.daterange="daterange",d.float4="float4",d.float8="float8",d.int2="int2",d.int4="int4",d.int4range="int4range",d.int8="int8",d.int8range="int8range",d.json="json",d.jsonb="jsonb",d.money="money",d.numeric="numeric",d.oid="oid",d.reltime="reltime",d.text="text",d.time="time",d.timestamp="timestamp",d.timestamptz="timestamptz",d.timetz="timetz",d.tsrange="tsrange",d.tstzrange="tstzrange"})(us||(us={}));const rA=(d,h,_={})=>{var T;const R=(T=_.skipTypes)!==null&&T!==void 0?T:[];return h?Object.keys(h).reduce((D,B)=>(D[B]=hB(B,d,h,R),D),{}):{}},hB=(d,h,_,T)=>{const R=h.find(r=>r.name===d),D=R?.type,B=_[d];return D&&!T.includes(D)?cI(D,B):Qw(B)},cI=(d,h)=>{if(d.charAt(0)==="_"){const _=d.slice(1,d.length);return mB(h,_)}switch(d){case us.bool:return dB(h);case us.float4:case us.float8:case us.int2:case us.int4:case us.int8:case us.numeric:case us.oid:return fB(h);case us.json:case us.jsonb:return pB(h);case us.timestamp:return gB(h);case us.abstime:case us.date:case us.daterange:case us.int4range:case us.int8range:case us.money:case us.reltime:case us.text:case us.time:case us.timestamptz:case us.timetz:case us.tsrange:case us.tstzrange:return Qw(h);default:return Qw(h)}},Qw=d=>d,dB=d=>{switch(d){case"t":return!0;case"f":return!1;default:return d}},fB=d=>{if(typeof d=="string"){const h=parseFloat(d);if(!Number.isNaN(h))return h}return d},pB=d=>{if(typeof d=="string")try{return JSON.parse(d)}catch{return d}return d},mB=(d,h)=>{if(typeof d!="string")return d;const _=d.length-1,T=d[_];if(d[0]==="{"&&T==="}"){let D;const B=d.slice(1,_);try{D=JSON.parse("["+B+"]")}catch{D=B?B.split(","):[]}return D.map(r=>cI(h,r))}return d},gB=d=>typeof d=="string"?d.replace(" ","T"):d,uI=d=>{const h=new URL(d);return h.protocol=h.protocol.replace(/^ws/i,"http"),h.pathname=h.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),h.pathname===""||h.pathname==="/"?h.pathname="/api/broadcast":h.pathname=h.pathname+"/api/broadcast",h.href};class yw{constructor(h,_,T={},R=Kw){this.channel=h,this.event=_,this.payload=T,this.timeout=R,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(h){this.timeout=h,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(h){this.payload=Object.assign(Object.assign({},this.payload),h)}receive(h,_){var T;return this._hasReceived(h)&&_((T=this.receivedResp)===null||T===void 0?void 0:T.response),this.recHooks.push({status:h,callback:_}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const h=_=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=_,this._matchReceive(_)};this.channel._on(this.refEvent,{},h),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(h,_){this.refEvent&&this.channel._trigger(this.refEvent,{status:h,response:_})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:h,response:_}){this.recHooks.filter(T=>T.status===h).forEach(T=>T.callback(_))}_hasReceived(h){return this.receivedResp&&this.receivedResp.status===h}}var sA;(function(d){d.SYNC="sync",d.JOIN="join",d.LEAVE="leave"})(sA||(sA={}));class cv{constructor(h,_){this.channel=h,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const T=_?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(T.state,{},R=>{const{onJoin:D,onLeave:B,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=cv.syncState(this.state,R,D,B),this.pendingDiffs.forEach(q=>{this.state=cv.syncDiff(this.state,q,D,B)}),this.pendingDiffs=[],r()}),this.channel._on(T.diff,{},R=>{const{onJoin:D,onLeave:B,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(R):(this.state=cv.syncDiff(this.state,R,D,B),r())}),this.onJoin((R,D,B)=>{this.channel._trigger("presence",{event:"join",key:R,currentPresences:D,newPresences:B})}),this.onLeave((R,D,B)=>{this.channel._trigger("presence",{event:"leave",key:R,currentPresences:D,leftPresences:B})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(h,_,T,R){const D=this.cloneDeep(h),B=this.transformState(_),r={},q={};return this.map(D,(H,ie)=>{B[H]||(q[H]=ie)}),this.map(B,(H,ie)=>{const Q=D[H];if(Q){const me=ie.map(Re=>Re.presence_ref),we=Q.map(Re=>Re.presence_ref),Ae=ie.filter(Re=>we.indexOf(Re.presence_ref)<0),he=Q.filter(Re=>me.indexOf(Re.presence_ref)<0);Ae.length>0&&(r[H]=Ae),he.length>0&&(q[H]=he)}else r[H]=ie}),this.syncDiff(D,{joins:r,leaves:q},T,R)}static syncDiff(h,_,T,R){const{joins:D,leaves:B}={joins:this.transformState(_.joins),leaves:this.transformState(_.leaves)};return T||(T=()=>{}),R||(R=()=>{}),this.map(D,(r,q)=>{var H;const ie=(H=h[r])!==null&&H!==void 0?H:[];if(h[r]=this.cloneDeep(q),ie.length>0){const Q=h[r].map(we=>we.presence_ref),me=ie.filter(we=>Q.indexOf(we.presence_ref)<0);h[r].unshift(...me)}T(r,ie,q)}),this.map(B,(r,q)=>{let H=h[r];if(!H)return;const ie=q.map(Q=>Q.presence_ref);H=H.filter(Q=>ie.indexOf(Q.presence_ref)<0),h[r]=H,R(r,H,q),H.length===0&&delete h[r]}),h}static map(h,_){return Object.getOwnPropertyNames(h).map(T=>_(T,h[T]))}static transformState(h){return h=this.cloneDeep(h),Object.getOwnPropertyNames(h).reduce((_,T)=>{const R=h[T];return"metas"in R?_[T]=R.metas.map(D=>(D.presence_ref=D.phx_ref,delete D.phx_ref,delete D.phx_ref_prev,D)):_[T]=R,_},{})}static cloneDeep(h){return JSON.parse(JSON.stringify(h))}onJoin(h){this.caller.onJoin=h}onLeave(h){this.caller.onLeave=h}onSync(h){this.caller.onSync=h}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var oA;(function(d){d.ALL="*",d.INSERT="INSERT",d.UPDATE="UPDATE",d.DELETE="DELETE"})(oA||(oA={}));var uv;(function(d){d.BROADCAST="broadcast",d.PRESENCE="presence",d.POSTGRES_CHANGES="postgres_changes",d.SYSTEM="system"})(uv||(uv={}));var gf;(function(d){d.SUBSCRIBED="SUBSCRIBED",d.TIMED_OUT="TIMED_OUT",d.CLOSED="CLOSED",d.CHANNEL_ERROR="CHANNEL_ERROR"})(gf||(gf={}));class P_{constructor(h,_={config:{}},T){var R,D;if(this.topic=h,this.params=_,this.socket=T,this.bindings={},this.state=Zo.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=h.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},_.config),this.timeout=this.socket.timeout,this.joinPush=new yw(this,eh.join,this.params,this.timeout),this.rejoinTimer=new lI(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Zo.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(B=>B.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Zo.closed,this.socket._remove(this)}),this._onError(B=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,B),this.state=Zo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Zo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",B=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,B),this.state=Zo.errored,this.rejoinTimer.scheduleTimeout())}),this._on(eh.reply,{},(B,r)=>{this._trigger(this._replyEventName(r),B)}),this.presence=new cv(this),this.broadcastEndpointURL=uI(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((D=(R=this.params.config)===null||R===void 0?void 0:R.broadcast)===null||D===void 0)&&D.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(h,_=this.timeout){var T,R,D;if(this.socket.isConnected()||this.socket.connect(),this.state==Zo.closed){const{config:{broadcast:B,presence:r,private:q}}=this.params,H=(R=(T=this.bindings.postgres_changes)===null||T===void 0?void 0:T.map(we=>we.filter))!==null&&R!==void 0?R:[],ie=!!this.bindings[uv.PRESENCE]&&this.bindings[uv.PRESENCE].length>0||((D=this.params.config.presence)===null||D===void 0?void 0:D.enabled)===!0,Q={},me={broadcast:B,presence:Object.assign(Object.assign({},r),{enabled:ie}),postgres_changes:H,private:q};this.socket.accessTokenValue&&(Q.access_token=this.socket.accessTokenValue),this._onError(we=>h?.(gf.CHANNEL_ERROR,we)),this._onClose(()=>h?.(gf.CLOSED)),this.updateJoinPayload(Object.assign({config:me},Q)),this.joinedOnce=!0,this._rejoin(_),this.joinPush.receive("ok",async({postgres_changes:we})=>{var Ae;if(this.socket._isManualToken()||this.socket.setAuth(),we===void 0){h?.(gf.SUBSCRIBED);return}else{const he=this.bindings.postgres_changes,Re=(Ae=he?.length)!==null&&Ae!==void 0?Ae:0,Ne=[];for(let Ge=0;Ge<Re;Ge++){const Ue=he[Ge],{filter:{event:rt,schema:Pt,table:Bt,filter:Tt}}=Ue,Ht=we&&we[Ge];if(Ht&&Ht.event===rt&&P_.isFilterValueEqual(Ht.schema,Pt)&&P_.isFilterValueEqual(Ht.table,Bt)&&P_.isFilterValueEqual(Ht.filter,Tt))Ne.push(Object.assign(Object.assign({},Ue),{id:Ht.id}));else{this.unsubscribe(),this.state=Zo.errored,h?.(gf.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=Ne,h&&h(gf.SUBSCRIBED);return}}).receive("error",we=>{this.state=Zo.errored,h?.(gf.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(we).join(", ")||"error")))}).receive("timeout",()=>{h?.(gf.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(h,_={}){return await this.send({type:"presence",event:"track",payload:h},_.timeout||this.timeout)}async untrack(h={}){return await this.send({type:"presence",event:"untrack"},h)}on(h,_,T){return this.state===Zo.joined&&h===uv.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(h,_,T)}async httpSend(h,_,T={}){var R;if(_==null)return Promise.reject("Payload is required for httpSend()");const D={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(D.Authorization=`Bearer ${this.socket.accessTokenValue}`);const B={method:"POST",headers:D,body:JSON.stringify({messages:[{topic:this.subTopic,event:h,payload:_,private:this.private}]})},r=await this._fetchWithTimeout(this.broadcastEndpointURL,B,(R=T.timeout)!==null&&R!==void 0?R:this.timeout);if(r.status===202)return{success:!0};let q=r.statusText;try{const H=await r.json();q=H.error||H.message||q}catch{}return Promise.reject(new Error(q))}async send(h,_={}){var T,R;if(!this._canPush()&&h.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:D,payload:B}=h,r={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(r.Authorization=`Bearer ${this.socket.accessTokenValue}`);const q={method:"POST",headers:r,body:JSON.stringify({messages:[{topic:this.subTopic,event:D,payload:B,private:this.private}]})};try{const H=await this._fetchWithTimeout(this.broadcastEndpointURL,q,(T=_.timeout)!==null&&T!==void 0?T:this.timeout);return await((R=H.body)===null||R===void 0?void 0:R.cancel()),H.ok?"ok":"error"}catch(H){return H.name==="AbortError"?"timed out":"error"}}else return new Promise(D=>{var B,r,q;const H=this._push(h.type,h,_.timeout||this.timeout);h.type==="broadcast"&&!(!((q=(r=(B=this.params)===null||B===void 0?void 0:B.config)===null||r===void 0?void 0:r.broadcast)===null||q===void 0)&&q.ack)&&D("ok"),H.receive("ok",()=>D("ok")),H.receive("error",()=>D("error")),H.receive("timeout",()=>D("timed out"))})}updateJoinPayload(h){this.joinPush.updatePayload(h)}unsubscribe(h=this.timeout){this.state=Zo.leaving;const _=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(eh.close,"leave",this._joinRef())};this.joinPush.destroy();let T=null;return new Promise(R=>{T=new yw(this,eh.leave,{},h),T.receive("ok",()=>{_(),R("ok")}).receive("timeout",()=>{_(),R("timed out")}).receive("error",()=>{R("error")}),T.send(),this._canPush()||T.trigger("ok",{})}).finally(()=>{T?.destroy()})}teardown(){this.pushBuffer.forEach(h=>h.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Zo.closed,this.bindings={}}async _fetchWithTimeout(h,_,T){const R=new AbortController,D=setTimeout(()=>R.abort(),T),B=await this.socket.fetch(h,Object.assign(Object.assign({},_),{signal:R.signal}));return clearTimeout(D),B}_push(h,_,T=this.timeout){if(!this.joinedOnce)throw`tried to push '${h}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let R=new yw(this,h,_,T);return this._canPush()?R.send():this._addToPushBuffer(R),R}_addToPushBuffer(h){if(h.startTimeout(),this.pushBuffer.push(h),this.pushBuffer.length>cB){const _=this.pushBuffer.shift();_&&(_.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${_.event}`,_.payload))}}_onMessage(h,_,T){return _}_isMember(h){return this.topic===h}_joinRef(){return this.joinPush.ref}_trigger(h,_,T){var R,D;const B=h.toLocaleLowerCase(),{close:r,error:q,leave:H,join:ie}=eh;if(T&&[r,q,H,ie].indexOf(B)>=0&&T!==this._joinRef())return;let me=this._onMessage(B,_,T);if(_&&!me)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(B)?(R=this.bindings.postgres_changes)===null||R===void 0||R.filter(we=>{var Ae,he,Re;return((Ae=we.filter)===null||Ae===void 0?void 0:Ae.event)==="*"||((Re=(he=we.filter)===null||he===void 0?void 0:he.event)===null||Re===void 0?void 0:Re.toLocaleLowerCase())===B}).map(we=>we.callback(me,T)):(D=this.bindings[B])===null||D===void 0||D.filter(we=>{var Ae,he,Re,Ne,Ge,Ue,rt,Pt;if(["broadcast","presence","postgres_changes"].includes(B))if("id"in we){const Bt=we.id,Tt=(Ae=we.filter)===null||Ae===void 0?void 0:Ae.event;return Bt&&((he=_.ids)===null||he===void 0?void 0:he.includes(Bt))&&(Tt==="*"||Tt?.toLocaleLowerCase()===((Re=_.data)===null||Re===void 0?void 0:Re.type.toLocaleLowerCase()))&&(!(!((Ne=we.filter)===null||Ne===void 0)&&Ne.table)||we.filter.table===((Ge=_.data)===null||Ge===void 0?void 0:Ge.table))}else{const Bt=(rt=(Ue=we?.filter)===null||Ue===void 0?void 0:Ue.event)===null||rt===void 0?void 0:rt.toLocaleLowerCase();return Bt==="*"||Bt===((Pt=_?.event)===null||Pt===void 0?void 0:Pt.toLocaleLowerCase())}else return we.type.toLocaleLowerCase()===B}).map(we=>{if(typeof me=="object"&&"ids"in me){const Ae=me.data,{schema:he,table:Re,commit_timestamp:Ne,type:Ge,errors:Ue}=Ae;me=Object.assign(Object.assign({},{schema:he,table:Re,commit_timestamp:Ne,eventType:Ge,new:{},old:{},errors:Ue}),this._getPayloadRecords(Ae))}we.callback(me,T)})}_isClosed(){return this.state===Zo.closed}_isJoined(){return this.state===Zo.joined}_isJoining(){return this.state===Zo.joining}_isLeaving(){return this.state===Zo.leaving}_replyEventName(h){return`chan_reply_${h}`}_on(h,_,T){const R=h.toLocaleLowerCase(),D={type:R,filter:_,callback:T};return this.bindings[R]?this.bindings[R].push(D):this.bindings[R]=[D],this}_off(h,_){const T=h.toLocaleLowerCase();return this.bindings[T]&&(this.bindings[T]=this.bindings[T].filter(R=>{var D;return!(((D=R.type)===null||D===void 0?void 0:D.toLocaleLowerCase())===T&&P_.isEqual(R.filter,_))})),this}static isEqual(h,_){if(Object.keys(h).length!==Object.keys(_).length)return!1;for(const T in h)if(h[T]!==_[T])return!1;return!0}static isFilterValueEqual(h,_){return(h??void 0)===(_??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(h){this._on(eh.close,{},h)}_onError(h){this._on(eh.error,{},_=>h(_))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(h=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Zo.joining,this.joinPush.resend(h))}_getPayloadRecords(h){const _={new:{},old:{}};return(h.type==="INSERT"||h.type==="UPDATE")&&(_.new=rA(h.columns,h.record)),(h.type==="UPDATE"||h.type==="DELETE")&&(_.old=rA(h.columns,h.old_record)),_}}const vw=()=>{},$0={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},_B=[1e3,2e3,5e3,1e4],yB=1e4,vB=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class xB{constructor(h,_){var T;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Kw,this.transport=null,this.heartbeatIntervalMs=$0.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=vw,this.ref=0,this.reconnectTimer=null,this.vsn=nA,this.logger=vw,this.conn=null,this.sendBuffer=[],this.serializer=new uB,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=R=>R?(...D)=>R(...D):(...D)=>fetch(...D),!(!((T=_?.params)===null||T===void 0)&&T.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=_.params.apikey,this.endPoint=`${h}/${Jw.websocket}`,this.httpEndpoint=uI(h),this._initializeOptions(_),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(_?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=rB.createWebSocket(this.endpointURL())}catch(h){this._setConnectionState("disconnected");const _=h.message;throw _.includes("Node.js")?new Error(`${_}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${_}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(h,_){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const T=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(T),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(h?this.conn.close(h,_??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(h){const _=await h.unsubscribe();return this.channels.length===0&&this.disconnect(),_}async removeAllChannels(){const h=await Promise.all(this.channels.map(_=>_.unsubscribe()));return this.channels=[],this.disconnect(),h}log(h,_,T){this.logger(h,_,T)}connectionState(){switch(this.conn&&this.conn.readyState){case Dp.connecting:return og.Connecting;case Dp.open:return og.Open;case Dp.closing:return og.Closing;default:return og.Closed}}isConnected(){return this.connectionState()===og.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(h,_={config:{}}){const T=`realtime:${h}`,R=this.getChannels().find(D=>D.topic===T);if(R)return R;{const D=new P_(`realtime:${h}`,_,this);return this.channels.push(D),D}}push(h){const{topic:_,event:T,payload:R,ref:D}=h,B=()=>{this.encode(h,r=>{var q;(q=this.conn)===null||q===void 0||q.send(r)})};this.log("push",`${_} ${T} (${D})`,R),this.isConnected()?B():this.sendBuffer.push(B)}async setAuth(h=null){this._authPromise=this._performAuth(h);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var h;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(_){this.log("error","error in heartbeat callback",_)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(_){this.log("error","error in heartbeat callback",_)}this._wasManualDisconnect=!1,(h=this.conn)===null||h===void 0||h.close(lB,"heartbeat timeout"),setTimeout(()=>{var _;this.isConnected()||(_=this.reconnectTimer)===null||_===void 0||_.scheduleTimeout()},$0.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(_){this.log("error","error in heartbeat callback",_)}this._setAuthSafely("heartbeat")}onHeartbeat(h){this.heartbeatCallback=h}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(h=>h()),this.sendBuffer=[])}_makeRef(){let h=this.ref+1;return h===this.ref?this.ref=0:this.ref=h,this.ref.toString()}_leaveOpenTopic(h){let _=this.channels.find(T=>T.topic===h&&(T._isJoined()||T._isJoining()));_&&(this.log("transport",`leaving duplicate topic "${h}"`),_.unsubscribe())}_remove(h){this.channels=this.channels.filter(_=>_.topic!==h.topic)}_onConnMessage(h){this.decode(h.data,_=>{if(_.topic==="phoenix"&&_.event==="phx_reply"&&_.ref&&_.ref===this.pendingHeartbeatRef){const H=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(_.payload.status==="ok"?"ok":"error",H)}catch(ie){this.log("error","error in heartbeat callback",ie)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:T,event:R,payload:D,ref:B}=_,r=B?`(${B})`:"",q=D.status||"";this.log("receive",`${q} ${T} ${R} ${r}`.trim(),D),this.channels.filter(H=>H._isMember(T)).forEach(H=>H._trigger(R,D,B)),this._triggerStateCallbacks("message",_)})}_clearTimer(h){var _;h==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):h==="reconnect"&&((_=this.reconnectTimer)===null||_===void 0||_.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=h=>this._onConnError(h),this.conn.onmessage=h=>this._onConnMessage(h),this.conn.onclose=h=>this._onConnClose(h),this.conn.readyState===Dp.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Dp.open||this.conn.readyState===Dp.connecting)try{this.conn.close()}catch(h){this.log("error","Error closing connection",h)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(h=>h.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(_=>{this.log("error","error waiting for auth on connect",_),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const h=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(h),this.workerRef.onerror=_=>{this.log("worker","worker error",_.message),this._terminateWorker()},this.workerRef.onmessage=_=>{_.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(h){var _;this._setConnectionState("disconnected"),this.log("transport","close",h),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(_=this.reconnectTimer)===null||_===void 0||_.scheduleTimeout(),this._triggerStateCallbacks("close",h)}_onConnError(h){this._setConnectionState("disconnected"),this.log("transport",`${h}`),this._triggerChanError(),this._triggerStateCallbacks("error",h)}_triggerChanError(){this.channels.forEach(h=>h._trigger(eh.error))}_appendParams(h,_){if(Object.keys(_).length===0)return h;const T=h.match(/\?/)?"&":"?",R=new URLSearchParams(_);return`${h}${T}${R}`}_workerObjectUrl(h){let _;if(h)_=h;else{const T=new Blob([vB],{type:"application/javascript"});_=URL.createObjectURL(T)}return _}_setConnectionState(h,_=!1){this._connectionState=h,h==="connecting"?this._wasManualDisconnect=!1:h==="disconnecting"&&(this._wasManualDisconnect=_)}async _performAuth(h=null){let _,T=!1;if(h)_=h,T=!0;else if(this.accessToken)try{_=await this.accessToken()}catch(R){this.log("error","Error fetching access token from callback",R),_=this.accessTokenValue}else _=this.accessTokenValue;T?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=_&&(this.accessTokenValue=_,this.channels.forEach(R=>{const D={access_token:_,version:oB};_&&R.updateJoinPayload(D),R.joinedOnce&&R._isJoined()&&R._push(eh.access_token,{access_token:_})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(h="general"){this._isManualToken()||this.setAuth().catch(_=>{this.log("error",`Error setting auth in ${h}`,_)})}_triggerStateCallbacks(h,_){try{this.stateChangeCallbacks[h].forEach(T=>{try{T(_)}catch(R){this.log("error",`error in ${h} callback`,R)}})}catch(T){this.log("error",`error triggering ${h} callbacks`,T)}}_setupReconnectionTimer(){this.reconnectTimer=new lI(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},$0.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(h){var _,T,R,D,B,r,q,H,ie,Q,me,we;switch(this.transport=(_=h?.transport)!==null&&_!==void 0?_:null,this.timeout=(T=h?.timeout)!==null&&T!==void 0?T:Kw,this.heartbeatIntervalMs=(R=h?.heartbeatIntervalMs)!==null&&R!==void 0?R:$0.HEARTBEAT_INTERVAL,this.worker=(D=h?.worker)!==null&&D!==void 0?D:!1,this.accessToken=(B=h?.accessToken)!==null&&B!==void 0?B:null,this.heartbeatCallback=(r=h?.heartbeatCallback)!==null&&r!==void 0?r:vw,this.vsn=(q=h?.vsn)!==null&&q!==void 0?q:nA,h?.params&&(this.params=h.params),h?.logger&&(this.logger=h.logger),(h?.logLevel||h?.log_level)&&(this.logLevel=h.logLevel||h.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(H=h?.reconnectAfterMs)!==null&&H!==void 0?H:(Ae=>_B[Ae-1]||yB),this.vsn){case aI:this.encode=(ie=h?.encode)!==null&&ie!==void 0?ie:((Ae,he)=>he(JSON.stringify(Ae))),this.decode=(Q=h?.decode)!==null&&Q!==void 0?Q:((Ae,he)=>he(JSON.parse(Ae)));break;case aB:this.encode=(me=h?.encode)!==null&&me!==void 0?me:this.serializer.encode.bind(this.serializer),this.decode=(we=h?.decode)!==null&&we!==void 0?we:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=h?.workerUrl}}}var mv=class extends Error{constructor(d,h){super(d),this.name="IcebergError",this.status=h.status,this.icebergType=h.icebergType,this.icebergCode=h.icebergCode,this.details=h.details,this.isCommitStateUnknown=h.icebergType==="CommitStateUnknownException"||[500,502,504].includes(h.status)&&h.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function bB(d,h,_){const T=new URL(h,d);if(_)for(const[R,D]of Object.entries(_))D!==void 0&&T.searchParams.set(R,D);return T.toString()}async function wB(d){return!d||d.type==="none"?{}:d.type==="bearer"?{Authorization:`Bearer ${d.token}`}:d.type==="header"?{[d.name]:d.value}:d.type==="custom"?await d.getHeaders():{}}function TB(d){const h=d.fetchImpl??globalThis.fetch;return{async request({method:_,path:T,query:R,body:D,headers:B}){const r=bB(d.baseUrl,T,R),q=await wB(d.auth),H=await h(r,{method:_,headers:{...D?{"Content-Type":"application/json"}:{},...q,...B},body:D?JSON.stringify(D):void 0}),ie=await H.text(),Q=(H.headers.get("content-type")||"").includes("application/json"),me=Q&&ie?JSON.parse(ie):ie;if(!H.ok){const we=Q?me:void 0,Ae=we?.error;throw new mv(Ae?.message??`Request failed with status ${H.status}`,{status:H.status,icebergType:Ae?.type,icebergCode:Ae?.code,details:we})}return{status:H.status,headers:H.headers,data:me}}}}function Z0(d){return d.join("")}var SB=class{constructor(d,h=""){this.client=d,this.prefix=h}async listNamespaces(d){const h=d?{parent:Z0(d.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:h})).data.namespaces.map(T=>({namespace:T}))}async createNamespace(d,h){const _={namespace:d.namespace,properties:h?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:_})).data}async dropNamespace(d){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Z0(d.namespace)}`})}async loadNamespaceMetadata(d){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Z0(d.namespace)}`})).data.properties}}async namespaceExists(d){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Z0(d.namespace)}`}),!0}catch(h){if(h instanceof mv&&h.status===404)return!1;throw h}}async createNamespaceIfNotExists(d,h){try{return await this.createNamespace(d,h)}catch(_){if(_ instanceof mv&&_.status===409)return;throw _}}};function b_(d){return d.join("")}var EB=class{constructor(d,h="",_){this.client=d,this.prefix=h,this.accessDelegation=_}async listTables(d){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${b_(d.namespace)}/tables`})).data.identifiers}async createTable(d,h){const _={};return this.accessDelegation&&(_["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${b_(d.namespace)}/tables`,body:h,headers:_})).data.metadata}async updateTable(d,h){const _=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${b_(d.namespace)}/tables/${d.name}`,body:h});return{"metadata-location":_.data["metadata-location"],metadata:_.data.metadata}}async dropTable(d,h){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${b_(d.namespace)}/tables/${d.name}`,query:{purgeRequested:String(h?.purge??!1)}})}async loadTable(d){const h={};return this.accessDelegation&&(h["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${b_(d.namespace)}/tables/${d.name}`,headers:h})).data.metadata}async tableExists(d){const h={};this.accessDelegation&&(h["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${b_(d.namespace)}/tables/${d.name}`,headers:h}),!0}catch(_){if(_ instanceof mv&&_.status===404)return!1;throw _}}async createTableIfNotExists(d,h){try{return await this.createTable(d,h)}catch(_){if(_ instanceof mv&&_.status===409)return await this.loadTable({namespace:d.namespace,name:h.name});throw _}}},AB=class{constructor(d){let h="v1";d.catalogName&&(h+=`/${d.catalogName}`);const _=d.baseUrl.endsWith("/")?d.baseUrl:`${d.baseUrl}/`;this.client=TB({baseUrl:_,auth:d.auth,fetchImpl:d.fetch}),this.accessDelegation=d.accessDelegation?.join(","),this.namespaceOps=new SB(this.client,h),this.tableOps=new EB(this.client,h,this.accessDelegation)}async listNamespaces(d){return this.namespaceOps.listNamespaces(d)}async createNamespace(d,h){return this.namespaceOps.createNamespace(d,h)}async dropNamespace(d){await this.namespaceOps.dropNamespace(d)}async loadNamespaceMetadata(d){return this.namespaceOps.loadNamespaceMetadata(d)}async listTables(d){return this.tableOps.listTables(d)}async createTable(d,h){return this.tableOps.createTable(d,h)}async updateTable(d,h){return this.tableOps.updateTable(d,h)}async dropTable(d,h){await this.tableOps.dropTable(d,h)}async loadTable(d){return this.tableOps.loadTable(d)}async namespaceExists(d){return this.namespaceOps.namespaceExists(d)}async tableExists(d){return this.tableOps.tableExists(d)}async createNamespaceIfNotExists(d,h){return this.namespaceOps.createNamespaceIfNotExists(d,h)}async createTableIfNotExists(d,h){return this.tableOps.createTableIfNotExists(d,h)}},Lx=class extends Error{constructor(d){super(d),this.__isStorageError=!0,this.name="StorageError"}};function js(d){return typeof d=="object"&&d!==null&&"__isStorageError"in d}var CB=class extends Lx{constructor(d,h,_){super(d),this.name="StorageApiError",this.status=h,this.statusCode=_}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},e1=class extends Lx{constructor(d,h){super(d),this.name="StorageUnknownError",this.originalError=h}};const B1=d=>d?(...h)=>d(...h):(...h)=>fetch(...h),IB=()=>Response,t1=d=>{if(Array.isArray(d))return d.map(_=>t1(_));if(typeof d=="function"||d!==Object(d))return d;const h={};return Object.entries(d).forEach(([_,T])=>{const R=_.replace(/([-_][a-z])/gi,D=>D.toUpperCase().replace(/[-_]/g,""));h[R]=t1(T)}),h},RB=d=>{if(typeof d!="object"||d===null)return!1;const h=Object.getPrototypeOf(d);return(h===null||h===Object.prototype||Object.getPrototypeOf(h)===null)&&!(Symbol.toStringTag in d)&&!(Symbol.iterator in d)},MB=d=>!d||typeof d!="string"||d.length===0||d.length>100||d.trim()!==d||d.includes("/")||d.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(d);function gv(d){"@babel/helpers - typeof";return gv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},gv(d)}function DB(d,h){if(gv(d)!="object"||!d)return d;var _=d[Symbol.toPrimitive];if(_!==void 0){var T=_.call(d,h);if(gv(T)!="object")return T;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(d)}function OB(d){var h=DB(d,"string");return gv(h)=="symbol"?h:h+""}function PB(d,h,_){return(h=OB(h))in d?Object.defineProperty(d,h,{value:_,enumerable:!0,configurable:!0,writable:!0}):d[h]=_,d}function aA(d,h){var _=Object.keys(d);if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(d);h&&(T=T.filter(function(R){return Object.getOwnPropertyDescriptor(d,R).enumerable})),_.push.apply(_,T)}return _}function En(d){for(var h=1;h<arguments.length;h++){var _=arguments[h]!=null?arguments[h]:{};h%2?aA(Object(_),!0).forEach(function(T){PB(d,T,_[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(_)):aA(Object(_)).forEach(function(T){Object.defineProperty(d,T,Object.getOwnPropertyDescriptor(_,T))})}return d}const xw=d=>{var h;return d.msg||d.message||d.error_description||(typeof d.error=="string"?d.error:(h=d.error)===null||h===void 0?void 0:h.message)||JSON.stringify(d)},zB=async(d,h,_)=>{d instanceof await IB()&&!_?.noResolveJson?d.json().then(T=>{const R=d.status||500,D=T?.statusCode||R+"";h(new CB(xw(T),R,D))}).catch(T=>{h(new e1(xw(T),T))}):h(new e1(xw(d),d))},LB=(d,h,_,T)=>{const R={method:d,headers:h?.headers||{}};return d==="GET"||!T?R:(RB(T)?(R.headers=En({"Content-Type":"application/json"},h?.headers),R.body=JSON.stringify(T)):R.body=T,h?.duplex&&(R.duplex=h.duplex),En(En({},R),_))};async function Sv(d,h,_,T,R,D){return new Promise((B,r)=>{d(_,LB(h,T,R,D)).then(q=>{if(!q.ok)throw q;return T?.noResolveJson?q:q.json()}).then(q=>B(q)).catch(q=>zB(q,r,T))})}async function _v(d,h,_,T){return Sv(d,"GET",h,_,T)}async function Qu(d,h,_,T,R){return Sv(d,"POST",h,T,R,_)}async function i1(d,h,_,T,R){return Sv(d,"PUT",h,T,R,_)}async function kB(d,h,_,T){return Sv(d,"HEAD",h,En(En({},_),{},{noResolveJson:!0}),T)}async function F1(d,h,_,T,R){return Sv(d,"DELETE",h,T,R,_)}var BB=class{constructor(d,h){this.downloadFn=d,this.shouldThrowOnError=h}then(d,h){return this.execute().then(d,h)}async execute(){var d=this;try{return{data:(await d.downloadFn()).body,error:null}}catch(h){if(d.shouldThrowOnError)throw h;if(js(h))return{data:null,error:h};throw h}}};let hI;hI=Symbol.toStringTag;var FB=class{constructor(d,h){this.downloadFn=d,this.shouldThrowOnError=h,this[hI]="BlobDownloadBuilder",this.promise=null}asStream(){return new BB(this.downloadFn,this.shouldThrowOnError)}then(d,h){return this.getPromise().then(d,h)}catch(d){return this.getPromise().catch(d)}finally(d){return this.getPromise().finally(d)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var d=this;try{return{data:await(await d.downloadFn()).blob(),error:null}}catch(h){if(d.shouldThrowOnError)throw h;if(js(h))return{data:null,error:h};throw h}}};const NB={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},lA={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var jB=class{constructor(d,h={},_,T){this.shouldThrowOnError=!1,this.url=d,this.headers=h,this.bucketId=_,this.fetch=B1(T)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(d,h,_,T){var R=this;try{let D;const B=En(En({},lA),T);let r=En(En({},R.headers),d==="POST"&&{"x-upsert":String(B.upsert)});const q=B.metadata;typeof Blob<"u"&&_ instanceof Blob?(D=new FormData,D.append("cacheControl",B.cacheControl),q&&D.append("metadata",R.encodeMetadata(q)),D.append("",_)):typeof FormData<"u"&&_ instanceof FormData?(D=_,D.has("cacheControl")||D.append("cacheControl",B.cacheControl),q&&!D.has("metadata")&&D.append("metadata",R.encodeMetadata(q))):(D=_,r["cache-control"]=`max-age=${B.cacheControl}`,r["content-type"]=B.contentType,q&&(r["x-metadata"]=R.toBase64(R.encodeMetadata(q))),(typeof ReadableStream<"u"&&D instanceof ReadableStream||D&&typeof D=="object"&&"pipe"in D&&typeof D.pipe=="function")&&!B.duplex&&(B.duplex="half")),T?.headers&&(r=En(En({},r),T.headers));const H=R._removeEmptyFolders(h),ie=R._getFinalPath(H),Q=await(d=="PUT"?i1:Qu)(R.fetch,`${R.url}/object/${ie}`,D,En({headers:r},B?.duplex?{duplex:B.duplex}:{}));return{data:{path:H,id:Q.Id,fullPath:Q.Key},error:null}}catch(D){if(R.shouldThrowOnError)throw D;if(js(D))return{data:null,error:D};throw D}}async upload(d,h,_){return this.uploadOrUpdate("POST",d,h,_)}async uploadToSignedUrl(d,h,_,T){var R=this;const D=R._removeEmptyFolders(d),B=R._getFinalPath(D),r=new URL(R.url+`/object/upload/sign/${B}`);r.searchParams.set("token",h);try{let q;const H=En({upsert:lA.upsert},T),ie=En(En({},R.headers),{"x-upsert":String(H.upsert)});return typeof Blob<"u"&&_ instanceof Blob?(q=new FormData,q.append("cacheControl",H.cacheControl),q.append("",_)):typeof FormData<"u"&&_ instanceof FormData?(q=_,q.append("cacheControl",H.cacheControl)):(q=_,ie["cache-control"]=`max-age=${H.cacheControl}`,ie["content-type"]=H.contentType),{data:{path:D,fullPath:(await i1(R.fetch,r.toString(),q,{headers:ie})).Key},error:null}}catch(q){if(R.shouldThrowOnError)throw q;if(js(q))return{data:null,error:q};throw q}}async createSignedUploadUrl(d,h){var _=this;try{let T=_._getFinalPath(d);const R=En({},_.headers);h?.upsert&&(R["x-upsert"]="true");const D=await Qu(_.fetch,`${_.url}/object/upload/sign/${T}`,{},{headers:R}),B=new URL(_.url+D.url),r=B.searchParams.get("token");if(!r)throw new Lx("No token returned by API");return{data:{signedUrl:B.toString(),path:d,token:r},error:null}}catch(T){if(_.shouldThrowOnError)throw T;if(js(T))return{data:null,error:T};throw T}}async update(d,h,_){return this.uploadOrUpdate("PUT",d,h,_)}async move(d,h,_){var T=this;try{return{data:await Qu(T.fetch,`${T.url}/object/move`,{bucketId:T.bucketId,sourceKey:d,destinationKey:h,destinationBucket:_?.destinationBucket},{headers:T.headers}),error:null}}catch(R){if(T.shouldThrowOnError)throw R;if(js(R))return{data:null,error:R};throw R}}async copy(d,h,_){var T=this;try{return{data:{path:(await Qu(T.fetch,`${T.url}/object/copy`,{bucketId:T.bucketId,sourceKey:d,destinationKey:h,destinationBucket:_?.destinationBucket},{headers:T.headers})).Key},error:null}}catch(R){if(T.shouldThrowOnError)throw R;if(js(R))return{data:null,error:R};throw R}}async createSignedUrl(d,h,_){var T=this;try{let R=T._getFinalPath(d),D=await Qu(T.fetch,`${T.url}/object/sign/${R}`,En({expiresIn:h},_?.transform?{transform:_.transform}:{}),{headers:T.headers});const B=_?.download?`&download=${_.download===!0?"":_.download}`:"";return D={signedUrl:encodeURI(`${T.url}${D.signedURL}${B}`)},{data:D,error:null}}catch(R){if(T.shouldThrowOnError)throw R;if(js(R))return{data:null,error:R};throw R}}async createSignedUrls(d,h,_){var T=this;try{const R=await Qu(T.fetch,`${T.url}/object/sign/${T.bucketId}`,{expiresIn:h,paths:d},{headers:T.headers}),D=_?.download?`&download=${_.download===!0?"":_.download}`:"";return{data:R.map(B=>En(En({},B),{},{signedUrl:B.signedURL?encodeURI(`${T.url}${B.signedURL}${D}`):null})),error:null}}catch(R){if(T.shouldThrowOnError)throw R;if(js(R))return{data:null,error:R};throw R}}download(d,h){const _=typeof h?.transform<"u"?"render/image/authenticated":"object",T=this.transformOptsToQueryString(h?.transform||{}),R=T?`?${T}`:"",D=this._getFinalPath(d),B=()=>_v(this.fetch,`${this.url}/${_}/${D}${R}`,{headers:this.headers,noResolveJson:!0});return new FB(B,this.shouldThrowOnError)}async info(d){var h=this;const _=h._getFinalPath(d);try{return{data:t1(await _v(h.fetch,`${h.url}/object/info/${_}`,{headers:h.headers})),error:null}}catch(T){if(h.shouldThrowOnError)throw T;if(js(T))return{data:null,error:T};throw T}}async exists(d){var h=this;const _=h._getFinalPath(d);try{return await kB(h.fetch,`${h.url}/object/${_}`,{headers:h.headers}),{data:!0,error:null}}catch(T){if(h.shouldThrowOnError)throw T;if(js(T)&&T instanceof e1){const R=T.originalError;if([400,404].includes(R?.status))return{data:!1,error:T}}throw T}}getPublicUrl(d,h){const _=this._getFinalPath(d),T=[],R=h?.download?`download=${h.download===!0?"":h.download}`:"";R!==""&&T.push(R);const D=typeof h?.transform<"u"?"render/image":"object",B=this.transformOptsToQueryString(h?.transform||{});B!==""&&T.push(B);let r=T.join("&");return r!==""&&(r=`?${r}`),{data:{publicUrl:encodeURI(`${this.url}/${D}/public/${_}${r}`)}}}async remove(d){var h=this;try{return{data:await F1(h.fetch,`${h.url}/object/${h.bucketId}`,{prefixes:d},{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(js(_))return{data:null,error:_};throw _}}async list(d,h,_){var T=this;try{const R=En(En(En({},NB),h),{},{prefix:d||""});return{data:await Qu(T.fetch,`${T.url}/object/list/${T.bucketId}`,R,{headers:T.headers},_),error:null}}catch(R){if(T.shouldThrowOnError)throw R;if(js(R))return{data:null,error:R};throw R}}async listV2(d,h){var _=this;try{const T=En({},d);return{data:await Qu(_.fetch,`${_.url}/object/list-v2/${_.bucketId}`,T,{headers:_.headers},h),error:null}}catch(T){if(_.shouldThrowOnError)throw T;if(js(T))return{data:null,error:T};throw T}}encodeMetadata(d){return JSON.stringify(d)}toBase64(d){return typeof Buffer<"u"?Buffer.from(d).toString("base64"):btoa(d)}_getFinalPath(d){return`${this.bucketId}/${d.replace(/^\/+/,"")}`}_removeEmptyFolders(d){return d.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(d){const h=[];return d.width&&h.push(`width=${d.width}`),d.height&&h.push(`height=${d.height}`),d.resize&&h.push(`resize=${d.resize}`),d.format&&h.push(`format=${d.format}`),d.quality&&h.push(`quality=${d.quality}`),h.join("&")}};const dI="2.90.1",fI={"X-Client-Info":`storage-js/${dI}`};var UB=class{constructor(d,h={},_,T){this.shouldThrowOnError=!1;const R=new URL(d);T?.useNewHostname&&/supabase\.(co|in|red)$/.test(R.hostname)&&!R.hostname.includes("storage.supabase.")&&(R.hostname=R.hostname.replace("supabase.","storage.supabase.")),this.url=R.href.replace(/\/$/,""),this.headers=En(En({},fI),h),this.fetch=B1(_)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(d){var h=this;try{const _=h.listBucketOptionsToQueryString(d);return{data:await _v(h.fetch,`${h.url}/bucket${_}`,{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(js(_))return{data:null,error:_};throw _}}async getBucket(d){var h=this;try{return{data:await _v(h.fetch,`${h.url}/bucket/${d}`,{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(js(_))return{data:null,error:_};throw _}}async createBucket(d,h={public:!1}){var _=this;try{return{data:await Qu(_.fetch,`${_.url}/bucket`,{id:d,name:d,type:h.type,public:h.public,file_size_limit:h.fileSizeLimit,allowed_mime_types:h.allowedMimeTypes},{headers:_.headers}),error:null}}catch(T){if(_.shouldThrowOnError)throw T;if(js(T))return{data:null,error:T};throw T}}async updateBucket(d,h){var _=this;try{return{data:await i1(_.fetch,`${_.url}/bucket/${d}`,{id:d,name:d,public:h.public,file_size_limit:h.fileSizeLimit,allowed_mime_types:h.allowedMimeTypes},{headers:_.headers}),error:null}}catch(T){if(_.shouldThrowOnError)throw T;if(js(T))return{data:null,error:T};throw T}}async emptyBucket(d){var h=this;try{return{data:await Qu(h.fetch,`${h.url}/bucket/${d}/empty`,{},{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(js(_))return{data:null,error:_};throw _}}async deleteBucket(d){var h=this;try{return{data:await F1(h.fetch,`${h.url}/bucket/${d}`,{},{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(js(_))return{data:null,error:_};throw _}}listBucketOptionsToQueryString(d){const h={};return d&&("limit"in d&&(h.limit=String(d.limit)),"offset"in d&&(h.offset=String(d.offset)),d.search&&(h.search=d.search),d.sortColumn&&(h.sortColumn=d.sortColumn),d.sortOrder&&(h.sortOrder=d.sortOrder)),Object.keys(h).length>0?"?"+new URLSearchParams(h).toString():""}},VB=class{constructor(d,h={},_){this.shouldThrowOnError=!1,this.url=d.replace(/\/$/,""),this.headers=En(En({},fI),h),this.fetch=B1(_)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(d){var h=this;try{return{data:await Qu(h.fetch,`${h.url}/bucket`,{name:d},{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(js(_))return{data:null,error:_};throw _}}async listBuckets(d){var h=this;try{const _=new URLSearchParams;d?.limit!==void 0&&_.set("limit",d.limit.toString()),d?.offset!==void 0&&_.set("offset",d.offset.toString()),d?.sortColumn&&_.set("sortColumn",d.sortColumn),d?.sortOrder&&_.set("sortOrder",d.sortOrder),d?.search&&_.set("search",d.search);const T=_.toString(),R=T?`${h.url}/bucket?${T}`:`${h.url}/bucket`;return{data:await _v(h.fetch,R,{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(js(_))return{data:null,error:_};throw _}}async deleteBucket(d){var h=this;try{return{data:await F1(h.fetch,`${h.url}/bucket/${d}`,{},{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(js(_))return{data:null,error:_};throw _}}from(d){var h=this;if(!MB(d))throw new Lx("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const _=new AB({baseUrl:this.url,catalogName:d,auth:{type:"custom",getHeaders:async()=>h.headers},fetch:this.fetch}),T=this.shouldThrowOnError;return new Proxy(_,{get(R,D){const B=R[D];return typeof B!="function"?B:async(...r)=>{try{return{data:await B.apply(R,r),error:null}}catch(q){if(T)throw q;return{data:null,error:q}}}}})}};const N1={"X-Client-Info":`storage-js/${dI}`,"Content-Type":"application/json"};var pI=class extends Error{constructor(d){super(d),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Tc(d){return typeof d=="object"&&d!==null&&"__isStorageVectorsError"in d}var bw=class extends pI{constructor(d,h,_){super(d),this.name="StorageVectorsApiError",this.status=h,this.statusCode=_}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},GB=class extends pI{constructor(d,h){super(d),this.name="StorageVectorsUnknownError",this.originalError=h}};const j1=d=>d?(...h)=>d(...h):(...h)=>fetch(...h),qB=d=>{if(typeof d!="object"||d===null)return!1;const h=Object.getPrototypeOf(d);return(h===null||h===Object.prototype||Object.getPrototypeOf(h)===null)&&!(Symbol.toStringTag in d)&&!(Symbol.iterator in d)},cA=d=>d.msg||d.message||d.error_description||d.error||JSON.stringify(d),HB=async(d,h,_)=>{if(d&&typeof d=="object"&&"status"in d&&"ok"in d&&typeof d.status=="number"&&!_?.noResolveJson){const T=d.status||500,R=d;if(typeof R.json=="function")R.json().then(D=>{const B=D?.statusCode||D?.code||T+"";h(new bw(cA(D),T,B))}).catch(()=>{const D=T+"";h(new bw(R.statusText||`HTTP ${T} error`,T,D))});else{const D=T+"";h(new bw(R.statusText||`HTTP ${T} error`,T,D))}}else h(new GB(cA(d),d))},$B=(d,h,_,T)=>{const R={method:d,headers:h?.headers||{}};return T?(qB(T)?(R.headers=En({"Content-Type":"application/json"},h?.headers),R.body=JSON.stringify(T)):R.body=T,En(En({},R),_)):R};async function ZB(d,h,_,T,R,D){return new Promise((B,r)=>{d(_,$B(h,T,R,D)).then(q=>{if(!q.ok)throw q;if(T?.noResolveJson)return q;const H=q.headers.get("content-type");return!H||!H.includes("application/json")?{}:q.json()}).then(q=>B(q)).catch(q=>HB(q,r,T))})}async function Sc(d,h,_,T,R){return ZB(d,"POST",h,T,R,_)}var WB=class{constructor(d,h={},_){this.shouldThrowOnError=!1,this.url=d.replace(/\/$/,""),this.headers=En(En({},N1),h),this.fetch=j1(_)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(d){var h=this;try{return{data:await Sc(h.fetch,`${h.url}/CreateIndex`,d,{headers:h.headers})||{},error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(Tc(_))return{data:null,error:_};throw _}}async getIndex(d,h){var _=this;try{return{data:await Sc(_.fetch,`${_.url}/GetIndex`,{vectorBucketName:d,indexName:h},{headers:_.headers}),error:null}}catch(T){if(_.shouldThrowOnError)throw T;if(Tc(T))return{data:null,error:T};throw T}}async listIndexes(d){var h=this;try{return{data:await Sc(h.fetch,`${h.url}/ListIndexes`,d,{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(Tc(_))return{data:null,error:_};throw _}}async deleteIndex(d,h){var _=this;try{return{data:await Sc(_.fetch,`${_.url}/DeleteIndex`,{vectorBucketName:d,indexName:h},{headers:_.headers})||{},error:null}}catch(T){if(_.shouldThrowOnError)throw T;if(Tc(T))return{data:null,error:T};throw T}}},XB=class{constructor(d,h={},_){this.shouldThrowOnError=!1,this.url=d.replace(/\/$/,""),this.headers=En(En({},N1),h),this.fetch=j1(_)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(d){var h=this;try{if(d.vectors.length<1||d.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Sc(h.fetch,`${h.url}/PutVectors`,d,{headers:h.headers})||{},error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(Tc(_))return{data:null,error:_};throw _}}async getVectors(d){var h=this;try{return{data:await Sc(h.fetch,`${h.url}/GetVectors`,d,{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(Tc(_))return{data:null,error:_};throw _}}async listVectors(d){var h=this;try{if(d.segmentCount!==void 0){if(d.segmentCount<1||d.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(d.segmentIndex!==void 0&&(d.segmentIndex<0||d.segmentIndex>=d.segmentCount))throw new Error(`segmentIndex must be between 0 and ${d.segmentCount-1}`)}return{data:await Sc(h.fetch,`${h.url}/ListVectors`,d,{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(Tc(_))return{data:null,error:_};throw _}}async queryVectors(d){var h=this;try{return{data:await Sc(h.fetch,`${h.url}/QueryVectors`,d,{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(Tc(_))return{data:null,error:_};throw _}}async deleteVectors(d){var h=this;try{if(d.keys.length<1||d.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Sc(h.fetch,`${h.url}/DeleteVectors`,d,{headers:h.headers})||{},error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(Tc(_))return{data:null,error:_};throw _}}},YB=class{constructor(d,h={},_){this.shouldThrowOnError=!1,this.url=d.replace(/\/$/,""),this.headers=En(En({},N1),h),this.fetch=j1(_)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(d){var h=this;try{return{data:await Sc(h.fetch,`${h.url}/CreateVectorBucket`,{vectorBucketName:d},{headers:h.headers})||{},error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(Tc(_))return{data:null,error:_};throw _}}async getBucket(d){var h=this;try{return{data:await Sc(h.fetch,`${h.url}/GetVectorBucket`,{vectorBucketName:d},{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(Tc(_))return{data:null,error:_};throw _}}async listBuckets(d={}){var h=this;try{return{data:await Sc(h.fetch,`${h.url}/ListVectorBuckets`,d,{headers:h.headers}),error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(Tc(_))return{data:null,error:_};throw _}}async deleteBucket(d){var h=this;try{return{data:await Sc(h.fetch,`${h.url}/DeleteVectorBucket`,{vectorBucketName:d},{headers:h.headers})||{},error:null}}catch(_){if(h.shouldThrowOnError)throw _;if(Tc(_))return{data:null,error:_};throw _}}},KB=class extends YB{constructor(d,h={}){super(d,h.headers||{},h.fetch)}from(d){return new JB(this.url,this.headers,d,this.fetch)}async createBucket(d){var h=()=>super.createBucket,_=this;return h().call(_,d)}async getBucket(d){var h=()=>super.getBucket,_=this;return h().call(_,d)}async listBuckets(d={}){var h=()=>super.listBuckets,_=this;return h().call(_,d)}async deleteBucket(d){var h=()=>super.deleteBucket,_=this;return h().call(_,d)}},JB=class extends WB{constructor(d,h,_,T){super(d,h,T),this.vectorBucketName=_}async createIndex(d){var h=()=>super.createIndex,_=this;return h().call(_,En(En({},d),{},{vectorBucketName:_.vectorBucketName}))}async listIndexes(d={}){var h=()=>super.listIndexes,_=this;return h().call(_,En(En({},d),{},{vectorBucketName:_.vectorBucketName}))}async getIndex(d){var h=()=>super.getIndex,_=this;return h().call(_,_.vectorBucketName,d)}async deleteIndex(d){var h=()=>super.deleteIndex,_=this;return h().call(_,_.vectorBucketName,d)}index(d){return new QB(this.url,this.headers,this.vectorBucketName,d,this.fetch)}},QB=class extends XB{constructor(d,h,_,T,R){super(d,h,R),this.vectorBucketName=_,this.indexName=T}async putVectors(d){var h=()=>super.putVectors,_=this;return h().call(_,En(En({},d),{},{vectorBucketName:_.vectorBucketName,indexName:_.indexName}))}async getVectors(d){var h=()=>super.getVectors,_=this;return h().call(_,En(En({},d),{},{vectorBucketName:_.vectorBucketName,indexName:_.indexName}))}async listVectors(d={}){var h=()=>super.listVectors,_=this;return h().call(_,En(En({},d),{},{vectorBucketName:_.vectorBucketName,indexName:_.indexName}))}async queryVectors(d){var h=()=>super.queryVectors,_=this;return h().call(_,En(En({},d),{},{vectorBucketName:_.vectorBucketName,indexName:_.indexName}))}async deleteVectors(d){var h=()=>super.deleteVectors,_=this;return h().call(_,En(En({},d),{},{vectorBucketName:_.vectorBucketName,indexName:_.indexName}))}},eF=class extends UB{constructor(d,h={},_,T){super(d,h,_,T)}from(d){return new jB(this.url,this.headers,d,this.fetch)}get vectors(){return new KB(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new VB(this.url+"/iceberg",this.headers,this.fetch)}};const mI="2.90.1",D_=30*1e3,n1=3,ww=n1*D_,tF="http://localhost:9999",iF="supabase.auth.token",nF={"X-Client-Info":`gotrue-js/${mI}`},r1="X-Supabase-Api-Version",gI={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},rF=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,sF=600*1e3;class yv extends Error{constructor(h,_,T){super(h),this.__isAuthError=!0,this.name="AuthError",this.status=_,this.code=T}}function cn(d){return typeof d=="object"&&d!==null&&"__isAuthError"in d}class oF extends yv{constructor(h,_,T){super(h,_,T),this.name="AuthApiError",this.status=_,this.code=T}}function aF(d){return cn(d)&&d.name==="AuthApiError"}class ag extends yv{constructor(h,_){super(h),this.name="AuthUnknownError",this.originalError=_}}class vf extends yv{constructor(h,_,T,R){super(h,T,R),this.name=_,this.status=T}}class bc extends vf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function lF(d){return cn(d)&&d.name==="AuthSessionMissingError"}class w_ extends vf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class W0 extends vf{constructor(h){super(h,"AuthInvalidCredentialsError",400,void 0)}}class X0 extends vf{constructor(h,_=null){super(h,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=_}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function cF(d){return cn(d)&&d.name==="AuthImplicitGrantRedirectError"}class uA extends vf{constructor(h,_=null){super(h,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=_}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class uF extends vf{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class s1 extends vf{constructor(h,_){super(h,"AuthRetryableFetchError",_,void 0)}}function Tw(d){return cn(d)&&d.name==="AuthRetryableFetchError"}class hA extends vf{constructor(h,_,T){super(h,"AuthWeakPasswordError",_,"weak_password"),this.reasons=T}}class o1 extends vf{constructor(h){super(h,"AuthInvalidJwtError",400,"invalid_jwt")}}const gx="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),dA=` 	
\r=`.split(""),hF=(()=>{const d=new Array(128);for(let h=0;h<d.length;h+=1)d[h]=-1;for(let h=0;h<dA.length;h+=1)d[dA[h].charCodeAt(0)]=-2;for(let h=0;h<gx.length;h+=1)d[gx[h].charCodeAt(0)]=h;return d})();function fA(d,h,_){if(d!==null)for(h.queue=h.queue<<8|d,h.queuedBits+=8;h.queuedBits>=6;){const T=h.queue>>h.queuedBits-6&63;_(gx[T]),h.queuedBits-=6}else if(h.queuedBits>0)for(h.queue=h.queue<<6-h.queuedBits,h.queuedBits=6;h.queuedBits>=6;){const T=h.queue>>h.queuedBits-6&63;_(gx[T]),h.queuedBits-=6}}function _I(d,h,_){const T=hF[d];if(T>-1)for(h.queue=h.queue<<6|T,h.queuedBits+=6;h.queuedBits>=8;)_(h.queue>>h.queuedBits-8&255),h.queuedBits-=8;else{if(T===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(d)}"`)}}function pA(d){const h=[],_=B=>{h.push(String.fromCodePoint(B))},T={utf8seq:0,codepoint:0},R={queue:0,queuedBits:0},D=B=>{pF(B,T,_)};for(let B=0;B<d.length;B+=1)_I(d.charCodeAt(B),R,D);return h.join("")}function dF(d,h){if(d<=127){h(d);return}else if(d<=2047){h(192|d>>6),h(128|d&63);return}else if(d<=65535){h(224|d>>12),h(128|d>>6&63),h(128|d&63);return}else if(d<=1114111){h(240|d>>18),h(128|d>>12&63),h(128|d>>6&63),h(128|d&63);return}throw new Error(`Unrecognized Unicode codepoint: ${d.toString(16)}`)}function fF(d,h){for(let _=0;_<d.length;_+=1){let T=d.charCodeAt(_);if(T>55295&&T<=56319){const R=(T-55296)*1024&65535;T=(d.charCodeAt(_+1)-56320&65535|R)+65536,_+=1}dF(T,h)}}function pF(d,h,_){if(h.utf8seq===0){if(d<=127){_(d);return}for(let T=1;T<6;T+=1)if((d>>7-T&1)===0){h.utf8seq=T;break}if(h.utf8seq===2)h.codepoint=d&31;else if(h.utf8seq===3)h.codepoint=d&15;else if(h.utf8seq===4)h.codepoint=d&7;else throw new Error("Invalid UTF-8 sequence");h.utf8seq-=1}else if(h.utf8seq>0){if(d<=127)throw new Error("Invalid UTF-8 sequence");h.codepoint=h.codepoint<<6|d&63,h.utf8seq-=1,h.utf8seq===0&&_(h.codepoint)}}function k_(d){const h=[],_={queue:0,queuedBits:0},T=R=>{h.push(R)};for(let R=0;R<d.length;R+=1)_I(d.charCodeAt(R),_,T);return new Uint8Array(h)}function mF(d){const h=[];return fF(d,_=>h.push(_)),new Uint8Array(h)}function lg(d){const h=[],_={queue:0,queuedBits:0},T=R=>{h.push(R)};return d.forEach(R=>fA(R,_,T)),fA(null,_,T),h.join("")}function gF(d){return Math.round(Date.now()/1e3)+d}function _F(){return Symbol("auth-callback")}const Ea=()=>typeof window<"u"&&typeof document<"u",ng={tested:!1,writable:!1},yI=()=>{if(!Ea())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ng.tested)return ng.writable;const d=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(d,d),globalThis.localStorage.removeItem(d),ng.tested=!0,ng.writable=!0}catch{ng.tested=!0,ng.writable=!1}return ng.writable};function yF(d){const h={},_=new URL(d);if(_.hash&&_.hash[0]==="#")try{new URLSearchParams(_.hash.substring(1)).forEach((R,D)=>{h[D]=R})}catch{}return _.searchParams.forEach((T,R)=>{h[R]=T}),h}const vI=d=>d?(...h)=>d(...h):(...h)=>fetch(...h),vF=d=>typeof d=="object"&&d!==null&&"status"in d&&"ok"in d&&"json"in d&&typeof d.json=="function",O_=async(d,h,_)=>{await d.setItem(h,JSON.stringify(_))},rg=async(d,h)=>{const _=await d.getItem(h);if(!_)return null;try{return JSON.parse(_)}catch{return _}},Sa=async(d,h)=>{await d.removeItem(h)};class kx{constructor(){this.promise=new kx.promiseConstructor((h,_)=>{this.resolve=h,this.reject=_})}}kx.promiseConstructor=Promise;function Sw(d){const h=d.split(".");if(h.length!==3)throw new o1("Invalid JWT structure");for(let T=0;T<h.length;T++)if(!rF.test(h[T]))throw new o1("JWT not in base64url format");return{header:JSON.parse(pA(h[0])),payload:JSON.parse(pA(h[1])),signature:k_(h[2]),raw:{header:h[0],payload:h[1]}}}async function xF(d){return await new Promise(h=>{setTimeout(()=>h(null),d)})}function bF(d,h){return new Promise((T,R)=>{(async()=>{for(let D=0;D<1/0;D++)try{const B=await d(D);if(!h(D,null,B)){T(B);return}}catch(B){if(!h(D,B)){R(B);return}}})()})}function wF(d){return("0"+d.toString(16)).substr(-2)}function TF(){const h=new Uint32Array(56);if(typeof crypto>"u"){const _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",T=_.length;let R="";for(let D=0;D<56;D++)R+=_.charAt(Math.floor(Math.random()*T));return R}return crypto.getRandomValues(h),Array.from(h,wF).join("")}async function SF(d){const _=new TextEncoder().encode(d),T=await crypto.subtle.digest("SHA-256",_),R=new Uint8Array(T);return Array.from(R).map(D=>String.fromCharCode(D)).join("")}async function EF(d){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),d;const _=await SF(d);return btoa(_).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function T_(d,h,_=!1){const T=TF();let R=T;_&&(R+="/PASSWORD_RECOVERY"),await O_(d,`${h}-code-verifier`,R);const D=await EF(T);return[D,T===D?"plain":"s256"]}const AF=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function CF(d){const h=d.headers.get(r1);if(!h||!h.match(AF))return null;try{return new Date(`${h}T00:00:00.0Z`)}catch{return null}}function IF(d){if(!d)throw new Error("Missing exp claim");const h=Math.floor(Date.now()/1e3);if(d<=h)throw new Error("JWT has expired")}function RF(d){switch(d){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const MF=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function S_(d){if(!MF.test(d))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ew(){const d={};return new Proxy(d,{get:(h,_)=>{if(_==="__isUserNotAvailableProxy")return!0;if(typeof _=="symbol"){const T=_.toString();if(T==="Symbol(Symbol.toPrimitive)"||T==="Symbol(Symbol.toStringTag)"||T==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${_}" property of the session object is not supported. Please use getUser() instead.`)},set:(h,_)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${_}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(h,_)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${_}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function DF(d,h){return new Proxy(d,{get:(_,T,R)=>{if(T==="__isInsecureUserWarningProxy")return!0;if(typeof T=="symbol"){const D=T.toString();if(D==="Symbol(Symbol.toPrimitive)"||D==="Symbol(Symbol.toStringTag)"||D==="Symbol(util.inspect.custom)"||D==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(_,T,R)}return!h.value&&typeof T=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),h.value=!0),Reflect.get(_,T,R)}})}function mA(d){return JSON.parse(JSON.stringify(d))}const sg=d=>d.msg||d.message||d.error_description||d.error||JSON.stringify(d),OF=[502,503,504];async function gA(d){var h;if(!vF(d))throw new s1(sg(d),0);if(OF.includes(d.status))throw new s1(sg(d),d.status);let _;try{_=await d.json()}catch(D){throw new ag(sg(D),D)}let T;const R=CF(d);if(R&&R.getTime()>=gI["2024-01-01"].timestamp&&typeof _=="object"&&_&&typeof _.code=="string"?T=_.code:typeof _=="object"&&_&&typeof _.error_code=="string"&&(T=_.error_code),T){if(T==="weak_password")throw new hA(sg(_),d.status,((h=_.weak_password)===null||h===void 0?void 0:h.reasons)||[]);if(T==="session_not_found")throw new bc}else if(typeof _=="object"&&_&&typeof _.weak_password=="object"&&_.weak_password&&Array.isArray(_.weak_password.reasons)&&_.weak_password.reasons.length&&_.weak_password.reasons.reduce((D,B)=>D&&typeof B=="string",!0))throw new hA(sg(_),d.status,_.weak_password.reasons);throw new oF(sg(_),d.status||500,T)}const PF=(d,h,_,T)=>{const R={method:d,headers:h?.headers||{}};return d==="GET"?R:(R.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},h?.headers),R.body=JSON.stringify(T),Object.assign(Object.assign({},R),_))};async function Sn(d,h,_,T){var R;const D=Object.assign({},T?.headers);D[r1]||(D[r1]=gI["2024-01-01"].name),T?.jwt&&(D.Authorization=`Bearer ${T.jwt}`);const B=(R=T?.query)!==null&&R!==void 0?R:{};T?.redirectTo&&(B.redirect_to=T.redirectTo);const r=Object.keys(B).length?"?"+new URLSearchParams(B).toString():"",q=await zF(d,h,_+r,{headers:D,noResolveJson:T?.noResolveJson},{},T?.body);return T?.xform?T?.xform(q):{data:Object.assign({},q),error:null}}async function zF(d,h,_,T,R,D){const B=PF(h,T,R,D);let r;try{r=await d(_,Object.assign({},B))}catch(q){throw console.error(q),new s1(sg(q),0)}if(r.ok||await gA(r),T?.noResolveJson)return r;try{return await r.json()}catch(q){await gA(q)}}function Yu(d){var h;let _=null;BF(d)&&(_=Object.assign({},d),d.expires_at||(_.expires_at=gF(d.expires_in)));const T=(h=d.user)!==null&&h!==void 0?h:d;return{data:{session:_,user:T},error:null}}function _A(d){const h=Yu(d);return!h.error&&d.weak_password&&typeof d.weak_password=="object"&&Array.isArray(d.weak_password.reasons)&&d.weak_password.reasons.length&&d.weak_password.message&&typeof d.weak_password.message=="string"&&d.weak_password.reasons.reduce((_,T)=>_&&typeof T=="string",!0)&&(h.data.weak_password=d.weak_password),h}function Op(d){var h;return{data:{user:(h=d.user)!==null&&h!==void 0?h:d},error:null}}function LF(d){return{data:d,error:null}}function kF(d){const{action_link:h,email_otp:_,hashed_token:T,redirect_to:R,verification_type:D}=d,B=W_(d,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),r={action_link:h,email_otp:_,hashed_token:T,redirect_to:R,verification_type:D},q=Object.assign({},B);return{data:{properties:r,user:q},error:null}}function yA(d){return d}function BF(d){return d.access_token&&d.refresh_token&&d.expires_in}const Aw=["global","local","others"];class FF{constructor({url:h="",headers:_={},fetch:T}){this.url=h,this.headers=_,this.fetch=vI(T),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(h,_=Aw[0]){if(Aw.indexOf(_)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Aw.join(", ")}`);try{return await Sn(this.fetch,"POST",`${this.url}/logout?scope=${_}`,{headers:this.headers,jwt:h,noResolveJson:!0}),{data:null,error:null}}catch(T){if(cn(T))return{data:null,error:T};throw T}}async inviteUserByEmail(h,_={}){try{return await Sn(this.fetch,"POST",`${this.url}/invite`,{body:{email:h,data:_.data},headers:this.headers,redirectTo:_.redirectTo,xform:Op})}catch(T){if(cn(T))return{data:{user:null},error:T};throw T}}async generateLink(h){try{const{options:_}=h,T=W_(h,["options"]),R=Object.assign(Object.assign({},T),_);return"newEmail"in T&&(R.new_email=T?.newEmail,delete R.newEmail),await Sn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:R,headers:this.headers,xform:kF,redirectTo:_?.redirectTo})}catch(_){if(cn(_))return{data:{properties:null,user:null},error:_};throw _}}async createUser(h){try{return await Sn(this.fetch,"POST",`${this.url}/admin/users`,{body:h,headers:this.headers,xform:Op})}catch(_){if(cn(_))return{data:{user:null},error:_};throw _}}async listUsers(h){var _,T,R,D,B,r,q;try{const H={nextPage:null,lastPage:0,total:0},ie=await Sn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(T=(_=h?.page)===null||_===void 0?void 0:_.toString())!==null&&T!==void 0?T:"",per_page:(D=(R=h?.perPage)===null||R===void 0?void 0:R.toString())!==null&&D!==void 0?D:""},xform:yA});if(ie.error)throw ie.error;const Q=await ie.json(),me=(B=ie.headers.get("x-total-count"))!==null&&B!==void 0?B:0,we=(q=(r=ie.headers.get("link"))===null||r===void 0?void 0:r.split(","))!==null&&q!==void 0?q:[];return we.length>0&&(we.forEach(Ae=>{const he=parseInt(Ae.split(";")[0].split("=")[1].substring(0,1)),Re=JSON.parse(Ae.split(";")[1].split("=")[1]);H[`${Re}Page`]=he}),H.total=parseInt(me)),{data:Object.assign(Object.assign({},Q),H),error:null}}catch(H){if(cn(H))return{data:{users:[]},error:H};throw H}}async getUserById(h){S_(h);try{return await Sn(this.fetch,"GET",`${this.url}/admin/users/${h}`,{headers:this.headers,xform:Op})}catch(_){if(cn(_))return{data:{user:null},error:_};throw _}}async updateUserById(h,_){S_(h);try{return await Sn(this.fetch,"PUT",`${this.url}/admin/users/${h}`,{body:_,headers:this.headers,xform:Op})}catch(T){if(cn(T))return{data:{user:null},error:T};throw T}}async deleteUser(h,_=!1){S_(h);try{return await Sn(this.fetch,"DELETE",`${this.url}/admin/users/${h}`,{headers:this.headers,body:{should_soft_delete:_},xform:Op})}catch(T){if(cn(T))return{data:{user:null},error:T};throw T}}async _listFactors(h){S_(h.userId);try{const{data:_,error:T}=await Sn(this.fetch,"GET",`${this.url}/admin/users/${h.userId}/factors`,{headers:this.headers,xform:R=>({data:{factors:R},error:null})});return{data:_,error:T}}catch(_){if(cn(_))return{data:null,error:_};throw _}}async _deleteFactor(h){S_(h.userId),S_(h.id);try{return{data:await Sn(this.fetch,"DELETE",`${this.url}/admin/users/${h.userId}/factors/${h.id}`,{headers:this.headers}),error:null}}catch(_){if(cn(_))return{data:null,error:_};throw _}}async _listOAuthClients(h){var _,T,R,D,B,r,q;try{const H={nextPage:null,lastPage:0,total:0},ie=await Sn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(T=(_=h?.page)===null||_===void 0?void 0:_.toString())!==null&&T!==void 0?T:"",per_page:(D=(R=h?.perPage)===null||R===void 0?void 0:R.toString())!==null&&D!==void 0?D:""},xform:yA});if(ie.error)throw ie.error;const Q=await ie.json(),me=(B=ie.headers.get("x-total-count"))!==null&&B!==void 0?B:0,we=(q=(r=ie.headers.get("link"))===null||r===void 0?void 0:r.split(","))!==null&&q!==void 0?q:[];return we.length>0&&(we.forEach(Ae=>{const he=parseInt(Ae.split(";")[0].split("=")[1].substring(0,1)),Re=JSON.parse(Ae.split(";")[1].split("=")[1]);H[`${Re}Page`]=he}),H.total=parseInt(me)),{data:Object.assign(Object.assign({},Q),H),error:null}}catch(H){if(cn(H))return{data:{clients:[]},error:H};throw H}}async _createOAuthClient(h){try{return await Sn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:h,headers:this.headers,xform:_=>({data:_,error:null})})}catch(_){if(cn(_))return{data:null,error:_};throw _}}async _getOAuthClient(h){try{return await Sn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${h}`,{headers:this.headers,xform:_=>({data:_,error:null})})}catch(_){if(cn(_))return{data:null,error:_};throw _}}async _updateOAuthClient(h,_){try{return await Sn(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${h}`,{body:_,headers:this.headers,xform:T=>({data:T,error:null})})}catch(T){if(cn(T))return{data:null,error:T};throw T}}async _deleteOAuthClient(h){try{return await Sn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${h}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(_){if(cn(_))return{data:null,error:_};throw _}}async _regenerateOAuthClientSecret(h){try{return await Sn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${h}/regenerate_secret`,{headers:this.headers,xform:_=>({data:_,error:null})})}catch(_){if(cn(_))return{data:null,error:_};throw _}}}function vA(d={}){return{getItem:h=>d[h]||null,setItem:(h,_)=>{d[h]=_},removeItem:h=>{delete d[h]}}}const E_={debug:!!(globalThis&&yI()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class xI extends Error{constructor(h){super(h),this.isAcquireTimeout=!0}}class NF extends xI{}async function jF(d,h,_){E_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",d,h);const T=new globalThis.AbortController;return h>0&&setTimeout(()=>{T.abort(),E_.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",d)},h),await Promise.resolve().then(()=>globalThis.navigator.locks.request(d,h===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:T.signal},async R=>{if(R){E_.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",d,R.name);try{return await _()}finally{E_.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",d,R.name)}}else{if(h===0)throw E_.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",d),new NF(`Acquiring an exclusive Navigator LockManager lock "${d}" immediately failed`);if(E_.debug)try{const D=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(D,null,"  "))}catch(D){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",D)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await _()}}))}function UF(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function bI(d){if(!/^0x[a-fA-F0-9]{40}$/.test(d))throw new Error(`@supabase/auth-js: Address "${d}" is invalid.`);return d.toLowerCase()}function VF(d){return parseInt(d,16)}function GF(d){const h=new TextEncoder().encode(d);return"0x"+Array.from(h,T=>T.toString(16).padStart(2,"0")).join("")}function qF(d){var h;const{chainId:_,domain:T,expirationTime:R,issuedAt:D=new Date,nonce:B,notBefore:r,requestId:q,resources:H,scheme:ie,uri:Q,version:me}=d;{if(!Number.isInteger(_))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${_}`);if(!T)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(B&&B.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${B}`);if(!Q)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(me!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${me}`);if(!((h=d.statement)===null||h===void 0)&&h.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${d.statement}`)}const we=bI(d.address),Ae=ie?`${ie}://${T}`:T,he=d.statement?`${d.statement}
`:"",Re=`${Ae} wants you to sign in with your Ethereum account:
${we}

${he}`;let Ne=`URI: ${Q}
Version: ${me}
Chain ID: ${_}${B?`
Nonce: ${B}`:""}
Issued At: ${D.toISOString()}`;if(R&&(Ne+=`
Expiration Time: ${R.toISOString()}`),r&&(Ne+=`
Not Before: ${r.toISOString()}`),q&&(Ne+=`
Request ID: ${q}`),H){let Ge=`
Resources:`;for(const Ue of H){if(!Ue||typeof Ue!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${Ue}`);Ge+=`
- ${Ue}`}Ne+=Ge}return`${Re}
${Ne}`}class Ao extends Error{constructor({message:h,code:_,cause:T,name:R}){var D;super(h,{cause:T}),this.__isWebAuthnError=!0,this.name=(D=R??(T instanceof Error?T.name:void 0))!==null&&D!==void 0?D:"Unknown Error",this.code=_}}class _x extends Ao{constructor(h,_){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:_,message:h}),this.name="WebAuthnUnknownError",this.originalError=_}}function HF({error:d,options:h}){var _,T,R;const{publicKey:D}=h;if(!D)throw Error("options was missing required publicKey property");if(d.name==="AbortError"){if(h.signal instanceof AbortSignal)return new Ao({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:d})}else if(d.name==="ConstraintError"){if(((_=D.authenticatorSelection)===null||_===void 0?void 0:_.requireResidentKey)===!0)return new Ao({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:d});if(h.mediation==="conditional"&&((T=D.authenticatorSelection)===null||T===void 0?void 0:T.userVerification)==="required")return new Ao({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:d});if(((R=D.authenticatorSelection)===null||R===void 0?void 0:R.userVerification)==="required")return new Ao({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:d})}else{if(d.name==="InvalidStateError")return new Ao({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:d});if(d.name==="NotAllowedError")return new Ao({message:d.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:d});if(d.name==="NotSupportedError")return D.pubKeyCredParams.filter(r=>r.type==="public-key").length===0?new Ao({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:d}):new Ao({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:d});if(d.name==="SecurityError"){const B=window.location.hostname;if(wI(B)){if(D.rp.id!==B)return new Ao({message:`The RP ID "${D.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:d})}else return new Ao({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:d})}else if(d.name==="TypeError"){if(D.user.id.byteLength<1||D.user.id.byteLength>64)return new Ao({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:d})}else if(d.name==="UnknownError")return new Ao({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:d})}return new Ao({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:d})}function $F({error:d,options:h}){const{publicKey:_}=h;if(!_)throw Error("options was missing required publicKey property");if(d.name==="AbortError"){if(h.signal instanceof AbortSignal)return new Ao({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:d})}else{if(d.name==="NotAllowedError")return new Ao({message:d.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:d});if(d.name==="SecurityError"){const T=window.location.hostname;if(wI(T)){if(_.rpId!==T)return new Ao({message:`The RP ID "${_.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:d})}else return new Ao({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:d})}else if(d.name==="UnknownError")return new Ao({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:d})}return new Ao({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:d})}class ZF{createNewAbortSignal(){if(this.controller){const _=new Error("Cancelling existing WebAuthn API call for new one");_.name="AbortError",this.controller.abort(_)}const h=new AbortController;return this.controller=h,h.signal}cancelCeremony(){if(this.controller){const h=new Error("Manually cancelling existing WebAuthn API call");h.name="AbortError",this.controller.abort(h),this.controller=void 0}}}const WF=new ZF;function XF(d){if(!d)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(d);const{challenge:h,user:_,excludeCredentials:T}=d,R=W_(d,["challenge","user","excludeCredentials"]),D=k_(h).buffer,B=Object.assign(Object.assign({},_),{id:k_(_.id).buffer}),r=Object.assign(Object.assign({},R),{challenge:D,user:B});if(T&&T.length>0){r.excludeCredentials=new Array(T.length);for(let q=0;q<T.length;q++){const H=T[q];r.excludeCredentials[q]=Object.assign(Object.assign({},H),{id:k_(H.id).buffer,type:H.type||"public-key",transports:H.transports})}}return r}function YF(d){if(!d)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(d);const{challenge:h,allowCredentials:_}=d,T=W_(d,["challenge","allowCredentials"]),R=k_(h).buffer,D=Object.assign(Object.assign({},T),{challenge:R});if(_&&_.length>0){D.allowCredentials=new Array(_.length);for(let B=0;B<_.length;B++){const r=_[B];D.allowCredentials[B]=Object.assign(Object.assign({},r),{id:k_(r.id).buffer,type:r.type||"public-key",transports:r.transports})}}return D}function KF(d){var h;if("toJSON"in d&&typeof d.toJSON=="function")return d.toJSON();const _=d;return{id:d.id,rawId:d.id,response:{attestationObject:lg(new Uint8Array(d.response.attestationObject)),clientDataJSON:lg(new Uint8Array(d.response.clientDataJSON))},type:"public-key",clientExtensionResults:d.getClientExtensionResults(),authenticatorAttachment:(h=_.authenticatorAttachment)!==null&&h!==void 0?h:void 0}}function JF(d){var h;if("toJSON"in d&&typeof d.toJSON=="function")return d.toJSON();const _=d,T=d.getClientExtensionResults(),R=d.response;return{id:d.id,rawId:d.id,response:{authenticatorData:lg(new Uint8Array(R.authenticatorData)),clientDataJSON:lg(new Uint8Array(R.clientDataJSON)),signature:lg(new Uint8Array(R.signature)),userHandle:R.userHandle?lg(new Uint8Array(R.userHandle)):void 0},type:"public-key",clientExtensionResults:T,authenticatorAttachment:(h=_.authenticatorAttachment)!==null&&h!==void 0?h:void 0}}function wI(d){return d==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(d)}function xA(){var d,h;return!!(Ea()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((d=navigator?.credentials)===null||d===void 0?void 0:d.create)=="function"&&typeof((h=navigator?.credentials)===null||h===void 0?void 0:h.get)=="function")}async function QF(d){try{const h=await navigator.credentials.create(d);return h?h instanceof PublicKeyCredential?{data:h,error:null}:{data:null,error:new _x("Browser returned unexpected credential type",h)}:{data:null,error:new _x("Empty credential response",h)}}catch(h){return{data:null,error:HF({error:h,options:d})}}}async function eN(d){try{const h=await navigator.credentials.get(d);return h?h instanceof PublicKeyCredential?{data:h,error:null}:{data:null,error:new _x("Browser returned unexpected credential type",h)}:{data:null,error:new _x("Empty credential response",h)}}catch(h){return{data:null,error:$F({error:h,options:d})}}}const tN={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},iN={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function yx(...d){const h=R=>R!==null&&typeof R=="object"&&!Array.isArray(R),_=R=>R instanceof ArrayBuffer||ArrayBuffer.isView(R),T={};for(const R of d)if(R)for(const D in R){const B=R[D];if(B!==void 0)if(Array.isArray(B))T[D]=B;else if(_(B))T[D]=B;else if(h(B)){const r=T[D];h(r)?T[D]=yx(r,B):T[D]=yx(B)}else T[D]=B}return T}function nN(d,h){return yx(tN,d,h||{})}function rN(d,h){return yx(iN,d,h||{})}class sN{constructor(h){this.client=h,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(h){return this.client.mfa.enroll(Object.assign(Object.assign({},h),{factorType:"webauthn"}))}async _challenge({factorId:h,webauthn:_,friendlyName:T,signal:R},D){try{const{data:B,error:r}=await this.client.mfa.challenge({factorId:h,webauthn:_});if(!B)return{data:null,error:r};const q=R??WF.createNewAbortSignal();if(B.webauthn.type==="create"){const{user:H}=B.webauthn.credential_options.publicKey;H.name||(H.name=`${H.id}:${T}`),H.displayName||(H.displayName=H.name)}switch(B.webauthn.type){case"create":{const H=nN(B.webauthn.credential_options.publicKey,D?.create),{data:ie,error:Q}=await QF({publicKey:H,signal:q});return ie?{data:{factorId:h,challengeId:B.id,webauthn:{type:B.webauthn.type,credential_response:ie}},error:null}:{data:null,error:Q}}case"request":{const H=rN(B.webauthn.credential_options.publicKey,D?.request),{data:ie,error:Q}=await eN(Object.assign(Object.assign({},B.webauthn.credential_options),{publicKey:H,signal:q}));return ie?{data:{factorId:h,challengeId:B.id,webauthn:{type:B.webauthn.type,credential_response:ie}},error:null}:{data:null,error:Q}}}}catch(B){return cn(B)?{data:null,error:B}:{data:null,error:new ag("Unexpected error in challenge",B)}}}async _verify({challengeId:h,factorId:_,webauthn:T}){return this.client.mfa.verify({factorId:_,challengeId:h,webauthn:T})}async _authenticate({factorId:h,webauthn:{rpId:_=typeof window<"u"?window.location.hostname:void 0,rpOrigins:T=typeof window<"u"?[window.location.origin]:void 0,signal:R}={}},D){if(!_)return{data:null,error:new yv("rpId is required for WebAuthn authentication")};try{if(!xA())return{data:null,error:new ag("Browser does not support WebAuthn",null)};const{data:B,error:r}=await this.challenge({factorId:h,webauthn:{rpId:_,rpOrigins:T},signal:R},{request:D});if(!B)return{data:null,error:r};const{webauthn:q}=B;return this._verify({factorId:h,challengeId:B.challengeId,webauthn:{type:q.type,rpId:_,rpOrigins:T,credential_response:q.credential_response}})}catch(B){return cn(B)?{data:null,error:B}:{data:null,error:new ag("Unexpected error in authenticate",B)}}}async _register({friendlyName:h,webauthn:{rpId:_=typeof window<"u"?window.location.hostname:void 0,rpOrigins:T=typeof window<"u"?[window.location.origin]:void 0,signal:R}={}},D){if(!_)return{data:null,error:new yv("rpId is required for WebAuthn registration")};try{if(!xA())return{data:null,error:new ag("Browser does not support WebAuthn",null)};const{data:B,error:r}=await this._enroll({friendlyName:h});if(!B)return await this.client.mfa.listFactors().then(ie=>{var Q;return(Q=ie.data)===null||Q===void 0?void 0:Q.all.find(me=>me.factor_type==="webauthn"&&me.friendly_name===h&&me.status!=="unverified")}).then(ie=>ie?this.client.mfa.unenroll({factorId:ie?.id}):void 0),{data:null,error:r};const{data:q,error:H}=await this._challenge({factorId:B.id,friendlyName:B.friendly_name,webauthn:{rpId:_,rpOrigins:T},signal:R},{create:D});return q?this._verify({factorId:B.id,challengeId:q.challengeId,webauthn:{rpId:_,rpOrigins:T,type:q.webauthn.type,credential_response:q.webauthn.credential_response}}):{data:null,error:H}}catch(B){return cn(B)?{data:null,error:B}:{data:null,error:new ag("Unexpected error in register",B)}}}}UF();const oN={url:tF,storageKey:iF,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:nF,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function bA(d,h,_){return await _()}const A_={};class vv{get jwks(){var h,_;return(_=(h=A_[this.storageKey])===null||h===void 0?void 0:h.jwks)!==null&&_!==void 0?_:{keys:[]}}set jwks(h){A_[this.storageKey]=Object.assign(Object.assign({},A_[this.storageKey]),{jwks:h})}get jwks_cached_at(){var h,_;return(_=(h=A_[this.storageKey])===null||h===void 0?void 0:h.cachedAt)!==null&&_!==void 0?_:Number.MIN_SAFE_INTEGER}set jwks_cached_at(h){A_[this.storageKey]=Object.assign(Object.assign({},A_[this.storageKey]),{cachedAt:h})}constructor(h){var _,T,R;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const D=Object.assign(Object.assign({},oN),h);if(this.storageKey=D.storageKey,this.instanceID=(_=vv.nextInstanceID[this.storageKey])!==null&&_!==void 0?_:0,vv.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!D.debug,typeof D.debug=="function"&&(this.logger=D.debug),this.instanceID>0&&Ea()){const B=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(B),this.logDebugMessages&&console.trace(B)}if(this.persistSession=D.persistSession,this.autoRefreshToken=D.autoRefreshToken,this.admin=new FF({url:D.url,headers:D.headers,fetch:D.fetch}),this.url=D.url,this.headers=D.headers,this.fetch=vI(D.fetch),this.lock=D.lock||bA,this.detectSessionInUrl=D.detectSessionInUrl,this.flowType=D.flowType,this.hasCustomAuthorizationHeader=D.hasCustomAuthorizationHeader,this.throwOnError=D.throwOnError,this.lockAcquireTimeout=D.lockAcquireTimeout,D.lock?this.lock=D.lock:this.persistSession&&Ea()&&(!((T=globalThis?.navigator)===null||T===void 0)&&T.locks)?this.lock=jF:this.lock=bA,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new sN(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(D.storage?this.storage=D.storage:yI()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=vA(this.memoryStorage)),D.userStorage&&(this.userStorage=D.userStorage)):(this.memoryStorage={},this.storage=vA(this.memoryStorage)),Ea()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(B){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",B)}(R=this.broadcastChannel)===null||R===void 0||R.addEventListener("message",async B=>{this._debug("received broadcast notification from other tab or client",B),await this._notifyAllSubscribers(B.data.event,B.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(h){if(this.throwOnError&&h&&h.error)throw h.error;return h}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${mI}) ${new Date().toISOString()}`}_debug(...h){return this.logDebugMessages&&this.logger(this._logPrefix(),...h),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var h;try{let _={},T="none";if(Ea()&&(_=yF(window.location.href),this._isImplicitGrantCallback(_)?T="implicit":await this._isPKCECallback(_)&&(T="pkce")),Ea()&&this.detectSessionInUrl&&T!=="none"){const{data:R,error:D}=await this._getSessionFromURL(_,T);if(D){if(this._debug("#_initialize()","error detecting session from URL",D),cF(D)){const q=(h=D.details)===null||h===void 0?void 0:h.code;if(q==="identity_already_exists"||q==="identity_not_found"||q==="single_identity_not_deletable")return{error:D}}return{error:D}}const{session:B,redirectType:r}=R;return this._debug("#_initialize()","detected session in URL",B,"redirect type",r),await this._saveSession(B),setTimeout(async()=>{r==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",B):await this._notifyAllSubscribers("SIGNED_IN",B)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(_){return cn(_)?this._returnResult({error:_}):this._returnResult({error:new ag("Unexpected error during initialization",_)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(h){var _,T,R;try{const D=await Sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(T=(_=h?.options)===null||_===void 0?void 0:_.data)!==null&&T!==void 0?T:{},gotrue_meta_security:{captcha_token:(R=h?.options)===null||R===void 0?void 0:R.captchaToken}},xform:Yu}),{data:B,error:r}=D;if(r||!B)return this._returnResult({data:{user:null,session:null},error:r});const q=B.session,H=B.user;return B.session&&(await this._saveSession(B.session),await this._notifyAllSubscribers("SIGNED_IN",q)),this._returnResult({data:{user:H,session:q},error:null})}catch(D){if(cn(D))return this._returnResult({data:{user:null,session:null},error:D});throw D}}async signUp(h){var _,T,R;try{let D;if("email"in h){const{email:ie,password:Q,options:me}=h;let we=null,Ae=null;this.flowType==="pkce"&&([we,Ae]=await T_(this.storage,this.storageKey)),D=await Sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:me?.emailRedirectTo,body:{email:ie,password:Q,data:(_=me?.data)!==null&&_!==void 0?_:{},gotrue_meta_security:{captcha_token:me?.captchaToken},code_challenge:we,code_challenge_method:Ae},xform:Yu})}else if("phone"in h){const{phone:ie,password:Q,options:me}=h;D=await Sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:ie,password:Q,data:(T=me?.data)!==null&&T!==void 0?T:{},channel:(R=me?.channel)!==null&&R!==void 0?R:"sms",gotrue_meta_security:{captcha_token:me?.captchaToken}},xform:Yu})}else throw new W0("You must provide either an email or phone number and a password");const{data:B,error:r}=D;if(r||!B)return await Sa(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:r});const q=B.session,H=B.user;return B.session&&(await this._saveSession(B.session),await this._notifyAllSubscribers("SIGNED_IN",q)),this._returnResult({data:{user:H,session:q},error:null})}catch(D){if(await Sa(this.storage,`${this.storageKey}-code-verifier`),cn(D))return this._returnResult({data:{user:null,session:null},error:D});throw D}}async signInWithPassword(h){try{let _;if("email"in h){const{email:D,password:B,options:r}=h;_=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:D,password:B,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:_A})}else if("phone"in h){const{phone:D,password:B,options:r}=h;_=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:D,password:B,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:_A})}else throw new W0("You must provide either an email or phone number and a password");const{data:T,error:R}=_;if(R)return this._returnResult({data:{user:null,session:null},error:R});if(!T||!T.session||!T.user){const D=new w_;return this._returnResult({data:{user:null,session:null},error:D})}return T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",T.session)),this._returnResult({data:Object.assign({user:T.user,session:T.session},T.weak_password?{weakPassword:T.weak_password}:null),error:R})}catch(_){if(cn(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signInWithOAuth(h){var _,T,R,D;return await this._handleProviderSignIn(h.provider,{redirectTo:(_=h.options)===null||_===void 0?void 0:_.redirectTo,scopes:(T=h.options)===null||T===void 0?void 0:T.scopes,queryParams:(R=h.options)===null||R===void 0?void 0:R.queryParams,skipBrowserRedirect:(D=h.options)===null||D===void 0?void 0:D.skipBrowserRedirect})}async exchangeCodeForSession(h){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(h))}async signInWithWeb3(h){const{chain:_}=h;switch(_){case"ethereum":return await this.signInWithEthereum(h);case"solana":return await this.signInWithSolana(h);default:throw new Error(`@supabase/auth-js: Unsupported chain "${_}"`)}}async signInWithEthereum(h){var _,T,R,D,B,r,q,H,ie,Q,me;let we,Ae;if("message"in h)we=h.message,Ae=h.signature;else{const{chain:he,wallet:Re,statement:Ne,options:Ge}=h;let Ue;if(Ea())if(typeof Re=="object")Ue=Re;else{const Ei=window;if("ethereum"in Ei&&typeof Ei.ethereum=="object"&&"request"in Ei.ethereum&&typeof Ei.ethereum.request=="function")Ue=Ei.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof Re!="object"||!Ge?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Ue=Re}const rt=new URL((_=Ge?.url)!==null&&_!==void 0?_:window.location.href),Pt=await Ue.request({method:"eth_requestAccounts"}).then(Ei=>Ei).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Pt||Pt.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Bt=bI(Pt[0]);let Tt=(T=Ge?.signInWithEthereum)===null||T===void 0?void 0:T.chainId;if(!Tt){const Ei=await Ue.request({method:"eth_chainId"});Tt=VF(Ei)}const Ht={domain:rt.host,address:Bt,statement:Ne,uri:rt.href,version:"1",chainId:Tt,nonce:(R=Ge?.signInWithEthereum)===null||R===void 0?void 0:R.nonce,issuedAt:(B=(D=Ge?.signInWithEthereum)===null||D===void 0?void 0:D.issuedAt)!==null&&B!==void 0?B:new Date,expirationTime:(r=Ge?.signInWithEthereum)===null||r===void 0?void 0:r.expirationTime,notBefore:(q=Ge?.signInWithEthereum)===null||q===void 0?void 0:q.notBefore,requestId:(H=Ge?.signInWithEthereum)===null||H===void 0?void 0:H.requestId,resources:(ie=Ge?.signInWithEthereum)===null||ie===void 0?void 0:ie.resources};we=qF(Ht),Ae=await Ue.request({method:"personal_sign",params:[GF(we),Bt]})}try{const{data:he,error:Re}=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:we,signature:Ae},!((Q=h.options)===null||Q===void 0)&&Q.captchaToken?{gotrue_meta_security:{captcha_token:(me=h.options)===null||me===void 0?void 0:me.captchaToken}}:null),xform:Yu});if(Re)throw Re;if(!he||!he.session||!he.user){const Ne=new w_;return this._returnResult({data:{user:null,session:null},error:Ne})}return he.session&&(await this._saveSession(he.session),await this._notifyAllSubscribers("SIGNED_IN",he.session)),this._returnResult({data:Object.assign({},he),error:Re})}catch(he){if(cn(he))return this._returnResult({data:{user:null,session:null},error:he});throw he}}async signInWithSolana(h){var _,T,R,D,B,r,q,H,ie,Q,me,we;let Ae,he;if("message"in h)Ae=h.message,he=h.signature;else{const{chain:Re,wallet:Ne,statement:Ge,options:Ue}=h;let rt;if(Ea())if(typeof Ne=="object")rt=Ne;else{const Bt=window;if("solana"in Bt&&typeof Bt.solana=="object"&&("signIn"in Bt.solana&&typeof Bt.solana.signIn=="function"||"signMessage"in Bt.solana&&typeof Bt.solana.signMessage=="function"))rt=Bt.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof Ne!="object"||!Ue?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");rt=Ne}const Pt=new URL((_=Ue?.url)!==null&&_!==void 0?_:window.location.href);if("signIn"in rt&&rt.signIn){const Bt=await rt.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},Ue?.signInWithSolana),{version:"1",domain:Pt.host,uri:Pt.href}),Ge?{statement:Ge}:null));let Tt;if(Array.isArray(Bt)&&Bt[0]&&typeof Bt[0]=="object")Tt=Bt[0];else if(Bt&&typeof Bt=="object"&&"signedMessage"in Bt&&"signature"in Bt)Tt=Bt;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Tt&&"signature"in Tt&&(typeof Tt.signedMessage=="string"||Tt.signedMessage instanceof Uint8Array)&&Tt.signature instanceof Uint8Array)Ae=typeof Tt.signedMessage=="string"?Tt.signedMessage:new TextDecoder().decode(Tt.signedMessage),he=Tt.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in rt)||typeof rt.signMessage!="function"||!("publicKey"in rt)||typeof rt!="object"||!rt.publicKey||!("toBase58"in rt.publicKey)||typeof rt.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");Ae=[`${Pt.host} wants you to sign in with your Solana account:`,rt.publicKey.toBase58(),...Ge?["",Ge,""]:[""],"Version: 1",`URI: ${Pt.href}`,`Issued At: ${(R=(T=Ue?.signInWithSolana)===null||T===void 0?void 0:T.issuedAt)!==null&&R!==void 0?R:new Date().toISOString()}`,...!((D=Ue?.signInWithSolana)===null||D===void 0)&&D.notBefore?[`Not Before: ${Ue.signInWithSolana.notBefore}`]:[],...!((B=Ue?.signInWithSolana)===null||B===void 0)&&B.expirationTime?[`Expiration Time: ${Ue.signInWithSolana.expirationTime}`]:[],...!((r=Ue?.signInWithSolana)===null||r===void 0)&&r.chainId?[`Chain ID: ${Ue.signInWithSolana.chainId}`]:[],...!((q=Ue?.signInWithSolana)===null||q===void 0)&&q.nonce?[`Nonce: ${Ue.signInWithSolana.nonce}`]:[],...!((H=Ue?.signInWithSolana)===null||H===void 0)&&H.requestId?[`Request ID: ${Ue.signInWithSolana.requestId}`]:[],...!((Q=(ie=Ue?.signInWithSolana)===null||ie===void 0?void 0:ie.resources)===null||Q===void 0)&&Q.length?["Resources",...Ue.signInWithSolana.resources.map(Tt=>`- ${Tt}`)]:[]].join(`
`);const Bt=await rt.signMessage(new TextEncoder().encode(Ae),"utf8");if(!Bt||!(Bt instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");he=Bt}}try{const{data:Re,error:Ne}=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:Ae,signature:lg(he)},!((me=h.options)===null||me===void 0)&&me.captchaToken?{gotrue_meta_security:{captcha_token:(we=h.options)===null||we===void 0?void 0:we.captchaToken}}:null),xform:Yu});if(Ne)throw Ne;if(!Re||!Re.session||!Re.user){const Ge=new w_;return this._returnResult({data:{user:null,session:null},error:Ge})}return Re.session&&(await this._saveSession(Re.session),await this._notifyAllSubscribers("SIGNED_IN",Re.session)),this._returnResult({data:Object.assign({},Re),error:Ne})}catch(Re){if(cn(Re))return this._returnResult({data:{user:null,session:null},error:Re});throw Re}}async _exchangeCodeForSession(h){const _=await rg(this.storage,`${this.storageKey}-code-verifier`),[T,R]=(_??"").split("/");try{if(!T&&this.flowType==="pkce")throw new uF;const{data:D,error:B}=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:h,code_verifier:T},xform:Yu});if(await Sa(this.storage,`${this.storageKey}-code-verifier`),B)throw B;if(!D||!D.session||!D.user){const r=new w_;return this._returnResult({data:{user:null,session:null,redirectType:null},error:r})}return D.session&&(await this._saveSession(D.session),await this._notifyAllSubscribers("SIGNED_IN",D.session)),this._returnResult({data:Object.assign(Object.assign({},D),{redirectType:R??null}),error:B})}catch(D){if(await Sa(this.storage,`${this.storageKey}-code-verifier`),cn(D))return this._returnResult({data:{user:null,session:null,redirectType:null},error:D});throw D}}async signInWithIdToken(h){try{const{options:_,provider:T,token:R,access_token:D,nonce:B}=h,r=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:T,id_token:R,access_token:D,nonce:B,gotrue_meta_security:{captcha_token:_?.captchaToken}},xform:Yu}),{data:q,error:H}=r;if(H)return this._returnResult({data:{user:null,session:null},error:H});if(!q||!q.session||!q.user){const ie=new w_;return this._returnResult({data:{user:null,session:null},error:ie})}return q.session&&(await this._saveSession(q.session),await this._notifyAllSubscribers("SIGNED_IN",q.session)),this._returnResult({data:q,error:H})}catch(_){if(cn(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signInWithOtp(h){var _,T,R,D,B;try{if("email"in h){const{email:r,options:q}=h;let H=null,ie=null;this.flowType==="pkce"&&([H,ie]=await T_(this.storage,this.storageKey));const{error:Q}=await Sn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:(_=q?.data)!==null&&_!==void 0?_:{},create_user:(T=q?.shouldCreateUser)!==null&&T!==void 0?T:!0,gotrue_meta_security:{captcha_token:q?.captchaToken},code_challenge:H,code_challenge_method:ie},redirectTo:q?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:Q})}if("phone"in h){const{phone:r,options:q}=h,{data:H,error:ie}=await Sn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:r,data:(R=q?.data)!==null&&R!==void 0?R:{},create_user:(D=q?.shouldCreateUser)!==null&&D!==void 0?D:!0,gotrue_meta_security:{captcha_token:q?.captchaToken},channel:(B=q?.channel)!==null&&B!==void 0?B:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:H?.message_id},error:ie})}throw new W0("You must provide either an email or phone number.")}catch(r){if(await Sa(this.storage,`${this.storageKey}-code-verifier`),cn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async verifyOtp(h){var _,T;try{let R,D;"options"in h&&(R=(_=h.options)===null||_===void 0?void 0:_.redirectTo,D=(T=h.options)===null||T===void 0?void 0:T.captchaToken);const{data:B,error:r}=await Sn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},h),{gotrue_meta_security:{captcha_token:D}}),redirectTo:R,xform:Yu});if(r)throw r;if(!B)throw new Error("An error occurred on token verification.");const q=B.session,H=B.user;return q?.access_token&&(await this._saveSession(q),await this._notifyAllSubscribers(h.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",q)),this._returnResult({data:{user:H,session:q},error:null})}catch(R){if(cn(R))return this._returnResult({data:{user:null,session:null},error:R});throw R}}async signInWithSSO(h){var _,T,R,D,B;try{let r=null,q=null;this.flowType==="pkce"&&([r,q]=await T_(this.storage,this.storageKey));const H=await Sn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in h?{provider_id:h.providerId}:null),"domain"in h?{domain:h.domain}:null),{redirect_to:(T=(_=h.options)===null||_===void 0?void 0:_.redirectTo)!==null&&T!==void 0?T:void 0}),!((R=h?.options)===null||R===void 0)&&R.captchaToken?{gotrue_meta_security:{captcha_token:h.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:q}),headers:this.headers,xform:LF});return!((D=H.data)===null||D===void 0)&&D.url&&Ea()&&!(!((B=h.options)===null||B===void 0)&&B.skipBrowserRedirect)&&window.location.assign(H.data.url),this._returnResult(H)}catch(r){if(await Sa(this.storage,`${this.storageKey}-code-verifier`),cn(r))return this._returnResult({data:null,error:r});throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async h=>{const{data:{session:_},error:T}=h;if(T)throw T;if(!_)throw new bc;const{error:R}=await Sn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:_.access_token});return this._returnResult({data:{user:null,session:null},error:R})})}catch(h){if(cn(h))return this._returnResult({data:{user:null,session:null},error:h});throw h}}async resend(h){try{const _=`${this.url}/resend`;if("email"in h){const{email:T,type:R,options:D}=h,{error:B}=await Sn(this.fetch,"POST",_,{headers:this.headers,body:{email:T,type:R,gotrue_meta_security:{captcha_token:D?.captchaToken}},redirectTo:D?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:B})}else if("phone"in h){const{phone:T,type:R,options:D}=h,{data:B,error:r}=await Sn(this.fetch,"POST",_,{headers:this.headers,body:{phone:T,type:R,gotrue_meta_security:{captcha_token:D?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:B?.message_id},error:r})}throw new W0("You must provide either an email or phone number and a type")}catch(_){if(cn(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async _=>_))}async _acquireLock(h,_){this._debug("#_acquireLock","begin",h);try{if(this.lockAcquired){const T=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),R=(async()=>(await T,await _()))();return this.pendingInLock.push((async()=>{try{await R}catch{}})()),R}return await this.lock(`lock:${this.storageKey}`,h,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const T=_();for(this.pendingInLock.push((async()=>{try{await T}catch{}})()),await T;this.pendingInLock.length;){const R=[...this.pendingInLock];await Promise.all(R),this.pendingInLock.splice(0,R.length)}return await T}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(h){this._debug("#_useSession","begin");try{const _=await this.__loadSession();return await h(_)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let h=null;const _=await rg(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",_),_!==null&&(this._isValidSession(_)?h=_:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!h)return{data:{session:null},error:null};const T=h.expires_at?h.expires_at*1e3-Date.now()<ww:!1;if(this._debug("#__loadSession()",`session has${T?"":" not"} expired`,"expires_at",h.expires_at),!T){if(this.userStorage){const B=await rg(this.userStorage,this.storageKey+"-user");B?.user?h.user=B.user:h.user=Ew()}if(this.storage.isServer&&h.user&&!h.user.__isUserNotAvailableProxy){const B={value:this.suppressGetSessionWarning};h.user=DF(h.user,B),B.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:h},error:null}}const{data:R,error:D}=await this._callRefreshToken(h.refresh_token);return D?this._returnResult({data:{session:null},error:D}):this._returnResult({data:{session:R},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(h){if(h)return await this._getUser(h);await this.initializePromise;const _=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return _.data.user&&(this.suppressGetSessionWarning=!0),_}async _getUser(h){try{return h?await Sn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:h,xform:Op}):await this._useSession(async _=>{var T,R,D;const{data:B,error:r}=_;if(r)throw r;return!(!((T=B.session)===null||T===void 0)&&T.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new bc}:await Sn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(D=(R=B.session)===null||R===void 0?void 0:R.access_token)!==null&&D!==void 0?D:void 0,xform:Op})})}catch(_){if(cn(_))return lF(_)&&(await this._removeSession(),await Sa(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:_});throw _}}async updateUser(h,_={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(h,_))}async _updateUser(h,_={}){try{return await this._useSession(async T=>{const{data:R,error:D}=T;if(D)throw D;if(!R.session)throw new bc;const B=R.session;let r=null,q=null;this.flowType==="pkce"&&h.email!=null&&([r,q]=await T_(this.storage,this.storageKey));const{data:H,error:ie}=await Sn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:_?.emailRedirectTo,body:Object.assign(Object.assign({},h),{code_challenge:r,code_challenge_method:q}),jwt:B.access_token,xform:Op});if(ie)throw ie;return B.user=H.user,await this._saveSession(B),await this._notifyAllSubscribers("USER_UPDATED",B),this._returnResult({data:{user:B.user},error:null})})}catch(T){if(await Sa(this.storage,`${this.storageKey}-code-verifier`),cn(T))return this._returnResult({data:{user:null},error:T});throw T}}async setSession(h){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(h))}async _setSession(h){try{if(!h.access_token||!h.refresh_token)throw new bc;const _=Date.now()/1e3;let T=_,R=!0,D=null;const{payload:B}=Sw(h.access_token);if(B.exp&&(T=B.exp,R=T<=_),R){const{data:r,error:q}=await this._callRefreshToken(h.refresh_token);if(q)return this._returnResult({data:{user:null,session:null},error:q});if(!r)return{data:{user:null,session:null},error:null};D=r}else{const{data:r,error:q}=await this._getUser(h.access_token);if(q)throw q;D={access_token:h.access_token,refresh_token:h.refresh_token,user:r.user,token_type:"bearer",expires_in:T-_,expires_at:T},await this._saveSession(D),await this._notifyAllSubscribers("SIGNED_IN",D)}return this._returnResult({data:{user:D.user,session:D},error:null})}catch(_){if(cn(_))return this._returnResult({data:{session:null,user:null},error:_});throw _}}async refreshSession(h){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(h))}async _refreshSession(h){try{return await this._useSession(async _=>{var T;if(!h){const{data:B,error:r}=_;if(r)throw r;h=(T=B.session)!==null&&T!==void 0?T:void 0}if(!h?.refresh_token)throw new bc;const{data:R,error:D}=await this._callRefreshToken(h.refresh_token);return D?this._returnResult({data:{user:null,session:null},error:D}):R?this._returnResult({data:{user:R.user,session:R},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(_){if(cn(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async _getSessionFromURL(h,_){try{if(!Ea())throw new X0("No browser detected.");if(h.error||h.error_description||h.error_code)throw new X0(h.error_description||"Error in URL with unspecified error_description",{error:h.error||"unspecified_error",code:h.error_code||"unspecified_code"});switch(_){case"implicit":if(this.flowType==="pkce")throw new uA("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new X0("Not a valid implicit grant flow url.");break;default:}if(_==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!h.code)throw new uA("No code detected.");const{data:Ge,error:Ue}=await this._exchangeCodeForSession(h.code);if(Ue)throw Ue;const rt=new URL(window.location.href);return rt.searchParams.delete("code"),window.history.replaceState(window.history.state,"",rt.toString()),{data:{session:Ge.session,redirectType:null},error:null}}const{provider_token:T,provider_refresh_token:R,access_token:D,refresh_token:B,expires_in:r,expires_at:q,token_type:H}=h;if(!D||!r||!B||!H)throw new X0("No session defined in URL");const ie=Math.round(Date.now()/1e3),Q=parseInt(r);let me=ie+Q;q&&(me=parseInt(q));const we=me-ie;we*1e3<=D_&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${we}s, should have been closer to ${Q}s`);const Ae=me-Q;ie-Ae>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",Ae,me,ie):ie-Ae<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",Ae,me,ie);const{data:he,error:Re}=await this._getUser(D);if(Re)throw Re;const Ne={provider_token:T,provider_refresh_token:R,access_token:D,expires_in:Q,expires_at:me,refresh_token:B,token_type:H,user:he.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:Ne,redirectType:h.type},error:null})}catch(T){if(cn(T))return this._returnResult({data:{session:null,redirectType:null},error:T});throw T}}_isImplicitGrantCallback(h){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),h):!!(h.access_token||h.error_description)}async _isPKCECallback(h){const _=await rg(this.storage,`${this.storageKey}-code-verifier`);return!!(h.code&&_)}async signOut(h={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(h))}async _signOut({scope:h}={scope:"global"}){return await this._useSession(async _=>{var T;const{data:R,error:D}=_;if(D)return this._returnResult({error:D});const B=(T=R.session)===null||T===void 0?void 0:T.access_token;if(B){const{error:r}=await this.admin.signOut(B,h);if(r&&!(aF(r)&&(r.status===404||r.status===401||r.status===403)))return this._returnResult({error:r})}return h!=="others"&&(await this._removeSession(),await Sa(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(h){const _=_F(),T={id:_,callback:h,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",_),this.stateChangeEmitters.delete(_)}};return this._debug("#onAuthStateChange()","registered callback with id",_),this.stateChangeEmitters.set(_,T),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(_)})))(),{data:{subscription:T}}}async _emitInitialSession(h){return await this._useSession(async _=>{var T,R;try{const{data:{session:D},error:B}=_;if(B)throw B;await((T=this.stateChangeEmitters.get(h))===null||T===void 0?void 0:T.callback("INITIAL_SESSION",D)),this._debug("INITIAL_SESSION","callback id",h,"session",D)}catch(D){await((R=this.stateChangeEmitters.get(h))===null||R===void 0?void 0:R.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",h,"error",D),console.error(D)}})}async resetPasswordForEmail(h,_={}){let T=null,R=null;this.flowType==="pkce"&&([T,R]=await T_(this.storage,this.storageKey,!0));try{return await Sn(this.fetch,"POST",`${this.url}/recover`,{body:{email:h,code_challenge:T,code_challenge_method:R,gotrue_meta_security:{captcha_token:_.captchaToken}},headers:this.headers,redirectTo:_.redirectTo})}catch(D){if(await Sa(this.storage,`${this.storageKey}-code-verifier`),cn(D))return this._returnResult({data:null,error:D});throw D}}async getUserIdentities(){var h;try{const{data:_,error:T}=await this.getUser();if(T)throw T;return this._returnResult({data:{identities:(h=_.user.identities)!==null&&h!==void 0?h:[]},error:null})}catch(_){if(cn(_))return this._returnResult({data:null,error:_});throw _}}async linkIdentity(h){return"token"in h?this.linkIdentityIdToken(h):this.linkIdentityOAuth(h)}async linkIdentityOAuth(h){var _;try{const{data:T,error:R}=await this._useSession(async D=>{var B,r,q,H,ie;const{data:Q,error:me}=D;if(me)throw me;const we=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,h.provider,{redirectTo:(B=h.options)===null||B===void 0?void 0:B.redirectTo,scopes:(r=h.options)===null||r===void 0?void 0:r.scopes,queryParams:(q=h.options)===null||q===void 0?void 0:q.queryParams,skipBrowserRedirect:!0});return await Sn(this.fetch,"GET",we,{headers:this.headers,jwt:(ie=(H=Q.session)===null||H===void 0?void 0:H.access_token)!==null&&ie!==void 0?ie:void 0})});if(R)throw R;return Ea()&&!(!((_=h.options)===null||_===void 0)&&_.skipBrowserRedirect)&&window.location.assign(T?.url),this._returnResult({data:{provider:h.provider,url:T?.url},error:null})}catch(T){if(cn(T))return this._returnResult({data:{provider:h.provider,url:null},error:T});throw T}}async linkIdentityIdToken(h){return await this._useSession(async _=>{var T;try{const{error:R,data:{session:D}}=_;if(R)throw R;const{options:B,provider:r,token:q,access_token:H,nonce:ie}=h,Q=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(T=D?.access_token)!==null&&T!==void 0?T:void 0,body:{provider:r,id_token:q,access_token:H,nonce:ie,link_identity:!0,gotrue_meta_security:{captcha_token:B?.captchaToken}},xform:Yu}),{data:me,error:we}=Q;return we?this._returnResult({data:{user:null,session:null},error:we}):!me||!me.session||!me.user?this._returnResult({data:{user:null,session:null},error:new w_}):(me.session&&(await this._saveSession(me.session),await this._notifyAllSubscribers("USER_UPDATED",me.session)),this._returnResult({data:me,error:we}))}catch(R){if(await Sa(this.storage,`${this.storageKey}-code-verifier`),cn(R))return this._returnResult({data:{user:null,session:null},error:R});throw R}})}async unlinkIdentity(h){try{return await this._useSession(async _=>{var T,R;const{data:D,error:B}=_;if(B)throw B;return await Sn(this.fetch,"DELETE",`${this.url}/user/identities/${h.identity_id}`,{headers:this.headers,jwt:(R=(T=D.session)===null||T===void 0?void 0:T.access_token)!==null&&R!==void 0?R:void 0})})}catch(_){if(cn(_))return this._returnResult({data:null,error:_});throw _}}async _refreshAccessToken(h){const _=`#_refreshAccessToken(${h.substring(0,5)}...)`;this._debug(_,"begin");try{const T=Date.now();return await bF(async R=>(R>0&&await xF(200*Math.pow(2,R-1)),this._debug(_,"refreshing attempt",R),await Sn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:h},headers:this.headers,xform:Yu})),(R,D)=>{const B=200*Math.pow(2,R);return D&&Tw(D)&&Date.now()+B-T<D_})}catch(T){if(this._debug(_,"error",T),cn(T))return this._returnResult({data:{session:null,user:null},error:T});throw T}finally{this._debug(_,"end")}}_isValidSession(h){return typeof h=="object"&&h!==null&&"access_token"in h&&"refresh_token"in h&&"expires_at"in h}async _handleProviderSignIn(h,_){const T=await this._getUrlForProvider(`${this.url}/authorize`,h,{redirectTo:_.redirectTo,scopes:_.scopes,queryParams:_.queryParams});return this._debug("#_handleProviderSignIn()","provider",h,"options",_,"url",T),Ea()&&!_.skipBrowserRedirect&&window.location.assign(T),{data:{provider:h,url:T},error:null}}async _recoverAndRefresh(){var h,_;const T="#_recoverAndRefresh()";this._debug(T,"begin");try{const R=await rg(this.storage,this.storageKey);if(R&&this.userStorage){let B=await rg(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!B&&(B={user:R.user},await O_(this.userStorage,this.storageKey+"-user",B)),R.user=(h=B?.user)!==null&&h!==void 0?h:Ew()}else if(R&&!R.user&&!R.user){const B=await rg(this.storage,this.storageKey+"-user");B&&B?.user?(R.user=B.user,await Sa(this.storage,this.storageKey+"-user"),await O_(this.storage,this.storageKey,R)):R.user=Ew()}if(this._debug(T,"session from storage",R),!this._isValidSession(R)){this._debug(T,"session is not valid"),R!==null&&await this._removeSession();return}const D=((_=R.expires_at)!==null&&_!==void 0?_:1/0)*1e3-Date.now()<ww;if(this._debug(T,`session has${D?"":" not"} expired with margin of ${ww}s`),D){if(this.autoRefreshToken&&R.refresh_token){const{error:B}=await this._callRefreshToken(R.refresh_token);B&&(console.error(B),Tw(B)||(this._debug(T,"refresh failed with a non-retryable error, removing the session",B),await this._removeSession()))}}else if(R.user&&R.user.__isUserNotAvailableProxy===!0)try{const{data:B,error:r}=await this._getUser(R.access_token);!r&&B?.user?(R.user=B.user,await this._saveSession(R),await this._notifyAllSubscribers("SIGNED_IN",R)):this._debug(T,"could not get user data, skipping SIGNED_IN notification")}catch(B){console.error("Error getting user data:",B),this._debug(T,"error getting user data, skipping SIGNED_IN notification",B)}else await this._notifyAllSubscribers("SIGNED_IN",R)}catch(R){this._debug(T,"error",R),console.error(R);return}finally{this._debug(T,"end")}}async _callRefreshToken(h){var _,T;if(!h)throw new bc;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const R=`#_callRefreshToken(${h.substring(0,5)}...)`;this._debug(R,"begin");try{this.refreshingDeferred=new kx;const{data:D,error:B}=await this._refreshAccessToken(h);if(B)throw B;if(!D.session)throw new bc;await this._saveSession(D.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",D.session);const r={data:D.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(D){if(this._debug(R,"error",D),cn(D)){const B={data:null,error:D};return Tw(D)||await this._removeSession(),(_=this.refreshingDeferred)===null||_===void 0||_.resolve(B),B}throw(T=this.refreshingDeferred)===null||T===void 0||T.reject(D),D}finally{this.refreshingDeferred=null,this._debug(R,"end")}}async _notifyAllSubscribers(h,_,T=!0){const R=`#_notifyAllSubscribers(${h})`;this._debug(R,"begin",_,`broadcast = ${T}`);try{this.broadcastChannel&&T&&this.broadcastChannel.postMessage({event:h,session:_});const D=[],B=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(h,_)}catch(q){D.push(q)}});if(await Promise.all(B),D.length>0){for(let r=0;r<D.length;r+=1)console.error(D[r]);throw D[0]}}finally{this._debug(R,"end")}}async _saveSession(h){this._debug("#_saveSession()",h),this.suppressGetSessionWarning=!0,await Sa(this.storage,`${this.storageKey}-code-verifier`);const _=Object.assign({},h),T=_.user&&_.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!T&&_.user&&await O_(this.userStorage,this.storageKey+"-user",{user:_.user});const R=Object.assign({},_);delete R.user;const D=mA(R);await O_(this.storage,this.storageKey,D)}else{const R=mA(_);await O_(this.storage,this.storageKey,R)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Sa(this.storage,this.storageKey),await Sa(this.storage,this.storageKey+"-code-verifier"),await Sa(this.storage,this.storageKey+"-user"),this.userStorage&&await Sa(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const h=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{h&&Ea()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",h)}catch(_){console.error("removing visibilitychange callback failed",_)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const h=setInterval(()=>this._autoRefreshTokenTick(),D_);this.autoRefreshTicker=h,h&&typeof h=="object"&&typeof h.unref=="function"?h.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(h);const _=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=_,_&&typeof _=="object"&&typeof _.unref=="function"?_.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(_)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const h=this.autoRefreshTicker;this.autoRefreshTicker=null,h&&clearInterval(h);const _=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,_&&clearTimeout(_)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const h=Date.now();try{return await this._useSession(async _=>{const{data:{session:T}}=_;if(!T||!T.refresh_token||!T.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const R=Math.floor((T.expires_at*1e3-h)/D_);this._debug("#_autoRefreshTokenTick()",`access token expires in ${R} ticks, a tick lasts ${D_}ms, refresh threshold is ${n1} ticks`),R<=n1&&await this._callRefreshToken(T.refresh_token)})}catch(_){console.error("Auto refresh tick failed with error. This is likely a transient error.",_)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(h){if(h.isAcquireTimeout||h instanceof xI)this._debug("auto refresh token tick lock not available");else throw h}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ea()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(h){console.error("_handleVisibilityChange",h)}}async _onVisibilityChanged(h){const _=`#_onVisibilityChanged(${h})`;this._debug(_,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),h||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(_,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(h,_,T){const R=[`provider=${encodeURIComponent(_)}`];if(T?.redirectTo&&R.push(`redirect_to=${encodeURIComponent(T.redirectTo)}`),T?.scopes&&R.push(`scopes=${encodeURIComponent(T.scopes)}`),this.flowType==="pkce"){const[D,B]=await T_(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(D)}`,code_challenge_method:`${encodeURIComponent(B)}`});R.push(r.toString())}if(T?.queryParams){const D=new URLSearchParams(T.queryParams);R.push(D.toString())}return T?.skipBrowserRedirect&&R.push(`skip_http_redirect=${T.skipBrowserRedirect}`),`${h}?${R.join("&")}`}async _unenroll(h){try{return await this._useSession(async _=>{var T;const{data:R,error:D}=_;return D?this._returnResult({data:null,error:D}):await Sn(this.fetch,"DELETE",`${this.url}/factors/${h.factorId}`,{headers:this.headers,jwt:(T=R?.session)===null||T===void 0?void 0:T.access_token})})}catch(_){if(cn(_))return this._returnResult({data:null,error:_});throw _}}async _enroll(h){try{return await this._useSession(async _=>{var T,R;const{data:D,error:B}=_;if(B)return this._returnResult({data:null,error:B});const r=Object.assign({friendly_name:h.friendlyName,factor_type:h.factorType},h.factorType==="phone"?{phone:h.phone}:h.factorType==="totp"?{issuer:h.issuer}:{}),{data:q,error:H}=await Sn(this.fetch,"POST",`${this.url}/factors`,{body:r,headers:this.headers,jwt:(T=D?.session)===null||T===void 0?void 0:T.access_token});return H?this._returnResult({data:null,error:H}):(h.factorType==="totp"&&q.type==="totp"&&(!((R=q?.totp)===null||R===void 0)&&R.qr_code)&&(q.totp.qr_code=`data:image/svg+xml;utf-8,${q.totp.qr_code}`),this._returnResult({data:q,error:null}))})}catch(_){if(cn(_))return this._returnResult({data:null,error:_});throw _}}async _verify(h){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async _=>{var T;const{data:R,error:D}=_;if(D)return this._returnResult({data:null,error:D});const B=Object.assign({challenge_id:h.challengeId},"webauthn"in h?{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_response:h.webauthn.type==="create"?KF(h.webauthn.credential_response):JF(h.webauthn.credential_response)})}:{code:h.code}),{data:r,error:q}=await Sn(this.fetch,"POST",`${this.url}/factors/${h.factorId}/verify`,{body:B,headers:this.headers,jwt:(T=R?.session)===null||T===void 0?void 0:T.access_token});return q?this._returnResult({data:null,error:q}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+r.expires_in},r)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",r),this._returnResult({data:r,error:q}))})}catch(_){if(cn(_))return this._returnResult({data:null,error:_});throw _}})}async _challenge(h){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async _=>{var T;const{data:R,error:D}=_;if(D)return this._returnResult({data:null,error:D});const B=await Sn(this.fetch,"POST",`${this.url}/factors/${h.factorId}/challenge`,{body:h,headers:this.headers,jwt:(T=R?.session)===null||T===void 0?void 0:T.access_token});if(B.error)return B;const{data:r}=B;if(r.type!=="webauthn")return{data:r,error:null};switch(r.webauthn.type){case"create":return{data:Object.assign(Object.assign({},r),{webauthn:Object.assign(Object.assign({},r.webauthn),{credential_options:Object.assign(Object.assign({},r.webauthn.credential_options),{publicKey:XF(r.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},r),{webauthn:Object.assign(Object.assign({},r.webauthn),{credential_options:Object.assign(Object.assign({},r.webauthn.credential_options),{publicKey:YF(r.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(_){if(cn(_))return this._returnResult({data:null,error:_});throw _}})}async _challengeAndVerify(h){const{data:_,error:T}=await this._challenge({factorId:h.factorId});return T?this._returnResult({data:null,error:T}):await this._verify({factorId:h.factorId,challengeId:_.id,code:h.code})}async _listFactors(){var h;const{data:{user:_},error:T}=await this.getUser();if(T)return{data:null,error:T};const R={all:[],phone:[],totp:[],webauthn:[]};for(const D of(h=_?.factors)!==null&&h!==void 0?h:[])R.all.push(D),D.status==="verified"&&R[D.factor_type].push(D);return{data:R,error:null}}async _getAuthenticatorAssuranceLevel(){var h,_;const{data:{session:T},error:R}=await this.getSession();if(R)return this._returnResult({data:null,error:R});if(!T)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:D}=Sw(T.access_token);let B=null;D.aal&&(B=D.aal);let r=B;((_=(h=T.user.factors)===null||h===void 0?void 0:h.filter(ie=>ie.status==="verified"))!==null&&_!==void 0?_:[]).length>0&&(r="aal2");const H=D.amr||[];return{data:{currentLevel:B,nextLevel:r,currentAuthenticationMethods:H},error:null}}async _getAuthorizationDetails(h){try{return await this._useSession(async _=>{const{data:{session:T},error:R}=_;return R?this._returnResult({data:null,error:R}):T?await Sn(this.fetch,"GET",`${this.url}/oauth/authorizations/${h}`,{headers:this.headers,jwt:T.access_token,xform:D=>({data:D,error:null})}):this._returnResult({data:null,error:new bc})})}catch(_){if(cn(_))return this._returnResult({data:null,error:_});throw _}}async _approveAuthorization(h,_){try{return await this._useSession(async T=>{const{data:{session:R},error:D}=T;if(D)return this._returnResult({data:null,error:D});if(!R)return this._returnResult({data:null,error:new bc});const B=await Sn(this.fetch,"POST",`${this.url}/oauth/authorizations/${h}/consent`,{headers:this.headers,jwt:R.access_token,body:{action:"approve"},xform:r=>({data:r,error:null})});return B.data&&B.data.redirect_url&&Ea()&&!_?.skipBrowserRedirect&&window.location.assign(B.data.redirect_url),B})}catch(T){if(cn(T))return this._returnResult({data:null,error:T});throw T}}async _denyAuthorization(h,_){try{return await this._useSession(async T=>{const{data:{session:R},error:D}=T;if(D)return this._returnResult({data:null,error:D});if(!R)return this._returnResult({data:null,error:new bc});const B=await Sn(this.fetch,"POST",`${this.url}/oauth/authorizations/${h}/consent`,{headers:this.headers,jwt:R.access_token,body:{action:"deny"},xform:r=>({data:r,error:null})});return B.data&&B.data.redirect_url&&Ea()&&!_?.skipBrowserRedirect&&window.location.assign(B.data.redirect_url),B})}catch(T){if(cn(T))return this._returnResult({data:null,error:T});throw T}}async _listOAuthGrants(){try{return await this._useSession(async h=>{const{data:{session:_},error:T}=h;return T?this._returnResult({data:null,error:T}):_?await Sn(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:_.access_token,xform:R=>({data:R,error:null})}):this._returnResult({data:null,error:new bc})})}catch(h){if(cn(h))return this._returnResult({data:null,error:h});throw h}}async _revokeOAuthGrant(h){try{return await this._useSession(async _=>{const{data:{session:T},error:R}=_;return R?this._returnResult({data:null,error:R}):T?(await Sn(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:T.access_token,query:{client_id:h.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new bc})})}catch(_){if(cn(_))return this._returnResult({data:null,error:_});throw _}}async fetchJwk(h,_={keys:[]}){let T=_.keys.find(r=>r.kid===h);if(T)return T;const R=Date.now();if(T=this.jwks.keys.find(r=>r.kid===h),T&&this.jwks_cached_at+sF>R)return T;const{data:D,error:B}=await Sn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(B)throw B;return!D.keys||D.keys.length===0||(this.jwks=D,this.jwks_cached_at=R,T=D.keys.find(r=>r.kid===h),!T)?null:T}async getClaims(h,_={}){try{let T=h;if(!T){const{data:we,error:Ae}=await this.getSession();if(Ae||!we.session)return this._returnResult({data:null,error:Ae});T=we.session.access_token}const{header:R,payload:D,signature:B,raw:{header:r,payload:q}}=Sw(T);_?.allowExpired||IF(D.exp);const H=!R.alg||R.alg.startsWith("HS")||!R.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(R.kid,_?.keys?{keys:_.keys}:_?.jwks);if(!H){const{error:we}=await this.getUser(T);if(we)throw we;return{data:{claims:D,header:R,signature:B},error:null}}const ie=RF(R.alg),Q=await crypto.subtle.importKey("jwk",H,ie,!0,["verify"]);if(!await crypto.subtle.verify(ie,Q,B,mF(`${r}.${q}`)))throw new o1("Invalid JWT signature");return{data:{claims:D,header:R,signature:B},error:null}}catch(T){if(cn(T))return this._returnResult({data:null,error:T});throw T}}}vv.nextInstanceID={};const aN=vv,lN="2.90.1";let sv="";typeof Deno<"u"?sv="deno":typeof document<"u"?sv="web":typeof navigator<"u"&&navigator.product==="ReactNative"?sv="react-native":sv="node";const cN={"X-Client-Info":`supabase-js-${sv}/${lN}`},uN={headers:cN},hN={schema:"public"},dN={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},fN={};function xv(d){"@babel/helpers - typeof";return xv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},xv(d)}function pN(d,h){if(xv(d)!="object"||!d)return d;var _=d[Symbol.toPrimitive];if(_!==void 0){var T=_.call(d,h);if(xv(T)!="object")return T;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(d)}function mN(d){var h=pN(d,"string");return xv(h)=="symbol"?h:h+""}function gN(d,h,_){return(h=mN(h))in d?Object.defineProperty(d,h,{value:_,enumerable:!0,configurable:!0,writable:!0}):d[h]=_,d}function wA(d,h){var _=Object.keys(d);if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(d);h&&(T=T.filter(function(R){return Object.getOwnPropertyDescriptor(d,R).enumerable})),_.push.apply(_,T)}return _}function to(d){for(var h=1;h<arguments.length;h++){var _=arguments[h]!=null?arguments[h]:{};h%2?wA(Object(_),!0).forEach(function(T){gN(d,T,_[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(_)):wA(Object(_)).forEach(function(T){Object.defineProperty(d,T,Object.getOwnPropertyDescriptor(_,T))})}return d}const _N=d=>d?(...h)=>d(...h):(...h)=>fetch(...h),yN=()=>Headers,vN=(d,h,_)=>{const T=_N(_),R=yN();return async(D,B)=>{var r;const q=(r=await h())!==null&&r!==void 0?r:d;let H=new R(B?.headers);return H.has("apikey")||H.set("apikey",d),H.has("Authorization")||H.set("Authorization",`Bearer ${q}`),T(D,to(to({},B),{},{headers:H}))}};function xN(d){return d.endsWith("/")?d:d+"/"}function bN(d,h){var _,T;const{db:R,auth:D,realtime:B,global:r}=d,{db:q,auth:H,realtime:ie,global:Q}=h,me={db:to(to({},q),R),auth:to(to({},H),D),realtime:to(to({},ie),B),storage:{},global:to(to(to({},Q),r),{},{headers:to(to({},(_=Q?.headers)!==null&&_!==void 0?_:{}),(T=r?.headers)!==null&&T!==void 0?T:{})}),accessToken:async()=>""};return d.accessToken?me.accessToken=d.accessToken:delete me.accessToken,me}function wN(d){const h=d?.trim();if(!h)throw new Error("supabaseUrl is required.");if(!h.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(xN(h))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var TN=class extends aN{constructor(d){super(d)}},SN=class{constructor(d,h,_){var T,R;this.supabaseUrl=d,this.supabaseKey=h;const D=wN(d);if(!h)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",D),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",D),this.storageUrl=new URL("storage/v1",D),this.functionsUrl=new URL("functions/v1",D);const B=`sb-${D.hostname.split(".")[0]}-auth-token`,r={db:hN,realtime:fN,auth:to(to({},dN),{},{storageKey:B}),global:uN},q=bN(_??{},r);if(this.storageKey=(T=q.auth.storageKey)!==null&&T!==void 0?T:"",this.headers=(R=q.global.headers)!==null&&R!==void 0?R:{},q.accessToken)this.accessToken=q.accessToken,this.auth=new Proxy({},{get:(ie,Q)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(Q)} is not possible`)}});else{var H;this.auth=this._initSupabaseAuthClient((H=q.auth)!==null&&H!==void 0?H:{},this.headers,q.global.fetch)}this.fetch=vN(h,this._getAccessToken.bind(this),q.global.fetch),this.realtime=this._initRealtimeClient(to({headers:this.headers,accessToken:this._getAccessToken.bind(this)},q.realtime)),this.accessToken&&this.accessToken().then(ie=>this.realtime.setAuth(ie)).catch(ie=>console.warn("Failed to set initial Realtime auth token:",ie)),this.rest=new nB(new URL("rest/v1",D).href,{headers:this.headers,schema:q.db.schema,fetch:this.fetch}),this.storage=new eF(this.storageUrl.href,this.headers,this.fetch,_?.storage),q.accessToken||this._listenForAuthEvents()}get functions(){return new J3(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(d){return this.rest.from(d)}schema(d){return this.rest.schema(d)}rpc(d,h={},_={head:!1,get:!1,count:void 0}){return this.rest.rpc(d,h,_)}channel(d,h={config:{}}){return this.realtime.channel(d,h)}getChannels(){return this.realtime.getChannels()}removeChannel(d){return this.realtime.removeChannel(d)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var d=this,h,_;if(d.accessToken)return await d.accessToken();const{data:T}=await d.auth.getSession();return(h=(_=T.session)===null||_===void 0?void 0:_.access_token)!==null&&h!==void 0?h:d.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:d,persistSession:h,detectSessionInUrl:_,storage:T,userStorage:R,storageKey:D,flowType:B,lock:r,debug:q,throwOnError:H},ie,Q){const me={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new TN({url:this.authUrl.href,headers:to(to({},me),ie),storageKey:D,autoRefreshToken:d,persistSession:h,detectSessionInUrl:_,storage:T,userStorage:R,flowType:B,lock:r,debug:q,throwOnError:H,fetch:Q,hasCustomAuthorizationHeader:Object.keys(this.headers).some(we=>we.toLowerCase()==="authorization")})}_initRealtimeClient(d){return new xB(this.realtimeUrl.href,to(to({},d),{},{params:to(to({},{apikey:this.supabaseKey}),d?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((d,h)=>{this._handleTokenChanged(d,"CLIENT",h?.access_token)})}_handleTokenChanged(d,h,_){(d==="TOKEN_REFRESHED"||d==="SIGNED_IN")&&this.changedAccessToken!==_?(this.changedAccessToken=_,this.realtime.setAuth(_)):d==="SIGNED_OUT"&&(this.realtime.setAuth(),h=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const EN=(d,h,_)=>new SN(d,h,_);function AN(){if(typeof window<"u")return!1;const d=globalThis.process;if(!d)return!1;const h=d.version;if(h==null)return!1;const _=h.match(/^v(\d+)\./);return _?parseInt(_[1],10)<=18:!1}AN()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const CN="https://lboygdqoetrypnzksago.supabase.co",IN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxib3lnZHFvZXRyeXBuemtzYWdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2MzA5ODUsImV4cCI6MjA4NDIwNjk4NX0.mtjVPZmilLunFUCvrf01Tyr2wDchCzee2MhQuFyVDHg",Zr=EN(CN,IN);function hd(d){const{redirectOnUnauthenticated:h=!1,redirectPath:_="/login"}={},[T,R]=le.useState({user:null,session:null,loading:!0,error:null,isAuthenticated:!1});le.useEffect(()=>{Zr.auth.getSession().then(({data:{session:Q},error:me})=>{R({user:Q?.user??null,session:Q,loading:!1,error:me??null,isAuthenticated:!!Q?.user})});const{data:{subscription:ie}}=Zr.auth.onAuthStateChange((Q,me)=>{R({user:me?.user??null,session:me,loading:!1,error:null,isAuthenticated:!!me?.user})});return()=>ie.unsubscribe()},[]),le.useEffect(()=>{h&&(T.loading||T.user||typeof window>"u"||window.location.pathname!==_&&(window.location.href=_))},[h,_,T.loading,T.user]);const D=le.useCallback(async(ie,Q)=>{const{error:me}=await Zr.auth.signInWithPassword({email:ie,password:Q});if(me)throw me},[]),B=le.useCallback(async(ie,Q,me)=>{const{data:we,error:Ae}=await Zr.auth.signUp({email:ie,password:Q,options:{data:{username:me}}});if(Ae)throw Ae;return we.user??null},[]),r=le.useCallback(async ie=>{const{error:Q}=await Zr.auth.signInWithOAuth({provider:ie,options:{redirectTo:`${window.location.origin}/`}});if(Q)throw Q},[]),q=le.useCallback(async()=>{const{error:ie}=await Zr.auth.signOut();if(ie)throw ie},[]),H=le.useCallback(async()=>{const{data:{session:ie},error:Q}=await Zr.auth.refreshSession();if(Q)throw Q;return ie},[]);return{...T,signInWithEmail:D,signUpWithEmail:B,signInWithOAuth:r,logout:q,refresh:H}}var Cw="focusScope.autoFocusOnMount",Iw="focusScope.autoFocusOnUnmount",TA={bubbles:!1,cancelable:!0},RN="FocusScope",U1=le.forwardRef((d,h)=>{const{loop:_=!1,trapped:T=!1,onMountAutoFocus:R,onUnmountAutoFocus:D,...B}=d,[r,q]=le.useState(null),H=kp(R),ie=kp(D),Q=le.useRef(null),me=xs(h,he=>q(he)),we=le.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;le.useEffect(()=>{if(T){let he=function(Ue){if(we.paused||!r)return;const rt=Ue.target;r.contains(rt)?Q.current=rt:Mp(Q.current,{select:!0})},Re=function(Ue){if(we.paused||!r)return;const rt=Ue.relatedTarget;rt!==null&&(r.contains(rt)||Mp(Q.current,{select:!0}))},Ne=function(Ue){if(document.activeElement===document.body)for(const Pt of Ue)Pt.removedNodes.length>0&&Mp(r)};document.addEventListener("focusin",he),document.addEventListener("focusout",Re);const Ge=new MutationObserver(Ne);return r&&Ge.observe(r,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",he),document.removeEventListener("focusout",Re),Ge.disconnect()}}},[T,r,we.paused]),le.useEffect(()=>{if(r){EA.add(we);const he=document.activeElement;if(!r.contains(he)){const Ne=new CustomEvent(Cw,TA);r.addEventListener(Cw,H),r.dispatchEvent(Ne),Ne.defaultPrevented||(MN(LN(TI(r)),{select:!0}),document.activeElement===he&&Mp(r))}return()=>{r.removeEventListener(Cw,H),setTimeout(()=>{const Ne=new CustomEvent(Iw,TA);r.addEventListener(Iw,ie),r.dispatchEvent(Ne),Ne.defaultPrevented||Mp(he??document.body,{select:!0}),r.removeEventListener(Iw,ie),EA.remove(we)},0)}}},[r,H,ie,we]);const Ae=le.useCallback(he=>{if(!_&&!T||we.paused)return;const Re=he.key==="Tab"&&!he.altKey&&!he.ctrlKey&&!he.metaKey,Ne=document.activeElement;if(Re&&Ne){const Ge=he.currentTarget,[Ue,rt]=DN(Ge);Ue&&rt?!he.shiftKey&&Ne===rt?(he.preventDefault(),_&&Mp(Ue,{select:!0})):he.shiftKey&&Ne===Ue&&(he.preventDefault(),_&&Mp(rt,{select:!0})):Ne===Ge&&he.preventDefault()}},[_,T,we.paused]);return ee.jsx(hr.div,{tabIndex:-1,...B,ref:me,onKeyDown:Ae})});U1.displayName=RN;function MN(d,{select:h=!1}={}){const _=document.activeElement;for(const T of d)if(Mp(T,{select:h}),document.activeElement!==_)return}function DN(d){const h=TI(d),_=SA(h,d),T=SA(h.reverse(),d);return[_,T]}function TI(d){const h=[],_=document.createTreeWalker(d,NodeFilter.SHOW_ELEMENT,{acceptNode:T=>{const R=T.tagName==="INPUT"&&T.type==="hidden";return T.disabled||T.hidden||R?NodeFilter.FILTER_SKIP:T.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;_.nextNode();)h.push(_.currentNode);return h}function SA(d,h){for(const _ of d)if(!ON(_,{upTo:h}))return _}function ON(d,{upTo:h}){if(getComputedStyle(d).visibility==="hidden")return!0;for(;d;){if(h!==void 0&&d===h)return!1;if(getComputedStyle(d).display==="none")return!0;d=d.parentElement}return!1}function PN(d){return d instanceof HTMLInputElement&&"select"in d}function Mp(d,{select:h=!1}={}){if(d&&d.focus){const _=document.activeElement;d.focus({preventScroll:!0}),d!==_&&PN(d)&&h&&d.select()}}var EA=zN();function zN(){let d=[];return{add(h){const _=d[0];h!==_&&_?.pause(),d=AA(d,h),d.unshift(h)},remove(h){d=AA(d,h),d[0]?.resume()}}}function AA(d,h){const _=[...d],T=_.indexOf(h);return T!==-1&&_.splice(T,1),_}function LN(d){return d.filter(h=>h.tagName!=="A")}var Rw=0;function SI(){le.useEffect(()=>{const d=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",d[0]??CA()),document.body.insertAdjacentElement("beforeend",d[1]??CA()),Rw++,()=>{Rw===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(h=>h.remove()),Rw--}},[])}function CA(){const d=document.createElement("span");return d.setAttribute("data-radix-focus-guard",""),d.tabIndex=0,d.style.outline="none",d.style.opacity="0",d.style.position="fixed",d.style.pointerEvents="none",d}var sx="right-scroll-bar-position",ox="width-before-scroll-bar",kN="with-scroll-bars-hidden",BN="--removed-body-scroll-bar-size";function Mw(d,h){return typeof d=="function"?d(h):d&&(d.current=h),d}function FN(d,h){var _=le.useState(function(){return{value:d,callback:h,facade:{get current(){return _.value},set current(T){var R=_.value;R!==T&&(_.value=T,_.callback(T,R))}}}})[0];return _.callback=h,_.facade}var NN=typeof window<"u"?le.useLayoutEffect:le.useEffect,IA=new WeakMap;function jN(d,h){var _=FN(null,function(T){return d.forEach(function(R){return Mw(R,T)})});return NN(function(){var T=IA.get(_);if(T){var R=new Set(T),D=new Set(d),B=_.current;R.forEach(function(r){D.has(r)||Mw(r,null)}),D.forEach(function(r){R.has(r)||Mw(r,B)})}IA.set(_,d)},[d]),_}function UN(d){return d}function VN(d,h){h===void 0&&(h=UN);var _=[],T=!1,R={read:function(){if(T)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return _.length?_[_.length-1]:d},useMedium:function(D){var B=h(D,T);return _.push(B),function(){_=_.filter(function(r){return r!==B})}},assignSyncMedium:function(D){for(T=!0;_.length;){var B=_;_=[],B.forEach(D)}_={push:function(r){return D(r)},filter:function(){return _}}},assignMedium:function(D){T=!0;var B=[];if(_.length){var r=_;_=[],r.forEach(D),B=_}var q=function(){var ie=B;B=[],ie.forEach(D)},H=function(){return Promise.resolve().then(q)};H(),_={push:function(ie){B.push(ie),H()},filter:function(ie){return B=B.filter(ie),_}}}};return R}function GN(d){d===void 0&&(d={});var h=VN(null);return h.options=od({async:!0,ssr:!1},d),h}var EI=function(d){var h=d.sideCar,_=W_(d,["sideCar"]);if(!h)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var T=h.read();if(!T)throw new Error("Sidecar medium not found");return le.createElement(T,od({},_))};EI.isSideCarExport=!0;function qN(d,h){return d.useMedium(h),EI}var AI=GN(),Dw=function(){},Bx=le.forwardRef(function(d,h){var _=le.useRef(null),T=le.useState({onScrollCapture:Dw,onWheelCapture:Dw,onTouchMoveCapture:Dw}),R=T[0],D=T[1],B=d.forwardProps,r=d.children,q=d.className,H=d.removeScrollBar,ie=d.enabled,Q=d.shards,me=d.sideCar,we=d.noRelative,Ae=d.noIsolation,he=d.inert,Re=d.allowPinchZoom,Ne=d.as,Ge=Ne===void 0?"div":Ne,Ue=d.gapMode,rt=W_(d,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Pt=me,Bt=jN([_,h]),Tt=od(od({},rt),R);return le.createElement(le.Fragment,null,ie&&le.createElement(Pt,{sideCar:AI,removeScrollBar:H,shards:Q,noRelative:we,noIsolation:Ae,inert:he,setCallbacks:D,allowPinchZoom:!!Re,lockRef:_,gapMode:Ue}),B?le.cloneElement(le.Children.only(r),od(od({},Tt),{ref:Bt})):le.createElement(Ge,od({},Tt,{className:q,ref:Bt}),r))});Bx.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Bx.classNames={fullWidth:ox,zeroRight:sx};var HN=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function $N(){if(!document)return null;var d=document.createElement("style");d.type="text/css";var h=HN();return h&&d.setAttribute("nonce",h),d}function ZN(d,h){d.styleSheet?d.styleSheet.cssText=h:d.appendChild(document.createTextNode(h))}function WN(d){var h=document.head||document.getElementsByTagName("head")[0];h.appendChild(d)}var XN=function(){var d=0,h=null;return{add:function(_){d==0&&(h=$N())&&(ZN(h,_),WN(h)),d++},remove:function(){d--,!d&&h&&(h.parentNode&&h.parentNode.removeChild(h),h=null)}}},YN=function(){var d=XN();return function(h,_){le.useEffect(function(){return d.add(h),function(){d.remove()}},[h&&_])}},CI=function(){var d=YN(),h=function(_){var T=_.styles,R=_.dynamic;return d(T,R),null};return h},KN={left:0,top:0,right:0,gap:0},Ow=function(d){return parseInt(d||"",10)||0},JN=function(d){var h=window.getComputedStyle(document.body),_=h[d==="padding"?"paddingLeft":"marginLeft"],T=h[d==="padding"?"paddingTop":"marginTop"],R=h[d==="padding"?"paddingRight":"marginRight"];return[Ow(_),Ow(T),Ow(R)]},QN=function(d){if(d===void 0&&(d="margin"),typeof window>"u")return KN;var h=JN(d),_=document.documentElement.clientWidth,T=window.innerWidth;return{left:h[0],top:h[1],right:h[2],gap:Math.max(0,T-_+h[2]-h[0])}},e5=CI(),B_="data-scroll-locked",t5=function(d,h,_,T){var R=d.left,D=d.top,B=d.right,r=d.gap;return _===void 0&&(_="margin"),`
  .`.concat(kN,` {
   overflow: hidden `).concat(T,`;
   padding-right: `).concat(r,"px ").concat(T,`;
  }
  body[`).concat(B_,`] {
    overflow: hidden `).concat(T,`;
    overscroll-behavior: contain;
    `).concat([h&&"position: relative ".concat(T,";"),_==="margin"&&`
    padding-left: `.concat(R,`px;
    padding-top: `).concat(D,`px;
    padding-right: `).concat(B,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(r,"px ").concat(T,`;
    `),_==="padding"&&"padding-right: ".concat(r,"px ").concat(T,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(sx,` {
    right: `).concat(r,"px ").concat(T,`;
  }
  
  .`).concat(ox,` {
    margin-right: `).concat(r,"px ").concat(T,`;
  }
  
  .`).concat(sx," .").concat(sx,` {
    right: 0 `).concat(T,`;
  }
  
  .`).concat(ox," .").concat(ox,` {
    margin-right: 0 `).concat(T,`;
  }
  
  body[`).concat(B_,`] {
    `).concat(BN,": ").concat(r,`px;
  }
`)},RA=function(){var d=parseInt(document.body.getAttribute(B_)||"0",10);return isFinite(d)?d:0},i5=function(){le.useEffect(function(){return document.body.setAttribute(B_,(RA()+1).toString()),function(){var d=RA()-1;d<=0?document.body.removeAttribute(B_):document.body.setAttribute(B_,d.toString())}},[])},n5=function(d){var h=d.noRelative,_=d.noImportant,T=d.gapMode,R=T===void 0?"margin":T;i5();var D=le.useMemo(function(){return QN(R)},[R]);return le.createElement(e5,{styles:t5(D,!h,R,_?"":"!important")})},a1=!1;if(typeof window<"u")try{var Y0=Object.defineProperty({},"passive",{get:function(){return a1=!0,!0}});window.addEventListener("test",Y0,Y0),window.removeEventListener("test",Y0,Y0)}catch{a1=!1}var C_=a1?{passive:!1}:!1,r5=function(d){return d.tagName==="TEXTAREA"},II=function(d,h){if(!(d instanceof Element))return!1;var _=window.getComputedStyle(d);return _[h]!=="hidden"&&!(_.overflowY===_.overflowX&&!r5(d)&&_[h]==="visible")},s5=function(d){return II(d,"overflowY")},o5=function(d){return II(d,"overflowX")},MA=function(d,h){var _=h.ownerDocument,T=h;do{typeof ShadowRoot<"u"&&T instanceof ShadowRoot&&(T=T.host);var R=RI(d,T);if(R){var D=MI(d,T),B=D[1],r=D[2];if(B>r)return!0}T=T.parentNode}while(T&&T!==_.body);return!1},a5=function(d){var h=d.scrollTop,_=d.scrollHeight,T=d.clientHeight;return[h,_,T]},l5=function(d){var h=d.scrollLeft,_=d.scrollWidth,T=d.clientWidth;return[h,_,T]},RI=function(d,h){return d==="v"?s5(h):o5(h)},MI=function(d,h){return d==="v"?a5(h):l5(h)},c5=function(d,h){return d==="h"&&h==="rtl"?-1:1},u5=function(d,h,_,T,R){var D=c5(d,window.getComputedStyle(h).direction),B=D*T,r=_.target,q=h.contains(r),H=!1,ie=B>0,Q=0,me=0;do{if(!r)break;var we=MI(d,r),Ae=we[0],he=we[1],Re=we[2],Ne=he-Re-D*Ae;(Ae||Ne)&&RI(d,r)&&(Q+=Ne,me+=Ae);var Ge=r.parentNode;r=Ge&&Ge.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Ge.host:Ge}while(!q&&r!==document.body||q&&(h.contains(r)||h===r));return(ie&&Math.abs(Q)<1||!ie&&Math.abs(me)<1)&&(H=!0),H},K0=function(d){return"changedTouches"in d?[d.changedTouches[0].clientX,d.changedTouches[0].clientY]:[0,0]},DA=function(d){return[d.deltaX,d.deltaY]},OA=function(d){return d&&"current"in d?d.current:d},h5=function(d,h){return d[0]===h[0]&&d[1]===h[1]},d5=function(d){return`
  .block-interactivity-`.concat(d,` {pointer-events: none;}
  .allow-interactivity-`).concat(d,` {pointer-events: all;}
`)},f5=0,I_=[];function p5(d){var h=le.useRef([]),_=le.useRef([0,0]),T=le.useRef(),R=le.useState(f5++)[0],D=le.useState(CI)[0],B=le.useRef(d);le.useEffect(function(){B.current=d},[d]),le.useEffect(function(){if(d.inert){document.body.classList.add("block-interactivity-".concat(R));var he=X3([d.lockRef.current],(d.shards||[]).map(OA),!0).filter(Boolean);return he.forEach(function(Re){return Re.classList.add("allow-interactivity-".concat(R))}),function(){document.body.classList.remove("block-interactivity-".concat(R)),he.forEach(function(Re){return Re.classList.remove("allow-interactivity-".concat(R))})}}},[d.inert,d.lockRef.current,d.shards]);var r=le.useCallback(function(he,Re){if("touches"in he&&he.touches.length===2||he.type==="wheel"&&he.ctrlKey)return!B.current.allowPinchZoom;var Ne=K0(he),Ge=_.current,Ue="deltaX"in he?he.deltaX:Ge[0]-Ne[0],rt="deltaY"in he?he.deltaY:Ge[1]-Ne[1],Pt,Bt=he.target,Tt=Math.abs(Ue)>Math.abs(rt)?"h":"v";if("touches"in he&&Tt==="h"&&Bt.type==="range")return!1;var Ht=MA(Tt,Bt);if(!Ht)return!0;if(Ht?Pt=Tt:(Pt=Tt==="v"?"h":"v",Ht=MA(Tt,Bt)),!Ht)return!1;if(!T.current&&"changedTouches"in he&&(Ue||rt)&&(T.current=Pt),!Pt)return!0;var Ei=T.current||Pt;return u5(Ei,Re,he,Ei==="h"?Ue:rt)},[]),q=le.useCallback(function(he){var Re=he;if(!(!I_.length||I_[I_.length-1]!==D)){var Ne="deltaY"in Re?DA(Re):K0(Re),Ge=h.current.filter(function(Pt){return Pt.name===Re.type&&(Pt.target===Re.target||Re.target===Pt.shadowParent)&&h5(Pt.delta,Ne)})[0];if(Ge&&Ge.should){Re.cancelable&&Re.preventDefault();return}if(!Ge){var Ue=(B.current.shards||[]).map(OA).filter(Boolean).filter(function(Pt){return Pt.contains(Re.target)}),rt=Ue.length>0?r(Re,Ue[0]):!B.current.noIsolation;rt&&Re.cancelable&&Re.preventDefault()}}},[]),H=le.useCallback(function(he,Re,Ne,Ge){var Ue={name:he,delta:Re,target:Ne,should:Ge,shadowParent:m5(Ne)};h.current.push(Ue),setTimeout(function(){h.current=h.current.filter(function(rt){return rt!==Ue})},1)},[]),ie=le.useCallback(function(he){_.current=K0(he),T.current=void 0},[]),Q=le.useCallback(function(he){H(he.type,DA(he),he.target,r(he,d.lockRef.current))},[]),me=le.useCallback(function(he){H(he.type,K0(he),he.target,r(he,d.lockRef.current))},[]);le.useEffect(function(){return I_.push(D),d.setCallbacks({onScrollCapture:Q,onWheelCapture:Q,onTouchMoveCapture:me}),document.addEventListener("wheel",q,C_),document.addEventListener("touchmove",q,C_),document.addEventListener("touchstart",ie,C_),function(){I_=I_.filter(function(he){return he!==D}),document.removeEventListener("wheel",q,C_),document.removeEventListener("touchmove",q,C_),document.removeEventListener("touchstart",ie,C_)}},[]);var we=d.removeScrollBar,Ae=d.inert;return le.createElement(le.Fragment,null,Ae?le.createElement(D,{styles:d5(R)}):null,we?le.createElement(n5,{noRelative:d.noRelative,gapMode:d.gapMode}):null)}function m5(d){for(var h=null;d!==null;)d instanceof ShadowRoot&&(h=d.host,d=d.host),d=d.parentNode;return h}const g5=qN(AI,p5);var V1=le.forwardRef(function(d,h){return le.createElement(Bx,od({},d,{ref:h,sideCar:g5}))});V1.classNames=Bx.classNames;var _5=function(d){if(typeof document>"u")return null;var h=Array.isArray(d)?d[0]:d;return h.ownerDocument.body},R_=new WeakMap,J0=new WeakMap,Q0={},Pw=0,DI=function(d){return d&&(d.host||DI(d.parentNode))},y5=function(d,h){return h.map(function(_){if(d.contains(_))return _;var T=DI(_);return T&&d.contains(T)?T:(console.error("aria-hidden",_,"in not contained inside",d,". Doing nothing"),null)}).filter(function(_){return!!_})},v5=function(d,h,_,T){var R=y5(h,Array.isArray(d)?d:[d]);Q0[_]||(Q0[_]=new WeakMap);var D=Q0[_],B=[],r=new Set,q=new Set(R),H=function(Q){!Q||r.has(Q)||(r.add(Q),H(Q.parentNode))};R.forEach(H);var ie=function(Q){!Q||q.has(Q)||Array.prototype.forEach.call(Q.children,function(me){if(r.has(me))ie(me);else try{var we=me.getAttribute(T),Ae=we!==null&&we!=="false",he=(R_.get(me)||0)+1,Re=(D.get(me)||0)+1;R_.set(me,he),D.set(me,Re),B.push(me),he===1&&Ae&&J0.set(me,!0),Re===1&&me.setAttribute(_,"true"),Ae||me.setAttribute(T,"true")}catch(Ne){console.error("aria-hidden: cannot operate on ",me,Ne)}})};return ie(h),r.clear(),Pw++,function(){B.forEach(function(Q){var me=R_.get(Q)-1,we=D.get(Q)-1;R_.set(Q,me),D.set(Q,we),me||(J0.has(Q)||Q.removeAttribute(T),J0.delete(Q)),we||Q.removeAttribute(_)}),Pw--,Pw||(R_=new WeakMap,R_=new WeakMap,J0=new WeakMap,Q0={})}},OI=function(d,h,_){_===void 0&&(_="data-aria-hidden");var T=Array.from(Array.isArray(d)?d:[d]),R=_5(d);return R?(T.push.apply(T,Array.from(R.querySelectorAll("[aria-live], script"))),v5(T,R,_,"aria-hidden")):function(){return null}},Fx="Dialog",[PI]=Np(Fx),[x5,nh]=PI(Fx),zI=d=>{const{__scopeDialog:h,children:_,open:T,defaultOpen:R,onOpenChange:D,modal:B=!0}=d,r=le.useRef(null),q=le.useRef(null),[H,ie]=px({prop:T,defaultProp:R??!1,onChange:D,caller:Fx});return ee.jsx(x5,{scope:h,triggerRef:r,contentRef:q,contentId:z_(),titleId:z_(),descriptionId:z_(),open:H,onOpenChange:ie,onOpenToggle:le.useCallback(()=>ie(Q=>!Q),[ie]),modal:B,children:_})};zI.displayName=Fx;var LI="DialogTrigger",kI=le.forwardRef((d,h)=>{const{__scopeDialog:_,...T}=d,R=nh(LI,_),D=xs(h,R.triggerRef);return ee.jsx(hr.button,{type:"button","aria-haspopup":"dialog","aria-expanded":R.open,"aria-controls":R.contentId,"data-state":H1(R.open),...T,ref:D,onClick:Rr(d.onClick,R.onOpenToggle)})});kI.displayName=LI;var G1="DialogPortal",[b5,BI]=PI(G1,{forceMount:void 0}),FI=d=>{const{__scopeDialog:h,forceMount:_,children:T,container:R}=d,D=nh(G1,h);return ee.jsx(b5,{scope:h,forceMount:_,children:le.Children.map(T,B=>ee.jsx(q_,{present:_||D.open,children:ee.jsx(R1,{asChild:!0,container:R,children:B})}))})};FI.displayName=G1;var vx="DialogOverlay",NI=le.forwardRef((d,h)=>{const _=BI(vx,d.__scopeDialog),{forceMount:T=_.forceMount,...R}=d,D=nh(vx,d.__scopeDialog);return D.modal?ee.jsx(q_,{present:T||D.open,children:ee.jsx(T5,{...R,ref:h})}):null});NI.displayName=vx;var w5=N_("DialogOverlay.RemoveScroll"),T5=le.forwardRef((d,h)=>{const{__scopeDialog:_,...T}=d,R=nh(vx,_);return ee.jsx(V1,{as:w5,allowPinchZoom:!0,shards:[R.contentRef],children:ee.jsx(hr.div,{"data-state":H1(R.open),...T,ref:h,style:{pointerEvents:"auto",...T.style}})})}),mg="DialogContent",jI=le.forwardRef((d,h)=>{const _=BI(mg,d.__scopeDialog),{forceMount:T=_.forceMount,...R}=d,D=nh(mg,d.__scopeDialog);return ee.jsx(q_,{present:T||D.open,children:D.modal?ee.jsx(S5,{...R,ref:h}):ee.jsx(E5,{...R,ref:h})})});jI.displayName=mg;var S5=le.forwardRef((d,h)=>{const _=nh(mg,d.__scopeDialog),T=le.useRef(null),R=xs(h,_.contentRef,T);return le.useEffect(()=>{const D=T.current;if(D)return OI(D)},[]),ee.jsx(UI,{...d,ref:R,trapFocus:_.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Rr(d.onCloseAutoFocus,D=>{D.preventDefault(),_.triggerRef.current?.focus()}),onPointerDownOutside:Rr(d.onPointerDownOutside,D=>{const B=D.detail.originalEvent,r=B.button===0&&B.ctrlKey===!0;(B.button===2||r)&&D.preventDefault()}),onFocusOutside:Rr(d.onFocusOutside,D=>D.preventDefault())})}),E5=le.forwardRef((d,h)=>{const _=nh(mg,d.__scopeDialog),T=le.useRef(!1),R=le.useRef(!1);return ee.jsx(UI,{...d,ref:h,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:D=>{d.onCloseAutoFocus?.(D),D.defaultPrevented||(T.current||_.triggerRef.current?.focus(),D.preventDefault()),T.current=!1,R.current=!1},onInteractOutside:D=>{d.onInteractOutside?.(D),D.defaultPrevented||(T.current=!0,D.detail.originalEvent.type==="pointerdown"&&(R.current=!0));const B=D.target;_.triggerRef.current?.contains(B)&&D.preventDefault(),D.detail.originalEvent.type==="focusin"&&R.current&&D.preventDefault()}})}),UI=le.forwardRef((d,h)=>{const{__scopeDialog:_,trapFocus:T,onOpenAutoFocus:R,onCloseAutoFocus:D,...B}=d,r=nh(mg,_),q=le.useRef(null),H=xs(h,q);return SI(),ee.jsxs(ee.Fragment,{children:[ee.jsx(U1,{asChild:!0,loop:!0,trapped:T,onMountAutoFocus:R,onUnmountAutoFocus:D,children:ee.jsx(Ax,{role:"dialog",id:r.contentId,"aria-describedby":r.descriptionId,"aria-labelledby":r.titleId,"data-state":H1(r.open),...B,ref:H,onDismiss:()=>r.onOpenChange(!1)})}),ee.jsxs(ee.Fragment,{children:[ee.jsx(A5,{titleId:r.titleId}),ee.jsx(I5,{contentRef:q,descriptionId:r.descriptionId})]})]})}),q1="DialogTitle",VI=le.forwardRef((d,h)=>{const{__scopeDialog:_,...T}=d,R=nh(q1,_);return ee.jsx(hr.h2,{id:R.titleId,...T,ref:h})});VI.displayName=q1;var GI="DialogDescription",qI=le.forwardRef((d,h)=>{const{__scopeDialog:_,...T}=d,R=nh(GI,_);return ee.jsx(hr.p,{id:R.descriptionId,...T,ref:h})});qI.displayName=GI;var HI="DialogClose",$I=le.forwardRef((d,h)=>{const{__scopeDialog:_,...T}=d,R=nh(HI,_);return ee.jsx(hr.button,{type:"button",...T,ref:h,onClick:Rr(d.onClick,()=>R.onOpenChange(!1))})});$I.displayName=HI;function H1(d){return d?"open":"closed"}var ZI="DialogTitleWarning",[N4,WI]=_z(ZI,{contentName:mg,titleName:q1,docsSlug:"dialog"}),A5=({titleId:d})=>{const h=WI(ZI),_=`\`${h.contentName}\` requires a \`${h.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${h.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${h.docsSlug}`;return le.useEffect(()=>{d&&(document.getElementById(d)||console.error(_))},[_,d]),null},C5="DialogDescriptionWarning",I5=({contentRef:d,descriptionId:h})=>{const T=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${WI(C5).contentName}}.`;return le.useEffect(()=>{const R=d.current?.getAttribute("aria-describedby");h&&R&&(document.getElementById(h)||console.warn(T))},[T,d,h]),null},R5=zI,M5=kI,D5=FI,O5=NI,P5=jI,z5=VI,L5=qI,k5=$I;const XI=le.createContext({isComposing:()=>!1,setComposing:()=>{},justEndedComposing:()=>!1,markCompositionEnd:()=>{}}),YI=()=>le.useContext(XI);function cg({...d}){const h=le.useRef(!1),_=le.useRef(!1),T=le.useRef(null),R=le.useMemo(()=>({isComposing:()=>h.current,setComposing:D=>{h.current=D},justEndedComposing:()=>_.current,markCompositionEnd:()=>{_.current=!0,T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{_.current=!1},150)}}),[]);return ee.jsx(XI.Provider,{value:R,children:ee.jsx(R5,{"data-slot":"dialog",...d})})}function B5({...d}){return ee.jsx(M5,{"data-slot":"dialog-trigger",...d})}function F5({...d}){return ee.jsx(D5,{"data-slot":"dialog-portal",...d})}function KI({className:d,...h}){return ee.jsx(O5,{"data-slot":"dialog-overlay",className:bs("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",d),...h})}KI.displayName="DialogOverlay";function ug({className:d,children:h,showCloseButton:_=!0,onEscapeKeyDown:T,...R}){const{isComposing:D}=YI(),B=le.useCallback(r=>{if(r.isComposing||D()){r.preventDefault();return}T?.(r)},[D,T]);return ee.jsxs(F5,{"data-slot":"dialog-portal",children:[ee.jsx(KI,{}),ee.jsxs(P5,{"data-slot":"dialog-content",className:bs("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",d),onEscapeKeyDown:B,...R,children:[h,_&&ee.jsxs(k5,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[ee.jsx(YC,{}),ee.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function hg({className:d,...h}){return ee.jsx("div",{"data-slot":"dialog-header",className:bs("flex flex-col gap-2 text-center sm:text-left",d),...h})}function JI({className:d,...h}){return ee.jsx("div",{"data-slot":"dialog-footer",className:bs("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",d),...h})}function dg({className:d,...h}){return ee.jsx(z5,{"data-slot":"dialog-title",className:bs("text-lg leading-none font-semibold",d),...h})}function fg({className:d,...h}){return ee.jsx(L5,{"data-slot":"dialog-description",className:bs("text-muted-foreground text-sm",d),...h})}function ex(d){const h=le.useRef(d);h.current=d;const _=le.useRef(null);return _.current||(_.current=function(...T){return h.current.apply(this,T)}),_.current}function N5(d={}){const{onKeyDown:h,onCompositionStart:_,onCompositionEnd:T}=d,R=le.useRef(!1),D=le.useRef(null),B=le.useRef(null),r=ex(Q=>{D.current&&(clearTimeout(D.current),D.current=null),B.current&&(clearTimeout(B.current),B.current=null),R.current=!0,_?.(Q)}),q=ex(Q=>{D.current=setTimeout(()=>{B.current=setTimeout(()=>{R.current=!1})}),T?.(Q)}),H=ex(Q=>{if(R.current&&(Q.key==="Escape"||Q.key==="Enter"&&!Q.shiftKey)){Q.stopPropagation();return}h?.(Q)}),ie=ex(()=>R.current);return{onCompositionStart:r,onCompositionEnd:q,onKeyDown:H,isComposing:ie}}function ax({className:d,type:h,onKeyDown:_,onCompositionStart:T,onCompositionEnd:R,...D}){const B=YI(),{onCompositionStart:r,onCompositionEnd:q,onKeyDown:H}=N5({onKeyDown:ie=>{const Q=ie.nativeEvent.isComposing||B.justEndedComposing();ie.key==="Enter"&&Q||_?.(ie)},onCompositionStart:ie=>{B.setComposing(!0),T?.(ie)},onCompositionEnd:ie=>{B.markCompositionEnd(),setTimeout(()=>{B.setComposing(!1)},100),R?.(ie)}});return ee.jsx("input",{type:h,"data-slot":"input",className:bs("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",d),onCompositionStart:r,onCompositionEnd:q,onKeyDown:H,...D})}var j5="Label",QI=le.forwardRef((d,h)=>ee.jsx(hr.label,{...d,ref:h,onMouseDown:_=>{_.target.closest("button, input, select, textarea")||(d.onMouseDown?.(_),!_.defaultPrevented&&_.detail>1&&_.preventDefault())}}));QI.displayName=j5;var U5=QI;function zw({className:d,...h}){return ee.jsx(U5,{"data-slot":"label",className:bs("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",d),...h})}function V5(){const{signInWithEmail:d,signUpWithEmail:h,loading:_,isAuthenticated:T}=hd(),[,R]=zx(),[D,B]=le.useState(""),[r,q]=le.useState(""),[H,ie]=le.useState(""),[Q,me]=le.useState(!1),[we,Ae]=le.useState(null),[he,Re]=le.useState(!1);if(T)return R("/"),null;const Ne=async Ge=>{Ge.preventDefault(),Ae(null),Re(!0);try{if(Q){if(!H.trim()){Ae("Username is required"),Re(!1);return}await h(D,r,H)}else await d(D,r);R("/")}catch(Ue){Ae(Ue instanceof Error?Ue.message:"Authentication failed")}finally{Re(!1)}};return ee.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:ee.jsxs("div",{className:"w-full max-w-sm space-y-6",children:[ee.jsxs("div",{className:"text-center space-y-2",children:[ee.jsx("h1",{className:"text-3xl font-bold",children:"The Snail"}),ee.jsx("p",{className:"text-muted-foreground",children:Q?"Create your account":"Welcome back"})]}),ee.jsxs("form",{onSubmit:Ne,className:"space-y-4",children:[Q&&ee.jsxs("div",{className:"space-y-2",children:[ee.jsx(zw,{htmlFor:"username",children:"Username"}),ee.jsx(ax,{id:"username",type:"text",placeholder:"snailmaster42",value:H,onChange:Ge=>ie(Ge.target.value),required:Q,disabled:he})]}),ee.jsxs("div",{className:"space-y-2",children:[ee.jsx(zw,{htmlFor:"email",children:"Email"}),ee.jsx(ax,{id:"email",type:"email",placeholder:"you@example.com",value:D,onChange:Ge=>B(Ge.target.value),required:!0,disabled:he})]}),ee.jsxs("div",{className:"space-y-2",children:[ee.jsx(zw,{htmlFor:"password",children:"Password"}),ee.jsx(ax,{id:"password",type:"password",placeholder:"",value:r,onChange:Ge=>q(Ge.target.value),required:!0,minLength:6,disabled:he})]}),we&&ee.jsx("p",{className:"text-sm text-destructive text-center",children:we}),ee.jsx(Us,{type:"submit",className:"w-full",disabled:_||he,children:he?"Loading...":Q?"Create Account":"Sign In"})]}),ee.jsx("div",{className:"text-center",children:ee.jsx("button",{type:"button",onClick:()=>{me(!Q),Ae(null)},className:"text-sm text-muted-foreground hover:text-foreground underline",disabled:he,children:Q?"Already have an account? Sign In":"Don't have an account? Sign Up"})})]})})}class G5 extends le.Component{constructor(h){super(h),this.state={hasError:!1,error:null}}static getDerivedStateFromError(h){return{hasError:!0,error:h}}render(){return this.state.hasError?ee.jsx("div",{className:"flex items-center justify-center min-h-screen p-8 bg-background",children:ee.jsxs("div",{className:"flex flex-col items-center w-full max-w-2xl p-8",children:[ee.jsx(S3,{size:48,className:"text-destructive mb-6 flex-shrink-0"}),ee.jsx("h2",{className:"text-xl mb-4",children:"An unexpected error occurred."}),ee.jsx("div",{className:"p-4 w-full rounded bg-muted overflow-auto mb-6",children:ee.jsx("pre",{className:"text-sm text-muted-foreground whitespace-break-spaces",children:this.state.error?.stack})}),ee.jsxs("button",{onClick:()=>window.location.reload(),className:bs("flex items-center gap-2 px-4 py-2 rounded-lg","bg-primary text-primary-foreground","hover:opacity-90 cursor-pointer"),children:[ee.jsx(w3,{size:16}),"Reload Page"]})]})}):this.props.children}}const q5=le.createContext(void 0);function H5({children:d,defaultTheme:h="light",switchable:_=!1}){const[T,R]=le.useState(()=>_&&localStorage.getItem("theme")||h);le.useEffect(()=>{const B=document.documentElement;T==="dark"?B.classList.add("dark"):B.classList.remove("dark"),_&&localStorage.setItem("theme",T)},[T,_]);const D=_?()=>{R(B=>B==="light"?"dark":"light")}:void 0;return ee.jsx(q5.Provider,{value:{theme:T,toggleTheme:D,switchable:_},children:d})}var lx={exports:{}},$5=lx.exports,PA;function Z5(){return PA||(PA=1,(function(d,h){(function(_,T){d.exports=T()})($5,(function(){var _,T,R;function D(r,q){if(!_)_=q;else if(!T)T=q;else{var H="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+_+")(sharedChunk); ("+T+")(sharedChunk); self.onerror = null;",ie={};_(ie),R=q(ie),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(R.workerUrl=window.URL.createObjectURL(new Blob([H],{type:"text/javascript"})))}}D(["exports"],function(r){var q=1e-6,H=typeof Float32Array<"u"?Float32Array:Array;function ie(n,e){var i=e[0],s=e[1],a=e[2],f=e[3],m=i*f-a*s;return m?(n[0]=f*(m=1/m),n[1]=-s*m,n[2]=-a*m,n[3]=i*m,n):null}function Q(){var n=new H(9);return H!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function me(n,e){var i=e[0],s=e[1],a=e[2],f=e[3],m=e[4],y=e[5],w=e[6],S=e[7],I=e[8];return n[0]=m*I-y*S,n[1]=a*S-s*I,n[2]=s*y-a*m,n[3]=y*w-f*I,n[4]=i*I-a*w,n[5]=a*f-i*y,n[6]=f*S-m*w,n[7]=s*w-i*S,n[8]=i*m-s*f,n}function we(n,e,i){var s=e[0],a=e[1],f=e[2],m=e[3],y=e[4],w=e[5],S=e[6],I=e[7],M=e[8],O=i[0],L=i[1],F=i[2],G=i[3],W=i[4],$=i[5],K=i[6],te=i[7],se=i[8];return n[0]=O*s+L*m+F*S,n[1]=O*a+L*y+F*I,n[2]=O*f+L*w+F*M,n[3]=G*s+W*m+$*S,n[4]=G*a+W*y+$*I,n[5]=G*f+W*w+$*M,n[6]=K*s+te*m+se*S,n[7]=K*a+te*y+se*I,n[8]=K*f+te*w+se*M,n}function Ae(){var n=new H(16);return H!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function he(n){var e=new H(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function Re(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ne(n,e){var i=e[0],s=e[1],a=e[2],f=e[3],m=e[4],y=e[5],w=e[6],S=e[7],I=e[8],M=e[9],O=e[10],L=e[11],F=e[12],G=e[13],W=e[14],$=e[15],K=i*y-s*m,te=i*w-a*m,se=i*S-f*m,pe=s*w-a*y,de=s*S-f*y,be=a*S-f*w,Te=I*G-M*F,ve=I*W-O*F,Ce=I*$-L*F,ze=M*W-O*G,it=M*$-L*G,Je=O*$-L*W,tt=K*Je-te*it+se*ze+pe*Ce-de*ve+be*Te;return tt?(n[0]=(y*Je-w*it+S*ze)*(tt=1/tt),n[1]=(a*it-s*Je-f*ze)*tt,n[2]=(G*be-W*de+$*pe)*tt,n[3]=(O*de-M*be-L*pe)*tt,n[4]=(w*Ce-m*Je-S*ve)*tt,n[5]=(i*Je-a*Ce+f*ve)*tt,n[6]=(W*se-F*be-$*te)*tt,n[7]=(I*be-O*se+L*te)*tt,n[8]=(m*it-y*Ce+S*Te)*tt,n[9]=(s*Ce-i*it-f*Te)*tt,n[10]=(F*de-G*se+$*K)*tt,n[11]=(M*se-I*de-L*K)*tt,n[12]=(y*ve-m*ze-w*Te)*tt,n[13]=(i*ze-s*ve+a*Te)*tt,n[14]=(G*te-F*pe-W*K)*tt,n[15]=(I*pe-M*te+O*K)*tt,n):null}function Ge(n,e,i){var s=e[0],a=e[1],f=e[2],m=e[3],y=e[4],w=e[5],S=e[6],I=e[7],M=e[8],O=e[9],L=e[10],F=e[11],G=e[12],W=e[13],$=e[14],K=e[15],te=i[0],se=i[1],pe=i[2],de=i[3];return n[0]=te*s+se*y+pe*M+de*G,n[1]=te*a+se*w+pe*O+de*W,n[2]=te*f+se*S+pe*L+de*$,n[3]=te*m+se*I+pe*F+de*K,n[4]=(te=i[4])*s+(se=i[5])*y+(pe=i[6])*M+(de=i[7])*G,n[5]=te*a+se*w+pe*O+de*W,n[6]=te*f+se*S+pe*L+de*$,n[7]=te*m+se*I+pe*F+de*K,n[8]=(te=i[8])*s+(se=i[9])*y+(pe=i[10])*M+(de=i[11])*G,n[9]=te*a+se*w+pe*O+de*W,n[10]=te*f+se*S+pe*L+de*$,n[11]=te*m+se*I+pe*F+de*K,n[12]=(te=i[12])*s+(se=i[13])*y+(pe=i[14])*M+(de=i[15])*G,n[13]=te*a+se*w+pe*O+de*W,n[14]=te*f+se*S+pe*L+de*$,n[15]=te*m+se*I+pe*F+de*K,n}function Ue(n,e,i){var s,a,f,m,y,w,S,I,M,O,L,F,G=i[0],W=i[1],$=i[2];return e===n?(n[12]=e[0]*G+e[4]*W+e[8]*$+e[12],n[13]=e[1]*G+e[5]*W+e[9]*$+e[13],n[14]=e[2]*G+e[6]*W+e[10]*$+e[14],n[15]=e[3]*G+e[7]*W+e[11]*$+e[15]):(a=e[1],f=e[2],m=e[3],y=e[4],w=e[5],S=e[6],I=e[7],M=e[8],O=e[9],L=e[10],F=e[11],n[0]=s=e[0],n[1]=a,n[2]=f,n[3]=m,n[4]=y,n[5]=w,n[6]=S,n[7]=I,n[8]=M,n[9]=O,n[10]=L,n[11]=F,n[12]=s*G+y*W+M*$+e[12],n[13]=a*G+w*W+O*$+e[13],n[14]=f*G+S*W+L*$+e[14],n[15]=m*G+I*W+F*$+e[15]),n}function rt(n,e,i){var s=i[0],a=i[1],f=i[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*a,n[5]=e[5]*a,n[6]=e[6]*a,n[7]=e[7]*a,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Pt(n,e,i){var s=Math.sin(i),a=Math.cos(i),f=e[4],m=e[5],y=e[6],w=e[7],S=e[8],I=e[9],M=e[10],O=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*a+S*s,n[5]=m*a+I*s,n[6]=y*a+M*s,n[7]=w*a+O*s,n[8]=S*a-f*s,n[9]=I*a-m*s,n[10]=M*a-y*s,n[11]=O*a-w*s,n}function Bt(n,e,i){var s=Math.sin(i),a=Math.cos(i),f=e[0],m=e[1],y=e[2],w=e[3],S=e[8],I=e[9],M=e[10],O=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*a-S*s,n[1]=m*a-I*s,n[2]=y*a-M*s,n[3]=w*a-O*s,n[8]=f*s+S*a,n[9]=m*s+I*a,n[10]=y*s+M*a,n[11]=w*s+O*a,n}function Tt(n,e,i){var s=Math.sin(i),a=Math.cos(i),f=e[0],m=e[1],y=e[2],w=e[3],S=e[4],I=e[5],M=e[6],O=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*a+S*s,n[1]=m*a+I*s,n[2]=y*a+M*s,n[3]=w*a+O*s,n[4]=S*a-f*s,n[5]=I*a-m*s,n[6]=M*a-y*s,n[7]=O*a-w*s,n}function Ht(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ei(n,e,i){var s,a,f,m=i[0],y=i[1],w=i[2],S=Math.sqrt(m*m+y*y+w*w);return S<q?null:(m*=S=1/S,y*=S,w*=S,s=Math.sin(e),a=Math.cos(e),n[0]=m*m*(f=1-a)+a,n[1]=y*m*f+w*s,n[2]=w*m*f-y*s,n[3]=0,n[4]=m*y*f-w*s,n[5]=y*y*f+a,n[6]=w*y*f+m*s,n[7]=0,n[8]=m*w*f+y*s,n[9]=y*w*f-m*s,n[10]=w*w*f+a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function rn(n,e){var i=e[0],s=e[1],a=e[2],f=e[4],m=e[5],y=e[6],w=e[8],S=e[9],I=e[10];return n[0]=Math.sqrt(i*i+s*s+a*a),n[1]=Math.sqrt(f*f+m*m+y*y),n[2]=Math.sqrt(w*w+S*S+I*I),n}function en(n,e){var i=e[0],s=e[1],a=e[2],f=e[3],m=i+i,y=s+s,w=a+a,S=i*m,I=s*m,M=s*y,O=a*m,L=a*y,F=a*w,G=f*m,W=f*y,$=f*w;return n[0]=1-M-F,n[1]=I+$,n[2]=O-W,n[3]=0,n[4]=I-$,n[5]=1-S-F,n[6]=L+G,n[7]=0,n[8]=O+W,n[9]=L-G,n[10]=1-S-M,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}var Ui=Ge;function si(){var n=new H(3);return H!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Ji(n){var e=new H(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Si(n){var e=n[0],i=n[1],s=n[2];return Math.sqrt(e*e+i*i+s*s)}function Xe(n,e,i){var s=new H(3);return s[0]=n,s[1]=e,s[2]=i,s}function gt(n,e,i,s){return n[0]=e,n[1]=i,n[2]=s,n}function yt(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function mi(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function Ci(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Fe(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function wt(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function bt(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Gt(n,e,i,s){return n[0]=e[0]+i[0]*s,n[1]=e[1]+i[1]*s,n[2]=e[2]+i[2]*s,n}function ci(n,e){var i=e[0]-n[0],s=e[1]-n[1],a=e[2]-n[2];return Math.sqrt(i*i+s*s+a*a)}function Bi(n,e){var i=e[0]-n[0],s=e[1]-n[1],a=e[2]-n[2];return i*i+s*s+a*a}function Qt(n){var e=n[0],i=n[1],s=n[2];return e*e+i*i+s*s}function Ii(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function fi(n,e){var i=e[0],s=e[1],a=e[2],f=i*i+s*s+a*a;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n}function Ri(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Fi(n,e,i){var s=e[0],a=e[1],f=e[2],m=i[0],y=i[1],w=i[2];return n[0]=a*w-f*y,n[1]=f*m-s*w,n[2]=s*y-a*m,n}function Oi(n,e,i,s){var a=e[0],f=e[1],m=e[2];return n[0]=a+s*(i[0]-a),n[1]=f+s*(i[1]-f),n[2]=m+s*(i[2]-m),n}function vn(n,e,i){var s=e[0],a=e[1],f=e[2],m=i[3]*s+i[7]*a+i[11]*f+i[15];return n[0]=(i[0]*s+i[4]*a+i[8]*f+i[12])/(m=m||1),n[1]=(i[1]*s+i[5]*a+i[9]*f+i[13])/m,n[2]=(i[2]*s+i[6]*a+i[10]*f+i[14])/m,n}function Mr(n,e,i){var s=e[0],a=e[1],f=e[2];return n[0]=s*i[0]+a*i[3]+f*i[6],n[1]=s*i[1]+a*i[4]+f*i[7],n[2]=s*i[2]+a*i[5]+f*i[8],n}function Vs(n,e,i){var s=i[0],a=i[1],f=i[2],m=i[3],y=e[0],w=e[1],S=e[2],I=a*S-f*w,M=f*y-s*S,O=s*w-a*y;return n[0]=y+m*(I+=I)+a*(O+=O)-f*(M+=M),n[1]=w+m*M+f*I-s*O,n[2]=S+m*O+s*M-a*I,n}function Gs(n){return n[0]=0,n[1]=0,n[2]=0,n}function Jr(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var Cn=mi,ws=Ci,Ts=Si;function Aa(){var n=new H(4);return H!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function _r(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function go(n,e){var i=e[0],s=e[1],a=e[2],f=e[3],m=i*i+s*s+a*a+f*f;return m>0&&(m=1/Math.sqrt(m)),n[0]=i*m,n[1]=s*m,n[2]=a*m,n[3]=f*m,n}function tr(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function Ss(n,e,i){var s=e[0],a=e[1],f=e[2],m=e[3];return n[0]=i[0]*s+i[4]*a+i[8]*f+i[12]*m,n[1]=i[1]*s+i[5]*a+i[9]*f+i[13]*m,n[2]=i[2]*s+i[6]*a+i[10]*f+i[14]*m,n[3]=i[3]*s+i[7]*a+i[11]*f+i[15]*m,n}function Ur(){var n=new H(4);return H!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Xo(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function io(n,e,i){i*=.5;var s=e[0],a=e[1],f=e[2],m=e[3],y=Math.sin(i),w=Math.cos(i);return n[0]=s*w+m*y,n[1]=a*w+f*y,n[2]=f*w-a*y,n[3]=m*w-s*y,n}function Co(n,e,i){i*=.5;var s=e[0],a=e[1],f=e[2],m=e[3],y=Math.sin(i),w=Math.cos(i);return n[0]=s*w-f*y,n[1]=a*w+m*y,n[2]=f*w+s*y,n[3]=m*w-a*y,n}si(),Aa();var Vr,Ps,Wr,Yo=go,$r=(Vr=si(),Ps=Xe(1,0,0),Wr=Xe(0,1,0),function(n,e,i){var s=Ri(e,i);return s<-.999999?(Fi(Vr,Ps,e),Ts(Vr)<1e-6&&Fi(Vr,Wr,e),fi(Vr,Vr),(function(a,f,m){m*=.5;var y=Math.sin(m);a[0]=y*f[0],a[1]=y*f[1],a[2]=y*f[2],a[3]=Math.cos(m)})(n,Vr,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Fi(Vr,e,i),n[0]=Vr[0],n[1]=Vr[1],n[2]=Vr[2],n[3]=1+s,Yo(n,n))});function yr(){var n=new H(2);return H!=Float32Array&&(n[0]=0,n[1]=0),n}function Gr(n,e){var i=new H(2);return i[0]=n,i[1]=e,i}function ha(n,e,i){return n[0]=e,n[1]=i,n}function Ko(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function Es(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function Io(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function Ro(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)}function Jo(n,e){var i=e[0],s=e[1],a=i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),n[0]=e[0]*a,n[1]=e[1]*a,n}function ot(n,e){return n[0]*e[0]+n[1]*e[1]}Ur(),Ur(),Q();var It,ui,Mn=Es;function In(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}yr();var Xr=(function(){if(ui)return It;function n(e,i,s,a){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(a-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=a}return ui=1,It=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,a=0;a<8;a++){var f=this.sampleCurveX(s)-e;if(Math.abs(f)<i)return s;var m=this.sampleCurveDerivativeX(s);if(Math.abs(m)<1e-6)break;s-=f/m}var y=0,w=1;for(s=e,a=0;a<20&&(f=this.sampleCurveX(s),!(Math.abs(f-e)<i));a++)e>f?y=s:w=s,s=.5*(w-y)+y;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},It})(),Gn=In(Xr);function pt(n,e){this.x=n,this.y=e}function Yn(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Yn(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!Yn(n[i],e[i]))return!1;return!0}return n===e}pt.prototype={clone(){return new pt(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround(n,e){const i=Math.cos(n),s=Math.sin(n),a=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=a,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:pt},pt.convert=function(n){if(n instanceof pt)return n;if(Array.isArray(n))return new pt(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new pt(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};const or=Math.PI/180,vr=180/Math.PI;function Ni(n){return n*or}function Le(n){return n*vr}const J=[[0,0],[1,0],[1,1],[0,1]];function re(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function ge(n,e,i,s){const a=new Gn(n,e,i,s);return function(f){return a.solve(f)}}const Me=ge(.25,.1,.25,1);function _e(n,e,i){return Math.min(i,Math.max(e,n))}function ke(n,e,i){return(i=_e((i-n)/(e-n),0,1))*i*(3-2*i)}function We(n,e,i){const s=i-e,a=((n-e)%s+s)%s+e;return a===e?i:a}function je(n,e,i){if(!n.length)return i(null,[]);let s=n.length;const a=new Array(n.length);let f=null;n.forEach((m,y)=>{e(m,(w,S)=>{w&&(f=w),a[y]=S,--s===0&&i(f,a)})})}let Ke=1;function At(){return Ke++}function vt(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log2(n)))}function Zt(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function oi(n,e,i){const s={};for(const a in n)s[a]=e.call(this,n[a],a,n);return s}function hi(n,e,i){const s={};for(const a in n)e.call(this,n[a],a,n)&&(s[a]=n[a]);return s}function Mi(n){return Array.isArray(n)?n.map(Mi):typeof n=="object"&&n?oi(n,Mi):n}function ji(n,e){for(let i=0;i<n.length;i++)if(e.indexOf(n[i])>=0)return!0;return!1}const li={};function bi(n){li[n]||(typeof console<"u"&&console.warn(n),li[n]=!0)}function jn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function xr(n){let e=0;for(let i,s,a=0,f=n.length,m=f-1;a<f;m=a++)i=n[a],s=n[m],e+=(s.x-i.x)*(i.y+s.y);return e}function Qn([n,e,i]){const s=Ni(e+90),a=Ni(i);return{x:n*Math.cos(s)*Math.sin(a),y:n*Math.sin(s)*Math.sin(a),z:n*Math.cos(a),azimuthal:e,polar:i}}function Cr(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Kn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,a,f)=>{const m=a||f;return e[s]=!m||m.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let sn=null;function ir(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function Dn(n,e,i,s){for(;e<i;){const a=e+i>>1;n[a]<s?e=a+1:i=a}return e}function On(n,e,i,s){for(;e<i;){const a=e+i>>1;n[a]<=s?e=a+1:i=a}return e}function Un(n){return n>0?1/(1.001-n):1+n}function br(n){return n>0?1-1/(1.001-n):-n}function hs(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Qr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Qr.API_URL)return null;try{const n=new URL(Qr.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function yl(n){return Qr.API_URL_REGEX.test(n)}function qs(n){return Qr.API_SPRITE_REGEX.test(n)}let no,Ca,rs,_o,ro,qa;function Ia(){return no==null&&(no=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),no}const Qo={now:()=>_o!==void 0?_o:performance.now(),setNow(n){_o=n},restoreNow(){_o=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:s}=n;ro||(ro=document.createElement("canvas"));const a=ro.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>ro.width||s>ro.height)&&(ro.width=i,ro.height=s),a.clearRect(-e,-e,i+2*e,s+2*e),a.drawImage(n,0,0,i,s),a.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:n=>(Ca||(Ca=document.createElement("a")),Ca.href=n,Ca.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(rs==null&&(rs=window.matchMedia("(prefers-reduced-motion: reduce)")),rs.matches)},hasCanvasFingerprintNoise(){if(qa!==void 0)return qa;if(!Ia())return qa=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let a=0;a<n.width;++a)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(a,0,1,1);const s=e.getImageData(0,0,n.width,n.height);i=0;for(let a=0;a<s.data.length;++a)if(a%4!=3&&i++!==s.data[a])return qa=!0,!0;return qa=!1,!1}};function rh(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(n.slice(i));for(const a in e)s.set(a,e[a]);return`${n.slice(0,i)}?${s.toString()}`}function vl(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const s=new URLSearchParams,a=new URLSearchParams(n.slice(i));for(const m of e.persistentParams){const y=a.get(m);y&&s.set(m,y)}const f=s.toString();return`${n.slice(0,i)}${f.length>0?`?${f}`:""}`}const yg="mapbox-tiles";let Vp=500,xf=50;const dd=["language","worldview","jobid"];let As,da;function Ra(){try{return caches}catch{}}function ds(){const n=Ra();n&&As==null&&(As=n.open(yg))}let Ma=1/0;const Ac={supported:!1,testSupport:function(n){!Gl&&Da&&(sh?oh(n):Ha=n)}};let Ha,Da,Gl=!1,sh=!1;const Gp=typeof self<"u"?self:{};function oh(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Da),n.isContextLost())return;Ac.supported=!0}catch{}n.deleteTexture(e),Gl=!0}Gp.document&&(Da=Gp.document.createElement("img"),Da.onload=function(){Ha&&oh(Ha),Ha=null,sh=!0},Da.onerror=function(){Gl=!0,Ha=null},Da.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const es={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(es);class su extends Error{constructor(e,i,s){i===401&&yl(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ql=Cr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,yo=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(ql())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(s,a){const f=new AbortController,m=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:ql(),referrerPolicy:s.referrerPolicy,signal:f.signal});let y=!1,w=!1;const S=(I=m.url).indexOf("sku=")>0&&yl(I);var I;s.type==="json"&&m.headers.set("Accept","application/json");const M=(L,F,G)=>{if(w)return;if(L&&L.message!=="SecurityError"&&bi(L.toString()),F&&G)return O(F);const W=Date.now();fetch(m).then($=>{if($.ok){const K=S?$.clone():null;return O($,K,W)}return a(new su($.statusText,$.status,s.url))}).catch($=>{$.name!=="AbortError"&&a(new Error(`${$.message} ${s.url}`))})},O=(L,F,G)=>{(s.type==="arrayBuffer"?L.arrayBuffer():s.type==="json"?L.json():L.text()).then(W=>{w||(F&&G&&(function($,K,te){if(ds(),As==null)return;const se=Kn(K.headers.get("Cache-Control")||"");if(se["no-store"])return;const pe={status:K.status,statusText:K.statusText,headers:new Headers};K.headers.forEach((Te,ve)=>pe.headers.set(ve,Te)),se["max-age"]&&pe.headers.set("Expires",new Date(te+1e3*se["max-age"]).toUTCString());const de=pe.headers.get("Expires");if(!de||new Date(de).getTime()-te<42e4)return;let be=vl($.url,{persistentParams:dd});if(K.status===206){const Te=$.headers.get("Range");if(!Te)return;pe.status=200,be=rh(be,{range:Te})}(function(Te,ve){if(da===void 0)try{new Response(new ReadableStream),da=!0}catch{da=!1}da?ve(Te.body):Te.blob().then(ve).catch(Ce=>bi(Ce.message))})(K,Te=>{const ve=new Response((Ce=K.status)!==200&&Ce!==404&&[101,103,204,205,304].includes(Ce)?null:Te,pe);var Ce;ds(),As?.then(ze=>ze.put(be,ve)).catch(ze=>bi(ze.message))})})(m,F,G),y=!0,a(null,W,L.headers))}).catch(W=>{w||a(new Error(W.message))})};return S?(function(L,F){if(ds(),As==null)return F(null);As.then(G=>{let W=vl(L.url,{persistentParams:dd});const $=L.headers.get("Range");$&&(W=rh(W,{range:$})),G.match(W).then(K=>{const te=(function(se){if(!se)return!1;const pe=new Date(se.headers.get("Expires")||0),de=Kn(se.headers.get("Cache-Control")||"");return Number(pe)>Date.now()&&!de["no-cache"]})(K);G.delete(W).catch(F),te&&G.put(W,K.clone()).catch(F),F(null,K,te)}).catch(F)}).catch(F)})(m,M):M(null,null),{cancel:()=>{w=!0,y||f.abort()}}})(n,e);if(Cr(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return(function(s,a){const f=new XMLHttpRequest;f.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const m in s.headers)f.setRequestHeader(m,s.headers[m]);return s.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=s.credentials==="include",f.onerror=()=>{a(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let m=f.response;if(s.type==="json")try{m=JSON.parse(f.response)}catch(w){return a(w)}const y=new Headers;f.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(w=>{const S=w.split(": "),I=S.shift(),M=S.join(": ");y.append(I,M)}),a(null,m,y)}else a(new su(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}})(n,e)},ou=function(n,e){return yo(Object.assign(n,{type:"arrayBuffer"}),e)};function bf(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const wf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let on,Hl;on=[],Hl=0;const fd=function(n,e){if(Ac.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Hl>=Qr.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return on.push(f),f}Hl++;let i=!1;const s=()=>{if(!i)for(i=!0,Hl--;on.length&&Hl<Qr.MAX_PARALLEL_IMAGE_REQUESTS;){const f=on.shift(),{requestParameters:m,callback:y,cancelled:w}=f;w||(f.cancel=fd(m,y).cancel)}},a=ou(n,(f,m,y)=>{s(),f?e(f):m&&(self.createImageBitmap?(function(w,S){const I=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(I).then(M=>{S(null,M)}).catch(M=>{S(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})})(m,(w,S)=>e(w,S,y)):(function(w,S){const I=new Image;I.onload=()=>{S(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=wf})},I.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(w)],{type:"image/png"});I.src=w.byteLength?URL.createObjectURL(M):wf})(m,(w,S)=>e(w,S,y)))});return{cancel:()=>{a.cancel(),s()}}};var Mo,Cc,Ic,Oa={exports:{}},pd={exports:{}},ah={exports:{}},qp=(function(){if(Ic)return Oa.exports;Ic=1;var n=(Mo||(Mo=1,pd.exports=function(i,s){var a,f,m,y,w,S,I,M;for(f=i.length-(a=3&i.length),m=s,w=3432918353,S=461845907,M=0;M<f;)I=255&i.charCodeAt(M)|(255&i.charCodeAt(++M))<<8|(255&i.charCodeAt(++M))<<16|(255&i.charCodeAt(++M))<<24,++M,m=27492+(65535&(y=5*(65535&(m=(m^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+(((y>>>16)+58964&65535)<<16);switch(I=0,a){case 3:I^=(255&i.charCodeAt(M+2))<<16;case 2:I^=(255&i.charCodeAt(M+1))<<8;case 1:m^=I=(65535&(I=(I=(65535&(I^=255&i.charCodeAt(M)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),pd.exports),e=(Cc||(Cc=1,ah.exports=function(i,s){for(var a,f=i.length,m=s^f,y=0;f>=4;)a=1540483477*(65535&(a=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(a>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:m^=(255&i.charCodeAt(y+2))<<16;case 2:m^=(255&i.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),ah.exports);return Oa.exports=n,Oa.exports.murmur3=n,Oa.exports.murmur2=e,Oa.exports})(),xl=In(qp);class Pa{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class lh extends Pa{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function vg(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function au(n,e,i){if(i&&i[n]){const s=i[n].indexOf(e);s!==-1&&i[n].splice(s,1)}}class $l{on(e,i){return this._listeners=this._listeners||{},vg(e,i,this._listeners),this}off(e,i){return au(e,i,this._listeners),au(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},vg(e,i,this._oneTimeListeners),this):new Promise(s=>{this.once(e,s)})}fire(e,i){const s=typeof e=="string"?new Pa(e,i):e,a=s.type;if(this.listens(a)){s.target=this;const f=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const w of f)w.call(this,s);const m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const w of m)au(a,w,this._oneTimeListeners),w.call(this,s);const y=this._eventedParent;if(y){const w=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(s,w),y.fire(s)}}else s instanceof lh&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class so{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new so(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,s]=e.split("");return new so({name:i,iconsetId:s})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return so.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var za,Tf={},xg=(function(){if(za)return Tf;za=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(f){return(f=Math.round(f))<0?0:f>255?255:f}function i(f){return e(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function s(f){return(m=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:m>1?1:m;var m}function a(f,m,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?f+(m-f)*y*6:2*y<1?m:3*y<2?f+(m-f)*(2/3-y)*6:f}try{Tf.parseCSSColor=function(f){var m,y=f.replace(/ /g,"").toLowerCase();if(y in n)return n[y].slice();if(y[0]==="#")return y.length===4?(m=parseInt(y.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:y.length===7&&(m=parseInt(y.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var w=y.indexOf("("),S=y.indexOf(")");if(w!==-1&&S+1===y.length){var I=y.substr(0,w),M=y.substr(w+1,S-(w+1)).split(","),O=1;switch(I){case"rgba":if(M.length!==4)return null;O=s(M.pop());case"rgb":return M.length!==3?null:[i(M[0]),i(M[1]),i(M[2]),O];case"hsla":if(M.length!==4)return null;O=s(M.pop());case"hsl":if(M.length!==3)return null;var L=(parseFloat(M[0])%360+360)%360/360,F=s(M[1]),G=s(M[2]),W=G<=.5?G*(F+1):G+F-G*F,$=2*G-W;return[e(255*a($,W,L+1/3)),e(255*a($,W,L)),e(255*a($,W,L-1/3)),O];default:return null}}return null}}catch{}return Tf})();class xn{constructor(e,i,s,a=1){this.r=e,this.g=i,this.b=s,this.a=a}static parse(e){if(!e)return;if(e instanceof xn)return e;if(typeof e!="string")return;const i=xg.parseCSSColor(e);return i?new xn(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,s,a]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*s)},${a})`}toNonPremultipliedRenderColor(e){const{r:i,g:s,b:a,a:f}=this;return new $p(e,i,s,a,f)}toPremultipliedRenderColor(e){const{r:i,g:s,b:a,a:f}=this;return new bg(e,i*f,s*f,a*f,f)}clone(){return new xn(this.r,this.g,this.b,this.a)}}class Hp{constructor(e,i,s,a,f,m=!1){if(this.premultiplied=!1,this.premultiplied=m,e){const y=e.image.height,w=y*y;this.premultiplied?(i=f===0?0:i/f*(y-1),s=f===0?0:s/f*(y-1),a=f===0?0:a/f*(y-1)):(i*=y-1,s*=y-1,a*=y-1);const S=Math.floor(i),I=Math.floor(s),M=Math.floor(a),O=Math.ceil(i),L=Math.ceil(s),F=Math.ceil(a),G=i-S,W=s-I,$=a-M,K=e.image.data,te=4*(S+I*w+M*y),se=4*(S+I*w+F*y),pe=4*(S+L*w+M*y),de=4*(S+L*w+F*y),be=4*(O+I*w+M*y),Te=4*(O+I*w+F*y),ve=4*(O+L*w+M*y),Ce=4*(O+L*w+F*y);if(te<0||Ce>=K.length)throw new Error("out of range");this.r=vi(vi(vi(K[te],K[se],$),vi(K[pe],K[de],$),W),vi(vi(K[be],K[Te],$),vi(K[ve],K[Ce],$),W),G)/255*(this.premultiplied?f:1),this.g=vi(vi(vi(K[te+1],K[se+1],$),vi(K[pe+1],K[de+1],$),W),vi(vi(K[be+1],K[Te+1],$),vi(K[ve+1],K[Ce+1],$),W),G)/255*(this.premultiplied?f:1),this.b=vi(vi(vi(K[te+2],K[se+2],$),vi(K[pe+2],K[de+2],$),W),vi(vi(K[be+2],K[Te+2],$),vi(K[ve+2],K[Ce+2],$),W),G)/255*(this.premultiplied?f:1),this.a=f}else this.r=i,this.g=s,this.b=a,this.a=f}toArray(){const{r:e,g:i,b:s,a}=this;return[255*e,255*i,255*s,a]}toHslaArray(){let{r:e,g:i,b:s,a}=this;if(this.premultiplied){if(a===0)return[0,0,0,0];const F=1/a;e*=F,i*=F,s*=F}const f=Math.min(Math.max(e,0),1),m=Math.min(Math.max(i,0),1),y=Math.min(Math.max(s,0),1),w=Math.min(f,m,y),S=Math.max(f,m,y),I=S-w,M=.5*(w+S);if(I===0)return[0,0,100*M,a];const O=M>.5?I/(2-S-w):I/(S+w);let L;switch(S){case f:L=60*((m-y)/I+(m<y?6:0));break;case m:L=60*((y-f)/I+2);break;default:L=60*((f-m)/I+4)}return[L,100*O,100*M,a]}toArray01(){const{r:e,g:i,b:s,a}=this;return[e,i,s,a]}toArray01Scaled(e){const{r:i,g:s,b:a}=this;return[i*e,s*e,a*e]}toArray01Linear(){const{r:e,g:i,b:s,a}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(s,2.2),a]}}class $p extends Hp{constructor(e,i,s,a,f){super(e,i,s,a,f,!1)}}class bg extends Hp{constructor(e,i,s,a,f){super(e,i,s,a,f,!0)}}function vi(n,e,i){return n*(1-i)+e*i}function Zp(n,e,i){return n.map((s,a)=>vi(s,e[a],i))}xn.black=new xn(0,0,0,1),xn.white=new xn(1,1,1,1),xn.transparent=new xn(0,0,0,0),xn.red=new xn(1,0,0,1),xn.blue=new xn(0,0,1,1);var lu=Object.freeze({__proto__:null,array:Zp,color:function(n,e,i){return new xn(vi(n.r,e.r,i),vi(n.g,e.g,i),vi(n.b,e.b,i),vi(n.a,e.a,i))},number:vi});class Hs extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Sf{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,a]of i)this.bindings[s]=a}concat(e){return new Sf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Do={kind:"null"},ri={kind:"number"},_n={kind:"string"},fn={kind:"boolean"},vo={kind:"color"},ch={kind:"object"},An={kind:"value"},Ef={kind:"collator"},uh={kind:"formatted"},cu={kind:"resolvedImage"};function oo(n,e){return{kind:"array",itemType:n,N:e}}function Or(n){if(n.kind==="array"){const e=Or(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Wp=[Do,ri,_n,fn,vo,uh,ch,oo(An),cu];function Zl(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Zl(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Wp)if(!Zl(i,e))return null}}return`Expected ${Or(n)} but found ${Or(e)} instead.`}function Xp(n,e){return e.some(i=>i.kind===n.kind)}function hh(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function md(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&md(n.itemType,e.itemType):n.kind===e.kind}class Af{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gd{constructor(e,i,s,a,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=a,this.textColor=f}}class $s{constructor(e){this.sections=e}static fromString(e){return new $s([new gd(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof $s?e:$s.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const a=i.image.getPrimary().id.toString();e.push(["image",a]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(s)}return e}}class Cs{constructor(e,i={}){this.id=so.from(e),this.params=i.params,this.sx=i.sx||1,this.sy=i.sy||1}toString(){return JSON.stringify(this)}static parse(e){let i,s,a,f;try{({id:i,params:s,sx:a,sy:f}=JSON.parse(e)||{})}catch{return null}return i?new Cs(i,{params:s,sx:a,sy:f}):null}scaleSelf(e,i=e){return this.sx*=e,this.sy*=i,this}}class Oo{constructor(e,i,s,a,f=!1){this.primaryId=so.from(e),this.primaryOptions=i,s&&(this.secondaryId=so.from(s)),this.secondaryOptions=a,this.available=f}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Cs(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Cs(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Oo.build({name:e}):e}static build(e,i,s,a){return!e||typeof e=="object"&&!("name"in e)?null:new Oo(e,s,i,a)}}function Yp(n,e,i,s){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[n,e,i,s]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rc(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof xn||n instanceof Af||n instanceof $s||n instanceof Oo)return!0;if(Array.isArray(n)){for(const e of n)if(!Rc(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Rc(n[e]))return!1;return!0}return!1}function ts(n){if(n===null)return Do;if(typeof n=="string")return _n;if(typeof n=="boolean")return fn;if(typeof n=="number")return ri;if(n instanceof xn)return vo;if(n instanceof Af)return Ef;if(n instanceof $s)return uh;if(n instanceof Oo)return cu;if(Array.isArray(n)){const e=n.length;let i;for(const s of n){const a=ts(s);if(i){if(i===a)continue;i=An;break}i=a}return oo(i||An,e)}return ch}function $a(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof $s||n instanceof Oo||n instanceof xn?n.toString():JSON.stringify(n)}class fa{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Rc(e[1]))return i.error("invalid value");const s=e[1];let a=ts(s);const f=i.expectedType;return a.kind!=="array"||a.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(a=f),new fa(a,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof xn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof $s?this.value.serialize():this.value}}class Pr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Mc={string:_n,number:ri,boolean:fn,object:ch};class wi{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,a=1;const f=e[0];if(f==="array"){let y,w;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in Mc)||S==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Mc[S],a++}else y=An;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],a++}s=oo(y,w)}else s=Mc[f];const m=[];for(;a<e.length;a++){const y=i.parse(e[a],a,An);if(!y)return null;m.push(y)}return new wi(s,m)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!Zl(this.type,ts(s)))return s;if(i===this.args.length-1)throw new Pr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Or(ts(s))} but was expected to be of type ${Or(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(s=>s.serialize()))}}class ii{constructor(e){this.type=uh,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const a=[];let f=!1;for(let m=1;m<=e.length-1;++m){const y=e[m];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let w=null;if(y["font-scale"]&&(w=i.parseObjectValue(y["font-scale"],m,"font-scale",ri),!w))return null;let S=null;if(y["text-font"]&&(S=i.parseObjectValue(y["text-font"],m,"text-font",oo(_n)),!S))return null;let I=null;if(y["text-color"]&&(I=i.parseObjectValue(y["text-color"],m,"text-color",vo),!I))return null;const M=a[a.length-1];M.scale=w,M.font=S,M.textColor=I}else{const w=i.parse(e[m],m,An);if(!w)return null;const S=w.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,a.push({content:w,scale:null,font:null,textColor:null})}}return new ii(a)}evaluate(e){return new $s(this.sections.map(i=>{const s=i.content.evaluate(e);return md(ts(s),cu)?new gd("",s,null,null,null):new gd($a(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class uu{constructor(e,i,s,a){this._imageWarnHistory={},this.type=cu,this.namePrimary=e,this.nameSecondary=i,s&&(this.paramsPrimary=s.params,this.iconsetIdPrimary=s.iconset?s.iconset.id:void 0),a&&(this.paramsSecondary=a.params,this.iconsetIdSecondary=a.iconset?a.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let s=1;const a=[];function f(){if(s<e.length){const y=i.parse(e[s],s++,_n);return y?(a.push({image:y,options:{}}),!0):(i.error(a.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(s<e.length){const w=e[s];if((y=w)===null||typeof y!="object"||Array.isArray(y))return!0;const S=w.params,I=w.iconset,M=i.concat(s);if(!S&&!I)return s++,!0;if(S){if(typeof S!="object"||S.constructor!==Object)return M.error('Image options "params" should be an object'),!1;const O={},L=M.concat(void 0,"params");for(const F in S){if(!F)return L.error("Image parameter name should be non-empty"),!1;const G=L.concat(void 0,F).parse(S[F],void 0,vo,void 0,{typeAnnotation:"coerce"});if(!G)return!1;O[F]=G}a[a.length-1].options.params=O}if(I){if(typeof I!="object"||I.constructor!==Object)return M.error('Image options "iconset" should be an object'),!1;if(!I.id)return M.error('Image options "iconset" should have an "id" property'),!1;a[a.length-1].options.iconset=I}return s++,!0}var y;return!0}for(let y=0;y<2;y++)if(!f()||!m())return;return new uu(a[0].image,a[1]?a[1].image:void 0,a[0].options,a[1]?a[1].options:void 0)}evaluateParams(e,i){const s={};if(i){for(const a in i)if(i[a])try{s[a]=i[a].evaluate(e)}catch{continue}if(Object.keys(s).length!==0)return{params:s}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},s=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,a=Oo.build(i,s,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(a&&e.availableImages){const f=a.getPrimary().id;if(a.available=e.availableImages.some(m=>so.isEqual(m,f)),a.available){const m=a.getSecondary()?a.getSecondary().id:null;m&&(a.available=e.availableImages.some(y=>so.isEqual(y,m)))}}return a}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const s={};if(i&&(s.iconset={id:i}),e){s.params={};for(const a in e)e[a]&&(s.params[a]=e[a].serialize())}return Object.keys(s).length>0?s:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function xi(n){return fh(n)?"string":gi(n)?"number":Cf(n)?"boolean":Array.isArray(n)?"array":n===null?"null":dh(n)?"object":typeof n}function dh(n){return n!=null&&!Array.isArray(n)&&typeof n!="function"&&!(n instanceof String||n instanceof Number||n instanceof Boolean)&&typeof n=="object"}function fh(n){return typeof n=="string"||n instanceof String}function gi(n){return typeof n=="number"||n instanceof Number}function Cf(n){return typeof n=="boolean"||n instanceof Boolean}const Kp={"to-boolean":fn,"to-color":vo,"to-number":ri,"to-string":_n};class bl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],a=[];let f=Do;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);f=oo(i.expectedType.itemType,m)}else{if(!(m>0&&Rc(e[1][0])))return null;f=oo(ts(e[1][0]),m)}for(let y=0;y<m;y++){const w=e[1][y];let S;if(Array.isArray(w))S=i.parse(w,void 0,f.itemType);else{const I=xi(w);if(I!==f.itemType.kind)return i.error(`Expected ${f.itemType.kind} but found ${I}.`);S=i.registry.literal.parse(["literal",w===void 0?null:w],i)}if(!S)return null;a.push(S)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");f=Kp[s];for(let m=1;m<e.length;m++){const y=i.parse(e[m],m,An);if(!y)return null;a.push(y)}}return new bl(f,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const a of this.args){if(i=a.evaluate(e),s=null,i instanceof xn)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Yp(i[0],i[1],i[2],i[3]),!s))return new xn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Pr(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const a=Number(i);if(!isNaN(a))return a}throw new Pr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?$s.fromString($a(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Oo.build($a(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):$a(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ii([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new uu(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const wg=["Unknown","Point","LineString","Polygon"];class ph{constructor(e,i,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wg[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(a*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=xn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Po{constructor(e,i,s,a,f){this.name=e,this.type=i,this._evaluate=s,this.args=a,this._overloadIndex=f}evaluate(e){if(!this._evaluate){const i=Po.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],a=Po.definitions[s];if(!a)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(a)?a[0]:a.type,m=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,y=[];let w=null,S=-1;for(const[I,M]of m){if(Array.isArray(I)&&I.length!==e.length-1)continue;y.push(I),S++,w=new Sd(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const O=[];let L=!1;for(let F=1;F<e.length;F++){const G=e[F],W=Array.isArray(I)?I[F-1]:I.type,$=w.parse(G,1+O.length,W);if(!$){L=!0;break}O.push($)}if(!L)if(Array.isArray(I)&&I.length!==O.length)w.error(`Expected ${I.length} arguments, but found ${O.length} instead.`);else{for(let F=0;F<O.length;F++){const G=Array.isArray(I)?I[F]:I.type,W=O[F];w.concat(F+1).checkSubtype(G,W.type)}if(w.errors.length===0)return new Po(s,f,M,O,S)}}if(y.length===1)i.errors.push(...w.errors);else{const I=(y.length?y:m.map(([O])=>O)).map(zo).join(" | "),M=[];for(let O=1;O<e.length;O++){const L=i.parse(e[O],1+M.length);if(!L)return null;M.push(Or(L.type))}i.error(`Expected arguments of type ${I}, but found (${M.join(", ")}) instead.`)}return null}static register(e,i){Po.definitions=i;for(const s in i)e[s]=Po}}function zo(n){return Array.isArray(n)?`(${n.map(Or).join(", ")})`:`(${Or(n.type)}...)`}class ea{constructor(e,i,s){this.type=Ef,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const a=s["case-sensitive"]===void 0?i.parse(!1,1,fn):i.parseObjectValue(s["case-sensitive"],1,"case-sensitive",fn);if(!a)return null;const f=s["diacritic-sensitive"]===void 0?i.parse(!1,1,fn):i.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",fn);if(!f)return null;let m=null;return s.locale&&(m=i.parseObjectValue(s.locale,1,"locale",_n),!m)?null:new ea(a,f,m)}evaluate(e){return new Af(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function _d(n,e,i=0,s=n.length-1,a=Wl){for(;s>i;){if(s-i>600){const w=s-i+1,S=e-i+1,I=Math.log(w),M=.5*Math.exp(2*I/3),O=.5*Math.sqrt(I*M*(w-M)/w)*(S-w/2<0?-1:1);_d(n,e,Math.max(i,Math.floor(e-S*M/w+O)),Math.min(s,Math.floor(e+(w-S)*M/w+O)),a)}const f=n[e];let m=i,y=s;for(pa(n,i,e),a(n[s],f)>0&&pa(n,i,s);m<y;){for(pa(n,m,y),m++,y--;a(n[m],f)<0;)m++;for(;a(n[y],f)>0;)y--}a(n[i],f)===0?pa(n,i,y):(y++,pa(n,y,s)),y<=e&&(i=y+1),e<=y&&(s=y-1)}}function pa(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}function Wl(n,e){return n<e?-1:n>e?1:0}function Tg(n){let e=0;for(let i,s,a=0,f=n.length,m=f-1;a<f;m=a++)i=n[a],s=n[m],e+=(s.x-i.x)*(i.y+s.y);return e}function hu(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function yd(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Xl(n,e,i){const s=n[0]-e[0],a=n[1]-e[1],f=n[0]-i[0],m=n[1]-i[1];return s*m-f*a===0&&s*f<=0&&a*m<=0}function If(n,e,i){return e[1]>n[1]!=i[1]>n[1]&&n[0]<(i[0]-e[0])*(n[1]-e[1])/(i[1]-e[1])+e[0]}function xo(n,e,i=!1){let s=!1;for(let a=0,f=e.length;a<f;a++){const m=e[a];for(let y=0,w=m.length,S=w-1;y<w;S=y++){const I=m[S],M=m[y];if(Xl(n,I,M))return i;If(n,I,M)&&(s=!s)}}return s}function Rf(n,e,i,s){const a=s[0]-i[0],f=s[1]-i[1],m=(n[0]-i[0])*f-a*(n[1]-i[1]),y=(e[0]-i[0])*f-a*(e[1]-i[1]);return m>0&&y<0||m<0&&y>0}function vd(n,e,i,s){return(a=[s[0]-i[0],s[1]-i[1]])[0]*(f=[e[0]-n[0],e[1]-n[1]])[1]-a[1]*f[0]!==0&&!(!Rf(n,e,i,s)||!Rf(i,s,n,e));var a,f}function Za(n){const e=new pt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new pt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const s of n[0])e.x>s.x&&(e.x=s.x),e.y>s.y&&(e.y=s.y),i.x<s.x&&(i.x=s.x),i.y<s.y&&(i.y=s.y);return{min:e,max:i}}const ma=8192;function Jp(n,e){const i=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*ma),Math.round(s*a*ma)]}function Qp(n,e){for(let i=0;i<e.length;i++)if(xo(n,e[i]))return!0;return!1}function du(n,e,i){for(const s of i)for(let a=0,f=s.length,m=f-1;a<f;m=a++)if(vd(n,e,s[m],s[a]))return!0;return!1}function Mf(n,e){for(let i=0;i<n.length;++i)if(!xo(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(du(n[i],n[i+1],e))return!1;return!0}function Sg(n,e){for(let i=0;i<e.length;i++)if(Mf(n,e[i]))return!0;return!1}function wl(n,e,i){const s=[];for(let a=0;a<n.length;a++){const f=[];for(let m=0;m<n[a].length;m++){const y=Jp(n[a][m],i);hu(e,y),f.push(y)}s.push(f)}return s}function Eg(n,e,i){const s=[];for(let a=0;a<n.length;a++){const f=wl(n[a],e,i);s.push(f)}return s}function Ag(n,e,i,s){if(n[0]<i[0]||n[0]>i[2]){const a=.5*s;let f=n[0]-i[0]>a?-s:i[0]-n[0]>a?s:0;f===0&&(f=n[0]-i[2]>a?-s:i[2]-n[0]>a?s:0),n[0]+=f}hu(e,n)}function Df(n,e,i,s){const a=Math.pow(2,s.z)*ma,f=[s.x*ma,s.y*ma],m=[];if(!n)return m;for(const y of n)for(const w of y){const S=[w.x+f[0],w.y+f[1]];Ag(S,e,i,a),m.push(S)}return m}function Of(n,e,i,s){const a=Math.pow(2,s.z)*ma,f=[s.x*ma,s.y*ma],m=[];if(!n)return m;for(const w of n){const S=[];for(const I of w){const M=[I.x+f[0],I.y+f[1]];hu(e,M),S.push(M)}m.push(S)}if(e[2]-e[0]<=a/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const w of m)for(const S of w)Ag(S,e,i,a)}var y;return m}class Yl{constructor(e,i){this.type=fn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Rc(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let a=0;a<s.features.length;++a){const f=s.features[a].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Yl(s,s.features[a].geometry)}else if(s.type==="Feature"){const a=s.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new Yl(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Yl(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,s){const a=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(s.type==="Polygon"){const y=wl(s.coordinates,f,m),w=Df(i.geometry(),a,f,m);if(!yd(a,f))return!1;for(const S of w)if(!xo(S,y))return!1}if(s.type==="MultiPolygon"){const y=Eg(s.coordinates,f,m),w=Df(i.geometry(),a,f,m);if(!yd(a,f))return!1;for(const S of w)if(!Qp(S,y))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,s){const a=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(s.type==="Polygon"){const y=wl(s.coordinates,f,m),w=Of(i.geometry(),a,f,m);if(!yd(a,f))return!1;for(const S of w)if(!Mf(S,y))return!1}if(s.type==="MultiPolygon"){const y=Eg(s.coordinates,f,m),w=Of(i.geometry(),a,f,m);if(!yd(a,f))return!1;for(const S of w)if(!Sg(S,y))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const bo={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ga=1/298.257223563,mh=ga*(2-ga),ao=Math.PI/180;class Wa{static fromTile(e,i,s){const a=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),f=Math.atan(.5*(Math.exp(a)-Math.exp(-a)))/ao;return new Wa(f,s)}static get units(){return bo}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!bo[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(bo).join(", ")}`);const s=6378.137*ao*(i?bo[i]:1),a=Math.cos(e*ao),f=1/(1-mh*(1-a*a)),m=Math.sqrt(f);this.kx=s*m*a,this.ky=s*m*f*(1-mh)}distance(e,i){const s=wo(e[0]-i[0])*this.kx,a=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+a*a)}bearing(e,i){const s=wo(i[0]-e[0])*this.kx;return Math.atan2(s,(i[1]-e[1])*this.ky)/ao}destination(e,i,s){const a=s*ao;return this.offset(e,Math.sin(a)*i,Math.cos(a)*i)}offset(e,i,s){return[e[0]+i/this.kx,e[1]+s/this.ky]}lineDistance(e){let i=0;for(let s=0;s<e.length-1;s++)i+=this.distance(e[s],e[s+1]);return i}area(e){let i=0;for(let s=0;s<e.length;s++){const a=e[s];for(let f=0,m=a.length,y=m-1;f<m;y=f++)i+=wo(a[f][0]-a[y][0])*(a[f][1]+a[y][1])*(s?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let s=0;if(i<=0)return e[0];for(let a=0;a<e.length-1;a++){const f=e[a],m=e[a+1],y=this.distance(f,m);if(s+=y,s>i)return fu(f,m,(i-(s-y))/y)}return e[e.length-1]}pointToSegmentDistance(e,i,s){let[a,f]=i,m=wo(s[0]-a)*this.kx,y=(s[1]-f)*this.ky;if(m!==0||y!==0){const w=(wo(e[0]-a)*this.kx*m+(e[1]-f)*this.ky*y)/(m*m+y*y);w>1?(a=s[0],f=s[1]):w>0&&(a+=m/this.kx*w,f+=y/this.ky*w)}return m=wo(e[0]-a)*this.kx,y=(e[1]-f)*this.ky,Math.sqrt(m*m+y*y)}pointOnLine(e,i){let s=1/0,a=e[0][0],f=e[0][1],m=0,y=0;for(let w=0;w<e.length-1;w++){let S=e[w][0],I=e[w][1],M=wo(e[w+1][0]-S)*this.kx,O=(e[w+1][1]-I)*this.ky,L=0;M===0&&O===0||(L=(wo(i[0]-S)*this.kx*M+(i[1]-I)*this.ky*O)/(M*M+O*O),L>1?(S=e[w+1][0],I=e[w+1][1]):L>0&&(S+=M/this.kx*L,I+=O/this.ky*L)),M=wo(i[0]-S)*this.kx,O=(i[1]-I)*this.ky;const F=M*M+O*O;F<s&&(s=F,a=S,f=I,m=w,y=L)}return{point:[a,f],index:m,t:Math.max(0,Math.min(1,y))}}lineSlice(e,i,s){let a=this.pointOnLine(s,e),f=this.pointOnLine(s,i);if(a.index>f.index||a.index===f.index&&a.t>f.t){const S=a;a=f,f=S}const m=[a.point],y=a.index+1,w=f.index;!xd(s[y],m[0])&&y<=w&&m.push(s[y]);for(let S=y+1;S<=w;S++)m.push(s[S]);return xd(s[w],f.point)||m.push(f.point),m}lineSliceAlong(e,i,s){let a=0;const f=[];for(let m=0;m<s.length-1;m++){const y=s[m],w=s[m+1],S=this.distance(y,w);if(a+=S,a>e&&f.length===0&&f.push(fu(y,w,(e-(a-S))/S)),a>=i)return f.push(fu(y,w,(i-(a-S))/S)),f;a>e&&f.push(w)}return f}bufferPoint(e,i){const s=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-s,e[0]+a,e[1]+s]}bufferBBox(e,i){const s=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-s,e[2]+a,e[3]+s]}insideBBox(e,i){return wo(e[0]-i[0])>=0&&wo(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function xd(n,e){return n[0]===e[0]&&n[1]===e[1]}function fu(n,e,i){const s=wo(e[0]-n[0]);return[n[0]+s*i,n[1]+(e[1]-n[1])*i]}function wo(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class pu{constructor(e=[],i=(s,a)=>s<a?-1:s>a?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,a=i[e];for(;e>0;){const f=e-1>>1,m=i[f];if(s(a,m)>=0)break;i[e]=m,e=f}i[e]=a}_down(e){const{data:i,compare:s}=this,a=this.length>>1,f=i[e];for(;e<a;){let m=1+(e<<1);const y=m+1;if(y<this.length&&s(i[y],i[m])<0&&(m=y),s(i[m],f)>=0)break;i[e]=i[m],e=m}i[e]=f}}var zt=8192;function Pf(n,e){return e.dist-n.dist}function gh(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function Tl(n){return n[1]-n[0]+1}function Sl(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Lo(n,e){if(n[0]>n[1])return[null,null];const i=Tl(n);if(e){if(i===2)return[n,null];const s=Math.floor(i/2);return[[n[0],n[0]+s],[n[0]+s,n[1]]]}{if(i===1)return[n,null];const s=Math.floor(i/2)-1;return[[n[0],n[0]+s],[n[0]+s+1,n[1]]]}}function Kl(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!Sl(e,n.length))return i;for(let s=e[0];s<=e[1];++s)hu(i,n[s]);return i}function ko(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let s=0;s<n[i].length;++s)hu(e,n[i][s]);return e}function Jl(n,e,i){if(gh(n)||gh(e))return NaN;let s=0,a=0;return n[2]<e[0]&&(s=e[0]-n[2]),n[0]>e[2]&&(s=n[0]-e[2]),n[1]>e[3]&&(a=n[1]-e[3]),n[3]<e[1]&&(a=e[1]-n[3]),i.distance([0,0],[s,a])}function mu(n){return 360*n-180}function Dc(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function _h(n,e){const i=Math.pow(2,e.z),s=(n.y/zt+e.y)/i;return[mu((n.x/zt+e.x)/i),Dc(s)]}function Cg(n,e){const i=[];for(let s=0;s<n.length;++s)i.push(_h(n[s],e));return i}function zf(n,e,i){const s=i.pointOnLine(e,n).point;return i.distance(n,s)}function Lf(n,e,i,s,a){const f=i.slice(s[0],s[1]+1);let m=1/0;for(let y=e[0];y<=e[1];++y)if((m=Math.min(m,zf(n[y],f,a)))===0)return 0;return m}function zs(n,e,i,s,a){const f=Math.min(a.pointToSegmentDistance(n,i,s),a.pointToSegmentDistance(e,i,s)),m=Math.min(a.pointToSegmentDistance(i,n,e),a.pointToSegmentDistance(s,n,e));return Math.min(f,m)}function Qi(n,e,i,s,a){if(!Sl(e,n.length)||!Sl(s,i.length))return NaN;let f=1/0;for(let m=e[0];m<e[1];++m)for(let y=s[0];y<s[1];++y){if(vd(n[m],n[m+1],i[y],i[y+1]))return 0;f=Math.min(f,zs(n[m],n[m+1],i[y],i[y+1],a))}return f}function yh(n,e,i,s,a){if(!Sl(e,n.length)||!Sl(s,i.length))return NaN;let f=1/0;for(let m=e[0];m<=e[1];++m)for(let y=s[0];y<=s[1];++y)if((f=Math.min(f,a.distance(n[m],i[y])))===0)return f;return f}function kf(n,e,i){if(xo(n,e,!0))return 0;let s=1/0;for(const a of e){const f=a.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[f-1]&&(s=Math.min(s,i.pointToSegmentDistance(n,a[f-1],a[0])))===0||(s=Math.min(s,zf(n,a,i)))===0)return s}return s}function bd(n,e,i,s){if(!Sl(e,n.length))return NaN;for(let f=e[0];f<=e[1];++f)if(xo(n[f],i,!0))return 0;let a=1/0;for(let f=e[0];f<e[1];++f)for(const m of i)for(let y=0,w=m.length,S=w-1;y<w;S=y++){if(vd(n[f],n[f+1],m[S],m[y]))return 0;a=Math.min(a,zs(n[f],n[f+1],m[S],m[y],s))}return a}function ta(n,e){for(const i of n)for(let s=0;s<=i.length-1;++s)if(xo(i[s],e,!0))return!0;return!1}function La(n,e,i,s=1/0){const a=ko(n),f=ko(e);if(s!==1/0&&Jl(a,f,i)>=s)return s;if(yd(a,f)){if(ta(n,e))return 0}else if(ta(e,n))return 0;let m=s;for(const y of n)for(let w=0,S=y.length,I=S-1;w<S;I=w++)for(const M of e)for(let O=0,L=M.length,F=L-1;O<L;F=O++){if(vd(y[I],y[w],M[F],M[O]))return 0;m=Math.min(m,zs(y[I],y[w],M[F],M[O],i))}return m}function zn(n,e,i,s,a,f,m){if(f===null||m===null)return;const y=Jl(Kl(s,f),Kl(a,m),i);y<e&&n.push({dist:y,range1:f,range2:m})}function El(n,e,i,s,a=1/0){let f=Math.min(s.distance(n[0],i[0][0]),a);if(f===0)return f;const m=new pu([{dist:0,range1:[0,n.length-1],range2:[0,0]}],Pf),y=e?50:100,w=ko(i);for(;m.length;){const S=m.pop();if(S.dist>=f)continue;const I=S.range1;if(Tl(I)<=y){if(!Sl(I,n.length))return NaN;if(e){const M=bd(n,I,i,s);if((f=Math.min(f,M))===0)return f}else for(let M=I[0];M<=I[1];++M){const O=kf(n[M],i,s);if((f=Math.min(f,O))===0)return f}}else{const M=Lo(I,e);if(M[0]!==null){const O=Jl(Kl(n,M[0]),w,s);O<f&&m.push({dist:O,range1:M[0],range2:[0,0]})}if(M[1]!==null){const O=Jl(Kl(n,M[1]),w,s);O<f&&m.push({dist:O,range1:M[1],range2:[0,0]})}}}return f}function Xa(n,e,i,s,a,f=1/0){let m=Math.min(f,a.distance(n[0],i[0]));if(m===0)return m;const y=new pu([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],Pf),w=e?50:100,S=s?50:100;for(;y.length;){const I=y.pop();if(I.dist>=m)continue;const M=I.range1,O=I.range2;if(Tl(M)<=w&&Tl(O)<=S){if(!Sl(M,n.length)||!Sl(O,i.length))return NaN;if(e&&s?m=Math.min(m,Qi(n,M,i,O,a)):e||s?e&&!s?m=Math.min(m,Lf(i,O,n,M,a)):!e&&s&&(m=Math.min(m,Lf(n,M,i,O,a))):m=Math.min(m,yh(n,M,i,O,a)),m===0)return m}else{const L=Lo(M,e),F=Lo(O,s);zn(y,m,a,n,i,L[0],F[0]),zn(y,m,a,n,i,L[0],F[1]),zn(y,m,a,n,i,L[1],F[0]),zn(y,m,a,n,i,L[1],F[1])}}return m}function Ya(n,e,i,s,a=1/0){let f=a;const m=Kl(n,[0,n.length-1]);for(const y of i)if(!(f!==1/0&&Jl(m,Kl(y,[0,y.length-1]),s)>=f)&&(f=Math.min(f,Xa(n,e,y,!0,s,f)),f===0))return f;return f}function wd(n,e,i,s,a=1/0){let f=a;const m=Kl(n,[0,n.length-1]);for(const y of i){if(f!==1/0&&Jl(m,ko(y),s)>=f)continue;const w=El(n,e,y,s,f);if(isNaN(w))return w;if((f=Math.min(f,w))===0)return f}return f}function Td(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class Ql{constructor(e,i){this.type=ri,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Rc(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let a=0;a<s.features.length;++a)if(Td(s.features[a].geometry.type))return new Ql(s,s.features[a].geometry)}else if(s.type==="Feature"){if(Td(s.geometry.type))return new Ql(s,s.geometry)}else if(Td(s.type))return new Ql(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return(function(a,f,m){const y=[];for(const S of a)for(const I of S)y.push(_h(I,f));const w=new Wa(y[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Xa(y,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",w):m.type==="MultiLineString"?Ya(y,!1,m.coordinates,w):m.type==="Polygon"||m.type==="MultiPolygon"?wd(y,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,w):null})(i,s,this.geometries);if(e.geometryType()==="LineString")return(function(a,f,m){const y=[];for(const S of a){const I=[];for(const M of S)I.push(_h(M,f));y.push(I)}const w=new Wa(y[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Ya(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,w);if(m.type==="MultiLineString"){let S=1/0;for(let I=0;I<m.coordinates.length;I++){const M=Ya(m.coordinates[I],!0,y,w,S);if(isNaN(M))return M;if((S=Math.min(S,M))===0)return S}return S}if(m.type==="Polygon"||m.type==="MultiPolygon"){let S=1/0;for(let I=0;I<y.length;I++){const M=wd(y[I],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,w,S);if(isNaN(M))return M;if((S=Math.min(S,M))===0)return S}return S}return null})(i,s,this.geometries);if(e.geometryType()==="Polygon")return(function(a,f,m){const y=[];for(const S of(function(I){const M=I.length;if(M<=1)return[I];const O=[];let L,F;for(let G=0;G<M;G++){const W=Tg(I[G]);W!==0&&(I[G].area=Math.abs(W),F===void 0&&(F=W<0),F===W<0?(L&&O.push(L),L=[I[G]]):L.push(I[G]))}return L&&O.push(L),O})(a)){const I=[];for(let M=0;M<S.length;++M)I.push(Cg(S[M],f));y.push(I)}const w=new Wa(y[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return wd(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,w);if(m.type==="MultiLineString"){let S=1/0;for(let I=0;I<m.coordinates.length;I++){const M=wd(m.coordinates[I],!0,y,w,S);if(isNaN(M))return M;if((S=Math.min(S,M))===0)return S}return S}return m.type==="Polygon"||m.type==="MultiPolygon"?(function(S,I,M){let O=1/0;for(const L of S)for(const F of I){const G=La(L,F,M,O);if(isNaN(G))return G;if((O=Math.min(O,G))===0)return O}return O})(m.type==="Polygon"?[m.coordinates]:m.coordinates,y,w):null})(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function gu(n){if(n instanceof Po&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Yl||n instanceof Ql)return!1;if(n instanceof Oc)return n.featureConstant;let e=!0;return n.eachChild(i=>{e&&!gu(i)&&(e=!1)}),e}function fs(n){if(n instanceof Po&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!fs(i)&&(e=!1)}),e}function wr(n,e){if(n instanceof Po&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(s=>{i&&!wr(s,e)&&(i=!1)}),i}function Zn(n,e,i){return[n,e,i].filter(Boolean).join("")}function Al(n,e){switch(n){case"string":return $a(e);case"number":return+e;case"boolean":return!!e;case"color":return xn.parse(e);case"formatted":return $s.fromString($a(e));case"resolvedImage":return Oo.build($a(e))}return e}function _a(n,e,i,s){return s!==void 0&&(n=s*Math.round(n/s)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class Oc{constructor(e,i,s,a=!1){this.type=e,this.key=i,this.scope=s,this.featureConstant=a}static parse(e,i){let s=i.expectedType;if(s==null&&(s=An),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const a=i.parse(e[1],1);if(!(a instanceof fa))return i.error("Key name of 'config' expression must be a string literal.");let f,m=!0;const y=$a(a.value);if(e.length>=3){const w=i.parse(e[2],2);if(!(w instanceof fa))return i.error("Scope of 'config' expression must be a string literal.");f=$a(w.value)}if(i.options){const w=Zn(y,f,i._scope),S=i.options.get(w);S&&(m=gu(S.value||S.default))}return new Oc(s,y,f,m)}evaluate(e){const i=Zn(this.key,this.scope,e.scope),s=e.getConfig(i);if(!s)return null;const{type:a,value:f,values:m,minValue:y,maxValue:w,stepValue:S}=s,I=s.default.evaluate(e);let M=I;if(f){const O=e.scope;e.scope=(O||"").split("").slice(1).join(""),M=f.evaluate(e),e.scope=O}return a&&(M=Al(a,M)),M===void 0||y===void 0&&w===void 0&&S===void 0||(typeof M=="number"?M=_a(M,y,w,S):Array.isArray(M)&&(M=M.map(O=>typeof O=="number"?_a(O,y,w,S):O))),f!==void 0&&M!==void 0&&m&&!m.includes(M)&&(M=I,a&&(M=Al(a,M))),(a&&a!==this.type||M!==void 0&&!md(ts(M),this.type))&&(M=Al(this.type.kind,M)),M}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Ka{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new Ka(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Sd{constructor(e,i=[],s,a=new Sf,f=[],m,y,w){this.registry=e,this.path=i,this.key=i.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=a,this.errors=f,this.expectedType=s,this._scope=m,this.options=y,this.iconImageUseTheme=w}parse(e,i,s,a,f={}){return i||s?this.concat(i,null,s,a)._parse(e,f):this._parse(e,f)}parseObjectValue(e,i,s,a,f,m={}){return this.concat(i,s,a,f)._parse(e,m)}_parse(e,i){function s(a,f,m){return m==="assert"?new wi(f,[a]):m==="coerce"?new bl(f,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let f=a.parse(e,this);if(!f)return null;if(this.expectedType){const m=this.expectedType,y=f.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||y.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(m,y))return null}else f=s(f,m,i.typeAnnotation||"coerce");else f=s(f,m,i.typeAnnotation||"assert")}if(!(f instanceof fa)&&f.type.kind!=="resolvedImage"&&Bf(f)){const m=new ph(this._scope,this.options,this.iconImageUseTheme);try{f=new fa(f.type,f.evaluate(m))}catch(y){return this.error(y.message),null}}return f}return bl.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s,a){let f=typeof e=="number"?this.path.concat(e):this.path;f=typeof i=="string"?f.concat(i):f;const m=a?this.scope.concat(a):this.scope;return new Sd(this.registry,f,s||null,m,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const s=`${this.key}${i.map(a=>`[${a}]`).join("")}`;this.errors.push(new Hs(s,e))}checkSubtype(e,i){const s=Zl(e,i);return s&&this.error(s),s}}function Bf(n){if(n instanceof Ka)return Bf(n.boundExpression);if(n instanceof Po&&n.name==="error"||n instanceof ea||n instanceof Yl||n instanceof Ql||n instanceof Oc)return!1;const e=n instanceof bl||n instanceof wi;let i=!0;return n.eachChild(s=>{i=e?i&&Bf(s):i&&s instanceof fa}),!!i&&gu(n)&&wr(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function ec(n,e){const i=n.length-1;let s,a,f=0,m=i,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),s=n[y],a=n[y+1],s<=e){if(y===i||e<a)return y;f=y+1}else{if(!(s>e))throw new Pr("Input is not a number.");m=y-1}return 0}class Ja{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[a,f]of s)this.labels.push(a),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,ri);if(!s)return null;const a=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let m=1;m<e.length;m+=2){const y=m===1?-1/0:e[m],w=e[m+1],S=m,I=m+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(a.length&&a[a.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const M=i.parse(w,I,f);if(!M)return null;f=f||M.type,a.push([y,M])}return new Ja(f,s,a)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return s[0].evaluate(e);const f=i.length;return a>=i[f-1]?s[f-1].evaluate(e):s[ec(i,a)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Ff=.95047,vh=1.08883,Nf=4/29,ka=6/29,Cl=3*ka*ka,Pc=ka*ka*ka,tc=Math.PI/180,em=180/Math.PI;function Ed(n){return n>Pc?Math.pow(n,1/3):n/Cl+Nf}function zc(n){return n>ka?n*n*n:Cl*(n-Nf)}function xh(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function ic(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Zs(n){const e=ic(n.r),i=ic(n.g),s=ic(n.b),a=Ed((.4124564*e+.3575761*i+.1804375*s)/Ff),f=Ed((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*f-16,a:500*(a-f),b:200*(f-Ed((.0193339*e+.119192*i+.9503041*s)/vh)),alpha:n.a}}function _u(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*zc(e),i=Ff*zc(i),s=vh*zc(s),new xn(xh(3.2404542*i-1.5371385*e-.4985314*s),xh(-.969266*i+1.8760108*e+.041556*s),xh(.0556434*i-.2040259*e+1.0572252*s),n.alpha)}function Ad(n,e,i){const s=e-n;return n+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const bh={forward:Zs,reverse:_u,interpolate:function(n,e,i){return{l:vi(n.l,e.l,i),a:vi(n.a,e.a,i),b:vi(n.b,e.b,i),alpha:vi(n.alpha,e.alpha,i)}}},Cd={forward:function(n){const{l:e,a:i,b:s}=Zs(n),a=Math.atan2(s,i)*em;return{h:a<0?a+360:a,c:Math.sqrt(i*i+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*tc,i=n.c;return _u({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Ad(n.h,e.h,i),c:vi(n.c,e.c,i),l:vi(n.l,e.l,i),alpha:vi(n.alpha,e.alpha,i)}}};var Ig=Object.freeze({__proto__:null,hcl:Cd,lab:bh});class ar{constructor(e,i,s,a,f){this.type=e,this.operator=i,this.interpolation=s,this.input=a,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,i,s,a){let f=0;if(e.name==="exponential")f=wh(i,e.base,s,a);else if(e.name==="linear")f=wh(i,1,s,a);else if(e.name==="cubic-bezier"){const m=e.controlPoints;f=new Gn(m[0],m[1],m[2],m[3]).solve(wh(i,1,s,a))}return f}static parse(e,i){let[s,a,f,...m]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const S=a[1];if(typeof S!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:S}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const S=a.slice(1);if(S.length!==4||S.some(I=>typeof I!="number"||I<0||I>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,ri),!f)return null;const y=[];let w=null;s==="interpolate-hcl"||s==="interpolate-lab"?w=vo:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let S=0;S<m.length;S+=2){const I=m[S],M=m[S+1],O=S+3,L=S+4;if(typeof I!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(y.length&&y[y.length-1][0]>=I)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const F=i.parse(M,L,w);if(!F)return null;w=w||F.type,y.push([I,F])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new ar(w,s,a,f,y):i.error(`Type ${Or(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return s[0].evaluate(e);const f=i.length;if(a>=i[f-1])return s[f-1].evaluate(e);const m=ec(i,a),y=ar.interpolationFactor(this.interpolation,a,i[m],i[m+1]),w=s[m].evaluate(e),S=s[m+1].evaluate(e);return this.operator==="interpolate"?lu[this.type.kind.toLowerCase()](w,S,y):this.operator==="interpolate-hcl"?Cd.reverse(Cd.interpolate(Cd.forward(w),Cd.forward(S),y)):bh.reverse(bh.interpolate(bh.forward(w),bh.forward(S),y))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function wh(n,e,i,s){const a=s-i,f=n-i;return a===0?0:e===1?f/a:(Math.pow(e,f)-1)/(Math.pow(e,a)-1)}class nc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const a=i.expectedType;a&&a.kind!=="value"&&(s=a);const f=[];for(const y of e.slice(1)){const w=i.parse(y,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!w)return null;s=s||w.type,f.push(w)}const m=a&&f.some(y=>Zl(a,y.type));return new nc(m?An:s,f)}evaluate(e){let i,s=null,a=0;for(const f of this.args){if(a++,s=f.evaluate(e),s&&s instanceof Oo&&!s.available&&(i||(i=s),s=null,a===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ya{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=i.parse(e[f+1],f+1);if(!y)return null;s.push([m,y])}const a=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return a?new ya(s,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class Th{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,ri),a=i.parse(e[2],2,oo(i.expectedType||An));return s&&a?new Th(a.type.itemType,s,a):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Pr("Array index out of bounds: negative index");if(i>=s.length)throw new Pr("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new Pr("Array index must be an integer. Use at-interpolated for fractional indices");return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class rc{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,ri),a=i.parse(e[2],2,oo(i.expectedType||An));return s&&a?new rc(a.type.itemType,s,a):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Pr(`Array index out of bounds: ${i} < 0.`);if(i>s.length-1)throw new Pr(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i===Math.floor(i))return s[i];const a=Math.floor(i),f=Math.ceil(i),m=s[a],y=s[f];if(typeof m!="number"||typeof y!="number")throw new Pr(`Cannot interpolate between non-number values at index ${i}.`);const w=i-a;return m*(1-w)+y*w}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Lc{constructor(e,i){this.type=fn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,An),a=i.parse(e[2],2,An);return s&&a?Xp(s.type,[fn,_n,ri,Do,An])?new Lc(s,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Or(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!hh(i,["boolean","string","number","null"]))throw new Pr(`Expected first argument to be of type boolean, string, number or null, but found ${Or(ts(i))} instead.`);if(!hh(s,["string","array"]))throw new Pr(`Expected second argument to be of type array or string, but found ${Or(ts(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Sh{constructor(e,i,s){this.type=ri,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,An),a=i.parse(e[2],2,An);if(!s||!a)return null;if(!Xp(s.type,[fn,_n,ri,Do,An]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Or(s.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,ri);return f?new Sh(s,a,f):null}return new Sh(s,a)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!hh(i,["boolean","string","number","null"]))throw new Pr(`Expected first argument to be of type boolean, string, number or null, but found ${Or(ts(i))} instead.`);if(!hh(s,["string","array"]))throw new Pr(`Expected second argument to be of type array or string, but found ${Or(ts(s))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return s.indexOf(i,a)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Eh{constructor(e,i,s,a,f,m){this.inputType=e,this.type=i,this.input=s,this.cases=a,this.outputs=f,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const f={},m=[];for(let S=2;S<e.length-1;S+=2){let I=e[S];const M=e[S+1];Array.isArray(I)||(I=[I]);const O=i.concat(S);if(I.length===0)return O.error("Expected at least one branch label.");for(const F of I){if(typeof F!="number"&&typeof F!="string")return O.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return O.error("Numeric branch labels must be integer values.");if(s){if(O.checkSubtype(s,ts(F)))return null}else s=ts(F);if(f[String(F)]!==void 0)return O.error("Branch labels must be unique.");f[String(F)]=m.length}const L=i.parse(M,S,a);if(!L)return null;a=a||L.type,m.push(L)}const y=i.parse(e[1],1,An);if(!y)return null;const w=i.parse(e[e.length-1],e.length-1,a);return w?y.type.kind!=="value"&&i.concat(1).checkSubtype(s,y.type)?null:new Eh(s,a,y,f,m,w):null}evaluate(e){const i=this.input.evaluate(e);return(md(ts(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],a={};for(const m of i){const y=a[this.cases[m]];y===void 0?(a[this.cases[m]]=s.length,s.push([this.cases[m],[m]])):s[y][1].push(m)}const f=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,y]of s)e.push(y.length===1?f(y[0]):y.map(f)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class Id{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const a=[];for(let m=1;m<e.length-1;m+=2){const y=i.parse(e[m],m,fn);if(!y)return null;const w=i.parse(e[m+1],m+1,s);if(!w)return null;a.push([y,w]),s=s||w.type}const f=i.parse(e[e.length-1],e.length-1,s);return f?new Id(s,a,f):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Rd{constructor(e,i,s,a){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,An),a=i.parse(e[2],2,ri);if(!s||!a)return null;if(!Xp(s.type,[oo(An),_n,An]))return i.error(`Expected first argument to be of type array or string, but found ${Or(s.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,ri);return f?new Rd(s.type,s,a,f):null}return new Rd(s.type,s,a)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!hh(i,["string","array"]))throw new Pr(`Expected first argument to be of type array or string, but found ${Or(ts(i))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return i.slice(s,a)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class sc{constructor(e,i){this.type=oo(_n),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,_n),a=i.parse(e[2],2,_n);return s&&a?new sc(s,a):void 0}evaluate(e){const i=this.str.evaluate(e),s=this.delimiter.evaluate(e);return i.split(s)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Md(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ah(n,e,i,s){return s.compare(e,i)===0}function yu(n,e,i){const s=n!=="=="&&n!=="!=";return class eR{constructor(f,m,y){this.type=fn,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const y=f[0];let w=m.parse(f[1],1,An);if(!w)return null;if(!Md(y,w.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${Or(w.type)}'.`);let S=m.parse(f[2],2,An);if(!S)return null;if(!Md(y,S.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${Or(S.type)}'.`);if(w.type.kind!==S.type.kind&&w.type.kind!=="value"&&S.type.kind!=="value")return m.error(`Cannot compare types '${Or(w.type)}' and '${Or(S.type)}'.`);s&&(w.type.kind==="value"&&S.type.kind!=="value"?w=new wi(S.type,[w]):w.type.kind!=="value"&&S.type.kind==="value"&&(S=new wi(w.type,[S])));let I=null;if(f.length===4){if(w.type.kind!=="string"&&S.type.kind!=="string"&&w.type.kind!=="value"&&S.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(I=m.parse(f[3],3,Ef),!I)return null}return new eR(w,S,I)}evaluate(f){const m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const w=ts(m),S=ts(y);if(w.kind!==S.kind||w.kind!=="string"&&w.kind!=="number")throw new Pr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${S.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const w=ts(m),S=ts(y);if(w.kind!=="string"||S.kind!=="string")return e(f,m,y)}return this.collator?i(f,m,y,this.collator.evaluate(f)):e(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(m=>{f.push(m.serialize())}),f}}}const Ch=yu("==",function(n,e,i){return e===i},Ah),tm=yu("!=",function(n,e,i){return e!==i},function(n,e,i,s){return!Ah(0,e,i,s)}),Dd=yu("<",function(n,e,i){return e<i},function(n,e,i,s){return s.compare(e,i)<0}),Od=yu(">",function(n,e,i){return e>i},function(n,e,i,s){return s.compare(e,i)>0}),Pd=yu("<=",function(n,e,i){return e<=i},function(n,e,i,s){return s.compare(e,i)<=0}),Rg=yu(">=",function(n,e,i){return e>=i},function(n,e,i,s){return s.compare(e,i)>=0});class Il{constructor(e,i,s,a,f,m){this.type=_n,this.number=e,this.locale=i,this.currency=s,this.unit=a,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,ri);if(!s)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let f=null;if(a.locale&&(f=i.parseObjectValue(a.locale,2,"locale",_n),!f))return null;let m=null;if(a.currency&&(m=i.parseObjectValue(a.currency,2,"currency",_n),!m))return null;let y=null;if(a.unit&&(y=i.parseObjectValue(a.unit,2,"unit",_n),!y))return null;let w=null;if(a["min-fraction-digits"]&&(w=i.parseObjectValue(a["min-fraction-digits"],2,"min-fraction-digits",ri),!w))return null;let S=null;return a["max-fraction-digits"]&&(S=i.parseObjectValue(a["max-fraction-digits"],2,"max-fraction-digits",ri),!S)?null:new Il(s,f,m,y,w,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class oc{constructor(e){this.type=ri,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Or(s.type)} instead.`):new oc(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Pr(`Expected value to be of type string or array, but found ${Or(ts(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function im(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const kc={"==":Ch,"!=":tm,">":Od,"<":Dd,">=":Rg,"<=":Pd,array:wi,at:Th,"at-interpolated":rc,boolean:wi,case:Id,coalesce:nc,collator:ea,format:ii,image:uu,in:Lc,"index-of":Sh,interpolate:ar,"interpolate-hcl":ar,"interpolate-lab":ar,length:oc,let:ya,literal:fa,match:Eh,number:wi,"number-format":Il,object:wi,slice:Rd,step:Ja,string:wi,"to-boolean":bl,"to-color":bl,"to-number":bl,"to-string":bl,var:Ka,within:Yl,distance:Ql,config:Oc,split:sc};function Bc(n,[e,i,s,a]){e=e.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const f=a?a.evaluate(n):1,m=Yp(e,i,s,f);if(m)throw new Pr(m);return new xn(e/255,i/255,s/255,f)}function Ih(n,[e,i,s,a]){e=e.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const f=a?a.evaluate(n):1,m=(function(S,I,M,O){return typeof S=="number"&&S>=0&&S<=360?typeof I=="number"&&I>=0&&I<=100&&typeof M=="number"&&M>=0&&M<=100?O===void 0||typeof O=="number"&&O>=0&&O<=1?null:`Invalid hsla value [${[S,I,M,O].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof O=="number"?[S,I,M,O]:[S,I,M]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof O=="number"?[S,I,M,O]:[S,I,M]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,s,f);if(m)throw new Pr(m);const y=`hsla(${e}, ${i}%, ${s}%, ${f})`,w=xn.parse(y);if(!w)throw new Pr(`Failed to parse HSLA color: ${y}`);return w}function zd(n,e){return n in e}function vu(n,e){const i=e[n];return i===void 0?null:i}function Qa(n){return{type:n}}function Fc(n){if(n instanceof Oc)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,...Fc(i)])}),e}function Rl(n){if(n instanceof Po&&n.name==="is-active-floor")return!0;let e=!1;return n.eachChild(i=>{!e&&Rl(i)&&(e=!0)}),e}function nm(n){return{result:"success",value:n}}function Bo(n){return{result:"error",value:n}}function Ld(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function Rh(n){return n["property-type"]==="data-driven"}function Ml(n){return Ld(n.expression,"measure-light")}function ac(n){return Ld(n.expression,"zoom")}function xu(n){return!!n.expression&&n.expression.interpolated}function Mh(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function jf(n){return n}function bu(n,e){const i=e.type==="color",s=n.stops&&typeof n.stops[0][0]=="object",a=s||!(s||n.property!==void 0),f=n.type||(xu(e)?"exponential":"interval");if(i&&((n=Object.assign({},n)).stops&&(n.stops=n.stops.map(S=>[S[0],xn.parse(S[1])])),n.default=xn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Ig[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let m,y,w;if(f==="exponential")m=Tu;else if(f==="interval")m=Mg;else if(f==="categorical"){m=wu,y=Object.create(null);for(const S of n.stops)y[S[0]]=S[1];w=typeof n.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);m=Uf}if(s){const S={},I=[];for(let L=0;L<n.stops.length;L++){const F=n.stops[L],G=F[0].zoom;S[G]===void 0&&(S[G]={zoom:G,type:n.type,property:n.property,default:n.default,stops:[]},I.push(G)),S[G].stops.push([F[0].value,F[1]])}const M=[];for(const L of I)M.push([S[L].zoom,bu(S[L],e)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:ar.interpolationFactor.bind(void 0,O),zoomStops:M.map(L=>L[0]),evaluate:({zoom:L},F)=>Tu({stops:M,base:n.base},e,L).evaluate(L,F)}}if(a){const S=f==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:ar.interpolationFactor.bind(void 0,S),zoomStops:n.stops.map(I=>I[0]),evaluate:({zoom:I})=>m(n,e,I,y,w)}}return{kind:"source",evaluate(S,I){const M=I&&I.properties?I.properties[n.property]:void 0;return M===void 0?lc(n.default,e.default):m(n,e,M,y,w)}}}function lc(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function wu(n,e,i,s,a){return lc(typeof i===a?s[i]:void 0,n.default,e.default)}function Mg(n,e,i){if(!gi(i))return lc(n.default,e.default);const s=n.stops.length;if(s===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[s-1][0])return n.stops[s-1][1];const a=ec(n.stops.map(f=>f[0]),i);return n.stops[a][1]}function Tu(n,e,i){const s=n.base!==void 0?n.base:1;if(!gi(i))return lc(n.default,e.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const f=ec(n.stops.map(I=>I[0]),i),m=(function(I,M,O,L){const F=L-O,G=I-O;return F===0?0:M===1?G/F:(Math.pow(M,G)-1)/(Math.pow(M,F)-1)})(i,s,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],w=n.stops[f+1][1];let S=lu[e.type]||jf;if(n.colorSpace&&n.colorSpace!=="rgb"){const I=Ig[n.colorSpace];S=(M,O)=>I.reverse(I.interpolate(I.forward(M),I.forward(O),m))}return typeof y.evaluate=="function"?{evaluate(...I){const M=y.evaluate.apply(void 0,I),O=w.evaluate.apply(void 0,I);if(M!==void 0&&O!==void 0)return S(M,O,m)}}:S(y,w,m)}function Uf(n,e,i){return e.type==="color"?i=xn.parse(i):e.type==="formatted"?i=$s.fromString(i.toString()):e.type==="resolvedImage"?i=Oo.build(i.toString()):xi(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),lc(i,n.default,e.default)}Po.register(kc,{error:[{kind:"error"},[_n],(n,[e])=>{throw new Pr(e.evaluate(n))}],typeof:[_n,[An],(n,[e])=>Or(ts(e.evaluate(n)))],"to-rgba":[oo(ri,4),[vo],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[oo(ri,4),[vo],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[vo,[ri,ri,ri],Bc],rgba:[vo,[ri,ri,ri,ri],Bc],hsl:[vo,[ri,ri,ri],Ih],hsla:[vo,[ri,ri,ri,ri],Ih],has:{type:fn,overloads:[[[_n],(n,[e])=>zd(e.evaluate(n),n.properties())],[[_n,ch],(n,[e,i])=>zd(e.evaluate(n),i.evaluate(n))]]},get:{type:An,overloads:[[[_n],(n,[e])=>vu(e.evaluate(n),n.properties())],[[_n,ch],(n,[e,i])=>vu(e.evaluate(n),i.evaluate(n))]]},"feature-state":[An,[_n],(n,[e])=>vu(e.evaluate(n),n.featureState||{})],properties:[ch,[],n=>n.properties()],"geometry-type":[_n,[],n=>n.geometryType()],worldview:[_n,[],n=>n.globals.worldview||""],"is-active-floor":[fn,Qa(_n),(n,e)=>{if(!(n.globals.activeFloors&&n.globals.activeFloors.size>0))return!1;const i=n.globals.activeFloors;return e.some(s=>{const a=s.evaluate(n);return i.has(a)})}],id:[An,[],n=>n.id()],zoom:[ri,[],n=>n.globals.zoom],pitch:[ri,[],n=>n.globals.pitch||0],"distance-from-center":[ri,[],n=>n.distanceFromCenter()],"measure-light":[ri,[_n],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[ri,[],n=>n.globals.heatmapDensity||0],"line-progress":[ri,[],n=>n.globals.lineProgress||0],"raster-value":[ri,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[ri,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[ri,[],n=>n.globals.skyRadialProgress||0],accumulated:[An,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[ri,Qa(ri),(n,e)=>{let i=0;for(const s of e)i+=s.evaluate(n);return i}],"*":[ri,Qa(ri),(n,e)=>{let i=1;for(const s of e)i*=s.evaluate(n);return i}],"-":{type:ri,overloads:[[[ri,ri],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[ri],(n,[e])=>-e.evaluate(n)]]},"/":[ri,[ri,ri],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[ri,[ri,ri],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[ri,[],()=>Math.LN2],pi:[ri,[],()=>Math.PI],e:[ri,[],()=>Math.E],"^":[ri,[ri,ri],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[ri,[ri],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[ri,[ri],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[ri,[ri],(n,[e])=>Math.log(e.evaluate(n))],log2:[ri,[ri],(n,[e])=>Math.log2(e.evaluate(n))],sin:[ri,[ri],(n,[e])=>Math.sin(e.evaluate(n))],cos:[ri,[ri],(n,[e])=>Math.cos(e.evaluate(n))],tan:[ri,[ri],(n,[e])=>Math.tan(e.evaluate(n))],asin:[ri,[ri],(n,[e])=>Math.asin(e.evaluate(n))],acos:[ri,[ri],(n,[e])=>Math.acos(e.evaluate(n))],atan:[ri,[ri],(n,[e])=>Math.atan(e.evaluate(n))],min:[ri,Qa(ri),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[ri,Qa(ri),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[ri,[ri],(n,[e])=>Math.abs(e.evaluate(n))],round:[ri,[ri],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[ri,[ri],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[ri,[ri],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[fn,[_n,An],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[fn,[An],(n,[e])=>n.id()===e.value],"filter-type-==":[fn,[_n],(n,[e])=>n.geometryType()===e.value],"filter-<":[fn,[_n,An],(n,[e,i])=>{const s=n.properties()[e.value],a=i.value;return typeof s==typeof a&&s<a}],"filter-id-<":[fn,[An],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[fn,[_n,An],(n,[e,i])=>{const s=n.properties()[e.value],a=i.value;return typeof s==typeof a&&s>a}],"filter-id->":[fn,[An],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[fn,[_n,An],(n,[e,i])=>{const s=n.properties()[e.value],a=i.value;return typeof s==typeof a&&s<=a}],"filter-id-<=":[fn,[An],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[fn,[_n,An],(n,[e,i])=>{const s=n.properties()[e.value],a=i.value;return typeof s==typeof a&&s>=a}],"filter-id->=":[fn,[An],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[fn,[An],(n,[e])=>e.value in n.properties()],"filter-has-id":[fn,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[fn,[oo(_n)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[fn,[oo(An)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[fn,[_n,oo(An)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[fn,[_n,oo(An)],(n,[e,i])=>(function(s,a,f,m){for(;f<=m;){const y=f+m>>1;if(a[y]===s)return!0;a[y]>s?m=y-1:f=y+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:fn,overloads:[[[fn,fn],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[Qa(fn),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:fn,overloads:[[[fn,fn],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[Qa(fn),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[fn,[fn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[fn,[_n],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[_n,[_n],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[_n,[_n],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[_n,Qa(An),(n,e)=>e.map(i=>$a(i.evaluate(n))).join("")],"resolved-locale":[_n,[Ef],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[ri,[ri,ri,An],(n,e)=>{const[i,s,a]=e.map(m=>m.evaluate(n));if(i>s||i===s)return i;let f;if(typeof a=="string")f=(function(m){let y=0;if(m.length===0)return y;for(let w=0;w<m.length;w++)y=(y<<5)-y+m.charCodeAt(w),y&=y;return y})(a);else{if(typeof a!="number")throw new Pr(`Invalid seed input: ${a}`);f=a}return i+im(f)()*(s-i)}]});class kd{constructor(e,i,s,a,f){this.expression=e,this._warningHistory={},this._scope=s,this._options=a,this._iconImageUseTheme=f,this._evaluator=new ph(s,a,f),this._defaultValue=i?(function(m){return m.type==="color"&&(Mh(m.default)||Array.isArray(m.default))?new xn(0,0,0,0):m.type==="color"?xn.parse(m.default)||null:m.default===void 0?null:m.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Fc(e),this.isIndoorDependent=Rl(e)}evaluateWithoutErrorHandling(e,i,s,a,f,m,y,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=a||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,a,f,m,y,w,S){this._evaluator||(this._evaluator=new ph(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=w||null,this._evaluator.iconImageUseTheme=S||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Pr(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){const M=I;return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function Su(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in kc}function Dl(n,e,i,s,a){const f=new Sd(kc,[],e?(function(y){const w={color:vo,string:_n,number:ri,enum:_n,boolean:fn,formatted:uh,resolvedImage:cu};return y.type==="array"?oo(w[y.value]||An,y.length):w[y.type]})(e):void 0,void 0,void 0,i,s,a),m=f.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?nm(new kd(m,e,i,s,a)):Bo(f.errors)}class lo{constructor(e,i,s,a){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isLineProgressConstant=a,this.isStateDependent=e!=="constant"&&!fs(i.expression),this.configDependencies=Fc(i.expression),this.isIndoorDependent=Rl(i.expression)}evaluateWithoutErrorHandling(e,i,s,a,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,a,f,m)}evaluate(e,i,s,a,f,m,y){return this._styleExpression.evaluate(e,i,s,a,f,m,void 0,void 0,y)}}class Ws{constructor(e,i,s,a,f,m){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!fs(i.expression),this.isIndoorDependent=Rl(i.expression),this.isLightConstant=f,this.isLineProgressConstant=m,this.configDependencies=Fc(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,s,a,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,a,f,m)}evaluate(e,i,s,a,f,m){return this._styleExpression.evaluate(e,i,s,a,f,m)}interpolationFactor(e,i,s){return this.interpolationType?ar.interpolationFactor(this.interpolationType,e,i,s):0}}function el(n,e,i,s,a){if((n=Dl(n,e,i,s,a)).result==="error")return n;const f=n.value.expression,m=gu(f);if(!m&&!Rh(e))return Bo([new Hs("","data expressions not supported")]);const y=wr(f,["zoom","pitch","distance-from-center"]);if(!y&&!ac(e))return Bo([new Hs("","zoom expressions not supported")]);const w=wr(f,["measure-light"]);if(!w&&!Ml(e))return Bo([new Hs("","measure-light expression not supported")]);const S=wr(f,["line-progress"]);if(!S&&!(function(O){return Ld(O.expression,"line-progress")})(e))return Bo([new Hs("","line-progress expression not supported")]);const I=e.expression&&e.expression.relaxZoomRestriction,M=Bd(f);return M||y||I?M instanceof Hs?Bo([M]):M instanceof ar&&!xu(e)?Bo([new Hs("",'"interpolate" expressions cannot be used with this property')]):nm(M?new Ws(m&&S?"camera":"composite",n.value,M.labels,M instanceof ar?M.interpolation:void 0,w,S):new lo(m&&S?"constant":"source",n.value,w,S)):Bo([new Hs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Eu{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,bu(this._parameters,this._specification))}static deserialize(e){return new Eu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Bd(n){let e=null;if(n instanceof ya)e=Bd(n.result);else if(n instanceof nc){for(const i of n.args)if(e=Bd(i),e)break}else(n instanceof Ja||n instanceof ar)&&n.input instanceof Po&&n.input.name==="zoom"&&(e=n);return e instanceof Hs||n.eachChild(i=>{const s=Bd(i);s instanceof Hs?e=s:e&&s&&e!==s&&(e=new Hs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var co,ia,ps=(function(){if(ia)return co;ia=1,co=e;var n=3;function e(i,s,a){var f=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var m=new Int32Array(this.arrayBuffer);i=m[0],this.d=(s=m[1])+2*(a=m[2]);for(var y=0;y<this.d*this.d;y++){var w=m[n+y],S=m[n+y+1];f.push(w===S?null:m.subarray(w,S))}var I=m[n+f.length+1];this.keys=m.subarray(m[n+f.length],I),this.bboxes=m.subarray(I),this.insert=this._insertReadonly}else{this.d=s+2*a;for(var M=0;M<this.d*this.d;M++)f.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=a,this.scale=s/i,this.uid=0;var O=a/s*i;this.min=-O,this.max=i+O}return e.prototype.insert=function(i,s,a,f,m){this._forEachCell(s,a,f,m,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,s,a,f,m,y){this.cells[m].push(y)},e.prototype.query=function(i,s,a,f,m){var y=this.min,w=this.max;if(i<=y&&s<=y&&w<=a&&w<=f&&!m)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(i,s,a,f,this._queryCell,S,{},m),S},e.prototype._queryCell=function(i,s,a,f,m,y,w,S){var I=this.cells[m];if(I!==null)for(var M=this.keys,O=this.bboxes,L=0;L<I.length;L++){var F=I[L];if(w[F]===void 0){var G=4*F;(S?S(O[G+0],O[G+1],O[G+2],O[G+3]):i<=O[G+2]&&s<=O[G+3]&&a>=O[G+0]&&f>=O[G+1])?(w[F]=!0,y.push(M[F])):w[F]=!1}}},e.prototype._forEachCell=function(i,s,a,f,m,y,w,S){for(var I=this._convertToCellCoord(i),M=this._convertToCellCoord(s),O=this._convertToCellCoord(a),L=this._convertToCellCoord(f),F=I;F<=O;F++)for(var G=M;G<=L;G++){var W=this.d*G+F;if((!S||S(this._convertFromCellCoord(F),this._convertFromCellCoord(G),this._convertFromCellCoord(F+1),this._convertFromCellCoord(G+1)))&&m.call(this,i,s,a,f,W,y,w,S))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=n+this.cells.length+1+1,a=0,f=0;f<this.cells.length;f++)a+=this.cells[f].length;var m=new Int32Array(s+a+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var y=s,w=0;w<i.length;w++){var S=i[w];m[n+w]=y,m.set(S,y),y+=S.length}return m[n+i.length]=y,m.set(this.keys,y),m[n+i.length+1]=y+=this.keys.length,m.set(this.bboxes,y),y+=this.bboxes.length,m.buffer},co})(),Ol=In(ps);const Ba={};function Mt(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),Ba[e]={klass:n,omit:i.omit||[]}}Mt(Object,"Object"),Ol.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},Ol.deserialize=function(n){return new Ol(n.buffer)},Object.defineProperty(Ol,"name",{value:"Grid"}),Mt(Ol,"Grid"),delete pt.prototype.constructor,Mt(xn,"Color"),Mt(Error,"Error"),Mt($s,"Formatted"),Mt(gd,"FormattedSection"),Mt(su,"AJAXError"),Mt(Oo,"ResolvedImage"),Mt(Eu,"StylePropertyFunction"),Mt(kd,"StyleExpression",{omit:["_evaluator"]}),Mt(so,"ImageId"),Mt(Cs,"ImageVariant"),Mt(Ws,"ZoomDependentExpression"),Mt(lo,"ZoomConstantExpression"),Mt(Po,"CompoundExpression",{omit:["_evaluate"]});for(const n in kc)Ba[kc[n]._classRegistryKey]||Mt(kc[n],`Expression${n}`);function Tr(n){return n&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Sr(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Tr(n)||n instanceof ImageBitmap)return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const s of n)i.push(Sr(s,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[s,a]of n.entries())i.entries.push(Sr(s),Sr(a,e));return i}if(n instanceof Set){const i={$name:"Set"};let s=0;for(const a of n.values())i[++s]=Sr(a);return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,s=i._classRegistryKey;if(!s)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const a=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const f in n)n.hasOwnProperty(f)&&(Ba[s].omit.indexOf(f)>=0||(a[f]=Sr(n[f],e)));n instanceof Error&&(a.message=n.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(a.$name=s),a}throw new Error("can't serialize object of type "+typeof n)}function Fa(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Tr(n)||n instanceof ImageBitmap||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Fa);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const a=n.entries||[],f=new Map;for(let m=0;m<a.length;m+=2)f.set(Fa(a[m]),Fa(a[m+1]));return f}if(e==="Set"){const a=new Set;for(const f of Object.keys(n))f!=="$name"&&a.add(Fa(n[f]));return a}if(e==="BigInt")return BigInt(n.value);const{klass:i}=Ba[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const s=Object.create(i.prototype);for(const a of Object.keys(n))a!=="$name"&&(s[a]=Fa(n[a]));return s}throw new Error("can't deserialize object of type "+typeof n)}const Au=n=>n>=1536&&n<=1791,Nc=n=>n>=1872&&n<=1919,Cu=n=>n>=2208&&n<=2303,jc=n=>n>=11904&&n<=12031,Uc=n=>n>=12032&&n<=12255,rm=n=>n>=12272&&n<=12287,zr=n=>n>=12288&&n<=12351,Vc=n=>n>=12352&&n<=12447,Iu=n=>n>=12448&&n<=12543,tl=n=>n>=12544&&n<=12591,sm=n=>n>=12704&&n<=12735,Dg=n=>n>=12736&&n<=12783,Vf=n=>n>=12784&&n<=12799,Gf=n=>n>=12800&&n<=13055,Fd=n=>n>=13056&&n<=13311,Is=n=>n>=13312&&n<=19903,Yr=n=>n>=19968&&n<=40959,Dh=n=>n>=40960&&n<=42127,Gc=n=>n>=42128&&n<=42191,Nd=n=>n>=44032&&n<=55215,qf=n=>n>=63744&&n<=64255,il=n=>n>=64336&&n<=65023,jd=n=>n>=65040&&n<=65055,Ud=n=>n>=65072&&n<=65103,Hf=n=>n>=65104&&n<=65135,$f=n=>n>=65136&&n<=65279,Zf=n=>n>=65280&&n<=65519;function Wf(n){for(const e of n)if(Pl(e.charCodeAt(0)))return!0;return!1}function Og(n){for(const e of n)if(!Pg(e.charCodeAt(0)))return!1;return!0}function Pg(n){return!(Au(n)||Nc(n)||Cu(n)||il(n)||$f(n))}function om(n){return!(n<11904||!(sm(n)||tl(n)||Ud(n)||qf(n)||Fd(n)||jc(n)||Dg(n)||zr(n)||Is(n)||Yr(n)||Gf(n)||Zf(n)||Vc(n)||rm(n)||Uc(n)||Vf(n)||Iu(n)||jd(n)||Gc(n)||Dh(n)))}function Pl(n){return!(n!==746&&n!==747&&(n<4352||!(sm(n)||tl(n)||Ud(n)&&!(n>=65097&&n<=65103)||qf(n)||Fd(n)||jc(n)||Dg(n)||!(!zr(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Is(n)||Yr(n)||Gf(n)||(e=>e>=12592&&e<=12687)(n)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||Nd(n)||Vc(n)||rm(n)||(e=>e>=12688&&e<=12703)(n)||Uc(n)||Vf(n)||Iu(n)&&n!==12540||!(!Zf(n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Hf(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||jd(n)||(e=>e>=19904&&e<=19967)(n)||Dh(n)||Gc(n))))}function am(n){return n===12312||n===12313||n===12316||n===12540||n===12448}function lm(n){return!(Pl(n)||(function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||zr(e)||Iu(e)||(i=>i>=57344&&i<=63743)(e)||Ud(e)||Hf(e)||Zf(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(n))}function Vd(n){return Au(n)||Nc(n)||Cu(n)||il(n)||$f(n)}function cm(n){return n>=1424&&n<=2303||il(n)||$f(n)}function zg(n,e){return!(!e&&cm(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(i=>i>=6016&&i<=6143)(n))}function zl(n){for(const e of n)if(cm(e.charCodeAt(0)))return!0;return!1}const To={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let cc=null,uo=To.unavailable,uc=null;const um=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(uo=To.error),cc&&cc(n)};function hm(){Xf.fire(new Pa("pluginStateChange",{pluginStatus:uo,pluginURL:uc}))}const Xf=new $l,qc=function(){return uo},Yf=function(){if(uo!==To.deferred||!uc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");uo=To.loading,hm(),uc&&ou({url:uc},n=>{n?um(n):(uo=To.loaded,hm())})},na={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>uo===To.loaded||na.applyArabicShaping!=null,isLoading:()=>uo===To.loading,setState(n){uo=n.pluginStatus,uc=n.pluginURL},isParsing:()=>uo===To.parsing,isParsed:()=>uo===To.parsed,getPluginURL:()=>uc};class bn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,s){for(const a of i)if(!zg(a.charCodeAt(0),s))return!1;return!0})(e,na.isLoaded())}}class Oh{constructor(e,i,s,a,f){this.property=e,this.value=i,this.expression=(function(m,y,w,S,I){if(Mh(m))return new Eu(m,y);if(Su(m)||Array.isArray(m)&&m.length>0){const M=el(m,y,w,S,I);if(M.result==="error")throw new Error(M.value.map(O=>`${O.key}: ${O.message}`).join(", "));return M.value}{let M=m;return typeof m=="string"&&y.type==="color"&&(M=xn.parse(m)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>M}}})(i===void 0?e.specification.default:i,e.specification,s,a,f)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s,a){return this.property.possiblyEvaluate(this,e,i,s,a)}}class Ru{constructor(e,i,s,a){this.property=e,this.value=new Oh(e,void 0,i,s,a)}transitioned(e,i){return new dm(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new dm(this.property,this.value,null,{},0)}}class Ph{constructor(e,i,s,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=a,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Mi(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ru(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Oh(this._values[e].property,i===null?void 0:Mi(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const a in e){const f=e[a];if(a.endsWith("-transition")){const m=a.slice(0,-11);s[m]&&this.setTransition(m,f)}else s.hasOwnProperty(a)&&this.setValue(a,f)}}getTransition(e){return Mi(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ru(this._values[e].property)),this._values[e].transition=Mi(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){const s=new fm(this._properties);for(const a of Object.keys(this._values))s._values[a]=this._values[a].transitioned(e,i._values[a]);return s}untransitioned(){const e=new fm(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class dm{constructor(e,i,s,a,f){const m=a.delay||0,y=a.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+m,this.end=this.begin+y,e.specification.transition&&(a.delay||a.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const a=e.now||0,f=this.value.possiblyEvaluate(e,i,s),m=this.prior;if(m){if(a>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(a<this.begin)return m.possiblyEvaluate(e,i,s);{const y=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,s),f,re(y))}}return f}}class fm{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const a=new ho(this._properties);for(const f of Object.keys(this._values))a._values[f]=this._values[f].possiblyEvaluate(e,i,s);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Kf{constructor(e,i,s,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=a,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Mi(this._values[e].value)}setValue(e,i){this._values[e]=new Oh(this._values[e].property,i===null?void 0:Mi(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s,a){const f=new ho(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].possiblyEvaluate(e,i,s,a);return f}isIndoorDependent(){return this._isIndoorDependent}}class Hc{constructor(e,i,s,a){this.property=e,this.value=i,this.parameters=s,this.iconImageUseTheme=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,a){return this.property.evaluate(this.value,this.parameters,e,i,s,a,this.iconImageUseTheme)}}class ho{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Dt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const a=lu[this.specification.type];return a?a(e,i,s):e}}class Ut{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,a,f){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Hc(this,{kind:"constant",value:e.expression.evaluate(i,null,{},s,a,void 0,f)},i):new Hc(this,e.expression,i,f)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Hc(this,{kind:"constant",value:void 0},e.parameters);const a=lu[this.specification.type];return a?new Hc(this,{kind:"constant",value:a(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,a,f,m,y){return e.kind==="constant"?e.value:e.evaluate(i,s,a,f,m,void 0,y)}}class Mu{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,a){return!!e.expression.evaluate(i,null,{},s,a)}interpolate(){return!1}}class nr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new bn(0,{});for(const s in e){const a=e[s];a.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new Oh(a,void 0),m=this.defaultTransitionablePropertyValues[s]=new Ru(a);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(i)}}}Mt(Ut,"DataDrivenProperty"),Mt(Dt,"DataConstantProperty"),Mt(Mu,"ColorRampProperty");var qe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"shadow-draw-before-layer":{"type":"string"}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"url":{"type":"string"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"model-allow-density-reduction":{"type":"boolean","default":true}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function pm(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Jf(n){if(Array.isArray(n))return n.map(Jf);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Jf(n[i]);return e}return pm(n)}function Gd(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Gd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Qf(n,e="",i=null,s="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gd(n)||(n=zh(n));const a=n;let f=!0;try{f=(function(I){if(!Du(I))return I;let M=Jf(I);return qd(M),M=mm(M),M})(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}let m=null,y=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){y=qe[`filter_${s}`];const I=Dl(f,y,e,i);if(I.result==="error")throw new Error(I.value.map(M=>`${M.key}: ${M.message}`).join(", "));m=(M,O,L)=>I.value.evaluate(M,O,{},L)}let w=null,S=null;if(f!==a){const I=Dl(a,y,e,i);if(I.result==="error")throw new Error(I.value.map(M=>`${M.key}: ${M.message}`).join(", "));w=(M,O,L,F,G)=>I.value.evaluate(M,O,{},L,void 0,void 0,F,G),S=!gu(I.value.expression)}return{filter:m,dynamicFilter:w||void 0,needGeometry:gm(f),needFeature:!!S}}function mm(n){if(!Array.isArray(n))return n;const e=(function(i){if(Lg.has(i[0])){for(let s=1;s<i.length;s++)if(Du(i[s]))return!0}return i})(n);return e===!0?e:e.map(i=>mm(i))}function qd(n){let e=!1;const i=[];if(n[0]==="case"){for(let s=1;s<n.length-1;s+=2)e=e||Du(n[s]),i.push(n[s+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||Du(n[1]);for(let s=2;s<n.length-1;s+=2)i.push(n[s+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||Du(n[1]);for(let s=1;s<n.length-1;s+=2)i.push(n[s+1])}e&&(n.length=0,n.push("any",...i));for(let s=1;s<n.length;s++)qd(n[s])}function Du(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(Du(n[i]))return!0;return!1}const Lg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Y_(n,e){return n<e?-1:n>e?1:0}function gm(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(gm(n[e]))return!0;return!1}function zh(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?ra(n[1],n[2],"=="):e==="!="?Zd(ra(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ra(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(zh))):e==="all"?["all"].concat(n.slice(1).map(zh)):e==="none"?["all"].concat(n.slice(1).map(zh).map(Zd)):e==="in"?Hd(n[1],n.slice(2)):e==="!in"?Zd(Hd(n[1],n.slice(2))):e==="has"?$d(n[1]):e!=="!has"||Zd($d(n[1]));var i}function ra(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Hd(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Y_)]]:["filter-in-small",n,["literal",e]]}}function $d(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Zd(n){return["!",n]}const Lh="";function nl(n,e){return e?`${n}${Lh}${e}`:n}let ep;const Wd=()=>ep||(ep=new nr({"icon-size":new Ut(qe.layout_symbol["icon-size"]),"icon-image":new Ut(qe.layout_symbol["icon-image"]),"icon-rotate":new Ut(qe.layout_symbol["icon-rotate"]),"icon-offset":new Ut(qe.layout_symbol["icon-offset"]),"text-size":new Ut(qe.layout_symbol["text-size"]),"text-rotate":new Ut(qe.layout_symbol["text-rotate"]),"text-offset":new Ut(qe.layout_symbol["text-offset"])}));class _m{constructor(e,i,s,a,f,m){const y=Dl(e,qe.appearance.condition);if(y.result==="success"&&(this.condition=y.value),this.name=i,s){this.properties=new ho(Wd()),this.unevaluatedLayout=new Kf(Wd(),a,f,m);for(const w in s)this.unevaluatedLayout.setValue(w,s[w])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,i,s){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,s))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),i=this.hasProperty("icon-size"),s=this.hasProperty("icon-offset"),a=this.hasProperty("icon-rotate");return e||i||s||a}hasTextProperties(){const e=this.hasProperty("text-size"),i=this.hasProperty("text-offset"),s=this.hasProperty("text-rotate");return e||i||s}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const tp="-transition",ip=new Set(["fill","line","background","hillshade","raster"]);class fo extends $l{constructor(e,i,s,a,f,m){if(super(),this.id=e.id,this.fqid=nl(this.id,s),this.type=e.type,this.scope=s,this.lut=a,this.options=f,this.iconImageUseTheme=m,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const y=Dl(this.filter,qe[`filter_${e.type}`]);y.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...y.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||y.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new Kf(i.layout,this.scope,f,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new Ph(i.paint,this.scope,f);for(const y in e.paint)this.setPaintProperty(y,e.paint[y]);for(const y in e.layout)this.setLayoutProperty(y,e.layout[y]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ho(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&ip.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(i=>{this.appearances.push(new _m(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(tp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const s=this._transitionablePaint,a=s._properties.properties;if(e.endsWith(tp)){const M=e.slice(0,-11);return a[M]&&s.setTransition(M,i||void 0),!1}if(!a[e])return!1;const f=s._values[e],m=f.value.isDataDriven(),y=f.value;s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const w=s._values[e].value,S=w.isDataDriven(),I=e.endsWith("pattern")||e==="line-dasharray";return S||m||I||this._handleOverridablePaintPropertyUpdate(e,y,w)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,s){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(i=>i.serialize())),hi(e,(i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Hc&&Rh(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!fs(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Qf(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,s){return{}}queryRadius(e){}queryIntersectsFeature(e,i,s,a,f,m,y,w,S,I){}}const ym={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class sa{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const kg=new ArrayBuffer(0);class qn{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,i){return e._trim(),i&&e.arrayBuffer&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,e.arrayBuffer?i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement:(i.capacity=0,i.arrayBuffer=kg),i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function $i(n,e=1){let i=0,s=0;return{members:n.map(a=>{const f=ym[a.type].BYTES_PER_ELEMENT,m=i=Xd(i,Math.max(e,f)),y=a.components||1;return s=Math.max(s,f),i+=f*y,{name:a.name,type:a.type,components:y,offset:m}}),size:Xd(i,Math.max(s,e)),alignment:e}}function Xd(n,e){return Math.ceil(n/e)*e}class hc extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const a=2*e;return this.int16[a+0]=i,this.int16[a+1]=s,e}}hc.prototype.bytesPerElement=4,Mt(hc,"StructArrayLayout2i4");class rl extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=a,e}}rl.prototype.bytesPerElement=6,Mt(rl,"StructArrayLayout3i6");class Ll extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,a)}emplace(e,i,s,a,f){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=s,this.int16[m+2]=a,this.int16[m+3]=f,e}}Ll.prototype.bytesPerElement=8,Mt(Ll,"StructArrayLayout4i8");class ms extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ms.prototype.bytesPerElement=4,Mt(ms,"StructArrayLayout1f4");class kh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const f=4*e,m=2*e;return this.int16[f+0]=i,this.int16[f+1]=s,this.float32[m+1]=a,e}}kh.prototype.bytesPerElement=8,Mt(kh,"StructArrayLayout2i1f8");class Yd extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=a,e}}Yd.prototype.bytesPerElement=8,Mt(Yd,"StructArrayLayout3i8");class ss extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,s,a,f)}emplace(e,i,s,a,f,m){const y=5*e;return this.int16[y+0]=i,this.int16[y+1]=s,this.int16[y+2]=a,this.int16[y+3]=f,this.int16[y+4]=m,e}}ss.prototype.bytesPerElement=10,Mt(ss,"StructArrayLayout5i10");class Ls extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,a,f,m,y)}emplace(e,i,s,a,f,m,y,w){const S=6*e,I=12*e,M=3*e;return this.int16[S+0]=i,this.int16[S+1]=s,this.uint8[I+4]=a,this.uint8[I+5]=f,this.uint8[I+6]=m,this.uint8[I+7]=y,this.float32[M+2]=w,e}}Ls.prototype.bytesPerElement=12,Mt(Ls,"StructArrayLayout2i4ub1f12");class va extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=a,e}}va.prototype.bytesPerElement=12,Mt(va,"StructArrayLayout3f12");class sl extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,s,a,f)}emplace(e,i,s,a,f,m){const y=6*e,w=3*e;return this.uint16[y+0]=i,this.uint16[y+1]=s,this.uint16[y+2]=a,this.uint16[y+3]=f,this.float32[w+2]=m,e}}sl.prototype.bytesPerElement=12,Mt(sl,"StructArrayLayout4ui1f12");class Ou extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,a)}emplace(e,i,s,a,f){const m=4*e;return this.uint16[m+0]=i,this.uint16[m+1]=s,this.uint16[m+2]=a,this.uint16[m+3]=f,e}}Ou.prototype.bytesPerElement=8,Mt(Ou,"StructArrayLayout4ui8");class Pu extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,a,f,m)}emplace(e,i,s,a,f,m,y){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=a,this.int16[w+3]=f,this.int16[w+4]=m,this.int16[w+5]=y,e}}Pu.prototype.bytesPerElement=12,Mt(Pu,"StructArrayLayout6i12");class zu extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m,y,w,S,I,M,O){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,s,a,f,m,y,w,S,I,M,O)}emplace(e,i,s,a,f,m,y,w,S,I,M,O,L){const F=12*e;return this.int16[F+0]=i,this.int16[F+1]=s,this.int16[F+2]=a,this.int16[F+3]=f,this.uint16[F+4]=m,this.uint16[F+5]=y,this.uint16[F+6]=w,this.uint16[F+7]=S,this.int16[F+8]=I,this.int16[F+9]=M,this.int16[F+10]=O,this.int16[F+11]=L,e}}zu.prototype.bytesPerElement=24,Mt(zu,"StructArrayLayout4i4ui4i24");class np extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,a,f,m)}emplace(e,i,s,a,f,m,y){const w=10*e,S=5*e;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=a,this.float32[S+2]=f,this.float32[S+3]=m,this.float32[S+4]=y,e}}np.prototype.bytesPerElement=20,Mt(np,"StructArrayLayout3i3f20");class ol extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,a)}emplace(e,i,s,a,f){const m=4*e;return this.float32[m+0]=i,this.float32[m+1]=s,this.float32[m+2]=a,this.float32[m+3]=f,e}}ol.prototype.bytesPerElement=16,Mt(ol,"StructArrayLayout4f16");class rp extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}rp.prototype.bytesPerElement=4,Mt(rp,"StructArrayLayout1ul4");class xa extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=s,e}}xa.prototype.bytesPerElement=4,Mt(xa,"StructArrayLayout2ui4");class $c extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m,y,w,S,I,M,O,L){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,s,a,f,m,y,w,S,I,M,O,L)}emplace(e,i,s,a,f,m,y,w,S,I,M,O,L,F){const G=20*e,W=10*e;return this.int16[G+0]=i,this.int16[G+1]=s,this.int16[G+2]=a,this.int16[G+3]=f,this.int16[G+4]=m,this.float32[W+3]=y,this.float32[W+4]=w,this.float32[W+5]=S,this.float32[W+6]=I,this.int16[G+14]=M,this.uint32[W+8]=O,this.uint16[G+18]=L,this.uint16[G+19]=F,e}}$c.prototype.bytesPerElement=40,Mt($c,"StructArrayLayout5i4f1i1ul2ui40");class Bh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,a,f,m,y)}emplace(e,i,s,a,f,m,y,w){const S=8*e;return this.int16[S+0]=i,this.int16[S+1]=s,this.int16[S+2]=a,this.int16[S+4]=f,this.int16[S+5]=m,this.int16[S+6]=y,this.int16[S+7]=w,e}}Bh.prototype.bytesPerElement=16,Mt(Bh,"StructArrayLayout3i2i2i16");class Kd extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,s,a,f)}emplace(e,i,s,a,f,m){const y=4*e,w=8*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=a,this.int16[w+6]=f,this.int16[w+7]=m,e}}Kd.prototype.bytesPerElement=16,Mt(Kd,"StructArrayLayout2f1f2i16");class Jd extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,a,f,m)}emplace(e,i,s,a,f,m,y){const w=20*e,S=5*e;return this.uint8[w+0]=i,this.uint8[w+1]=s,this.float32[S+1]=a,this.float32[S+2]=f,this.float32[S+3]=m,this.float32[S+4]=y,e}}Jd.prototype.bytesPerElement=20,Mt(Jd,"StructArrayLayout2ub4f20");class Kr extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=s,this.uint16[f+2]=a,e}}Kr.prototype.bytesPerElement=6,Mt(Kr,"StructArrayLayout3ui6");class Lu extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W,$,K,te,se,pe){const de=this.length;return this.resize(de+1),this.emplace(de,e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W,$,K,te,se,pe)}emplace(e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W,$,K,te,se,pe,de){const be=30*e,Te=15*e,ve=60*e;return this.int16[be+0]=i,this.int16[be+1]=s,this.int16[be+2]=a,this.float32[Te+2]=f,this.float32[Te+3]=m,this.uint16[be+8]=y,this.uint16[be+9]=w,this.uint32[Te+5]=S,this.uint32[Te+6]=I,this.uint32[Te+7]=M,this.uint16[be+16]=O,this.uint16[be+17]=L,this.uint16[be+18]=F,this.float32[Te+10]=G,this.float32[Te+11]=W,this.uint8[ve+48]=$,this.uint8[ve+49]=K,this.uint8[ve+50]=te,this.uint32[Te+13]=se,this.int16[be+28]=pe,this.uint8[ve+58]=de,e}}Lu.prototype.bytesPerElement=60,Mt(Lu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Zc extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W,$,K,te,se,pe,de,be,Te,ve,Ce,ze,it,Je,tt,dt,ut,ht){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W,$,K,te,se,pe,de,be,Te,ve,Ce,ze,it,Je,tt,dt,ut,ht)}emplace(e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W,$,K,te,se,pe,de,be,Te,ve,Ce,ze,it,Je,tt,dt,ut,ht,Ye){const mt=20*e,at=40*e,_t=80*e;return this.float32[mt+0]=i,this.float32[mt+1]=s,this.int16[at+4]=a,this.int16[at+5]=f,this.int16[at+6]=m,this.int16[at+7]=y,this.int16[at+8]=w,this.int16[at+9]=S,this.int16[at+10]=I,this.int16[at+11]=M,this.int16[at+12]=O,this.uint16[at+13]=L,this.uint16[at+14]=F,this.uint16[at+15]=G,this.uint16[at+16]=W,this.uint16[at+17]=$,this.uint16[at+18]=K,this.uint16[at+19]=te,this.uint16[at+20]=se,this.uint16[at+21]=pe,this.uint16[at+22]=de,this.uint16[at+23]=be,this.uint16[at+24]=Te,this.uint16[at+25]=ve,this.uint16[at+26]=Ce,this.uint16[at+27]=ze,this.uint32[mt+14]=it,this.float32[mt+15]=Je,this.float32[mt+16]=tt,this.float32[mt+17]=dt,this.float32[mt+18]=ut,this.uint8[_t+76]=ht,this.uint16[at+39]=Ye,e}}Zc.prototype.bytesPerElement=80,Mt(Zc,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Fh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,a,f,m)}emplace(e,i,s,a,f,m,y){const w=6*e;return this.float32[w+0]=i,this.float32[w+1]=s,this.float32[w+2]=a,this.float32[w+3]=f,this.float32[w+4]=m,this.float32[w+5]=y,e}}Fh.prototype.bytesPerElement=24,Mt(Fh,"StructArrayLayout6f24");class Wc extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,s,a,f)}emplace(e,i,s,a,f,m){const y=5*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=a,this.float32[y+3]=f,this.float32[y+4]=m,e}}Wc.prototype.bytesPerElement=20,Mt(Wc,"StructArrayLayout5f20");class Nh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,a,f,m,y)}emplace(e,i,s,a,f,m,y,w){const S=7*e;return this.float32[S+0]=i,this.float32[S+1]=s,this.float32[S+2]=a,this.float32[S+3]=f,this.float32[S+4]=m,this.float32[S+5]=y,this.float32[S+6]=w,e}}Nh.prototype.bytesPerElement=28,Mt(Nh,"StructArrayLayout7f28");class jh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m,y,w,S,I,M){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,s,a,f,m,y,w,S,I,M)}emplace(e,i,s,a,f,m,y,w,S,I,M,O){const L=11*e;return this.float32[L+0]=i,this.float32[L+1]=s,this.float32[L+2]=a,this.float32[L+3]=f,this.float32[L+4]=m,this.float32[L+5]=y,this.float32[L+6]=w,this.float32[L+7]=S,this.float32[L+8]=I,this.float32[L+9]=M,this.float32[L+10]=O,e}}jh.prototype.bytesPerElement=44,Mt(jh,"StructArrayLayout11f44");class ku extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m,y,w,S){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,s,a,f,m,y,w,S)}emplace(e,i,s,a,f,m,y,w,S,I){const M=9*e;return this.float32[M+0]=i,this.float32[M+1]=s,this.float32[M+2]=a,this.float32[M+3]=f,this.float32[M+4]=m,this.float32[M+5]=y,this.float32[M+6]=w,this.float32[M+7]=S,this.float32[M+8]=I,e}}ku.prototype.bytesPerElement=36,Mt(ku,"StructArrayLayout9f36");class Xc extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const a=2*e;return this.float32[a+0]=i,this.float32[a+1]=s,e}}Xc.prototype.bytesPerElement=8,Mt(Xc,"StructArrayLayout2f8");class Qd extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,a)}emplace(e,i,s,a,f){const m=6*e;return this.uint32[3*e+0]=i,this.uint16[m+2]=s,this.uint16[m+3]=a,this.uint16[m+4]=f,e}}Qd.prototype.bytesPerElement=12,Mt(Qd,"StructArrayLayout1ul3ui12");class Uh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Uh.prototype.bytesPerElement=2,Mt(Uh,"StructArrayLayout1ui2");class al extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W){const $=this.length;return this.resize($+1),this.emplace($,e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W)}emplace(e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W,$){const K=16*e;return this.float32[K+0]=i,this.float32[K+1]=s,this.float32[K+2]=a,this.float32[K+3]=f,this.float32[K+4]=m,this.float32[K+5]=y,this.float32[K+6]=w,this.float32[K+7]=S,this.float32[K+8]=I,this.float32[K+9]=M,this.float32[K+10]=O,this.float32[K+11]=L,this.float32[K+12]=F,this.float32[K+13]=G,this.float32[K+14]=W,this.float32[K+15]=$,e}}al.prototype.bytesPerElement=64,Mt(al,"StructArrayLayout16f64");class Bu extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,f,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,a,f,m,y)}emplace(e,i,s,a,f,m,y,w){const S=10*e,I=5*e;return this.uint16[S+0]=i,this.uint16[S+1]=s,this.uint16[S+2]=a,this.uint16[S+3]=f,this.float32[I+2]=m,this.float32[I+3]=y,this.float32[I+4]=w,e}}Bu.prototype.bytesPerElement=20,Mt(Bu,"StructArrayLayout4ui3f20");class vm extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}vm.prototype.bytesPerElement=2,Mt(vm,"StructArrayLayout1i2");class ef extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}ef.prototype.bytesPerElement=1,Mt(ef,"StructArrayLayout1ub1");class kl extends sa{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}kl.prototype.size=40;class sp extends $c{get(e){return new kl(this,e)}}Mt(sp,"CollisionBoxArray");class xm extends sa{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}xm.prototype.size=60;class tf extends Lu{get(e){return new xm(this,e)}}Mt(tf,"PlacedSymbolArray");class Vh extends sa{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Vh.prototype.size=80;class qr extends Zc{get(e){return new Vh(this,e)}}Mt(qr,"SymbolInstanceArray");class nf extends ms{getoffsetX(e){return this.float32[1*e+0]}}Mt(nf,"GlyphOffsetArray");class Bg extends hc{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Mt(Bg,"SymbolLineVertexArray");class bm extends sa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bm.prototype.size=12;class dc extends Qd{get(e){return new bm(this,e)}}Mt(dc,"FeatureIndexArray");class fc extends xa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Mt(fc,"FillExtrusionCentroidArray");class op extends sa{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}op.prototype.size=6;class wm extends rl{get(e){return new op(this,e)}}Mt(wm,"FillExtrusionWallArray");const Gh=$i([{name:"a_pos",components:2,type:"Int16"}],4),ll=$i([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Tm=$i([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Wn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,a){let f=this.segments[this.segments.length-1];return e>Wn.MAX_VERTEX_ARRAY_LENGTH&&bi(`Max vertices per segment is ${Wn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Wn.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==a)&&(f={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},a!==void 0&&(f.sortKey=a),this.segments.push(f)),f}prepareSegment(e,i,s,a){return this._prepareSegment(e,i.length,s.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,a){return new Wn([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:a,vaos:{},sortKey:0}])}}function Sm(n,e){return 256*(n=_e(Math.floor(n),0,255))+_e(Math.floor(e),0,255)}Wn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mt(Wn,"SegmentVector");const ap=$i([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Em=$i([{name:"a_pattern_b",components:4,type:"Uint16"}]),lp=$i([{name:"a_dash",components:4,type:"Uint16"}]);class qh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,a){this.ids.push(Bl(e)),this.positions.push(i,s,a)}eachPosition(e,i){const s=Bl(e);let a=0,f=this.ids.length-1;for(;a<f;){const m=a+f>>1;this.ids[m]>=s?f=m:a=m+1}for(;this.ids[a]===s;)i(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,i){const s=new Float64Array(e.ids),a=new Uint32Array(e.positions);return os(s,a,0,s.length-1),i&&(i.add(s.buffer),i.add(a.buffer)),{ids:s,positions:a}}static deserialize(e){const i=new qh;let s;i.ids=e.ids,i.positions=e.positions;for(const a of i.ids)a!==s&&i.uniqueIds.push(a),s=a;return i.indexed=!0,i}}function Bl(n){const e=+n;return Number.isSafeInteger(e)?e:xl(String(n))}function os(n,e,i,s){for(;i<s;){const a=n[i+s>>1];let f=i-1,m=s+1;for(;;){do f++;while(n[f]<a);do m--;while(n[m]>a);if(f>=m)break;Fu(n,f,m),Fu(e,3*f,3*m),Fu(e,3*f+1,3*m+1),Fu(e,3*f+2,3*m+2)}m-i<s-m?(os(n,e,i,m),i=m+1):(os(n,e,m+1,s),s=m)}}function Fu(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}Mt(qh,"FeaturePositionMap");class Na{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Er extends Na{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Hr extends Na{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class oa extends Na{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Hh extends Na{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Lr extends Na{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Fo extends Na{constructor(e){super(e),this.current=xn.transparent.toPremultipliedRenderColor(null)}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const pc=new Float32Array(16);class Nu extends Na{constructor(e){super(e),this.current=pc}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let a=1;a<16;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const K_=new Float32Array(9),c=new Float32Array(4);class t extends Na{constructor(e){super(e),this.current=c}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let a=0;a<4;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function o(n){return[Sm(255*n.r,255*n.g),Sm(255*n.b,255*n.a)]}function u(n,e,i,s,a,f,m,y){return!!n&&(n.kind==="composite"||n.kind==="source"?n.evaluate(new bn(0,{brightness:f,worldview:y}),e,i,a,s,m)==="none":n.value==="none")}class g{constructor(e,i,s,a){this.value=e,this.uniformNames=i.map(f=>`u_${f}`),this.type=s,this.context=a}setUniform(e,i,s,a,f){const m=a.constantOr(this.value);i.set(e,f,m instanceof xn?m.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):m)}getBinding(e,i){return this.type==="color"?new Fo(e):new Hr(e)}}class v{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,s,a,f){let m=null;f!=="u_pattern"&&f!=="u_dash"||(m=this.pattern),f==="u_pattern_b"&&(m=this.patternTransition),f==="u_pixel_ratio"&&(m=this.pixelRatio),m&&i.set(e,f,m)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Lr(e):new Hr(e)}}class b{constructor(e,i,s,a){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,s,a,f,m,y,w){const S=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new bn(0,{brightness:m,worldview:w}),i,{},f,a,y):this.expression.kind==="constant"&&this.expression.value,M=u(this.lutExpression,i,{},a,f,m,y,w);this.paintVertexArray.resize(e),this._setPaintValue(S,e,I,M?null:this.context.lut)}updatePaintArray(e,i,s,a,f,m,y,w){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:y,worldview:w},s,a,void 0,f):this.expression.kind==="constant"&&this.expression.value,I=u(this.lutExpression,s,a,f,void 0,y,void 0,w);this._setPaintValue(e,i,S,I?null:this.context.lut)}_setPaintValue(e,i,s,a){if(this.type==="color"){const f=o(s.toPremultipliedRenderColor(a));for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,f[0],f[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class E{constructor(e,i,s,a,f,m){this.expression=e,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=a,this.context=f,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,i,s,a,f,m,y,w){const S=this.expression.evaluate(new bn(this.context.zoom,{brightness:m,worldview:w}),i,{},f,a,y),I=this.expression.evaluate(new bn(this.context.zoom+1,{brightness:m,worldview:w}),i,{},f,a,y),M=u(this.lutExpression,i,{},a,f,m,y,w),O=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(O,e,S,I,M?null:this.context.lut)}updatePaintArray(e,i,s,a,f,m,y,w){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:y,worldview:w},s,a,void 0,f),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:y,worldview:w},s,a,void 0,f),M=u(this.lutExpression,s,a,f,void 0,y,void 0,w);this._setPaintValue(e,i,S,I,M?null:this.context.lut)}_setPaintValue(e,i,s,a,f){if(this.type==="color"){const m=o(s.toPremultipliedRenderColor(f)),y=o(a.toPremultipliedRenderColor(f));for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,m[0],m[1],y[0],y[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,s,a);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,a,f){const m=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,y=_e(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);i.set(e,f,y)}getBinding(e,i){return new Hr(e)}}class C{constructor(e,i,s,a,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(s==="array"?lp:ap).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new a,this.paintTransitionVertexArray=new Ou}populatePaintArray(e,i,s,a){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,a,f,m,y){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,i,s,a){if(!a||!s)return;const f=a[s[0]],m=a[s[1]];if(f){if(f){const{tl:y,br:w,pixelRatio:S}=f;for(let I=e;I<i;I++)this.paintVertexArray.emplace(I,y[0],y[1],w[0],w[1],S)}if(m){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:y,br:w}=m;for(let S=e;S<i;S++)this.paintTransitionVertexArray.emplace(S,y[0],y[1],w[0],w[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Em.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class P{constructor(e,i,s=()=>!0){this.binders={},this._buffers=[],this.context=i;const a=[];for(const f in e.paint._values){const m=e.paint.get(f);if(f.endsWith("-use-theme")||!s(f)||!(m instanceof Hc&&Rh(m.property.specification)))continue;const y=N(f,e.type),w=m.value,S=m.property.specification.type,I=!!m.property.useIntegerZoom,M=f==="line-dasharray"||f.endsWith("pattern"),O=e.paint.get(`${f}-use-theme`),L=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||O&&O.value.kind!=="constant";if(w.kind!=="constant"||L)if(w.kind==="source"||L||M){const F=Z(f,S,"source");this.binders[f]=M?new C(w,y,S,F,e.id):new b(w,y,S,F),a.push(`/a_${f}`)}else{const F=Z(f,S,"composite");this.binders[f]=new E(w,y,S,I,i,F),a.push(`/z_${f}`)}else this.binders[f]=M?new v(w.value,y):new g(w.value,y,S,i),a.push(`/u_${f}`);O&&(this.binders[f].lutExpression=O.value)}this.cacheKey=a.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof b||i instanceof E?i.maxValue:0}populatePaintArrays(e,i,s,a,f,m,y,w){for(const S in this.binders){const I=this.binders[S];I.context=this.context,(I instanceof b||I instanceof E||I instanceof C)&&I.populatePaintArray(e,i,s,a,f,m,y,w)}}setConstantPatternPositions(e,i){for(const s in this.binders){const a=this.binders[s];a instanceof v&&a.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof C?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,s,a,f,m,y,w,S,I){let M=!1;const O=Object.keys(e),L=O.length!==0&&!w,F=L?O:i.uniqueIds;this.context.lut=f.lut;for(const G in this.binders){const W=this.binders[G];if(W.context=this.context,(W instanceof b||W instanceof E||W instanceof C)&&W.expression&&W.expression.kind&&W.expression.kind!=="constant"&&(W.expression.isStateDependent===!0||W.expression.isLightConstant===!1)){const $=f.paint.get(G);W.expression=$.value;for(const K of F){const te=e[K.toString()];i.eachPosition(K,(se,pe,de)=>{const be=a.feature(se);W.updatePaintArray(pe,de,be,te,m,y,S,I)})}if(!L)for(const K of s.uniqueIds){const te=e[K.toString()];s.eachPosition(K,(se,pe,de)=>{const be=a.feature(se);W.updatePaintArray(pe,de,be,te,m,y,S,I)})}M=!0}}return M}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof g||s instanceof v)&&e.push(...s.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof g||a instanceof v||a instanceof E)for(const f of a.uniformNames)i.push({name:f,property:s,binding:a.getBinding(e,f)})}return i}setUniforms(e,i,s,a,f){for(const{name:m,property:y,binding:w}of s)this.binders[y].setUniform(e,w,f,a.get(y),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof b||i instanceof E||i instanceof C)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof C&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof b||s instanceof E||s instanceof C)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof b||i instanceof E||i instanceof C)&&i.destroy()}}}class z{constructor(e,i,s=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new P(a,i,s);this.needsUpload=!1,this._featureMap=new qh,this._featureMapWithoutIds=new qh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,a,f,m,y,w,S){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,i,a,f,m,y,w,S);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,a,f,m,y,w){for(const S of s)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,S,a,f,m,y||0,w)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const U={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function N(n,e){return U[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const V={"line-pattern":{source:sl,composite:sl},"fill-pattern":{source:sl,composite:sl},"fill-extrusion-pattern":{source:sl,composite:sl},"line-dasharray":{source:Ou,composite:Ou}},X={color:{source:Xc,composite:ol},number:{source:ms,composite:Xc}};function Z(n,e,i){const s=V[n];return s&&s[i]||X[e][i]}Mt(g,"ConstantBinder"),Mt(v,"PatternConstantBinder"),Mt(b,"SourceExpressionBinder"),Mt(C,"PatternCompositeBinder"),Mt(E,"CompositeExpressionBinder"),Mt(P,"ProgramConfiguration",{omit:["_buffers"]}),Mt(z,"ProgramConfigurationSet");const Y=zt/Math.PI/2,ne=64,ue=[ne,32,16],ce=-Y,ae=Y;function Ee(n,e,i,s=Y){return i=Ni(i),[n*Math.sin(i)*s,-e*s,n*Math.cos(i)*s]}function xe(n,e,i){return Ee(Math.cos(Ni(n)),Math.sin(Ni(n)),e,i)}const Se=63710088e-1,ye=2*Math.PI*Se;class fe{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fe(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,a=e.lat*i,f=Math.sin(s)*Math.sin(a)+Math.cos(s)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return Se*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new De({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return xe(this.lat,this.lng,Y+e*Y/Se)}static convert(e){if(e instanceof fe)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new fe(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new fe(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class De{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof fe?new fe(e.lng,e.lat):fe.convert(e),this}setSouthWest(e){return this._sw=e instanceof fe?new fe(e.lng,e.lat):fe.convert(e),this}extend(e){const i=this._sw,s=this._ne;let a,f;if(e instanceof fe)a=e,f=e;else{if(!(e instanceof De))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(De.convert(e)):this.extend(fe.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(fe.convert(e)):this;if(a=e._sw,f=e._ne,!a||!f)return this}return i||s?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new fe(a.lng,a.lat),this._ne=new fe(f.lng,f.lat)),this}getCenter(){return new fe((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new fe(this.getWest(),this.getNorth())}getSouthEast(){return new fe(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=fe.convert(e);let a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&a}static convert(e){if(e)return e instanceof De?e:new De(e)}}function Pe(n){return ye*Math.cos(n*Math.PI/180)}function Be(n){return(180+n)/360}function He(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Ve(n,e){return n/Pe(e)}function Qe(n){return 360*n-180}function ct(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function $e(n,e){return n*Pe(ct(e))}const Oe=85.051129;function nt(n){return Math.cos(Ni(_e(n,-85.051129,Oe)))}function Ze(n,e){const i=_e(e,0,25.5),s=Math.pow(2,i);return nt(n)*ye/(512*s)}function lt(n){return 1/Math.cos(n*Math.PI/180)}function St(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/zt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/zt/(1<<n.z)}class kt{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=fe.convert(e);return new kt(Be(s.lng),He(s.lat),Ve(i,s.lat))}toLngLat(){return new fe(Qe(this.x),ct(this.y))}toAltitude(){return $e(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ye*lt(ct(this.y))}}function Ct(n,e,i,s,a,f,m,y,w){const S=(e+s)/2,I=(i+a)/2,M=new pt(S,I);y(M),(function(O,L,F,G,W,$){const K=F-W,te=G-$;return Math.abs((G-L)*K-(F-O)*te)/Math.hypot(K,te)})(M.x,M.y,f.x,f.y,m.x,m.y)>=w?(Ct(n,e,i,S,I,f,M,y,w),Ct(n,S,I,s,a,M,m,y,w)):n.push(m)}function Et(n,e,i){let s=n[0],a=s.x,f=s.y;e(s);const m=[s];for(let y=1;y<n.length;y++){const w=n[y],{x:S,y:I}=w;e(w),Ct(m,a,f,S,I,s,w,e,i),a=S,f=I,s=w}return m}function ei(n,e,i,s){if(s(e,i)){const a=e.add(i)._mult(.5);ei(n,e,a,s),ei(n,a,i,s)}else n.push(i)}function Yt(n,e){let i=n[0];const s=[i];for(let a=1;a<n.length;a++){const f=n[a];ei(s,i,f,e),i=f}return s}const Nt=Math.pow(2,14)-1,Kt=-Nt-1;function ai(n,e){const i=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=_e(i,Kt,Nt),n.y=_e(s,Kt,Nt),(i<n.x||i>n.x+1||s<n.y||s>n.y+1)&&bi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function _i(n,e,i){const s=n.loadGeometry(),a=n.extent,f=zt/a;if(e&&i&&i.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:y,x:w,y:S,projection:I}=i,M=O=>{const L=Qe((e.x+O.x/a)/m),F=ct((e.y+O.y/a)/m),G=I.project(L,F);O.x=(G.x*y-w)*a,O.y=(G.y*y-S)*a};for(let O=0;O<s.length;O++)if(n.type!==1)s[O]=Et(s[O],M,1);else{const L=[];for(const F of s[O])F.x<0||F.x>=a||F.y<0||F.y>=a||(M(F),L.push(F));s[O]=L}}for(const m of s)for(const y of m)ai(y,f);return s}function Pi(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?_i(n):[]}}class Zi{constructor(e,i,s,a,f){this.properties={},this.extent=s,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=a,this._values=f,e.readFields(yi,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,s=[];let a,f=1,m=0,y=0,w=0;for(;e.pos<i;){if(m<=0){const S=e.readVarint();f=7&S,m=S>>3}if(m--,f===1||f===2)y+=e.readSVarint(),w+=e.readSVarint(),f===1&&(a&&s.push(a),a=[]),a&&a.push(new pt(y,w));else{if(f!==7)throw new Error(`unknown command ${f}`);a&&a.push(a[0].clone())}}return a&&s.push(a),s}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let s=1,a=0,f=0,m=0,y=1/0,w=-1/0,S=1/0,I=-1/0;for(;e.pos<i;){if(a<=0){const M=e.readVarint();s=7&M,a=M>>3}if(a--,s===1||s===2)f+=e.readSVarint(),m+=e.readSVarint(),f<y&&(y=f),f>w&&(w=f),m<S&&(S=m),m>I&&(I=m);else if(s!==7)throw new Error(`unknown command ${s}`)}return[y,S,w,I]}toGeoJSON(e,i,s){const a=this.extent*Math.pow(2,s),f=this.extent*e,m=this.extent*i,y=this.loadGeometry();function w(O){return[360*(O.x+f)/a-180,360/Math.PI*Math.atan(Math.exp((1-2*(O.y+m)/a)*Math.PI))-90]}function S(O){return O.map(w)}let I;if(this.type===1){const O=[];for(const F of y)O.push(F[0]);const L=S(O);I=O.length===1?{type:"Point",coordinates:L[0]}:{type:"MultiPoint",coordinates:L}}else if(this.type===2){const O=y.map(S);I=O.length===1?{type:"LineString",coordinates:O[0]}:{type:"MultiLineString",coordinates:O}}else{if(this.type!==3)throw new Error("unknown feature type");{const O=(function(F){const G=F.length;if(G<=1)return[F];const W=[];let $,K;for(let te=0;te<G;te++){const se=zi(F[te]);se!==0&&(K===void 0&&(K=se<0),K===se<0?($&&W.push($),$=[F[te]]):$&&$.push(F[te]))}return $&&W.push($),W})(y),L=[];for(const F of O)L.push(F.map(S));I=L.length===1?{type:"Polygon",coordinates:L[0]}:{type:"MultiPolygon",coordinates:L}}}const M={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(M.id=this.id),M}}function yi(n,e,i){n===1?e.id=i.readVarint():n===2?(function(s,a){const f=s.readVarint()+s.pos;for(;s.pos<f;){const m=a._keys[s.readVarint()],y=a._values[s.readVarint()];a.properties[m]=y}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function zi(n){let e=0;for(let i,s,a=0,f=n.length,m=f-1;a<f;m=a++)i=n[a],s=n[m],e+=(s.x-i.x)*(i.y+s.y);return e}Zi.types=["Unknown","Point","LineString","Polygon"];class Ti{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(dn,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Zi(this._pbf,i,this.extent,this._keys,this._values)}}function dn(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(s){let a=null;const f=s.readVarint()+s.pos;for(;s.pos<f;){const m=s.readVarint()>>3;a=m===1?s.readString():m===2?s.readFloat():m===3?s.readDouble():m===4?s.readVarint64():m===5?s.readVarint():m===6?s.readSVarint():m===7?s.readBoolean():null}if(a==null)throw new Error("unknown feature value");return a})(i))}class an{constructor(e,i){this.layers=e.readFields(wn,{},i)}}function wn(n,e,i){if(n===3){const s=new Ti(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}const tn="3d_elevation_id",Li="level";class un{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,s){return this.get(e,!0,i,s)}optional(e,i,s){return this.get(e,!1,i,s)}success(){return this._valid}get(e,i,s,a){const f=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&f!==void 0&&!Number.isNaN(f)?s(a?a(f):f):i&&(this._valid=!1),this}}class Xn{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,s){return this.featureFunc(e,i,s)}parseVertex(e,i,s){return this.vertexFunc(e,i,s)}}const Tn=new Xn((n,e,i)=>n.reset(e).require(tn,s=>{i.id=s}).optional("fixed_height_relative",s=>{i.constantHeight=s},Di.decodeRelativeHeight).geometry(s=>{i.bounds=s},Za).success(),(n,e,i)=>n.reset(e).require(tn,s=>{i.id=s}).require("elevation_idx",s=>{i.idx=s}).require("extent",s=>{i.extent=s}).require("height_relative",s=>{i.height=s},Di.decodeRelativeHeight).geometry(s=>{i.position=s},Di.getPoint).success()),pn=new Xn((n,e,i)=>n.reset(e).require(tn,s=>{i.id=s}).optional("fixed_height",s=>{i.constantHeight=s},Di.decodeMetricHeight).geometry(s=>{i.bounds=s},Za).success(),(n,e,i)=>n.reset(e).require(tn,s=>{i.id=s}).require("elevation_idx",s=>{i.idx=s}).require("extent",s=>{i.extent=s}).require("height",s=>{i.height=s},Di.decodeMetricHeight).geometry(s=>{i.position=s},Di.getPoint).success());class Di{static getPoint(e){return Gr(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?pn:void 0:Tn}static parse(e){const i=[],s=[],a=e.length,f=new un;for(let m=0;m<a;m++){const y=e.feature(m),w=y.properties.version,S=Di.getVersionSchema(w);if(S===void 0){bi(`Unknown elevation feature version number ${w||"(unknown)"}`);continue}const I=y.properties.type;if(!I)continue;const M=Zi.types[y.type];if(M==="Point"&&I==="curve_point"){const O={};S.parseVertex(f,y,O)&&i.push(O)}else if(M==="Polygon"&&I==="curve_meta"){const O={};S.parseFeature(f,y,O)&&s.push(O)}}return{vertices:i,features:s}}}class ki{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const a=ot(i,this.dir);if(Math.abs(a)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/a;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,!0}}class Bn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const a=Ri(i,this.dir);if(Math.abs(a)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,s){if((function(L,F){var G=L[0],W=L[1],$=L[2],K=F[0],te=F[1],se=F[2];return Math.abs(G-K)<=q*Math.max(1,Math.abs(G),Math.abs(K))&&Math.abs(W-te)<=q*Math.max(1,Math.abs(W),Math.abs(te))&&Math.abs($-se)<=q*Math.max(1,Math.abs($),Math.abs(se))})(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[a,f,m]=this.dir,y=this.pos[0]-e[0],w=this.pos[1]-e[1],S=this.pos[2]-e[2],I=a*a+f*f+m*m,M=2*(y*a+w*f+S*m),O=M*M-4*I*(y*y+w*w+S*S-i*i);if(O<0){const L=Math.max(-M/2,0),F=y+a*L,G=w+f*L,W=S+m*L,$=Math.hypot(F,G,W);return s[0]=F*i/$,s[1]=G*i/$,s[2]=W*i/$,!1}{const L=(-M-Math.sqrt(O))/(2*I);if(L<0){const F=Math.hypot(y,w,S);return s[0]=y*i/F,s[1]=w*i/F,s[2]=S*i/F,!1}return s[0]=y+a*L,s[1]=w+f*L,s[2]=S+m*L,!0}}}class dr{constructor(e,i,s,a,f){this.TL=e,this.TR=i,this.BR=s,this.BL=a,this.horizon=f}static fromInvProjectionMatrix(e,i,s){const a=[-1,1,1],f=[1,1,1],m=[1,-1,1],y=[-1,-1,1],w=vn(a,a,e),S=vn(f,f,e),I=vn(m,m,e),M=vn(y,y,e);return new dr(w,S,I,M,i/s)}}function Rn(n,e,i){let s=1/0,a=-1/0;const f=[];for(const m of n){Cn(f,m,e);const y=Ri(f,i);s=Math.min(s,y),a=Math.max(a,y)}return[s,a]}function Fn(n,e){let i=!0;for(let s=0;s<n.planes.length;s++){const a=n.planes[s];let f=0;for(let m=0;m<e.length;m++)f+=+(Ri(a,e[m])+a[3]>=0);if(f===0)return 0;f!==e.length&&(i=!1)}return i?2:1}function Xs(n,e){for(const i of n.projections){const s=Rn(e,n.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function Rs(n,e){let i=0;const s=[0,0,0,0];for(let a=0;a<n.length;a++)s[0]=n[a][0],s[1]=n[a][1],s[2]=n[a][2],s[3]=1,tr(s,e)>=0&&i++;return i}class as{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=mn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Cn([],this.points[2],this.points[3]),Cn([],this.points[0],this.points[3]),Cn([],this.points[4],this.points[0]),Cn([],this.points[5],this.points[1]),Cn([],this.points[6],this.points[2]),Cn([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const a=[0,-s[2],s[1]],f=[s[2],0,-s[0]];this.projections.push({axis:a,projection:Rn(this.points,this.points[0],a)}),this.projections.push({axis:f,projection:Rn(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(e,i,s,a){const f=Math.pow(2,s),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const I=Ss([],S,e),M=1/I[3]/i*f;return(O=I)[0]=(L=I)[0]*(F=[M,M,a?1/I[3]:M,M])[0],O[1]=L[1]*F[1],O[2]=L[2]*F[2],O[3]=L[3]*F[3],O;var O,L,F}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const I=fi([],Fi([],Cn([],m[S[0]],m[S[1]]),Cn([],m[S[2]],m[S[1]]))),M=-Ri(I,m[S[1]]);return I.concat(M)}),w=[];for(let S=0;S<m.length;S++)w.push([m[S][0],m[S][1],m[S][2]]);return new as(w,y)}intersectsPrecise(e,i,s){for(let a=0;a<i.length;a++)if(!Rs(e,i[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!Rs(e,this.planes[a]))return 0;for(const a of s)for(const f of this.frustumEdges){const m=Fi([],a,f),y=Si(m);if(y===0)continue;bt(m,m,1/y);const w=Rn(this.points,this.points[0],m),S=Rn(e,this.points[0],m);if(w[0]>S[1]||S[0]>w[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const s=i[3];if(Ri([i[0],i[1],i[2]],e)+s<0)return!1}return!0}}class mn{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const a of e)Fe(i,i,a),wt(s,s,a);return new mn(i,s)}static fromTileIdAndHeight(e,i,s){const a=1<<e.canonical.z,f=e.canonical.x,m=e.canonical.y;return new mn([f/a,m/a,i],[(f+1)/a,(m+1)/a,s])}static applyTransform(e,i){const s=e.getCorners();for(let a=0;a<s.length;++a)vn(s[a],s[a],i);return mn.fromPoints(s)}static applyTransformFast(e,i){const s=[i[12],i[13],i[14]],a=[...s];for(let f=0;f<3;f++)for(let m=0;m<3;m++){const y=i[4*m+f],w=y*e.min[m],S=y*e.max[m];s[f]+=Math.min(w,S),a[f]+=Math.max(w,S)}return new mn(s,a)}static projectAabbCorners(e,i){const s=e.getCorners();for(let a=0;a<s.length;++a)vn(s[a],s[a],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=bt([],yt([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=Ji(this.min),a=Ji(this.max);for(let f=0;f<i.length;f++)s[f]=i[f]?this.min[f]:this.center[f],a[f]=i[f]?this.center[f]:this.max[f];return a[2]=this.max[2],new mn(s,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Fn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Fn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Xs(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Xs(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Mt(mn,"Aabb");class No{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,s=i[1],a=-i[0],f=(e.extent+1)*this.metersToTile;return[new pt(Math.trunc(e.position[0]+s*f),Math.trunc(e.position[1]+a*f)),new pt(Math.trunc(e.position[0]-s*f),Math.trunc(e.position[1]-a*f))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ms{constructor(e,i,s,a,f,m){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[yr(),yr(),yr(),yr(),yr(),yr(),yr()],this.id=e,this.heightRange={min:s,max:s},this.safeArea=i,this.constantHeight=s,this.constantHeight==null&&(this.constantHeight!=null||a.length!==0)){this.vertices=a,this.edges=f,this.edges=this.edges.filter(y=>{return y.a<this.vertices.length&&y.b<this.vertices.length&&!((w=this.vertices[y.a].position)[0]===(S=this.vertices[y.b].position)[0]&&w[1]===S[1]);var w,S}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const y of this.vertices)this.vertexProps.push({dir:Gr(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,y.height),this.heightRange.max=Math.max(this.heightRange.max,y.height);for(const y of this.edges){const w=this.vertices[y.a].position,S=this.vertices[y.b].position,I=Es(yr(),S,w),M=Ro(I),O=Io(yr(),I,1/M);this.edgeProps.push({vec:I,dir:O,len:M});const L=this.vertexProps[y.a].dir,F=this.vertexProps[y.b].dir;Ko(L,L,O),Ko(F,F,O)}for(const y of this.vertexProps)y.dir[0]===0&&y.dir[1]===0||Jo(y.dir,y.dir);this.tessellate(m)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[s,a]=i;return vi(this.vertices[this.edges[s].a].height,this.vertices[this.edges[s].b].height,a)}computeSlopeNormal(e,i){const s=this.getClosestEdge(e);if(!s)return Xe(0,0,1);const a=s[0],f=this.edges[a],m=this.edgeProps[a].vec,y=Xe(m[0],m[1],(this.vertices[f.b].height-this.vertices[f.a].height)*i),w=Xe(y[1],-y[0],0);Fi(w,w,y);const S=Si(w);return S>0?bt(w,w,1/S):gt(w,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,s=Number.POSITIVE_INFINITY,a=0;const[f,m,y,w,S,I,M]=this._tmpVec2;ha(M,e.x,e.y);const O=new ki(M,null);for(let L=0;L<this.edges.length;L++){const F=this.edges[L],G=this.edgeProps[L].dir;O.dir=G;const W=this.vertices[F.a].position,$=this.vertices[F.b].position,K=O.intersectsPlane(W,this.vertexProps[F.a].dir,f),te=O.intersectsPlane($,this.vertexProps[F.b].dir,m);if(!K||!te)continue;Es(y,m,f),Es(w,M,f);const se=ot(y,y),pe=se>0?ot(w,y)/se:0,de=_e(pe,0,1),be=Math.abs((pe-de)*this.edgeProps[L].len);Es(S,M,W),ha(I,G[1],-G[0]);const Te=be+Math.abs(ot(S,I));Te<s&&(i=L,s=Te,a=de)}return[i,a]}tessellate(e){const i=si(),s=si(),a=si(),f=si();for(let m=this.edges.length-1;m>=0;--m){const y=this.edges[m].a,w=this.edges[m].b,{position:S,height:I,extent:M}=this.vertices[y],{position:O,height:L,extent:F}=this.vertices[w],G=this.vertexProps[y].dir,W=this.vertexProps[w].dir;if(gt(i,S[0]/e,S[1]/e,I),gt(s,O[0]/e,O[1]/e,L),gt(a,G[1],-G[0],0),bt(a,a,M),gt(f,W[1],-W[0],0),bt(f,f,F),this.distSqLines(Xe(i[0]+.5*a[0],i[1]+.5*a[1],i[2]+.5*a[2]),Xe(s[0]-.5*f[0],s[1]-.5*f[1],s[2]-.5*f[2]),Xe(i[0]-.5*a[0],i[1]-.5*a[1],i[2]-.5*a[2]),Xe(s[0]+.5*f[0],s[1]+.5*f[1],s[2]+.5*f[2]))<=.0025000000000000005)continue;const $=this.vertices.length,K=Ko(yr(),S,O);this.vertices.push({position:Io(K,K,.5),height:.5*(I+L),extent:.5*(M+F)});const te=Ko(yr(),G,W);this.vertexProps.push({dir:Jo(te,te)}),this.edges.splice(m,1),this.edgeProps.splice(m,1),this.edges.push({a:y,b:$}),this.edges.push({a:$,b:w});const se=Es(yr(),this.vertices[$].position,S),pe=Ro(se),de={vec:se,dir:Io(yr(),se,1/pe),len:pe};this.edgeProps.push(de),this.edgeProps.push(de)}}distSqLines(e,i,s,a){const f=mi(si(),i,e),m=mi(si(),a,s),y=mi(si(),e,s),w=Ri(f,f),S=Ri(f,m),I=Ri(f,y),M=Ri(m,m),O=Ri(m,y),L=w*M-S*S;if(L===0)return Bi(Oi(f,s,a,Ri(y,m)/Ri(m,m)),e);const F=(w*O-S*I)/L;return Bi(Oi(f,e,i,(S*O-I*M)/L),Oi(m,s,a,F))}}class Ys{static parseFrom(e,i){const s=Di.parse(e);if(!s)return[];let{vertices:a,features:f}=s;const m=1/St(i);f.sort((I,M)=>I.id-M.id),a.sort((I,M)=>I.id-M.id||I.idx-M.idx),a=a.filter((I,M,O)=>M===O.findIndex(L=>L.id===I.id&&L.idx===I.idx));const y=new Array;let w=0;const S=a.length;for(const I of f){if(I.constantHeight){y.push(new Ms(I.id,I.bounds,I.constantHeight));continue}for(;w!==S&&a[w].id<I.id;)w++;if(w===S||a[w].id!==I.id)continue;const M=new Array,O=new Array,L=w;for(;w!==S&&a[w].id===I.id;){const F=a[w];if(M.push({position:F.position,height:F.height,extent:F.extent}),w!==L&&a[w-1].idx===F.idx-1){const G=w-L;O.push({a:G-1,b:G})}w++}y.push(new Ms(I.id,I.bounds,void 0,M,O,m))}return y}static getElevationFeature(e,i){if(!i)return;const s=+e.properties[tn];return Number.isNaN(s)?void 0:i.find(a=>a.id===s)}}class aa{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*zt,this.yOffset=(e.y*this.zScale-i.y)*zt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,s){const a=this.constantElevation(i,s);return a??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),s))}computeBiasedHeight(e,i){return i<=0?e:e+i*ke(0,i,e>=0?e:Math.abs(.5*e))}}Mt(Ms,"ElevationFeature");class So{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new hc,this.indexArray=new Kr,this.segments=new Wn,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new ms),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){const f=this.layers[0],m=[];let y=null;f.type==="circle"&&(y=f.layout.get("circle-sort-key"));for(const{feature:S,id:I,index:M,sourceLayerIndex:O}of e){const L=this.layers[0]._featureFilter.needGeometry,F=Pi(S,L);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),F,s))continue;const G=y?y.evaluate(F,{},s):void 0,W={id:I,properties:S.properties,type:S.type,sourceLayerIndex:O,index:M,geometry:L?F.geometry:_i(S,s,a),patterns:{},sortKey:G};m.push(W)}y&&m.sort((S,I)=>S.sortKey-I.sortKey);let w=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new Pu,w=a.projection);for(const S of m){const{geometry:I,index:M,sourceLayerIndex:O}=S,L=e[M].feature;this.addFeature(S,I,M,i.availableImages,s,w,i.brightness,i.elevationFeatures),i.featureIndex.insert(L,I,M,O,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,s,a,f,m,y){this.programConfigurations.updatePaintArrays(e,i,f,s,a,m,y,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Tm.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,ll.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,s,a,f,m,y,w){let S;this.elevationMode!=="none"&&(S=Ys.getElevationFeature(e,w));for(const I of i)for(const M of I){const O=M.x,L=M.y;if(O<0||O>=zt||L<0||L>=zt)continue;if(m){const W=m.projectTilePoint(O,L,f),$=m.upVector(f,O,L);this.addGlobeExtVertex(W,$),this.addGlobeExtVertex(W,$),this.addGlobeExtVertex(W,$),this.addGlobeExtVertex(W,$)}const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),G=F.vertexLength;if(this.addCircleVertex(O,L,-1,-1),this.addCircleVertex(O,L,1,-1),this.addCircleVertex(O,L,1,1),this.addCircleVertex(O,L,-1,1),this.elevationMode!=="none"){const W=S?S.pointElevation(new pt(O,L)):0;this.hasElevation=this.hasElevation||W!==0;for(let $=0;$<4;$++)this.elevatedLayoutVertexArray.emplaceBack(W)}this.indexArray.emplaceBack(G,G+1,G+2),this.indexArray.emplaceBack(G,G+2,G+3),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},a,f,y,void 0,this.worldview)}addCircleVertex(e,i,s,a){this.layoutVertexArray.emplaceBack(2*e+(s+1)/2,2*i+(a+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function rr(n,e){for(let i=0;i<n.length;i++)if(Uo(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Uo(n,e[i]))return!0;return!!is(n,e)}function Dr(n,e,i){return!!Uo(n,e)||!!cl(e,n,i)}function Vn(n,e){if(n.length===1)return Uu(e,n[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let a=0;a<s.length;a++)if(Uo(n,s[a]))return!0}for(let i=0;i<n.length;i++)if(Uu(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(is(n,e[i]))return!0;return!1}function kr(n,e,i){if(n.length>1){if(is(n,e))return!0;for(let s=0;s<e.length;s++)if(cl(e[s],n,i))return!0}for(let s=0;s<n.length;s++)if(cl(n[s],e,i))return!0;return!1}function is(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const s=n[i],a=n[i+1];for(let f=0;f<e.length-1;f++)if(lr(s,a,e[f],e[f+1]))return!0}return!1}function lr(n,e,i,s){return jn(n,i,s)!==jn(e,i,s)&&jn(n,e,i)!==jn(n,e,s)}function jo(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function $h(n,e,i,s){const a=jo(n,e,s),f=jo(n,e,i);if(Math.sign(a)===Math.sign(f))return;const m=jo(i,s,n),y=m+f-a;return Math.sign(m)!==Math.sign(y)?[m/(m-y),f/(f-a)]:void 0}function cl(n,e,i){const s=i*i;if(e.length===1)return n.distSqr(e[0])<s;for(let a=1;a<e.length;a++)if(ju(n,e[a-1],e[a])<s)return!0;return!1}function ju(n,e,i){const s=e.distSqr(i);if(s===0)return n.distSqr(e);const a=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/s;return n.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function Uu(n,e){let i,s,a,f=!1;for(let m=0;m<n.length;m++){i=n[m];for(let y=0,w=i.length-1;y<i.length;w=y++)s=i[y],a=i[w],s.y>e.y!=a.y>e.y&&e.x<(a.x-s.x)*(e.y-s.y)/(a.y-s.y)+s.x&&(f=!f)}return f}function Uo(n,e){let i=!1;for(let s=0,a=n.length-1;s<n.length;a=s++){const f=n[s],m=n[a];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(i=!i)}return i}function ba(n,e,i,s,a){for(const m of n)if(e<=m.x&&i<=m.y&&s>=m.x&&a>=m.y)return!0;const f=[new pt(e,i),new pt(e,a),new pt(s,a),new pt(s,i)];if(n.length>2){for(const m of f)if(Uo(n,m))return!0}for(let m=0;m<n.length-1;m++)if(ul(n[m],n[m+1],f))return!0;return!1}function ul(n,e,i){const s=i[0],a=i[2];if(n.x<s.x&&e.x<s.x||n.x>a.x&&e.x>a.x||n.y<s.y&&e.y<s.y||n.y>a.y&&e.y>a.y)return!1;const f=jn(n,e,i[0]);return f!==jn(n,e,i[1])||f!==jn(n,e,i[2])||f!==jn(n,e,i[3])}function la(n,e,i,s,a,f){let m=e.y-n.y,y=n.x-e.x;if(f=f||0){const w=m*m+y*y;if(w===0)return!0;const S=Math.sqrt(w);m/=S,y/=S}return!((i.x-n.x)*m+(i.y-n.y)*y-f<0||(s.x-n.x)*m+(s.y-n.y)*y-f<0||(a.x-n.x)*m+(a.y-n.y)*y-f<0)}function Hn(n,e,i,s,a,f,m){return!(la(n,e,s,a,f,m)||la(e,i,s,a,f,m)||la(i,n,s,a,f,m)||la(s,a,n,e,i,m)||la(a,f,n,e,i,m)||la(f,s,n,e,i,m))}function mc(n,e,i){const s=e.paint.get(n).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(n)}function cp(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function J_(n,e,i,s,a){if(!e[0]&&!e[1])return n;const f=pt.convert(e)._mult(a);i==="viewport"&&f._rotate(-s);const m=[];for(let y=0;y<n.length;y++)m.push(n[y].sub(f));return m}function Av(n,e,i,s){const a=pt.convert(n)._mult(s);return e==="viewport"&&a._rotate(-i),a}let Cv,Iv;function Am(n,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}Mt(So,"CircleBucket",{omit:["layers"]});class Fl{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Zh(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const s=(function(f,m,y){var w=Am(256*f,256*(m=Math.pow(2,y)-m-1),y),S=Am(256*(f+1),256*(m+1),y);return w[0]+","+w[1]+","+S[0]+","+S[1]})(this.x,this.y,this.z),a=(function(f,m,y){let w,S="";for(let I=f;I>0;I--)w=1<<I-1,S+=(m&w?1:0)+(y&w?2:0);return S})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Fg{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Zh(e,i.z,i.z,i.x,i.y)}}class ks{constructor(e,i,s,a,f){this.overscaledZ=e,this.wrap=i,this.canonical=new Fl(s,+a,+f),this.key=i===0&&e===s?this.canonical.key:Zh(i,e,s,a,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ks(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ks(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Zh(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Zh(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ks(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,a=2*this.canonical.y;return[new ks(i,this.wrap,i,s,a),new ks(i,this.wrap,i,s+1,a),new ks(i,this.wrap,i,s,a+1),new ks(i,this.wrap,i,s+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ks(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ks(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Fg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Zh(n,e,i,s,a){const f=1<<Math.min(i,22);let m=f*(a%f)+s%f;return n&&i<22&&(m+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*m+i)+(e-i)}const Wh=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new ks(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new ks(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new ks(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new ks(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];Mt(Fl,"CanonicalTileID"),Mt(ks,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Yc=$i([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Xh}=Yc,qx=$i([{name:"a_pos_3",components:3,type:"Int16"}]);var Q_=$i([{name:"a_pos",type:"Int16",components:2}]);function Cm(n){return n*Y/Se}const Rv=[new mn([ce,ce,ce],[ae,ae,ae]),new mn([ce,ce,ce],[0,0,ae]),new mn([0,ce,ce],[ae,0,ae]),new mn([ce,0,ce],[0,ae,ae]),new mn([0,0,ce],[ae,ae,ae])];function ey(n,e,i,s=!0){const a=bt([],n._camera.position,n.worldSize),f=[e,i,1,1];Ss(f,f,n.pixelMatrixInverse),_r(f,f,1/f[3]);const m=fi([],Cn([],f,a)),y=n.globeMatrix,w=[y[12],y[13],y[14]],S=Cn([],w,a),I=Si(S),M=fi([],S),O=n.worldSize/(2*Math.PI),L=Ri(M,m),F=Math.asin(O/I);if(F<Math.acos(L)){if(!s)return null;const Ce=[],ze=[];bt(Ce,m,I/L),fi(ze,Cn(ze,Ce,S)),fi(m,yt(m,S,bt(m,ze,Math.tan(F)*I)))}const G=[];new Bn(a,m).closestPointOnSphere(w,O,G);const W=fi([],ir(y,0)),$=fi([],ir(y,1)),K=fi([],ir(y,2)),te=Ri(W,G),se=Ri($,G),pe=Ri(K,G),de=Le(Math.asin(-se/O));let be=Le(Math.atan2(te,pe));be=n.center.lng+(function(Ce,ze){const it=(ze-Ce+180)%360-180;return it<-180?it+360:it})(n.center.lng,be);const Te=Be(be),ve=_e(He(de),0,1);return new kt(Te,ve)}class Hx{constructor(e,i,s){this.a=Cn([],e,s),this.b=Cn([],i,s),this.center=s;const a=fi([],this.a),f=fi([],this.b);this.angle=Math.acos(Ri(a,f))}}function Im(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:(function(s,a,f,m){const y=Math.sin(f);return s*(Math.sin((1-m)*f)/y)+a*(Math.sin(m*f)/y)})(n.a[e],n.b[e],n.angle,_e(i,0,1))+n.center[e]}function gc(n){if(n.z<=1)return Rv[n.z+2*n.y+n.x];const e=ty(up(n));return mn.fromPoints(e)}function Kc(n,e,i){return bt(n,n,1-i),Gt(n,n,e,i)}function Mv(n,e,i){for(const s of n)vn(s,s,e),bt(s,s,i)}function Ng(n,e,i,s){const a=e/n.worldSize,f=n.globeMatrix;if(i.z<=1){const ve=gc(i).getCorners();return Mv(ve,f,a),mn.fromPoints(ve)}const m=up(i,s),y=ty(m,Y+Cm(n._tileCoverLift));Mv(y,f,a);const w=Number.MAX_VALUE,S=[-w,-w,-w],I=[w,w,w];if(m.contains(n.center)){for(const ze of y)Fe(I,I,ze),wt(S,S,ze);S[2]=0;const ve=n.point,Ce=[ve.x*a,ve.y*a,0];return Fe(I,I,Ce),wt(S,S,Ce),new mn(I,S)}if(n._tileCoverLift>0){for(const ve of y)Fe(I,I,ve),wt(S,S,ve);return new mn(I,S)}const M=[f[12]*a,f[13]*a,f[14]*a],O=m.getCenter(),L=_e(n.center.lat,-85.051129,Oe),F=_e(O.lat,-85.051129,Oe),G=Be(n.center.lng),W=He(L);let $=G-Be(O.lng);const K=W-He(F);$>.5?$-=1:$<-.5&&($+=1);let te=0;Math.abs($)>Math.abs(K)?te=$>=0?1:3:(te=K>=0?0:2,Gt(M,M,[f[4]*a,f[5]*a,f[6]*a],-Math.sin(Ni(K>=0?m.getSouth():m.getNorth()))*Y));const se=y[te],pe=y[(te+1)%4],de=new Hx(se,pe,M),be=[Im(de,0)||se[0],Im(de,1)||se[1],Im(de,2)||se[2]],Te=Vu(n.zoom);if(Te>0){const ve=(function({x:ze,y:it,z:Je},tt,dt,ut,ht){const Ye=1/(1<<Je);let mt=ze*Ye,at=mt+Ye,_t=it*Ye,ft=_t+Ye,$t=0;const Wt=(mt+at)/2-ut;return Wt>.5?$t=-1:Wt<-.5&&($t=1),mt=((mt+$t)*tt-(ut*=tt))*dt+ut,at=((at+$t)*tt-ut)*dt+ut,_t=(_t*tt-(ht*=tt))*dt+ht,ft=(ft*tt-ht)*dt+ht,[[mt,ft,0],[at,ft,0],[at,_t,0],[mt,_t,0]]})(i,e,n._pixelsPerMercatorPixel,G,W);for(let ze=0;ze<y.length;ze++)Kc(y[ze],ve[ze],Te);const Ce=yt([],ve[te],ve[(te+1)%4]);bt(Ce,Ce,.5),Kc(be,Ce,Te)}for(const ve of y)Fe(I,I,ve),wt(S,S,ve);return I[2]=Math.min(se[2],pe[2]),Fe(I,I,be),wt(S,S,be),new mn(I,S)}function up({x:n,y:e,z:i},s=!1){const a=1/(1<<i),f=new fe(Qe(n*a),e===(1<<i)-1&&s?-90:ct((e+1)*a)),m=new fe(Qe((n+1)*a),e===0&&s?90:ct(e*a));return new De(f,m)}function ty(n,e=Y){const i=Ni(n.getNorth()),s=Ni(n.getSouth()),a=Math.cos(i),f=Math.cos(s),m=Math.sin(i),y=Math.sin(s),w=n.getWest(),S=n.getEast();return[Ee(f,y,w,e),Ee(f,y,S,e),Ee(a,m,S,e),Ee(a,m,w,e)]}function Rm(n,e,i,s){const a=1<<i.z,f=(n/zt+i.x)/a;return xe(ct((e/zt+i.y)/a),Qe(f),s)}function Yh({min:n,max:e}){return 16383/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Dv=new Float64Array(16);function Mm(n){const e=Yh(n),i=Ht(Dv,[e,e,e]);return Ue(i,i,Ii([],n.min))}function $n(n){const e=(function(s,a){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=a[0],s[13]=a[1],s[14]=a[2],s[15]=1,s})(Dv,n.min),i=1/Yh(n);return rt(e,e,[i,i,i])}function Dm(n){const e=zt/(2*Math.PI);return n/(2*Math.PI)/e}function Om(n,e){return zt/(512*Math.pow(2,n))*Yh(gc(e))}function jg(n,e,i,s,a){const f=Dm(i),m=[n,e,-i/(2*Math.PI)],y=Re(new Float64Array(16));return Ue(y,y,m),rt(y,y,[f,f,f]),Pt(y,y,Ni(-a)),Bt(y,y,Ni(-s)),y}function Vu(n){return ke(5,6,n)}function Ug(n,e){const i=xe(e.lat,e.lng),s=(function(F){const G=xe(F._center.lat,F._center.lng);let W=Fi([],Xe(0,1,0),G);const $=Ei([],-F.angle,G);W=vn(W,W,$),Ei($,-F._pitch,W);const K=fi([],G);return bt(K,K,Cm(F.cameraToCenterDistance/F.pixelsPerMeter)),vn(K,K,$),yt([],G,K)})(n);return m=(a=mi([],s,i))[0],y=a[1],w=a[2],S=(f=i)[0],I=f[1],M=f[2],L=(O=Math.sqrt((m*m+y*y+w*w)*(S*S+I*I+M*M)))&&Ri(a,f)/O,Math.acos(Math.min(Math.max(L,-1),1));var a,f,m,y,w,S,I,M,O,L}function rf(n,e){return Ug(n,e)>Math.PI/2*1.01}const Pm=Ni(85),$x=Math.cos(Pm),Ov=Math.sin(Pm),Zx=Ae(),Pv=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function iy(n,e,i,s,a,f,m,y,w){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(w*=n.pixelToTileUnitsFactor);const S=n.tileID.canonical,I=i.projection.upVectorScale(S,i.center.lat,i.worldSize).metersToTile;for(const M of e)for(const O of M){const L=O.add(y),F=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(L.x,L.y,!0):0,G=i.projection.projectTilePoint(L.x,L.y,S);if(F>0){const te=i.projection.upVector(S,L.x,L.y);G.x+=te[0]*I*F,G.y+=te[1]*I*F,G.z+=te[2]*I*F}const W=f?L:zv(G.x,G.y,G.z,s),$=f?n.tilespaceRays.map(te=>Vo(te,F)):n.queryGeometry.screenGeometry,K=Ss([],[G.x,G.y,G.z,1],s);if(!m&&f?w*=K[3]/i.cameraToCenterDistance:m&&!f&&(w*=i.cameraToCenterDistance/K[3]),f){const te=ct((O.y/zt+S.y)/(1<<S.z));w/=i.projection.pixelsPerMeter(te,1)/Ve(1,te)}if(Dr($,W,w))return!0}return!1}function zv(n,e,i,s){const a=Ss([],[n,e,i,1],s);return new pt(a[0]/a[3],a[1]/a[3])}const Br=Xe(0,0,0),ny=Xe(0,0,1);function Vo(n,e){const i=si();return Br[2]=e,n.intersectsPlane(Br,ny,i),new pt(i[0],i[1])}class Lv extends So{}let ry,kv,Vg,Gg;function zm(n,{width:e,height:i},s,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*s)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*s);return n.width=e,n.height=i,n.data=a,n}function sy(n,e,i){const{width:s,height:a}=e;s===n.width&&a===n.height||(qg(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,a)},i,null),n.width=s,n.height=a,n.data=e.data)}function qg(n,e,i,s,a,f,m,y){if(a.width===0||a.height===0)return e;if(a.width>n.width||a.height>n.height||i.x>n.width-a.width||i.y>n.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||s.x>e.width-a.width||s.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const w=n.data,S=e.data,I=f===4&&y;for(let M=0;M<a.height;M++){const O=((i.y+M)*n.width+i.x)*f,L=((s.y+M)*e.width+s.x)*f;if(I)for(let F=0;F<a.width;F++){const G=O+F*f+3,W=L+F*f;S[W+0]=255,S[W+1]=255,S[W+2]=255,S[W+3]=w[G]}else if(m)for(let F=0;F<a.width;F++){const G=O+F*f,W=L+F*f,$=new xn(w[G+0]/255,w[G+1]/255,w[G+2]/255,w[G+3]).toNonPremultipliedRenderColor(m).toArray();S[W+0]=$[0],S[W+1]=$[1],S[W+2]=$[2],S[W+3]=$[3]}else for(let F=0;F<a.width*f;F++)S[L+F]=w[O+F]}return e}Mt(Lv,"HeatmapBucket",{omit:["layers"]});class Jc{constructor(e,i){zm(this,e,1,i)}resize(e){sy(this,new Jc(e),1)}clone(){return new Jc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,a,f){qg(e,i,s,a,f,1,null)}}class Ds{constructor(e,i){zm(this,e,4,i)}resize(e){sy(this,new Ds(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,a,f,m,y){qg(e,i,s,a,f,4,m,y)}}class Bv{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function hp(n){const e={},i=n.resolution||256,s=n.clips?n.clips.length:1,a=n.image||new Ds({width:i,height:s}),f=(m,y,w)=>{e[n.evaluationKey]=w;const S=n.expression.evaluate(e),I=S?S.toNonPremultipliedRenderColor(null):null;I&&(a.data[m+y+0]=Math.floor(255*I.r),a.data[m+y+1]=Math.floor(255*I.g),a.data[m+y+2]=Math.floor(255*I.b),a.data[m+y+3]=Math.floor(255*I.a))};if(n.clips)for(let m=0,y=0;m<s;++m,y+=4*i)for(let w=0,S=0;w<i;w++,S+=4){const I=w/(i-1),{start:M,end:O}=n.clips[m];f(y,S,M*(1-I)+O*I)}else for(let m=0,y=0;m<i;m++,y+=4)f(0,y,m/(i-1));return a}Mt(Jc,"AlphaImage"),Mt(Ds,"RGBAImage");const Wx=$i([{name:"a_pos",components:2,type:"Int16"}],4),Fv=$i([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Xx=$i([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Yx=$i([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function hl(n,e,i=2){const s=e&&e.length,a=s?e[0]*i:n.length;let f=oy(n,0,a,i,!0);const m=[];if(!f||f.next===f.prev)return m;let y,w,S;if(s&&(f=(function(I,M,O,L){const F=[];for(let G=0,W=M.length;G<W;G++){const $=oy(I,M[G]*L,G<W-1?M[G+1]*L:I.length,L,!1);$===$.next&&($.steiner=!0),F.push(jv($))}F.sort(ly);for(let G=0;G<F.length;G++)O=Qx(F[G],O);return O})(n,e,f,i)),n.length>80*i){y=n[0],w=n[1];let I=y,M=w;for(let O=i;O<a;O+=i){const L=n[O],F=n[O+1];L<y&&(y=L),F<w&&(w=F),L>I&&(I=L),F>M&&(M=F)}S=Math.max(I-y,M-w),S=S!==0?32767/S:0}return sf(f,m,i,y,w,S,0),m}function oy(n,e,i,s,a){let f;if(a===(function(m,y,w,S){let I=0;for(let M=y,O=w-S;M<w;M+=S)I+=(m[O]-m[M])*(m[M+1]+m[O+1]),O=M;return I})(n,e,i,s)>0)for(let m=e;m<i;m+=s)f=uy(m/s|0,n[m],n[m+1],f);else for(let m=i-s;m>=e;m-=s)f=uy(m/s|0,n[m],n[m+1],f);return f&&of(f,f.next)&&(Nm(f),f=f.next),f}function Kh(n,e){if(!n)return n;e||(e=n);let i,s=n;do if(i=!1,s.steiner||!of(s,s.next)&&cr(s.prev,s,s.next)!==0)s=s.next;else{if(Nm(s),s=e=s.prev,s===s.next)break;i=!0}while(i||s!==e);return e}function sf(n,e,i,s,a,f,m){if(!n)return;!m&&f&&(function(w,S,I,M){let O=w;do O.z===0&&(O.z=Lm(O.x,O.y,S,I,M)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==w);O.prevZ.nextZ=null,O.prevZ=null,(function(L){let F,G=1;do{let W,$=L;L=null;let K=null;for(F=0;$;){F++;let te=$,se=0;for(let de=0;de<G&&(se++,te=te.nextZ,te);de++);let pe=G;for(;se>0||pe>0&&te;)se!==0&&(pe===0||!te||$.z<=te.z)?(W=$,$=$.nextZ,se--):(W=te,te=te.nextZ,pe--),K?K.nextZ=W:L=W,W.prevZ=K,K=W;$=te}K.nextZ=null,G*=2}while(F>1)})(O)})(n,s,a,f);let y=n;for(;n.prev!==n.next;){const w=n.prev,S=n.next;if(f?Jx(n,s,a,f):Kx(n))e.push(w.i,n.i,S.i),Nm(n),n=S.next,y=S.next;else if((n=S)===y){m?m===1?sf(n=Nv(Kh(n),e),e,i,s,a,f,2):m===2&&ay(n,e,i,s,a,f):sf(Kh(n),e,i,s,a,f,1);break}}}function Kx(n){const e=n.prev,i=n,s=n.next;if(cr(e,i,s)>=0)return!1;const a=e.x,f=i.x,m=s.x,y=e.y,w=i.y,S=s.y,I=Math.min(a,f,m),M=Math.min(y,w,S),O=Math.max(a,f,m),L=Math.max(y,w,S);let F=s.next;for(;F!==e;){if(F.x>=I&&F.x<=O&&F.y>=M&&F.y<=L&&dp(a,y,f,w,m,S,F.x,F.y)&&cr(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function Jx(n,e,i,s){const a=n.prev,f=n,m=n.next;if(cr(a,f,m)>=0)return!1;const y=a.x,w=f.x,S=m.x,I=a.y,M=f.y,O=m.y,L=Math.min(y,w,S),F=Math.min(I,M,O),G=Math.max(y,w,S),W=Math.max(I,M,O),$=Lm(L,F,e,i,s),K=Lm(G,W,e,i,s);let te=n.prevZ,se=n.nextZ;for(;te&&te.z>=$&&se&&se.z<=K;){if(te.x>=L&&te.x<=G&&te.y>=F&&te.y<=W&&te!==a&&te!==m&&dp(y,I,w,M,S,O,te.x,te.y)&&cr(te.prev,te,te.next)>=0||(te=te.prevZ,se.x>=L&&se.x<=G&&se.y>=F&&se.y<=W&&se!==a&&se!==m&&dp(y,I,w,M,S,O,se.x,se.y)&&cr(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;te&&te.z>=$;){if(te.x>=L&&te.x<=G&&te.y>=F&&te.y<=W&&te!==a&&te!==m&&dp(y,I,w,M,S,O,te.x,te.y)&&cr(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;se&&se.z<=K;){if(se.x>=L&&se.x<=G&&se.y>=F&&se.y<=W&&se!==a&&se!==m&&dp(y,I,w,M,S,O,se.x,se.y)&&cr(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function Nv(n,e){let i=n;do{const s=i.prev,a=i.next.next;!of(s,a)&&Bm(s,i,i.next,a)&&Fm(s,a)&&Fm(a,s)&&(e.push(s.i,i.i,a.i),Nm(i),Nm(i.next),i=n=a),i=i.next}while(i!==n);return Kh(i)}function ay(n,e,i,s,a,f){let m=n;do{let y=m.next.next;for(;y!==m.prev;){if(m.i!==y.i&&km(m,y)){let w=af(m,y);return m=Kh(m,m.next),w=Kh(w,w.next),sf(m,e,i,s,a,f,0),void sf(w,e,i,s,a,f,0)}y=y.next}m=m.next}while(m!==n)}function ly(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function Qx(n,e){const i=(function(a,f){let m=f;const y=a.x,w=a.y;let S,I=-1/0;if(of(a,m))return m;do{if(of(a,m.next))return m.next;if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){const G=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(G<=y&&G>I&&(I=G,S=m.x<m.next.x?m:m.next,G===y))return S}m=m.next}while(m!==f);if(!S)return null;const M=S,O=S.x,L=S.y;let F=1/0;m=S;do{if(y>=m.x&&m.x>=O&&y!==m.x&&cy(w<L?y:I,w,O,L,w<L?I:y,w,m.x,m.y)){const G=Math.abs(w-m.y)/(y-m.x);Fm(m,a)&&(G<F||G===F&&(m.x>S.x||m.x===S.x&&Nl(S,m)))&&(S=m,F=G)}m=m.next}while(m!==M);return S})(n,e);if(!i)return e;const s=af(i,n);return Kh(s,s.next),Kh(i,i.next)}function Nl(n,e){return cr(n.prev,n,e.prev)<0&&cr(e.next,n,n.next)<0}function Lm(n,e,i,s,a){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*a|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function jv(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function cy(n,e,i,s,a,f,m,y){return(a-m)*(e-y)>=(n-m)*(f-y)&&(n-m)*(s-y)>=(i-m)*(e-y)&&(i-m)*(f-y)>=(a-m)*(s-y)}function dp(n,e,i,s,a,f,m,y){return!(n===m&&e===y)&&cy(n,e,i,s,a,f,m,y)}function km(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,s){let a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==s.i&&a.next.i!==s.i&&Bm(a,a.next,i,s))return!0;a=a.next}while(a!==i);return!1})(n,e)&&(Fm(n,e)&&Fm(e,n)&&(function(i,s){let a=i,f=!1;const m=(i.x+s.x)/2,y=(i.y+s.y)/2;do a.y>y!=a.next.y>y&&a.next.y!==a.y&&m<(a.next.x-a.x)*(y-a.y)/(a.next.y-a.y)+a.x&&(f=!f),a=a.next;while(a!==i);return f})(n,e)&&(cr(n.prev,n,e.prev)||cr(n,e.prev,e))||of(n,e)&&cr(n.prev,n,n.next)>0&&cr(e.prev,e,e.next)>0)}function cr(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function of(n,e){return n.x===e.x&&n.y===e.y}function Bm(n,e,i,s){const a=Hg(cr(n,e,i)),f=Hg(cr(n,e,s)),m=Hg(cr(i,s,n)),y=Hg(cr(i,s,e));return a!==f&&m!==y||!(a!==0||!jl(n,i,e))||!(f!==0||!jl(n,s,e))||!(m!==0||!jl(i,n,s))||!(y!==0||!jl(i,e,s))}function jl(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Hg(n){return n>0?1:n<0?-1:0}function Fm(n,e){return cr(n.prev,n,n.next)<0?cr(n,e,n.next)>=0&&cr(n,n.prev,e)>=0:cr(n,e,n.prev)<0||cr(n,n.next,e)<0}function af(n,e){const i=hy(n.i,n.x,n.y),s=hy(e.i,e.x,e.y),a=n.next,f=e.prev;return n.next=e,e.prev=n,i.next=a,a.prev=i,s.next=i,i.prev=s,f.next=s,s.prev=f,s}function uy(n,e,i,s){const a=hy(n,e,i);return s?(a.next=s.next,a.prev=s,s.next.prev=a,s.next=a):(a.prev=a,a.next=a),a}function Nm(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function hy(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function jm(n,e){const i=n.length;if(i<=1)return[n];const s=[];let a,f;for(let m=0;m<i;m++){const y=xr(n[m]);y!==0&&(n[m].area=Math.abs(y),f===void 0&&(f=y<0),f===y<0?(a&&s.push(a),a=[n[m]]):a.push(n[m]))}if(a&&s.push(a),e>1)for(let m=0;m<s.length;m++)s[m].length<=e||(_d(s[m],e,1,s[m].length-1,eb),s[m]=s[m].slice(0,e));return s}function eb(n,e){return e.area-n.area}function Uv(n,e,i=1){if(!n)return null;const s=typeof n=="string"?Oo.from(n).getPrimary():n.getPrimary(),a=typeof n=="string"?null:n.getSecondary();for(const f of[s,a]){if(!f)continue;const m=f.id.toString();e.has(m)||e.set(m,[]),f.scaleSelf(i),e.get(m).push(f)}return{primary:s.toString(),secondary:a?a.toString():null}}function dy(n,e,i,s){const a=s.patternDependencies;let f=!1;for(const m of e){const y=m.paint.get(`${n}-pattern`);y.isConstant()||(f=!0),Uv(y.constantOr(null),a,i)&&(f=!0)}return f}function fy(n,e,i,s,a,f){const m=f.patternDependencies;for(const y of e){const w=y.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let S=w.evaluate({zoom:s},i,{},f.availableImages);S=S&&S.name?S.name:S;const I=Uv(S,m,a);if(!I)continue;const{primary:M,secondary:O}=I;M&&(i.patterns[y.id]=[M,O].filter(Boolean))}}return i}class Qc{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=zt&&i>=zt}static evaluate(e){if(e.length===0)return new Qc;let i=[];for(const w of e)i.push(...w.portals);if(i.length===0)return new Qc;for(const w of i){const S=w.va,I=w.vb;(Qc.isOnBorder(S.x,I.x)||Qc.isOnBorder(S.y,I.y))&&(w.type="border")}const s=i.filter(w=>w.type!=="unevaluated"),a=i.filter(w=>w.type==="unevaluated");if(a.length===0)return new Qc;a.sort((w,S)=>w.hash===S.hash?w.isTunnel===S.isTunnel?0:w.isTunnel?-1:1:w.hash<S.hash?1:-1),i=s.concat(a);let f=s.length,m=f,y=f;do if(m++,m===i.length||i[f].hash!==i[m].hash){if(m-f===2){y<f&&(i[y]=i[f],i[f]=null);const w=i[y],S=i[m-1];w.type=w.isTunnel!==S.isTunnel?"tunnel":"polygon",w.connection={a:w.connection.a,b:S.connection.a},y++}f=m}while(f!==i.length);return i.splice(y),i.sort((w,S)=>w.hash<S.hash?1:-1),{portals:i}}}Mt(Qc,"ElevationPortalGraph");class fp{constructor(e,i,s){this.outPositions=e,this.outNormals=i,this.outIndices=s,this.vertexLookup=new Map}addVertex(e,i,s){let a=e[2];s!=null&&(a*=s);const f=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,m=this.vertexLookup.get(f);if(m!=null)return m;const y=this.outPositions.length;this.vertexLookup.set(f,y);const w=Math.trunc(16384*i[0]),S=Math.trunc(16384*i[1]),I=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],a),this.outNormals.emplaceBack(w,S,I),y}addTriangle(e,i,s){this.outIndices.emplaceBack(e,i,s)}addTriangles(e,i,s){if(e.length===0)return;const a=s.length===1,f=si(),m=si();for(let y=0;y<e.length;y+=3){const w=i[e[y+0]],S=i[e[y+1]],I=i[e[y+2]],M=a?s[0]:s[e[y+1]],O=a?s[0]:s[e[y+2]];gt(f,w.x,w.y,a?s[0]:s[e[y+0]]);const L=this.addVertex(f,m);gt(f,S.x,S.y,M);const F=this.addVertex(f,m);gt(f,I.x,I.y,O);const G=this.addVertex(f,m);this.outIndices.emplaceBack(L,F,G)}}addQuad(e,i,s,a,f,m){const y=this.addVertex(e,f,m),w=this.addVertex(i,f,m),S=this.addVertex(s,f,m),I=this.addVertex(a,f,m);this.addTriangle(y,w,S),this.addTriangle(S,I,y)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class po{constructor(e,i,s,a){this.unevaluatedPortals=new Qc,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new kh,this.vertexNormals=new Yd,this.indexArray=new Kr,this.tileToMeters=St(e),this.bridgeProgramConfigurations=new z(i,{zoom:s,lut:a},f=>f!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new z(i,{zoom:s,lut:a},f=>f!=="fill-bridge-guard-rail-color")}addVertices(e,i){const s=this.unevalVertices.length;for(let a=0;a<e.length;a++)this.unevalVertices.push(e[a]),this.unevalHeights.push(i[a]);return s}addTriangles(e,i,s){const a=s?this.unevalTunnelTriangles:this.unevalTriangles;for(const f of e)a.push(f+i)}addRenderableRing(e,i,s,a,f,m){const y=[new pt(f.min.x,f.min.y),new pt(f.max.x,f.min.y),new pt(f.max.x,f.max.y),new pt(f.min.x,f.max.y)];for(let w=0;w<s-1;w++){const S=i+w,I=S+1,M=this.unevalVertices[S],O=this.unevalVertices[I];if(!(M.x>=f.min.x&&M.x<=f.max.x&&M.y>=f.min.y&&M.y<=f.max.y||O.x>=f.min.x&&O.x<=f.max.x&&O.y>=f.min.y&&O.y<=f.max.y||ul(M,O,y))||this.isOnBorder(M.x,O.x)||this.isOnBorder(M.y,O.y))continue;const L=po.computeEdgeHash(this.unevalVertices[S],this.unevalVertices[I]);let F,G=this.vertexHashLookup.get(po.computePosHash(M));G!=null?F=G.next:(G=this.vertexHashLookup.get(po.computePosHash(O)),F=G!=null?G.prev:L),this.unevalEdges.push({polygonIdx:e,a:S,b:I,hash:L,portalHash:F,isTunnel:a,type:"unevaluated",featureInfo:m})}}addPortalCandidates(e,i,s,a,f){if(i.length!==0){this.vertexHashLookup.clear();for(const m of i){if(m.length===0)continue;const y=m[0];let w=po.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let S=0;S<y.length-1;S++){const I=y[S+0],M=y[S+1],O=Gr(M.x-I.x,M.y-I.y),L=Ro(O);if(L===0)continue;let F="unevaluated";const G=a.pointElevation(I),W=a.pointElevation(M);Math.abs(G)<.01&&Math.abs(W)<.01?F="entrance":(this.isOnBorder(I.x,M.x)||this.isOnBorder(I.y,M.y))&&(F="border");const $=po.computeEdgeHash(I,M);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:I,vb:M,vab:O,length:L,hash:$,isTunnel:s,type:F});const K=po.computePosHash(I);this.vertexHashLookup.set(K,{prev:w,next:$}),w=$}}}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),s=O=>{O.primitiveLength=this.indexArray.length-O.primitiveOffset},a=new fp(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const f=i(),m=i(),y=i(),w=(O,L)=>{O.sort((G,W)=>G.type===L&&W.type!==L?-1:G.type!==L&&W.type===L?1:0);const F=O.findIndex(G=>G.type!==L);return F>=0?F:O.length};let S=0;this.unevalEdges.length>0&&(S=w(this.unevalEdges,"none"),this.constructBridgeStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},this.tileToMeters)),s(y);const I=i(),M=i();if(this.unevalEdges.length>0){const O=this.unevalEdges.splice(S),L=w(O,"tunnel")+S;this.unevalEdges.push(...O),this.constructTunnelStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},{min:S,max:L})}s(I),a.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),s(M),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),s(m),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),s(f),this.maskSegments=Wn.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.depthSegments=Wn.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength),this.renderableBridgeSegments=Wn.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableTunnelSegments=Wn.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=Wn.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength)}update(e,i,s,a,f,m,y,w){this.bridgeProgramConfigurations.updatePaintArrays(e,i,f,s,a,m,y,w),this.tunnelProgramConfigurations.updatePaintArrays(e,i,f,s,a,m,y,w)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Xx.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Yx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,s,a,f){const m=(y,w)=>{for(let S=0;S<w.length-1;S++){const I=w[S].featureIndex,M=w[S+1].vertexStart,O=e.feature(I);y.populatePaintArrays(M,O,I,{},s,i,a,void 0,f)}};m(this.bridgeProgramConfigurations,this.bridgeFeatureSections),m(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,s,a,f){const m=new Map;for(let y=a;y<f;y++){const w=s[y],S=w.a,I=w.b,M=po.computePosHash(e[S]),O=po.computePosHash(e[I]);let L=m.get(M);L||(L={},m.set(M,L));let F=m.get(O);F||(F={},m.set(O,F)),i[S]<=0&&i[I]<=0||(L.to=I,F.from=S)}return m}isTerminalVertex(e,i){const s=po.computePosHash(this.unevalVertices[e]),a=i.get(s);return!a||!a.from||!a.to}constructBridgeStructures(e,i,s,a,f,m){e.clearVertexLookup();const y=this.computeVertexConnections(i,s,a,f.min,f.max),w=1/m,S=.5*w,I=(dt,ut)=>gt(dt,i[ut].x,i[ut].y,s[ut]*w),M=si(),O=si(),L=si(),F=si(),G=si(),W=(dt,ut)=>{const ht=y.get(po.computePosHash(i[ut])),Ye=ht.from,mt=ht.to;if(!Ye||!mt)return;I(M,Ye),I(O,ut),I(L,mt),Gs(F),Jr(M,O)||(Cn(G,O,M),fi(F,G)),Jr(L,O)||(Cn(G,L,O),yt(F,F,fi(G,G)));const at=Ts(F);return at>0?bt(dt,F,1/at):void 0};let $=Number.POSITIVE_INFINITY;this.sortSubarray(a,f.min,f.max,(dt,ut)=>dt.featureInfo.featureIndex-ut.featureInfo.featureIndex);const K=si(),te=si(),se=si(),pe=si(),de=si(),be=si(),Te=si(),ve=si(),Ce=si(),ze=[si(),si(),si(),si()],it=[si(),si(),si(),si()],Je=[{coord:new pt(0,0),height:0},{coord:new pt(0,0),height:0}],tt=(dt,ut)=>dt>ut;for(let dt=f.min;dt<f.max;dt++){const ut=a[dt];if(!ut.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Je,i,s,ut,tt))continue;const[ht,Ye]=Je;if(gt(K,ht.coord.x,ht.coord.y,w*ht.height),gt(te,Ye.coord.x,Ye.coord.y,w*Ye.height),Jr(K,te))continue;Cn(se,te,K),fi(se,se);const mt=W(ve,ut.a)||se,at=W(Ce,ut.b)||se;gt(pe,mt[1],-mt[0],0),fi(pe,pe),gt(de,at[1],-at[0],0),fi(de,de),Fi(ve,pe,mt),fi(be,ve),Fi(ve,de,at),fi(Te,ve),yt(ze[0],K,bt(ve,Cn(ve,pe,be),S)),yt(ze[1],K,bt(ve,yt(ve,pe,be),S)),yt(ze[2],K,bt(ve,be,S)),ze[3]=K,yt(it[0],te,bt(ve,Cn(ve,de,Te),S)),yt(it[1],te,bt(ve,yt(ve,de,Te),S)),yt(it[2],te,bt(ve,Te,S)),it[3]=te,$=this.addFeatureSection(ut.featureInfo.featureIndex,$,this.bridgeFeatureSections,e);const _t=e.addVertex(ze[0],pe,m),ft=e.addVertex(ze[1],pe,m),$t=e.addVertex(it[0],de,m),Wt=e.addVertex(it[1],de,m);e.addTriangle(_t,ft,$t),e.addTriangle(ft,Wt,$t);const Ft=e.addVertex(ze[1],be,m),jt=e.addVertex(ze[2],be,m),di=e.addVertex(it[1],Te,m),ni=e.addVertex(it[2],Te,m);e.addTriangle(Ft,jt,di),e.addTriangle(jt,ni,di),Ii(pe,pe),Ii(de,de);const qt=e.addVertex(ze[2],pe,m),Ai=e.addVertex(ze[3],pe,m),Xi=e.addVertex(it[2],de,m),yn=e.addVertex(it[3],de,m);e.addTriangle(qt,Ai,Xi),e.addTriangle(Ai,yn,Xi);const qi=this.isTerminalVertex(ut.a,y),Ln=this.isTerminalVertex(ut.b,y);ht.height<.01&&qi&&e.addQuad(ze[3],ze[2],ze[1],ze[0],Ii(mt,mt),m),Ye.height<.01&&Ln&&e.addQuad(it[0],it[1],it[2],it[3],at,m)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,s,a,f,m){e.clearVertexLookup();let y=Number.POSITIVE_INFINITY;const w=($,K)=>$.featureInfo.featureIndex-K.featureInfo.featureIndex;this.sortSubarray(a,f.min,f.max,w),this.sortSubarray(a,m.min,m.max,w);const S=$=>fi($,$),I=[{coord:new pt(0,0),height:0},{coord:new pt(0,0),height:0}],M=($,K)=>$<K,O=si(),L=si(),F=si(),G=si(),W=si();for(let $=f.min;$<f.max;$++){if(!this.prepareEdgePoints(I,i,s,a[$],M))continue;const[K,te]=I,se=S(gt(W,-(te.coord.y-K.coord.y),te.coord.x-K.coord.x,0));y=this.addFeatureSection(a[$].featureInfo.featureIndex,y,this.tunnelFeatureSections,e),e.addQuad(gt(O,K.coord.x,K.coord.y,K.height),gt(L,te.coord.x,te.coord.y,te.height),gt(F,te.coord.x,te.coord.y,a[$].isTunnel?-.1:0),gt(G,K.coord.x,K.coord.y,a[$].isTunnel?-.1:0),se)}for(let $=m.min;$<m.max;$++){const K=a[$];K.isTunnel&&([K.a,K.b]=[K.b,K.a]);const te=i[K.a],se=i[K.b],pe=S(gt(W,-(se.y-te.y),se.x-te.x,0));y=this.addFeatureSection(K.featureInfo.featureIndex,y,this.tunnelFeatureSections,e),e.addQuad(gt(O,se.x,se.y,0),gt(L,te.x,te.y,0),gt(F,te.x,te.y,s[K.a]+4),gt(G,se.x,se.y,s[K.b]+4),pe),e.addQuad(gt(O,te.x,te.y,0),gt(L,se.x,se.y,0),gt(F,se.x,se.y,s[K.b]+4),gt(G,te.x,te.y,s[K.a]+4),pe)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,s,a){e.coord.x=i,e.coord.y=s,e.height=a}prepareEdgePoints(e,i,s,a,f){let m=i[a.a].x,y=i[a.a].y,w=i[a.b].x,S=i[a.b].y,I=s[a.a],M=s[a.b];const O=f(I,0),L=f(M,0);if(O&&L)return this.setElevatedPoint(e[0],m,y,I),this.setElevatedPoint(e[1],w,S,M),!0;if(!O&&!L)return!1;if(O){if(!L){const F=M/(M-I);w=vi(w,m,F),S=vi(S,y,F),M=vi(M,I,F)}}else{const F=I/(I-M);m=vi(m,w,F),y=vi(y,S,F),I=vi(I,M,F)}return this.setElevatedPoint(e[0],m,y,I),this.setElevatedPoint(e[1],w,S,M),!0}prepareEdges(e,i){if(i.length===0)return;i.sort((y,w)=>y.hash===w.hash?w.polygonIdx-y.polygonIdx:w.hash>y.hash?1:-1);let s=0,a=0,f=0,m=i[s].polygonIdx;do a++,(a===i.length||i[s].hash!==i[a].hash)&&((a-s===1||i[a-1].polygonIdx!==m)&&(f<s&&(i[f]=i[s],i[s]=null),i[f].type="none",f++),s=a,s!==i.length&&(m=i[s].polygonIdx));while(s!==i.length);if(i.splice(f),i.length!==0&&e.length!==0){i.sort((S,I)=>S.portalHash<I.portalHash?1:-1);let y=0,w=0;for(;y!==i.length&&w!==e.length;){const S=i[y],I=e[w];S.portalHash>I.hash?y++:I.hash>S.portalHash?w++:(S.type=I.type,y++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=zt&&i>=zt}addFeatureSection(e,i,s,a){return e!==i&&(i=e,s.push({featureIndex:e,vertexStart:a.getVertexCount()}),a.clearVertexLookup()),i}sortSubarray(e,i,s,a){const f=e.slice(i,s);f.sort(a),e.splice(i,f.length,...f)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(po.computePosHash(e))<<32n|BigInt(po.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}function Vv(n,e){return n>e?1:n<e?-1:0}class py{constructor(e=Vv,i=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!i}rotateLeft(e){var i=e.right;i&&(e.right=i.left,i.left&&(i.left.parent=e),i.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.left=e),e.parent=i}rotateRight(e){var i=e.left;i&&(e.left=i.right,i.right&&(i.right.parent=e),i.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.right=e),e.parent=i}_splay(e){for(;e.parent;){var i=e.parent;i.parent?i.left===e&&i.parent.left===i?(this.rotateRight(i.parent),this.rotateRight(i)):i.right===e&&i.parent.right===i?(this.rotateLeft(i.parent),this.rotateLeft(i)):i.left===e&&i.parent.right===i?(this.rotateRight(i),this.rotateLeft(i)):(this.rotateLeft(i),this.rotateRight(i)):i.left===e?this.rotateRight(i):this.rotateLeft(i)}}splay(e){for(var i,s,a,f,m;e.parent;)(s=(i=e.parent).parent)&&s.parent?((a=s.parent).left===s?a.left=e:a.right=e,e.parent=a):(e.parent=null,this._root=e),f=e.left,m=e.right,e===i.left?(s&&(s.left===i?(i.right?(s.left=i.right,s.left.parent=s):s.left=null,i.right=s,s.parent=i):(f?(s.right=f,f.parent=s):s.right=null,e.left=s,s.parent=e)),m?(i.left=m,m.parent=i):i.left=null,e.right=i,i.parent=e):(s&&(s.right===i?(i.left?(s.right=i.left,s.right.parent=s):s.right=null,i.left=s,s.parent=i):(m?(s.left=m,m.parent=s):s.left=null,e.right=s,s.parent=e)),f?(i.right=f,f.parent=i):i.right=null,e.left=i,i.parent=e)}replace(e,i){e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,i){var s=this._root,a=null,f=this._compare;if(this._noDuplicates)for(;s;){if(a=s,f(s.key,e)===0)return;s=f(s.key,e)<0?s.right:s.left}else for(;s;)a=s,s=f(s.key,e)<0?s.right:s.left;return s={key:e,data:i,left:null,right:null,parent:a},a?f(a.key,s.key)<0?a.right=s:a.left=s:this._root=s,this.splay(s),this._size++,s}find(e){for(var i=this._root,s=this._compare;i;){var a=s(i.key,e);if(a<0)i=i.right;else{if(!(a>0))return i;i=i.left}}return null}contains(e){for(var i=this._root,s=this._compare;i;){var a=s(e,i.key);if(a===0)return!0;i=a<0?i.left:i.right}return!1}remove(e){var i=this.find(e);if(!i)return!1;if(this.splay(i),i.left)if(i.right){var s=this.minNode(i.right);s.parent!==i&&(this.replace(s,s.right),s.right=i.right,s.right.parent=s),this.replace(i,s),s.left=i.left,s.left.parent=s}else this.replace(i,i.left);else this.replace(i,i.right);return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var i=this.minNode(e.right);i.parent!==e&&(this.replace(i,i.right),i.right=e.right,i.right.parent=i),this.replace(e,i),i.left=e.left,i.left.parent=i}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}erase(e){var i=this.find(e);if(i){this.splay(i);var s=i.left,a=i.right,f=null;s&&(s.parent=null,f=this.maxNode(s),this.splay(f),this._root=f),a&&(s?f.right=a:this._root=a,a.parent=f),this._size--}}pop(){var e=this._root,i=null;if(e){for(;e.left;)e=e.left;i={key:e.key,data:e.data},this.remove(e.key)}return i}next(e){var i=e;if(i)if(i.right)for(i=i.right;i&&i.left;)i=i.left;else for(i=e.parent;i&&i.right===e;)e=i,i=i.parent;return i}prev(e){var i=e;if(i)if(i.left)for(i=i.left;i&&i.right;)i=i.right;else for(i=e.parent;i&&i.left===e;)e=i,i=i.parent;return i}forEach(e){for(var i=this._root,s=[],a=!1,f=0;!a;)i?(s.push(i),i=i.left):s.length>0?(e(i=s.pop(),f++),i=i.right):a=!0;return this}range(e,i,s,a){const f=[],m=this._compare;let y,w=this._root;for(;f.length!==0||w;)if(w)f.push(w),w=w.left;else{if(w=f.pop(),y=m(w.key,i),y>0)break;if(m(w.key,e)>=0&&s.call(a,w))return this;w=w.right}return this}keys(){for(var e=this._root,i=[],s=[],a=!1;!a;)e?(i.push(e),e=e.left):i.length>0?(e=i.pop(),s.push(e.key),e=e.right):a=!0;return s}values(){for(var e=this._root,i=[],s=[],a=!1;!a;)e?(i.push(e),e=e.left):i.length>0?(e=i.pop(),s.push(e.data),e=e.right):a=!0;return s}at(e){for(var i=this._root,s=[],a=!1,f=0;!a;)if(i)s.push(i),i=i.left;else if(s.length>0){if(i=s.pop(),f===e)return i;f++,i=i.right}else a=!0;return null}load(e=[],i=[],s=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const a=e.length;return s&&lf(e,i,0,a-1,this._compare),this._root=Jh(null,e,i,0,a),this._size=a,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(e,i,s,a,f){return new py(s,f).load(e,i,a)}}function Jh(n,e,i,s,a){const f=a-s;if(f>0){const m=s+Math.floor(f/2),y={key:e[m],data:i[m],parent:n};return y.left=Jh(y,e,i,s,m),y.right=Jh(y,e,i,m+1,a),y}return null}function lf(n,e,i,s,a){if(i>=s)return;const f=n[i+s>>1];let m=i-1,y=s+1;for(;;){do m++;while(a(n[m],f)<0);do y--;while(a(n[y],f)>0);if(m>=y)break;let w=n[m];n[m]=n[y],n[y]=w,w=e[m],e[m]=e[y],e[y]=w}lf(n,e,i,y,a),lf(n,e,y+1,s,a)}const my=11102230246251565e-32,mo=134217729,gy=(3+8*my)*my;function Um(n,e,i,s,a){let f,m,y,w,S=e[0],I=s[0],M=0,O=0;I>S==I>-S?(f=S,S=e[++M]):(f=I,I=s[++O]);let L=0;if(M<n&&O<i)for(I>S==I>-S?(m=S+f,y=f-(m-S),S=e[++M]):(m=I+f,y=f-(m-I),I=s[++O]),f=m,y!==0&&(a[L++]=y);M<n&&O<i;)I>S==I>-S?(m=f+S,w=m-f,y=f-(m-w)+(S-w),S=e[++M]):(m=f+I,w=m-f,y=f-(m-w)+(I-w),I=s[++O]),f=m,y!==0&&(a[L++]=y);for(;M<n;)m=f+S,w=m-f,y=f-(m-w)+(S-w),S=e[++M],f=m,y!==0&&(a[L++]=y);for(;O<i;)m=f+I,w=m-f,y=f-(m-w)+(I-w),I=s[++O],f=m,y!==0&&(a[L++]=y);return f===0&&L!==0||(a[L++]=f),L}function Qh(n){return new Float64Array(n)}const cf=Qh(4),_y=Qh(8),Gv=Qh(12),yy=Qh(16),wa=Qh(4);function uf(n,e,i){e===null?(n.inOut=!1,n.otherInOut=!0):(n.isSubject===e.isSubject?(n.inOut=!e.inOut,n.otherInOut=e.otherInOut):(n.inOut=!e.otherInOut,n.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(n.prevInResult=!qv(e,i)||e.isVertical()?e.prevInResult:e)),n.resultTransition=qv(n,i)?(function(s,a){let f,m=!s.inOut,y=!s.otherInOut;switch(a){case 0:f=m&&y;break;case 1:f=m||y;break;case 3:f=m!==y;break;case 2:f=s.isSubject?m&&!y:y&&!m}return f?1:-1})(n,i):0}function qv(n,e){switch(n.type){case 0:switch(e){case 0:return!n.otherInOut;case 1:return n.otherInOut;case 2:return n.isSubject&&n.otherInOut||!n.isSubject&&!n.otherInOut;case 3:return!0}break;case 2:return e===0||e===1;case 3:return e===2;case 1:return!1}return!1}class Gu{constructor(e,i,s,a,f){this.left=i,this.point=e,this.otherEvent=s,this.isSubject=a??!1,this.type=f||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const i=this.point,s=this.otherEvent.point;return this.left?(i[0]-e[0])*(s[1]-e[1])-(s[0]-e[0])*(i[1]-e[1])>0:(s[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(s[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const e=new Gu(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function dl(n,e){return n[0]===e[0]&&n[1]===e[1]}function pp(n,e,i){const s=(function(a,f,m,y,w,S){const I=(f-S)*(m-w),M=(a-w)*(y-S),O=I-M;if(I===0||M===0||I>0!=M>0)return O;const L=Math.abs(I+M);return Math.abs(O)>=33306690738754716e-32*L?O:-(function(F,G,W,$,K,te,se){let pe,de,be,Te,ve,Ce,ze,it,Je,tt,dt,ut,ht,Ye,mt,at,_t,ft;const $t=F-K,Wt=W-K,Ft=G-te,jt=$-te;Ye=$t*jt,Ce=mo*$t,ze=Ce-(Ce-$t),it=$t-ze,Ce=mo*jt,Je=Ce-(Ce-jt),tt=jt-Je,mt=it*tt-(Ye-ze*Je-it*Je-ze*tt),at=Ft*Wt,Ce=mo*Ft,ze=Ce-(Ce-Ft),it=Ft-ze,Ce=mo*Wt,Je=Ce-(Ce-Wt),tt=Wt-Je,_t=it*tt-(at-ze*Je-it*Je-ze*tt),dt=mt-_t,ve=mt-dt,cf[0]=mt-(dt+ve)+(ve-_t),ut=Ye+dt,ve=ut-Ye,ht=Ye-(ut-ve)+(dt-ve),dt=ht-at,ve=ht-dt,cf[1]=ht-(dt+ve)+(ve-at),ft=ut+dt,ve=ft-ut,cf[2]=ut-(ft-ve)+(dt-ve),cf[3]=ft;let di=(function(yn,qi){let Ln=qi[0];for(let hn=1;hn<4;hn++)Ln+=qi[hn];return Ln})(0,cf),ni=22204460492503146e-32*se;if(di>=ni||-di>=ni||(ve=F-$t,pe=F-($t+ve)+(ve-K),ve=W-Wt,be=W-(Wt+ve)+(ve-K),ve=G-Ft,de=G-(Ft+ve)+(ve-te),ve=$-jt,Te=$-(jt+ve)+(ve-te),pe===0&&de===0&&be===0&&Te===0)||(ni=11093356479670487e-47*se+gy*Math.abs(di),di+=$t*Te+jt*pe-(Ft*be+Wt*de),di>=ni||-di>=ni))return di;Ye=pe*jt,Ce=mo*pe,ze=Ce-(Ce-pe),it=pe-ze,Ce=mo*jt,Je=Ce-(Ce-jt),tt=jt-Je,mt=it*tt-(Ye-ze*Je-it*Je-ze*tt),at=de*Wt,Ce=mo*de,ze=Ce-(Ce-de),it=de-ze,Ce=mo*Wt,Je=Ce-(Ce-Wt),tt=Wt-Je,_t=it*tt-(at-ze*Je-it*Je-ze*tt),dt=mt-_t,ve=mt-dt,wa[0]=mt-(dt+ve)+(ve-_t),ut=Ye+dt,ve=ut-Ye,ht=Ye-(ut-ve)+(dt-ve),dt=ht-at,ve=ht-dt,wa[1]=ht-(dt+ve)+(ve-at),ft=ut+dt,ve=ft-ut,wa[2]=ut-(ft-ve)+(dt-ve),wa[3]=ft;const qt=Um(4,cf,4,wa,_y);Ye=$t*Te,Ce=mo*$t,ze=Ce-(Ce-$t),it=$t-ze,Ce=mo*Te,Je=Ce-(Ce-Te),tt=Te-Je,mt=it*tt-(Ye-ze*Je-it*Je-ze*tt),at=Ft*be,Ce=mo*Ft,ze=Ce-(Ce-Ft),it=Ft-ze,Ce=mo*be,Je=Ce-(Ce-be),tt=be-Je,_t=it*tt-(at-ze*Je-it*Je-ze*tt),dt=mt-_t,ve=mt-dt,wa[0]=mt-(dt+ve)+(ve-_t),ut=Ye+dt,ve=ut-Ye,ht=Ye-(ut-ve)+(dt-ve),dt=ht-at,ve=ht-dt,wa[1]=ht-(dt+ve)+(ve-at),ft=ut+dt,ve=ft-ut,wa[2]=ut-(ft-ve)+(dt-ve),wa[3]=ft;const Ai=Um(qt,_y,4,wa,Gv);Ye=pe*Te,Ce=mo*pe,ze=Ce-(Ce-pe),it=pe-ze,Ce=mo*Te,Je=Ce-(Ce-Te),tt=Te-Je,mt=it*tt-(Ye-ze*Je-it*Je-ze*tt),at=de*be,Ce=mo*de,ze=Ce-(Ce-de),it=de-ze,Ce=mo*be,Je=Ce-(Ce-be),tt=be-Je,_t=it*tt-(at-ze*Je-it*Je-ze*tt),dt=mt-_t,ve=mt-dt,wa[0]=mt-(dt+ve)+(ve-_t),ut=Ye+dt,ve=ut-Ye,ht=Ye-(ut-ve)+(dt-ve),dt=ht-at,ve=ht-dt,wa[1]=ht-(dt+ve)+(ve-at),ft=ut+dt,ve=ft-ut,wa[2]=ut-(ft-ve)+(dt-ve),wa[3]=ft;const Xi=Um(Ai,Gv,4,wa,yy);return yy[Xi-1]})(a,f,m,y,w,S,L)})(n[0],n[1],e[0],e[1],i[0],i[1]);return s>0?-1:s<0?1:0}function ed(n,e){const i=n.point,s=e.point;return i[0]>s[0]?1:i[0]<s[0]?-1:i[1]!==s[1]?i[1]>s[1]?1:-1:(function(a,f,m){return a.left!==f.left?a.left?1:-1:pp(m,a.otherEvent.point,f.otherEvent.point)!==0?a.isBelow(f.otherEvent.point)?-1:1:!a.isSubject&&f.isSubject?1:-1})(n,e,i)}function Ul(n,e,i){const s=new Gu(e,!1,n,n.isSubject),a=new Gu(e,!0,n.otherEvent,n.isSubject);return dl(n.point,n.otherEvent.point)&&console.warn("what is that, a collapsed segment?",n),s.contourId=a.contourId=n.contourId,ed(a,n.otherEvent)>0&&(n.otherEvent.left=!0,a.left=!1),n.otherEvent.otherEvent=a,n.otherEvent=s,i.push(a),i.push(s),i}function $g(n,e){return n[0]*e[1]-n[1]*e[0]}function Zg(n,e){return n[0]*e[0]+n[1]*e[1]}function Wg(n,e,i){const s=(function(w,S,I,M){const O=[S[0]-w[0],S[1]-w[1]],L=[M[0]-I[0],M[1]-I[1]];function F(be,Te,ve){return[be[0]+Te*ve[0],be[1]+Te*ve[1]]}const G=[I[0]-w[0],I[1]-w[1]];let W=$g(O,L),$=W*W;const K=Zg(O,O);if($>0){const be=$g(G,L)/W;if(be<0||be>1)return null;const Te=$g(G,O)/W;return Te<0||Te>1?null:be===0||be===1?[F(w,be,O)]:Te===0||Te===1?[F(I,Te,L)]:[F(w,be,O)]}if(W=$g(G,O),$=W*W,$>0)return null;const te=Zg(O,G)/K,se=te+Zg(O,L)/K,pe=Math.min(te,se),de=Math.max(te,se);return pe<=1&&de>=0?pe===1?[F(w,pe>0?pe:0,O)]:de===0?[F(w,de<1?de:1,O)]:[F(w,pe>0?pe:0,O),F(w,de<1?de:1,O)]:null})(n.point,n.otherEvent.point,e.point,e.otherEvent.point),a=s?s.length:0;if(a===0||a===1&&(dl(n.point,e.point)||dl(n.otherEvent.point,e.otherEvent.point))||a===2&&n.isSubject===e.isSubject)return 0;if(a===1)return!dl(n.point,s[0])&&!dl(n.otherEvent.point,s[0])&&Ul(n,s[0],i),!dl(e.point,s[0])&&!dl(e.otherEvent.point,s[0])&&Ul(e,s[0],i),1;const f=[];let m=!1,y=!1;return dl(n.point,e.point)?m=!0:ed(n,e)===1?f.push(e,n):f.push(n,e),dl(n.otherEvent.point,e.otherEvent.point)?y=!0:ed(n.otherEvent,e.otherEvent)===1?f.push(e.otherEvent,n.otherEvent):f.push(n.otherEvent,e.otherEvent),m&&y||m?(e.type=1,n.type=e.inOut===n.inOut?2:3,m&&!y&&Ul(f[1].otherEvent,f[0].point,i),2):y?(Ul(f[0],f[1].point,i),3):f[0]!==f[3].otherEvent?(Ul(f[0],f[1].point,i),Ul(f[1],f[2].point,i),3):(Ul(f[0],f[1].point,i),Ul(f[3].otherEvent,f[2].point,i),3)}function Hv(n,e){if(n===e)return 0;if(pp(n.point,n.otherEvent.point,e.point)!==0||pp(n.point,n.otherEvent.point,e.otherEvent.point)!==0)return dl(n.point,e.point)?n.isBelow(e.otherEvent.point)?-1:1:n.point[0]===e.point[0]?n.point[1]<e.point[1]?-1:1:ed(n,e)===1?e.isAbove(n.point)?-1:1:n.isBelow(e.point)?-1:1;if(n.isSubject!==e.isSubject)return n.isSubject?-1:1;{let i=n.point,s=e.point;if(i[0]===s[0]&&i[1]===s[1])return i=n.otherEvent.point,s=e.otherEvent.point,i[0]===s[0]&&i[1]===s[1]?0:(n.contourId??0)>(e.contourId??0)?1:-1}return ed(n,e)===1?1:-1}class $v{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function vy(n,e,i,s){let a,f=n+1,m=e[n].point;const y=e.length;for(f<y&&(a=e[f].point);f<y&&a[0]===m[0]&&a[1]===m[1];){if(!i[f])return f;f++,f<y&&(a=e[f].point)}for(f=n-1;i[f]&&f>s;)f--;return f}function Zv(n,e,i){const s=new $v;if(n.prevInResult!=null){const a=n.prevInResult,f=a.outputContourId;if(a.resultTransition>0){const m=e[f];if(m.holeOf!=null){const y=m.holeOf;e[y].holeIds.push(i),s.holeOf=y,s.depth=e[f].depth}else e[f].holeIds.push(i),s.holeOf=f,s.depth=e[f].depth+1}else s.holeOf=null,s.depth=e[f].depth}else s.holeOf=null,s.depth=0;return s}const xy=Math.max,Vm=Math.min;let Xg=0;function Wv(n,e,i,s,a,f){let m,y,w,S,I,M;for(m=0,y=n.length-1;m<y;m++){if(w=n[m],S=n[m+1],I=new Gu(w,!1,void 0,e),M=new Gu(S,!1,I,e),I.otherEvent=M,w[0]===S[0]&&w[1]===S[1])continue;I.contourId=M.contourId=i,f||(I.isExteriorRing=!1,M.isExteriorRing=!1),ed(I,M)>0?M.left=!0:I.left=!0;const O=w[0],L=w[1];a[0]=Vm(a[0],O),a[1]=Vm(a[1],L),a[2]=xy(a[2],O),a[3]=xy(a[3],L),s.push(I),s.push(M)}}const mp=[];function Yg(n,e,i){let s=n,a=e;typeof n[0][0][0]=="number"&&(s=[n]),typeof e[0][0][0]=="number"&&(a=[e]);let f=(function(O,L,F){let G=null;return O.length*L.length===0&&(F===0?G=mp:F===2?G=O:(F===1||F===3)&&(G=O.length===0?L:O)),G})(s,a,i);if(f)return f===mp?null:f;const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],w=(function(O,L,F,G,W){const $=new pu(void 0,ed);let K,te,se,pe,de,be;for(se=0,pe=O.length;se<pe;se++)for(K=O[se],de=0,be=K.length;de<be;de++)te=de===0,te&&Xg++,Wv(K[de],!0,Xg,$,F,te);for(se=0,pe=L.length;se<pe;se++)for(K=L[se],de=0,be=K.length;de<be;de++)te=de===0,W===2&&(te=!1),te&&Xg++,Wv(K[de],!1,Xg,$,G,te);return $})(s,a,m,y,i);if(f=(function(O,L,F,G,W){let $=null;return(F[0]>G[2]||G[0]>F[2]||F[1]>G[3]||G[1]>F[3])&&(W===0?$=mp:W===2?$=O:(W===1||W===3)&&($=O.concat(L))),$})(s,a,m,y,i),f)return f===mp?null:f;const S=(function(O,L,F,G,W,$){const K=new py(Hv),te=[],se=Math.min(G[2],W[2]);let pe,de,be;for(;O.length!==0;){let Te=O.pop();if(te.push(Te),$===0&&Te.point[0]>se||$===2&&Te.point[0]>G[2])break;if(Te.left){de=pe=K.insert(Te),be=K.minNode(),pe=pe!==be?K.prev(pe):null,de=K.next(de);const ve=pe?pe.key:null;let Ce;if(uf(Te,ve,$),de&&Wg(Te,de.key,O)===2&&(uf(Te,ve,$),uf(de.key,Te,$)),pe&&Wg(pe.key,Te,O)===2){let ze=pe;ze=ze!==be?K.prev(ze):null,Ce=ze?ze.key:null,uf(ve,Ce,$),uf(Te,ve,$)}}else Te=Te.otherEvent,de=pe=K.find(Te),pe&&de&&(pe=pe!==be?K.prev(pe):null,de=K.next(de),K.remove(Te),de&&pe&&Wg(pe.key,de.key,O))}return te})(w,0,0,m,y,i),I=(function(O){let L,F;const G=(function(K){let te,se,pe,de,be;const Te=[];for(se=0,pe=K.length;se<pe;se++)te=K[se],(te.left&&te.inResult||!te.left&&te.otherEvent.inResult)&&Te.push(te);let ve=!1;for(;!ve;)for(ve=!0,se=0,pe=Te.length;se<pe;se++)se+1<pe&&ed(Te[se],Te[se+1])===1&&(de=Te[se],Te[se]=Te[se+1],Te[se+1]=de,ve=!1);for(se=0,pe=Te.length;se<pe;se++)te=Te[se],te.otherPos=se;for(se=0,pe=Te.length;se<pe;se++)te=Te[se],te.left||(be=te.otherPos,te.otherPos=te.otherEvent.otherPos,te.otherEvent.otherPos=be);return Te})(O),W={},$=[];for(L=0,F=G.length;L<F;L++){if(W[L])continue;const K=$.length,te=Zv(G[L],$,K),se=be=>{W[be]=!0,be<G.length&&G[be]&&(G[be].outputContourId=K)};let pe=L,de=L;for(te.points.push(G[L].point);se(pe),pe=G[pe].otherPos,se(pe),te.points.push(G[pe].point),pe=vy(pe,G,W,de),!(pe==de||pe>=G.length)&&G[pe];);$.push(te)}return $})(S),M=[];for(let O=0;O<I.length;O++){let L=I[O];if(L.isExterior()){let F=[L.points];for(let G=0;G<L.holeIds.length;G++)F.push(I[L.holeIds[G]].points);M.push(F)}}return M}function hf(n,e,i,s){const a=[],f=s===0?(m,y,w,S,I,M)=>{m.push(new pt(M,w+(M-y)/(S-y)*(I-w)))}:(m,y,w,S,I,M)=>{m.push(new pt(y+(M-w)/(I-w)*(S-y),M))};for(const m of n){const y=[];for(const w of m){if(w.length<=2)continue;const S=[];for(let O=0;O<w.length-1;O++){const L=w[O].x,F=w[O].y,G=w[O+1].x,W=w[O+1].y,$=s===0?L:F,K=s===0?G:W;$<e?K>e&&f(S,L,F,G,W,e):$>i?K<i&&f(S,L,F,G,W,i):S.push(w[O]),K<e&&$>=e&&f(S,L,F,G,W,e),K>i&&$<=i&&f(S,L,F,G,W,i)}let I=w[w.length-1];const M=s===0?I.x:I.y;M>=e&&M<=i&&S.push(I),S.length&&(I=S[S.length-1],S[0].x===I.x&&S[0].y===I.y||S.push(S[0]),y.push(S))}y.length&&a.push(y)}return a}function by(n,e){const i=Yg(Gm(n),Gm([e]),0);return i==null?[]:qu(i)}function Xv(n,e){let s=Gm(n,65536);const a=[];for(;e.valid();e.next()){const[f,m]=e.get(),y=f.x*65536,w=f.y*65536,S=m.x*65536,I=m.y*65536,M=S-y,O=I-w,L=Math.hypot(M,O);if(L===0)continue;const F=Math.trunc(O/L*3),G=-Math.trunc(M/L*3);a.push([[[y,w],[S,I],[S+F,I+G],[y+F,w+G],[y,w]]])}return a.length>0&&(s=Yg(s,a,2)),qu(s,1/65536,128)}function Gm(n,e=1){return[n.map(i=>i.map(s=>[s.x*e,s.y*e]))]}function qu(n,e=1,i){return n.map(s=>s.map((a,f)=>{const m=a.map(y=>{let w=y[0],S=y[1];return i&&(w=Math.round(w/i)*i,S=Math.round(S/i)*i),new pt(w*e,S*e)._round()});return f>0&&m.reverse(),m}))}class eu{constructor(e,i){this.layoutVertexArray=new hc,this.indexArray=new Kr,this.lineIndexArray=new xa,this.triangleSegments=new Wn,this.lineSegments=new Wn,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new ms)}update(e,i,s,a,f,m,y,w){this.programConfigurations.updatePaintArrays(e,i,f,s,a,m,y,w)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Fv.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,s,a,f,m,y){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,s,a,f,m,void 0,y)}}class tu{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new eu(e,!1),this.elevationBufferData=new eu(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.hasPattern=dy("fill",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:w,index:S,sourceLayerIndex:I}of e){const M=this.layers[0]._featureFilter.needGeometry,O=Pi(y,M);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),O,s))continue;const L=f?f.evaluate(O,{},s,i.availableImages):void 0,F={id:w,properties:y.properties,type:y.type,sourceLayerIndex:I,index:S,geometry:M?O.geometry:_i(y,s,a),patterns:{},sortKey:L};m.push(F)}f&&m.sort((y,w)=>y.sortKey-w.sortKey);for(const y of m){const{geometry:w,index:S,sourceLayerIndex:I}=y;if(this.hasPattern){const M=fy("fill",this.layers,y,this.zoom,this.pixelRatio,i);this.patternFeatures.push(M)}else this.addFeature(y,w,S,s,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[S].feature,w,S,I,this.index)}}update(e,i,s,a,f,m,y){this.bufferData.update(e,i,s,a,f,m,y,this.worldview),this.elevationBufferData.update(e,i,s,a,f,m,y,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,s,a,f,m,y,this.worldview)}addFeatures(e,i,s,a,f,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,s,a,m,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,s,a,f,m=[],y,w){const S=jm(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,S,a,s,w):this.addGeometry(S,this.bufferData),this.bufferData.populatePaintArrays(e,s,f,m,a,y,this.worldview),this.elevationBufferData.populatePaintArrays(e,s,f,m,a,y,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}setEvaluatedPortalGraph(e,i,s,a,f){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,s,a,f,this.worldview))}addElevatedRoadFeature(e,i,s,a,f){const m=new Array,y=Ys.getElevationFeature(e,f);if(!y)return void this.addGeometry(i,this.bufferData);{const S=this.clipPolygonsToTile(i,1);S.length>0&&m.push({polygons:S,elevationFeature:y,elevationTileID:s})}const w={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},s),featureIndex:a};for(const S of m)if(S.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new po(S.elevationTileID,this.layers,this.zoom,this.lut));const M=S.elevationFeature.isTunnel();let O=0;e.properties.hasOwnProperty(Li)&&(O=+e.properties[Li]),this.elevatedStructures.addPortalCandidates(S.elevationFeature.id,S.polygons,M,S.elevationFeature,O)}S.elevationFeature.constantHeight==null&&(S.polygons=this.prepareElevatedPolygons(S.polygons,S.elevationFeature,S.elevationTileID));const I=new aa(s,S.elevationTileID);this.addElevatedGeometry(S.polygons,I,S.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,a,w)}}addElevatedGeometry(e,i,s,a,f,m){const y={elevation:s,elevationSampler:i,bias:a,index:f,featureInfo:m},[w,S]=this.addGeometry(e,this.elevationBufferData,y);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:w,max:S}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,w),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,S))}addGeometry(e,i,s){let a=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,m=null;s&&(m=s.elevationSampler.constantElevation(s.elevation,s.bias),m!=null&&(a=m,f=m));const y=(w,S,I)=>{if(s!=null)if(S.push(w),m!=null)i.elevatedLayoutVertexArray.emplaceBack(m),I.push(m);else{const M=s.elevationSampler.pointElevation(w,s.elevation,s.bias);i.elevatedLayoutVertexArray.emplaceBack(M),I.push(M),a=Math.min(a,M),f=Math.max(f,M)}};for(const w of e){let S=0;for(const te of w)S+=te.length;const I=i.triangleSegments.prepareSegment(S,i.layoutVertexArray,i.indexArray),M=I.vertexLength,O=[],L=[],F=[],G=[],W=[],$=i.layoutVertexArray.length;for(const te of w){if(te.length===0)continue;te!==w[0]&&L.push(O.length/2);const se=i.lineSegments.prepareSegment(te.length,i.layoutVertexArray,i.lineIndexArray),pe=se.vertexLength;s&&W.push(i.layoutVertexArray.length-$),y(te[0],F,G),i.layoutVertexArray.emplaceBack(te[0].x,te[0].y),i.lineIndexArray.emplaceBack(pe+te.length-1,pe),O.push(te[0].x),O.push(te[0].y);for(let de=1;de<te.length;de++)y(te[de],F,G),i.layoutVertexArray.emplaceBack(te[de].x,te[de].y),i.lineIndexArray.emplaceBack(pe+de-1,pe+de),O.push(te[de].x),O.push(te[de].y);se.vertexLength+=te.length,se.primitiveLength+=te.length}const K=hl(O,L);for(let te=0;te<K.length;te+=3)i.indexArray.emplaceBack(M+K[te],M+K[te+1],M+K[te+2]);if(K.length>0&&s&&this.elevationMode==="hd-road-base"){const te=s.elevation.isTunnel(),se=s.elevation.safeArea,pe=this.elevatedStructures.addVertices(F,G);this.elevatedStructures.addTriangles(K,pe,te);const de=W.length;if(de>0){for(let be=0;be<de-1;be++)this.elevatedStructures.addRenderableRing(s.index,W[be]+pe,W[be+1]-W[be],te,se,s.featureInfo);this.elevatedStructures.addRenderableRing(s.index,W[de-1]+pe,F.length-W[de-1],te,se,s.featureInfo)}}I.vertexLength+=S,I.primitiveLength+=K.length/3}return[a,f]}prepareElevatedPolygons(e,i,s){const a=1/St(s),f=[];for(const m of e){const y=Xv(m,new No(i,a));f.push(...y)}return f}clipPolygonsToTile(e,i){const s=-i,a=-i,f=zt+i,m=zt+i;let y=0;const w=[],S=[];for(;y<e.length;y++){const O=e[y],L=Za(O);(L.min.x>=s&&L.max.x<=f&&L.min.y>=a&&L.max.y<=m?w:S).push(O)}if(w.length===e.length)return e;const I=[new pt(s,a),new pt(f,a),new pt(f,m),new pt(s,m),new pt(s,a)],M=w;for(const O of S)M.push(...by(O,I));return M}}let gp,_p,Hu,Yv;Mt(tu,"FillBucket",{omit:["layers","patternFeatures"]}),Mt(eu,"FillBufferData"),Mt(po,"ElevatedStructures");class qm{constructor(e,i,s,a){if(this.triangleCount=i.length/3,this.min=new pt(0,0),this.max=new pt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[f,m]=[e[0].clone(),e[0].clone()];for(let M=1;M<e.length;++M){const O=e[M];f.x=Math.min(f.x,O.x),f.y=Math.min(f.y,O.y),m.x=Math.max(m.x,O.x),m.y=Math.max(m.y,O.y)}if(a){const M=Math.ceil(Math.max(m.x-f.x,m.y-f.y)/a);s=Math.max(s,M)}if(s===0)return;this.min=f,this.max=m;const y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);const w=Math.max(y.x,y.y)/s;this.cellsX=Math.max(1,Math.ceil(y.x/w)),this.cellsY=Math.max(1,Math.ceil(y.y/w)),this.xScale=1/w,this.yScale=1/w;const S=[];for(let M=0;M<this.triangleCount;M++){const O=e[i[3*M+0]].sub(this.min),L=e[i[3*M+1]].sub(this.min),F=e[i[3*M+2]].sub(this.min),G=ja(Math.floor(Math.min(O.x,L.x,F.x)),this.xScale,this.cellsX),W=ja(Math.floor(Math.max(O.x,L.x,F.x)),this.xScale,this.cellsX),$=ja(Math.floor(Math.min(O.y,L.y,F.y)),this.yScale,this.cellsY),K=ja(Math.floor(Math.max(O.y,L.y,F.y)),this.yScale,this.cellsY),te=new pt(0,0),se=new pt(0,0),pe=new pt(0,0),de=new pt(0,0);for(let be=$;be<=K;++be){te.y=se.y=be*w,pe.y=de.y=(be+1)*w;for(let Te=G;Te<=W;++Te)te.x=pe.x=Te*w,se.x=de.x=(Te+1)*w,(Hn(O,L,F,te,se,de)||Hn(O,L,F,te,de,pe))&&S.push({cellIdx:be*this.cellsX+Te,triIdx:M})}}if(S.length===0)return;S.sort((M,O)=>M.cellIdx-O.cellIdx||M.triIdx-O.triIdx);let I=0;for(;I<S.length;){const M=S[I].cellIdx,O={start:this.payload.length,len:0};for(;I<S.length&&S[I].cellIdx===M;)++O.len,this.payload.push(S[I++].triIdx);this.cells[M]=O}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=ja(e.x-this.min.x,this.xScale,this.cellsX),a=ja(e.y-this.min.y,this.yScale,this.cellsY),f=this.cells[a*this.cellsX+s];if(f){this._lazyInitLookup();for(let m=0;m<f.len;m++){const y=this.payload[f.start+m],w=Math.floor(y/8),S=1<<y%8;if(!(this.lookup[w]&S)&&(this.lookup[w]|=S,i.push(y),i.length===this.triangleCount))return}}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const a=ja(e.x-this.min.x,this.xScale,this.cellsX),f=ja(i.x-this.min.x,this.xScale,this.cellsX),m=ja(e.y-this.min.y,this.yScale,this.cellsY),y=ja(i.y-this.min.y,this.yScale,this.cellsY);for(let w=m;w<=y;w++)for(let S=a;S<=f;S++){const I=this.cells[w*this.cellsX+S];if(I)for(let M=0;M<I.len;M++){const O=this.payload[I.start+M],L=Math.floor(O/8),F=1<<O%8;if(!(this.lookup[L]&F)&&(this.lookup[L]|=F,s.push(O),s.length===this.triangleCount))return}}}}function ja(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}Mt(qm,"TriangleGridIndex");class Kv{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const s of this.footprints)i.push({footprint:s,id:e})}updateAppearances(e,i,s,a){}populate(e,i,s,a){const f=[];for(const{feature:m,id:y,index:w,sourceLayerIndex:S}of e){const I=this.layers[0]._featureFilter.needGeometry,M=Pi(m,I);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),M,s))continue;const O={id:y,properties:m.properties,type:m.type,sourceLayerIndex:S,index:w,geometry:I?M.geometry:_i(m,s,a),patterns:{}};f.push(O)}for(const m of f){const{geometry:y,index:w,sourceLayerIndex:S}=m;this.addFeature(m,y,w,s,{},i.availableImages,i.brightness),i.featureIndex.insert(e[w].feature,y,w,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,s,a,f,m,y){}destroy(){}addFeature(e,i,s,a,f,m=[],y){for(const w of jm(i,2)){const S=[],I=[],M=[],O=new pt(1/0,1/0),L=new pt(-1/0,-1/0);for(const W of w)if(W.length!==0){W!==w[0]&&M.push(I.length/2);for(let $=0;$<W.length;$++)I.push(W[$].x),I.push(W[$].y),S.push(W[$]),O.x=Math.min(O.x,W[$].x),O.y=Math.min(O.y,W[$].y),L.x=Math.max(L.x,W[$].x),L.y=Math.max(L.y,W[$].y)}const F=hl(I,M),G=new qm(S,F,8,256);this.footprints.push({vertices:S,indices:F,grid:G,min:O,max:L})}}}Mt(Kv,"ClipBucket",{omit:["layers"]});const Jv=$i([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Kg=$i([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Qv=$i([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),tb=$i([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Jg=$i([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Qg=$i([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),e0=$i([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:yp}=Jv,vp=Number.MAX_SAFE_INTEGER,wy=vp-1;function Hm(n,e,i,s){return n.order<e||n.order===vp||!(n.clipMask&i)||(function(a,f){return f.length!==0&&f.find(m=>m===a)===void 0})(s,n.clipScope)}function $m(n,e){return n.x-e.x||n.y-e.y}function t0(n,e){return $m(n.min,e.min)===0&&$m(n.max,e.max)===0}function xp(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function l(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!t0(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!Yn(n[i].clipScope,e[i].clipScope))return!1;return!0}function p(n,e,i){const s=1/zt,a=1/(1<<i.canonical.z),f=(e.x*s+i.canonical.x)*a+i.wrap,m=(e.y*s+i.canonical.y)*a;return{min:new pt((n.x*s+i.canonical.x)*a+i.wrap,(n.y*s+i.canonical.y)*a),max:new pt(f,m)}}function x(n,e,i){const s=1<<i.canonical.z,a=((e.x-i.wrap)*s-i.canonical.x)*zt,f=(e.y*s-i.canonical.y)*zt;return{min:new pt(((n.x-i.wrap)*s-i.canonical.x)*zt,(n.y*s-i.canonical.y)*zt),max:new pt(a,f)}}function A(n,e,i,s,a,f,m){const y=n.indices,w=n.vertices,S=[];for(let I=s;I<s+a;I+=3){const M=e[i[I+0]+f],O=e[i[I+1]+f],L=e[i[I+2]+f],F=Math.min(M.x,O.x,L.x),G=Math.max(M.x,O.x,L.x),W=Math.min(M.y,O.y,L.y),$=Math.max(M.y,O.y,L.y);S.length=0,n.grid.query(new pt(F,W),new pt(G,$),S);for(let K=0;K<S.length;K++){const te=S[K];if(Hn(w[y[3*te+0]],w[y[3*te+1]],w[y[3*te+2]],M,O,L,m))return!0}}return!1}function k(n,e,i,s){if(!n||!i)return!1;let a=n.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<n.vertices.length)return k(i,s,n,e);const f=e.canonical,m=s.canonical,y=Math.pow(2,m.z-f.z);a=n.vertices.map(w=>new pt((w.x+f.x*zt)*y-m.x*zt,(w.y+f.y*zt)*y-m.y*zt))}return A(i,a,n.indices,0,n.indices.length,0,0)}function j(n,e,i,s){const a=Math.pow(2,s.z-i.z);return new pt((n+i.x*zt)*a-s.x*zt,(e+i.y*zt)*a-s.y*zt)}function oe(n,e){const i=[];e.grid.queryPoint(n,i);const s=e.indices,a=e.vertices;for(let f=0;f<i.length;f++){const m=i[f];if(Uo([a[s[3*m+0]],a[s[3*m+1]],a[s[3*m+2]]],n))return!0}return!1}const Ie=[new pt(0,0),new pt(zt,0),new pt(zt,zt),new pt(0,zt)];function et(n,e){const i=[];let s=[];if(!e||n.length<2)return[n];if(n.length===2)return ul(n[0],n[1],Ie)?[n]:[];for(let a=0;a<n.length+2;a++){const f=n[a%n.length],m=n[(a+1)%n.length],y=ul(a===0?n[n.length-1]:n[(a-1)%n.length],f,Ie),w=ul(f,m,Ie),S=y||w;S&&s.push(f),S&&w||s.length>0&&(s.length>1&&i.push(s),s=[])}return s.length>1&&i.push(s),i}const Ot=Zi.types,Xt=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],ti=["fill-extrusion-flood-light-ground-radius"],Lt=Math.pow(2,13),Vt=Math.pow(2,15)-1,Vi=new pt(0,1),nn=2147483648;function Ar(n,e,i,s,a,f,m,y){n.emplaceBack((e<<1)+m,(i<<1)+f,(Math.floor(s*Lt)<<1)+a,Math.round(y))}function xt(n,e,i){n.emplaceBack(e.x*zt,e.y*zt,i?1:0)}function st(n,e,i,s,a,f){n.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+a,f)}function Rt(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Jt{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ln{constructor(){this.centroidXY=new pt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new pt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new pt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new pt(this.max.x-this.min.x,this.max.y-this.min.y)}}class fr{constructor(){this.acc=new pt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let a=!!this.borders;i.x<e.min.x?(e.min.x=i.x,a=!0):i.x>e.max.x&&(e.max.x=i.x,a=!0),i.y<e.min.y?(e.min.y=i.y,a=!0):i.y>e.max.y&&(e.max.y=i.y,a=!0),((i.x===0||i.x===zt)&&i.x===s.x)!=((i.y===0||i.y===zt)&&i.y===s.y)&&this.processBorderOverlap(i,s),a&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,vi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>zt!=e.x>zt&&this.addBorderIntersection(1,vi(i.y,e.y,(zt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,vi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>zt!=e.y>zt&&this.addBorderIntersection(3,vi(i.x,e.x,(zt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new pt(0,0):new pt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function Wi(n,e){const i=n.add(e)._unit(),s=_e(n.x*i.x+n.y*i.y,-1,1);var a,f,m;return m=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(m)))/4*Vt*((a=n).x*(f=e).y-a.y*f.x<0?-1:1)}const Nn=[n=>n.x<0,n=>n.x>zt,n=>n.y<0,n=>n.y>zt];function er(n,e,i,s){const a=[4];if(s===0)return a;i._mult(s);const f=n.sub(i),m=e.sub(i),y=[n,e,f,m];for(let w=0;w<4;w++)for(const S of y)if(Nn[w](S)){a.push(w);break}return a}class ur{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new ss,this.indexArray=new Kr,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut},i=>ti.includes(i)),this._segments=new Wn,this.hiddenByLandmarkVertexArray=new ef,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Wn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,a=!1){const f=e.length;if(f>2){let m=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let w;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const S=e[0],I=e[1];w=Wi(S.sub(e[f-1])._perp()._unit(),I.sub(S)._perp()._unit())}for(let S=0;S<f;S++){const I=S===f-1?0:S+1,M=e[S],O=e[I],L=e[I===f-1?0:I+1],F=O.sub(M)._perp()._unit(),G=Wi(F,L.sub(O)._perp()._unit()),W=w,$=G;if(ib(M,O,i)||a&&Q1(M,i)&&Q1(O,i)){w=G;continue}const K=y.vertexLength;st(this.vertexArray,M,O,1,1,W),st(this.vertexArray,M,O,1,0,W),st(this.vertexArray,M,O,0,1,$),st(this.vertexArray,M,O,0,0,$),y.vertexLength+=4;const te=er(M,O,F,s);for(const se of te)this._segmentToGroundQuads[m].push({id:K,region:se}),this._segmentToRegionTriCounts[m][se]+=2,y.primitiveLength+=2;w=G}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort((a,f)=>a.region-f.region);for(let s=0;s<i;s++){const a=this._segmentToGroundQuads[s],f=e[s],m=this._segmentToRegionTriCounts[s];m.reduce((w,S)=>w+S,0);let y=0;for(let w=0;w<=4;w++){const S=m[w];if(S!==0){let I=this.regionSegments[w];I||(I=this.regionSegments[w]=new Wn);const M={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+y,vertexLength:f.vertexLength,primitiveLength:S};I.get().push(M)}y+=S}for(let w=0;w<a.length;w++){const S=a[w].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,a,f,m,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,a,f,m,void 0,y)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Kg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,Qv.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,a,f,m,y,w){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,a,f,m,y,w)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&nn))}updateHiddenByLandmarkRange(e,i,s){if(!this.hasData())return;const a=i+e;if(i!==0){for(let f=e;f<a;++f)this.hiddenByLandmarkVertexArray.emplace(f,s?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Qg.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class _c{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Kr,this.footprintVertices=new hc,this.footprintSegments=[],this.layoutVertexArray=new Ll,this.centroidVertexArray=new fc,this.wallVertexArray=new wm,this.indexArray=new Kr,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut},i=>Xt.includes(i)),this.segments=new Wn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new ur(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.features=[],this.hasPattern=dy("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=St(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:m,index:y,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,I=Pi(f,S);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),I,s))continue;const M={id:m,sourceLayerIndex:w,index:y,geometry:S?I.geometry:_i(f,s,a),properties:f.properties,type:f.type,patterns:{}},O=this.layoutVertexArray.length,L=Ot[M.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:f.id,feature:fy("fill-extrusion",this.layers,M,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const F of M.geometry)for(const G of et(F,L))this.addFeature(f.id,M,[G],y,s,{},i.availableImages,a,i.brightness);else this.addFeature(f.id,M,M.geometry,y,s,{},i.availableImages,a,i.brightness);i.featureIndex.insert(f,M.geometry,y,w,this.index,O)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,a,f,m){for(const{featureId:y,feature:w}of this.features){const S=Ot[w.type]==="Polygon",{geometry:I}=w;if(this.wallMode)for(const M of I)for(const O of et(M,S))this.addFeature(y,w,[O],w.index,i,s,a,f,m);else this.addFeature(y,w,I,w.index,i,s,a,f,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,a,f,m,y){this.programConfigurations.updatePaintArrays(e,i,f,s,a,m,y,this.worldview),this.groundEffect.update(e,i,f,s,a,m,y,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yp),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,Jg.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,e0.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,tb.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,a,f,m,y,w,S){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,M=[new pt(0,0),new pt(zt,zt)],O=w.projection,L=O.name==="globe",F=this.wallMode||Ot[i.type]==="Polygon",G=new fr;G.centroidDataIndex=this.centroidData.length;const W=new ln;W.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(W.buildingId=Number(i.properties.building_id));const $=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},f)<=0,K=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},f);let te;if(W.height=K,W.vertexArrayOffset=this.layoutVertexArray.length,W.groundVertexArrayOffset=this.groundEffect.vertexArray.length,L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Pu),this.wallMode){if(L)return void bi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;te=(function(Ce){const ze=Ce[0].x===Ce[Ce.length-1].x&&Ce[0].y===Ce[Ce.length-1].y;(function(Ft){let jt=0;const di=Ft.length;for(let ni=0;ni<di;ni++)jt+=(Ft[(ni+1)%di].x-Ft[ni].x)*(Ft[(ni+1)%di].y+Ft[ni].y);return jt>=0})(Ce)||(Ce=Ce.reverse());const Je={geometry:[],joinNormals:[],indices:[]},tt=[],dt=[],ut=[];let ht=Ce.length;for(;ht>=2&&Ce[ht-1].equals(Ce[ht-2]);)ht--;if(ht<(ze?3:2))return Je;let Ye,mt,at,_t,ft,$t=0;for(;$t<ht-1&&Ce[$t].equals(Ce[$t+1]);)$t++;ze&&(Ye=Ce[ht-2],ft=Ce[$t].sub(Ye)._unit()._perp());for(let Ft=$t;Ft<ht;Ft++){if(at=Ft===ht-1?ze?Ce[$t+1]:void 0:Ce[Ft+1],at&&Ce[Ft].equals(at))continue;ft&&(_t=ft),Ye&&(mt=Ye),Ye=Ce[Ft],ft=at?at.sub(Ye)._unit()._perp():_t,_t=_t||ft;let jt=_t.add(ft);jt.x===0&&jt.y===0||jt._unit();const di=jt.x*ft.x+jt.y*ft.y,ni=di!==0?1/di:1/0,qt=_t.x*ft.y-_t.y*ft.x>0;let Ai="miter";const Xi=2;Ai==="miter"&&ni>Xi&&(Ai="bevel"),Ai==="bevel"&&(ni>100&&(Ai="flipbevel"),ni<Xi&&(Ai="miter"));const yn=(qi,Ln,hn,Fr)=>{const gn=new pt(qi.x,qi.y),Pn=new pt(qi.x,qi.y);gn.x+=Ln.x*Fr,gn.y+=Ln.y*Fr,Pn.x-=Ln.x*Math.max(hn,1),Pn.y-=Ln.y*Math.max(hn,1),ut.push(Ln),tt.push(gn),dt.push(Pn)};if(Ai==="miter")jt._mult(ni),yn(Ye,jt,0,0);else if(Ai==="flipbevel")jt=ft.mult(-1),yn(Ye,jt,0,0),yn(Ye,jt.mult(-1),0,0);else{const qi=-Math.sqrt(ni*ni-1),Ln=qt?qi:0,hn=qt?0:qi;mt&&yn(Ye,_t,Ln,hn),at&&yn(Ye,ft,Ln,hn)}}Je.geometry=[...tt,...dt.reverse(),tt[0]],Je.joinNormals=[...ut,...ut.reverse(),ut[ut.length-1]];const Wt=Je.geometry.length-1;for(let Ft=0;Ft<Wt/2;Ft++)if(Ft+1<Wt/2){let jt=Ft,di=Ft+1,ni=Wt-1-Ft,qt=Wt-2-Ft;jt=jt===0?Wt-1:jt-1,di=di===0?Wt-1:di-1,ni=ni===0?Wt-1:ni-1,qt=qt===0?Wt-1:qt-1,Je.indices.push(ni),Je.indices.push(di),Je.indices.push(jt),Je.indices.push(ni),Je.indices.push(qt),Je.indices.push(di)}return Je})(s[0]),s=[te.geometry]}const se=(Ce,ze)=>Ce<(ze.length-1)/2||Ce===ze.length-1,pe=this.wallMode?[s]:jm(s,500);for(let Ce=pe.length-1;Ce>=0;Ce--){const ze=pe[Ce];(ze.length===0||QR(ze[0]))&&pe.splice(Ce,1)}let de;if(L)de=nT(pe,M,f);else{de=[];for(const Ce of pe)de.push({polygon:Ce,bounds:M})}const be=F?this.edgeRadius:0,Te=be>0&&this.zoom<17,ve=(Ce,ze)=>{if(Ce.length===0)return!1;const it=Ce[Ce.length-1];return ze.x===it.x&&ze.y===it.y};for(const{polygon:Ce,bounds:ze}of de){let it=0,Je=0;for(const ht of Ce)F&&!ht[0].equals(ht[ht.length-1])&&ht.push(ht[0]),Je+=F?ht.length-1:ht.length;const tt=this.segments.prepareSegment((F?5:4)*Je,this.layoutVertexArray,this.indexArray);W.footprintSegIdx<0&&(W.footprintSegIdx=this.footprintSegments.length),W.polygonSegIdx<0&&(W.polygonSegIdx=this.polygonSegments.length);const dt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ut=new Jt;if(ut.vertexOffset=this.footprintVertices.length,ut.indexOffset=3*this.footprintIndices.length,ut.ringIndices=[],F){const ht=[],Ye=[];it=tt.vertexLength;for(let at=0;at<Ce.length;at++){const _t=Ce[at];_t.length&&at!==0&&Ye.push(ht.length/2);const ft=[];let $t,Wt;$t=_t[1].sub(_t[0])._perp()._unit(),ut.ringIndices.push(_t.length-1);for(let Ft=1;Ft<_t.length;Ft++){const jt=_t[Ft],di=_t[Ft===_t.length-1?1:Ft+1],ni=jt.clone();if(be){Wt=di.sub(jt)._perp()._unit();const qt=$t.add(Wt)._unit(),Ai=be*Math.min(4,1/($t.x*qt.x+$t.y*qt.y));ni.x+=Ai*qt.x,ni.y+=Ai*qt.y,ni.x=Math.round(ni.x),ni.y=Math.round(ni.y),$t=Wt}if(!$||be!==0&&!Te||ve(ft,ni)||ft.push(ni),Ar(this.layoutVertexArray,ni.x,ni.y,0,0,1,1,0),this.wallMode){const qt=se(Ft,_t);xt(this.wallVertexArray,te.joinNormals[Ft],!qt)}tt.vertexLength++,this.footprintVertices.emplaceBack(jt.x,jt.y),ht.push(jt.x,jt.y),L&&Rt(this.layoutVertexExtArray,O.projectTilePoint(ni.x,ni.y,f),O.upVector(f,ni.x,ni.y))}$&&(be===0||Te)&&(ft.length!==0&&ve(ft,ft[0])&&ft.pop(),this.groundEffect.addData(ft,ze,I))}const mt=this.wallMode?te.indices:hl(ht,Ye);for(let at=0;at<mt.length;at+=3)this.footprintIndices.emplaceBack(ut.vertexOffset+mt[at+0],ut.vertexOffset+mt[at+1],ut.vertexOffset+mt[at+2]),this.indexArray.emplaceBack(it+mt[at],it+mt[at+2],it+mt[at+1]),tt.primitiveLength++;ut.indexCount+=mt.length,ut.vertexCount+=this.footprintVertices.length-ut.vertexOffset}for(let ht=0;ht<Ce.length;ht++){const Ye=Ce[ht];G.startRing(W,Ye[0]);let mt=Ye.length>4&&eT(Ye[Ye.length-2],Ye[0],Ye[1]),at=be?JR(Ye[Ye.length-2],Ye[0],Ye[1],be):0;const _t=[];let ft,$t,Wt;$t=Ye[1].sub(Ye[0])._perp()._unit();let Ft=!0;for(let jt=1,di=0;jt<Ye.length;jt++){let ni=Ye[jt-1],qt=Ye[jt];const Ai=Ye[jt===Ye.length-1?1:jt+1];if(G.appendEdge(W,qt,ni),ib(qt,ni,ze)){be&&($t=Ai.sub(qt)._perp()._unit(),Ft=!Ft);continue}const Xi=qt.sub(ni)._perp(),yn=Xi.x/(Math.abs(Xi.x)+Math.abs(Xi.y)),qi=Xi.y>0?1:0,Ln=ni.dist(qt);if(di+Ln>32768&&(di=0),be){Wt=Ai.sub(qt)._perp()._unit();let Pn=J1(ni,qt,Ai,i0($t,Wt),be);isNaN(Pn)&&(Pn=0);const sr=qt.sub(ni)._unit();ni=ni.add(sr.mult(at))._round(),qt=qt.add(sr.mult(-Pn))._round(),at=Pn,$t=Wt,$&&this.zoom>=17&&(ve(_t,ni)||_t.push(ni),ve(_t,qt)||_t.push(qt))}const hn=tt.vertexLength,Fr=Ye.length>4&&eT(ni,qt,Ai);let gn=tT(di,mt,Ft);if(Ar(this.layoutVertexArray,ni.x,ni.y,yn,qi,0,0,gn),Ar(this.layoutVertexArray,ni.x,ni.y,yn,qi,0,1,gn),this.wallMode){const Pn=se(jt-1,Ye),sr=te.joinNormals[jt-1];xt(this.wallVertexArray,sr,Pn),xt(this.wallVertexArray,sr,Pn)}if(di+=Ln,gn=tT(di,Fr,!Ft),mt=Fr,Ar(this.layoutVertexArray,qt.x,qt.y,yn,qi,0,0,gn),Ar(this.layoutVertexArray,qt.x,qt.y,yn,qi,0,1,gn),this.wallMode){const Pn=se(jt,Ye),sr=te.joinNormals[jt];xt(this.wallVertexArray,sr,Pn),xt(this.wallVertexArray,sr,Pn)}if(tt.vertexLength+=4,this.indexArray.emplaceBack(hn+0,hn+1,hn+2),this.indexArray.emplaceBack(hn+1,hn+3,hn+2),tt.primitiveLength+=2,be){const Pn=it+(jt===1?Ye.length-2:jt-2),sr=jt===1?it:Pn+1;if(this.indexArray.emplaceBack(hn+1,Pn,hn+3),this.indexArray.emplaceBack(Pn,sr,hn+3),tt.primitiveLength+=2,ft===void 0&&(ft=hn),!ib(Ai,Ye[jt],ze)){const pr=jt===Ye.length-1?ft:tt.vertexLength;this.indexArray.emplaceBack(hn+2,hn+3,pr),this.indexArray.emplaceBack(hn+3,pr+1,pr),this.indexArray.emplaceBack(hn+3,sr,pr+1),tt.primitiveLength+=3}Ft=!Ft}if(L){const Pn=this.layoutVertexExtArray,sr=O.projectTilePoint(ni.x,ni.y,f),pr=O.projectTilePoint(qt.x,qt.y,f),mr=O.upVector(f,ni.x,ni.y),Nr=O.upVector(f,qt.x,qt.y);Rt(Pn,sr,mr),Rt(Pn,sr,mr),Rt(Pn,pr,Nr),Rt(Pn,pr,Nr)}}F&&(it+=Ye.length-1),$&&be&&this.zoom>=17&&(_t.length!==0&&ve(_t,_t[0])&&_t.pop(),this.groundEffect.addData(_t,ze,I,be>0))}this.footprintSegments.push(ut),dt.triangleCount=this.indexArray.length-dt.triangleArrayOffset,this.polygonSegments.push(dt),++W.footprintSegLen,++W.polygonSegLen}if(W.vertexCount=this.layoutVertexArray.length-W.vertexArrayOffset,W.groundVertexCount=this.groundEffect.vertexArray.length-W.groundVertexArrayOffset,W.vertexCount!==0){if(W.centroidXY=G.borders?Vi:this.encodeCentroid(G,W),this.centroidData.push(W),G.borders){this.featuresOnBorder.push(G);const Ce=this.featuresOnBorder.length-1;for(let ze=0;ze<G.borders.length;ze++)G.borders[ze][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ze].push(Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,a,m,y,f,S,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,a,m,y,f,S,this.worldview),this.maxHeight=Math.max(this.maxHeight,K)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const w=this.centroidData[y],S=+(w.min.y+w.max.y>zt),I=2*S+(+(w.min.x+w.max.x>zt)^S);for(let M=0;M<w.polygonSegLen;M++){const O=w.polygonSegIdx+M;e.push({centroidIdx:y,subtile:I,polygonSegmentIdx:O,triangleSegmentIdx:this.polygonSegments[O].triangleSegIdx})}}const i=new Kr;e.sort((y,w)=>y.triangleSegmentIdx===w.triangleSegmentIdx?y.subtile-w.subtile:y.triangleSegmentIdx-w.triangleSegmentIdx);let s=0,a=0,f=0;for(const y of e){if(y.triangleSegmentIdx!==s)break;f++}const m=e.length;for(;a!==e.length;){s=e[a].triangleSegmentIdx;let y=0,w=a,S=a;for(let I=w;I<f&&e[I].subtile===y;I++)S++;for(;w!==f;){const I=e[w];y=I.subtile;const M=this.centroidData[I.centroidIdx].min.clone(),O=this.centroidData[I.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let F=w;F<S;F++){const G=e[F],W=this.polygonSegments[G.polygonSegmentIdx],$=this.centroidData[G.centroidIdx].min,K=this.centroidData[G.centroidIdx].max,te=this.indexArray.uint16;for(let se=W.triangleArrayOffset;se<W.triangleArrayOffset+W.triangleCount;se++)i.emplaceBack(te[3*se],te[3*se+1],te[3*se+2]);L.primitiveLength+=W.triangleCount,M.x=Math.min(M.x,$.x),M.y=Math.min(M.y,$.y),O.x=Math.max(O.x,K.x),O.y=Math.max(O.y,K.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:M,max:O}),w=S;for(let F=w;F<f&&e[F].subtile===e[w].subtile;F++)S++}a=f;for(let I=a;I<m&&e[I].triangleSegmentIdx===e[a].triangleSegmentIdx;I++)f++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){const a=new Wn;if(this.wallMode){for(const G of this.triangleSubSegments)a.segments.push(G.segment);return a}let f=0,m=0;const y=1<<e.canonical.z;if(i){const G=i.getMinMaxForTile(e);G&&(f=G.min,m=G.max)}m+=this.maxHeight;const w=e.toUnwrapped();let S;const I=[w.canonical.x/y+w.wrap,w.canonical.y/y],M=[(w.canonical.x+1)/y+w.wrap,(w.canonical.y+1)/y],O=(G,W,$)=>[G[0]*(1-$[0])+W[0]*$[0],G[1]*(1-$[1])+W[1]*$[1]],L=[],F=[];for(const G of this.triangleSubSegments){L[0]=G.min.x/zt,L[1]=G.min.y/zt,F[0]=G.max.x/zt,F[1]=G.max.y/zt;const W=O(I,M,L),$=O(I,M,F);if(new mn([W[0],W[1],f],[$[0],$[1],m]).intersectsPrecise(s)===0){S&&(a.segments.push(S),S=void 0);continue}const K=G.segment;S&&S.vertexOffset!==K.vertexOffset&&(a.segments.push(S),S=void 0),S?(S.vertexLength+=K.vertexLength,S.primitiveLength+=K.primitiveLength):S={vertexOffset:K.vertexOffset,primitiveLength:K.primitiveLength,vertexLength:K.vertexLength,primitiveOffset:K.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&a.segments.push(S),a}encodeCentroid(e,i){const s=e.centroid(),a=i.span(),f=Math.min(7,Math.round(a.x*this.tileToMeter/10)),m=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new pt(_e(s.x,1,8191)<<3|f,_e(s.y,1,8191)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new pt(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const a=i[0][0]!==s?0:1;return new pt(6|(i[0][0]!==s?0:65528),(i[a][0]+i[a][1])/2<<3|6)}{const a=i[2][0]!==s?2:3;return new pt((i[a][0]+i[a][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,a=e.flags&nn?Vi:e.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==a.y||f!==a.x){for(let m=i;m<s;++m)this.centroidVertexArray.emplace(m,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());if(l(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const f=[];for(const m of this.activeReplacements){if(m.order<s)continue;const y=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));if(m.footprint.buildingIds)for(const w of this.centroidData)w.flags&nn||m.min.x>w.max.x||w.min.x>m.max.x||m.min.y>w.max.y||w.min.y>m.max.y||m.footprint.buildingIds.has(w.buildingId)&&(w.flags|=nn);else for(const w of this.centroidData)if(!(w.flags&nn||m.min.x>w.max.x||w.min.x>m.max.x||m.min.y>w.max.y||w.min.y>m.max.y))for(let S=0;S<w.footprintSegLen;S++){const I=this.footprintSegments[w.footprintSegIdx+S];if(f.length=0,eM(this.footprintVertices,I.vertexOffset,I.vertexCount,m.footprintTileId.canonical,e.canonical,f),A(m.footprint,f,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-y)){w.flags|=nn;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let a=!1;for(let f=0;f<s.footprintSegLen;f++){const m=this.footprintSegments[s.footprintSegIdx+f];let y=0;for(const w of m.ringIndices){for(let S=y,I=w+y-1;S<w+y;I=S++){const M=this.footprintVertices.int16[2*(S+m.vertexOffset)+0],O=this.footprintVertices.int16[2*(S+m.vertexOffset)+1],L=this.footprintVertices.int16[2*(I+m.vertexOffset)+1];O>i!=L>i&&e<(this.footprintVertices.int16[2*(I+m.vertexOffset)+0]-M)*(i-O)/(L-O)+M&&(a=!a)}y=w}}return a}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,a=!0;const f=4*(e+zt)*zt+(i+zt);if(this.partLookup.hasOwnProperty(f)){const m=this.partLookup[f];return m?{height:m.height,hidden:!!(m.flags&nn)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||i>m.max.y||m.min.y>i||m.height<=s||this.footprintContainsPoint(e,i,m)&&(s=m.height,this.partLookup[f]=m,a=!!(m.flags&nn));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:a};this.partLookup[f]=void 0}}function i0(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function JR(n,e,i,s){const a=e.sub(n)._perp()._unit(),f=i.sub(e)._perp()._unit();return J1(n,e,i,i0(a,f),s)}function J1(n,e,i,s,a){const f=Math.sqrt(1-s*s);return Math.min(n.dist(e)/3,e.dist(i)/3,a*f/s)}function ib(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function Q1(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function QR(n){return n.every(e=>e.x<=0)||n.every(e=>e.x>=zt)||n.every(e=>e.y<=0)||n.every(e=>e.y>=zt)}function eT(n,e,i){if(n.x<0||n.x>=zt||e.x<0||e.x>=zt||i.x<0||i.x>=zt)return!1;const s=i.sub(e),a=s.perp(),f=n.sub(e);return(s.x*f.x+s.y*f.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(f.x*f.x+f.y*f.y))>-.866&&a.x*f.x+a.y*f.y<0}function tT(n,e,i){const s=e?2|n:-3&n;return i?1|s:-2&s}function iT(){const n=Math.PI/32,e=Math.tan(n),i=Se;return i*Math.sqrt(1+2*e*e)-i}function nT(n,e,i){const s=1<<i.z,a=Qe(i.x/s),f=Qe((i.x+1)/s),m=ct(i.y/s),y=ct((i.y+1)/s);return(function(w,S,I,M,O=0,L){const F=[];if(!w.length||!I||!M)return F;const G=(de,be)=>{for(const Te of de)F.push({polygon:Te,bounds:be})},W=Math.ceil(Math.log2(I)),$=Math.ceil(Math.log2(M)),K=W-$,te=[];for(let de=0;de<Math.abs(K);de++)te.push(K>0?0:1);for(let de=0;de<Math.min(W,$);de++)te.push(0),te.push(1);let se=w;if(se=hf(se,S[0].y-O,S[1].y+O,1),se=hf(se,S[0].x-O,S[1].x+O,0),!se.length)return F;const pe=[];for(te.length?pe.push({polygons:se,bounds:S,depth:0}):G(se,S);pe.length;){const de=pe.pop(),be=de.depth,Te=te[be],ve=de.bounds[0],Ce=de.bounds[1],ze=Te===0?ve.x:ve.y,it=Te===0?Ce.x:Ce.y,Je=L?L(Te,ze,it):.5*(ze+it),tt=hf(de.polygons,ze-O,Je+O,Te),dt=hf(de.polygons,Je-O,it+O,Te);if(tt.length){const ut=[ve,new pt(Te===0?Je:Ce.x,Te===1?Je:Ce.y)];te.length>be+1?pe.push({polygons:tt,bounds:ut,depth:be+1}):G(tt,ut)}if(dt.length){const ut=[new pt(Te===0?Je:ve.x,Te===1?Je:ve.y),Ce];te.length>be+1?pe.push({polygons:dt,bounds:ut,depth:be+1}):G(dt,ut)}}return F})(n,e,Math.ceil((f-a)/11.25),Math.ceil((m-y)/11.25),1,(w,S,I)=>{if(w===0)return .5*(S+I);{const M=ct((i.y+S/zt)/s);return(He(.5*(ct((i.y+I/zt)/s)+M))*s-i.y)*zt}})}function eM(n,e,i,s,a,f){const m=Math.pow(2,s.z-a.z);for(let y=0;y<i;y++){let w=n.int16[2*(y+e)+0],S=n.int16[2*(y+e)+1];w=(w+a.x*zt)*m-s.x*zt,S=(S+a.y*zt)*m-s.y*zt,f.push(new pt(w,S))}}let rT,sT;Mt(_c,"FillExtrusionBucket",{omit:["layers","features"]}),Mt(ln,"PartData"),Mt(Jt,"FootprintSegment"),Mt(fr,"BorderCentroidData"),Mt(ur,"GroundEffect");class Zm extends pt{constructor(e,i,s){super(e,i),this.z=s}}class oT extends Zm{constructor(e,i,s,a){super(e,i,s),this.w=a}}function aT(n,e,i,s){const a=i==="x"?"y":"x",f=(s-n[i])/(e[i]-n[i]);n[a]=Math.round(n[a]+(e[a]-n[a])*f),n[i]=s,n.hasOwnProperty("z")&&(n.z=vi(n.z,e.z,f)),n.hasOwnProperty("w")&&(n.w=vi(n.w,e.w,f))}function lT(n,e,i,s){const a=i,f=s;for(const m of["x","y"]){let y=n,w=e;y[m]>=w[m]&&(y=e,w=n),y[m]<a&&w[m]>a&&aT(y,w,m,a),y[m]<f&&w[m]>f&&aT(w,y,m,f)}}function n0(n,e,i,s,a,f){const m=[];for(let y=0;y<n.length;y++){const w=n[y];let S;const I=m.length;let M=0;for(let O=0;O<w.length-1;O++){let L=w[O],F=w[O+1],G=0;const W=M;let $,K;f&&(G=Math.hypot(F.x-L.x,F.y-L.y),M+=G,$=L,K=F),L.x<e&&F.x<e||(L.x<e?L=new pt(e,L.y+(e-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x<e&&(F=new pt(e,L.y+(e-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y<i&&F.y<i||(L.y<i?L=new pt(L.x+(i-L.y)/(F.y-L.y)*(F.x-L.x),i)._round():F.y<i&&(F=new pt(L.x+(i-L.y)/(F.y-L.y)*(F.x-L.x),i)._round()),L.x>=s&&F.x>=s||(L.x>=s?L=new pt(s,L.y+(s-L.x)/(F.x-L.x)*(F.y-L.y))._round():F.x>=s&&(F=new pt(s,L.y+(s-L.x)/(F.x-L.x)*(F.y-L.y))._round()),L.y>=a&&F.y>=a||(L.y>=a?L=new pt(L.x+(a-L.y)/(F.y-L.y)*(F.x-L.x),a)._round():F.y>=a&&(F=new pt(L.x+(a-L.y)/(F.y-L.y)*(F.x-L.x),a)._round()),S&&L.equals(S[S.length-1])||(S=[L],m.push(S),f&&f.push({progress:{min:W+cT($,K,L)*G,max:1},parentIndex:y,prevPoint:$,nextPoint:K})),S.push(F),f&&(f[f.length-1].progress.max=W+cT($,K,F)*G,f[f.length-1].nextPoint=K)))))}if(f&&M>0)for(let O=I;O<m.length;O++)f[O].progress.min/=M,f[O].progress.max/=M}return m}function tM(n,e,i,s,a){if(n.length<2)return void s.push(n);const f=[];for(;e.valid();){const[S,I]=e.get();for(let M=0;M<n.length-1;M++){const O=n[M],L=n[M+1],F=$h(O,L,S,I);if(F){const[G]=F,W=new pt(vi(O.x,L.x,G),vi(O.y,L.y,G));f.push({t:M+G,distance:0,point:W})}}e.next()}if(f.length===0)return void s.push(n);f.sort((S,I)=>S.t-I.t);let m=0,y=0,w=[];for(s.push(w);m!==n.length;){if(y===f.length){for(;m!==n.length;)w.length!==0&&w[w.length-1].equals(n[m])||w.push(n[m]),m++;break}f[y].t<=m?(w.length!==0&&w[w.length-1].equals(f[y].point)||w.push(f[y].point),Math.trunc(f[y].t),y++):(w.length!==0&&w[w.length-1].equals(n[m])||w.push(n[m]),m++)}}function cT(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function Ty(n,e){return n.x*e.x+n.y*e.y}function uT(n,e){if(n.length===1){let i=0;const s=e[i++];let a;for(;!a||s.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){const f=e[i],m=n[0],y=a.sub(s),w=f.sub(s),S=m.sub(s),I=Ty(y,y),M=Ty(y,w),O=Ty(w,w),L=Ty(S,y),F=Ty(S,w),G=I*O-M*M,W=(O*L-M*F)/G,$=(I*F-M*L)/G,K=s.z*(1-W-$)+a.z*W+f.z*$;if(isFinite(K))return K}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function hT(n,e,i){let s=1/0;Vn(i,e)&&(s=uT(i,e[0]));for(let a=0;a<e.length;a++){const f=e[a],m=n[a];for(let y=0;y<f.length-1;y++){const w=f[y],S=[w,f[y+1],m[y+1],m[y],w];rr(i,S)&&(s=Math.min(s,uT(i,S)))}}return s!==1/0&&s}function dT(n,e,i,s,a,f,m,y,w,S,I){return n.projection.name==="globe"?(function(M,O,L,F,G,W,$,K,te,se,pe){const de=[],be=[],Te=M.projection.upVectorScale(pe,M.center.lat,M.worldSize).metersToTile,ve=[0,0,0,1],Ce=[0,0,0,1],ze=(Je,tt,dt,ut)=>{Je[0]=tt,Je[1]=dt,Je[2]=ut,Je[3]=1},it=iT();L>0&&(L+=it),F+=it;for(const Je of O){const tt=[],dt=[];for(const ut of Je){const ht=ut.x+G.x,Ye=ut.y+G.y,mt=M.projection.projectTilePoint(ht,Ye,pe),at=M.projection.upVector(pe,ut.x,ut.y);let _t=L,ft=F;if($){const $t=fT(ht,Ye,L,F,$,K,te,se);_t+=$t.base,ft+=$t.top}L!==0?ze(ve,mt.x+at[0]*Te*_t,mt.y+at[1]*Te*_t,mt.z+at[2]*Te*_t):ze(ve,mt.x,mt.y,mt.z),ze(Ce,mt.x+at[0]*Te*ft,mt.y+at[1]*Te*ft,mt.z+at[2]*Te*ft),vn(ve,ve,W),vn(Ce,Ce,W),tt.push(new Zm(ve[0],ve[1],ve[2])),dt.push(new Zm(Ce[0],Ce[1],Ce[2]))}de.push(tt),be.push(dt)}return[de,be]})(n,e,i,s,a,f,m,y,w,S,I):m?(function(M,O,L,F,G,W,$,K,te){const se=[],pe=[],de=[0,0,0,1];for(const be of M){const Te=[],ve=[];for(const Ce of be){const ze=Ce.x+F.x,it=Ce.y+F.y,Je=fT(ze,it,O,L,W,$,K,te);de[0]=ze,de[1]=it,de[2]=Je.base,de[3]=1,Ss(de,de,G),de[3]=Math.max(de[3],1e-5);const tt=new Zm(de[0]/de[3],de[1]/de[3],de[2]/de[3]);de[0]=ze,de[1]=it,de[2]=Je.top,de[3]=1,Ss(de,de,G),de[3]=Math.max(de[3],1e-5);const dt=new Zm(de[0]/de[3],de[1]/de[3],de[2]/de[3]);Te.push(tt),ve.push(dt)}se.push(Te),pe.push(ve)}return[se,pe]})(e,i,s,a,f,m,y,w,S):(function(M,O,L,F,G){const W=[],$=[],K=G[8]*O,te=G[9]*O,se=G[10]*O,pe=G[11]*O,de=G[8]*L,be=G[9]*L,Te=G[10]*L,ve=G[11]*L;for(const Ce of M){const ze=[],it=[];for(const Je of Ce){const tt=Je.x+F.x,dt=Je.y+F.y,ut=G[0]*tt+G[4]*dt+G[12],ht=G[1]*tt+G[5]*dt+G[13],Ye=G[2]*tt+G[6]*dt+G[14],mt=G[3]*tt+G[7]*dt+G[15],at=ut+K,_t=ht+te,ft=Ye+se,$t=Math.max(mt+pe,1e-5),Wt=ut+de,Ft=ht+be,jt=Ye+Te,di=Math.max(mt+ve,1e-5);ze.push(new Zm(at/$t,_t/$t,ft/$t)),it.push(new Zm(Wt/di,Ft/di,jt/di))}W.push(ze),$.push(it)}return[W,$]})(e,i,s,a,f)}function fT(n,e,i,s,a,f,m,y){const w=m*a.getElevationAt(n,e,!0,!0),S=f[0]!==0,I=S?f[1]===0?m*(f[0]/7-450):m*(function(M,O,L){const F=Math.floor(O[0]/8),G=Math.floor(O[1]/8),W=10*(O[0]-8*F),$=10*(O[1]-8*G),K=M.getElevationAt(F,G,!0,!0),te=M.getMeterToDEM(L),se=Math.floor(.5*(W*te-1)),pe=Math.floor(.5*($*te-1)),de=M.tileCoordToPixel(F,G),be=2*se+1,Te=2*pe+1,ve=(function(dt,ut,ht,Ye,mt){return[dt.getElevationAtPixel(ut,ht,!0),dt.getElevationAtPixel(ut+mt,ht,!0),dt.getElevationAtPixel(ut,ht+mt,!0),dt.getElevationAtPixel(ut+Ye,ht+mt,!0)]})(M,de.x-se,de.y-pe,be,Te),Ce=Math.abs(ve[0]-ve[1]),ze=Math.abs(ve[2]-ve[3]),it=Math.abs(ve[0]-ve[2])+Math.abs(ve[1]-ve[3]),Je=Math.min(.25,.5*te*(Ce+ze)/be),tt=Math.min(.25,.5*te*it/Te);return K+Math.max(Je*W,tt*$)})(a,f,y):w;return{base:w+(i===0?-1:i),top:S?Math.max(I+s,w+i+2):w+s}}class iM{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class nM{constructor(){this.tasks={},this.taskQueue=[],Zt(["process"],this),this.invoker=new iM(this.process),this.nextId=0}add(e,i){const s=this.nextId++,a=(function({type:f,isSymbolTile:m,zoom:y}){return y=y||0,f==="message"?0:f!=="maybePrepare"||m?f!=="parseTile"||m?f==="parseTile"&&m?300-y:f==="maybePrepare"&&m?400-y:500:200-y:100-y})(i);if(a===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:a,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){const f=this.tasks[this.taskQueue[a]];f.priority<i&&(i=f.priority,e=a)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class pT{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Zt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new nM}send(e,i,s,a,f=!1,m){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=m,this.callbacks[y]=s);const w=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!s,targetMapId:a,mustQueue:f,sourceMapId:this.mapId,data:Sr(i,w)},w),{cancel:()=>{s&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const a=this.cancelCallbacks[s];delete this.cancelCallbacks[s],a&&a.cancel()}else if(i.mustQueue||Cr(self)){const a=this.callbacks[s],f=this.scheduler.add(()=>this.processTask(s,i),a&&a.metadata||{type:"message"});f&&(this.cancelCallbacks[s]=f)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(Fa(i.error)):s(null,Fa(i.data)))}else{const s=new Set,a=i.hasCallback?(m,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?Sr(m):null,data:Sr(y,s)},s)}:()=>{},f=Fa(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,a);else if(this.parent.getWorkerSource){const m=i.type.split("."),{source:y,scope:w}=f;this.parent.getWorkerSource(i.sourceMapId,m[0],y,w)[m[1]](f,a)}else a(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Sy={workerUrl:"",workerClass:null,workerParams:void 0};function rM(n){return Sy.workerClass!=null?new Sy.workerClass:new self.Worker(Sy.workerUrl,Object.assign({name:n},Sy.workerParams))}const nb="mapboxgl_preloaded_worker_pool";class Wm{constructor(e){this.active={},this.name=e}acquire(e,i=Wm.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;){const s=rM(`${this.name||""}WorkerPool: ${e}-${this.workers.length}`);this.workers.push(s)}return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[nb]}numActive(){return Object.keys(this.active).length}}Wm.workerCount=2;class e_{constructor(e,i,s="Worker",a=Wm.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=At();const f=this.workerPool.acquire(this.id,a);for(let m=0;m<f.length;m++){const y=new e_.Actor(f[m],i,this.id);y.name=`${s} ${m}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,s){je(this.actors,(a,f)=>{a.send(e,i,f)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Ey,rb;function r0(){return Ey||(Ey=new Wm),Ey}e_.Actor=pT;const sb=4096;class sM{constructor(e){this.module=e,this.memoryStack=this.module.malloc(sb),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>sb?-1:(new Int32Array(this.module.heap32.buffer,i,e.length).set(e),i)}createFloatArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>sb?-1:(new Float32Array(this.module.heapF32.buffer,i,e.length).set(e),i)}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.normalScale;this.module.setStyle(i[0],i[1],i[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,s){this.module.setFauxFacadeOptions(e?1:0,i?1:0,s)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){this.memoryStackNextFree=this.memoryStack;for(const y of e){const w=this.createIntArray(y.ringIndices),S=this.createFloatArray(y.coordinates);if(w===-1||S===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(y.id,y.sourceId,y.minHeight,y.height,y.roofType,S,w,y.ringIndices.length-1)}for(const y of i){let w;w=y.entrances?JSON.parse(y.entrances):[];const S=this.createFloatArray(w),I=this.createFloatArray(y.coordinates);if(S===-1||I===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(y.sourceId,y.crossPerc,y.distanceToRoad,S,w.length,I,y.coordinates.length)}if(!this.module.generateMesh()){const y=this.module.getLastError();return this.readStringBuffer(y)}const s=this.module.getMeshCount(),a=new Array(s);for(let y=0;y<s;y++){const w=this.module.getPositionsPtr(y),S=this.module.getPositionsLength(y),I=new Float32Array(this.module.heapF32.buffer,w,S),M=this.module.getNormalsPtr(y),O=this.module.getNormalsLength(y),L=new Float32Array(this.module.heapF32.buffer,M,O),F=this.module.getAOPtr(y),G=this.module.getAOLength(y),W=new Float32Array(this.module.heapF32.buffer,F,G),$=this.module.getUVPtr(y),K=this.module.getUVLength(y),te=new Float32Array(this.module.heapF32.buffer,$,K),se=this.module.getFauxFacadePtr(y),pe=this.module.getFauxFacadeLength(y),de=new Uint8Array(this.module.heapU8.buffer,se,pe),be=this.module.getIndicesPtr(y),Te=this.module.getIndicesLength(y),ve=new Int16Array(this.module.heap16.buffer,be,Te),Ce=this.module.getBuildingPart(y);a[y]={positions:I,normals:L,ao:W,uv:te,isFauxFacade:de,indices:ve,buildingPart:Ce}}const f=this.module.getRingCount(),m=[];for(let y=0;y<f;y++){const w=this.module.getRingPtr(y),S=this.module.getRingLength(y),I=new Float32Array(this.module.heapF32.buffer,w,S);m.push(I)}return{meshes:a,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:m}}}let Ay,ob,$u,t_,ab,i_=null,n_=null,mT=null,s0=null;function gT(){return Cr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:ob||Qr.DRACO_URL}function _T(){if(Cr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(t_)return t_;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return t_=WebAssembly.validate(n)?Qr.MESHOPT_SIMD_URL:Qr.MESHOPT_URL,t_}function oM(){return s0}const yT=5120,vT=5121,xT=5122,bT=5123,wT=5125,TT=5126,o0={[yT]:Int8Array,[vT]:Uint8Array,[xT]:Int16Array,[bT]:Uint16Array,[wT]:Uint32Array,[TT]:Float32Array},aM={[yT]:"DT_INT8",[vT]:"DT_UINT8",[xT]:"DT_INT16",[bT]:"DT_UINT16",[wT]:"DT_UINT32",[TT]:"DT_FLOAT32"},Cy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function ST(n,e,i){const s=i.json.bufferViews.length,a=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:a,byteLength:n.byteLength},i.buffers[a]=n}const lb="KHR_draco_mesh_compression";function lM(n,e){const i=n.extensions&&n.extensions[lb];if(!i)return;const s=new $u.Decoder,a=IT(e,i.bufferView),f=new $u.Mesh;if(!s.DecodeArrayToMesh(a,a.byteLength,f))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[n.indices],y=o0[m.componentType],w=m.count*y.BYTES_PER_ELEMENT,S=$u._malloc(w);y===Uint16Array?s.GetTrianglesUInt16Array(f,w,S):s.GetTrianglesUInt32Array(f,w,S),ST($u.memory.buffer.slice(S,S+w),m,e),$u._free(S);for(const I of Object.keys(i.attributes)){const M=s.GetAttributeByUniqueId(f,i.attributes[I]),O=e.json.accessors[n.attributes[I]],L=aM[O.componentType],F=O.count*Cy[O.type]*o0[O.componentType].BYTES_PER_ELEMENT,G=$u._malloc(F);s.GetAttributeDataArrayForAllPoints(f,M,$u[L],F,G),ST($u.memory.buffer.slice(G,G+F),O,e),$u._free(G)}s.destroy(),f.destroy(),delete n.extensions[lb]}const a0="EXT_meshopt_compression";function cM(n,e){if(!n.extensions||!n.extensions[a0])return;const i=n.extensions[a0],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),a=new Uint8Array(i.count*i.byteStride);ab.decodeGltfBuffer(a,i.count,i.byteStride,s,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=a.buffer,delete n.extensions[a0]}const ET=1179937895,AT=new TextDecoder("utf8");function CT(n,e){return new URL(n,e).href}function uM(n,e,i,s){return fetch(CT(n.uri,s)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[i]=a})}function IT(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function hM(n,e,i,s){if(n.uri){const a=CT(n.uri,s);return fetch(a).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{e.images[i]=f})}if(n.bufferView!==void 0){const a=IT(e,n.bufferView),f=new Blob([a],{type:n.mimeType});return createImageBitmap(f).then(m=>{e.images[i]=m})}}function RT(n,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===ET){const I=new Uint32Array(n,e);let M=2;const O=(I[M++]>>2)-3,L=I[M++]>>2;if(M++,s.json=JSON.parse(AT.decode(I.subarray(M,M+L))),M+=L,M<O){const F=I[M++];M++;const G=e+(M<<2);s.buffers[0]=n.slice(G,G+F)}}else s.json=JSON.parse(AT.decode(new Uint8Array(n,e)));const{buffers:a,images:f,meshes:m,extensionsUsed:y,bufferViews:w}=s.json;let S=Promise.resolve();if(a){const I=[];for(let M=0;M<a.length;M++){const O=a[M];O.uri?I.push(uM(O,s,M,i)):s.buffers[M]||(s.buffers[M]=null)}S=Promise.all(I)}return S.then(()=>{const I=[],M=y&&y.includes(lb),O=y&&y.includes(a0);if(M&&I.push((function(){if(!$u)return Ay??(Ay=(function(L){let F,G=null;function W(){F=new Uint8Array(G.buffer)}function $(){throw new Error("Unexpected Draco error.")}const K={a:{a:$,d:function(te,se,pe){return F.copyWithin(te,se,se+pe)},c:function(te){const se=F.length,pe=Math.max(te>>>0,Math.ceil(1.2*se)),de=Math.ceil((pe-se)/65536);try{return G.grow(de),W(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,K):L.then(te=>te.arrayBuffer()).then(te=>WebAssembly.instantiate(te,K))).then(te=>{const{Rb:se,Qb:pe,P:de,T:be,X:Te,Ja:ve,La:Ce,Qa:ze,Va:it,Wa:Je,eb:tt,jb:dt,f:ut,e:ht,yb:Ye,zb:mt,Ab:at,Bb:_t,Db:ft,Gb:$t}=te.instance.exports;G=ht;const Wt=(()=>{let Ft=0,jt=0,di=0,ni=0;return qt=>{di&&(se(ni),se(Ft),jt+=di,di=Ft=0),Ft||(jt+=128,Ft=pe(jt));const Ai=qt.length+7&-8;let Xi=Ft;Ai>=jt&&(di=Ai,Xi=ni=pe(Ai));for(let yn=0;yn<qt.length;yn++)F[Xi+yn]=qt[yn];return Xi}})();return W(),ut(),{memory:ht,_free:se,_malloc:pe,Mesh:class{constructor(){this.ptr=de()}destroy(){be(this.ptr)}},Decoder:class{constructor(){this.ptr=ve()}destroy(){dt(this.ptr)}DecodeArrayToMesh(Ft,jt,di){const ni=Wt(Ft),qt=Ce(this.ptr,ni,jt,di.ptr);return!!Te(qt)}GetAttributeByUniqueId(Ft,jt){return{ptr:ze(this.ptr,Ft.ptr,jt)}}GetTrianglesUInt16Array(Ft,jt,di){it(this.ptr,Ft.ptr,jt,di)}GetTrianglesUInt32Array(Ft,jt,di){Je(this.ptr,Ft.ptr,jt,di)}GetAttributeDataArrayForAllPoints(Ft,jt,di,ni,qt){tt(this.ptr,Ft.ptr,jt.ptr,di,ni,qt)}},DT_INT8:Ye(),DT_UINT8:mt(),DT_INT16:at(),DT_UINT16:_t(),DT_UINT32:ft(),DT_FLOAT32:$t()}})})(fetch(gT())),Ay.then(L=>{$u=L,Ay=void 0}))})()),O&&I.push((function(){if(ab)return;const L=(function(F){let G;const W=WebAssembly.instantiateStreaming(F,{}).then(te=>{G=te.instance,G.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},K={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:W,supported:!0,decodeGltfBuffer(te,se,pe,de,be,Te){(function(ve,Ce,ze,it,Je,tt,dt){const ut=ve.exports.sbrk,ht=it+3&-4,Ye=ut(ht*Je),mt=ut(tt.length),at=new Uint8Array(ve.exports.memory.buffer);at.set(tt,mt);const _t=Ce(Ye,it,Je,mt,tt.length);if(_t===0&&dt&&dt(Ye,ht,Je),ze.set(at.subarray(Ye,Ye+it*Je)),ut(Ye-ut(0)),_t!==0)throw new Error(`Malformed buffer data: ${_t}`)})(G,G.exports[K[be]],te,se,pe,de,G.exports[$[Te]])}}})(fetch(_T()));return L.ready.then(()=>{ab=L})})()),f)for(let L=0;L<f.length;L++)I.push(hM(f[L],s,L,i));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(M&&m)for(const{primitives:L}of m)for(const F of L)lM(F,s);if(O&&m&&w)for(const L of w)cM(L,s);return s})})}function MT(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>RT(e,0,n))}function cb(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function ub(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class hb{constructor(e,i,s,a){this.context=e,this.format=s,this.useMipmap=a&&a.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:a&&a.premultiply})}update(e,i){const s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,a=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:f}=this,{gl:m}=f,{x:y,y:w}=i&&i.position?i.position:{x:0,y:0},S=y+s,I=w+a;!this.size||this.size[0]===S&&this.size[1]===I||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!i||i.premultiply!==!1));const M=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&S>0&&I>0){const O=this.useMipmap?Math.floor(Math.log2(Math.max(S,I)))+1:1;m.texStorage2D(m.TEXTURE_2D,O,this.format,S,I),this.size=[S,I]}this.size&&(M?m.texSubImage2D(m.TEXTURE_2D,0,y,w,cb(this.format),ub(this.format),e):"data"in e&&e.data&&m.texSubImage2D(m.TEXTURE_2D,0,y,w,s,a,cb(this.format),ub(this.format),e.data)),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,i,s=!1){const{context:a}=this,{gl:f}=a;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,a,f){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),i!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?e===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,s),this.wrapS=s),a!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,a),this.wrapT=a),f!==this.compareMode&&(f?(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.COMPARE_REF_TO_TEXTURE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_FUNC,f)):y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.NONE),this.compareMode=f)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Iy{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}}const dM=$i([{name:"a_pos_3f",components:3,type:"Float32"}]),fM=$i([{name:"a_color_3f",components:3,type:"Float32"}]),pM=$i([{name:"a_color_4f",components:4,type:"Float32"}]),mM=$i([{name:"a_uv_2f",components:2,type:"Float32"}]),gM=$i([{name:"a_normal_3f",components:3,type:"Float32"}]),_M=$i([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),yM=$i([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function DT(n,e){const i=l0(n.projection,n.zoom,n.width,n.height),s=(function(f,m,y,w,S){const I=new fe(y.lng-180*bp,y.lat),M=new fe(y.lng+180*bp,y.lat),O=f.project(I.lng,I.lat),L=f.project(M.lng,M.lat),F=-Math.atan2(L.y-O.y,L.x-O.x),G=kt.fromLngLat(y);G.y=_e(G.y,-1+bp,1-bp);const W=G.toLngLat(),$=f.project(W.lng,W.lat),K=kt.fromLngLat(W);K.x+=bp;const te=K.toLngLat(),se=f.project(te.lng,te.lat),pe=PT(se.x-$.x,se.y-$.y,F),de=kt.fromLngLat(W);de.y+=bp;const be=de.toLngLat(),Te=f.project(be.lng,be.lat),ve=PT(Te.x-$.x,Te.y-$.y,F),Ce=Math.abs(pe.x)/Math.abs(ve.y),ze=Re([]);Tt(ze,ze,-F*(1-(S?0:w)));const it=Re([]);return rt(it,it,[1,1-(1-Ce)*w,1]),it[4]=-ve.x/ve.y*w,Tt(it,it,F),Ge(it,ze,it),it})(n.projection,0,n.center,i,e),a=OT(n);return rt(s,s,[a,a,1]),s}function OT(n){const e=n.projection,i=l0(n.projection,n.zoom,n.width,n.height),s=db(e,n.center),a=db(e,fe.convert(e.center));return Math.pow(2,s*i+(1-i)*a)}function l0(n,e,i,s,a=1/0){const f=n.range;if(!f)return 0;const m=Math.min(a,Math.max(i,s)),y=Math.log2(m/1024);return ke(f[0]+y,f[1]+y,e)}const bp=1/4e4;function db(n,e){const i=_e(e.lat,-85.051129,Oe),s=new fe(e.lng-180*bp,i),a=new fe(e.lng+180*bp,i),f=n.project(s.lng,i),m=n.project(a.lng,i),y=kt.fromLngLat(s),w=kt.fromLngLat(a),S=m.x-f.x,I=m.y-f.y,M=w.x-y.x,O=w.y-y.y,L=Math.sqrt((M*M+O*O)/(S*S+I*I));return Math.log2(L)}function PT(n,e,i){const s=Math.cos(i),a=Math.sin(i);return{x:n*s-e*a,y:n*a+e*s}}function zT(n,e,i){Re(n),Tt(n,n,Ni(e[2])),Pt(n,n,Ni(e[0])),Bt(n,n,Ni(e[1])),rt(n,n,i),Ge(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function c0(n,e,i,s,a,f,m,y){const w=[i[0]-e[0],i[1]-e[1],0],S=[s[0]-e[0],s[1]-e[1],0];if(Si(w)<1e-12||Si(S)<1e-12)return Xo(n);const I=Fi([],w,S);fi(I,I),mi(S,s,e),w[2]=(f-a)*y,S[2]=(m-a)*y;const M=w;return Fi(M,w,S),fi(M,M),$r(n,I,M)}function u0(n,e,i=!1){const s=Vu(e.zoom),a=(function(f,m,y){const w=m.worldSize,S=[f[12],f[13],f[14]],I=ct(S[1]/w),M=Qe(S[0]/w),O=Re([]),L=Ve(1,I)*w,F=Ve(1,0)*w*Ze(I,m.zoom),G=1/Dm(w);let W=F*G;if(y){const se=l0(m.projection,m.zoom,m.width,m.height,1024);W=G*m.projection.pixelSpaceConversion(m.center.lat,w,se)}const $=xe(I,M);yt($,$,bt([],fi([],$),L*W*S[2]));const K=(function(se){const pe=[se[0],se[1],se[2]];let de=[0,1,0];const be=Fi([],de,pe);return Fi(de,pe,be),Qt(de)===0&&(de=[0,1,0],Fi(be,pe,de)),fi(be,be),fi(de,de),fi(pe,pe),[be[0],be[1],be[2],0,de[0],de[1],de[2],0,pe[0],pe[1],pe[2],0,se[0],se[1],se[2],1]})($);rt(O,O,[W,W,W*L]),Ue(O,O,[-S[0],-S[1],-S[2]]);const te=Ge([],m.globeMatrix,K);return Ge(te,te,O),Ge(te,te,f),te})(n,e,i);if(s>0){const f=(function(m,y){const w=y.worldSize,S=Ve(1,0)*w*Ze(y.center.lat,y.zoom)/Dm(w),I=Ve(1,y.center.lat)*w,M=Re([]);Bt(M,M,Ni(y.center.lng)),Pt(M,M,Ni(y.center.lat)),Ue(M,M,[0,0,Y]),rt(M,M,[S,S,S*I]);const O=y.point;return Ue(M,M,[-O.x,-O.y,0]),Ge(M,M,m),Ge(M,y.globeMatrix,M)})(n,e);return(function(m,y,w){const S=(F,G,W)=>{const $=Si(F),K=Si(G),te=Kc(F,G,W);return bt(te,te,1/Si(te)*vi($,K,W))},I=S([m[0],m[1],m[2]],[y[0],y[1],y[2]],w),M=S([m[4],m[5],m[6]],[y[4],y[5],y[6]],w),O=S([m[8],m[9],m[10]],[y[8],y[9],y[10]],w),L=Kc([m[12],m[13],m[14]],[y[12],y[13],y[14]],w);return[I[0],I[1],I[2],0,M[0],M[1],M[2],0,O[0],O[1],O[2],0,L[0],L[1],L[2],1]})(a,f,s)}return a}function fb(n,e,i,s){const a=mn.projectAabbCorners(s,i);let f=Number.MAX_VALUE;for(let y=0;y<a.length;++y){const w=a[y];w[0]=(.5*w[0]+.5)*e.width,w[1]=(.5-.5*w[1])*e.height,w[2]<f&&(f=w[2])}const m=(function(y){const w=[];let S=0;for(let L=1;L<y.length;L++)(y[L][0]<y[S][0]||y[L][0]===y[S][0]&&y[L][1]<y[S][1])&&(S=L);let I,M=S;const O=new Uint8Array(y.length);do{if(O[M])break;w.push(new pt(y[M][0],y[M][1])),O[M]=1,I=(M+1)%y.length;for(let L=0;L<y.length;L++){if(y[L][0]===y[I][0]&&y[L][1]===y[I][1]||y[L][0]===y[M][0]&&y[L][1]===y[M][1])continue;const F=[y[L][0]-y[M][0],y[L][1]-y[M][1]],G=[y[I][0]-y[M][0],y[I][1]-y[M][1]],W=F[0]*G[1]-F[1]*G[0];(W>0||W===0&&F[0]*G[0]+F[1]*G[1]>=0&&F[0]*F[0]+F[1]*F[1]>G[0]*G[0]+G[1]*G[1])&&(I=L)}M=I}while(M!==S);return w.length>0&&w.push(w[0]),w})(a);if(rr(n,m))return f}const Xm=64,r_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function h0(n,e,i,s,a,f,m,y,w,S=!1){const I=i.zoom,M=i.project(s),O=Ze(s.lat,I),L=1/O;Re(n),Ue(n,n,[M.x+m[0]*L,M.y+m[1]*L,m[2]]);let F=1,G=1;const W=i.worldSize;if(S){if(i.projection.name==="mercator"){let se=0;i.elevation&&(se=i.elevation.getAtPointOrZero(new kt(M.x/W,M.y/W),0));const pe=Ss([],[M.x,M.y,se,1],i.projMatrix)[3]/i.cameraToCenterDistance;F=pe,G=pe*Ze(i.center.lat,I)}else if(i.projection.name==="globe"){const se=u0(n,i),pe=[0,0,0,1];Ss(pe,pe,Ge([],i.projMatrix,se));const de=pe[3]/i.cameraToCenterDistance,be=Vu(I),Te=i.projection.pixelsPerMeter(s.lat,W)*Ze(s.lat,I),ve=i.projection.pixelsPerMeter(i.center.lat,W)*Ze(i.center.lat,I);F=de/vi(Te,nt(i.center.lat),be),G=de*O/Te,F*=ve,G*=ve}}else F=L;rt(n,n,[F,F,G]);const $=[...n],K=e.orientation,te=[];if(zT(te,[K[0]+(a?a[0]:0),K[1]+(a?a[1]:0),K[2]+(a?a[2]:0)],f),Ge(n,$,te),y&&i.elevation){let se=0;const pe=[];if(w&&i.elevation){se=(function(be,Te,ve,Ce,ze){const it=Te.elevation;if(!it)return 0;const Je=mn.projectAabbCorners(ve,Ce),tt=Ve(1,ze.lat)*Te.worldSize,dt=(function(jt,di){const ni=[0,0,1],qt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ai of qt){const Xi=jt[Ai.corners[0]],yn=jt[Ai.corners[1]],qi=jt[Ai.corners[2]],Ln=[yn[0]-Xi[0],yn[1]-Xi[1],di*(yn[2]-Xi[2])],hn=Fi(Ln,Ln,[qi[0]-Xi[0],qi[1]-Xi[1],di*(qi[2]-Xi[2])]);fi(hn,hn),Ai.dotProductWithUp=Ri(hn,ni)}return qt.sort((Ai,Xi)=>Ai.dotProductWithUp-Xi.dotProductWithUp),qt[0].corners})(Je,tt),ut=Je[dt[0]],ht=Je[dt[1]],Ye=Je[dt[2]],mt=Je[dt[3]],at=it.getAtPointOrZero(new kt(ut[0]/Te.worldSize,ut[1]/Te.worldSize),0),_t=it.getAtPointOrZero(new kt(ht[0]/Te.worldSize,ht[1]/Te.worldSize),0),ft=it.getAtPointOrZero(new kt(Ye[0]/Te.worldSize,Ye[1]/Te.worldSize),0),$t=it.getAtPointOrZero(new kt(mt[0]/Te.worldSize,mt[1]/Te.worldSize),0),Wt=(at+$t)/2,Ft=(_t+ft)/2;return Wt>Ft?_t<ft?c0(be,ht,mt,ut,_t,$t,at,tt):c0(be,Ye,ut,mt,ft,at,$t,tt):at<$t?c0(be,ut,ht,Ye,at,_t,ft,tt):c0(be,mt,Ye,ht,$t,ft,_t,tt),Math.max(Wt,Ft)})(pe,i,e.aabb,n,s);const de=Ge([],en([],pe),te);Ge(n,$,de)}else se=i.elevation.getAtPointOrZero(new kt(M.x/W,M.y/W),0);se!==0&&(n[14]+=se)}}class LT{constructor(e,i,s,a,f){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=s!=null?new fe(s[0],s[1]):new fe(0,0),this.orientation=a??[0,0,0],this.nodes=f,this.uploaded=!1,this.aabb=new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){Ge(e.globalMatrix,i,e.localMatrix);const s=this.nodeOverrides.get(e.name);if(s!==void 0){const m=[];f=s.orientation,Re(a=m),Bt(a,a,Ni(f[1])),Tt(a,a,Ni(f[2])),Pt(a,a,Ni(f[0])),Ge(e.globalMatrix,e.globalMatrix,m)}var a,f;if(e.meshes)for(const m of e.meshes){const y=mn.applyTransformFast(m.aabb,e.globalMatrix);this.aabb.encapsulate(y)}if(e.children)for(const m of e.children)this._applyTransformations(m,e.globalMatrix)}computeBoundsAndApplyParent(){const e=Re([]);this.aabb=new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,s,a,f,m,y=!1){h0(this.matrix,this,e.transform,this.position,i,s,a,f,m,y)}upload(e){if(!this.uploaded){for(const i of this.nodes)pb(i,e);for(const i of this.nodes)d0(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)mb(e)}}function Ry(n,e,i=!1){n.uploaded||(n.gfxTexture=new hb(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function vM(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,dM.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,gM.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,mM.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?fM:pM).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,yM.members,!0)),n.segments=Wn.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const s=n.material;s.pbrMetallicRoughness.baseColorTexture&&Ry(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&Ry(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&Ry(s.normalTexture,e),s.occlusionTexture&&Ry(s.occlusionTexture,e,i),s.emissionTexture&&Ry(s.emissionTexture,e)}function pb(n,e,i){if(n.meshes)for(const s of n.meshes)vM(s,e,i);if(n.children)for(const s of n.children)pb(s,e,i)}function d0(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)d0(e)}function xM(n){n.pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()}function mb(n){if(n.meshes)for(const e of n.meshes)e.vertexBuffer&&(e.vertexBuffer.destroy(),e.indexBuffer.destroy(),e.normalBuffer&&e.normalBuffer.destroy(),e.texcoordBuffer&&e.texcoordBuffer.destroy(),e.colorBuffer&&e.colorBuffer.destroy(),e.pbrBuffer&&e.pbrBuffer.destroy(),e.segments.destroy(),e.material&&xM(e.material));if(n.children)for(const e of n.children)mb(e)}function Ym(n,e){const i=n.json.bufferViews[e.bufferView],s=o0[e.componentType];return new s(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Cy[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:Cy[e.type]))}function gb(n,e,i,s){const a=o0[e.componentType],f=(function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(a),m=n.json.bufferViews[e.bufferView],y=m.byteStride?m.byteStride/a.BYTES_PER_ELEMENT:Cy[e.type],w=i.float32,S=w.length/i.capacity;for(let I=0,M=0;I<e.count*y;I+=y,M+=S)for(let O=0;O<S;O++)w[M+O]=s[I+O]*f;i._trim()}function bM(n,e,i){const s=n.indices,a=n.attributes,f={};f.indexArray=new Kr;const m=e.json.accessors[s],y=m.count/3;f.indexArray.reserve(y);const w=Ym(e,m);for(let O=0;O<y;O++)f.indexArray.emplaceBack(w[3*O],w[3*O+1],w[3*O+2]);f.indexArray._trim(),f.vertexArray=new va;const S=e.json.accessors[a.POSITION];f.vertexArray.reserve(S.count);const I=Ym(e,S);for(let O=0;O<S.count;O++)f.vertexArray.emplaceBack(I[3*O],I[3*O+1],I[3*O+2]);if(f.vertexArray._trim(),f.aabb=new mn(S.min,S.max),f.centroid=(function(O,L){const F=[0,0,0],G=O.length;if(G>0){for(let W=0;W<G;W++){const $=3*O[W];F[0]+=L[$],F[1]+=L[$+1],F[2]+=L[$+2]}F[0]/=G,F[1]/=G,F[2]/=G}return F})(w,I),a.COLOR_0!==void 0){const O=e.json.accessors[a.COLOR_0],L=Cy[O.type],F=Ym(e,O);f.colorArray=L===3?new va:new ol,f.colorArray.resize(O.count),gb(e,O,f.colorArray,F)}if(a.NORMAL!==void 0){f.normalArray=new va;const O=e.json.accessors[a.NORMAL];f.normalArray.resize(O.count);const L=Ym(e,O);gb(e,O,f.normalArray,L)}if(a.TEXCOORD_0!==void 0&&i.length>0){f.texcoordArray=new Xc;const O=e.json.accessors[a.TEXCOORD_0];f.texcoordArray.resize(O.count);const L=Ym(e,O);gb(e,O,f.texcoordArray,L)}if(a._FEATURE_ID_RGBA4444!==void 0){const O=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=Ym(e,O))}a._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(Ym(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const M=n.material;return f.material=(function(O,L){const{emissiveFactor:F=[0,0,0],alphaMode:G="OPAQUE",alphaCutoff:W=.5,normalTexture:$,occlusionTexture:K,emissiveTexture:te,doubleSided:se,name:pe}=O,{baseColorFactor:de=[1,1,1,1],metallicFactor:be=1,roughnessFactor:Te=1,baseColorTexture:ve,metallicRoughnessTexture:Ce}=O.pbrMetallicRoughness||{},ze=K?L[K.index]:void 0;if(K&&K.extensions&&K.extensions.KHR_texture_transform&&ze){const it=K.extensions.KHR_texture_transform;ze.offsetScale=[it.offset[0],it.offset[1],it.scale[0],it.scale[1]]}return{name:pe,pbrMetallicRoughness:{baseColorFactor:new xn(...de),metallicFactor:be,roughnessFactor:Te,baseColorTexture:ve?L[ve.index]:void 0,metallicRoughnessTexture:Ce?L[Ce.index]:void 0},doubleSided:se,emissiveFactor:new xn(...F),alphaMode:G,alphaCutoff:W,normalTexture:$?L[$.index]:void 0,occlusionTexture:ze,emissionTexture:te?L[te.index]:void 0,defined:O.defined===void 0}})(M!==void 0?e.json.materials[M]:{defined:!1},i),f}function kT(n,e,i){const{matrix:s,rotation:a,translation:f,scale:m,mesh:y,extras:w,children:S,name:I}=n,M={};if(M.name=I,M.localMatrix=s||(function(O,L,F,G){var W=L[0],$=L[1],K=L[2],te=L[3],se=W+W,pe=$+$,de=K+K,be=W*se,Te=W*pe,ve=W*de,Ce=$*pe,ze=$*de,it=K*de,Je=te*se,tt=te*pe,dt=te*de,ut=G[0],ht=G[1],Ye=G[2];return O[0]=(1-(Ce+it))*ut,O[1]=(Te+dt)*ut,O[2]=(ve-tt)*ut,O[3]=0,O[4]=(Te-dt)*ht,O[5]=(1-(be+it))*ht,O[6]=(ze+Je)*ht,O[7]=0,O[8]=(ve+tt)*Ye,O[9]=(ze-Je)*Ye,O[10]=(1-(be+Ce))*Ye,O[11]=0,O[12]=F[0],O[13]=F[1],O[14]=F[2],O[15]=1,O})([],a||[0,0,0,1],f||[0,0,0],m||[1,1,1]),M.globalMatrix=he(M.localMatrix),y!==void 0){M.meshes=i[y];const O=M.anchor=[0,0];for(const L of M.meshes){const{min:F,max:G}=L.aabb;O[0]+=F[0]+G[0],O[1]+=F[1]+G[1]}O[0]=Math.floor(O[0]/M.meshes.length/2),O[1]=Math.floor(O[1]/M.meshes.length/2)}if(w&&(w.id&&(M.id=w.id),w.lights&&(M.lights=(function(O){if(!O.length)return[];const L=(function(K){const te=atob(K),se=new Uint8Array(te.length);for(let pe=0;pe<te.length;pe++)se[pe]=te.codePointAt(pe);return se})(O),F=[],G=L.length/24,W=new Uint16Array(L.buffer),$=new Float32Array(L.buffer);for(let K=0;K<G;K++){const te=W[2*K*6]/30,se=W[2*K*6+1]/30,pe=W[2*K*6+10]/100,de=$[6*K+1],be=$[6*K+2],Te=$[6*K+3],ve=$[6*K+4],Ce=Te-de,ze=ve-be,it=Math.hypot(Ce,ze);F.push({pos:[de+.5*Ce,be+.5*ze,se],normal:[ze/it,-Ce/it,0],width:it,height:te,depth:pe,points:[de,be,Te,ve]})}return F})(w.lights)),w.MAPBOX_geometry_bloom&&(M.isGeometryBloom=w.MAPBOX_geometry_bloom)),S){const O=[];for(const L of S)O.push(kT(e.json.nodes[L],e,i));M.children=O}return M}function wM(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new qm(n.vertices,n.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:s}}function TM(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const m of i){if(!Array.isArray(m)||m.length!==2)continue;const y=m[0],w=m[1];typeof y=="number"&&typeof w=="number"&&s.push(new pt(y,w))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let a=0;for(let m=0;m<s.length;m++){const y=s[m],w=s[(m+1)%s.length],S=s[(m+2)%s.length];a+=(y.x-w.x)*(S.y-w.y)-(S.x-w.x)*(y.y-w.y)}a>0&&s.reverse();const f=hl(s.flatMap(m=>[m.x,m.y]),[]);return f.length===0?null:{vertices:s,indices:f}}function SM(n,e){const i=[],s=[];let a=0;const f=[];for(const m of n){a=i.length;const y=m.vertexArray.float32,w=m.indexArray.uint16;for(let S=0;S<m.vertexArray.length;S++)f[0]=y[3*S+0],f[1]=y[3*S+1],f[2]=y[3*S+2],vn(f,f,e),i.push(new pt(f[0],f[1]));for(let S=0;S<3*m.indexArray.length;S++)s.push(w[S]+a)}if(s.length%3!=0)return null;for(let m=0;m<s.length;m+=3){const y=i[s[m+0]],w=i[s[m+1]],S=i[s[m+2]];(y.x-w.x)*(S.y-w.y)-(S.x-w.x)*(y.y-w.y)>0&&([s[m+1],s[m+2]]=[s[m+2],s[m+1]])}return{vertices:i,indices:s}}function _b(n){const e=(function(w,S){const I=[],M=WebGL2RenderingContext;if(w.json.textures)for(const O of w.json.textures){const L={magFilter:M.LINEAR,minFilter:M.NEAREST,wrapS:M.REPEAT,wrapT:M.REPEAT};O.sampler!==void 0&&Object.assign(L,w.json.samplers[O.sampler]),I.push({image:S[O.source],sampler:L,uploaded:!1})}return I})(n,n.images),i=(function(w,S){const I=[];for(const M of w.json.meshes){const O=[];for(const L of M.primitives)O.push(bM(L,w,S));I.push(O)}return I})(n,e),{scenes:s,scene:a,nodes:f}=n.json,m=s?s[a||0].nodes:[...f.keys()],y=[];for(const w of m)y.push(kT(f[w],n,i));return(function(w,S,I){const M={},O=new Set;for(let L=0;L<w.length;L++){const F=I[S[L]];if(!F.extras)continue;const G=F.extras["mapbox:footprint:version"],W=F.extras["mapbox:footprint:id"];(G||W)&&O.add(L),G==="1.0.0"&&W&&(M[W]=L)}for(let L=0;L<w.length;L++){if(O.has(L))continue;const F=w[L],G=I[S[L]];if(!G.extras)continue;let W=null;F.id in M&&(W=SM(w[M[F.id]].meshes,F.localMatrix)),W||(W=TM(G)),W&&(F.footprint=wM(W))}if(O.size>0){const L=Array.from(O.values()).sort((F,G)=>F-G);for(let F=L.length-1;F>=0;F--)w.splice(L[F],1)}})(y,m,n.json.nodes),y}function EM(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,s=n.aabb.min[1]-1,a=Xm/(n.aabb.max[0]-i+2),f=Xm/(n.aabb.max[1]-s+2);for(let m=0;m<e.length;m+=3){const y=e[m+2],w=(e[m+0]-i)*a|0,S=(e[m+1]-s)*f|0;y>n.heightmap[S*Xm+w]&&(n.heightmap[S*Xm+w]=y)}}function BT(n,e,i,s,a){i.reserve(i.length+4*n.length),s.reserve(s.length+10*n.length),a.reserve(a.length+10*n.length);let f=s.length;for(const m of n){const y=Math.min(10,Math.max(4,1.3*m.height))*e,w=[-m.normal[1],m.normal[0],0],S=Math.min(.29,.1*m.width/m.depth),I=m.width-2*m.depth*e*(S+.01),M=Gt([],m.pos,w,I/2),O=Gt([],m.pos,w,-I/2),L=[M[0],M[1],M[2]+m.height],F=[O[0],O[1],O[2]+m.height],G=Gt([],m.normal,w,S);bt(G,G,y);const W=Gt([],m.normal,w,-S);bt(W,W,y),yt(G,M,G),yt(W,O,W),M[2]+=.1,O[2]+=.1,s.emplaceBack(G[0],G[1],G[2]),s.emplaceBack(W[0],W[1],W[2]),s.emplaceBack(M[0],M[1],M[2]),s.emplaceBack(O[0],O[1],O[2]),s.emplaceBack(L[0],L[1],L[2]),s.emplaceBack(F[0],F[1],F[2]),s.emplaceBack(M[0],M[1],M[2]),s.emplaceBack(O[0],O[1],O[2]),s.emplaceBack(G[0],G[1],G[2]),s.emplaceBack(W[0],W[1],W[2]);const $=I/y/2;a.emplaceBack(-$-S,-1,$,.8),a.emplaceBack($+S,-1,$,.8),a.emplaceBack(-$,0,$,1.3),a.emplaceBack($,0,$,1.3),a.emplaceBack($+S,-.8,$,.7),a.emplaceBack($+S,-.8,$,.7),a.emplaceBack(0,0,$,1.3),a.emplaceBack(0,0,$,1.3),a.emplaceBack($+S,-1.2,$,.8),a.emplaceBack($+S,-1.2,$,.8),i.emplaceBack(6+f,4+f,8+f),i.emplaceBack(7+f,9+f,5+f),i.emplaceBack(0+f,1+f,2+f),i.emplaceBack(1+f,3+f,2+f),f+=10}}function AM(n,e){const i={};i.indexArray=new Kr,i.vertexArray=new va,i.colorArray=new ol,BT(n,e,i.indexArray,i.vertexArray,i.colorArray);const s={defined:!0};s.emissiveFactor=xn.black;const a={};return a.baseColorFactor=xn.white,s.pbrMetallicRoughness=a,i.material=s,i.aabb=new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const FT=$i([{name:"a_pos_3f",components:3,type:"Float32"}]),CM=$i([{name:"a_normal_3",components:3,type:"Int16"}]),IM=$i([{name:"a_centroid_3",components:3,type:"Int16"}]),NT=$i([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),RM=$i([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),MM=$i([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),DM=$i([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),OM=$i([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),PM=$i([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),jT=Zi.types,f0=32767;function zM(n,e){const i=zt+e;for(const s of n)for(const a of s)if(a.x<-e||a.x>i||a.y<-e||a.y>i)return!1;return!0}function LM(n){switch(n){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${n}`)}}class yb{constructor(){this.layoutVertexArray=new va,this.layoutAttenuationArray=new ol,this.layoutColorArray=new xa,this.indexArray=new Kr,this.indexArrayForConflation=new Kr,this.segmentsBucket=new Wn}}class vb{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new Wn,this.entranceBloom=new yb;const i=66560;this.layoutVertexArray=new va,this.layoutVertexArray.reserve(i),this.layoutNormalArray=new rl,this.layoutNormalArray.reserve(i),this.layoutCentroidArray=new rl,this.layoutCentroidArray.reserve(i),this.layoutColorArray=new xa,this.layoutColorArray.reserve(i),this.layoutFloodLightDataArray=new Uh,this.layoutFloodLightDataArray.reserve(i),this.layoutAOArray=new ef,this.layoutAOArray.reserve(i),this.indexArray=new Kr,this.indexArray.reserve(66560),this.indexArrayForConflation=new Kr,this.segmentsBucket=new Wn,this.entranceBloom=new yb,e&&(this.layoutFacadePaintArray=new xa,this.layoutFacadeDataArray=new Ou,this.layoutFacadeVerticalRangeArray=new xa)}reserve(e,i,s){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(i),s&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class UT{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Xc,this.footprintsIndices=new Uh,this.footprintsMin=new pt(1/0,1/0),this.footprintsMax=new pt(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new vb(!1),this.buildingWithFacade=new vb(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.groundEffect=new ur(e),this.groundEffect.groundRadiusArray=new ms,this.hasAppearances=null}updateFootprints(e,i){const s=new qm([],[],1),a={vertices:[],indices:new Uint32Array(0),grid:s,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};i.push({footprint:a,id:e})}updateAppearances(e,i,s,a){}prepare(){return(function(){if(s0!=null||mT!=null)return null;if(n_!=null)return n_;const e=fetch(Qr.BUILDING_GEN_URL);return n_=(function(i){let s,a,f,m,y;function w(){s=new Uint8Array(y.buffer),a=new Int16Array(y.buffer),f=new Int32Array(y.buffer),m=new Float32Array(y.buffer)}function S(){throw new Error("Unexpected BuildingGen error.")}const I=()=>{},M={a:{a:S,f:function(O){const L=s.length,F=Math.max(O>>>0,Math.ceil(1.2*L)),G=Math.ceil((F-L)/65536);try{return y.grow(G),w(),!0}catch{return!1}},g:S,b:I,c:I,d:I,e:I}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,M):i.then(O=>O.arrayBuffer()).then(O=>WebAssembly.instantiate(O,M))).then(O=>{const L=O.instance.exports;return(0,L.g)(),y=L.f,w(),new sM({setStyle:L.h,setAOOptions:L.i,setMetricOptions:L.j,setStructuralOptions:L.k,setFacadeOptions:L.l,setFauxFacadeOptions:L.m,setFacadeClassifierOptions:L.n,addFeature:L.o,addFacade:L.p,generateMesh:L.q,getLastError:L.r,getOuterRingLength:L.s,getMeshCount:L.t,getPositionsPtr:L.u,getPositionsLength:L.v,getNormalsPtr:L.w,getNormalsLength:L.x,getAOPtr:L.y,getAOLength:L.z,getUVPtr:L.A,getUVLength:L.B,getFauxFacadePtr:L.C,getFauxFacadeLength:L.D,getIndicesPtr:L.E,getIndicesLength:L.F,getBuildingPart:L.G,getRingCount:L.H,getRingPtr:L.I,getRingLength:L.J,malloc:L.K,free:L.L,heapU8:s,heap16:a,heap32:f,heapF32:m})})})(e).then(i=>(n_=null,s0=i,s0)).catch(i=>{bi("Could not load building-gen"),n_=null,mT=i}),n_})()}populate(e,i,s,a){const f=oM();if(!f)return;const m=St(s);this.tileToMeter=m,this.brightness=i.brightness,f.setStyle({normalScale:[1,-1,m],tileToMeters:m}),f.setAOOptions(!1,.3),f.setMetricOptions(!1,16),f.setStructuralOptions(!0),f.setFacadeClassifierOptions(3);const y=new Map,w=new Map;let S=0;for(const{feature:$}of e){if(jT[$.type]!=="LineString"){y.set($.id,$.properties.source_id);continue}const K=this.layers[0]._featureFilter.needGeometry;if(K&&!this.layers[0]._featureFilter.filter(new bn(this.zoom),$,s))continue;const te=Pi($,K);if(!K&&!this.layers[0]._featureFilter.filter(new bn(this.zoom),te,s))continue;const se=K?te.geometry:_i($,s,a),pe=[];for(const ve of se)for(const Ce of ve)pe.push(Ce.x),pe.push(Ce.y);const de={coordinates:pe,crossPerc:$.properties.cross_perc,distanceToRoad:$.properties.distance_to_road,entrances:$.properties.entrances,sourceId:0},be=$.properties.source_id;let Te=w.get(be);Te||(Te=[],w.set(be,Te)),Te.push(de),++S}this.maxHeight=0;const I=new Array,M=new Set,O=$=>{$!=null&&M.add($)},L=($,K)=>{$!=null&&I.push({buildingId:$,footprintIndex:K})},F=64*(e.length-S),G=F/2;this.buildingWithFacade.reserve(F,G,!0),this.buildingWithoutFacade.reserve(2*F,2*G,!1),this.footprintsIndices.reserve(16*(e.length-S)),this.footprintsVertices.reserve(8*(e.length-S));for(const{feature:$,id:K,index:te,sourceLayerIndex:se}of e){if(jT[$.type]==="LineString")continue;const pe=this.layers[0]._featureFilter.needGeometry;if(pe&&!this.layers[0]._featureFilter.filter(new bn(this.zoom),$,s))continue;let de=null;if($.properties&&$.properties.hasOwnProperty("building_id")&&(de=Number($.properties.building_id),M.has(de)))continue;const be=Pi($,pe);if(!pe&&!this.layers[0]._featureFilter.filter(new bn(this.zoom),be,s))continue;const Te=pe?be.geometry:_i($,s,a),ve=jm(Te,500);let Ce=!1;for(const Hi of ve)if(Hi.length!==1){Ce=!0;break}if(Ce){O(de);continue}if(!zM(Te,163)){O(de);continue}const ze=this.layers[0],it=LM(ze.layout.get("building-roof-shape").evaluate($,{},s)),Je=ze.layout.get("building-base").evaluate($,{},s),tt=ze.layout.get("building-height").evaluate($,{},s),dt=ze.layout.get("building-flood-light-ground-radius").evaluate($,{},s),ut=ze.paint.get("building-ambient-occlusion-intensity"),ht=dt/this.tileToMeter;$.properties["building-part"]="roof";const Ye=ze.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),mt=ze.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="wall";const at=ze.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),_t=ze.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="window";const ft=ze.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),$t=ze.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="door";const Wt=ze.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),Ft=ze.paint.get("building-emissive-strength").evaluate($,{},this.canonical);let jt=ze.layout.get("building-flood-light-wall-radius").evaluate($,{},s);jt=_e(jt,0,2048);const di=jt/2048*f0,ni=y.get(K),qt=w.get(ni)||[],Ai=qt.length!==0&&ze.layout.get("building-facade").evaluate($,{},s);f.setFacadeOptions(4,!0),f.setFauxFacadeOptions(Ai,!1,1);let Xi=0,yn=0,qi=0,Ln=0,hn=0,Fr=0,gn=0,Pn=0,sr=0,pr=0,mr=0;if(Ai){let Hi=Math.round(ze.layout.get("building-facade-floors").evaluate($,{},s));if(Je===0){Hi=Math.max(1,Hi-(qt.length>0?1:0));let jr=4;if(tt>100){const ys=[10,13,15];jr=ys[$.id?$.id%ys.length:0]}else tt<=10&&(jr=3);f.setFacadeOptions(jr,!0),hn=(tt<15?1.3:1.61803)*jr/m}else hn=Je/m;Fr=tt/m,hn=Math.min(hn,Fr),qi=ze.layout.get("building-facade-unit-width").evaluate($,{},s)/m,Ln=(Fr-hn)/Hi,f.setFauxFacadeOptions(!0,!0,qi);const Fs=ze.layout.get("building-facade-window").evaluate($,{},s);Xi=Fs[0],yn=Fs[1],gn=Math.floor(65535*Math.min(1,hn/zt)),Pn=Math.floor(65535*Math.min(1,Fr/zt)),sr=Math.floor(255*Xi)<<8|Math.floor(255*yn),pr=Math.floor(65535*Math.min(1,qi/zt)),mr=Math.floor(65535*Math.min(1,Ln/zt))}const Nr=Array(ve.length),Ks={x:1/0,y:1/0},Eo={x:-1/0,y:-1/0},ls={x:0,y:0};let _s=0;for(let Hi=0;Hi<ve.length;Hi++){const Fs=ve[Hi];if(Fs.length>0){const jr=[],ys=Array(Fs.length+1);ys[0]=0;for(let xc=0;xc<Fs.length;xc++){const Ua=Fs[xc];for(let ml=0;ml<Ua.length;ml++){const Ns=Ua[Ua.length-ml-1];Ks.x=Math.min(Ks.x,Ns.x),Ks.y=Math.min(Ks.y,Ns.y),Eo.x=Math.max(Eo.x,Ns.x),Eo.y=Math.max(Eo.y,Ns.y),ls.x+=Ns.x,ls.y+=Ns.y,_s++,jr.push(Ns.x),jr.push(Ns.y)}ys[xc+1]=jr.length}Nr[Hi]={id:$.id?$.id:0,height:tt,minHeight:Je,sourceId:0,roofType:it,coordinates:jr,ringIndices:ys}}}ls.x/=_s||1,ls.y/=_s||1;const Os=f.generateMesh(Nr,qt);if(typeof Os=="string"){bi(`Unable to generate building ${$.id}: ${Os}`),O(de);continue}if(Os.meshes.length===0||Os.modifiedPolygonRings.length===0){O(de);continue}const Gi=Ai?this.buildingWithFacade:this.buildingWithoutFacade;let gr=0;for(const Hi of Os.meshes)gr+=Hi.positions.length/3;const Ir=Gi.segmentsBucket.prepareSegment(gr,Gi.layoutVertexArray,Gi.indexArray),pl=[];let ca=null,Js=0,ua=-1;const td=Gi.layoutVertexArray.length,Go=td+gr;Gi.layoutVertexArray.resize(Go),Gi.layoutCentroidArray.resize(Go),Gi.layoutNormalArray.resize(Go),Gi.layoutAOArray.resize(Go),Gi.layoutColorArray.resize(Go),Gi.layoutFloodLightDataArray.resize(Go),Ai&&(Gi.layoutFacadePaintArray.resize(Go),Gi.layoutFacadeDataArray.resize(Go),Gi.layoutFacadeVerticalRangeArray.resize(Go));const F0=Gi.indexArray.length;let g_=0,Ta=td;for(const Hi of Os.meshes){let Fs,jr;if(Hi.buildingPart===1)Fs=Ye,jr=mt;else if(Hi.buildingPart===0)Fs=at,jr=_t;else if(Hi.buildingPart===2)Fs=ft,jr=$t;else{if(Hi.buildingPart!==3)continue;Fs=Wt,jr=Ft}if(jr=_e(jr,0,1),Hi.buildingPart===3){const cs=new Array;for(let Ho=0;Ho<Hi.positions.length;Ho+=12){const Ap=Hi.positions[Ho+0],eo=Hi.positions[Ho+1],Va=Hi.positions[Ho+3],ru=Hi.positions[Ho+4],rd=Hi.positions[Ho+2],nw=Hi.positions[Ho+8]-rd,rw=1,Qy=Va-Ap,y_=ru-eo,Xu=Math.hypot(Qy,y_);cs.push({pos:[Ap+.5*Qy,eo+.5*y_,rd],normal:[y_/Xu,-Qy/Xu,0],width:Xu,height:nw,depth:rw,points:[Ap,eo,Va,ru]})}const Qs=Gi.entranceBloom.segmentsBucket.prepareSegment(10*cs.length,Gi.entranceBloom.layoutVertexArray,Gi.entranceBloom.indexArray),vs=Gi.entranceBloom.layoutVertexArray.length;Js=Gi.entranceBloom.indexArray.length,BT(cs,.5/this.tileToMeter,Gi.entranceBloom.indexArray,Gi.entranceBloom.layoutVertexArray,Gi.entranceBloom.layoutAttenuationArray);const qo=Gi.entranceBloom.layoutVertexArray.length-vs;ua=Gi.entranceBloom.indexArray.length-Js;for(let Ho=0;Ho<qo;Ho++)Gi.entranceBloom.layoutColorArray.emplaceBack(255*Wt.r<<8|255*Wt.g,255*Wt.b<<8|51*Ft);Qs.vertexLength+=qo,Qs.primitiveLength+=ua,ca={part:Hi.buildingPart,vertexOffset:vs,vertexLength:qo}}Gi.layoutVertexArray.float32.set(Hi.positions,3*Ta);const ys=Hi.positions.length/3;for(let cs=0;cs<ys;++cs){const Qs=3*cs;g_=Math.max(g_,Hi.positions[Qs+2]);const vs=Hi.normals[Qs+1]*f0,qo=Hi.normals[Qs+2]*f0,Ho=3*(Ta+cs);Gi.layoutNormalArray.int16[Ho]=Hi.normals[Qs]*f0,Gi.layoutNormalArray.int16[Ho+1]=vs,Gi.layoutNormalArray.int16[Ho+2]=qo;const Ap=Hi.ao[cs];Gi.layoutAOArray.uint8[Ta+cs]=255*Ap;const eo=1+(Ap-1)*ut,Va=255*Fs.b*eo<<8|255*jr;Gi.layoutColorArray.uint16[2*(Ta+cs)]=255*Fs.r*eo<<8|255*Fs.g*eo,Gi.layoutColorArray.uint16[2*(Ta+cs)+1]=Va}const xc=Math.floor(ls.x),Ua=Math.floor(ls.y),ml=Math.floor(tt);for(let cs=0;cs<ys;++cs){const Qs=3*(Ta+cs);Gi.layoutCentroidArray.int16[Qs]=xc,Gi.layoutCentroidArray.int16[Qs+1]=Ua,Gi.layoutCentroidArray.int16[Qs+2]=ml}if(Gi.layoutFloodLightDataArray.uint16.fill(Hi.buildingPart===0?di:0,Ta,Ta+ys),Ai){const cs=255*ft.r<<8|255*ft.g,Qs=255*ft.b<<8|255*$t;for(let vs=0;vs<ys;++vs){const qo=2*(Ta+vs);Gi.layoutFacadePaintArray.uint16[qo]=cs,Gi.layoutFacadePaintArray.uint16[qo+1]=Qs}for(let vs=0;vs<ys;++vs)if(Hi.isFauxFacade[vs]){const qo=Math.min(65535,Math.floor(Hi.uv[2*vs]*Os.outerRingLength));Gi.layoutFacadeDataArray.emplace(Ta+vs,1|qo,sr,pr,mr),Gi.layoutFacadeVerticalRangeArray.emplace(Ta+vs,gn,Pn)}else Gi.layoutFacadeDataArray.emplace(Ta+vs,0,0,0,0),Gi.layoutFacadeVerticalRangeArray.emplace(Ta+vs,0,0)}const Ns=Ir.vertexLength,Jy=Hi.indices.length/3,nd=Gi.indexArray.length;Gi.indexArray.resize(nd+Jy);for(let cs=0;cs<Jy;++cs){const Qs=3*cs,vs=3*nd+Qs;Gi.indexArray.uint16[vs]=Ns+Hi.indices[Qs],Gi.indexArray.uint16[vs+1]=Ns+Hi.indices[Qs+1],Gi.indexArray.uint16[vs+2]=Ns+Hi.indices[Qs+2]}Hi.buildingPart!==1&&Hi.buildingPart!==0&&Hi.buildingPart!==2&&Hi.buildingPart!==3||pl.push({part:Hi.buildingPart,vertexOffset:Ta,vertexLength:Hi.positions.length/3}),Ta+=ys,Ir.vertexLength+=ys,Ir.primitiveLength+=Hi.indices.length/3}this.maxHeight=Math.max(this.maxHeight,g_);const N0=Gi.indexArray.length-F0,id=this.footprintsIndices.length,pf=this.footprintsVertices.length,Ep=[],vc=new pt(1/0,1/0),nu=new pt(-1/0,-1/0),Ky=this.groundEffect.vertexArray.length;for(const Hi of Os.modifiedPolygonRings){const Fs=[],jr=new pt(1/0,1/0),ys=new pt(-1/0,-1/0);for(let xc=0;xc<Hi.length;xc+=2){const Ua=Hi.length-xc-2;jr.x=Math.min(jr.x,Hi[Ua]),jr.y=Math.min(jr.y,Hi[Ua+1]),ys.x=Math.max(ys.x,Hi[Ua]),ys.y=Math.max(ys.y,Hi[Ua+1]);const ml=new pt(Hi[Ua],Hi[Ua+1]);Fs.push(ml),Ep.push(ml.x,ml.y),this.footprintsVertices.emplaceBack(ml.x,ml.y)}vc.x=Math.min(vc.x,jr.x),vc.y=Math.min(vc.y,jr.y),nu.x=Math.max(nu.x,ys.x),nu.y=Math.max(nu.y,ys.y),this.groundEffect.addData(Fs,[jr,ys],ht)}const __=this.groundEffect.vertexArray.length-Ky;this.groundEffect.groundRadiusArray.reserveForAdditional(__);for(let Hi=0;Hi<__;Hi++)this.groundEffect.groundRadiusArray.emplaceBack(dt);(Ks.x<0||Eo.x>zt||Ks.y<0||Eo.y>zt)&&this.featuresOnBorder.push({featureId:$.id,footprintIndex:this.footprints.length});{const Hi=hl(Ep,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Hi.length),this.footprintsIndices.uint16.set(Hi,id),this.buildingIds.add(de??$.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,vc.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,vc.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,nu.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,nu.y);const Fs={footprintVertexOffset:pf,footprintVertexLength:this.footprintsVertices.length-pf,footprintIndexOffset:id,footprintIndexLength:this.footprintsIndices.length-id,min:vc,max:nu,hiddenFlags:0,indicesOffset:F0,indicesLength:N0,bloomIndicesOffset:Js,bloomIndicesLength:ua,groundEffectVertexOffset:Ky,groundEffectVertexLength:__,hasFauxFacade:Ai,height:g_,promoteId:K,feature:be,parts:pl,buildingBloom:ca},jr=this.footprints.length;$.id!==void 0&&this.featureFootprintLookup.set($.id,jr),L(de,jr),this.footprints.push(Fs)}this.programConfigurations.populatePaintArrays(Gi.layoutVertexArray.length,$,te,{},i.availableImages,s,i.brightness),this.groundEffect.addPaintPropertiesData($,te,{},i.availableImages,s,i.brightness),i.featureIndex.insert($,Te,te,se,this.index,td)}I.forEach(({buildingId:$,footprintIndex:K})=>{M.has($)&&(this.footprints[K].hiddenFlags|=4)});const W=new Set;this.buildingIds.forEach(($,K,te)=>{M.has($)||W.add($)}),this.buildingIds=W,this.groundEffect.prepareBorderSegments()}update(e,i,s,a,f,m,y){this.programConfigurations.updatePaintArrays(e,i,f,s,a,m,y),this.groundEffect.update(e,i,f,s,a,m,y),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=s=>{s.layoutVertexBuffer=e.createVertexBuffer(s.layoutVertexArray,FT.members),s.layoutNormalBuffer=e.createVertexBuffer(s.layoutNormalArray,CM.members),s.layoutCentroidBuffer=e.createVertexBuffer(s.layoutCentroidArray,IM.members),s.layoutFloodLightDataBuffer=e.createVertexBuffer(s.layoutFloodLightDataArray,PM.members),s.layoutFacadeDataArray&&s.layoutFacadeDataArray.length&&(s.layoutFacadeDataBuffer=e.createVertexBuffer(s.layoutFacadeDataArray,MM.members)),s.layoutFacadeVerticalRangeArray&&s.layoutFacadeVerticalRangeArray.length&&(s.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(s.layoutFacadeVerticalRangeArray,DM.members)),s.entranceBloom.layoutVertexArray.length&&(s.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(s.entranceBloom.layoutVertexArray,FT.members),s.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(s.entranceBloom.layoutAttenuationArray,OM.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,s=!0){let a=!1;const f=s?i:0,m=0|(s?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const y of e){const w=this.footprints[y],S=w.hiddenFlags&m|f;w.hiddenFlags!==S&&(w.hiddenFlags=S,a=!0,this.groundEffect.updateHiddenByLandmarkRange(w.groundEffectVertexOffset,w.groundEffectVertexLength,w.hiddenFlags!==0))}return a&&(this.indexArrayForConflationUploaded=!1),a}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=a=>{a.indexArray.length!==0&&(a.indexArrayForConflation.resize(a.indexArray.length),a.indexArrayForConflation.uint16.set(a.indexArray.uint16),a.entranceBloom.indexArrayForConflation.resize(a.entranceBloom.indexArray.length),a.entranceBloom.indexArrayForConflation.uint16.set(a.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const a of this.footprints){const f=a.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,m=a.indicesOffset+a.indicesLength;if(a.hiddenFlags!==0){for(let w=a.indicesOffset;w<m;w++)f.indexArrayForConflation.uint16[3*w+0]=0,f.indexArrayForConflation.uint16[3*w+1]=0,f.indexArrayForConflation.uint16[3*w+2]=0;const y=a.bloomIndicesOffset+a.bloomIndicesLength;for(let w=a.bloomIndicesOffset;w<y;w++)f.entranceBloom.indexArrayForConflation.uint16[3*w+0]=0,f.entranceBloom.indexArrayForConflation.uint16[3*w+1]=0,f.entranceBloom.indexArrayForConflation.uint16[3*w+2]=0}}const s=a=>{a.indexArray.length!==0&&(a.indexBuffer?a.indexBuffer.updateData(a.indexArrayForConflation):a.indexBuffer=e.createIndexBuffer(a.indexArrayForConflation,!0),a.entranceBloom.indexBuffer?a.entranceBloom.indexBuffer.updateData(a.entranceBloom.indexArrayForConflation):a.entranceBloom.indexBuffer=e.createIndexBuffer(a.entranceBloom.indexArrayForConflation,!0))};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=s=>{s.layoutColorBuffer?s.layoutColorBuffer.updateData(s.layoutColorArray):s.layoutColorBuffer=e.createVertexBuffer(s.layoutColorArray,NT.members,!0),s.layoutFacadePaintArray&&(s.layoutFacadePaintBuffer?s.layoutFacadePaintBuffer.updateData(s.layoutFacadePaintArray):s.layoutFacadePaintBuffer=e.createVertexBuffer(s.layoutFacadePaintArray,RM.members,!0)),s.entranceBloom.layoutColorBuffer?s.entranceBloom.layoutColorBuffer.updateData(s.entranceBloom.layoutColorArray):s.entranceBloom.layoutColorBuffer=e.createVertexBuffer(s.entranceBloom.layoutColorArray,NT.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const s=e.paint.get("building-ambient-occlusion-intensity");for(const a of this.footprints){if(4&a.hiddenFlags)continue;const f=i[a.promoteId],m=a.feature;m.properties["building-part"]="roof";const y=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),w=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical);m.properties["building-part"]="wall";const S=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),I=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical);m.properties["building-part"]="window";const M=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),O=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical);m.properties["building-part"]="door";const L=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),F=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical),G=a.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const $ of a.parts){let K,te=y;$.part===1?(te=y,K=w):$.part===0?(te=S,K=I):$.part===2?(te=M,K=O):$.part===3&&(te=L,K=F),K=_e(K,0,1);for(let se=0;se<$.vertexLength;se++){const pe=$.vertexOffset+se,de=1+(G.layoutAOArray.uint8[pe]/255-1)*s;G.layoutColorArray.emplace(pe,te.r*de*255<<8|te.g*de*255,te.b*de*255<<8|255*K),a.hasFauxFacade&&G.layoutFacadePaintArray.emplace(pe,255*M.r<<8|255*M.g,255*M.b<<8|255*O)}}const W=a.buildingBloom;if(W)for(let $=0;$<W.vertexLength;$++)G.entranceBloom.layoutColorArray.emplace(W.vertexOffset+$,255*L.r<<8|255*L.g,255*L.b<<8|51*F)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());if(l(this.activeReplacements,a))return;this.activeReplacements=a;for(const m of this.footprints)m.hiddenFlags&=-2;const f=[];for(const m of this.activeReplacements){if(m.order<s)continue;const y=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(const w of this.footprints)w.min.x>m.max.x||w.max.x<m.min.x||w.min.y>m.max.y||w.max.y<m.min.y||(f.length=0,BM(this.footprintsVertices,w.footprintVertexOffset,w.footprintVertexLength,m.footprintTileId.canonical,e.canonical,f),A(m.footprint,f,this.footprintsIndices.uint16,w.footprintIndexOffset,w.footprintIndexLength,0,-y)&&(w.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const m of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(m.groundEffectVertexOffset,m.groundEffectVertexLength,m.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,a=!0;const f=4*(e+zt)*zt+(i+zt);if(this.footprintLookup.hasOwnProperty(f)){const y=this.footprintLookup[f];return y?{height:y.height,hidden:y.hiddenFlags!==0}:void 0}const m=new pt(e,i);for(const y of this.footprints)e>y.max.x||y.min.x>e||i>y.max.y||y.min.y>i||y.height<=s||kM(m,this.footprintsVertices.float32.subarray(2*y.footprintVertexOffset,2*(y.footprintVertexOffset+y.footprintVertexLength)),this.footprintsIndices.uint16.subarray(y.footprintIndexOffset,y.footprintIndexOffset+y.footprintIndexLength))&&(s=y.height,this.footprintLookup[f]=y,a=y.hiddenFlags!==0);if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:a};this.footprintLookup[f]=void 0}}function kM(n,e,i){for(let s=0;s<i.length;s+=3){const a=i[s],f=i[s+1],m=i[s+2],y=e[2*a+0],w=e[2*a+1],S=e[2*f+0],I=e[2*f+1],M=e[2*m+0],O=e[2*m+1],L=(y-M)*(n.y-O)-(w-O)*(n.x-M),F=(S-y)*(n.y-w)-(I-w)*(n.x-y);if(L<0!=F<0&&L!==0&&F!==0)continue;const G=(M-S)*(n.y-I)-(O-I)*(n.x-S);if(G===0||G<0==L+F<=0)return!0}return!1}function BM(n,e,i,s,a,f){const m=Math.pow(2,s.z-a.z);for(let y=0;y<i;y++){let w=n.float32[2*(y+e)+0],S=n.float32[2*(y+e)+1];w=(w+a.x*zt)*m-s.x*zt,S=(S+a.y*zt)*m-s.y*zt,f.push(new pt(w,S))}}let VT,GT;Mt(UT,"BuildingBucket",{omit:["layers"]}),Mt(vb,"BuildingGeometry"),Mt(yb,"BuildingBloomGeometry");const FM=$i([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),NM=$i([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:jM}=FM,UM=$i([{name:"a_packed",components:3,type:"Float32"}]),{members:VM}=UM,GM=$i([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:qM}=GM;class qT{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Jc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=vt(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const a=[];let f=e.length%2==1?-e[e.length-1]*s:0,m=e[0]*s,y=!0;a.push({left:f,right:m,isDash:y,zeroLength:e[0]===0});let w=e[0];for(let S=1;S<e.length;S++){y=!y;const I=e[S];f=w*s,w+=I,m=w*s,a.push({left:f,right:m,isDash:y,zeroLength:I===0})}return a}addRoundDash(e,i,s){const a=i/2;for(let f=-s;f<=s;f++){const m=this.width*(this.nextRow+s+f);let y=0,w=e[y];for(let S=0;S<this.width;S++){S/w.right>1&&(w=e[++y]);const I=Math.abs(S-w.left),M=Math.abs(S-w.right),O=Math.min(I,M);let L;const F=f/s*(a+1);if(w.isDash){const G=a-Math.abs(F);L=Math.sqrt(O*O+G*G)}else L=a-Math.sqrt(O*O+F*F);this.image.data[m+S]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const S=e[w],I=e[w+1];S.zeroLength?e.splice(w,1):I&&I.isDash===S.isDash&&(I.left=S.left,e.splice(w,1))}const s=e[0],a=e[e.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);const f=this.width*this.nextRow;let m=0,y=e[m];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++m]);const S=Math.abs(w-y.left),I=Math.abs(w-y.right),M=Math.min(S,I);this.image.data[f+w]=Math.max(0,Math.min(255,(y.isDash?M:-M)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const a=i==="round",f=a?7:0,m=2*f+1;if(this.nextRow+m>this.height)return bi("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let I=0;I<e.length;I++)e[I]<0&&(bi("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),y+=e[I];if(y!==0){const I=this.width/y,M=this.getDashRanges(e,this.width,I);a?this.addRoundDash(M,I,f):this.addRegularDash(M,i==="square"?.5*I:0)}const w=this.nextRow+f;this.nextRow+=m;const S={tl:[w,f],br:[y,0]};return this.positions[s]=S,S}}Mt(qT,"LineAtlas");const HM=Zi.types,$M=Math.cos(Math.PI/180*37.5),ZM=Math.cos(Math.PI/180*5);class xb{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Ls,this.layoutVertexArray2=new va,this.patternVertexArray=new va,this.indexArray=new Kr,this.programConfigurations=new z(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Wn,this.maxLineLength=0,this.zOffsetVertexArray=new va,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:128,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.hasPattern=dy("line",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("line-sort-key");this.tileToMeter=St(s);const m=this.layers[0].layout.get("line-elevation-reference");if(m==="hd-road-markup")this.elevationType="road";else{const O=this.layers[0].layout.get("line-z-offset"),L=O.isConstant()&&!O.constantOr(0);this.elevationType=m!=="sea"&&m!=="ground"&&L?"none":"offset",this.elevationType==="offset"&&m==="none"&&bi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const y=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&y!==void 0;const w=[];for(const{feature:O,id:L,index:F,sourceLayerIndex:G}of e){const W=this.layers[0]._featureFilter.needGeometry,$=Pi(O,W);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),$,s))continue;const K=f?f.evaluate($,{},s):void 0,te={id:L,properties:O.properties,type:O.type,sourceLayerIndex:G,index:F,geometry:W?$.geometry:_i(O,s,a),patterns:{},sortKey:K};w.push(te)}f&&w.sort((O,L)=>O.sortKey-L.sortKey);const{lineAtlas:S,featureIndex:I}=i,M=this.addConstantDashes(S);for(const O of w){const{geometry:L,index:F,sourceLayerIndex:G}=O;if(M&&this.addFeatureDashes(O,S),this.hasPattern){const W=fy("line",this.layers,O,this.zoom,this.pixelRatio,i);this.patternFeatures.push(W)}else this.addFeature(O,L,F,s,S.positions,i.availableImages,i.brightness,i.elevationFeatures);I.insert(e[F].feature,L,F,G,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const a=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if(a.kind!=="constant"||f.kind!=="constant")i=!0;else{const m=f.value,y=a.value;if(!y)continue;e.addDash(y,m)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const a of this.layers){const f=a.paint.get("line-dasharray").value,m=a.layout.get("line-cap").value;if(f.kind==="constant"&&m.kind==="constant")continue;let y,w;if(f.kind==="constant"){if(y=f.value,!y)continue}else y=f.evaluate({zoom:s},e);w=m.kind==="constant"?m.value:m.evaluate({zoom:s},e),i.addDash(y,w),e.patterns[a.id]=[i.getKey(y,w)]}}update(e,i,s,a,f,m,y,w){this.programConfigurations.updatePaintArrays(e,i,f,s,a,m,y,w)}addFeatures(e,i,s,a,f,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,s,a,m,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,VM)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,qM)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,NM.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jM),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let s,a;if(i&&i>0?(s=`mapbox_clip_start_${i}`,a=`mapbox_clip_end_${i}`):(s="mapbox_clip_start",a="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(s)&&e.properties.hasOwnProperty(a))return{start:+e.properties[s],end:+e.properties[a]}}addFeature(e,i,s,a,f,m,y,w){const S=this.layers[0].layout,I=S.get("line-join").evaluate(e,{}),M=S.get("line-cap").evaluate(e,{}),O=S.get("line-miter-limit"),L=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const F=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=S.get("line-z-offset").value;const G=this.layers[0].paint.get("line-width").value;if(G.kind!=="constant"&&G.isLineProgressConstant===!1&&(this.variableWidthValue=G),this.elevationType==="road"){const W=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,a,w,I,M,O,L)){const[$,K]=this.clipRuntimeLinesToTile(i,1);for(let te=0;te<$.length;te++){const se=$[te],pe=K[te],de={progress:{min:pe.progress.min,max:pe.progress.max},nextDir:this.computeSegNextDir(pe,se),prevDir:this.computeSegPrevDir(pe,se)};this.addLine(se,e,a,I,M,O,L,de,F&&pe.parentIndex>0?pe.parentIndex:null)}this.fillNonElevatedRoadSegment(W)}}else for(let W=0;W<i.length;W++)this.addLine(i[W],e,a,I,M,O,L,void 0,F&&W>0?W:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,m,a,y,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return n0(e,-i,-i,zt+i,zt+i)}clipRuntimeLinesToTile(e,i){const s=[];return[n0(e,-i,-i,zt+i,zt+i,s),s]}addElevatedRoadFeature(e,i,s,a,f,m,y,w){const S=[],I=Ys.getElevationFeature(e,a);if(I){const M=this.clipLinesToTile(i,1),O=this.prepareElevatedLines(M,I,s);for(const L of O)S.push({geometry:L,elevation:I,elevationTileID:s,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(S.length===0)return!1;for(const M of S){const O=this.layoutVertexArray.length;this.addLine(M.geometry,e,s,f,m,y,w);const L=new aa(s,M.elevationTileID);if(M.elevation)for(let F=O;F<this.layoutVertexArray.length;F++){const G=new pt(this.layoutVertexArray.int16[6*F]>>1,this.layoutVertexArray.int16[6*F+1]>>1),W=L.pointElevation(G,M.elevation,.05);this.updateHeightRange(W),this.zOffsetVertexArray.emplaceBack(W,0,0)}else this.fillNonElevatedRoadSegment(O)}return!0}prepareElevatedLines(e,i,s){if(i.constantHeight!=null)return e;const a=[],f=1/St(s);for(const m of e)tM(m,new No(i,f),0,a);return a}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,s,a,f,m,y,w,S){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=S?this.lineFeatureClips(i,S):this.lineClips;const I=a==="none";this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const M=w&&w.progress.min>0,O=w&&w.progress.max<1;if(this.lineClips){let ve={min:this.lineClips.start,max:this.lineClips.end},Ce=1;if(w){const Je=this.lineClips.end-this.lineClips.start;ve=(function(tt,dt,ut){return{min:hs(tt.min,dt,ut),max:hs(tt.max,dt,ut)}})(w.progress,{min:0,max:1},ve),Je>0&&(Ce=(ve.max-ve.min)/Je)}const ze=+i.properties.mapbox_clip_feature_len,it=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(ze)||Number.isNaN(it)){for(let tt=0;tt<e.length-1;tt++)this.totalDistance+=e[tt].dist(e[tt+1]);const Je=this.totalDistance/(ve.max-ve.min);this.totalFeatureLength=Number.isFinite(Je)?Je:0,this.lineClips.start=ve.min,this.lineClips.end=ve.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ze,this.distance=it*Ce,this.lineClips.start=ve.min,this.lineClips.end=ve.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const L=HM[i.type]==="Polygon";let F=e.length;for(;F>=2&&e[F-1].equals(e[F-2]);)F--;let G=0;for(;G<F-1&&e[G].equals(e[G+1]);)G++;if(F<(L?3:2))return;a==="bevel"&&(m=1.05);const W=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray);let $,K,te,se,pe,de,be,Te;w&&w.prevDir&&(de=w.prevDir.perp()),w&&w.nextDir&&(be=w.nextDir.perp()),this.e1=this.e2=-1,L&&($=e[F-2],pe=e[G].sub($)._unit()._perp());for(let ve=G;ve<F;ve++){if(te=ve===F-1?L?e[G+1]:void 0:e[ve+1],te&&e[ve].equals(te))continue;pe&&(se=pe),$&&(K=$),$=e[ve],Te=this.evaluateLineProgressFeatures(K?K.dist($):0),pe=te?te.sub($)._unit()._perp():se,se=se||pe;const Ce=K&&te;let ze=Ce?a:L||I?"butt":f;const it=se.x*pe.x+se.y*pe.y;if(I){const at=function(_t){if(_t.patternJoinNone){const ft=_t.segmentPoints.length/2,$t=_t.lineSoFar-_t.segmentStart;for(let Wt=0;Wt<ft;++Wt){const Ft=_t.segmentPoints[2*Wt+1],jt=Math.round(_t.segmentPoints[2*Wt])+.5+.25*Ft;_t.patternVertexArray.emplaceBack(jt,$t,_t.segmentStart),_t.patternVertexArray.emplaceBack(jt,$t,_t.segmentStart)}_t.segmentPoints.length=0}_t.e1=_t.e2=-1};if(Ce&&it<ZM){this.updateDistance(K,$),this.addCurrentVertex($,se,1,1,W,Te),at(this),this.addCurrentVertex($,pe,-1,-1,W,Te);continue}if(K){if(!te){this.updateDistance(K,$),this.addCurrentVertex($,se,1,1,W,Te),at(this);continue}ze="miter"}}let Je=se.add(pe);Je.x===0&&Je.y===0||Je._unit();const tt=Je.x*pe.x+Je.y*pe.y,dt=tt!==0?1/tt:1/0,ut=2*Math.sqrt(2-2*tt),ht=tt<$M&&K&&te,Ye=se.x*pe.y-se.y*pe.x>0,mt=this.overscaling<=16?122880/(512*this.overscaling):0;if(Ce&&ze==="round"){if(dt<y)ze="miter";else if(dt<=2){const at=bb($,-10,8202);ze=this.elevationType==="offset"&&(at||this.hasCrossSlope)?"miter":"fakeround"}}if(ze==="miter"&&dt>m&&(ze="bevel"),ze==="bevel"&&(dt>2&&(ze="flipbevel"),dt<m&&(ze="miter")),K&&!(ze==="miter"&&ht)&&this.updateDistance(K,$),ze==="miter")if(ht){const at=$.dist(K);if(at>2*mt){const ft=$.sub($.sub(K)._mult(mt/at)._round());this.updateDistance(K,ft),this.addCurrentVertex(ft,se,0,0,W,Te),K=ft}this.updateDistance(K,$),Je._mult(dt),this.addCurrentVertex($,Je,0,0,W,Te);const _t=$.dist(te);if(_t>2*mt){const ft=$.add(te.sub($)._mult(mt/_t)._round());this.updateDistance($,ft),this.addCurrentVertex(ft,pe,0,0,W,Te),$=ft}}else Je._mult(dt),this.addCurrentVertex($,Je,0,0,W,Te);else if(ze==="flipbevel"){if(dt>100)Je=pe.mult(-1);else{const at=dt*se.add(pe).mag()/se.sub(pe).mag();Je._perp()._mult(at*(Ye?-1:1))}this.addCurrentVertex($,Je,0,0,W,Te),this.addCurrentVertex($,Je.mult(-1),0,0,W,Te)}else if(ze==="bevel"||ze==="fakeround"){Te!=null&&K&&this.addCurrentVertex($,be||se,-1,-1,W,Te);const at=$.dist(K)<=2*mt&&ze!=="bevel",_t=Je.mult(Ye?1:-1);_t._mult(dt);const ft=pe.mult(Ye?-1:1),$t=se.mult(Ye?-1:1),Wt=this.evaluateLineProgressFeatures(this.distance);if(Te==null&&(this.addHalfVertex($,_t.x,_t.y,!1,!Ye,0,W,Wt),at||this.addHalfVertex($,_t.x+2*$t.x,_t.y+2*$t.y,!1,Ye,0,W,Wt)),ze==="fakeround"){const Ft=Math.round(180*ut/Math.PI/20);this.addHalfVertex($,$t.x,$t.y,!1,Ye,0,W,Wt);for(let jt=0;jt<Ft;jt++){let di=jt/Ft;if(di!==.5){const qt=di-.5;di+=di*qt*(di-1)*((1.0904+it*(it*(3.55645-1.43519*it)-3.2452))*qt*qt+(.848013+it*(.215638*it-1.06021)))}const ni=ft.sub($t)._mult(di)._add($t)._unit();this.addHalfVertex($,ni.x,ni.y,!1,Ye,0,W,Wt)}this.addHalfVertex($,ft.x,ft.y,!1,Ye,0,W,Wt)}at||Te!=null||this.addHalfVertex($,_t.x+2*ft.x,_t.y+2*ft.y,!1,Ye,0,W,Wt),Te!=null&&te&&this.addCurrentVertex($,de||pe,1,1,W,Te)}else if(ze==="butt")this.addCurrentVertex($,Je,0,0,W,Te);else if(ze==="square"){if(!K){const at=M?0:-1;this.addCurrentVertex($,Je,at,at,W,Te)}if(this.addCurrentVertex($,Je,0,0,W,Te),K){const at=O?0:1;this.addCurrentVertex($,Je,at,at,W,Te)}}else if(ze==="round"){if(K){const at=!Ce&&be?be:se;this.addCurrentVertex($,at,0,0,W,Te),!Ce&&O||this.addCurrentVertex($,at,1,1,W,Te,!0)}if(te){const at=!Ce&&de?de:pe;!Ce&&M||this.addCurrentVertex($,at,-1,-1,W,Te,!0),this.addCurrentVertex($,at,0,0,W,Te)}}}}addVerticesTo(e,i,s,a,f,m,y,w,S,I){const M=(i.w-e.w)/this.tessellationStep|0;let O=0;const L=this.scaledDistance;if(M>1){this.lineSoFar=e.w;const G=(i.x-e.x)/M,W=(i.y-e.y)/M,$=(i.z-e.z)/M,K=(i.w-e.w)/M;for(let te=1;te<M;++te){e.x+=G,e.y+=W,e.z+=$,this.lineSoFar+=K,O+=K;const se=this.evaluateLineProgressFeatures(this.prevDistance+O);this.scaledDistance=(this.prevDistance+O)/this.totalDistance,this.addHalfVertex(e,s,a,I,!1,y,S,se),this.addHalfVertex(e,f,m,I,!0,-w,S,se)}}this.lineSoFar=i.w,this.scaledDistance=L;const F=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,s,a,I,!1,y,S,F),this.addHalfVertex(i,f,m,I,!0,-w,S,F)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):bi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,s,a,f,m,y=!1){const w=i.x+i.y*s,S=i.y-i.x*s,I=i.y*a-i.x,M=-i.y-i.x*a;if(m!=null){const O=this.elevationType==="offset",L=-10,F=8202,G=m.zOffset,W=new oT(e.x,e.y,G,this.lineSoFar),$=!!O&&bb(e,L,F),K=this.lineSoFar,te=this.distance;if(this.currentVertex)if($){const se=this.currentVertexIsOutside,pe=this.currentVertex,de=new oT(e.x,e.y,G,this.lineSoFar);if(lT(pe,de,L,F),!bb(de,L,F)){if(se){this.e1=this.e2=-1,this.distance-=pe.dist(W),this.lineSoFar=pe.w;const be=this.evaluateLineProgressFeatures(pe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(pe,w,S,y,!1,s,f,be),this.addHalfVertex(pe,I,M,y,!0,-a,f,be),this.prevDistance=this.distance}this.distance=this.prevDistance+pe.dist(de),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(pe,de,w,S,I,M,s,a,f,y),this.distance=te,this.scaledDistance=this.distance/this.totalDistance}}else{const se=this.currentVertex;if(this.currentVertexIsOutside){lT(se,W,L,F),this.e1=this.e2=-1,this.distance-=se.dist(W),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=se.w;const pe=this.evaluateLineProgressFeatures(se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(se,w,S,y,!1,s,f,pe),this.addHalfVertex(se,I,M,y,!0,-a,f,pe),this.prevDistance=this.distance,this.distance=te,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(se,W,w,S,I,M,s,a,f,y)}else $||(this.addHalfVertex(e,w,S,y,!1,s,f,m),this.addHalfVertex(e,I,M,y,!0,-a,f,m));this.currentVertex=W,this.currentVertexIsOutside=$,this.lineSoFar=K}else this.addHalfVertex(e,w,S,y,!1,s,f,m),this.addHalfVertex(e,I,M,y,!0,-a,f,m)}addHalfVertex({x:e,y:i},s,a,f,m,y,w,S){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,y)),this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*a)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const M=vi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,M)}const I=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),w.primitiveLength++),m?this.e2=I:this.e1=I,S!=null&&this.zOffsetVertexArray.emplaceBack(S.zOffset,S.variableWidth,S.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function bb(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let HT,$T;function ZT(n,e,i){return e*(zt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}Mt(xb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const WT=(n,e,i)=>(1-i)*n+i*e;function XT(n,e){return 1/ZT(n,1,e.tileZoom)}function YT(n,e,i,s){return n.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const KT=n=>{const e=[];JT(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=n.layout.get("line-join").constantOr("miter")==="none",a=!!n.paint.get("line-pattern").constantOr(1);return s&&a&&e.push("LINE_JOIN_NONE"),e};function JT(n){const e=n.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let wb;const QT=()=>wb||(wb={layout:HT||(HT=new nr({"line-cap":new Ut(qe.layout_line["line-cap"]),"line-join":new Ut(qe.layout_line["line-join"]),"line-miter-limit":new Dt(qe.layout_line["line-miter-limit"]),"line-round-limit":new Dt(qe.layout_line["line-round-limit"]),"line-sort-key":new Ut(qe.layout_line["line-sort-key"]),"line-z-offset":new Ut(qe.layout_line["line-z-offset"]),"line-elevation-reference":new Dt(qe.layout_line["line-elevation-reference"]),"line-cross-slope":new Dt(qe.layout_line["line-cross-slope"]),visibility:new Dt(qe.layout_line.visibility),"line-width-unit":new Dt(qe.layout_line["line-width-unit"])})),paint:$T||($T=new nr({"line-opacity":new Ut(qe.paint_line["line-opacity"]),"line-color":new Ut(qe.paint_line["line-color"]),"line-translate":new Dt(qe.paint_line["line-translate"]),"line-translate-anchor":new Dt(qe.paint_line["line-translate-anchor"]),"line-width":new Ut(qe.paint_line["line-width"]),"line-gap-width":new Ut(qe.paint_line["line-gap-width"]),"line-offset":new Ut(qe.paint_line["line-offset"]),"line-blur":new Ut(qe.paint_line["line-blur"]),"line-dasharray":new Ut(qe.paint_line["line-dasharray"]),"line-pattern":new Ut(qe.paint_line["line-pattern"]),"line-pattern-cross-fade":new Dt(qe.paint_line["line-pattern-cross-fade"]),"line-gradient":new Mu(qe.paint_line["line-gradient"]),"line-trim-offset":new Dt(qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Dt(qe.paint_line["line-trim-fade-range"]),"line-trim-color":new Dt(qe.paint_line["line-trim-color"]),"line-emissive-strength":new Ut(qe.paint_line["line-emissive-strength"]),"line-border-width":new Ut(qe.paint_line["line-border-width"]),"line-border-color":new Ut(qe.paint_line["line-border-color"]),"line-occlusion-opacity":new Dt(qe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},wb);class WM extends Ut{possiblyEvaluate(e,i){return i=new bn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,s,a){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,s,a)}}let My;function eS(n,e){return e>0?e+2*n:n}const XM=$i([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),YM=$i([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),KM=$i([{name:"a_projected_pos",components:4,type:"Float32"}],4);$i([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const JM=$i([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),QM=$i([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),eD=$i([{name:"a_texb",components:2,type:"Uint16"}]),tD=$i([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),iD=$i([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);$i([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const tS=$i([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nD=$i([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);$i([{name:"triangle",components:3,type:"Uint16"}]),$i([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),$i([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),$i([{type:"Float32",name:"offsetX"}]),$i([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Bs=24;function rD(n,e,i){return n.sections.forEach(s=>{s.text=(function(a,f,m){const y=f.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?a=a.toLocaleUpperCase():y==="lowercase"&&(a=a.toLocaleLowerCase()),na.applyArabicShaping&&(a=na.applyArabicShaping(a)),a})(s.text,e,i)}),n}const Dy={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function sD(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function oD(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}const Tb=4294967296,iS=1/Tb,nS=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let p0=class{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,e,i=this.length){for(;this.pos<i;){const s=this.readVarint(),a=s>>3,f=this.pos;this.type=7&s,n(a,e,this),this.pos===f&&this.skip(s)}return e}readMessage(n,e){return this.readFields(n,e,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Tb;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Tb;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const e=this.buf;let i,s;return s=e[this.pos++],i=127&s,s<128?i:(s=e[this.pos++],i|=(127&s)<<7,s<128?i:(s=e[this.pos++],i|=(127&s)<<14,s<128?i:(s=e[this.pos++],i|=(127&s)<<21,s<128?i:(s=e[this.pos],i|=(15&s)<<28,(function(a,f,m){const y=m.buf;let w,S;if(S=y[m.pos++],w=(112&S)>>4,S<128||(S=y[m.pos++],w|=(127&S)<<3,S<128)||(S=y[m.pos++],w|=(127&S)<<10,S<128)||(S=y[m.pos++],w|=(127&S)<<17,S<128)||(S=y[m.pos++],w|=(127&S)<<24,S<128)||(S=y[m.pos++],w|=(1&S)<<31,S<128))return s_(a,w,f);throw new Error("Expected varint not more than 10 bytes")})(i,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&nS?nS.decode(this.buf.subarray(e,n)):(function(i,s,a){let f="",m=s;for(;m<a;){const y=i[m];let w,S,I,M=null,O=y>239?4:y>223?3:y>191?2:1;if(m+O>a)break;O===1?y<128&&(M=y):O===2?(w=i[m+1],(192&w)==128&&(M=(31&y)<<6|63&w,M<=127&&(M=null))):O===3?(w=i[m+1],S=i[m+2],(192&w)==128&&(192&S)==128&&(M=(15&y)<<12|(63&w)<<6|63&S,(M<=2047||M>=55296&&M<=57343)&&(M=null))):O===4&&(w=i[m+1],S=i[m+2],I=i[m+3],(192&w)==128&&(192&S)==128&&(192&I)==128&&(M=(15&y)<<18|(63&w)<<12|(63&S)<<6|63&I,(M<=65535||M>=1114112)&&(M=null))),M===null?(M=65533,O=1):M>65535&&(M-=65536,f+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),f+=String.fromCharCode(M),m+=O}return f})(this.buf,e,n)}readBytes(){const n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e}readPackedVarint(n=[],e){const i=this.readPackedEnd();for(;this.pos<i;)n.push(this.readVarint(e));return n}readPackedSVarint(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const e=7&n;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(n,e){this.writeVarint(n<<3|e)}realloc(n){let e=this.length||16;for(;e<this.pos+n;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*iS),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*iS),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?(function(e,i){let s,a;if(e>=0?(s=e%4294967296|0,a=e/4294967296|0):(s=~(-e%4294967296),a=~(-e/4294967296),4294967295^s?s=s+1|0:(s=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(f,m,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)})(s,0,i),(function(f,m){const y=(7&f)<<4;m.buf[m.pos++]|=y|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))})(a,i)})(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const e=this.pos;this.pos=(function(s,a,f){for(let m,y,w=0;w<a.length;w++){if(m=a.charCodeAt(w),m>55295&&m<57344){if(!y){m>56319||w+1===a.length?(s[f++]=239,s[f++]=191,s[f++]=189):y=m;continue}if(m<56320){s[f++]=239,s[f++]=191,s[f++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(s[f++]=239,s[f++]=191,s[f++]=189,y=null);m<128?s[f++]=m:(m<2048?s[f++]=m>>6|192:(m<65536?s[f++]=m>>12|224:(s[f++]=m>>18|240,s[f++]=m>>12&63|128),s[f++]=m>>6&63|128),s[f++]=63&m|128)}return f})(this.buf,n,this.pos);const i=this.pos-e;i>=128&&rS(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const e=n.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=n[i]}writeRawMessage(n,e){this.pos++;const i=this.pos;n(e,this);const s=this.pos-i;s>=128&&rS(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s}writeMessage(n,e,i){this.writeTag(n,2),this.writeRawMessage(e,i)}writePackedVarint(n,e){e.length&&this.writeMessage(n,aD,e)}writePackedSVarint(n,e){e.length&&this.writeMessage(n,lD,e)}writePackedBoolean(n,e){e.length&&this.writeMessage(n,hD,e)}writePackedFloat(n,e){e.length&&this.writeMessage(n,cD,e)}writePackedDouble(n,e){e.length&&this.writeMessage(n,uD,e)}writePackedFixed32(n,e){e.length&&this.writeMessage(n,dD,e)}writePackedSFixed32(n,e){e.length&&this.writeMessage(n,fD,e)}writePackedFixed64(n,e){e.length&&this.writeMessage(n,pD,e)}writePackedSFixed64(n,e){e.length&&this.writeMessage(n,mD,e)}writeBytesField(n,e){this.writeTag(n,2),this.writeBytes(e)}writeFixed32Field(n,e){this.writeTag(n,5),this.writeFixed32(e)}writeSFixed32Field(n,e){this.writeTag(n,5),this.writeSFixed32(e)}writeFixed64Field(n,e){this.writeTag(n,1),this.writeFixed64(e)}writeSFixed64Field(n,e){this.writeTag(n,1),this.writeSFixed64(e)}writeVarintField(n,e){this.writeTag(n,0),this.writeVarint(e)}writeSVarintField(n,e){this.writeTag(n,0),this.writeSVarint(e)}writeStringField(n,e){this.writeTag(n,2),this.writeString(e)}writeFloatField(n,e){this.writeTag(n,5),this.writeFloat(e)}writeDoubleField(n,e){this.writeTag(n,1),this.writeDouble(e)}writeBooleanField(n,e){this.writeVarintField(n,+e)}};function s_(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function rS(n,e,i){const s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(let a=i.pos-1;a>=n;a--)i.buf[a+s]=i.buf[a]}function aD(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function lD(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function cD(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function uD(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function hD(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function dD(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function fD(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function pD(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function mD(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}function gD(n,e,i){e.glyphs=[],n===1&&i.readMessage(_D,e)}function _D(n,e,i){if(n===3){const{id:s,bitmap:a,width:f,height:m,left:y,top:w,advance:S}=i.readMessage(yD,{});e.glyphs.push({id:s,bitmap:new Jc({width:f+6,height:m+6},a),metrics:{width:f,height:m,left:y,top:w,advance:S}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function yD(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const fl={horizontal:1,vertical:2,horizontalOnly:3};class Oy{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const s=new Oy;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new Oy;return i.image=e,i}}class o_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,s){const a=new o_;for(let f=0;f<e.sections.length;f++){const m=e.sections[f];m.image?a.addImageSection(m,s):a.addTextSection(m,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,s){let a="";for(let f=0;f<i.length;f++){const m=i.charCodeAt(f+1)||null,y=i.charCodeAt(f-1)||null;a+=!s&&(m&&lm(m)&&!Dy[i[f+1]]||y&&lm(y)&&!Dy[i[f-1]])||!Dy[i[f]]?i[f]:Dy[i[f]]}return a})(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&m0[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&m0[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new o_;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Oy.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(s)}addImageSection(e,i){const s=e.image?e.image.getPrimary():null;if(!s)return void bi("Can't add FormattedSection with an empty image.");s.scaleSelf(i);const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Oy.forImage(s)),this.sectionIndex.push(this.sections.length-1)):bi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Sb(n,e,i,s,a,f,m,y,w,S,I,M,O,L,F,G=1){const W=o_.fromFeature(n,a,G);M===fl.vertical&&W.verticalizePunctuation(O);let $=[];const K=(function(be,Te,ve,Ce,ze,it){if(!be)return[];const Je=[],tt=(function(ht,Ye,mt,at,_t,ft){let $t=0;for(let Wt=0;Wt<ht.length();Wt++){const Ft=ht.getSection(Wt);$t+=sS(ht.getCodePoint(Wt),Ft,at,_t,Ye,ft)}return $t/Math.max(1,Math.ceil($t/mt))})(be,Te,ve,Ce,ze,it),dt=be.text.indexOf("")>=0;let ut=0;for(let ht=0;ht<be.length();ht++){const Ye=be.getSection(ht),mt=be.getCodePoint(ht);if(m0[mt]||(ut+=sS(mt,Ye,Ce,ze,Te,it)),ht<be.length()-1){const at=om(mt);(vD[mt]||at||Ye.image)&&Je.push(aS(ht+1,ut,tt,Je,xD(mt,be.getCodePoint(ht+1),at&&dt),!1))}}return lS(aS(be.length(),ut,tt,Je,0,!0))})(W,S,f,e,s,L),{processBidirectionalText:te,processStyledBidirectionalText:se}=na;if(te&&W.sections.length===1){const be=te(W.toString(),K);for(const Te of be){const ve=new o_;ve.text=Te,ve.sections=W.sections;for(let Ce=0;Ce<Te.length;Ce++)ve.sectionIndex.push(0);$.push(ve)}}else if(se){const be=se(W.text,W.sectionIndex,K);for(const Te of be){const ve=new o_;ve.text=Te[0],ve.sectionIndex=Te[1],ve.sections=W.sections,$.push(ve)}}else $=(function(be,Te){const ve=[],Ce=be.text;let ze=0;for(const it of Te)ve.push(be.substring(ze,it)),ze=it;return ze<Ce.length&&ve.push(be.substring(ze,Ce.length)),ve})(W,K);const pe=[],de={positionedLines:pe,text:W.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(be,Te,ve,Ce,ze,it,Je,tt,dt,ut,ht,Ye){let mt=0,at=0,_t=0;const ft=tt==="right"?1:tt==="left"?0:.5;let $t=!1;for(const ni of ze){const qt=ni.getSections();for(const Ai of qt){if(Ai.image)continue;const Xi=Te[Ai.fontStack];if(Xi&&($t=Xi.ascender!==void 0&&Xi.descender!==void 0,!$t))break}if(!$t)break}let Wt=0;for(const ni of ze){ni.trim();const qt=ni.getMaxScale(),Ai=(qt-1)*Bs,Xi={positionedGlyphs:[],lineOffset:0};be.positionedLines[Wt]=Xi;const yn=Xi.positionedGlyphs;let qi=0;if(!ni.length()){at+=it,++Wt;continue}let Ln=0,hn=0;for(let gn=0;gn<ni.length();gn++){const Pn=ni.getSection(gn),sr=ni.getSectionIndex(gn),pr=ni.getCodePoint(gn);let mr=Pn.scale,Nr=null,Ks=null,Eo=null,ls=Bs,_s=0,Os=dt;Os===fl.vertical&&am(pr)&&(Os=fl.horizontal);const Gi=!(Os===fl.horizontal||!ht&&!Pl(pr)||ht&&(m0[pr]||Vd(pr)));if(Pn.image){const gr=Ce.get(Pn.image.toString());if(!gr)continue;Eo=Pn.image,be.iconsInText=be.iconsInText||!0,Ks=gr.paddedRect;const Ir=gr.displaySize;mr=mr*Bs/Ye,Nr={width:Ir[0],height:Ir[1],left:0,top:-3,advance:Gi?Ir[1]:Ir[0],localGlyph:!1},_s=$t?-Nr.height*mr:qt*Bs-17-Ir[1]*mr,ls=Nr.advance;const pl=(Gi?Ir[0]:Ir[1])*mr-Bs*qt;pl>0&&pl>qi&&(qi=pl)}else{const gr=ve[Pn.fontStack];if(!gr)continue;gr[pr]&&(Ks=gr[pr]);const Ir=Te[Pn.fontStack];if(!Ir)continue;const pl=Ir.glyphs[pr];if(!pl)continue;if(Nr=pl.metrics,ls=pr!==8203?Bs:0,$t){const ca=Ir.ascender!==void 0?Math.abs(Ir.ascender):0,Js=Ir.descender!==void 0?Math.abs(Ir.descender):0,ua=(ca+Js)*mr;Ln<ua&&(Ln=ua,hn=(ca-Js)/2*mr),_s=-ca*mr}else _s=(qt-mr)*Bs-17}Gi?(be.verticalizable=!0,yn.push({glyph:pr,image:Eo,x:mt,y:at+_s,vertical:Gi,scale:mr,localGlyph:Nr.localGlyph,fontStack:Pn.fontStack,sectionIndex:sr,metrics:Nr,rect:Ks}),mt+=ls*mr+ut):(yn.push({glyph:pr,image:Eo,x:mt,y:at+_s,vertical:Gi,scale:mr,localGlyph:Nr.localGlyph,fontStack:Pn.fontStack,sectionIndex:sr,metrics:Nr,rect:Ks}),mt+=Nr.advance*mr+ut)}yn.length!==0&&(_t=Math.max(mt-ut,_t),$t?cS(yn,ft,qi,hn,it*qt/2):cS(yn,ft,qi,0,it/2)),mt=0;const Fr=it*qt+qi;Xi.lineOffset=Math.max(qi,Ai),at+=Fr,++Wt}const Ft=at,{horizontalAlign:jt,verticalAlign:di}=Eb(Je);(function(ni,qt,Ai,Xi,yn,qi){const Ln=(qt-Ai)*yn,hn=-qi*Xi;for(const Fr of ni)for(const gn of Fr.positionedGlyphs)gn.x+=Ln,gn.y+=hn})(be.positionedLines,ft,jt,di,_t,Ft),be.top+=-di*Ft,be.bottom=be.top+Ft,be.left+=-jt*_t,be.right=be.left+_t,be.hasBaseline=$t})(de,e,i,s,$,m,y,w,M,S,O,F),!(function(be){for(const Te of be)if(Te.positionedGlyphs.length!==0)return!1;return!0})(pe))return de}const m0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vD={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function sS(n,e,i,s,a,f){if(e.image){const m=s.get(e.image.toString());return m?m.displaySize[0]*e.scale*Bs/f+a:0}{const m=i[e.fontStack],y=m&&m.glyphs[n];return y?y.metrics.advance*e.scale+a:0}}function oS(n,e,i,s){const a=Math.pow(n-e,2);return s?n<e?a/2:2*a:a+Math.abs(i)*i}function xD(n,e,i){let s=0;return n===10&&(s-=1e4),i&&(s+=150),n!==40&&n!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function aS(n,e,i,s,a,f){let m=null,y=oS(e,i,a,f);for(const w of s){const S=oS(e-w.x,i,a,f)+w.badness;S<=y&&(m=w,y=S)}return{index:n,x:e,priorBreak:m,badness:y}}function lS(n){return n?lS(n.priorBreak).concat(n.index):[]}function Eb(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function cS(n,e,i,s,a){if(!(e||i||s||a))return;const f=n.length-1,m=n[f],y=(m.x+m.metrics.advance*m.scale)*e;for(let w=0;w<=f;w++)n[w].x-=y,n[w].y+=i+s+a}function Ab(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function g0(n,e,i,s){const{horizontalAlign:a,verticalAlign:f}=Eb(s),m=i[0]-n.displaySize[0]*a,y=i[1]-n.displaySize[1]*f;return{imagePrimary:n,imageSecondary:e,top:y,bottom:y+n.displaySize[1],left:m,right:m+n.displaySize[0]}}function Cb(n,e,i,s,a,f){const m=n.imagePrimary;let y;if(m.content){const W=m.content,$=m.pixelRatio||1;y=[W[0]/$,W[1]/$,m.displaySize[0]-W[2]/$,m.displaySize[1]-W[3]/$]}const w=e.left*f,S=e.right*f;let I,M,O,L;i==="width"||i==="both"?(L=a[0]+w-s[3],M=a[0]+S+s[1]):(L=a[0]+(w+S-m.displaySize[0])/2,M=L+m.displaySize[0]);const F=e.top*f,G=e.bottom*f;return i==="height"||i==="both"?(I=a[1]+F-s[0],O=a[1]+G+s[2]):(I=a[1]+(F+G-m.displaySize[1])/2,O=I+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:I,right:M,bottom:O,left:L,collisionPadding:y}}function uS(n){return!n.imagePrimary.stretchX}function hS(n){return!n.imagePrimary.stretchY}function dS(n){return{width:n.right-n.left,height:n.bottom-n.top}}const df=128;function Km(n,e,i,s){const{expression:a}=e;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new bn(n+1,{worldview:i}),void 0,void 0,void 0,s)};if(a.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:m}=a;let y=0;for(;y<f.length&&f[y]<=n;)y++;y=Math.max(0,y-1);let w=y;for(;w<f.length&&f[w]<n+1;)w++;w=Math.min(f.length-1,w);const S=f[y],I=f[w];return a.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:I,interpolationType:m}:{kind:"camera",minZoom:S,maxZoom:I,minSize:a.evaluate(new bn(S,{worldview:i}),void 0,void 0,void 0,s),maxSize:a.evaluate(new bn(I,{worldview:i}),void 0,void 0,void 0,s),interpolationType:m}}}function Ib(n,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:a}){return n.kind==="source"?s/df:n.kind==="composite"?vi(s/df,a/df,i):e}function a_(n,e,i=1){let s=0,a=0;if(n.kind==="constant")a=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:f,minZoom:m,maxZoom:y}=n,w=f?_e(ar.interpolationFactor(f,e,m,y),0,1):0;n.kind==="camera"?a=vi(n.minSize,n.maxSize,w)*i:s=w*i}return{uSizeT:s,uSize:a}}class ff extends pt{constructor(e,i,s,a,f){super(e,i),this.angle=a,this.z=s,f!==void 0&&(this.segment=f)}clone(){return new ff(this.x,this.y,this.z,this.angle,this.segment)}}function fS(n,e,i,s,a){if(e.segment===void 0)return!0;let f=e,m=e.segment+1,y=0;for(;y>-i/2;){if(m--,m<0)return!1;y-=n[m].dist(f),f=n[m]}y+=n[m].dist(n[m+1]),m++;const w=[];let S=0;for(;y<i/2;){const I=n[m],M=n[m+1];if(!M)return!1;let O=n[m-1].angleTo(I)-I.angleTo(M);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:y,angleDelta:O}),S+=O;y-w[0].distance>s;)S-=w.shift().angleDelta;if(S>a)return!1;m++,y+=I.dist(M)}return!0}function pS(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function mS(n,e,i){return n?.6*e*i:0}function gS(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function bD(n,e,i,s,a,f){const m=mS(i,a,f),y=gS(i,s)*f;let w=0;const S=pS(n)/2;for(let I=0;I<n.length-1;I++){const M=n[I],O=n[I+1],L=M.dist(O);if(w+L>S){const F=(S-w)/L,G=vi(M.x,O.x,F),W=vi(M.y,O.y,F),$=new ff(G,W,0,O.angleTo(M),I);return!m||fS(n,$,y,m,e)?$:void 0}w+=L}}function wD(n,e,i,s,a,f,m,y,w){const S=mS(s,f,m),I=gS(s,a),M=I*m,O=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return e-M<e/4&&(e=M+e/4),_S(n,O?e/2*y%e:(I/2+2*f)*m*y%e,e,S,i,M,O,!1,w)}function _S(n,e,i,s,a,f,m,y,w){const S=f/2,I=pS(n);let M=0,O=e-i,L=[];for(let F=0;F<n.length-1;F++){const G=n[F],W=n[F+1],$=G.dist(W),K=W.angleTo(G);for(;O+i<M+$;){O+=i;const te=(O-M)/$,se=vi(G.x,W.x,te),pe=vi(G.y,W.y,te);if(se>=0&&se<w&&pe>=0&&pe<w&&O-S>=0&&O+S<=I){const de=new ff(se,pe,0,K,F);s&&!fS(n,de,f,s,a)||L.push(de)}}M+=$}return y||L.length||m||(L=_S(n,M/2,i,s,a,f,m,!0,w)),L}function yS(n){let e=0,i=0;for(const m of n)e+=m.w*m.h,i=Math.max(i,m.w);n.sort((m,y)=>y.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,f=0;for(const m of n)for(let y=s.length-1;y>=0;y--){const w=s[y];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,f=Math.max(f,m.y+m.h),a=Math.max(a,m.x+m.w),m.w===w.w&&m.h===w.h){const S=s.pop();S&&y<s.length&&(s[y]=S)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(s.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:a,h:f,fill:e/(a*f)||0}}Mt(ff,"Anchor");class Py{static getImagePositionScale(e,i,s){if(i&&e){const{sx:a,sy:f}=e;return{x:a,y:f}}return{x:s,y:s}}constructor(e,i,s,a){this.paddedRect=e;const{pixelRatio:f,version:m,stretchX:y,stretchY:w,content:S,sdf:I,usvg:M}=i;this.pixelRatio=f,this.stretchX=y,this.stretchY=w,this.content=S,this.version=m,this.padding=s,this.sdf=I,this.usvg=M,this.scale=Py.getImagePositionScale(a,M,f)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Rb(n,e,i){const s=Cs.parse(n),a=(function(f,m,y=[1,1]){return{x:0,y:0,w:(f.data?f.data.width:f.width*y[0])+2*m,h:(f.data?f.data.height:f.height*y[1])+2*m}})(e,i,[s.sx,s.sy]);return{bin:a,imagePosition:new Py(a,e,i,s),imageVariant:s}}class vS{constructor(e,i,s){const a=new Map,f=new Map;this.haveRenderCallbacks=[];const m=[];this.addImages(e,a,1,m),this.addImages(i,f,2,m);const{w:y,h:w}=yS(m),S=new Ds({width:y||1,height:w||1});for(const[I,M]of e.entries()){const O=a.get(I).paddedRect;Ds.copy(M.data,S,{x:0,y:0},{x:O.x+1,y:O.y+1},M.data,null,M.sdf)}for(const[I,M]of i.entries()){const O=f.get(I),L=O.paddedRect;let F=O.padding;const G=L.x+F,W=L.y+F,$=M.data.width,K=M.data.height;F=F>1?F-1:F,Ds.copy(M.data,S,{x:0,y:0},{x:G,y:W},M.data,s),Ds.copy(M.data,S,{x:0,y:K-F},{x:G,y:W-F},{width:$,height:F},s),Ds.copy(M.data,S,{x:0,y:0},{x:G,y:W+K},{width:$,height:F},s),Ds.copy(M.data,S,{x:$-F,y:0},{x:G-F,y:W},{width:F,height:K},s),Ds.copy(M.data,S,{x:0,y:0},{x:G+$,y:W},{width:F,height:K},s),Ds.copy(M.data,S,{x:$-F,y:K-F},{x:G-F,y:W-F},{width:F,height:F},s),Ds.copy(M.data,S,{x:0,y:K-F},{x:G+$,y:W-F},{width:F,height:F},s),Ds.copy(M.data,S,{x:0,y:0},{x:G+$,y:W+K},{width:F,height:F},s),Ds.copy(M.data,S,{x:$-F,y:0},{x:G-F,y:W+K},{width:F,height:F},s)}this.lut=s,this.image=S,this.iconPositions=a,this.patternPositions=f}addImages(e,i,s,a){for(const[f,m]of e.entries()){const{bin:y,imagePosition:w,imageVariant:S}=Rb(f,m,s);i.set(f,w),a.push(y),m.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const a of e.getUpdatedImages(s)){for(const f of this.iconPositions.keys()){const m=Cs.parse(f);if(so.isEqual(m.id,a)){const y=e.getImage(a,s);this.patchUpdatedImage(this.iconPositions.get(f),y,i,null)}}for(const f of this.patternPositions.keys()){const m=Cs.parse(f);if(so.isEqual(m.id,a)){const y=e.getImage(a,s);this.patchUpdatedImage(this.patternPositions.get(f),y,i,this.lut)}}}}patchUpdatedImage(e,i,s,a=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[f,m]=e.tl,y=e.sdf;if(this.lut||y){const w={width:i.data.width,height:i.data.height},S=new Ds(w);Ds.copy(i.data,S,{x:0,y:0},{x:0,y:0},w,a,y),s.update(S,{position:{x:f,y:m}})}else s.update(i.data,{position:{x:f,y:m}})}}Mt(Py,"ImagePosition"),Mt(vS,"ImageAtlas");const zy=1e20;function xS(n,e,i,s,a,f,m,y,w){for(let S=e;S<e+s;S++)bS(n,i*f+S,f,a,m,y,w);for(let S=i;S<i+a;S++)bS(n,S*f+e,1,s,m,y,w)}function bS(n,e,i,s,a,f,m){f[0]=0,m[0]=-zy,m[1]=zy,a[0]=n[e];for(let y=1,w=0,S=0;y<s;y++){a[y]=n[e+y*i];const I=y*y;do{const M=f[w];S=(a[y]-a[M]+I-M*M)/(y-M)/2}while(S<=m[w]&&--w>-1);w++,f[w]=y,m[w]=S,m[w+1]=zy}for(let y=0,w=0;y<s;y++){for(;m[w+1]<y;)w++;const S=f[w],I=y-S;n[e+y*i]=a[S]+I*I}}const Mb={none:0,ideographs:1,all:2};class l_{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[],a=this.url||Qr.GLYPHS_URL;for(const f in e)for(const m of e[f])s.push({stack:f,id:m});je(s,({stack:f,id:m},y)=>{let w=this.entries[f];w||(w=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=w.glyphs[m];if(S!==void 0)return void y(null,{stack:f,id:m,glyph:S});if(S=this._tinySDF(w,f,m),S)return w.glyphs[m]=S,void y(null,{stack:f,id:m,glyph:S});const I=Math.floor(m/256);if(256*I>65535)return bi("glyphs > 65535 not supported"),void y(null,{stack:f,id:m,glyph:S});if(w.ranges[I])return void y(null,{stack:f,id:m,glyph:S});let M=w.requests[I];M||(M=w.requests[I]=[],l_.loadGlyphRange(f,I,a,this.requestManager,(O,L)=>{if(L){w.ascender=L.ascender,w.descender=L.descender;for(const F in L.glyphs)this._doesCharSupportLocalGlyph(+F)||(w.glyphs[+F]=L.glyphs[+F]);w.ranges[I]=!0}for(const F of M)F(O,L);delete w.requests[I]})),M.push((O,L)=>{O?y(O):L&&y(null,{stack:f,id:m,glyph:L.glyphs[m]||null})})},(f,m)=>{if(f)i(f);else if(m){const y={};for(const{stack:w,id:S,glyph:I}of m)y[w]===void 0&&(y[w]={}),y[w].glyphs===void 0&&(y[w].glyphs={}),y[w].glyphs[S]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},y[w].ascender=this.entries[w].ascender,y[w].descender=this.entries[w].descender;i(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Mb.none&&(this.localGlyphMode===Mb.all?!!this.localFontFamily:!!this.localFontFamily&&(Yr(e)||Nd(e)||Vc(e)||Iu(e)||zr(e)||Is(e)||(i=e)>=131072&&i<=173791||(s=>s>=66736&&s<=66815)(e)));var i}_tinySDF(e,i,s){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let G="400";/bold/i.test(i)?G="900":/medium/i.test(i)?G="500":/light/i.test(i)&&(G="200"),f=e.tinySDF=new l_.TinySDF({fontFamily:a,fontWeight:G,fontSize:48,buffer:6,radius:16}),f.fontWeight=G}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const m=String.fromCodePoint(s),{data:y,width:w,height:S,glyphWidth:I,glyphHeight:M,glyphLeft:O,glyphTop:L,glyphAdvance:F}=f.draw(m);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new Jc({width:w,height:S},y),metrics:{width:I/2,height:M/2,left:O/2,top:L/2-27,advance:F/2,localGlyph:!0}}}}function wS(n,e){return n+e[1]-e[0]}function Db(n,e,i,s,a=1){const f=[],m=n.imagePrimary,y=m.pixelRatio,w=m.paddedRect.w-2,S=m.paddedRect.h-2,I=(n.right-n.left)*a,M=(n.bottom-n.top)*a,O=m.stretchX||[[0,w]],L=m.stretchY||[[0,S]],F=O.reduce(wS,0),G=L.reduce(wS,0),W=w-F,$=S-G;let K=0,te=F,se=0,pe=G,de=0,be=W,Te=0,ve=$;if(m.content&&s){const ze=m.content;K=_0(O,0,ze[0]),se=_0(L,0,ze[1]),te=_0(O,ze[0],ze[2]),pe=_0(L,ze[1],ze[3]),de=ze[0]-K,Te=ze[1]-se,be=ze[2]-ze[0]-te,ve=ze[3]-ze[1]-pe}const Ce=(ze,it,Je,tt)=>{const dt=y0(ze.stretch-K,te,I,n.left*a),ut=v0(ze.fixed-de,be,ze.stretch,F),ht=y0(it.stretch-se,pe,M,n.top*a),Ye=v0(it.fixed-Te,ve,it.stretch,G),mt=y0(Je.stretch-K,te,I,n.left*a),at=v0(Je.fixed-de,be,Je.stretch,F),_t=y0(tt.stretch-se,pe,M,n.top*a),ft=v0(tt.fixed-Te,ve,tt.stretch,G),$t=new pt(dt,ht),Wt=new pt(mt,ht),Ft=new pt(mt,_t),jt=new pt(dt,_t),di=new pt(ut/y,Ye/y),ni=new pt(at/y,ft/y),qt=e*Math.PI/180;if(qt){const hn=Math.sin(qt),Fr=Math.cos(qt),gn=[Fr,-hn,hn,Fr];$t._matMult(gn),Wt._matMult(gn),jt._matMult(gn),Ft._matMult(gn)}const Ai=ze.stretch+ze.fixed,Xi=Je.stretch+Je.fixed,yn=it.stretch+it.fixed,qi=tt.stretch+tt.fixed,Ln=n.imageSecondary;return{tl:$t,tr:Wt,bl:jt,br:Ft,texPrimary:{x:m.paddedRect.x+1+Ai,y:m.paddedRect.y+1+yn,w:Xi-Ai,h:qi-yn},texSecondary:Ln?{x:Ln.paddedRect.x+1+Ai,y:Ln.paddedRect.y+1+yn,w:Xi-Ai,h:qi-yn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:di,pixelOffsetBR:ni,minFontScaleX:be/y/I,minFontScaleY:ve/y/M,isSDF:i}};if(m.stretchX||m.stretchY){const ze=TS(O,W,F),it=TS(L,$,G);for(let Je=0;Je<ze.length-1;Je++){const tt=ze[Je],dt=ze[Je+1];for(let ut=0;ut<it.length-1;ut++)f.push(Ce(tt,it[ut],dt,it[ut+1]))}}else f.push(Ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:S+1}));return f}function TD(n,e){const i=n.stretchY||[[0,n.paddedRect.h-2]];return n.stretchX||n.stretchY?SS(n.stretchX||[[0,n.paddedRect.w-2]])*SS(i):1}function _0(n,e,i){let s=0;for(const a of n)s+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return s}function TS(n,e,i){const s=[{fixed:-1,stretch:0}];for(const[a,f]of n){const m=s[s.length-1];s.push({fixed:a-m.stretch,stretch:m.stretch}),s.push({fixed:a-m.stretch,stretch:m.stretch+(f-a)})}return s.push({fixed:e+1,stretch:i}),s}function SS(n){return 2*n.length+1}function y0(n,e,i,s){return n/e*i+s}function v0(n,e,i,s){return n-e*i/s}function SD(n,e,i,s){const a=e+n.positionedLines[s].lineOffset;return s===0?i+a/2:i+(a+(e+n.positionedLines[s-1].lineOffset))/2}function ES(n,e,i,s,a,f,m,y,w){const S=[];if(e.positionedLines.length===0)return S;const I=(w!==void 0?w:s.layout.get("text-rotate").evaluate(f,{}))*Math.PI/180,M=(function(W){const $=W[0],K=W[1],te=$*K;return te>0?[$,-K]:te<0?[-$,K]:$===0?[K,$]:[K,-$]})(i);let O=Math.abs(e.top-e.bottom);for(const W of e.positionedLines)O-=W.lineOffset;const L=e.positionedLines.length,F=O/L;let G=e.top-i[1];for(let W=0;W<L;++W){const $=e.positionedLines[W];G=SD(e,F,G,W);for(const K of $.positionedGlyphs){if(!K.rect)continue;const te=K.rect||{};let se=4,pe=!0,de=1,be=0;if(K.image){const Wt=m.get(K.image.toString());if(!Wt)continue;if(Wt.sdf){bi("SDF images are not supported in formatted text and will be ignored.");continue}pe=!1,de=Wt.pixelRatio,se=1/de}const Te=(a||y)&&K.vertical,ve=K.metrics.advance*K.scale/2,Ce=K.metrics,ze=K.rect;if(ze===null)continue;y&&e.verticalizable&&(be=K.image?ve-K.metrics.width*K.scale/2:0);const it=a?[K.x+ve,K.y]:[0,0];let Je=[0,0],tt=[0,0],dt=!1;a||(Te?(tt=[K.x+ve+M[0],K.y+M[1]-be],dt=!0):Je=[K.x+ve+i[0],K.y+i[1]-be]);const ut=ze.w*K.scale/(de*(K.localGlyph?2:1)),ht=ze.h*K.scale/(de*(K.localGlyph?2:1));let Ye,mt,at,_t;if(Te){const Wt=K.y-G,Ft=new pt(-ve,ve-Wt),jt=-Math.PI/2,di=new pt(...tt);Ye=new pt(-ve+Je[0],Je[1]),Ye._rotateAround(jt,Ft)._add(di),Ye.x+=-Wt+ve,Ye.y-=(Ce.left-se)*K.scale;const ni=K.image?Ce.advance*K.scale:Bs*K.scale,qt=String.fromCodePoint(K.glyph);sD(qt)?Ye.x+=(1-se)*K.scale:oD(qt)?Ye.x+=ni-Ce.height*K.scale+(-se-1)*K.scale:Ye.x+=K.image||Ce.width+2*se===ze.w&&Ce.height+2*se===ze.h?(ni-ht)/2:(ni-(Ce.height+2*se)*K.scale)/2,mt=new pt(Ye.x,Ye.y-ut),at=new pt(Ye.x+ht,Ye.y),_t=new pt(Ye.x+ht,Ye.y-ut)}else{const Wt=(Ce.left-se)*K.scale-ve+Je[0],Ft=(-Ce.top-se)*K.scale+Je[1],jt=Wt+ut,di=Ft+ht;Ye=new pt(Wt,Ft),mt=new pt(jt,Ft),at=new pt(Wt,di),_t=new pt(jt,di)}if(I){let Wt;Wt=a?new pt(0,0):dt?new pt(M[0],M[1]):new pt(i[0],i[1]),Ye._rotateAround(I,Wt),mt._rotateAround(I,Wt),at._rotateAround(I,Wt),_t._rotateAround(I,Wt)}const ft=new pt(0,0),$t=new pt(0,0);S.push({tl:Ye,tr:mt,bl:at,br:_t,texPrimary:te,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:it,sectionIndex:K.sectionIndex,isSDF:pe,pixelOffsetTL:ft,pixelOffsetBR:$t,minFontScaleX:0,minFontScaleY:0})}}return S}function ED(n,e=1,i=!1){let s=1/0,a=1/0,f=-1/0,m=-1/0;const y=n[0];for(let L=0;L<y.length;L++){const F=y[L];(!L||F.x<s)&&(s=F.x),(!L||F.y<a)&&(a=F.y),(!L||F.x>f)&&(f=F.x),(!L||F.y>m)&&(m=F.y)}const w=Math.min(f-s,m-a);let S=w/2;const I=new pu([],AD);if(w===0)return new pt(s,a);for(let L=s;L<f;L+=w)for(let F=a;F<m;F+=w)I.push(new c_(L+S,F+S,S,n));let M=(function(L){let F=0,G=0,W=0;const $=L[0];for(let K=0,te=$.length,se=te-1;K<te;se=K++){const pe=$[K],de=$[se],be=pe.x*de.y-de.x*pe.y;G+=(pe.x+de.x)*be,W+=(pe.y+de.y)*be,F+=3*be}return new c_(G/F,W/F,0,L)})(n),O=I.length;for(;I.length;){const L=I.pop();(L.d>M.d||!M.d)&&(M=L,i&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,O)),L.max-M.d<=e||(S=L.h/2,I.push(new c_(L.p.x-S,L.p.y-S,S,n)),I.push(new c_(L.p.x+S,L.p.y-S,S,n)),I.push(new c_(L.p.x-S,L.p.y+S,S,n)),I.push(new c_(L.p.x+S,L.p.y+S,S,n)),O+=4)}return i&&(console.log(`num probes: ${O}`),console.log(`best distance: ${M.d}`)),M.p}function AD(n,e){return e.max-n.max}l_.loadGlyphRange=function(n,e,i,s,a){const f=256*e,m=f+255,y=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${f}-${m}`),es.Glyphs);ou(y,(w,S)=>{if(w)a(w);else if(S){const I={},M=(function(O){return new p0(O).readFields(gD,{})})(S);for(const O of M.glyphs)I[O.id]=O;a(null,{glyphs:I,ascender:M.ascender,descender:M.descender})}})},l_.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:a="sans-serif",fontWeight:f="normal",fontStyle:m="normal",lang:y=null}={}){this.buffer=e,this.cutoff=s,this.radius=i,this.lang=y;const w=this.size=n+4*e,S=this._createCanvas(w),I=this.ctx=S.getContext("2d",{willReadFrequently:!0});I.font=`${m} ${f} ${n}px ${a}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:a,actualBoundingBoxRight:f}=this.ctx.measureText(n),m=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-a))),w=Math.min(this.size-this.buffer,m+Math.ceil(s)),S=y+2*this.buffer,I=w+2*this.buffer,M=Math.max(S*I,0),O=new Uint8ClampedArray(M),L={data:O,width:S,height:I,glyphWidth:y,glyphHeight:w,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(y===0||w===0)return L;const{ctx:F,buffer:G,gridInner:W,gridOuter:$}=this;this.lang&&(F.lang=this.lang),F.clearRect(G,G,y,w),F.fillText(n,G,G+m);const K=F.getImageData(G,G,y,w);$.fill(zy,0,M),W.fill(0,0,M);for(let te=0;te<w;te++)for(let se=0;se<y;se++){const pe=K.data[4*(te*y+se)+3]/255;if(pe===0)continue;const de=(te+G)*S+se+G;if(pe===1)$[de]=0,W[de]=zy;else{const be=.5-pe;$[de]=be>0?be*be:0,W[de]=be<0?be*be:0}}xS($,0,0,S,I,S,this.f,this.v,this.z),xS(W,G,G,y,w,S,this.f,this.v,this.z);for(let te=0;te<M;te++){const se=Math.sqrt($[te])-Math.sqrt(W[te]);O[te]=Math.round(255-255*(se/this.radius+this.cutoff))}return L}};class c_{constructor(e,i,s,a){this.p=new pt(e,i),this.h=s,this.d=(function(f,m){let y=!1,w=1/0;for(let S=0;S<m.length;S++){const I=m[S];for(let M=0,O=I.length,L=O-1;M<O;L=M++){const F=I[M],G=I[L];F.y>f.y!=G.y>f.y&&f.x<(G.x-F.x)*(f.y-F.y)/(G.y-F.y)+F.x&&(y=!y),w=Math.min(w,ju(f,F,G))}}return(y?1:-1)*Math.sqrt(w)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const CD=Object.keys,Ob=Number.POSITIVE_INFINITY,ID=Math.sqrt(2);function wp(n,e,i,s,a){const f=Ab(n)&&n.collisionPadding?n.collisionPadding:[0,0,0,0],m={top:n.top-f[1],bottom:n.bottom+f[3],left:n.left-f[0],right:n.right+f[2],scaled:!1};return s!==void 0&&(function(y,w){y.top*=w,y.bottom*=w,y.left*=w,y.right*=w,y.scaled=!0})(m,s),i&&(function(y,w){if(!w)return;const S=Ni(w),I=new pt(y.left,y.top),M=new pt(y.right,y.top),O=new pt(y.left,y.bottom),L=new pt(y.right,y.bottom),F=new pt(0,0);I._rotateAround(S,F),M._rotateAround(S,F),O._rotateAround(S,F),L._rotateAround(S,F),y.left=Math.min(I.x,M.x,O.x,L.x),y.right=Math.max(I.x,M.x,O.x,L.x),y.top=Math.min(I.y,M.y,O.y,L.y),y.bottom=Math.max(I.y,M.y,O.y,L.y)})(m,i),a&&(m.left+=a[0],m.right+=a[0],m.top+=a[1],m.bottom+=a[1]),e?{top:Math.min(e.top,m.top),bottom:Math.max(e.bottom,m.bottom),left:Math.min(e.left,m.left),right:Math.max(e.right,m.right),scaled:e.scaled||m.scaled}:m}function AS(n,[e,i]){let s=0,a=0;if(i===Ob){e<0&&(e=0);const f=e/ID;switch(n){case"top-right":case"top-left":a=f-7;break;case"bottom-right":case"bottom-left":a=7-f;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(n){case"top-right":case"bottom-right":s=-f;break;case"top-left":case"bottom-left":s=f;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":a=i-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-i}switch(n){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,a]}function RD(n,e,i,s,a,f,m,y,w,S,I,M,O,L,F){const G=n.layers[0],W=G.appearances;if(W.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const $={iconBBox:null,iconVerticalBBox:null},K={textBBox:null,textVerticalBBox:null},{baseIconRotate:te,baseTextRotate:se,iconScaleFactor:pe}=(function(be,Te,ve){const Ce=be.get("icon-rotate").evaluate(Te,{},ve),ze=be.get("text-rotate").evaluate(Te,{},ve),[it,Je]=be.get("icon-size-scale-range");return{baseIconRotate:Ce,baseTextRotate:ze,iconScaleFactor:_e(1,it,Je)}})(s,a,f);e&&($.iconBBox=wp(e,$.iconBBox,te,m),i)&&($.iconVerticalBBox=wp(i,$.iconVerticalBBox,te+90,m));const de=b0(M.horizontal);de&&(K.textBBox=wp(de,K.textBBox,se,1,L)),M.vertical&&(K.textVerticalBBox=wp(M.vertical,K.textVerticalBBox,se+90,1,L));for(const be of W)be.hasIconProperties()&&MD($,n,G,be,a,f,y,te,m,w,e,S,pe,I,F),be.hasTextProperties()&&DD(K,G,be,a,f,L,se,O,de,M.vertical);return{iconBBox:$.iconBBox,iconVerticalBBox:$.iconVerticalBBox,textBBox:K.textBBox,textVerticalBBox:K.textVerticalBBox}}function MD(n,e,i,s,a,f,m,y,w,S,I,M,O,L,F){const{appearanceIconOffset:G,appearanceIconRotate:W,appearanceIconSize:$}=CS(s,i,a,f,m,y,w,S.iconScaleFactor);let K=null,te=null,se=null;s.hasProperty("icon-image")?se=(function(pe,de,be,Te,ve,Ce,ze,it){let Je=null;const tt=de.getAppearanceValueAndResolveTokens(be,"icon-image",Te,ve,it);if(tt){const dt=pe.getResolvedImageFromTokens(tt),ut=be.getUnevaluatedProperty("icon-size"),ht=Ly(dt,Km(pe.zoom,ut,pe.worldview,it),ut,ve,pe.zoom,Te,pe.pixelRatio,ze,pe.worldview,it);Je=Ce.get(ht.iconPrimary.toString())}return Je})(e,i,s,a,f,M,O,F):I&&(se=I.imagePrimary),se&&(K=g0(se,null,G,L),e.allowVerticalPlacement&&(te=g0(se,null,G,L))),K&&(n.iconBBox=wp(K,n.iconBBox,W,$)),te&&(n.iconVerticalBBox=wp(te,n.iconVerticalBBox,W+90,$))}function CS(n,e,i,s,a,f,m,y){const w=n.hasProperty("icon-offset")?e.getAppearanceValueAndResolveTokens(n,"icon-offset",i,s,[]):null,S=w&&Array.isArray(w)?w:a,I=n.hasProperty("icon-rotate")?e.getAppearanceValueAndResolveTokens(n,"icon-rotate",i,s,[]):null,M=typeof I=="number"?I:f,O=n.hasProperty("icon-size")?e.getAppearanceValueAndResolveTokens(n,"icon-size",i,s,[]):null;return{appearanceIconOffset:S,appearanceIconRotate:M,appearanceIconSize:typeof O=="number"?O*y:m}}function DD(n,e,i,s,a,f,m,y,w,S){const{appearanceTextOffset:I,appearanceTextRotate:M,appearanceTextSize:O}=IS(i,e,s,a,f,m,y),L=O/y;w&&(n.textBBox=wp(w,n.textBBox,M,L,I)),S&&(n.textVerticalBBox=wp(S,n.textVerticalBBox,M+90,L,I))}function IS(n,e,i,s,a,f,m){const y=n.hasProperty("text-offset")?e.getAppearanceValueAndResolveTokens(n,"text-offset",i,s,[]):null,w=y&&Array.isArray(y)?[y[0]*Bs,y[1]*Bs]:a,S=n.hasProperty("text-rotate")?e.getAppearanceValueAndResolveTokens(n,"text-rotate",i,s,[]):null,I=typeof S=="number"?S:f,M=n.hasProperty("text-size")?e.getAppearanceValueAndResolveTokens(n,"text-size",i,s,[]):null;return{appearanceTextOffset:w,appearanceTextRotate:I,appearanceTextSize:typeof M=="number"?M:m}}function x0(n,e,i,s,a,f,m,y,w){if(!e||!e.usvg)return;const S=dS(s),I=dS(a),M=f!=="both"&&f!=="width"||!uS(s)?1:I.width/S.width,O=f!=="both"&&f!=="height"||!hS(s)?1:I.height/S.height;i.scaleSelf(M,O);const L=i.toString();m.set(L,i),y.set(L,e);const{imagePosition:F}=Rb(L,e,1);w.set(L,F)}function RS(n,e,i,s,a,f,m,y,w,S){if(!n)return;const I=(function(M,O,L,F,G,W,$){if(M.kind==="camera")return M.maxSize;if(M.kind==="composite"){const K=O.possiblyEvaluate(new bn(M.maxZoom,{worldview:W}),L,$).evaluate(G,{},L,$),te=O.possiblyEvaluate(new bn(M.minZoom,{worldview:W}),L,$).evaluate(G,{},L,$);return Math.max(K,te)}return O.possiblyEvaluate(new bn(F,{worldview:W}),L,$).evaluate(G,{},L,$)})(e,i,s,a,f,w,S);return n.scaleSelf(I*y*m)}function Ly(n,e,i,s,a,f,m,y,w,S){return{iconPrimary:RS(n.getPrimary(),e,i,s,a,f,m,y,w,S),iconSecondary:RS(n.getSecondary(),e,i,s,a,f,m,y,w,S)}}function OD(n,e,i){if(!e)return;const s=i.get(n.toString()),a=i.get(e.toString());s&&a&&(s.paddedRect.w===a.paddedRect.w&&s.paddedRect.h===a.paddedRect.h||bi(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),s.usvg!==a.usvg&&bi(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function MS(n,e,i,s){if(!n)return;const a=e.get(i.toString());if(n.imagePrimary=a,s){const f=e.get(s.toString());n.imageSecondary=f}}function PD(n,e){for(const i in n.horizontal)DS(n.horizontal[i],e);DS(n.vertical,e)}function DS(n,e){if(n){for(const i of n.positionedLines)for(const s of i.positionedGlyphs)if(s.image!==null){const a=s.image.toString();s.rect=e.get(a).paddedRect}}}function Pb(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zD(n,e,i,s,a,f,m,y,w){const S=b0(f.horizontal)||f.vertical,I=i.get("icon-text-fit-padding").evaluate(s,{},a);let M,O=e;return e&&w!=="none"&&(n.allowVerticalPlacement&&f.vertical&&(M=Cb(e,f.vertical,w,I,y,m)),S&&(O=Cb(e,S,w,I,y,m))),{defaultShapedIcon:O,verticallyShapedIcon:M}}function OS(n,e){return n*e/24}function LD(n,e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W,$,K,te,se,pe,de,be){let Te=m.textMaxSize.evaluate(e,{},O);Te===void 0?Te=y*m.textScaleFactor:Te*=m.textScaleFactor;const ve=n.layers[0].layout,Ce=OS(y,m.textScaleFactor),ze=b0(i.horizontal)||i.vertical,it=n.hasAnyAppearanceProperty(["text-size","text-offset","text-rotate"]);if((W!=="none"||it)&&n.appearanceFeatureData&&n.featureToAppearanceIndex[e.index]<n.appearanceFeatureData.length){const Ft=n.appearanceFeatureData[n.featureToAppearanceIndex[e.index]];Ft&&(Ft.textShaping=ze,Ft.iconTextFitPadding=ve.get("icon-text-fit-padding").evaluate(e,{},O),Ft.fontScale=Ce,Ft.textScaleFactor=m.textScaleFactor)}const Je=L.name==="globe",tt=n.tilePixelRatio*Te/24,dt=(_t=n.overscaling,n.zoom>18&&_t>2&&(_t>>=1),Math.max(zt/(512*_t),1)*ve.get("symbol-spacing")),ut=ve.get("text-padding")*n.tilePixelRatio,ht=ve.get("icon-padding")*n.tilePixelRatio,Ye=Ni(ve.get("text-max-angle")),mt=ve.get("icon-rotation-alignment")==="map"&&te!=="point",at=dt/2;var _t;n.hasAnyIconTextFit===!1&&W!=="none"&&(n.hasAnyIconTextFit=!0);const ft=e.properties?+e.properties[tn]:null,$t=ft&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(ft):65535,Wt=(Ft,jt,di)=>{if(jt.x<0||jt.x>=zt||jt.y<0||jt.y>=zt)return;let ni=null;if(Je){const{x:qt,y:Ai,z:Xi}=L.projectTilePoint(jt.x,jt.y,di);ni={anchor:new ff(qt,Ai,Xi,0,void 0),up:L.upVector(di,jt.x,jt.y)}}(function(qt,Ai,Xi,yn,qi,Ln,hn,Fr,gn,Pn,sr,pr,mr,Nr,Ks,Eo,ls,_s,Os,Gi,gr,Ir,pl,ca,Js,ua,td,Go,F0,g_,Ta,N0){const id=qt.addToLineVertexArray(Ai,yn);let pf,Ep,vc,nu,Ky,__,Hi,Fs=0,jr=0,ys=0,xc=0,Ua=-1,ml=-1;const Ns={};let Jy=xl("");const nd=Xi?Xi.anchor:Ai,cs=Go!=="none";let Qs=0,vs=0;if(gn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const eo=gn.layout.get("text-offset").evaluate(gr,{},Js);Qs=eo[0]*Bs,vs=eo[1]*Bs}else Qs=gn.layout.get("text-radial-offset").evaluate(gr,{},Js)*Bs,vs=Ob;if(qt.allowVerticalPlacement&&qi.vertical){const eo=qi.vertical;if(Ks)__=kb(eo),Fr&&(Hi=kb(Fr));else{const Va=gn.layout.get("text-rotate").evaluate(gr,{},Js)+90;vc=w0(Pn,nd,Ai,sr,pr,mr,eo,Nr,Va,Eo,N0),Fr&&(nu=w0(Pn,nd,Ai,sr,pr,mr,Fr,_s,Va,null,Ta))}}if(Ln){const eo=gn.layout.get("icon-rotate").evaluate(gr,{},Js),Va=Db(Ln,eo,pl,cs,Ir.iconScaleFactor),ru=Fr?Db(Fr,eo,pl,cs,Ir.iconScaleFactor):void 0;Ep=w0(Pn,nd,Ai,sr,pr,mr,Ln,_s,eo,null,g_);const rd=(function(Xu,ZO,YE,WO,KE,JE,XO,k4,sw){const QE=Xu.layers[0],e2=QE.appearances;let v_=ZO.length;if(YE&&(v_=Math.max(v_,YE.length)),e2.length===0)return v_;const[YO,KO]=WO.get("icon-size-scale-range"),JO=_e(1,YO,KO);for(const t2 of e2){const i2=t2.getUnevaluatedProperties();if(i2._values["icon-image"].value!==void 0){const n2=QE.getAppearanceValueAndResolveTokens(t2,"icon-image",KE,JE,sw);if(n2){const r2=Xu.getResolvedImageFromTokens(n2);if(r2){const s2=i2._values["icon-size"],QO=Ly(r2,Km(Xu.zoom,s2,Xu.worldview,sw),s2,JE,Xu.zoom,KE,Xu.pixelRatio,JO,Xu.worldview,sw),eP=XO.get(QO.iconPrimary.toString());v_=Math.max(v_,TD(eP))}}}}return v_})(qt,Va,ru,gn.layout,gr,Js,qt.iconAtlasPositions,0,ca);Fs=4*rd;const nw=gn.layout.get("icon-size").evaluate(gr,{},Js,ca),rw=Ir.compositeIconSizes?Ir.compositeIconSizes[0].evaluate(gr,{},Js,ca):0,Qy=Ir.compositeIconSizes?Ir.compositeIconSizes[1].evaluate(gr,{},Js,ca):0,y_=Lb(qt.layerIds[0],qt.iconSizeData,nw,Ir.iconScaleFactor,rw,Qy);qt.addSymbols(qt.icon,Va,y_,Gi,Os,gr,void 0,Xi,Ai,id.lineStartIndex,id.lineLength,-1,ca,Js,ua,td,qt.symbolInstances.length,rd),Ua=qt.icon.placedSymbolArray.length-1,ru&&(jr=4*rd,qt.addSymbols(qt.icon,ru,y_,Gi,Os,gr,fl.vertical,Xi,Ai,id.lineStartIndex,id.lineLength,-1,ca,Js,ua,td,qt.symbolInstances.length,rd),ml=qt.icon.placedSymbolArray.length-1)}for(const eo in qi.horizontal){const Va=eo,ru=qi.horizontal[Va];pf||(Jy=xl(ru.text),Ks?Ky=kb(ru):pf=w0(Pn,nd,Ai,sr,pr,mr,ru,Nr,gn.layout.get("text-rotate").evaluate(gr,{},Js),Eo,N0));const rd=ru.positionedLines.length===1;if(ys+=PS(qt,Xi,Ai,ru,hn,gn,Ks,gr,Eo,id,qi.vertical?fl.horizontal:fl.horizontalOnly,rd?CD(qi.horizontal):[Va],Ns,Ua,Ir,ca,Js,qt.symbolInstances.length,ua),rd)break}qi.vertical&&(xc+=PS(qt,Xi,Ai,qi.vertical,hn,gn,Ks,gr,Eo,id,fl.vertical,["vertical"],Ns,ml,Ir,ca,Js,qt.symbolInstances.length,ua));let qo=-1;const Ho=(eo,Va)=>eo?Math.max(eo,Va):Va;qo=Ho(Ky,qo),qo=Ho(__,qo),qo=Ho(Hi,qo);const Ap=qo>-1?1:0;qt.glyphOffsetArray.length>=65535&&bi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),gr.sortKey!==void 0&&qt.addToSortKeyRanges(qt.symbolInstances.length,gr.sortKey),qt.symbolInstances.emplaceBack(Ai.x,Ai.y,nd.x,nd.y,nd.z,Ns.right>=0?Ns.right:-1,Ns.center>=0?Ns.center:-1,Ns.left>=0?Ns.left:-1,Ns.vertical>=0?Ns.vertical:-1,Ua,ml,Jy,pf!==void 0?pf:qt.collisionBoxArray.length,pf!==void 0?pf+1:qt.collisionBoxArray.length,vc!==void 0?vc:qt.collisionBoxArray.length,vc!==void 0?vc+1:qt.collisionBoxArray.length,Ep!==void 0?Ep:qt.collisionBoxArray.length,Ep!==void 0?Ep+1:qt.collisionBoxArray.length,nu||qt.collisionBoxArray.length,nu?nu+1:qt.collisionBoxArray.length,sr,ys,xc,Fs,jr,Ap,0,Qs,vs,qo,0,cs?1:0,F0)})(n,jt,ni,Ft,i,s,f,a,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,ut,K,S,0,ht,mt,$,e,m,I,M,O,F,G,W,$t,se,pe,de)};if(te==="line")for(const Ft of n0(e.geometry,0,0,zt,zt)){const jt=wD(Ft,dt,Ye,i.vertical||ze,s,24,tt,n.overscaling,zt);for(const di of jt)ze&&kD(n,ze.text,at,di)||Wt(Ft,di,O)}else if(te==="line-center"){for(const Ft of e.geometry)if(Ft.length>1){const jt=bD(Ft,Ye,i.vertical||ze,s,24,tt);jt&&Wt(Ft,jt,O)}}else if(e.type==="Polygon")for(const Ft of jm(e.geometry,0)){const jt=ED(Ft,16);Wt(Ft[0],new ff(jt.x,jt.y,0,0,void 0),O)}else if(e.type==="LineString")for(const Ft of e.geometry)Wt(Ft,new ff(Ft[0].x,Ft[0].y,0,0,void 0),O);else if(e.type==="Point")for(const Ft of e.geometry)for(const jt of Ft)Wt([jt],new ff(jt.x,jt.y,0,0,void 0),O)}const zb=255,Jm=zb*df;function PS(n,e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W,$,K){const te=ES(0,s,w,f,m,y,a,n.allowVerticalPlacement,void 0),se=f.layout.get("text-size").evaluate(y,{},W),pe=F.compositeTextSizes?F.compositeTextSizes[0].evaluate(y,{},W):0,de=F.compositeTextSizes?F.compositeTextSizes[1].evaluate(y,{},W):0,be=Lb(n.layerIds[0],n.textSizeData,se,F.textScaleFactor,pe,de);n.addSymbols(n.text,te,be,w,m,y,I,e,i,S.lineStartIndex,S.lineLength,L,G,W,K,!1,$,te.length);for(const Te of M)O[Te]=n.text.placedSymbolArray.length-1;return 4*te.length}function Lb(n,e,i,s,a,f){const m=e;let y=null;return m.kind==="source"?(y=[df*i*s],y[0]>Jm&&bi(`${n}: Value for "text-size" is >= ${zb}. Reduce your "text-size".`)):m.kind==="composite"&&(y=[df*a*s,df*f*s],(y[0]>Jm||y[1]>Jm)&&bi(`${n}: Value for "text-size" is >= ${zb}. Reduce your "text-size".`)),y}function b0(n){for(const e in n)return n[e];return null}function w0(n,e,i,s,a,f,m,y,w,S,I){let M,O,L,F;if(M=I?I.top:m.top,O=I?I.bottom:m.bottom,L=I?I.left:m.left,F=I?I.right:m.right,Ab(m)&&m.collisionPadding){const G=m.collisionPadding;L-=G[0],M-=G[1],F+=G[2],O+=G[3]}if(w){const G=new pt(L,M),W=new pt(F,M),$=new pt(L,O),K=new pt(F,O),te=Ni(w);let se=new pt(0,0);S&&(se=new pt(S[0],S[1])),G._rotateAround(te,se),W._rotateAround(te,se),$._rotateAround(te,se),K._rotateAround(te,se),L=Math.min(G.x,W.x,$.x,K.x),F=Math.max(G.x,W.x,$.x,K.x),M=Math.min(G.y,W.y,$.y,K.y),O=Math.max(G.y,W.y,$.y,K.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,L,M,F,O,y,s,a,f),n.length-1}function kb(n){Ab(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function kD(n,e,i,s){const a=n.compareText;if(e in a){const f=a[e];for(let m=f.length-1;m>=0;m--)if(s.dist(f[m])<i)return!0}else a[e]=[];return a[e].push(s),!1}function zS(n,e){const i=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,a=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),f=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let m=Math.sin(n._pitch)*f+a;const y=a*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let w=Math.max(n.zoom-17,0);n.isOrthographic&&(w/=10),m*=1+w}return Math.min(1.01*m,y)}function ky(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),s=n.x*i,a=(n.x+1)*i,f=n.y*i,m=(n.y+1)*i,y=Qe(s),w=Qe(a),S=ct(f),I=ct(m),M=e.project(y,S),O=e.project(w,S),L=e.project(w,I),F=e.project(y,I);let G=Math.min(M.x,O.x,L.x,F.x),W=Math.min(M.y,O.y,L.y,F.y),$=Math.max(M.x,O.x,L.x,F.x),K=Math.max(M.y,O.y,L.y,F.y);const te=i/16;function se(de,be,Te,ve,Ce,ze){const it=(Te+Ce)/2,Je=(ve+ze)/2,tt=e.project(Qe(it),ct(Je)),dt=Math.max(0,G-tt.x,W-tt.y,tt.x-$,tt.y-K);G=Math.min(G,tt.x),$=Math.max($,tt.x),W=Math.min(W,tt.y),K=Math.max(K,tt.y),dt>te&&(se(de,tt,Te,ve,it,Je),se(tt,be,it,Je,Ce,ze))}se(M,O,s,f,a,f),se(O,L,a,f,a,m),se(L,F,a,m,s,m),se(F,M,s,m,s,f),G-=te,W-=te,$+=te,K+=te;const pe=1/Math.max($-G,K-W);return{scale:pe,x:G*pe,y:W*pe,x2:$*pe,y2:K*pe,projection:e}}function LS(n,{x:e,y:i},s=0){return new pt(((e-s)*n.scale-n.x)*zt,(i*n.scale-n.y)*zt)}const BD=Re(new Float32Array(16));class Tp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new fe(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s,a=!0){return e._coordinatePoint(e.locationCoordinate(i,s),a)}pixelsPerMeter(e,i){return Ve(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return zS(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,a){const f=e.horizonLineFromTop(!1),m=new pt(i,Math.max(f,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,a))}pointCoordinate3D(e,i,s){const a=new pt(i,s);if(e.elevation)return e.elevation.pointCoordinate(a);{const f=this.pointCoordinate(e,a.x,a.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return BD}createTileMatrix(e,i,s){let a,f,m;const y=s.canonical,w=Re(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=ky(y,this);a=1,f=S.x+s.wrap*S.scale,m=S.y,rt(w,w,[a/S.scale,a/S.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*s.wrap)*a,m=y.y*a;return Ue(w,w,[f,m,0]),rt(w,w,[a/zt,a/zt,1]),w}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class FD extends Tp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(Ni(i));this.n=(a+Math.sin(Ni(s)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:a,r0:f}=this,m=Ni(e-this.center[0]),y=Ni(i),w=Math.sqrt(a-2*s*Math.sin(y))/s;return{x:w*Math.sin(m*s),y:w*Math.cos(m*s)-f,z:0}}unproject(e,i){const{n:s,c:a,r0:f}=this,m=f+i;let y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*s<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));const w=Ni(this.center[0])*s;y=We(y,-Math.PI-w,Math.PI-w);const S=_e(Le(y/s)+this.center[0],-180,180),I=Math.asin(_e((a-(e*e+m*m)*s*s)/(2*s),-1,1)),M=_e(Le(I),-85.051129,Oe);return new fe(S,M)}}const By=1.340264,Fy=-.081106,Ny=893e-6,jy=.003796,T0=Math.sqrt(3)/2;class ND extends Tp{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(T0*Math.sin(i)),a=s*s,f=a*a*a;return{x:.5*(e*Math.cos(s)/(T0*(By+3*Fy*a+f*(7*Ny+9*jy*a)))/Math.PI+.5),y:1-.5*(s*(By+Fy*a+f*(Ny+jy*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,a=s*s,f=a*a*a;for(let I,M,O,L=0;L<12&&(M=s*(By+Fy*a+f*(Ny+jy*a))-i,O=By+3*Fy*a+f*(7*Ny+9*jy*a),I=M/O,s=_e(s-I,-Math.PI/3,Math.PI/3),a=s*s,f=a*a*a,!(Math.abs(I)<1e-12));++L);const m=T0*e*(By+3*Fy*a+f*(7*Ny+9*jy*a))/Math.cos(s),y=Math.asin(Math.sin(s)/T0),w=_e(180*m/Math.PI,-180,180),S=_e(180*y/Math.PI,-85.051129,Oe);return new fe(w,S)}}class jD extends Tp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),a=_e(360*(.5-i),-85.051129,Oe);return new fe(s,a)}}const u_=Math.PI/2;function S0(n){return Math.tan((u_+n)/2)}class UD extends Tp{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let a=Ni(i),f=Ni(s);this.southernCenter=a+f<0,this.southernCenter&&(a=-a,f=-f);const m=Math.cos(a),y=S0(a);this.n=a===f?Math.sin(a):Math.log(m/Math.cos(f))/Math.log(S0(f)/y),this.f=m*Math.pow(S0(a),this.n)/this.n}project(e,i){i=Ni(i),this.southernCenter&&(i=-i),e=Ni(e-this.center[0]);const s=1e-6,{n:a,f}=this;f>0?i<-u_+s&&(i=-u_+s):i>u_-s&&(i=u_-s);const m=f/Math.pow(S0(i),a);let y=m*Math.sin(a*e),w=f-m*Math.cos(a*e);return y=.5*(y/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:y,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:a}=this,f=a-i,m=Math.sign(f),y=Math.sign(s)*Math.sqrt(e*e+f*f);let w=Math.atan2(e,Math.abs(f))*m;f*s<0&&(w-=Math.PI*Math.sign(e)*m);const S=_e(Le(w/s)+this.center[0],-180,180),I=_e(Le(2*Math.atan(Math.pow(a/y,1/s))-u_),-85.051129,Oe);return new fe(S,this.southernCenter?-I:I)}}class kS extends Tp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Be(e),y:He(i),z:0}}unproject(e,i){const s=Qe(e),a=ct(i);return new fe(s,a)}}const BS=Ni(Oe);class VD extends Tp{project(e,i){const s=(i=Ni(i))*i,a=s*s;return{x:.5*((e=Ni(e))*(.8707-.131979*s+a*(a*(.003971*s-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+a*(.028874*s-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,a=25,f=0,m=s*s;do{m=s*s;const S=m*m;f=(s*(1.007226+m*(.015085+S*(.028874*m-.044475-.005916*S)))-i)/(1.007226+m*(.045255+S*(.259866*m-.311325-.005916*11*S))),s=_e(s-f,-BS,BS)}while(Math.abs(f)>1e-6&&--a>0);m=s*s;const y=_e(Le(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),w=Le(s);return new fe(y,w)}}const FS=Ni(Oe);class GD extends Tp{project(e,i){i=Ni(i),e=Ni(e);const s=Math.cos(i),a=2/Math.PI,f=Math.acos(s*Math.cos(e/2)),m=Math.sin(f)/f,y=.5*(e*a+2*s*Math.sin(e/2)/m)||0,w=.5*(i+Math.sin(i)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,f=25;const m=1e-6;let y=0,w=0;do{const S=Math.cos(a),I=Math.sin(a),M=2*I*S,O=I*I,L=S*S,F=Math.cos(s/2),G=Math.sin(s/2),W=2*F*G,$=G*G,K=1-L*F*F,te=K?1/K:0,se=K?Math.acos(S*F)*Math.sqrt(1/K):0,pe=.5*(2*se*S*G+2*s/Math.PI)-e,de=.5*(se*I+a)-i,be=.5*te*(L*$+se*S*F*O)+1/Math.PI,Te=te*(W*M/4-se*I*G),ve=.125*te*(M*G-se*I*L*W),Ce=.5*te*(O*F+se*$*S)+.5,ze=Te*ve-Ce*be;y=(de*Te-pe*Ce)/ze,w=(pe*ve-de*be)/ze,s=_e(s-y,-Math.PI,Math.PI),a=_e(a-w,-FS,FS)}while((Math.abs(y)>m||Math.abs(w)>m)&&--f>0);return new fe(Le(s),Le(a))}}class NS extends Tp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ni(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:a}=this;return{x:Ni(e)*a*s+.5,y:-Math.sin(Ni(i))/a*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:a}=this,f=-(i-.5)/s,m=_e(Le((e-.5)/s)/a,-180,180),y=Math.asin(_e(f*a,-1,1)),w=_e(Le(y),-85.051129,Oe);return new fe(m,w)}}class qD extends kS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const a=Rm(e,i,s);return vn(a,a,Mm(gc(s))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i,s){const a=xe(i.lat,i.lng),f=fi([],a),m=s?e._centerAltitude+s:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Gt(a,a,f,Ve(1,0)*zt*m);const y=Re(new Float64Array(16));return Ge(y,e.pixelMatrix,e.globeMatrix),vn(a,a,y),new pt(a[0],a[1])}pixelsPerMeter(e,i){return Ve(1,0)*i}pixelSpaceConversion(e,i,s){const a=Ve(1,e)*i,f=vi(Ve(1,45)*i,a,s);return this.pixelsPerMeter(e,i)/f}createTileMatrix(e,i,s){const a=$n(gc(s.canonical));return Ge(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){const{center:s}=e,a=Mm(gc(i));return Bt(a,a,Ni(s.lng)),Pt(a,a,Ni(s.lat)),rt(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,s,a){return ey(e,i,s,!0)||new kt(0,0)}pointCoordinate3D(e,i,s){const a=this.pointCoordinate(e,i,s,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!ey(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(a,f){const m=a.cameraToCenterDistance,y=a._centerAltitude*f,w=a._camera,S=a._camera.forward(),I=yt([],bt([],S,-m),[0,0,y]),M=a.worldSize/(2*Math.PI),O=[0,0,-M],L=a.width/a.height,F=Math.tan(a.fovAboveCenter),G=bt([],w.up(),F),W=bt([],w.right(),F*L),$=fi([],yt([],yt([],S,G),W)),K=[];let te;if(new Bn(I,$).closestPointOnSphere(O,M,K)){const se=yt([],K,O),pe=Cn([],se,I);te=Math.cos(a.fovAboveCenter)*Si(pe)}else{const se=Cn([],I,O),pe=Cn([],O,I);fi(pe,pe);const de=Si(se)-M;te=Math.sqrt(de*(de+2*M));const be=Math.acos(te/(M+de))-Math.acos(Ri(S,pe));te*=Math.cos(be)}return 1.01*te})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Vu(e.zoom);if(s>0){const a=zS(e,Ve(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return vi(i,a+f*(1-Math.cos(m)),Math.pow(s,10))}return i}upVector(e,i,s){return Rm(i,s,e,1)}upVectorScale(e){return{metersToTile:Cm(Yh(gc(e)))}}}function jS(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new kS(n);case"equirectangular":return new jD(n);case"naturalEarth":return new VD(n);case"equalEarth":return new ND(n);case"winkelTripel":return new GD(n);case"albers":return i?new NS(n):new FD(n);case"lambertConformalConic":return i?new NS(n):new UD(n);case"globe":return new qD(n)}throw new Error(`Invalid projection name: ${n.name}`)}const HD=Zi.types,$D=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Uy(n,e,i,s,a,f,m,y,w,S,I,M,O){const L=y?Math.min(Jm,Math.round(y[0])):0,F=y?Math.min(Jm,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*s),Math.round(32*a),f,m,(L<<1)+(w?1:0),0+(F<<1),16*S,16*I,256*M,256*O)}function Vy(n,e,i){n.emplaceBack(e,i)}function Gy(n,e,i,s,a,f,m){n.emplaceBack(e,i,s,a,f,m)}const E0=(n,e,i,s)=>{for(let a=0;a<e;a++)n.emplaceBack(i[0],i[1],i[2],s[0],s[1],s[2])};function h_(n,e,i,s,a){n.emplaceBack(e,i,s,a),n.emplaceBack(e,i,s,a),n.emplaceBack(e,i,s,a),n.emplaceBack(e,i,s,a)}function ZD(n){for(const e of n.sections)if(zl(e.text))return!0;return!1}class Bb{constructor(e){this.layoutVertexArray=new zu,this.indexArray=new Kr,this.programConfigurations=e,this.segments=new Wn,this.dynamicLayoutVertexArray=new ol,this.opacityVertexArray=new rp,this.placedSymbolArray=new tf,this.iconTransitioningVertexArray=new xa,this.globeExtVertexArray=new np,this.zOffsetVertexArray=new ms,this.orientationVertexArray=new Fh,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getSymbolVertexData(e,i){const s=[],a=this.layoutVertexArray.uint16;for(let f=0;f<i;++f){const m=12*(e+f);s.push(...a.slice(m,m+12))}return s}updateSymbolVertexData(e,i,s,a,f,m,y,w,S,I,M,O,L){const F=this.layoutVertexArray.uint16,G=12*e;F[G]=i,F[G+1]=s,F[G+2]=a,F[G+3]=f,F[G+4]=m,F[G+5]=y,F[G+6]=w,F[G+7]=S,F[G+8]=I,F[G+9]=M,F[G+10]=O,F[G+11]=L}upload(e,i,s,a,f,m){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XM.members,!!m),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,KM.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,$D,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,eD.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,YM.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,JM.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,QM.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Mt(Bb,"SymbolBuffers");class Fb{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new Wn,this.collisionVertexArray=new Jd,this.collisionVertexArrayExt=new ol}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,tD.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,iD.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Mt(Fb,"CollisionBuffers");class A0{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Re([]),this.placementViewportMatrix=Re([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=Km(this.zoom,i["text-size"],this.worldview,e.availableImages),this.iconSizeData=Km(this.zoom,i["icon-size"],this.worldview,e.availableImages);const s=this.layers[0].layout,a=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.lut=e.lut,this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(m=>fl[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();if(!i||i.length===0)return!1;const s=Array.isArray(e)?e:[e];return i.some(a=>s.some(f=>a.getProperty(f)!=null))}createArrays(){this.text=new Bb(new z(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Bb(new z(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new nf,this.lineVertexArray=new Bg,this.symbolInstances=new qr}calculateGlyphDependencies(e,i,s,a,f){for(const m of e){const y=m.codePointAt(0);if(y===void 0)break;if(i[y]=!0,a&&f&&y<=65535){const w=Dy[m];w&&(i[w.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,s,a,f,m,y){if(!e.hasProperty("icon-size"))return y*m;let w=1;const S=e.getUnevaluatedProperties()._values["icon-size"],I=Km(this.zoom,S,this.worldview,f),M=a_(I,i);if(I.kind!=="constant"&&I.kind!=="camera"||(w=M.uSize),I.kind==="composite"){const{minZoom:O,maxZoom:L}=I,F=S.possiblyEvaluate(new bn(O,{worldview:this.worldview}),a),G=S.possiblyEvaluate(new bn(L,{worldview:this.worldview}),a),W=F.evaluate(s,{},a,f);w=W+(G.evaluate(s,{},a,f)-W)*M.uSizeT}return I.kind==="source"&&(w=S.possiblyEvaluate(new bn(this.zoom,{worldview:this.worldview}),a).evaluate(s,{},a,f)),w*m}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!l(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?Oo.build(e):e}populate(e,i,s,a){const f=this.layers[0],m=f.layout,y=this.projection.name==="globe",w=m.get("text-font"),S=m.get("text-field"),I=m.get("icon-image"),[M,O]=m.get("icon-size-scale-range"),L=_e(i.scaleFactor||1,M,O),F=(S.value.kind!=="constant"||S.value.value instanceof $s&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),G=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,W=this.hasAnyAppearanceProperty("icon-image"),$=m.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!F&&!G&&!W)return;const K=i.iconDependencies,te=i.glyphDependencies,se=i.availableImages,pe=new bn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),de=be=>{const Te=be.id.toString();K.has(Te)?K.get(Te).push(be):K.set(Te,[be])};for(const be of e){const{feature:Te,id:ve,index:Ce,sourceLayerIndex:ze}=be,it=f._featureFilter.needGeometry,Je=Pi(Te,it);if(!f._featureFilter.filter(pe,Je,s))continue;if(it||(Je.geometry=_i(Te,s,a)),y&&Te.type!==1&&s.z<=5){const _t=Je.geometry,ft=.98078528056,$t=(Wt,Ft)=>Ri(Rm(Wt.x,Wt.y,s,1),Rm(Ft.x,Ft.y,s,1))<ft;for(let Wt=0;Wt<_t.length;Wt++)_t[Wt]=Yt(_t[Wt],$t)}let tt,dt;if(F){const _t=f.getValueAndResolveTokens("text-field",Je,s,se),ft=$s.factory(_t);ZD(ft)&&(this.hasRTLText=!0),(!this.hasRTLText||qc()==="unavailable"||this.hasRTLText&&na.isParsed())&&(tt=rD(ft,f,Je))}if(G){const _t=f.getValueAndResolveTokens("icon-image",Je,s,se);dt=this.getResolvedImageFromTokens(_t)}const ut=this.layers[0];let ht=!1;if(!dt&&W){const _t=ut.getAppearances();for(const ft of _t)if(ft.getProperty("icon-image")){const $t=ut.getAppearanceValueAndResolveTokens(ft,"icon-image",Je,s,se);if($t){dt=this.getResolvedImageFromTokens($t),ht=!0;break}}}if(!tt&&!dt)continue;const Ye=this.sortFeaturesByKey?$.evaluate(Je,{},s):void 0,mt={id:ve,text:tt,icon:dt,index:Ce,sourceLayerIndex:ze,geometry:Je.geometry,properties:Te.properties,type:HD[Te.type],sortKey:Ye};if(this.features.push(mt),this.featureToAppearanceIndex[Ce]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:ve,properties:Te.properties,usesAppearanceIconAsPlaceholder:ht,isUsingAppearanceIconVertexData:!1,isUsingAppearanceTextVertexData:!1,layoutBasedIconVertexData:[],layoutBasedTextVertexData:[],activeAppearance:null}),dt){const _t=ut._unevaluatedLayout._values,{iconPrimary:ft,iconSecondary:$t}=Ly(dt,this.iconSizeData,_t["icon-size"],s,this.zoom,mt,this.pixelRatio,L,this.worldview,se);de(ft),$t&&(this.hasAnySecondaryIcon=!0,de($t))}const at=ut.getAppearances();if(at.length!==0&&at.forEach(_t=>{if(!_t.getProperty("icon-image"))return;const ft=this.getCombinedIconPrimary(_t,ut,Je,s,se,mt,L);ft&&de(ft)}),tt){const _t=w.evaluate(Je,{},s).join(","),ft=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(fl.vertical)>=0;for(const $t of tt.sections)if($t.image){const Wt=$t.image.getPrimary().scaleSelf(this.pixelRatio),Ft=Wt.id.toString(),jt=K.get(Ft)||[];jt.push(Wt),K.set(Ft,jt)}else{const Wt=Wf(tt.toString()),Ft=$t.fontStack||_t,jt=te[Ft]=te[Ft]||{};this.calculateGlyphDependencies($t.text,jt,ft,this.allowVerticalPlacement,Wt)}}}if(m.get("symbol-placement")==="line"&&(this.features=(function(be){const Te={},ve={},Ce=[];let ze=0;function it(ut){Ce.push(be[ut]),ze++}function Je(ut,ht,Ye){const mt=ve[ut];return delete ve[ut],ve[ht]=mt,Ce[mt].geometry[0].pop(),Ce[mt].geometry[0]=Ce[mt].geometry[0].concat(Ye[0]),mt}function tt(ut,ht,Ye){const mt=Te[ht];return delete Te[ht],Te[ut]=mt,Ce[mt].geometry[0].shift(),Ce[mt].geometry[0]=Ye[0].concat(Ce[mt].geometry[0]),mt}function dt(ut,ht,Ye){const mt=Ye?ht[0][ht[0].length-1]:ht[0][0];return`${ut}:${mt.x}:${mt.y}`}for(let ut=0;ut<be.length;ut++){const ht=be[ut],Ye=ht.geometry,mt=ht.text?ht.text.toString():null;if(!mt){it(ut);continue}const at=dt(mt,Ye),_t=dt(mt,Ye,!0);if(at in ve&&_t in Te&&ve[at]!==Te[_t]){const ft=tt(at,_t,Ye),$t=Je(at,_t,Ce[ft].geometry);delete Te[at],delete ve[_t],ve[dt(mt,Ce[$t].geometry,!0)]=$t,Ce[ft].geometry=null}else at in ve?Je(at,_t,Ye):_t in Te?tt(at,_t,Ye):(it(ut),Te[at]=ze-1,ve[_t]=ze-1)}return Ce.filter(ut=>ut.geometry)})(this.features)),m.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const be of i.elevationFeatures)this.elevationFeatureIdToIndex.set(be.id,this.elevationFeatures.length),this.elevationFeatures.push(be)}}else m.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((be,Te)=>be.sortKey-Te.sortKey)}getCombinedIconPrimary(e,i,s,a,f,m,y){let w,S;const I=e.getUnevaluatedProperties();if(I._values["icon-image"].value!==void 0){const M=i.getAppearanceValueAndResolveTokens(e,"icon-image",s,a,f);w=this.getResolvedImageFromTokens(M)}else{const M=i.getValueAndResolveTokens("icon-image",s,a,f);w=this.getResolvedImageFromTokens(M)}if(w){const M=e.hasProperty("icon-size")?I._values["icon-size"]:i._unevaluatedLayout._values["icon-size"];S=Ly(w,Km(this.zoom,M,this.worldview,f),M,a,this.zoom,m,this.pixelRatio,y,this.worldview,f).iconPrimary}return S}updateSymbolInstanceIconVertices(e,i,s,a,f,m,y,w,S,I,M,O,L,F){if(e.placedIconSymbolIndex<0)return{vertexOffsetDelta:0,hasChanges:!1};if(i.activeAppearance===s)return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1};if(s){const G=this.getCombinedIconPrimary(s,S,a,m,y,{sortKey:void 0,text:void 0,icon:null,index:e.featureIndex,sourceLayerIndex:e.featureIndex,geometry:[],properties:i.properties,type:"Point",id:i.id},I);if(!G)return{vertexOffsetDelta:0,hasChanges:!1};const W=G.toString(),$=this.iconAtlasPositions&&this.iconAtlasPositions.get(W);if($){const{appearanceIconOffset:K,appearanceIconRotate:te}=CS(s,S,a,m,O,F,L,I);let se=g0($,void 0,K,S.layout.get("icon-anchor").evaluate(a,M,m));const pe=$.sdf,de=S.layout.get("icon-text-fit").constantOr("none");de!=="none"&&i.textShaping&&i.iconTextFitPadding&&i.fontScale&&(se=Cb(se,i.textShaping,de,i.iconTextFitPadding,K,i.fontScale));const be=this.calculateEffectiveAppearanceIconSize(s,w.zoom,a,m,y,I,L),Te=0,ve=1+(Math.min(Jm,Math.round(be*df))<<1),Ce=Db(se,te,pe,de!=="none",I);i.isUsingAppearanceIconVertexData||(i.isUsingAppearanceIconVertexData=!0,i.layoutBasedIconVertexData=this.icon.getSymbolVertexData(f,e.numIconVertices));let ze=f;for(let Je=0;Je<Ce.length;++Je){const tt=Ce[Je],dt=i.layoutBasedIconVertexData[0]||e.tileAnchorX,ut=i.layoutBasedIconVertexData[1]||e.tileAnchorY,ht=16*tt.pixelOffsetTL.x,Ye=16*tt.pixelOffsetTL.y,mt=16*tt.pixelOffsetBR.x,at=16*tt.pixelOffsetBR.y,_t=16*tt.minFontScaleX,ft=16*tt.minFontScaleY;this.icon.updateSymbolVertexData(ze,dt,ut,Math.round(32*tt.tl.x),Math.round(32*tt.tl.y),tt.texPrimary.x,tt.texPrimary.y,Te,ve,ht,Ye,_t,ft),this.icon.updateSymbolVertexData(ze+1,dt,ut,Math.round(32*tt.tr.x),Math.round(32*tt.tr.y),tt.texPrimary.x+tt.texPrimary.w,tt.texPrimary.y,Te,ve,mt,Ye,_t,ft),this.icon.updateSymbolVertexData(ze+2,dt,ut,Math.round(32*tt.bl.x),Math.round(32*tt.bl.y),tt.texPrimary.x,tt.texPrimary.y+tt.texPrimary.h,Te,ve,ht,at,_t,ft),this.icon.updateSymbolVertexData(ze+3,dt,ut,Math.round(32*tt.br.x),Math.round(32*tt.br.y),tt.texPrimary.x+tt.texPrimary.w,tt.texPrimary.y+tt.texPrimary.h,Te,ve,mt,at,_t,ft),ze+=4}const it=e.numIconVertices-4*Ce.length;for(let Je=0;Je<it;++Je)this.icon.updateSymbolVertexData(ze+Je,0,0,0,0,0,0,0,0,0,0,0,0);return{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}}else if(i.usesAppearanceIconAsPlaceholder){if(this.layers[0].appearances&&this.layers[0].appearances.length>0)return this.icon.updateSymbolVertexData(f,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(f+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(f+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(f+3,0,0,0,0,0,0,0,0,0,0,0,0),{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}else if(i.isUsingAppearanceIconVertexData){const W=i.layoutBasedIconVertexData.length/12;for(let $=0;$<W;++$){const K=$*12;this.icon.updateSymbolVertexData(f+$,i.layoutBasedIconVertexData[K+0],i.layoutBasedIconVertexData[K+1],i.layoutBasedIconVertexData[K+2],i.layoutBasedIconVertexData[K+3],i.layoutBasedIconVertexData[K+4],i.layoutBasedIconVertexData[K+5],i.layoutBasedIconVertexData[K+6],i.layoutBasedIconVertexData[K+7],i.layoutBasedIconVertexData[K+8],i.layoutBasedIconVertexData[K+9],i.layoutBasedIconVertexData[K+10],i.layoutBasedIconVertexData[K+11])}return i.isUsingAppearanceIconVertexData=!1,{vertexOffsetDelta:W,hasChanges:!0}}return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1}}updateSymbolInstanceTextVertices(e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W,$,K){const te=e.numHorizontalGlyphVertices>0||e.numVerticalGlyphVertices>0;if(!te)return{vertexOffsetDelta:te?e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices:0,hasChanges:!1};if(i.activeAppearance===s)return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1};if(s&&i.textShaping){const{appearanceTextOffset:se,appearanceTextRotate:pe,appearanceTextSize:de}=IS(s,y,a,m,M,L,O);i.fontScale=OS(de,i.textScaleFactor);const be=s.getUnevaluatedProperty("text-size");let Te=this.textSizeData,ve=W,Ce=$;s.hasProperty("text-size")&&(Te=Km(this.zoom,be,this.worldview,K),ve=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,Ce=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0);const ze=i.textShaping.bottom-M[1],it=i.textShaping.left-M[0],Je=i.textShaping.right-M[0];i.textShaping.top=se[1]+(i.textShaping.top-M[1]),i.textShaping.bottom=se[1]+ze,i.textShaping.left=se[0]+it,i.textShaping.right=se[0]+Je;const tt=ES(0,i.textShaping,se,y,!1,a,S,this.allowVerticalPlacement,pe),dt=de&&Te.kind==="composite"?be.possiblyEvaluate(new bn(ve,{}),m).evaluate(a,I,m):F,ut=de&&Te.kind==="composite"?be.possiblyEvaluate(new bn(Ce,{}),m).evaluate(a,I,m):G,ht=Lb(s.name,Te,de,w,dt,ut),Ye=Array.isArray(ht)?ht[1]:de,mt=0,at=1+(Math.min(Jm,Math.round(Ye*df))<<1);i.isUsingAppearanceTextVertexData||(i.isUsingAppearanceTextVertexData=!0,i.layoutBasedTextVertexData=this.text.getSymbolVertexData(f,e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices));for(let _t=0;_t<tt.length&&_t<(e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices)/4;++_t){const ft=tt[_t],$t=ft.glyphOffset[1],Wt=e.tileAnchorX,Ft=e.tileAnchorY,jt=f+4*_t;this.text.updateSymbolVertexData(jt,Wt,Ft,Math.round(32*ft.tl.x),Math.round(32*($t+ft.tl.y)),ft.texPrimary.x,ft.texPrimary.y,mt,at,ft.pixelOffsetTL.x,ft.pixelOffsetTL.y,ft.minFontScaleX,ft.minFontScaleY),this.text.updateSymbolVertexData(jt+1,Wt,Ft,Math.round(32*ft.tr.x),Math.round(32*($t+ft.tr.y)),ft.texPrimary.x+ft.texPrimary.w,ft.texPrimary.y,mt,at,ft.pixelOffsetBR.x,ft.pixelOffsetTL.y,ft.minFontScaleX,ft.minFontScaleY),this.text.updateSymbolVertexData(jt+2,Wt,Ft,Math.round(32*ft.bl.x),Math.round(32*($t+ft.bl.y)),ft.texPrimary.x,ft.texPrimary.y+ft.texPrimary.h,mt,at,ft.pixelOffsetTL.x,ft.pixelOffsetBR.y,ft.minFontScaleX,ft.minFontScaleY),this.text.updateSymbolVertexData(jt+3,Wt,Ft,Math.round(32*ft.br.x),Math.round(32*($t+ft.br.y)),ft.texPrimary.x+ft.texPrimary.w,ft.texPrimary.y+ft.texPrimary.h,mt,at,ft.pixelOffsetBR.x,ft.pixelOffsetBR.y,ft.minFontScaleX,ft.minFontScaleY)}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!0}}if(i.isUsingAppearanceTextVertexData){const pe=i.layoutBasedTextVertexData.length/12;for(let de=0;de<pe;++de){const be=de*12;this.text.updateSymbolVertexData(f+de,i.layoutBasedTextVertexData[be+0],i.layoutBasedTextVertexData[be+1],i.layoutBasedTextVertexData[be+2],i.layoutBasedTextVertexData[be+3],i.layoutBasedTextVertexData[be+4],i.layoutBasedTextVertexData[be+5],i.layoutBasedTextVertexData[be+6],i.layoutBasedTextVertexData[be+7],i.layoutBasedTextVertexData[be+8],i.layoutBasedTextVertexData[be+9],i.layoutBasedTextVertexData[be+10],i.layoutBasedTextVertexData[be+11])}return i.isUsingAppearanceTextVertexData=!1,{vertexOffsetDelta:pe,hasChanges:!0}}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1}}update(e,i,s,a,f,m,y){this.text.programConfigurations.updatePaintArrays(e,i,f,s,a,m,y,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,f,s,a,m,y,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const s=St(e),a=1/s;let f=!1,m=!1;for(let y=0;y<this.symbolInstances.length;y++){const w=this.symbolInstances.get(y),S=Xe(1,0,0),I=Xe(0,1,0),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:O,numIconVertices:L,numVerticalIconVertices:F}=w,G=M>0||O>0,W=L>0,$=this.elevationFeatures[w.elevationFeatureIndex];if($){const K=new pt(w.tileAnchorX,w.tileAnchorY),te=.075+$.pointElevation(K);w.zOffset!==te&&(i=!0,w.zOffset=te),te!==0&&(this.hasAnyZOffset=!0);const se=$.computeSlopeNormal(K,a),pe=$r(Ur(),Xe(0,0,1),se);Vs(S,S,pe),Vs(I,I,pe),S[2]*=s,I[2]*=s,S[0]===1&&S[1]===0&&S[2]===0&&I[0]===0&&I[1]===1&&I[2]===0||(f=f||G,m=m||W)}if(G&&(E0(this.text.orientationVertexArray,M,S,I),E0(this.text.orientationVertexArray,O,S,I)),W){const{placedIconSymbolIndex:K,verticalPlacedIconSymbolIndex:te}=w;K>=0&&E0(this.icon.orientationVertexArray,L,S,I),te>=0&&E0(this.icon.orientationVertexArray,F,S,I)}}f||(this.text.orientationVertexArray=void 0),m||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(f,m,y)=>{s+=m,s>f.length&&f.resize(s);for(let w=-m;w<0;w++)f.emplace(w+s,y)},i=(f,m,y)=>{a+=m,a>f.length&&f.resize(a);for(let w=-m;w<0;w++)f.emplace(w+a,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,a=0;for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:w,numIconVertices:S}=m,I=m.zOffset,M=S>0;if((y>0||w>0)&&(e(this.text.zOffsetVertexArray,y,I),e(this.text.zOffsetVertexArray,w,I)),M){const{placedIconSymbolIndex:O,verticalPlacedIconSymbolIndex:L}=m;O>=0&&i(this.icon.zOffsetVertexArray,S,I),L>=0&&i(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,s,a,f){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(m=>m.appearances&&m.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,s,a,f){if(!(e&&i&&s&&this.appearanceFeatureData))return!1;const m=this.icon.layoutVertexArray&&this.icon.layoutVertexArray.length>0&&this.icon.layoutVertexArray.arrayBuffer,y=this.text.layoutVertexArray&&this.text.layoutVertexArray.length>0&&this.text.layoutVertexArray.arrayBuffer;if(!m&&!y)return!1;const w=this.layers[0],S=w.layout;let I=1,M=0,O=!1;if(m){const[$,K]=S.get("icon-size-scale-range");I=_e(1,$,K)}let L=1,F=0,G=!1;if(y){const[$,K]=S.get("text-size-scale-range");L=_e(1,$,K)}const W=new Map;if(f&&s)for(const $ of s){const K=f.getImage($,w.scope);if(K){const te=new Cs($.toString());W.set(te.toString(),K)}}for(let $=0;$<this.symbolInstances.length;$++){const K=this.symbolInstances.get($),te=this.featureToAppearanceIndex[K.featureIndex],se=te!==void 0?this.appearanceFeatureData[te]:void 0;if(!se)continue;const pe=se.id,de=i&&pe!==void 0?i[String(pe)]:void 0,be={type:"Point",id:se.id,properties:se.properties,geometry:[]},Te=w.appearances&&w.appearances.find(ve=>ve.isActive({globals:a,feature:be,canonical:e,featureState:de}));if(y){const ve=S.get("text-size"),Ce=S.get("text-offset").evaluate(be,de,e),ze=ve.evaluate(be,de,e),it=S.get("text-rotate").evaluate(be,de,e),Je=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,tt=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0,dt=ve.evaluate(be,{zoom:Je},e),ut=ve.evaluate(be,{zoom:tt},e),ht=this.updateSymbolInstanceTextVertices(K,se,Te,be,F,e,w,L,W,de,Ce,ze,it,dt,ut,Je,tt,s);F+=ht.vertexOffsetDelta,G=G||ht.hasChanges}if(m){const ve=S.get("icon-offset").evaluate(be,de,e),Ce=S.get("icon-size").evaluate(be,de,e,s),ze=S.get("icon-rotate").evaluate(be,de,e),it=this.updateSymbolInstanceIconVertices(K,se,Te,be,M,e,s,a,w,I,de,ve,Ce,ze);M+=it.vertexOffsetDelta,O=O||it.hasChanges}se.activeAppearance=Te}return O&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray),G&&this.text.layoutVertexBuffer&&this.text.layoutVertexArray.arrayBuffer!==null&&this.text.layoutVertexArray.length===this.text.layoutVertexBuffer.length&&this.text.layoutVertexBuffer.updateData(this.text.layoutVertexArray),O||G}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=jS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:f}of i)this.lineVertexArray.emplaceBack(a,f);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,a,f,m,y,w,S,I,M,O,L,F,G,W,$,K){const te=e.indexArray,se=e.layoutVertexArray,pe=e.globeExtVertexArray,de=e.segments.prepareSegment(4*K,se,te,this.canOverlap?m.sortKey:void 0),be=this.glyphOffsetArray.length,Te=de.vertexLength,ve=this.allowVerticalPlacement&&y===fl.vertical?Math.PI/2:0,Ce=m.text&&m.text.sections;for(let Je=0;Je<i.length;Je++){const{tl:tt,tr:dt,bl:ut,br:ht,texPrimary:Ye,texSecondary:mt,pixelOffsetTL:at,pixelOffsetBR:_t,minFontScaleX:ft,minFontScaleY:$t,glyphOffset:Wt,isSDF:Ft,sectionIndex:jt}=i[Je],di=de.vertexLength,ni=Wt[1];if(Uy(se,S.x,S.y,tt.x,ni+tt.y,Ye.x,Ye.y,s,Ft,at.x,at.y,ft,$t),Uy(se,S.x,S.y,dt.x,ni+dt.y,Ye.x+Ye.w,Ye.y,s,Ft,_t.x,at.y,ft,$t),Uy(se,S.x,S.y,ut.x,ni+ut.y,Ye.x,Ye.y+Ye.h,s,Ft,at.x,_t.y,ft,$t),Uy(se,S.x,S.y,ht.x,ni+ht.y,Ye.x+Ye.w,Ye.y+Ye.h,s,Ft,_t.x,_t.y,ft,$t),w){const{x:qt,y:Ai,z:Xi}=w.anchor,[yn,qi,Ln]=w.up;Gy(pe,qt,Ai,Xi,yn,qi,Ln),Gy(pe,qt,Ai,Xi,yn,qi,Ln),Gy(pe,qt,Ai,Xi,yn,qi,Ln),Gy(pe,qt,Ai,Xi,yn,qi,Ln),h_(e.dynamicLayoutVertexArray,qt,Ai,Xi,ve)}else h_(e.dynamicLayoutVertexArray,S.x,S.y,S.z,ve);if(W){const qt=mt||Ye;Vy(e.iconTransitioningVertexArray,qt.x,qt.y),Vy(e.iconTransitioningVertexArray,qt.x+qt.w,qt.y),Vy(e.iconTransitioningVertexArray,qt.x,qt.y+qt.h),Vy(e.iconTransitioningVertexArray,qt.x+qt.w,qt.y+qt.h)}te.emplaceBack(di,di+1,di+2),te.emplaceBack(di+1,di+2,di+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Wt[0]),Je!==i.length-1&&jt===i[Je+1].sectionIndex||e.programConfigurations.populatePaintArrays(se.length,m,m.index,{},L,F,G,Ce&&Ce[jt],this.worldview)}const ze=K-i.length;ze!==0&&this._addNullVertices(ze,se,s,w,pe,e,W,de,te);const it=w?w.anchor:S;e.placedSymbolArray.emplaceBack(it.x,it.y,it.z,S.x,S.y,be,this.glyphOffsetArray.length-be,Te,I,M,S.segment,s?s[0]:0,s?s[1]:0,a[0],a[1],y,0,0,0,O,0),e.symbolInstanceIndices.push($)}_addNullVertices(e,i,s,a,f,m,y,w,S){for(let I=0;I<e;I++){for(let O=0;O<4;O++)Uy(i,0,0,0,0,0,0,s,!1,0,0,0,0),a&&Gy(f,0,0,0,0,0,0),h_(m.dynamicLayoutVertexArray,0,0,0,0),y&&Vy(m.iconTransitioningVertexArray,0,0);const M=w.vertexLength;S.emplaceBack(M,M+1,M+2),S.emplaceBack(M+1,M+2,M+3),w.vertexLength+=4,w.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,s,a,f,m,y){e.emplaceBack(i,s,a,f,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,i,s,a,f,m,y){const w=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),S=w.vertexLength,I=y.tileAnchorX,M=y.tileAnchorY;for(let L=0;L<4;L++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,y.zOffset),this._commitLayoutVertex(s.layoutVertexArray,a,f,m,I,M,new pt(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,f,m,I,M,new pt(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,f,m,I,M,new pt(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,a,f,m,I,M,new pt(e.x1,e.y2)),w.vertexLength+=4;const O=s.indexArray;O.emplaceBack(S,S+1),O.emplaceBack(S+1,S+2),O.emplaceBack(S+2,S+3),O.emplaceBack(S+3,S),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,a,f,m){for(let y=a;y<f;y++){const w=s.get(y),S=this.getSymbolInstanceTextSize(e,m,i,y);this._addCollisionDebugVertices(w,S,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,i,s,a,f,m){for(let y=a;y<f;y++){const w=s.get(y),S=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(w,S,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fb(Bh,tS.members,xa),this.iconCollisionBox=new Fb(Bh,tS.members,xa);const a=a_(this.iconSizeData,e),f=a_(this.textSizeData,e,s);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(f,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(a,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(a,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,i,s,a){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),m=Ib(this.textSizeData,e,f)/Bs;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,i,s){const a=this.icon.placedSymbolArray.get(s),f=Ib(this.iconSizeData,e,a);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,s,a){e.emplaceBack(i,-s,-s,a),e.emplaceBack(i,s,-s,a),e.emplaceBack(i,s,s,a),e.emplaceBack(i,-s,s,a)}_updateTextDebugCollisionBoxes(e,i,s,a,f,m,y){for(let w=a;w<f;w++){const S=s.get(w),I=this.getSymbolInstanceTextSize(e,m,i,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,S.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,a,f,m,y){for(let w=a;w<f;w++){const S=s.get(w),I=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,S.padding,m.zOffset)}}updateCollisionDebugBuffers(e,i,s,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=a_(this.iconSizeData,e,a),m=a_(this.textSizeData,e,s);for(let y=0;y<this.symbolInstances.length;y++){const w=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(m,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w,s),this._updateTextDebugCollisionBoxes(m,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w,s),this._updateIconDebugCollisionBoxes(f,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w,a),this._updateIconDebugCollisionBoxes(f,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,a,f,m,y,w,S){const I={};if(i<s){const{x1:M,y1:O,x2:L,y2:F,padding:G,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:te,tileAnchorY:se,featureIndex:pe}=e.get(i);I.textBox={x1:M,y1:O,x2:L,y2:F,padding:G,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:te,tileAnchorY:se},I.textFeatureIndex=pe}if(a<f){const{x1:M,y1:O,x2:L,y2:F,padding:G,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:te,tileAnchorY:se,featureIndex:pe}=e.get(a);I.verticalTextBox={x1:M,y1:O,x2:L,y2:F,padding:G,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:te,tileAnchorY:se},I.verticalTextFeatureIndex=pe}if(m<y){const{x1:M,y1:O,x2:L,y2:F,padding:G,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:te,tileAnchorY:se,featureIndex:pe}=e.get(m);I.iconBox={x1:M,y1:O,x2:L,y2:F,padding:G,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:te,tileAnchorY:se},I.iconFeatureIndex=pe}if(w<S){const{x1:M,y1:O,x2:L,y2:F,padding:G,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:te,tileAnchorY:se,featureIndex:pe}=e.get(w);I.verticalIconBox={x1:M,y1:O,x2:L,y2:F,padding:G,projectedAnchorX:W,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:te,tileAnchorY:se},I.verticalIconFeatureIndex=pe}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),a=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<a;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),a=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const w=this.symbolInstances.get(y);a.push(0|Math.round(i*w.tileAnchorX+s*w.tileAnchorY)),f.push(w.featureIndex)}return m.sort((y,w)=>a[y]-a[w]||f[w]-f[y]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:S}=s;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),f>=0&&f!==a&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&m!==a&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let s;return this.elevationFeatures&&i<this.elevationFeatures.length&&(s=this.elevationFeatures[i]),s}}function US(n,e){return e.replace(/{([^{}]+)}/g,(i,s)=>s in n?String(n[s]):"")}let VS,GS,Nb;Mt(A0,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),A0.addDynamicAttributes=h_;class qS{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Do,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Mt(qS,"FormatSectionOverride",{omit:["defaultValue"]});const jb=()=>Nb||(Nb={layout:VS||(VS=new nr({"symbol-placement":new Dt(qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Dt(qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Dt(qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ut(qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Dt(qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Dt(qe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Dt(qe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Dt(qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Dt(qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Dt(qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Dt(qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ut(qe.layout_symbol["icon-size"]),"icon-size-scale-range":new Dt(qe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ut(qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ut(qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ut(qe.layout_symbol["icon-image"]),"icon-image-use-theme":new Dt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Ut(qe.layout_symbol["icon-rotate"]),"icon-padding":new Dt(qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Dt(qe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ut(qe.layout_symbol["icon-offset"]),"icon-anchor":new Ut(qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Dt(qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Dt(qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Dt(qe.layout_symbol["text-rotation-alignment"]),"text-field":new Ut(qe.layout_symbol["text-field"]),"text-font":new Ut(qe.layout_symbol["text-font"]),"text-size":new Ut(qe.layout_symbol["text-size"]),"text-size-scale-range":new Dt(qe.layout_symbol["text-size-scale-range"]),"text-max-width":new Ut(qe.layout_symbol["text-max-width"]),"text-line-height":new Ut(qe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ut(qe.layout_symbol["text-letter-spacing"]),"text-justify":new Ut(qe.layout_symbol["text-justify"]),"text-radial-offset":new Ut(qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Dt(qe.layout_symbol["text-variable-anchor"]),"text-anchor":new Ut(qe.layout_symbol["text-anchor"]),"text-max-angle":new Dt(qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Dt(qe.layout_symbol["text-writing-mode"]),"text-rotate":new Ut(qe.layout_symbol["text-rotate"]),"text-padding":new Dt(qe.layout_symbol["text-padding"]),"text-keep-upright":new Dt(qe.layout_symbol["text-keep-upright"]),"text-transform":new Ut(qe.layout_symbol["text-transform"]),"text-offset":new Ut(qe.layout_symbol["text-offset"]),"text-allow-overlap":new Dt(qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Dt(qe.layout_symbol["text-ignore-placement"]),"text-optional":new Dt(qe.layout_symbol["text-optional"]),visibility:new Dt(qe.layout_symbol.visibility)})),paint:GS||(GS=new nr({"icon-opacity":new Ut(qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ut(qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ut(qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ut(qe.paint_symbol["text-emissive-strength"]),"icon-color":new Ut(qe.paint_symbol["icon-color"]),"icon-halo-color":new Ut(qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ut(qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ut(qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Dt(qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Dt(qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Dt(qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ut(qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ut(qe.paint_symbol["text-occlusion-opacity"]),"text-color":new Ut(qe.paint_symbol["text-color"],{runtimeType:vo,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Ut(qe.paint_symbol["text-halo-color"]),"text-halo-width":new Ut(qe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ut(qe.paint_symbol["text-halo-blur"]),"text-translate":new Dt(qe.paint_symbol["text-translate"]),"text-translate-anchor":new Dt(qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Dt(qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Dt(qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Dt(qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Dt(qe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ut(qe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},Nb);class C0 extends fo{constructor(e,i,s,a){super(e,jb(),i,s,a,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Re([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach(a=>{a.recalculate(e,i,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const a=[];for(const f of s)a.indexOf(f)<0&&a.push(f);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,a){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===a||(this._colorAdjustmentMatrix=(function(f,m,y,w){f=br(f),m=Un(m);const S=Ae(),I=f/3,M=1-2*I,O=[M,I,I,0,I,M,I,0,I,I,M,0,0,0,0,1],L=.5-.5*m,F=w-y;return Ge(S,[F,0,0,0,0,F,0,0,0,0,F,0,y,y,y,1],[m,0,0,0,0,m,0,0,0,0,m,0,L,L,L,1]),Ge(S,S,O),S})(e,i,s,a),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=a),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,a){const f=this.layout.get(e).evaluate(i,{},s,a),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Su(m.value)||!f?f:US(i.properties,f)}getAppearanceValueAndResolveTokens(e,i,s,a,f){const m=e.getProperty(i);if(!m)return;const y=m.evaluate(s,{},a,f),w=e.getUnevaluatedProperties()._values[i];return w.isDataDriven()||Su(w.value)||!y||typeof y!="string"?y:US(s.properties,y)}createBucket(e){return new A0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of jb().paint.overridableProperties){if(!C0.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new qS(i),a=new kd(s,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new lo("source",a):new Ws("composite",a,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Hc(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&C0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),a=jb().paint.properties[i];let f=!1;const m=y=>{for(const w of y)if(a.overrides&&a.overrides.hasOverride(w))return void(f=!0)};if(s.value.kind==="constant"&&s.value.value instanceof $s)m(s.value.value.sections);else if(s.value.kind==="source"){const y=S=>{f||(S instanceof fa&&ts(S.value)===uh?m(S.value.sections):S instanceof ii?m(S.sections):S.eachChild(y))},w=s.value;w._styleExpression&&y(w._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,s){return{config:new P(this,{zoom:i,lut:s}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let HS,$S,ZS,WS;var Ub=$i([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function I0(n,e,i,s,a,f,m,y){const w=[n,e,1,i,s,1,a,f,1],S=[m,y,1],I=me([],w),[M,O,L]=Mr(S,S,I);return we(w,w,[M,0,0,0,O,0,0,0,L])}function XS(n,e,i,s,a,f,m,y){const w=(function(S,I,M,O,L,F,G,W){const $=I0(0,0,1,0,1,1,0,1),K=I0(S,I,M,O,L,F,G,W);return we(K,K,me([],$))})(n,e,i,s,a,f,m,y);return[w[2]/w[8]/zt,w[5]/w[8]/zt]}function R0(n){return[n[0],Math.min(Math.max(n[1],-85.051129),Oe)]}class YS extends $l{constructor(e,i,s,a){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Pa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=fd(this.map._requestManager.transformRequest(this.url,es.Image),(s,a)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new lh(s)):a&&(this.image=a instanceof HTMLImageElement?Qo.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Iy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Pa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Iy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const f of e)f[1]>s&&(s=f[1]),f[1]<i&&(i=f[1]);const a=(s+i)/2;if(a>Oe?this.onNorthPole=!0:a<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=e.map(kt.fromLngLat);this.tileID=(function(m){let y=1/0,w=1/0,S=-1/0,I=-1/0;for(const G of m)y=Math.min(y,G.x),w=Math.min(w,G.y),S=Math.max(S,G.x),I=Math.max(I,G.y);const M=Math.max(S-y,I-w),O=Math.max(0,Math.floor(-Math.log2(M))),L=Math.pow(2,O);let F=Math.floor((y+S)/2*L);return F>1&&(F-=1),new Fl(O,F,Math.floor((w+I)/2*L))})(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Pa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Iy||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const $ in this.tiles){const K=this.tiles[$];K.state!=="loaded"&&(K.state="loaded",K.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=ky(new Fl(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function($){const K=$[1].x-$[0].x,te=$[1].y-$[0].y,se=$[2].x-$[1].x,pe=$[2].y-$[1].y,de=$[3].x-$[2].x,be=$[3].y-$[2].y,Te=$[0].x-$[3].x,ve=$[0].y-$[3].y,Ce=K*pe-se*te,ze=se*be-de*pe,it=de*ve-Te*be,Je=Te*te-K*ve;return Ce>0&&ze>0&&it>0&&Je>0||Ce<0&&ze<0&&it<0&&Je<0})(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=ky(this.tileID,this.map.transform.projection),[f,m,y,w]=this.coordinates.map($=>{const K=a.projection.project($[0],$[1]);return LS(a,K)._round()});this.perspectiveTransform=XS(f.x,f.y,m.x,m.y,y.x,y.y,w.x,w.y);const S=this._boundsArray=new Ll;S.emplaceBack(f.x,f.y,0,0),S.emplaceBack(m.x,m.y,zt,0),S.emplaceBack(w.x,w.y,0,zt),S.emplaceBack(y.x,y.y,zt,zt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,Ub.members),this.boundsSegments=Wn.simpleSegment(0,0,4,2);const I=[],M=[R0((O=this.coordinates)[0]),R0(O[1]),R0(O[2]),R0(O[3])];var O;const[L,F,G,W]=(function($){let K=$[0][0],te=K,se=$[0][1],pe=se;for(let de=1;de<$.length;de++)$[de][0]<K?K=$[de][0]:$[de][0]>te&&(te=$[de][0]),$[de][1]<se?se=$[de][1]:$[de][1]>pe&&(pe=$[de][1]);return[K,se,te-K,pe-se]})(M);{const $=new Ll,[K,te,se,pe]=(function(ht){let Ye=ht[0].x,mt=Ye,at=ht[0].y,_t=at;for(let ft=1;ft<ht.length;ft++)ht[ft].x<Ye?Ye=ht[ft].x:ht[ft].x>mt&&(mt=ht[ft].x),ht[ft].y<at?at=ht[ft].y:ht[ft].y>_t&&(_t=ht[ft].y);return[Ye,at,mt-Ye,_t-at]})(s),de=ht=>[(ht.x-K)/se,(ht.y-te)/pe],[be,Te,ve,Ce]=s.map(de),ze=(function(ht,Ye,mt,at,_t,ft,$t,Wt){const Ft=I0(0,0,1,0,1,1,0,1);return we(Ft,Ft,me([],I0(ht,Ye,mt,at,_t,ft,$t,Wt)))})(be[0],be[1],Te[0],Te[1],ve[0],ve[1],Ce[0],Ce[1]);this.elevatedGlobePerspectiveTransform=XS(be[0],be[1],Te[0],Te[1],ve[0],ve[1],Ce[0],Ce[1]);const it=(ht,Ye)=>{I.push(ht.lng);const mt=Math.round((ht.lng-L)/G*zt),at=Math.round((ht.lat-F)/W*zt),_t=de(Ye),ft=Mr([],[_t[0],_t[1],1],ze),$t=Math.round(ft[0]/ft[2]*zt),Wt=Math.round(ft[1]/ft[2]*zt);$.emplaceBack(mt,at,$t,Wt)},Je=s[3].x-s[0].x,tt=s[3].y-s[0].y,dt=s[2].x-s[1].x,ut=s[2].y-s[1].y;for(let ht=0;ht<65;ht++){const Ye=ht/64,mt=[s[0].x+Ye*Je,s[0].y+Ye*tt],at=[s[1].x+Ye*dt,s[1].y+Ye*ut],_t=at[0]-mt[0],ft=at[1]-mt[1];for(let $t=0;$t<65;$t++){const Wt=$t/64,Ft={x:mt[0]+_t*Wt,y:mt[1]+ft*Wt};it(i.projection.unproject(Ft.x,Ft.y),Ft)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer($,Ub.members)}{this.maxLongitudeTriangleSize=0;let $=[],K=new Kr;const te=(se,pe,de)=>{K.emplaceBack(se,pe,de);const be=I[se],Te=I[pe],ve=I[de],Ce=Math.min(Math.min(be,Te),ve),ze=Math.max(Math.max(be,Te),ve)-Ce;ze>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ze),$.push(Ce+ze/2)};for(let se=0;se<64;se++)for(let pe=0;pe<64;pe++){const de=65*se+pe,be=de+1,Te=de+65,ve=Te+1;te(de,Te,be),te(be,Te,ve)}[$,K]=(function(se,pe){const de=Array.from({length:se.length},(ve,Ce)=>Ce);de.sort((ve,Ce)=>se[ve]-se[Ce]);const be=[],Te=new Kr;for(let ve=0;ve<de.length;ve++){const Ce=de[ve];be.push(se[Ce]);const ze=3*Ce,it=ze+1;Te.emplaceBack(pe.uint16[ze],pe.uint16[it],pe.uint16[it+1])}return[be,Te]})($,K),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(K)}this.elevatedGlobeSegments=Wn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,G/zt,0,W/zt,0,0,F,L,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof Iy||(this.texture?this.texture.update(this.image):(this.texture=new hb(i,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let a=(f=e+180)+360*Math.round((s[0]-f)/360);var f;const m=new Wn,y=(M,O)=>{m.segments.push({vertexOffset:0,primitiveOffset:M,vertexLength:i.segments[0].vertexLength,primitiveLength:O,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-a)<=w){const M=On(s,0,s.length,a+w);return M===s.length||y(M,Dn(s,M+1,s.length,a+360-w)-M),m}a<s[0]&&(a+=360);const S=Dn(s,0,s.length,a-w);if(S===s.length)return y(0,s.length),m;y(0,S-0);const I=On(s,S+1,s.length,a+w);return I!==s.length&&y(I,s.length-I),m}}const WD=(Math.pow(256,2)-1)/16907520;class KS extends fo{constructor(e,i,s,a){super(e,{layout:ZS||(ZS=new nr({visibility:new Dt(qe.layout_raster.visibility)})),paint:WS||(WS=new nr({"raster-opacity":new Dt(qe.paint_raster["raster-opacity"]),"raster-color":new Mu(qe.paint_raster["raster-color"]),"raster-color-mix":new Dt(qe.paint_raster["raster-color-mix"]),"raster-color-range":new Dt(qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Dt(qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Dt(qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Dt(qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Dt(qe.paint_raster["raster-saturation"]),"raster-contrast":new Dt(qe.paint_raster["raster-contrast"]),"raster-resampling":new Dt(qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Dt(qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Dt(qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Dt(qe.paint_raster["raster-array-band"]),"raster-elevation":new Dt(qe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},i,s,a),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof YS&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(a)||s===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=hp({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,a])}}let JS,QS,eE,tE,iE;class nE extends fo{constructor(e,i,s,a){super(e,{layout:JS||(JS=new nr({visibility:new Dt(qe["layout_raster-particle"].visibility)})),paint:QS||(QS=new nr({"raster-particle-array-band":new Dt(qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Dt(qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Mu(qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Dt(qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Dt(qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Dt(qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Dt(qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Dt(qe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},i,s,a),this._updateColorRamp(),this.lastInvalidatedAt=Qo.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=hp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Qo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class XD extends fo{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Vb(n,e,i){const s=[0,0,1],a=Xo([]);return Co(a,a,i?-Ni(n)+Math.PI:Ni(n)),io(a,a,-Ni(e)),Vs(s,s,a),fi(s,s)}const rE={None:0,Model:1,Symbol:2,FillExtrusion:4};class M0{constructor(e,i,s,a){this.message=(e?`${e}: `:"")+s,a&&(this.identifier=a),i!=null&&i.__line__&&(this.line=i.__line__)}}function Gb(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class sE{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class oE{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new al,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,s=this.instancedDataArray.float32;let a=Math.floor(s[i+2]);const f=1.05*(s[i+2]-a);return a/=100,[s[i]%1*1.05,s[i+1]%1*1.05,f,a]}tileCoordinatesForInstance(e){const i=16*e,s=this.instancedDataArray.float32;let a=s[i+0];return a=a>zt?a-zt:a,new pt(Math.trunc(a),Math.trunc(s[i+1]))}translationForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+4],s[i+5],s[i+6]]}rotationScaleForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+10],s[i+11],s[i+12],s[i+13],s[i+14],s[i+15]]}transformForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+4],s[i+10],s[i+11],s[i+12],s[i+5],s[i+13],s[i+14],s[i+15],s[i+6],0,0,0,1]}}class qb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.tileToMeter=St(s);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:y,index:w,sourceLayerIndex:S}of e){const I=y??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),M=Pi(m,f);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),M,s))continue;const O={id:I,sourceLayerIndex:S,index:w,geometry:f?M.geometry:_i(m,s,a),properties:m.properties,type:m.type,patterns:{}},L=this.addFeature(O,O.geometry,M);L&&i.featureIndex.insert(m,O.geometry,w,S,this.index,this.instancesPerModel[L].instancedDataArray.length,256)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let s=0;for(const a of this.modelUris){const f=e.getModel(a,i);if(!f)continue;const m=this.instancesPerModel[a];if(m){const y=.5*ci(f.aabb.max,f.aabb.min)*m.maxScale+m.maxXYTranslationDistance,w=Math.min(zt,Math.max(y/this.tileToMeter,256));s=Math.max(w,s)}}return s}update(e,i,s,a){for(const f in this.instancesPerModel){const m=this.instancesPerModel[f];for(const y in e)m.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(m.features[m.idToFeaturesIndex[y]],e[y],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const a of s.features){const f=this.layers[0],m=a.feature,y=this.canonical,w=f.paint.get("model-rotation").evaluate(m,{},y),S=f.paint.get("model-scale").evaluate(m,{},y),I=f.paint.get("model-translation").evaluate(m,{},y);Jr(a.rotation,w)&&Jr(a.scale,S)&&Jr(a.translation,I)||(this.evaluate(a,a.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,i,s,a){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const f=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(l(this.activeReplacements,f))return!1;this.activeReplacements=f;let m=!1;for(const y in this.instancesPerModel){const w=this.instancesPerModel[y],S=w.instancedDataArray;for(const I of w.features){const M=I.instancedDataOffset,O=I.instancedDataCount;for(let L=0;L<O;L++){const F=16*(L+M);let G=S.float32[F+0];const W=G>zt;G=W?G-zt:G;const $=Math.floor(G),K=Math.floor(S.float32[F+1]);let te=!1;for(const se of this.activeReplacements)if(!Hm(se,s,rE.Model,a)&&!(se.min.x>$||$>se.max.x||se.min.y>K||K>se.max.y)&&(te=oe(j($,K,e.canonical,se.footprintTileId.canonical),se.footprint),te))break;S.float32[F]=te?G+zt:G,m=m||te!==W}}}return m}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,_M.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const s in this.instancesPerModel){const a=this.instancesPerModel[s];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(e&&i&&this.modelUris&&this.modelsRequested)for(const s of this.modelUris)i.removeModel(s,"",!0)}addFeature(e,i,s){const a=this.layers[0],f=a.layout.get("model-id"),m=a.layout.get("model-allow-density-reduction"),y=f.evaluate(s,{},this.canonical);if(!y)return bi(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),y;(Gb(y,!1)||this.styleDefinedModelURLs[y]!==void 0)&&(this.modelUris.includes(y)||this.modelUris.push(y)),this.instancesPerModel[y]||(this.instancesPerModel[y]=new oE);const w=this.instancesPerModel[y],S=w.instancedDataArray,I=new sE(s,S.length);for(const M of i)for(const O of M){if(O.x<0||O.x>=zt||O.y<0||O.y>=zt)continue;if(this.lookupDim!==0&&m){const F=(this.lookupDim-1)/zt,G=this.lookupDim*(O.y*F|0)+O.x*F|0;if(this.lookup){if(this.lookup[G]!==0)continue;this.lookup[G]=1}}this.instanceCount++;const L=S.length;S.resize(L+1),w.instancesEvaluatedElevation.push(0),S.float32[16*L]=O.x,S.float32[16*L+1]=O.y}return I.instancedDataCount=w.instancedDataArray.length-I.instancedDataOffset,I.instancedDataCount>0&&(e.id&&(w.idToFeaturesIndex[e.id]=w.features.length),w.features.push(I),this.evaluate(I,{},w,!1)),y}getModelUris(){return this.modelUris}evaluate(e,i,s,a){const f=this.layers[0],m=e.feature,y=this.canonical,w=e.rotation=f.paint.get("model-rotation").evaluate(m,i,y),S=e.scale=f.paint.get("model-scale").evaluate(m,i,y),I=e.translation=f.paint.get("model-translation").evaluate(m,i,y),M=Object.assign({},f.paint.get("model-color").evaluate(m,i,y));M.a=f.paint.get("model-color-mix-intensity").evaluate(m,i,y);const O=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]);const L=I[0]*I[0]+I[1]*I[1],F=L>0?Math.sqrt(L):0;s.maxScale=Math.max(Math.max(s.maxScale,S[0]),Math.max(S[1],S[2])),s.maxXYTranslationDistance=Math.max(s.maxXYTranslationDistance,F),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),zT(O,w,S);const G=Math.round(100*M.a)+M.b/1.05;for(let W=0;W<e.instancedDataCount;++W){const $=e.instancedDataOffset+W,K=16*$,te=s.instancedDataArray.float32;let se=0;a&&(se=te[K+6]-s.instancesEvaluatedElevation[$]);const pe=0|te[K+1];te[K]=(0|te[K])+M.r/1.05,te[K+1]=pe+M.g/1.05,te[K+2]=G,te[K+3]=1/(y.z>10?this.tileToMeter:St(y,pe)),te[K+4]=I[0],te[K+5]=I[1],te[K+6]=I[2]+se,te[K+7]=O[0],te[K+8]=O[1],te[K+9]=O[2],te[K+10]=O[4],te[K+11]=O[5],te[K+12]=O[6],te[K+13]=O[8],te[K+14]=O[9],te[K+15]=O[10],s.instancesEvaluatedElevation[$]=I[2]}}}let aE,lE;Mt(qb,"ModelBucket",{omit:["layers"]}),Mt(oE,"PerModelAttributes"),Mt(sE,"ModelFeature");class d_{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const a=s||e.findDEMTileFor(i);if(!a||!a.dem)return;const f=a.dem,m=a.tileID,y=1<<i.canonical.z-m.canonical.z;return new d_(a,f.dim/zt/y,[(i.canonical.x/y-m.canonical.x)*f.dim,(i.canonical.y/y-m.canonical.y)*f.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1];return new pt(Math.floor(e*this._scale+this._offset[0]),Math.floor(s))}getElevationAt(e,i,s,a){const f=e*this._scale+this._offset[0],m=i*this._scale+this._offset[1],y=Math.floor(f),w=Math.floor(m),S=this._dem;return a=!!a,s?vi(vi(S.get(y,w,a),S.get(y,w+1,a),m-w),vi(S.get(y+1,w,a),S.get(y+1,w+1,a),m-w),f-y):S.get(y,w,a)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ve(1,e)*this._dem.stride}}const Hb=new Float32Array(262144),Qm=new Uint8Array(262144);function cE(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,cE(i));return e}function uE(n,e,i){if(n.meshes)for(const s of n.meshes){if(s.aabb.min[0]===1/0)continue;const a=mn.applyTransform(s.aabb,n.globalMatrix);i.insert(e,a.min[0],a.min[1],a.max[0],a.max[1])}if(n.children)for(const s of n.children)uE(s,e,i)}const hE=["","wall","door","roof","window","lamp","logo"];class dE{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:cE(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=mn.applyTransformFast(s.aabb,this.node.globalMatrix),i.encapsulate(s.transformedAabb)),e++;this.aabb=i}return this.aabb}}class D0{constructor(e,i,s,a,f,m,y,w){this.id=s,this.layers=e,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=r_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=r_.HasMapboxMeshFeatures),f&&(this.modelTraits|=r_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.worldview=w,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const S of i)this.nodesInfo.push(new dE(S)),uE(S,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const s of this.getNodesInfo()){const a=s.node;a.footprint&&i.push({footprint:a.footprint,id:e})}}updateAppearances(e,i,s,a){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const s=i?this.stateDependentLayers:this.layers;if(!Yn(e,this.states))for(const a of s)this.evaluate(a,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const a=s.node;this.uploaded?this.updatePbrBuffer(a):pb(a,e,!0)}for(const s of i)d0(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const a=e.transform.projectionOptions,f=e.style.getBrightness(),m=this.brightness!==f;if(!this.uploaded||this.dirty||a.name!==this.projection.name||qy(s.paint.get("model-color").value,m)||qy(s.paint.get("model-color-mix-intensity").value,m)||qy(s.paint.get("model-roughness").value,m)||qy(s.paint.get("model-emissive-strength").value,m)||qy(s.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=a,this.brightness=f;const y=this.getNodesInfo();for(const w of y)w.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),a=this.id.canonical;for(const f of s){const m=f.feature;f.evaluatedTranslation=i.paint.get("model-translation").evaluate(m,{},a),f.evaluatedScale=i.paint.get("model-scale").evaluate(m,{},a)}}evaluate(e,i){const s=this.getNodesInfo();for(const a of s){if(!a.node.meshes)continue;const f=a.feature,m=i&&i[f.id];if(Yn(m,a.state))continue;a.state=structuredClone(m);const y=a.node.meshes&&a.node.meshes[0].featureData,w=a.evaluatedColor[2],S=a.evaluatedRMEA[2],I=this.id.canonical;if(a.hasTranslucentParts=!1,y){for(let M=0;M<hE.length;M++){const O=hE[M];O.length&&(f.properties.part=O);const L=e.paint.get("model-color").evaluate(f,m,I).toPremultipliedRenderColor(null),F=e.paint.get("model-color-mix-intensity").evaluate(f,m,I);a.evaluatedColor[M]=[L.r,L.g,L.b,F],a.evaluatedRMEA[M][0]=e.paint.get("model-roughness").evaluate(f,m,I),a.evaluatedRMEA[M][2]=e.paint.get("model-emissive-strength").evaluate(f,m,I),a.evaluatedRMEA[M][3]=L.a,a.emissionHeightBasedParams[M]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,m,I),!a.hasTranslucentParts&&L.a<1&&(a.hasTranslucentParts=!0)}delete f.properties.part,KD(a,w!==a.evaluatedColor[2]||S!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(f,m,I);a.evaluatedTranslation=e.paint.get("model-translation").evaluate(f,m,I),a.evaluatedScale=e.paint.get("model-scale").evaluate(f,m,I),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,a){const f=e.findDEMTileFor(s);if(f&&(f.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const m=d_.create(e,s,f);if(!m)return;this.modelTraits&r_.HasMapboxMeshFeatures&&this.updateDEM(e,m,s,a);for(const y of this.getNodesInfo()){const w=y.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const S=w.footprint.vertices;let I=m.getElevationAt(S[0].x,S[0].y,!0,!0);for(let M=1;M<S.length;M++)I=Math.min(I,m.getElevationAt(S[M].x,S[M].y,!0,!0));w.elevation=I}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,a){let f=i._dem._modifiedForSources[a];if(f===void 0&&(i._dem._modifiedForSources[a]=[],f=i._dem._modifiedForSources[a]),f.includes(s.canonical))return;const m=i._dem.dim;f.push(s.canonical);let y=!1;for(const w of this.getNodesInfo()){const S=w.node;if(!S.footprint||!S.footprint.grid)continue;const I=S.footprint.grid,M=i.tileCoordToPixel(I.min.x,I.min.y),O=i.tileCoordToPixel(I.max.x,I.max.y),L=Math.min(Math.min(m-O.y,M.x),Math.min(M.y,m-O.x));if(L<0)continue;const F=_e(L,2,5);let G=Math.max(0,M.x-F),W=Math.max(0,M.y-F),$=Math.min(O.x+F,m-1),K=Math.min(O.y+F,m-1);for(let de=W;de<=K;++de)for(let be=G;be<=$;++be)Qm[de*m+be]=255;let te=0,se=0;for(let de=0;de<I.cellsY;++de)for(let be=0;be<I.cellsX;++be){if(!I.cells[de*I.cellsX+be])continue;const Te=i.tileCoordToPixel(I.min.x+be/I.xScale,I.min.y+de/I.yScale),ve=i.tileCoordToPixel(I.min.x+(be+1)/I.xScale,I.min.y+(de+1)/I.yScale);for(let Ce=Te.y;Ce<=Math.min(ve.y+1,m-1);++Ce)for(let ze=Te.x;ze<=Math.min(ve.x+1,m-1);++ze)Qm[Ce*m+ze]===255&&(Qm[Ce*m+ze]=0,te+=i.getElevationAtPixel(ze,Ce),se++)}const pe=te/se;G=Math.max(1,M.x-F),W=Math.max(1,M.y-F),$=Math.min(O.x+F,m-2),K=Math.min(O.y+F,m-2),y=!0;for(let de=W;de<=K;++de)for(let be=G;be<=$;++be)Qm[de*m+be]===0&&(Hb[de*m+be]=i._dem.set(be,de,pe));for(let de=1;de<F;++de){G=Math.max(1,M.x-de),W=Math.max(1,M.y-de),$=Math.min(O.x+de,m-2),K=Math.min(O.y+de,m-2);for(let be=W;be<=K;++be)for(let Te=G;Te<=$;++Te){const ve=be*m+Te;if(Qm[ve]===255){let Ce=0,ze=0,it=-1,Je=-1;for(let tt=-1;tt<=1;++tt)for(let dt=-1;dt<=1;++dt){const ut=(be+tt)*m+Te+dt;if(Qm[ut]>=de)continue;const ht=Hb[ut],Ye=Math.abs(ht);Ye>ze&&(Ce=ht,ze=Ye,it=dt,Je=tt)}if(ze>.1){const tt=1-(de+.5*Math.abs(it*Je))/F;let dt=i._dem.get(Te,be)+Ce*tt;const ut=i._dem.get(Te+it,be+Je),ht=i._dem.get(Te-it,be-Je,!0);(dt-ut)*(dt-ht)>0&&(dt=(ut+ht)/2),Hb[ve]=i._dem.set(Te,be,dt),Qm[ve]=de}}}}}y&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Qo.now())}setFilter(e){this.filter=e?Qf(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new bn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)d0(i.node),mb(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped());for(const a of this.getNodesInfo()){const f=a.node.footprint;a.hiddenByReplacement=!!f&&!s.find(m=>m.footprint===f)}}getHeightAtTileCoord(e,i){const s=[],a=[0,0,0],f=Re([]);for(const m of this.getNodesInfo()){const y=m.node.meshes[0],w=y.transformedAabb;if(e<w.min[0]||i<w.min[1]||e>w.max[0]||i>w.max[1])continue;if(m.node.hidden===!0)return{height:1/0,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};Ne(f,m.node.globalMatrix),a[0]=e,a[1]=i,vn(a,a,f);const S=(a[0]-y.aabb.min[0])/(y.aabb.max[0]-y.aabb.min[0])*Xm|0,I=Math.min(63,(a[1]-y.aabb.min[1])/(y.aabb.max[1]-y.aabb.min[1])*Xm|0)*Xm+Math.min(63,S),M=y.heightmap[I];if(!(M<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:M,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new pt(e,i),new pt(e,i),s),s.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function qy(n,e){return n instanceof lo&&!n.isLightConstant&&e}function YD(n,e,i,s,a,f,m,y){let w=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,I=240&e|(240&e)>>4;i[3]>0&&(w=vi(w,255*i[0],i[3]),S=vi(S,255*i[1],i[3]),I=vi(I,255*i[2],i[3]));const M=w<<8|S,O=I<<8|Math.floor(255*s[3]),L=(function(de){const be=_e(de,0,2);return Math.min(Math.round(.5*be*255),255)})(s[2])<<8|15*s[0]<<4|15*s[1],F=_e(a[0],0,1),G=_e(a[1],0,1),W=_e(a[2],0,1),$=_e(a[3],0,1);let K,te,se,pe;if(F!==G&&m!==f&&G!==F){const de=m-f;te=1/(de*(G-F)),se=-(f+de*F)/(de*(G-F));const be=_e(a[4],-1,1);pe=Math.pow(10,be),K=255*W<<8|255*$}else K=65535,te=0,se=1,pe=1;if(n.emplaceBack(M,O,L,K,te,se,pe),y){const de=y.length;y.clear();for(let be=0;be<de;be++)y.emplaceBack(M,O,L,K,te,se,pe)}}function KD(n,e,i){const s=n.node;let a=0;const f=i&r_.HasMeshoptCompression;for(const m of s.meshes){if(s.lights&&s.lightMeshIndex===a||!m.featureData)continue;m.featureArray=new Bu,m.featureArray.reserve(m.featureData.length);let y=e;for(const w of m.featureData){const S=f?65535&w:w>>16&65535,I=f?w>>16&65535:65535&w,M=(15&I)<8?15&I:0,O=n.evaluatedRMEA[M],L=n.evaluatedColor[M],F=n.emissionHeightBasedParams[M];let G;if(y&&M===2&&s.lights&&(G=new Bu,G.resize(10*s.lights.length)),YD(m.featureArray,S,L,O,F,m.aabb.min[2],m.aabb.max[2],G),G&&y){y=!1;const W=s.meshes[s.lightMeshIndex];W.featureArray=G,W.featureArray._trim()}}m.featureArray._trim(),a++}}Mt(D0,"Tiled3dModelBucket",{omit:["layers"]}),Mt(dE,"Tiled3dModelFeature");const JD=["id","tile","layer","source","sourceLayer","state"];class eg{constructor(e,i,s,a,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=a,this.properties=e?e.properties:{},this.id=f}clone(){const e=new eg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of JD)this[i]!==void 0&&(e[i]=this[i]);return e}}class tg extends $l{constructor(e,i,s,a){super(),this.id=e,this.type="model",this.models=[],this._options=i,this._modelsInfo=new Map}loadGLTFFromURI(e){return MT(this.map._requestManager.transformRequest(e,es.Model).url)}load(){for(const e in this._options.models){const i=this._options.models[e],s=this._modelsInfo.get(e);if(s){s.modelSpec=i;const a=s.model;a&&(a.position=i.position!=null?new fe(i.position[0],i.position[1]):new fe(0,0),a.orientation=i.orientation!=null?i.orientation:[0,0,0],tg.applyModelSpecification(a,i),a.computeBoundsAndApplyParent(),this.models.push(a))}else this._modelsInfo.set(e,{modelSpec:i,model:null}),this.loadGLTFFromURI(i.uri).then(a=>{if(!a)return;const f=this._modelsInfo.get(e);if(!f)return;const m=_b(a),y=f.modelSpec,w=new LT(e,y.uri,y.position,y.orientation,m);tg.applyModelSpecification(w,y),w.computeBoundsAndApplyParent(),this.models.push(w),f.model=w,this.loaded()&&this.fire(new Pa("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this.fire(new lh(new Error(`Could not load model ${e} from ${i.uri}: ${a.message}`)))})}this.loaded()&&this.fire(new Pa("data",{dataType:"source",sourceDataType:"metadata"}))}static applyModelSpecification(e,i){i.nodeOverrides&&tg.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&tg.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every(s=>typeof s=="string")){e.nodeOverrideNames=[];for(const s of i)e.nodeOverrideNames.push(s)}else Object.entries(i).forEach(([s,a])=>{const f={orientation:[0,0,0]};if(a.hasOwnProperty("orientation")){const m=a.orientation;m&&(f.orientation=m)}e.nodeOverrides.set(s,f)})}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every(s=>typeof s=="string")){e.materialOverrideNames=[];for(const s of i)e.materialOverrideNames.push(s)}else Object.entries(i).forEach(([s,a])=>{const f={color:new xn(1,1,1),colorMix:0,emissionStrength:0,opacity:1},m=a["model-color"];m!==void 0&&(f.color.r=m[0],f.color.g=m[1],f.color.b=m[2]);const y=a["model-color-mix-intensity"];y!==void 0&&(f.colorMix=y);const w=a["model-emissive-strength"];w!==void 0&&(f.emissionStrength=w);const S=a["model-opacity"];S!==void 0&&(f.opacity=S),e.materialOverrides.set(s,f)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){if(this._modelsInfo.size===0)return!0;for(const e of this._modelsInfo.values())if(e.model==null)return!1;return!0}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=nl(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this.load()}setModels(e){this.models=[];const i=new Map;for(const s in e){const a=e[s];if(this._modelsInfo.has(s)){const f=this._modelsInfo.get(s);f&&f.modelSpec.uri===a.uri&&i.set(s,f)}}this._modelsInfo=i,this._options.models=e,this.load()}}function $b(n,e,i,s){const a=1<<n.z;e.lat=ct((s/zt+n.y)/a),e.lng=Qe((i/zt+n.x)/a)}function QD(n,e,i,s){const a=n.getNodesInfo()[e];if(!a||a.hiddenByReplacement||!a.node.meshes)return;let f=Number.MAX_VALUE;const m=a.node,y=i.tile,w=s.calculatePosMatrix(y.tileID.toUnwrapped(),s.worldSize),S=a.evaluatedScale;let I=0;s.elevation&&m.elevation&&(I=m.elevation*s.elevation.exaggeration()),Ue(w,w,[(m.anchor?m.anchor[0]:0)*(S[0]-1),(m.anchor?m.anchor[1]:0)*(S[1]-1),I]),rt(w,w,S);const M=i.queryGeometry,O=M.isPointQuery()?M.screenBounds:M.screenGeometry,L=function(G){const W=Ge([],w,G.globalMatrix);Ge(W,s.expandedFarZProjMatrix,W);for(let $=0;$<G.meshes.length;++$){const K=G.meshes[$];if($===G.lightMeshIndex)continue;const te=fb(O,s,W,K.aabb);te!=null&&(f=Math.min(te,f))}if(G.children)for(const $ of G.children)L($)};if(L(m),f===Number.MAX_VALUE)return;const F=new fe(0,0);return $b(y.tileID.canonical,F,a.node.anchor[0],a.node.anchor[1]),{intersectionZ:f,position:F,feature:a.feature}}const eO={circle:class extends fo{constructor(n,e,i,s){super(n,{layout:Cv||(Cv=new nr({"circle-sort-key":new Ut(qe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Dt(qe.layout_circle["circle-elevation-reference"]),visibility:new Dt(qe.layout_circle.visibility)})),paint:Iv||(Iv=new nr({"circle-radius":new Ut(qe.paint_circle["circle-radius"]),"circle-color":new Ut(qe.paint_circle["circle-color"]),"circle-blur":new Ut(qe.paint_circle["circle-blur"]),"circle-opacity":new Ut(qe.paint_circle["circle-opacity"]),"circle-translate":new Dt(qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Dt(qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Dt(qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Dt(qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ut(qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ut(qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ut(qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Dt(qe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}createBucket(n){return new So(n)}queryRadius(n){const e=n;return mc("circle-radius",this,e)+mc("circle-stroke-width",this,e)+cp(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,s,a,f,m,y){const w=Av(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return iy(n,s,f,m,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const s=Pv(this);return{config:new P(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends fo{createBucket(n){return new Lv(n)}constructor(n,e,i,s){super(n,{layout:ry||(ry=new nr({visibility:new Dt(qe.layout_heatmap.visibility)})),paint:kv||(kv=new nr({"heatmap-radius":new Ut(qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ut(qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Dt(qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mu(qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Dt(qe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(n){return mc("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,s,a,f,m,y){const w=this.paint.get("heatmap-radius").evaluate(e,i);return iy(n,s,f,m,y,!0,!0,new pt(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new P(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends fo{constructor(n,e,i,s){super(n,{layout:Vg||(Vg=new nr({visibility:new Dt(qe.layout_hillshade.visibility)})),paint:Gg||(Gg=new nr({"hillshade-illumination-direction":new Dt(qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Dt(qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Dt(qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Dt(qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Dt(qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Dt(qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Dt(qe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends fo{constructor(n,e,i,s){super(n,{layout:gp||(gp=new nr({"fill-sort-key":new Ut(qe.layout_fill["fill-sort-key"]),visibility:new Dt(qe.layout_fill.visibility),"fill-elevation-reference":new Dt(qe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Ut(qe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:_p||(_p=new nr({"fill-antialias":new Dt(qe.paint_fill["fill-antialias"]),"fill-opacity":new Ut(qe.paint_fill["fill-opacity"]),"fill-color":new Ut(qe.paint_fill["fill-color"]),"fill-outline-color":new Ut(qe.paint_fill["fill-outline-color"]),"fill-translate":new Dt(qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Dt(qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ut(qe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Dt(qe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Dt(qe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ut(qe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Ut(qe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Ut(qe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new P(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new tu(n)}queryRadius(){return cp(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,s,a,f){return!n.queryGeometry.isAboveHorizon&&Vn(J_(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends fo{constructor(n,e,i,s){super(n,{layout:rT||(rT=new nr({visibility:new Dt(qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Dt(qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:sT||(sT=new nr({"fill-extrusion-opacity":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ut(qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ut(qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Ut(qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ut(qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ut(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ut(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ut(qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ut(qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Dt(qe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new _c(n)}queryRadius(){return cp(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,s,a,f,m,y,w){const S=Av(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,i),M=this.paint.get("fill-extrusion-base").evaluate(e,i),O=[0,0],L=y&&f.elevation,F=f.elevation?f.elevation.exaggeration():1,G=n.tile.getBucket(this);if(L&&G instanceof _c){const se=G.centroidVertexArray,pe=w+1;pe<se.length&&(O[0]=se.geta_centroid_pos0(pe),O[1]=se.geta_centroid_pos1(pe))}if(O[0]===0&&O[1]===1)return!1;f.projection.name==="globe"&&(s=nT([s],[new pt(0,0),new pt(zt,zt)],n.tileID.canonical).map(se=>se.polygon).flat());const W=L?y:null,[$,K]=dT(f,s,M,I,S,m,W,O,F,f.center.lat,n.tileID.canonical),te=n.queryGeometry;return hT($,K,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},building:class extends fo{constructor(n,e,i,s){super(n,{layout:VT||(VT=new nr({visibility:new Dt(qe.layout_building.visibility),"building-facade":new Ut(qe.layout_building["building-facade"]),"building-facade-floors":new Ut(qe.layout_building["building-facade-floors"]),"building-facade-unit-width":new Ut(qe.layout_building["building-facade-unit-width"]),"building-facade-window":new Ut(qe.layout_building["building-facade-window"]),"building-roof-shape":new Ut(qe.layout_building["building-roof-shape"]),"building-height":new Ut(qe.layout_building["building-height"]),"building-base":new Ut(qe.layout_building["building-base"]),"building-flood-light-wall-radius":new Ut(qe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Ut(qe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Ut(qe.layout_building["building-flip-roof-orientation"])})),paint:GT||(GT=new nr({"building-opacity":new Dt(qe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Dt(qe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Dt(qe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Dt(qe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Dt(qe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Dt(qe.paint_building["building-vertical-scale"]),"building-cast-shadows":new Dt(qe.paint_building["building-cast-shadows"]),"building-color":new Ut(qe.paint_building["building-color"]),"building-emissive-strength":new Ut(qe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Dt(qe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Dt(qe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Dt(qe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Dt(qe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Dt(qe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new UT(n)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(n){return!0}queryRadius(n){return 0}queryIntersectsFeature(n,e,i,s,a,f,m,y,w,S){let I=this.layout.get("building-height").evaluate(e,i);const M=this.layout.get("building-base").evaluate(e,i),O=n.tile.getBucket(this).getFootprint(e);if(O){if(O.hiddenFlags!==0)return!1;I=O.height}const[L,F]=dT(f,s,M,I,new pt(0,0),m,null,[0,0],1,f.center.lat,n.tileID.canonical),G=n.queryGeometry;return hT(L,F,G.isPointQuery()?G.screenBounds:G.screenGeometry)}},line:class extends fo{constructor(n,e,i,s){const a=QT();super(n,a,e,i,s),a.layout&&(this.layout=new ho(a.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ja,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(My)return My;const i=QT();return My=new WM(i.paint.properties["line-width"].specification),My.useIntegerZoom=!0,My})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new xb(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const s=KT(this);return{config:new P(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}queryRadius(n){const e=n,i=eS(mc("line-width",this,e),mc("line-gap-width",this,e)),s=mc("line-offset",this,e);return i/2+Math.abs(s)+cp(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,s,a,f){if(n.queryGeometry.isAboveHorizon)return!1;const m=J_(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*eS(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(s=(function(S,I){const M=[],O=new pt(0,0);for(let L=0;L<S.length;L++){const F=S[L],G=[];for(let W=0;W<F.length;W++){const $=F[W],K=F[W+1],te=W===0?O:$.sub(F[W-1])._unit()._perp(),se=W===F.length-1?O:K.sub($)._unit()._perp(),pe=te._add(se)._unit();pe._mult(1/(pe.x*se.x+pe.y*se.y)),G.push(pe._mult(I)._add($))}M.push(G)}return M})(s,w*n.pixelToTileUnitsFactor)),(function(S,I,M){for(let O=0;O<I.length;O++){const L=I[O];if(S.length>=3){for(let F=0;F<L.length;F++)if(Uo(S,L[F]))return!0}if(kr(S,L,M))return!0}return!1})(m,s,y)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:C0,background:class extends fo{constructor(n,e,i,s){super(n,{layout:HS||(HS=new nr({visibility:new Dt(qe.layout_background.visibility)})),paint:$S||($S=new nr({"background-pitch-alignment":new Dt(qe.paint_background["background-pitch-alignment"]),"background-color":new Dt(qe.paint_background["background-color"]),"background-pattern":new Dt(qe.paint_background["background-pattern"]),"background-opacity":new Dt(qe.paint_background["background-opacity"]),"background-emissive-strength":new Dt(qe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:KS,"raster-particle":nE,sky:class extends fo{constructor(n,e,i,s){super(n,{layout:eE||(eE=new nr({visibility:new Dt(qe.layout_sky.visibility)})),paint:tE||(tE=new nr({"sky-type":new Dt(qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Dt(qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Dt(qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Dt(qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Dt(qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Mu(qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Dt(qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Dt(qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Dt(qe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=hp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),a=!s,f=n.style.light,m=f.properties.get("position");return a&&f.properties.get("anchor")==="viewport"&&bi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Vb(m.azimuthal,90-m.polar,e):Vb(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return Vb(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends fo{constructor(n,e,i,s){super(n,{paint:iE||(iE=new nr({}))},e,null)}},model:class extends fo{constructor(n,e,i,s){super(n,{layout:aE||(aE=new nr({visibility:new Dt(qe.layout_model.visibility),"model-id":new Ut(qe.layout_model["model-id"]),"model-allow-density-reduction":new Dt(qe.layout_model["model-allow-density-reduction"])})),paint:lE||(lE=new nr({"model-opacity":new Ut(qe.paint_model["model-opacity"]),"model-rotation":new Ut(qe.paint_model["model-rotation"]),"model-scale":new Ut(qe.paint_model["model-scale"]),"model-translation":new Ut(qe.paint_model["model-translation"]),"model-color":new Ut(qe.paint_model["model-color"]),"model-color-mix-intensity":new Ut(qe.paint_model["model-color-mix-intensity"]),"model-type":new Dt(qe.paint_model["model-type"]),"model-cast-shadows":new Dt(qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Dt(qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Dt(qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ut(qe.paint_model["model-emissive-strength"]),"model-roughness":new Ut(qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ut(qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Dt(qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Dt(qe.paint_model["model-front-cutoff"]),"model-elevation-reference":new Dt(qe.paint_model["model-elevation-reference"]),"model-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this.layer=n,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new qb(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof D0?8191:0}queryRenderedFeatures(n,e,i){const s=e.getSource();if(!(s&&s instanceof tg))return{};const a=s,f={};f[this.id]=[];const m=f[this.id];let y=0;for(const w of a.models){const S=e.getFeatureState(this.sourceLayer,w.id),I={type:"Unknown",id:w.id,properties:w.featureProperties},M=this.paint.get("model-rotation").evaluate(I,S),O=this.paint.get("model-scale").evaluate(I,S),L=this.paint.get("model-translation").evaluate(I,S),F=this.paint.get("model-elevation-reference");let G=[];h0(G,w,i,w.position,M,O,L,F==="ground",F==="ground",!1),i.projection.name==="globe"&&(G=u0(G,i));const W=Ge([],i.projMatrix,G),$=fb(n.isPointQuery()?n.screenBounds:n.screenGeometry,i,W,w.aabb);if($!=null){const K=new eg(void 0,0,0,0,w.id);K.layer=this.layer,K.properties=structuredClone(w.featureProperties),K.properties.layer=this.id,K.properties.uri=w.uri,K.properties.orientation=w.orientation,K.sourceLayer=this.sourceLayer,K.geometry={type:"Point",coordinates:[w.position.lng,w.position.lat]},K.state=S,K.source=this.source,m.push({featureIndex:y,feature:K,intersectionZ:$})}++y}return f}queryIntersectsFeature(n,e,i,s,a,f,m,y,w,S){if(!this.modelManager)return!1;const I=this.modelManager,M=n.tile.getBucket(this);if(!(M&&M instanceof qb))return!1;for(const O in M.instancesPerModel){const L=M.instancesPerModel[O],F=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(L.idToFeaturesIndex.hasOwnProperty(F)){const G=L.features[L.idToFeaturesIndex[F]],W=I.getModel(O,S||this.scope);if(!W)return!1;let $=[];const K=new fe(0,0),te=M.canonical;let se=Number.MAX_VALUE;for(let pe=0;pe<G.instancedDataCount;++pe){const de=16*(G.instancedDataOffset+pe),be=L.instancedDataArray.float32,Te=[be[de+4],be[de+5],be[de+6]];$b(te,K,Math.floor(be[de]),Math.floor(be[de+1])),h0($,W,f,K,G.rotation,G.scale,Te,!1,!1,!1),f.projection.name==="globe"&&($=u0($,f));const ve=Ge([],f.projMatrix,$),Ce=n.queryGeometry,ze=fb(Ce.isPointQuery()?Ce.screenBounds:Ce.screenGeometry,f,ve,W.aabb);ze!=null&&(se=Math.min(ze,se))}return se!==Number.MAX_VALUE&&se}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ws}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends fo{constructor(n,e,i,s){super(n,{layout:Hu||(Hu=new nr({"clip-layer-types":new Dt(qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Dt(qe.layout_clip["clip-layer-scope"])})),paint:Yv||(Yv=new nr({}))},e,i,s)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new Kv(n)}is3D(n){return!0}}},Zb=new xn(0,0,0);function tO(n,e,i){n===1&&e.icons.push((function(s,a){return(function(f){if(f.usvg_tree.height||(f.usvg_tree.height=f.usvg_tree.width),!f.metadata)return f;const{metadata:m}=f;if(m.content_area){const{content_area:y}=m;y.left==null&&(y.left=0),y.top==null&&(y.top=y.left),y.width==null&&(y.width=f.usvg_tree.width),y.height==null&&(y.height=y.width)}if(m.text_placeholder){const{text_placeholder:y}=m;y.top==null&&(y.top=y.left),y.height==null&&(y.height=y.width)}return m.stretch_x&&m.stretch_x.length&&fE(m,"x"),m.stretch_y&&m.stretch_y.length&&fE(m,"y"),f})(s.readFields(iO,{name:void 0},a))})(i,i.readVarint()+i.pos))}function fE(n,e){const i=[],s=n[`stretch_${e}`];let a=null;for(let f=0;f<s.length;f++)a===null?a=i.length===0?s[0]:i[i.length-1][1]+s[f]:(i.push([a,a+s[f]]),a=null);n[`stretch_${e}_areas`]=i}function iO(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=(function(s,a){return s.readFields(nO,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},a)})(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=(function(s,a){return s.readFields(oO,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},a)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function nO(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=pE(i,i.readVarint()+i.pos):n===4?e.variables.push((function(s,a){return s.readFields(sO,{name:void 0},a)})(i,i.readVarint()+i.pos)):n===5&&(e.text_placeholder=pE(i,i.readVarint()+i.pos))}function pE(n,e){return n.readFields(rO,{},e)}function rO(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function sO(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=z0(i.readVarint()),e.value="rgb_color")}function oO(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(O0(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push((function(s,a){return s.readFields(fO,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},a)})(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push((function(s,a){return s.readFields(mO,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},a)})(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push((function(s,a){return s.readFields(gO,{children:[]},a)})(i,i.readVarint()+i.pos)):n===8&&e.masks.push((function(s,a){const f=s.readFields(_O,{left:0,width:20,mask_type:1,children:[]},a);return f.height==null&&(f.height=f.width),f.top==null&&(f.top=f.left),f})(i,i.readVarint()+i.pos))}function O0(n,e){return n.readFields(aO,{},e)}function aO(n,e,i){n===1?(e.group=(function(s,a){return s.readFields(lO,{opacity:255,children:[]},a)})(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=(function(s,a){return s.readFields(uO,{paint_order:1,commands:[],step:1,diffs:[],rule:1},a)})(i,i.readVarint()+i.pos),e.node="path")}function lO(n,e,i){n===1?e.transform=P0(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(O0(i,i.readVarint()+i.pos))}function P0(n,e){return n.readFields(cO,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function cO(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function uO(n,e,i){n===1?e.fill=(function(s,a){return s.readFields(hO,{rgb_color:Zb,paint:"rgb_color",opacity:255},a)})(i,i.readVarint()+i.pos):n===2?e.stroke=(function(s,a){return s.readFields(dO,{rgb_color:Zb,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},a)})(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function hO(n,e,i){n===1?(e.rgb_color=z0(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function z0(n){return new xn((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function dO(n,e,i){n===1?(e.rgb_color=z0(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function fO(n,e,i){n===1?e.transform=P0(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(mE(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function mE(n,e){return n.readFields(pO,{offset:0,opacity:255,rgb_color:Zb},e)}function pO(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=z0(i.readVarint()))}function mO(n,e,i){n===1?e.transform=P0(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(mE(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function gO(n,e,i){n===1?e.transform=P0(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(O0(i,i.readVarint()+i.pos))}function _O(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(O0(i,i.readVarint()+i.pos))}class yO{static calculate(e={},i=[]){const s=new Map,a=new Map;if(Object.keys(e).length===0)return s;i.forEach(f=>{a.set(f.name,f.rgb_color||new xn(0,0,0))});for(const[f,m]of Object.entries(e))a.has(f)?s.set(a.get(f).toString(),m):console.warn(`Ignoring unknown image variable "${f}"`);return s}}function f_(n,e=255,i){const s=e/255,a=n.toString(),f=i.has(a)?i.get(a).clone():n.clone();return f.a*=s,f.toString()}function Hy(n,e){if(!Ia()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}let Wb,$y=null;function Xb(n,e,i,s,a){for(const f of s.children)gE(n,e,i,f,a)}function gE(n,e,i,s,a){s.group?(n.save(),(function(f,m,y,w,S){const I=w.mask_idx!=null?y.masks[w.mask_idx]:null,M=w.clip_path_idx!=null?y.clip_paths[w.clip_path_idx]:null;if(w.transform&&(m=p_(w.transform).preMultiplySelf(m)),!(function(F,G,W){return F.opacity!==255||G||W})(w,M!=null,I!=null))return void Xb(f,m,y,w,S);const O=Hy(f.canvas.width,f.canvas.height),L=O.getContext("2d");Xb(L,m,y,w,S),M&&TE(L,m,y,M),I&&SE(L,m,y,I,S),f.globalAlpha=w.opacity/255,f.drawImage(O,0,0)})(n,e,i,s.group,a),n.restore()):s.path&&(n.save(),(function(f,m,y,w,S){f.setTransform(m),w.paint_order===1?(_E(f,y,w,S),vE(f,y,w,S)):(vE(f,y,w,S),_E(f,y,w,S))})(n,e,i,s.path,a),n.restore())}function _E(n,e,i,s){const a=i.fill;if(!a)return;const f=a.opacity/255;switch(n.save(),n.beginPath(),EE(i,n),a.paint){case"rgb_color":n.fillStyle=f_(a.rgb_color,a.opacity,s);break;case"linear_gradient_idx":{const m=e.linear_gradients[a.linear_gradient_idx];m.transform&&n.setTransform(p_(m.transform).preMultiplySelf(n.getTransform())),n.fillStyle=xE(n,m,f,s);break}case"radial_gradient_idx":{const m=e.radial_gradients[a.radial_gradient_idx];m.transform&&n.setTransform(p_(m.transform).preMultiplySelf(n.getTransform())),n.fillStyle=bE(n,m,f,s)}}n.fill(yE(i)),n.restore()}function yE(n){return n.rule===1?"nonzero":n.rule===2?"evenodd":void 0}function vE(n,e,i,s){const a=i.stroke;if(!a)return;const f=AE(i);n.lineWidth=a.width,n.miterLimit=a.miterlimit,n.setLineDash(a.dasharray),n.lineDashOffset=a.dashoffset;const m=a.opacity/255;switch(a.paint){case"rgb_color":n.strokeStyle=f_(a.rgb_color,a.opacity,s);break;case"linear_gradient_idx":n.strokeStyle=xE(n,e.linear_gradients[a.linear_gradient_idx],m,s,!0);break;case"radial_gradient_idx":n.strokeStyle=bE(n,e.radial_gradients[a.radial_gradient_idx],m,s,!0)}switch(a.linejoin){case 2:case 1:n.lineJoin="miter";break;case 3:n.lineJoin="round";break;case 4:n.lineJoin="bevel"}switch(a.linecap){case 1:n.lineCap="butt";break;case 2:n.lineCap="round";break;case 3:n.lineCap="square"}n.stroke(f)}function xE(n,e,i,s,a=!1){if(e.stops.length===1){const O=e.stops[0];return f_(O.rgb_color,O.opacity*i,s)}const{x1:f,y1:m,x2:y,y2:w}=e;let S=new DOMPoint(f,m),I=new DOMPoint(y,w);if(a){const O=p_(e.transform);S=O.transformPoint(S),I=O.transformPoint(I)}const M=n.createLinearGradient(S.x,S.y,I.x,I.y);for(const O of e.stops)M.addColorStop(O.offset,f_(O.rgb_color,O.opacity*i,s));return M}function bE(n,e,i,s,a=!1){if(e.stops.length===1){const $=e.stops[0];return f_($.rgb_color,$.opacity*i,s)}const f=p_(e.transform),{fx:m,fy:y,fr:w,cx:S,cy:I,r:M}=e;let O=new DOMPoint(m,y),L=new DOMPoint(S,I),F=w,G=M;if(a){O=f.transformPoint(O),L=f.transformPoint(L);const $=(f.a+f.d)/2;F=w*$,G=e.r*$}const W=n.createRadialGradient(O.x,O.y,F,L.x,L.y,G);for(const $ of e.stops)W.addColorStop($.offset,f_($.rgb_color,$.opacity*i,s));return W}function wE(n,e,i,s){const a=s.transform?p_(s.transform).preMultiplySelf(e):e,f=Hy(n.canvas.width,n.canvas.height),m=f.getContext("2d");for(const w of s.children)if(w.group)wE(m,a,i,w.group);else if(w.path){const S=w.path,I=new Path2D;I.addPath(AE(S),a),m.fill(I,yE(S))}const y=s.clip_path_idx!=null?i.clip_paths[s.clip_path_idx]:null;y&&TE(m,a,i,y),n.globalCompositeOperation="source-over",n.drawImage(f,0,0)}function TE(n,e,i,s){const a=Hy(n.canvas.width,n.canvas.height);wE(a.getContext("2d"),e,i,s),n.globalCompositeOperation="destination-in",n.drawImage(a,0,0)}function SE(n,e,i,s,a){if(s.children.length===0)return;const f=s.mask_idx!=null?i.masks[s.mask_idx]:null;f&&SE(n,e,i,f,a);const m=n.canvas.width,y=n.canvas.height,w=Hy(m,y),S=w.getContext("2d"),I=s.width,M=s.height,O=s.left,L=s.top,F=new Path2D,G=new Path2D;G.rect(O,L,I,M),F.addPath(G,e),S.clip(F);for(const K of s.children)gE(S,e,i,K,a);const W=S.getImageData(0,0,m,y),$=W.data;if(s.mask_type===1)for(let K=0;K<$.length;K+=4)$[K+3]=$[K+3]/255*(.2126*$[K]+.7152*$[K+1]+.0722*$[K+2]);S.putImageData(W,0,0),n.globalCompositeOperation="destination-in",n.drawImage(w,0,0)}function p_(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function EE(n,e){const i=n.step;let s=n.diffs[0]*i,a=n.diffs[1]*i;e.moveTo(s,a);for(let f=0,m=2;f<n.commands.length;f++)switch(n.commands[f]){case 1:s+=n.diffs[m++]*i,a+=n.diffs[m++]*i,e.moveTo(s,a);break;case 2:s+=n.diffs[m++]*i,a+=n.diffs[m++]*i,e.lineTo(s,a);break;case 3:{const y=s+n.diffs[m++]*i,w=a+n.diffs[m++]*i;s=y+n.diffs[m++]*i,a=w+n.diffs[m++]*i,e.quadraticCurveTo(y,w,s,a);break}case 4:{const y=s+n.diffs[m++]*i,w=a+n.diffs[m++]*i,S=y+n.diffs[m++]*i,I=w+n.diffs[m++]*i;s=S+n.diffs[m++]*i,a=I+n.diffs[m++]*i,e.bezierCurveTo(y,w,S,I,s,a);break}case 5:e.closePath();break}return e}function AE(n){return EE(n,new Path2D)}class L0{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Mt(L0,"LRUCache");class Yb{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Ds(e,e.data)}getFromCache(e,i,s){return this.cacheMap.has(s)||this.cacheMap.set(s,new L0(150)),this.cacheMap.get(s).get(nl(e.toString(),i))}setInCache(e,i,s,a){this.cacheDependenciesMap.has(a)||this.cacheDependenciesMap.set(a,new Map),this.cacheMap.has(a)||this.cacheMap.set(a,new L0(150));const f=this.cacheDependenciesMap.get(a),m=nl(e.id.toString(),s);f.get(m)||f.set(m,new Set);const y=this.cacheMap.get(a),w=e.toString();f.get(m).add(w),y.put(nl(e.toString(),s),i)}removeImagesFromCacheByIds(e,i,s=0){if(!this.cacheMap.has(s)||!this.cacheDependenciesMap.has(s))return;const a=this.cacheMap.get(s),f=this.cacheDependenciesMap.get(s);for(const m of e){const y=nl(m.toString(),i);if(f.has(y)){for(const w of f.get(y))a.delete(w);f.delete(y)}}}rasterize(e,i,s,a){const f=this.getFromCache(e,s,a);if(f)return f.clone();const m=(function(w,S){const I=yO.calculate(S.params,w.metadata?w.metadata.variables:[]),M=w.usvg_tree,O=M.width,L=M.height,F=Math.max(1,Math.round(O*S.sx)),G=Math.max(1,Math.round(L*S.sy)),W=new DOMMatrix([F/O,0,0,G/L,0,0]);return $y===null&&($y=Hy(10,10),Wb=$y.getContext("2d",{willReadFrequently:!0})),$y.width=F,$y.height=G,Xb(Wb,W,M,M,I),Wb.getImageData(0,0,F,G)})(i.icon,e),y=Yb._getImage(m);return this.setInCache(e,y,s,a),y.clone()}}class CE{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function IE(n,e,i,s){let a=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(s[m])<1e-15){if(i[m]<n[m]||i[m]>e[m])return null}else{const y=1/s[m];let w=(n[m]-i[m])*y,S=(e[m]-i[m])*y;if(w>S){const I=w;w=S,S=I}if(w>a&&(a=w),S<f&&(f=S),a>f)return null}return a}function RE(n,e,i,s,a,f,m,y,w,S,I){const M=s-n,O=a-e,L=f-i,F=m-n,G=y-e,W=w-i,$=I[1]*W-I[2]*G,K=I[2]*F-I[0]*W,te=I[0]*G-I[1]*F,se=M*$+O*K+L*te;if(Math.abs(se)<1e-15)return null;const pe=1/se,de=S[0]-n,be=S[1]-e,Te=S[2]-i,ve=(de*$+be*K+Te*te)*pe;if(ve<0||ve>1)return null;const Ce=be*L-Te*O,ze=Te*M-de*L,it=de*O-be*M,Je=(I[0]*Ce+I[1]*ze+I[2]*it)*pe;return Je<0||ve+Je>1?null:(F*Ce+G*ze+W*it)*pe}function ME(n,e,i){return(n-e)/(i-e)}function DE(n,e,i,s,a,f,m,y,w){const S=1<<i,I=f-s,M=m-a,O=(n+1)/S*I+s,L=(e+0)/S*M+a,F=(e+1)/S*M+a;y[0]=(n+0)/S*I+s,y[1]=L,w[0]=O,w[1]=F}class OE{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(f){const m=Math.ceil(Math.log2(f.dim/8)),y=[];let w=Math.ceil(Math.pow(2,m));const S=1/w,I=(L,F,G,W,$)=>{const K=W?1:0,te=(L+1)*G-K,se=F*G,pe=(F+1)*G-K;$[0]=L*G,$[1]=se,$[2]=te,$[3]=pe};let M=new CE(w);const O=[];for(let L=0;L<w*w;L++){I(L%w,Math.floor(L/w),S,!1,O);const F=Sp(O[0],O[1],f),G=Sp(O[2],O[1],f),W=Sp(O[2],O[3],f),$=Sp(O[0],O[3],f);M.minimums.push(Math.min(F,G,W,$)),M.maximums.push(Math.max(F,G,W,$)),M.leaves.push(1)}for(y.push(M),w/=2;w>=1;w/=2){const L=y[y.length-1];M=new CE(w);for(let F=0;F<w*w;F++){I(F%w,Math.floor(F/w),2,!0,O);const G=L.getElevation(O[0],O[1]),W=L.getElevation(O[2],O[1]),$=L.getElevation(O[2],O[3]),K=L.getElevation(O[0],O[3]),te=L.isLeaf(O[0],O[1]),se=L.isLeaf(O[2],O[1]),pe=L.isLeaf(O[2],O[3]),de=L.isLeaf(O[0],O[3]),be=Math.min(G.min,W.min,$.min,K.min),Te=Math.max(G.max,W.max,$.max,K.max),ve=te&&se&&pe&&de;M.maximums.push(Te),M.minimums.push(be),M.leaves.push(Te-be<=5&&ve?1:0)}y.push(M)}return y})(this.dem),s=i.length-1,a=i[s];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,a,f,m,y=1){return IE([e,i,-100],[s,a,this.maximums[0]*y],f,m)}raycast(e,i,s,a,f,m,y=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,s,a,f,m,y);if(w==null)return null;const S=[],I=[],M=[],O=[],L=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:F,t:G,nodex:W,nodey:$,depth:K}=L.pop();if(this.leaves[F]){DE(W,$,K,e,i,s,a,M,O);const se=1<<K,pe=(W+0)/se,de=(W+1)/se,be=($+0)/se,Te=($+1)/se,ve=Sp(pe,be,this.dem)*y,Ce=Sp(de,be,this.dem)*y,ze=Sp(de,Te,this.dem)*y,it=Sp(pe,Te,this.dem)*y,Je=RE(M[0],M[1],ve,O[0],M[1],Ce,O[0],O[1],ze,f,m),tt=RE(O[0],O[1],ze,M[0],O[1],it,M[0],M[1],ve,f,m),dt=Math.min(Je!==null?Je:Number.MAX_VALUE,tt!==null?tt:Number.MAX_VALUE);if(dt!==Number.MAX_VALUE)return dt;{const ut=Gt([],f,m,G);if(PE(ve,Ce,it,ze,ME(ut[0],M[0],O[0]),ME(ut[1],M[1],O[1]))>=ut[2])return G}continue}let te=0;for(let se=0;se<this._siblingOffset.length;se++){DE((W<<1)+this._siblingOffset[se][0],($<<1)+this._siblingOffset[se][1],K+1,e,i,s,a,M,O),M[2]=-100,O[2]=this.maximums[this.childOffsets[F]+se]*y;const pe=IE(M,O,f,m);if(pe!=null){const de=pe;S[se]=de;let be=!1;for(let Te=0;Te<te&&!be;Te++)de>=S[I[Te]]&&(I.splice(Te,0,se),be=!0);be||(I[te]=se),te++}}for(let se=0;se<te;se++){const pe=I[se];L.push({idx:this.childOffsets[F]+pe,t:S[pe],nodex:(W<<1)+this._siblingOffset[pe][0],nodey:($<<1)+this._siblingOffset[pe][1],depth:K+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,a,f){if(e[a].isLeaf(i,s)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=a-1,y=e[m];let w=0,S=0;for(let I=0;I<this._siblingOffset.length;I++){const M=2*i+this._siblingOffset[I][0],O=2*s+this._siblingOffset[I][1],L=y.getElevation(M,O),F=y.isLeaf(M,O),G=this._addNode(L.min,L.max,F);F&&(w|=1<<I),S||(S=G)}for(let I=0;I<this._siblingOffset.length;I++)w&1<<I||this._construct(e,2*i+this._siblingOffset[I][0],2*s+this._siblingOffset[I][1],m,S+I)}}function PE(n,e,i,s,a,f){return vi(vi(n,i,f),vi(e,s,f),a)}function Sp(n,e,i){const s=i.dim,a=_e(n*s-.5,0,s-1),f=_e(e*s-.5,0,s-1),m=Math.floor(a),y=Math.floor(f),w=Math.min(m+1,s-1),S=Math.min(y+1,s-1);return PE(i.get(m,y),i.get(w,y),i.get(m,S),i.get(w,S),a-m,f-y)}const vO={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function xO(n,e,i){return(256*n*256+256*e+i)/10-1e4}function bO(n,e,i){return 256*n+e+i/256-32768}class k0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,a=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void bi(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const f=this.dim=i.height-2,m=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let w=0;w<f;w++)m[this._idx(-1,w)]=m[this._idx(0,w)],m[this._idx(f,w)]=m[this._idx(f-1,w)],m[this._idx(w,-1)]=m[this._idx(w,0)],m[this._idx(w,f)]=m[this._idx(w,f-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(f,-1)]=m[this._idx(f-1,0)],m[this._idx(-1,f)]=m[this._idx(0,f-1)],m[this._idx(f,f)]=m[this._idx(f-1,f-1)]}const y=s==="terrarium"?bO:xO;for(let w=0;w<m.length;++w){const S=4*w;this.floatView[w]=y(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=Qo.now()}_buildQuadTree(){this._tree=new OE(this)}get(e,i,s=!1){s&&(e=_e(e,-1,this.dim),i=_e(i,-1,this.dim));const a=this._idx(e,i);return this.floatView[a]}set(e,i,s){const a=this._idx(e,i),f=this.floatView[a];return this.floatView[a]=s,s-f}static getUnpackVector(e){return vO[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],a=k0.getUnpackVector(i);let f=Math.floor((e+a[3])/a[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new Bv({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,f=i*this.dim+this.dim,m=s*this.dim,y=s*this.dim+this.dim;switch(i){case-1:a=f-1;break;case 1:f=a+1}switch(s){case-1:m=y-1;break;case 1:y=m+1}const w=-i*this.dim,S=-s*this.dim;for(let I=m;I<y;I++)for(let M=a;M<f;M++){const O=4*this._idx(M,I),L=4*this._idx(M+w,I+S);this.pixels[O+0]=e.pixels[L+0],this.pixels[O+1]=e.pixels[L+1],this.pixels[O+2]=e.pixels[L+2],this.pixels[O+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function wO(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push((function(s,a){return s.readFields(CO,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},a)})(i,i.readVarint()+i.pos))}function TO(n,e,i){n===1?(e.delta_filter=(function(s,a){return s.readFields(SO,{blockSize:0},a)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function SO(n,e,i){n===1&&(e.blockSize=i.readVarint())}function EO(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function AO(n,e,i){let s=0,a=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push((function(f,m){return f.readFields(TO,{},m)})(i,i.readVarint()+i.pos)):n===4?e.codec=(function(f,m){return f.readFields(EO,{},m)})(i,i.readVarint()+i.pos):n===5?a=i.readFloat():n===6?s=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=a),e.scale===0&&(e.scale=s)}function CO(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push((function(s,a){return s.readFields(AO,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},a)})(i,i.readVarint()+i.pos))}function IO(n,e,i){if(n===2)(function(s,a,f){s.readFields(RO,f,a)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function RO(n,e,i){if(n===1){let s=0;const a=i.readVarint()+i.pos;for(;i.pos<a;)e[s++]=i.readVarint()}}function MO(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const a=s===1?1:0,f=s===2?1:0;for(let m=0;m<e[0];m++){const y=e[1]*m;for(let w=a;w<e[1];w++){const S=e[2]*(w+y);for(let I=f;I<e[2];I++){const M=e[3]*(I+S);for(let O=0;O<e[3];O++){const L=M+O;n[L]+=n[L-i]}}}}i*=e[s]}return n}function DO(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function OO(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const s=n[i],a=n[i+1];n[i]=(240&s)>>4|(61440&s)>>8|(240&a)<<4|61440&a,n[i+1]=15&s|(3840&s)>>4|(15&a)<<8|(3840&a)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const s=n[i],a=n[i+1],f=n[i+2],m=n[i+3];n[i+0]=(192&s)>>6|(192&a)>>4|(192&f)>>2|192&m,n[i+1]=(48&s)>>4|(48&a)>>2|48&f|(48&m)<<2,n[i+2]=(12&s)>>2|12&a|(12&f)<<2|(12&m)<<4,n[i+3]=3&s|(3&a)<<2|(3&f)<<4|(3&m)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}Mt(k0,"DEMData"),Mt(OE,"DemMinMaxQuadTree",{omit:["dem"]});var yc=Uint8Array,Zy=Uint16Array,PO=Int32Array,zE=new yc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),LE=new yc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),zO=new yc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kE=function(n,e){for(var i=new Zy(31),s=0;s<31;++s)i[s]=e+=1<<n[s-1];var a=new PO(i[30]);for(s=1;s<30;++s)for(var f=i[s];f<i[s+1];++f)a[f]=f-i[s]<<5|s;return{b:i,r:a}},BE=kE(zE,2),FE=BE.b,LO=BE.r;FE[28]=258,LO[258]=28;for(var kO=kE(LE,0).b,NE=new Zy(32768),gs=0;gs<32768;++gs){var m_=(43690&gs)>>1|(21845&gs)<<1;NE[gs]=((65280&(m_=(61680&(m_=(52428&m_)>>2|(13107&m_)<<2))>>4|(3855&m_)<<4))>>8|(255&m_)<<8)>>1}var Wy=function(n,e,i){for(var s=n.length,a=0,f=new Zy(e);a<s;++a)n[a]&&++f[n[a]-1];var m,y=new Zy(e);for(a=1;a<e;++a)y[a]=y[a-1]+f[a-1]<<1;m=new Zy(1<<e);var w=15-e;for(a=0;a<s;++a)if(n[a])for(var S=a<<4|n[a],I=e-n[a],M=y[n[a]-1]++<<I,O=M|(1<<I)-1;M<=O;++M)m[NE[M]>>w]=S;return m},Xy=new yc(288);for(gs=0;gs<144;++gs)Xy[gs]=8;for(gs=144;gs<256;++gs)Xy[gs]=9;for(gs=256;gs<280;++gs)Xy[gs]=7;for(gs=280;gs<288;++gs)Xy[gs]=8;var jE=new yc(32);for(gs=0;gs<32;++gs)jE[gs]=5;var BO=Wy(Xy,9),FO=Wy(jE,5),Kb=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},Zu=function(n,e,i){var s=e/8|0;return(n[s]|n[s+1]<<8)>>(7&e)&i},Jb=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},NO=function(n){return(n+7)/8|0},jO=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Wu=function(n,e,i){var s=new Error(e||jO[n]);if(s.code=n,Error.captureStackTrace&&Error.captureStackTrace(s,Wu),!i)throw s;return s},UO=new yc(0),VO=typeof TextDecoder<"u"&&new TextDecoder;try{VO.decode(UO,{stream:!0})}catch{}const GO={gzip_data:"gzip"};class iu extends Error{constructor(e){super(e),this.name="MRTError"}}const qO={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},UE={uint32:1,uint16:2,uint8:4},HO={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Qb;class B0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new iu(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new iu("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new iu(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const a=new Qb(i.subarray(0,s)).readFields(wO,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==a.x||this.y!==a.y||this.z!==a.z))throw new iu(`Invalid attempt to parse header ${a.z}/${a.x}/${a.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=a.x,this.y=a.y,this.z=a.z;for(const f of a.layers)this.layers[f.name]=new VE(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let a of e.blockIndices){const f=s.dataIndex[a],m=f.firstByte-e.firstByte,y=f.lastByte-e.firstByte;if(s._blocksInProgress.has(a))continue;const w={layerName:s.name,firstByte:m,lastByte:y,pixelFormat:s.pixelFormat,blockIndex:a,blockShape:[f.bands.length].concat(s.bandShape),buffer:s.buffer,codec:f.codec.codec,filters:f.filters.map(S=>S.filter)};s._blocksInProgress.add(a),i.push(w)}return new GE(i,()=>{i.forEach(a=>s._blocksInProgress.delete(a.blockIndex))},(a,f)=>{if(i.forEach(m=>s._blocksInProgress.delete(m.blockIndex)),a)throw a;f.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class VE{constructor({version:e,name:i,units:s,tileSize:a,pixelFormat:f,buffer:m,dataIndex:y},w){if(this.version=e,this.version!==1)throw new iu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=a,this.buffer=m,this.pixelFormat=qO[f],this.dataIndex=y,this.bandShape=[a+2*m,a+2*m,UE[this.pixelFormat]],this._decodedBlocks=new L0(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return UE[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,a]of this.dataIndex.entries()){for(const[f,m]of a.bands.entries())if(m===e)return{bandIndex:i+f,blockIndex:s,blockBandIndex:f};i+=a.bands.length}break;case"number":for(const[s,a]of this.dataIndex.entries()){if(e>=i&&e<i+a.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=a.bands.length}break;default:throw new iu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,s=-1/0;const a=[],f=new Set;for(const m of e){const{blockIndex:y}=this.getBlockForBand(m);if(y<0)throw new iu(`Invalid band: ${JSON.stringify(m)}`);const w=this.dataIndex[y];a.includes(y)||a.push(y),f.add(y),i=Math.min(i,w.firstByte),s=Math.max(s,w.lastByte)}if(f.size>this.cacheSize)throw new iu(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:s,blockIndices:a}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e);if(i<0)throw new iu(`Band not found: ${JSON.stringify(e)}`);const a=this._decodedBlocks.get(i.toString());if(!a)throw new iu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[i],m=this.bandShape.reduce((S,I)=>S*I,1),y=s*m,w=a.subarray(y,y+m);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}B0.setPbf=function(n){Qb=n};class GE{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}B0.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(s=>{const{layerName:a,firstByte:f,lastByte:m,pixelFormat:y,blockShape:w,blockIndex:S,filters:I,codec:M}=s,O=i.subarray(f,m+1),L=new Uint32Array(w[0]*w[1]*w[2]);let F;if(M!=="gzip_data")throw new iu(`Unhandled codec: ${M}`);return F=(function(G,W){if(!globalThis.DecompressionStream&&W==="gzip_data")return Promise.resolve((pe=(function(Te){Te[0]==31&&Te[1]==139&&Te[2]==8||Wu(6,"invalid gzip data");var ve=Te[3],Ce=10;4&ve&&(Ce+=2+(Te[10]|Te[11]<<8));for(var ze=(ve>>3&1)+(ve>>4&1);ze>0;ze-=!Te[Ce++]);return Ce+(2&ve)})($=G),pe+8>$.length&&Wu(6,"invalid gzip data"),(function(Te,ve,Ce,ze){var it=Te.length;if(!it||ve.f&&!ve.l)return Ce||new yc(0);var Je=!Ce,tt=Je||ve.i!=2,dt=ve.i;Je&&(Ce=new yc(3*it));var ut=function(ua){var td=Ce.length;if(ua>td){var Go=new yc(Math.max(2*td,ua));Go.set(Ce),Ce=Go}},ht=ve.f||0,Ye=ve.p||0,mt=ve.b||0,at=ve.l,_t=ve.d,ft=ve.m,$t=ve.n,Wt=8*it;do{if(!at){ht=Zu(Te,Ye,1);var Ft=Zu(Te,Ye+1,3);if(Ye+=3,!Ft){var jt=Te[(gn=NO(Ye)+4)-4]|Te[gn-3]<<8,di=gn+jt;if(di>it){dt&&Wu(0);break}tt&&ut(mt+jt),Ce.set(Te.subarray(gn,di),mt),ve.b=mt+=jt,ve.p=Ye=8*di,ve.f=ht;continue}if(Ft==1)at=BO,_t=FO,ft=9,$t=5;else if(Ft==2){var ni=Zu(Te,Ye,31)+257,qt=Zu(Te,Ye+10,15)+4,Ai=ni+Zu(Te,Ye+5,31)+1;Ye+=14;for(var Xi=new yc(Ai),yn=new yc(19),qi=0;qi<qt;++qi)yn[zO[qi]]=Zu(Te,Ye+3*qi,7);Ye+=3*qt;var Ln=Kb(yn),hn=(1<<Ln)-1,Fr=Wy(yn,Ln);for(qi=0;qi<Ai;){var gn,Pn=Fr[Zu(Te,Ye,hn)];if(Ye+=15&Pn,(gn=Pn>>4)<16)Xi[qi++]=gn;else{var sr=0,pr=0;for(gn==16?(pr=3+Zu(Te,Ye,3),Ye+=2,sr=Xi[qi-1]):gn==17?(pr=3+Zu(Te,Ye,7),Ye+=3):gn==18&&(pr=11+Zu(Te,Ye,127),Ye+=7);pr--;)Xi[qi++]=sr}}var mr=Xi.subarray(0,ni),Nr=Xi.subarray(ni);ft=Kb(mr),$t=Kb(Nr),at=Wy(mr,ft),_t=Wy(Nr,$t)}else Wu(1);if(Ye>Wt){dt&&Wu(0);break}}tt&&ut(mt+131072);for(var Ks=(1<<ft)-1,Eo=(1<<$t)-1,ls=Ye;;ls=Ye){var _s=(sr=at[Jb(Te,Ye)&Ks])>>4;if((Ye+=15&sr)>Wt){dt&&Wu(0);break}if(sr||Wu(2),_s<256)Ce[mt++]=_s;else{if(_s==256){ls=Ye,at=null;break}var Os=_s-254;_s>264&&(Os=Zu(Te,Ye,(1<<(Ir=zE[qi=_s-257]))-1)+FE[qi],Ye+=Ir);var Gi=_t[Jb(Te,Ye)&Eo],gr=Gi>>4;if(Gi||Wu(3),Ye+=15&Gi,Nr=kO[gr],gr>3){var Ir=LE[gr];Nr+=Jb(Te,Ye)&(1<<Ir)-1,Ye+=Ir}if(Ye>Wt){dt&&Wu(0);break}tt&&ut(mt+131072);var pl=mt+Os;if(mt<Nr){var ca=0-Nr,Js=Math.min(Nr,pl);for(ca+mt<0&&Wu(3);mt<Js;++mt)Ce[mt]=ze[ca+mt]}for(;mt<pl;++mt)Ce[mt]=Ce[mt-Nr]}}ve.l=at,ve.p=ls,ve.b=mt,ve.f=ht,at&&(ht=1,ve.m=ft,ve.d=_t,ve.n=$t)}while(!ht);return mt!=Ce.length&&Je?(function(ua,td,Go){return(Go==null||Go>ua.length)&&(Go=ua.length),new yc(ua.subarray(0,Go))})(Ce,0,mt):Ce.subarray(0,mt)})($.subarray(pe,-8),{i:2},new yc(((te=$)[(se=te.length)-4]|te[se-3]<<8|te[se-2]<<16|te[se-1]<<24)>>>0),K)));var $,K,te,se,pe;const de=GO[W];if(!de)throw new Error(`Unhandled codec: ${W}`);const be=new globalThis.DecompressionStream(de);return new Response(new Blob([G]).stream().pipeThrough(be)).arrayBuffer().then(Te=>new Uint8Array(Te))})(O,M).then(G=>((function(W,$){W.readFields(IO,$)})(new Qb(G),L),new HO[y](L.buffer))),F.then(G=>{for(let W=I.length-1;W>=0;W--)switch(I[W]){case"delta_filter":MO(G,w);break;case"zigzag_filter":DO(G);break;case"bitshuffle_filter":OO(G,y);break;default:throw new iu(`Unhandled filter "${I[W]}"`)}return{layerName:a,blockIndex:S,data:G}}).catch(G=>{throw G})}))},Mt(GE,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Mt(B0,"MapboxRasterTile"),Mt(VE,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class qE{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class HE{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ol(zt,16,0),this.featureIndexArray=new dc,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,s,a,f,m=0,y=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,a,f,m);const S=this.grid;for(let I=0;I<i.length;I++){const M=i[I],O=[1/0,1/0,-1/0,-1/0];for(let L=0;L<M.length;L++){const F=M[L];O[0]=Math.min(O[0],F.x),O[1]=Math.min(O[1],F.y),O[2]=Math.max(O[2],F.x),O[3]=Math.max(O[3],F.y)}y!==0&&(O[0]-=y,O[1]-=y,O[2]+=y,O[3]+=y),O[0]<zt&&O[1]<zt&&O[2]>=0&&O[3]>=0&&S.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new an(new p0(this.rawTileData)).layers,this.sourceLayerCoder=new qE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:s,transform:a,tileTransform:f,pixelPosMatrix:m,availableImages:y,worldview:w}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const S=i.queryRadius?i.queryRadius:0,I=s.bufferedTilespaceBounds,M=this.grid.query(I.min.x,I.min.y,I.max.x,I.max.y,(G,W,$,K)=>ba(s.bufferedTilespaceGeometry,G-S,W-S,$+S,K+S));M.sort($O);let O=null;a.elevation&&M.length>0&&(O=d_.create(a.elevation,this.tileID));const L={};let F;for(let G=0;G<M.length;G++){const W=M[G];if(W===F)continue;F=W;const $=this.featureIndexArray.get(W);let K=null;this.is3DTile?this.loadMatchingModelFeature(L,$,e,s,a,w):this.loadMatchingFeature(L,$,e,y,w,(te,se,pe,de=0)=>(K||(K=_i(te,this.tileID.canonical,f)),se.queryIntersectsFeature(s,te,pe,K,this.z,a,m,O,de,i.scope)))}return L}loadMatchingFeature(e,i,s,a,f,m){const{featureIndex:y,bucketIndex:w,sourceLayerIndex:S,layoutVertexArrayOffset:I}=i,M=this.bucketLayerIDs[w],O=s.layers,L=Object.keys(O);if(L.length&&!ji(L,M))return;const F=s.sourceCache,G=this.sourceLayerCoder.decode(S),W=this.vtLayers[G].feature(y),$=this.getId(W,G);for(let K=0;K<M.length;K++){const te=M[K];if(!O[te])continue;const{styleLayer:se,targets:pe}=O[te];let de={};$!==void 0&&(de=F.getFeatureState(se.sourceLayer,$));const be=!m||m(W,se,de,I);if(!be)continue;const Te=new eg(W,this.z,this.x,this.y,$);Te.tile=this.tileID.canonical,Te.state=de;let ve=this.serializedLayersCache.get(te);ve||(ve=se.serialize(),ve.id=te,this.serializedLayersCache.set(te,ve)),Te.source=ve.source,Te.sourceLayer=ve["source-layer"],Te.layer=Object.assign({},ve),Te.layer.paint=$E(ve.paint,se.paint,W,de,a),Te.layer.layout=$E(ve.layout,se.layout,W,de,a);let Ce=!1;for(const ze of pe){this.updateFeatureProperties(Te,ze);const{filter:it}=ze;if(it){if(W.properties=Te.properties,it.needGeometry){const Je=Pi(W,!0);if(!it.filter(new bn(this.tileID.overscaledZ,{worldview:f}),Je,this.tileID.canonical))continue}else if(!it.filter(new bn(this.tileID.overscaledZ,{worldview:f}),W))continue}Ce=!0,ze.targetId&&this.addFeatureVariant(Te,ze)}Ce&&this.appendToResult(e,te,y,Te,be)}}loadMatchingModelFeature(e,i,s,a,f,m){const{featureIndex:y,bucketIndex:w}=i,S=this.bucketLayerIDs[w],I=s.layers,M=Object.keys(I);if(!M.length||ji(M,S))for(let O=0;O<S.length;O++){const L=S[O],{styleLayer:F,targets:G}=I[L];if(F.type!=="model")continue;const W=a.tile,$=W.getBucket(F);if(!($&&$ instanceof D0))continue;const K=QD($,y,a,f);if(!K)continue;const{z:te,x:se,y:pe}=W.tileID.canonical,{feature:de,intersectionZ:be,position:Te}=K;let ve={};de.id!==void 0&&(ve=s.sourceCache.getFeatureState(F.sourceLayer,de.id));const Ce=new eg({},te,se,pe,de.id);Ce.tile=this.tileID.canonical,Ce.state=ve,Ce.properties=de.properties,Ce.geometry={type:"Point",coordinates:[Te.lng,Te.lat]};let ze=this.serializedLayersCache.get(L);ze||(ze=F.serialize(),ze.id=L,this.serializedLayersCache.set(L,ze)),Ce.source=ze.source,Ce.sourceLayer=ze["source-layer"],Ce.layer=Object.assign({},ze);let it=!1;for(const Je of G){this.updateFeatureProperties(Ce,Je);const{filter:tt}=Je;if(tt){if(de.properties=Ce.properties,tt.needGeometry){if(!tt.filter(new bn(this.tileID.overscaledZ,{worldview:m}),de,this.tileID.canonical))continue}else if(!tt.filter(new bn(this.tileID.overscaledZ,{worldview:m}),de))continue}it=!0,Je.targetId&&this.addFeatureVariant(Ce,Je)}it&&this.appendToResult(e,L,y,Ce,be)}}updateFeatureProperties(e,i,s){if(i.properties){const a={};for(const f in i.properties){const m=i.properties[f].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,s);m!=null&&(a[f]=m)}e.properties=a}}addFeatureVariant(e,i,s){const a={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(a.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(a)}appendToResult(e,i,s,a,f){let m=e[i];m===void 0&&(m=e[i]=[]),m.push({featureIndex:s,feature:a,intersectionZ:f})}lookupSymbolFeatures(e,i,s,a,f,m){const y={};this.loadVTLayers();for(const w of e)this.loadMatchingFeature(y,{bucketIndex:i,sourceLayerIndex:s,featureIndex:w,layoutVertexArrayOffset:0},a,f,m);return y}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(s),f=this.vtFeatures[a];if(f[i])return f[i];const m=this.vtLayers[a].feature(i);return f[i]=m,m}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const a=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(a!=null)if(Array.isArray(a)){if(!this.promoteIdExpression){const f=Dl(a);if(f.result!=="success"){const m=f.value.map(y=>`${y.key}: ${y.message}`).join(", ");return void bi(`Failed to create expression for promoteId: ${m}`)}this.promoteIdExpression=f.value}s=this.promoteIdExpression.evaluate({zoom:0},e)}else s=e.properties[a];typeof s=="boolean"&&(s=Number(s))}return s}}function $E(n,e,i,s,a){return oi(n,(f,m)=>{const y=e instanceof ho?e.get(m):null;return y&&y.evaluate?y.evaluate(i,s,void 0,a):y})}function $O(n,e){return e-n}Mt(HE,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const ZE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ew{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=s>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const f=ZE[15&s];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new ew(y,m,f,e)}constructor(e,i=64,s=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=ZE.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${s}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return tw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:y}=this,w=[0,f.length-1,0],S=[];for(;w.length;){const I=w.pop()||0,M=w.pop()||0,O=w.pop()||0;if(M-O<=y){for(let W=O;W<=M;W++){const $=m[2*W],K=m[2*W+1];$>=e&&$<=s&&K>=i&&K<=a&&S.push(f[W])}continue}const L=O+M>>1,F=m[2*L],G=m[2*L+1];F>=e&&F<=s&&G>=i&&G<=a&&S.push(f[L]),(I===0?e<=F:i<=G)&&(w.push(O),w.push(L-1),w.push(1-I)),(I===0?s>=F:a>=G)&&(w.push(L+1),w.push(M),w.push(1-I))}return S}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:f,nodeSize:m}=this,y=[0,a.length-1,0],w=[],S=s*s;for(;y.length;){const I=y.pop()||0,M=y.pop()||0,O=y.pop()||0;if(M-O<=m){for(let W=O;W<=M;W++)XE(f[2*W],f[2*W+1],e,i)<=S&&w.push(a[W]);continue}const L=O+M>>1,F=f[2*L],G=f[2*L+1];XE(F,G,e,i)<=S&&w.push(a[L]),(I===0?e-s<=F:i-s<=G)&&(y.push(O),y.push(L-1),y.push(1-I)),(I===0?e+s>=F:i+s>=G)&&(y.push(L+1),y.push(M),y.push(1-I))}return w}}function tw(n,e,i,s,a,f){if(a-s<=i)return;const m=s+a>>1;WE(n,e,m,s,a,f),tw(n,e,i,s,m-1,1-f),tw(n,e,i,m+1,a,1-f)}function WE(n,e,i,s,a,f){for(;a>s;){if(a-s>600){const S=a-s+1,I=i-s+1,M=Math.log(S),O=.5*Math.exp(2*M/3),L=.5*Math.sqrt(M*O*(S-O)/S)*(I-S/2<0?-1:1);WE(n,e,i,Math.max(s,Math.floor(i-I*O/S+L)),Math.min(a,Math.floor(i+(S-I)*O/S+L)),f)}const m=e[2*i+f];let y=s,w=a;for(Yy(n,e,s,i),e[2*a+f]>m&&Yy(n,e,s,a);y<w;){for(Yy(n,e,y,w),y++,w--;e[2*y+f]<m;)y++;for(;e[2*w+f]>m;)w--}e[2*s+f]===m?Yy(n,e,s,w):(w++,Yy(n,e,w,a)),w<=i&&(s=w+1),i<=w&&(a=w-1)}}function Yy(n,e,i,s){iw(n,i,s),iw(e,2*i,2*s),iw(e,2*i+1,2*s+1)}function iw(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}function XE(n,e,i,s){const a=n-i,f=e-s;return a*a+f*f}r.$=Cf,r.A=Cs,r.B=nl,r.C=2,r.D=e_,r.E=$l,r.F=Py,r.G=yS,r.H=dh,r.I=so,r.J=pm,r.K=xi,r.L=gi,r.M=xu,r.N=Rh,r.O=ac,r.P=pt,r.Q=Su,r.R=es,r.S=Jf,r.T=hb,r.U=Dl,r.V=M0,r.W=el,r.X=wr,r.Y=gu,r.Z=fs,r._=Po,r.a=function(n){return Qr.API_CDN_URL_REGEX.test(n)},r.a$=ct,r.a0=fh,r.a1=xg,r.a2=Gd,r.a3=class extends M0{},r.a4=Mh,r.a5=Ml,r.a6=qe,r.a7=function(n){const e=n.value;return e?fh(e)?Gb(e,!0)?[]:[new M0(n.key,e,`invalid url "${e}"`)]:[new M0(n.key,e,`string expected, "${xi(e)}" found`)]:[]},r.a8=Ph,r.a9=nr,r.aA=_e,r.aB=Ge,r.aC=Ss,r.aD=Y,r.aE=Uo,r.aF=Be,r.aG=Et,r.aH=function(n,e){const i={};for(let s=0;s<e.length;s++){const a=e[s];a in n&&(i[a]=n[a])}return i},r.aI=De,r.aJ=He,r.aK=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,s){const a=this.entries[n]=this.entries[n]||{callbacks:[]};if(a.result){const[f,m]=a.result;return this.scheduler?this.scheduler.add(()=>{s(f,m)},e):s(f,m),()=>{}}return a.callbacks.push(s),a.cancel||(a.cancel=i((f,m)=>{a.result=[f,m];for(const y of a.callbacks)this.scheduler?this.scheduler.add(()=>{y(f,m)},e):y(f,m);setTimeout(()=>delete this.entries[n],3e3)})),()=>{a.result||(a.callbacks=a.callbacks.filter(f=>f!==s),a.callbacks.length||(a.cancel(),delete this.entries[n]))}}},r.aL=function(n,e,i){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},a=>{const f=ou(n.request,(m,y,w)=>{m?a(m):y&&a(null,{rawData:y,vectorTile:i?void 0:new an(new p0(y)),responseHeaders:new Map(w.entries())})});return()=>{f.cancel(),a()}},e)},r.aM=function(n){return n?{cacheControl:n.get("Cache-Control"),expires:n.get("Expires")}:{cacheControl:void 0,expires:void 0}},r.aN=su,r.aO=function(n){Ma++,Ma>xf&&(n.getActor().send("enforceCacheSizeLimit",Vp),Ma=0)},r.aP=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log2(n)))},r.aQ=ks,r.aR=KS,r.aS=nE,r.aT=fe,r.aU=YS,r.aV=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<n.length;s++){const a=document.createElement("source");bf(n[s])||(i.crossOrigin="Anonymous"),a.src=n[s],i.appendChild(a)}return{cancel:()=>{}}},r.aW=Iy,r.aX=tg,r.aY=Zt,r.aZ=ky,r.a_=Qe,r.aa=Dt,r.ab=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return Qn(n.expression.evaluate(e))}interpolate(n,e,i){return{x:vi(n.x,e.x,i),y:vi(n.y,e.y,i),z:vi(n.z,e.z,i),azimuthal:vi(n.azimuthal,e.azimuthal,i),polar:vi(n.polar,e.polar,i)}}},r.ac=bn,r.ad=Ws,r.ae=kt,r.af=vn,r.ag=Si,r.ah=ke,r.ai=ho,r.aj=Vu,r.ak=vi,r.al=zt,r.am=Zp,r.an=Ni,r.ao=xn,r.ap=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return(function([i,s]){const a=Qn([1,i,s]);return{x:a.x,y:a.y,z:a.z}})(n.expression.evaluate(e))}interpolate(n,e,i){return{x:vi(n.x,e.x,i),y:vi(n.y,e.y,i),z:vi(n.z,e.z,i)}}},r.aq=function(n,e,i=0,s=!0){const a=new pt(i,i),f=n.sub(a),m=e.add(a),y=[f,new pt(m.x,f.y),m,new pt(f.x,m.y)];return s&&y.push(f.clone()),y},r.ar=function(n,e){const i=[];for(let s=0;s<n.length;s++){const a=We(s-1,-1,n.length-1),f=We(s+1,-1,n.length-1),m=n[s],y=n[f],w=n[a].sub(m).unit(),S=y.sub(m).unit(),I=S.angleWithSep(w.x,w.y),M=w.add(S).unit().mult(-1*e/Math.sin(I/2));i.push(m.add(M))}return i},r.as=LS,r.at=ba,r.au=function(n,e,i=0){return Xe(((e.x-i)*n.scale-n.x)*zt,(e.y*n.scale-n.y)*zt,$e(e.z,e.y))},r.av=Cn,r.aw=fi,r.ax=Bn,r.ay=ZT,r.az=function(n){let e=1/0,i=1/0,s=-1/0,a=-1/0;for(const f of n)e=Math.min(e,f.x),i=Math.min(i,f.y),s=Math.max(s,f.x),a=Math.max(a,f.y);return{min:new pt(e,i),max:new pt(s,a)}},r.b=function(n){return Qr.API_FONTS_REGEX.test(n)},r.b$=j,r.b0=Kr,r.b1=Ll,r.b2=At,r.b3=sp,r.b4=A0,r.b5=function(){na.isLoading()||na.isLoaded()||qc()!=="deferred"||Yf()},r.b6=Qf,r.b7=Pi,r.b8=eg,r.b9=Kn,r.bA=Re,r.bB=Tt,r.bC=Ae,r.bD=function(n,e){const{x:i,y:s}=n.point,a=jg(i,s,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Ge(a,a,$n(gc(e)))},r.bE=ie,r.bF=Gs,r.bG=ci,r.bH=Gt,r.bI=Fi,r.bJ=Ri,r.bK=a_,r.bL=fl,r.bM=Ib,r.bN=function(n,e,i,s,a){const f=5*e+2;n.float32[f+0]=i,n.float32[f+1]=s,n.float32[f+2]=a},r.bO=h_,r.bP=Gr,r.bQ=Io,r.bR=Ko,r.bS=Mn,r.bT=We,r.bU=function(n,e,i,s){var a=new H(4);return a[0]=n,a[1]=e,a[2]=i,a[3]=s,a},r.bV=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,a=Math.floor(n.x),f=Math.floor((n.x-a)*s),m=Math.floor(n.y*s),y=this.findDEMTileFor(new ks(i,a,i,f,m));return!(!y||!y.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const a=s.getSource().maxzoom,f=1<<a,m=Math.floor(n.x),y=n.x-m,w=new ks(a,m,a,Math.floor(y*f),Math.floor(n.y*f)),S=this.findDEMTileFor(w);if(!S||!S.dem)return e;const I=S.dem,M=1<<S.tileID.canonical.z,O=(y*M-S.tileID.canonical.x)*I.dim,L=(n.y*M-S.tileID.canonical.y)*I.dim,F=Math.floor(O),G=Math.floor(L);return(i?this.exaggeration():1)*vi(vi(I.get(F,G),I.get(F,G+1),L-G),vi(I.get(F+1,G),I.get(F+1,G+1),L-G),O-F)}static getAtTileOffset(n,e,i,s){const a=1<<n.canonical.z;return s?s.pointElevation(e):i?i.getAtPointOrZero(new kt(n.wrap+(n.canonical.x+e.x/zt)/a,(n.canonical.y+e.y/zt)/a)):0}static getAtTileOffsetFunc(n,e,i,s){return(a,f,m)=>{const y=this.getAtTileOffset(n,a,f,m),w=s.upVector(n.canonical,a.x,a.y);return bt(w,w,y*s.upVectorScale(n.canonical,e,i).metersToTile),w}}getForTilePoints(n,e,i,s){if(this.isUsingMockSource())return!1;const a=d_.create(this,n,s);return!!a&&(e.forEach(f=>{f[2]=this.exaggeration()*a.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,a=1<<n.canonical.z-s.canonical.z;let f=n.canonical.x/a-s.canonical.x,m=n.canonical.y/a-s.canonical.y,y=0;for(let w=0;w<n.canonical.z-s.canonical.z&&!i.leaves[y];w++){f*=2,m*=2;const S=2*Math.floor(m)+Math.floor(f);y=i.childOffsets[y]+S,f%=1,m%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const a of n){const f=this.getMinMaxForTile(a.tileID);f&&(i=Math.min(i,f.min),s=Math.max(s,f.max),e=!0)}return e?{min:i,max:s}:null}},r.bW=n0,r.bX=rr,r.bY=Bs,r.bZ=Hm,r.b_=rE,r.ba=xb,r.bb=tu,r.bc=_i,r.bd=hc,r.be=Uh,r.bf=Q_,r.bg=Wn,r.bh=hl,r.bi=Ub,r.bj=function(n,e){const i=Vu(e.zoom);if(i===0)return gc(n);const s=up(n),a=ty(s),f=Be(s.getWest())*e.worldSize,m=Be(s.getEast())*e.worldSize,y=He(s.getNorth())*e.worldSize,w=He(s.getSouth())*e.worldSize,S=[f,y,0],I=[m,y,0],M=[f,w,0],O=[m,w,0],L=Ne([],e.globeMatrix);return vn(S,S,L),vn(I,I,L),vn(M,M,L),vn(O,O,L),a[0]=Kc(a[0],M,i),a[1]=Kc(a[1],O,i),a[2]=Kc(a[2],I,i),a[3]=Kc(a[3],S,i),mn.fromPoints(a)},r.bk=Mm,r.bl=Ne,r.bm=Rm,r.bn=Kc,r.bo=rl,r.bp=qx,r.bq=Ht,r.br=Ue,r.bs=B0,r.bt=p0,r.bu=ou,r.bv=function(n,e){const i=[];for(const s in n)s in e||i.push(s);return i},r.bw=je,r.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.by=Yn,r.bz=he,r.c=qs,r.c$=function(n,e,i){let s=0;for(let a=0;a<2;++a)n[a]>0&&(s+=(n[a]-0)*(n[a]-0)),e[a]<0&&(s+=(0-e[a])*(0-e[a]));return s},r.c0=oe,r.c1=Eb,r.c2=AS,r.c3=Pb,r.c4=ew,r.c5=bt,r.c6=Ts,r.c7=Xo,r.c8=function(n,e,i){i*=.5;var s=e[0],a=e[1],f=e[2],m=e[3],y=Math.sin(i),w=Math.cos(i);return n[0]=s*w+a*y,n[1]=a*w-s*y,n[2]=f*w+m*y,n[3]=m*w-f*y,n},r.c9=io,r.cA=si,r.cB=as,r.cC=OT,r.cD=Fl,r.cE=Ng,r.cF=function(n,e,i,s,a,f,m,y,w){if(w.name==="globe")return Ng(n,e,new Fl(i,s,a),!1);const S=ky({z:i,x:s,y:a},w);return new mn([(f+S.x/S.scale)*e,e*(S.y/S.scale),m],[(f+S.x2/S.scale)*e,e*(S.y2/S.scale),y])},r.cG=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},r.cH=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},r.cI=function(n){const e=Math.round((n+45+360)%360/90)%4;return J[e]},r.cJ=Oe,r.cK=_r,r.cL=6,r.cM=function(n){const e=Re(new Float64Array(16));Ge(e,n.pixelMatrix,n.globeMatrix);const i=[0,ce,0],s=[0,ae,0];return vn(i,i,e),vn(s,s,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!rf(n,new fe(n.center.lat,90)),s[0]>0&&s[0]<=n.width&&s[1]>0&&s[1]<=n.height&&!rf(n,new fe(n.center.lat,-90))]},r.cN=function(n,e){const{scale:i}=n.tileTransform,s=i*zt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return(function(a,f,m){var y=f[1],w=f[2],S=f[3],I=m[0],M=m[1];return a[0]=f[0]*I,a[1]=y*I,a[2]=w*M,a[3]=S*M,a})(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},r.cO=l0,r.cP=Ui,r.cQ=DT,r.cR=function(n){const e=DT(n,!0);return ie([],[e[0],e[1],e[4],e[5]])},r.cS=rt,r.cT=dr,r.cU=Pt,r.cV=function(n){const{x:e,y:i}=n.point,{lng:s,lat:a}=n._center;return jg(e,i,n.worldSize,s,a)},r.cW=Ci,r.cX=Le,r.cY=Zh,r.cZ=ul,r.c_=5,r.ca=ir,r.cb=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},r.cc=en,r.cd=function(n,e,i,s,a){var f=1/Math.tan(e/2);if(n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,a!=null&&a!==1/0){var m=1/(s-a);n[10]=(a+s)*m,n[14]=2*a*s*m}else n[10]=-1,n[14]=-2*s;return n},r.ce=function(n,e,i,s,a,f,m){var y=1/(e-i),w=1/(s-a),S=1/(f-m);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*S,n[11]=0,n[12]=(e+i)*y,n[13]=(a+s)*w,n[14]=(m+f)*S,n[15]=1,n},r.cf=Ve,r.cg=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},r.ch=Er,r.ci=Hh,r.cj=Hr,r.ck=oa,r.cl=Nu,r.cm=jS,r.cn=function(){var n=new H(4);return H!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},r.co=function(n,e,i){var s=e[0],a=e[1],f=e[2],m=e[3],y=Math.sin(i),w=Math.cos(i);return n[0]=s*w+f*y,n[1]=a*w+m*y,n[2]=s*-y+f*w,n[3]=a*-y+m*w,n},r.cp=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},r.cq=Jr,r.cr=function(n){var e=n[0],i=n[1],s=n[2],a=n[3];return Math.sqrt(e*e+i*i+s*s+a*a)},r.cs=Yo,r.ct=Vs,r.cu=Fg,r.cv=3,r.cw=2,r.cx=7,r.cy=6,r.cz=Oi,r.d=function(n){return Qr.API_TILEJSON_REGEX.test(n)},r.d$=class{constructor(n,e,i,s){this.context=n,this.format=s,this.size=i,this.texture=n.gl.createTexture();const[a,f,m]=this.size,{gl:y}=n;y.bindTexture(y.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&y.texImage3D(y.TEXTURE_3D,0,this.format,a,f,m,0,cb(this.format),ub(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_3D,this.texture),n!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,n),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},r.d0=function(n){return n*n*n*n*n},r.d1=Pe,r.d2=45,r.d3=Lr,r.d4=function(n,e,i){const s=Math.sqrt(n*n+e*e+i*i),a=s>0?Math.acos(i/s)*vr:0;let f=n!==0||e!==0?Math.atan2(-e,-n)*vr+90:0;return f<0&&(f+=360),[s,f,a]},r.d5=Xe,r.d6=Qn,r.d7=St,r.d8=yt,r.d9=mn,r.dA=function(n){return n({pluginStatus:uo,pluginURL:uc}),Xf.on("pluginStateChange",n),n},r.dB=Fo,r.dC=class extends Na{constructor(n){super(n),this.current=K_}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.dD=re,r.dE=function(n,e,i){const s=Vu(i.zoom),a=n.style.map._antialias,f=n.terrain&&n.terrain.exaggeration()>0;return s===0&&!a&&!f},r.dF=function(n){const e=n.pixelsPerMeter,i=e/Ve(1,n.center.lat),s=Re(new Float64Array(16));return Ue(s,s,[n.point.x,n.point.y,0]),rt(s,s,[i,i,e]),Float32Array.from(s)},r.dG=up,r.dH=function(n){const e=80.051129;n=_e(n,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Ni(n))),3);return Math.round(i*(ue.length-1))},r.dI=function(n,e,i,s){const a=e.getNorth(),f=e.getSouth(),m=e.getWest(),y=e.getEast(),w=1<<n.z,S=y-m,I=a-f,M=S/ne,O=-I/ue[i],L=[0,M,0,O,0,0,a,m,0];if(n.z>0){const F=180/s;we(L,L,[F/S+1,0,0,0,F/I+1,0,-.5*F/M,.5*F/O,1])}return L[2]=w,L[5]=n.x,L[8]=n.y,L},r.dJ=gc,r.dK=function(n,e,i){const s=Re(new Float64Array(16)),a=(e/(1<<n)-.5)*Math.PI*2;return Bt(s,i.globeMatrix,a),Float32Array.from(s)},r.dL=Bv,r.dM=Cm,r.dN=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},r.dO=Q,r.dP=function(n,e){var i=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=i,n[2]=0,n[3]=-i,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},r.dQ=Mr,r.dR=Om,r.dS=Un,r.dT=br,r.dU=256,r.dV=function(n,e){const i=[0,0,0];return vn(i,i,Mm(gc(e.canonical))),vn(i,i,n),i},r.dW=n=>({u_matrix:new Nu(n),u_texsize:new oa(n),u_pixels_to_tile_units:new t(n),u_device_pixel_ratio:new Hr(n),u_width_scale:new Hr(n),u_floor_width_scale:new Hr(n),u_image:new Er(n),u_units_to_pixels:new oa(n),u_tile_units_to_pixels:new Hr(n),u_alpha_discard_threshold:new Hr(n),u_trim_offset:new oa(n),u_trim_fade_range:new oa(n),u_trim_gradient_mix_range:new oa(n),u_trim_color:new Lr(n),u_zbias_factor:new Hr(n),u_tile_to_meter:new Hr(n),u_ground_shadow_factor:new Hh(n),u_pattern_transition:new Hr(n)}),r.dX=n=>({u_matrix:new Nu(n),u_pixels_to_tile_units:new t(n),u_device_pixel_ratio:new Hr(n),u_width_scale:new Hr(n),u_floor_width_scale:new Hr(n),u_units_to_pixels:new oa(n),u_dash_image:new Er(n),u_gradient_image:new Er(n),u_image_height:new Hr(n),u_texsize:new oa(n),u_tile_units_to_pixels:new Hr(n),u_alpha_discard_threshold:new Hr(n),u_trim_offset:new oa(n),u_trim_fade_range:new oa(n),u_trim_gradient_mix_range:new oa(n),u_trim_color:new Lr(n),u_zbias_factor:new Hr(n),u_tile_to_meter:new Hr(n),u_ground_shadow_factor:new Hh(n)}),r.dY=n=>({u_camera_to_center_distance:new Hr(n),u_extrude_scale:new t(n),u_device_pixel_ratio:new Hr(n),u_matrix:new Nu(n),u_inv_rot_matrix:new Nu(n),u_merc_center:new oa(n),u_tile_id:new Hh(n),u_zoom_transition:new Hr(n),u_up_dir:new Hh(n),u_emissive_strength:new Hr(n)}),r.dZ=Kd,r.d_=nD,r.da=mi,r.db=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},r.dc=MT,r.dd=_b,r.de=LT,r.df=Gb,r.dg=function(n,e){return n.readFields(tO,{icons:[]},e)},r.dh=r0,r.di=l_,r.dj=Mb,r.dk=ql,r.dl=um,r.dm=vl,r.dn=xl,r.dp=Mi,r.dq=function(n){const e=n.indexOf(Lh);return e>=0?n.slice(0,e):n},r.dr=function(n){return n.indexOf(Lh)>=0},r.ds=function(n){const e=n.lastIndexOf(Lh);return e>=0?n.slice(e+1):""},r.dt=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.du=function(n,e,i,s){return n.type==="custom"?new XD(n,e):new eO[n.type](n,e,i,s)},r.dv=hi,r.dw=function(n){const e=n.indexOf(Lh);return e>=0?n.slice(e+1):""},r.dx=class extends eg{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},r.dy=Xf,r.dz=yo,r.e=Qr,r.e$=gt,r.e0=Pv,r.e1=(n,e,i,s,a,f)=>{const m=n.transform,y=m.projection.name==="globe";let w;if(f.paint.get("circle-pitch-alignment")==="map")if(y){const I=Om(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;w=Float32Array.from([I,0,0,I])}else w=m.calculatePixelsToTileUnitsMatrix(i);else w=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(m.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Qo.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:Zx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(y){S.u_inv_rot_matrix=s,S.u_merc_center=a,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=Vu(m.zoom);const I=a[0]*zt,M=a[1]*zt;S.u_up_dir=m.projection.upVector(new Fl(0,0,0),I,M)}return S},r.e2=KT,r.e3=Oo,r.e4=(n,e,i,s,a,f,m,y,w,S)=>{const I=n.transform,M=I.pitch<15?WT(.07,.7,_e((14-I.zoom)/5,0,1)):.07,O=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:YT(n,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_width_scale:f,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:XT(e,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(O?null:i.lut).toArray01(),u_zbias_factor:M,u_tile_to_meter:St(e.tileID.canonical,0),u_ground_shadow_factor:w,u_pattern_transition:S}},r.e5=(n,e,i,s,a,f,m,y,w,S)=>{const I=n.transform,M=I.calculatePixelsToTileUnitsMatrix(e),O=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",L=I.pitch<15?WT(.07,.7,_e((14-I.zoom)/5,0,1)):.07;return{u_matrix:YT(n,e,i,s),u_pixels_to_tile_units:M,u_device_pixel_ratio:f,u_width_scale:m,u_floor_width_scale:y,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:JT(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:XT(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(O?null:i.lut).toArray01(),u_zbias_factor:L,u_tile_to_meter:St(e.tileID.canonical,0),u_ground_shadow_factor:S}},r.e6=vt,r.e7=hp,r.e8=$e,r.e9=Wh,r.eA=function(n,e){var i=2*Math.acos(e[3]),s=Math.sin(i/2);return s>q?(n[0]=e[0]/s,n[1]=e[1]/s,n[2]=e[2]/s):(n[0]=1,n[1]=0,n[2]=0),i},r.eB=$b,r.eC=h0,r.eD=u0,r.eE=[1,1,1],r.eF=d_,r.eG=Aa,r.eH=function(n,e,i,s){var a=e[0],f=e[1],m=e[2],y=e[3];return n[0]=a+s*(i[0]-a),n[1]=f+s*(i[1]-f),n[2]=m+s*(i[2]-m),n[3]=y+s*(i[3]-y),n},r.eI=r_,r.eJ=xa,r.eK=Xc,r.eL=function(n,e,i,s,a,f,m,y,w,S,I,M,O,L,F,G){var W=new H(16);return W[0]=n,W[1]=e,W[2]=i,W[3]=s,W[4]=a,W[5]=f,W[6]=m,W[7]=y,W[8]=w,W[9]=S,W[10]=I,W[11]=M,W[12]=O,W[13]=L,W[14]=F,W[15]=G,W},r.eM=Se,r.eN=ku,r.eO=jh,r.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new pt(1/0,1/0),max:new pt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=p(new pt(0,0),new pt(zt,zt),n),s=[];if(e&&!xp(i,this._globalClipBounds))return s;for(const a of this._activeRegions){if(a.hiddenByOverlap||!xp(i,a))continue;const f=x(a.min,a.max,n);s.push({min:f.min,max:f.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId,order:a.order,clipMask:a.clipMask,clipScope:a.clipScope})}return s}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(s).buckets[e.layer];a&&a.updateFootprints(s.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),s=n.getClipMask(),a=n.getClipScope();for(const f of e){if(!f.footprint)continue;const m=p(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:i,clipMask:s,clipScope:a})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||$m(e.min,i.min)||$m(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(s,a){const f=(m,y)=>m+y;return s.length-a.length||s.reduce(f,"").localeCompare(a.reduce(f,""))})(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],s=this._prevRegions[e];n=i.priority!==s.priority||!t0(i,s)||i.order!==s.order||i.clipMask!==s.clipMask||!Yn(i.clipScope,s.clipScope),this._activeRegions[e].hiddenByOverlap=s.hiddenByOverlap,++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==vp&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const a=s[i].priority;for(;i<s.length&&s[i].priority===a;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let a=i;const f=i;for(;a!==s;){const m=this._activeRegions[a];m.hiddenByOverlap=!1;for(let y=0;y<f;y++){const w=this._activeRegions[y];if(!w.hiddenByOverlap&&m.order===vp&&xp(m,w)&&(m.hiddenByOverlap=k(m.footprint,m.tileId,w.footprint,w.tileId),m.hiddenByOverlap))break}++a}i=s,s=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},r.eQ=vp,r.eR=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new hc,s=new Kr,a=[],f=n+1+2,m=e[0]+1,y=e[0]+1+(1+e.length),w=(S,I,M)=>{let O=S===f-1?S-2:S===0?S:S-1;return O+=M?24575:0,[O,I]};for(let S=0;S<f;++S)i.emplaceBack(...w(S,0,!0));for(let S=0;S<m;++S)for(let I=0;I<f;++I)i.emplaceBack(...w(I,S,(I===0||I===f-1)&&!0));for(let S=0;S<e.length;++S){const I=e[S];for(let M=0;M<f;++M)i.emplaceBack(...w(M,I,!0))}for(let S=0;S<e.length;++S){const I=s.length,M=e[S]+1+2,O=new Kr;for(let G=0;G<M-1;G++){const W=G===M-2,$=W?f*(y-e.length+S-G):f;for(let K=0;K<f-1;K++){const te=G*f+K;G===0||W||K===0||K===f-2?(O.emplaceBack(te+1,te,te+$),O.emplaceBack(te+$,te+$+1,te+1)):(s.emplaceBack(te+1,te,te+$),s.emplaceBack(te+$,te+$+1,te+1))}}const L=Wn.simpleSegment(0,I,i.length,s.length-I);for(let G=0;G<O.uint16.length;G+=3)s.emplaceBack(O.uint16[G],O.uint16[G+1],O.uint16[G+2]);const F=Wn.simpleSegment(0,I,i.length,s.length-I);a.push({withoutSkirts:L,withSkirts:F})}return{vertices:i,indices:s,segments:a}}_createGrid(n){const e=this._fillGridMeshWithLods(ne,ue);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Q_.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new Kr;for(let m=0;m<=ne;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Wc,s=new Wc,a=new Wc,f=new Wc;this._poleSegments=[];for(let m=0,y=0;m<5;m++){const w=360/(1<<m);i.emplaceBack(0,-Y,0,.5,0),s.emplaceBack(0,-Y,0,.5,1),a.emplaceBack(0,-Y,0,.5,.5),f.emplaceBack(0,-Y,0,.5,.5);for(let S=0;S<=ne;S++){let I=S/ne,M=0;const O=vi(0,w,I),[L,F,G]=Ee($x,Ov,O,Y);i.emplaceBack(L,F,G,I,M),s.emplaceBack(L,F,G,I,1-M);const W=Ni(O);I=.5+.5*Math.sin(W),M=.5+.5*Math.cos(W),a.emplaceBack(L,F,G,I,M),f.emplaceBack(L,F,G,I,1-M)}this._poleSegments.push(Wn.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Xh,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,Xh,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(a,Xh,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(f,Xh,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},r.eS=wy,r.eT=ge,r.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.eV=Me,r.eW=lt,r.eX=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},r.eY=ws,r.eZ=xe,r.e_=Qt,r.ea=_c,r.eb=iT,r.ec=nn,r.ed=450,r.ee=7,r.ef=Ze,r.eg=function(n,e){if(n===e){var i=e[1],s=e[2],a=e[3],f=e[6],m=e[7],y=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=s,n[9]=f,n[11]=e[14],n[12]=a,n[13]=m,n[14]=y}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},r.eh=WD,r.ei=$i,r.ej=vm,r.ek=256,r.el=$n,r.em=va,r.en=Bt,r.eo=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},r.ep=Wc,r.eq=im,r.er=Nh,r.es=function(n,e,i,s,a){return _e((n-e)/(i-e)*(a-s)+s,s,a)},r.et=Co,r.eu=function(n,e){var i=e[0],s=e[1],a=e[2],f=e[3],m=e[4],y=e[5],w=e[6],S=e[7],I=e[8],M=I*m-y*S,O=-I*f+y*w,L=S*f-m*w,F=i*M+s*O+a*L;return F?(n[0]=M*(F=1/F),n[1]=(-I*s+a*S)*F,n[2]=(y*s-a*m)*F,n[3]=O*F,n[4]=(I*i-a*w)*F,n[5]=(-y*i+a*f)*F,n[6]=L*F,n[7]=(-S*i+s*w)*F,n[8]=(m*i-s*f)*F,n):null},r.ev=2,r.ew=Ii,r.ex=Ur,r.ey=rn,r.ez=function(n,e){var i=new H(3);rn(i,e);var s=1/i[0],a=1/i[1],f=1/i[2],m=e[0]*s,y=e[1]*a,w=e[2]*f,S=e[4]*s,I=e[5]*a,M=e[6]*f,O=e[8]*s,L=e[9]*a,F=e[10]*f,G=m+I+F,W=0;return G>0?(W=2*Math.sqrt(G+1),n[3]=.25*W,n[0]=(M-L)/W,n[1]=(O-w)/W,n[2]=(y-S)/W):m>I&&m>F?(W=2*Math.sqrt(1+m-I-F),n[3]=(M-L)/W,n[0]=.25*W,n[1]=(y+S)/W,n[2]=(O+w)/W):I>F?(W=2*Math.sqrt(1+I-m-F),n[3]=(O-w)/W,n[0]=(y+S)/W,n[1]=.25*W,n[2]=(M+L)/W):(W=2*Math.sqrt(1+F-m-I),n[3]=(y-S)/W,n[0]=(O+w)/W,n[1]=(M+L)/W,n[2]=.25*W),n},r.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},r.f0=function([n,e,i]){const s=Math.hypot(n,e,i),a=Math.atan2(n,i),f=.5*Math.PI-Math.acos(-e/s);return new fe(Le(a),Le(f))},r.f1=go,r.f2=db,r.f3=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!(function(i){if(sn==null){const s=i.navigator?i.navigator.userAgent:null;sn=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return sn})(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.f4=function(n,e){Vp=n,xf=e},r.f5=rf,r.f6=Ug,r.f7=function(n){const e=[0,0,0],i=Re(new Float64Array(16));return Ge(i,n.pixelMatrix,n.globeMatrix),vn(e,e,i),new pt(e[0],e[1])},r.f8=function(){const n=Ey;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(nb),Ey=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.f9=function(){r0().acquire(nb)},r.fA=k0,r.fB=Zi,r.fC=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==ET){const i=new Uint32Array(n,0,7),[,,s,a,f,m]=i;e=i.byteLength+a+f+m+f,(s!==n.byteLength||e>=n.byteLength)&&bi("Invalid b3dm header information.")}return RT(n,e)},r.fD=function(n,e){const i=_b(n);for(const s of i){for(const a of s.meshes)EM(a);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(AM(s.lights,e)))}return i},r.fE=D0,r.fF=Cr,r.fG=pT,r.fH=na,r.fI=To,r.fJ=function(n){ds(),As?.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-n;s++)e.delete(i[s]).catch(a=>bi(a.message))}).catch(i=>bi(i.message))}).catch(e=>bi(e.message))},r.fa=qc,r.fb=function(n,e,i=!1){if(uo===To.deferred||uo===To.loading||uo===To.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");uc=Qo.resolveURL(n),uo=To.deferred,cc=e,hm(),i||Yf()},r.fc=function(n){t_=Qo.resolveURL(n),i_||(i_=new e_(r0(),new $l)),i_.broadcast("setMeshoptUrl",t_)},r.fd=_T,r.fe=function(n){ob=Qo.resolveURL(n),i_||(i_=new e_(r0(),new $l)),i_.broadcast("setDracoUrl",ob)},r.ff=gT,r.fg=Sy,r.fh=function(n){const e=Ra();if(!e)return;const i=e.delete(yg);n&&i.then(()=>n()).catch(n)},r.fi=Wm,r.fj=Mt,r.fk=Jc,r.fl=2,r.fm=qE,r.fn=HE,r.fo=qT,r.fp=tn,r.fq="hd_road_elevation",r.fr=Ys,r.fs=oi,r.ft=Qc,r.fu=Rb,r.fv=1,r.fw=function(n,e,i,s,a,f,m,y=1,w,S,I,M){n.createArrays(),n.tilePixelRatio=zt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const O=n.layers[0].layout,L=n.layers[0]._unevaluatedLayout._values,F={};F.scaleFactor=y,F.textSizeScaleRange=O.get("text-size-scale-range"),F.iconSizeScaleRange=O.get("icon-size-scale-range");const[G,W]=F.textSizeScaleRange,[$,K]=F.iconSizeScaleRange;F.textScaleFactor=_e(F.scaleFactor,G,W),F.iconScaleFactor=_e(F.scaleFactor,$,K);const te=L["text-size"],se=L["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:Ce,maxZoom:ze}=n.textSizeData;F.compositeTextSizes=[te.possiblyEvaluate(new bn(Ce,{worldview:I}),f),te.possiblyEvaluate(new bn(ze,{worldview:I}),f)]}if(n.iconSizeData.kind==="composite"){const{minZoom:Ce,maxZoom:ze}=n.iconSizeData;F.compositeIconSizes=[se.possiblyEvaluate(new bn(Ce,{worldview:I}),f,M),se.possiblyEvaluate(new bn(ze,{worldview:I}),f,M)]}F.layoutTextSize=te.possiblyEvaluate(new bn(m+1,{worldview:I}),f),F.layoutIconSize=se.possiblyEvaluate(new bn(m+1,{worldview:I}),f,M),F.textMaxSize=te.possiblyEvaluate(new bn(18,{worldview:I}),f);const pe=O.get("symbol-placement"),de=O.get("text-rotation-alignment")==="map"&&pe!=="point",be=O.get("text-size");let Te=!1;const ve=[];for(const Ce of n.features){const ze=O.get("text-font").evaluate(Ce,{},f).join(","),it=be.evaluate(Ce,{},f)*F.textScaleFactor,Je=F.layoutTextSize.evaluate(Ce,{},f)*F.textScaleFactor,tt=F.layoutIconSize.evaluate(Ce,{},f,M)*F.iconScaleFactor,dt={horizontal:{},vertical:void 0},ut=Ce.text;let ht,Ye=[0,0];if(ut){const hn=ut.toString(),Fr=O.get("text-letter-spacing").evaluate(Ce,{},f)*Bs,gn=O.get("text-line-height").evaluate(Ce,{},f)*Bs,Pn=Og(hn)?Fr:0,sr=O.get("text-anchor").evaluate(Ce,{},f),pr=O.get("text-variable-anchor");if(!pr){const ls=O.get("text-radial-offset").evaluate(Ce,{},f);if(ls)Ye=AS(sr,[ls*Bs,Ob]);else{const _s=O.get("text-offset").evaluate(Ce,{},f);Ye=[_s[0]*Bs,_s[1]*Bs]}}let mr=de?"center":O.get("text-justify").evaluate(Ce,{},f);const Nr=pe==="point",Ks=Nr?O.get("text-max-width").evaluate(Ce,{},f)*Bs:1/0,Eo=ls=>{n.allowVerticalPlacement&&Wf(hn)&&(dt.vertical=Sb(ut,e,i,a,ze,Ks,gn,sr,ls,Pn,Ye,fl.vertical,!0,Je,it,w))};if(!de&&pr){const ls=mr==="auto"?pr.map(Os=>Pb(Os)):[mr];let _s=!1;for(let Os=0;Os<ls.length;Os++){const Gi=ls[Os];if(!dt.horizontal[Gi])if(_s)dt.horizontal[Gi]=dt.horizontal[0];else{const gr=Sb(ut,e,i,a,ze,Ks,gn,"center",Gi,Pn,Ye,fl.horizontal,!1,Je,it,w);gr&&(dt.horizontal[Gi]=gr,_s=gr.positionedLines.length===1)}}Eo("left")}else{if(mr==="auto"&&(mr=Pb(sr)),Nr||O.get("text-writing-mode").indexOf("horizontal")>=0||!Wf(hn)){const ls=Sb(ut,e,i,a,ze,Ks,gn,sr,mr,Pn,Ye,fl.horizontal,!1,Je,it,w);ls&&(dt.horizontal[mr]=ls)}Eo(Nr?"left":mr)}}let mt,at,_t,ft,$t,Wt,Ft=!1;const jt=O.get("icon-text-fit").evaluate(Ce,{},f);if(Ce.icon&&Ce.icon.hasPrimary()){const hn=Ly(Ce.icon,n.iconSizeData,L["icon-size"],f,n.zoom,Ce,w,F.iconScaleFactor,I,M);mt=hn.iconPrimary,_t=hn.iconSecondary;const Fr=mt.toString();if(at=s.get(Fr),at&&($t=O.get("icon-offset").evaluate(Ce,{},f),Wt=O.get("icon-anchor").evaluate(Ce,{},f),ht=g0(a.get(Fr),_t?a.get(_t.toString()):void 0,$t,Wt),Ft=at.sdf,n.sdfIcons===void 0?n.sdfIcons=at.sdf:n.sdfIcons!==at.sdf&&bi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(at.pixelRatio!==n.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),_t){const gn=_t.toString();ft=s.get(gn)}}Te=Te||!(!Ce.icon||!Ce.icon.hasSecondary());const di=b0(dt.horizontal)||dt.vertical;n.iconsInText||(n.iconsInText=!!di&&di.iconsInText);const ni=Je*F.textScaleFactor/Bs,{defaultShapedIcon:qt,verticallyShapedIcon:Ai}=zD(n,ht,O,Ce,f,dt,ni,$t,jt);jt!=="none"&&ht&&(uS(ht)||hS(ht))&&(x0(0,at,mt,ht,qt,jt,S,s,a),x0(0,ft,_t,ht,qt,jt,S,s,a),Ai&&(x0(0,at,mt,ht,Ai,jt,S,s,a),x0(0,ft,_t,ht,Ai,jt,S,s,a))),ht=qt;const{iconBBox:Xi,iconVerticalBBox:yn,textBBox:qi,textVerticalBBox:Ln}=RD(n,ht,Ai,O,Ce,f,tt,$t,F,a,Wt,dt,Je,Ye,M);ve.push({feature:Ce,shapedTextOrientations:dt,shapedText:di,shapedIcon:ht,iconPrimary:mt,iconSecondary:_t,iconOffset:$t,iconAnchor:Wt,verticallyShapedIcon:Ai,layoutTextSize:Je,layoutIconSize:tt,textOffset:Ye,isSDFIcon:Ft,iconTextFit:jt,iconCollisionBounds:Xi,iconVerticalCollisionBounds:yn,textCollisionBounds:qi,textVerticalCollisionBounds:Ln})}return{featureData:ve,sizes:F,hasAnySecondaryIcon:Te,textAlongLine:de,symbolPlacement:pe}},r.fx=vS,r.fy=function(n,e,i,s,a,f,m,y,w,S){n.iconAtlasPositions=S.iconPositions;const{featureData:I,hasAnySecondaryIcon:M,sizes:O,textAlongLine:L,symbolPlacement:F}=e;for(const G of I){const{shapedIcon:W,verticallyShapedIcon:$,feature:K,shapedTextOrientations:te,shapedText:se,layoutTextSize:pe,textOffset:de,isSDFIcon:be,iconPrimary:Te,iconSecondary:ve,iconTextFit:Ce,iconOffset:ze,iconCollisionBounds:it,iconVerticalCollisionBounds:Je,textCollisionBounds:tt}=G;MS(W,S.iconPositions,Te,ve),MS($,S.iconPositions,Te,ve),PD(te,S.iconPositions),OD(Te,ve,S.iconPositions),(se||W)&&LD(n,K,te,W,$,w,O,pe,0,de,be,s,a,m,y,M,Ce,ze,L,F,it,Je,tt)}i&&n.generateCollisionDebugBuffers(f,n.collisionBoxArray,O.textScaleFactor)},r.fz=an,r.g=function(n,e){return yo(Object.assign(n,{method:"GET"}),e)},r.h=function(n){return n.indexOf("mapbox:")===0},r.i=function(n){return Qr.API_STYLE_REGEX.test(n)&&!qs(n)},r.j=yl,r.k=Ac,r.l=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.m=function(n,e){return yo(Object.assign(n,{type:"json"}),e)},r.n=fd,r.o=Qo,r.p=function(n,e){return yo(Object.assign(n,{method:"POST"}),e)},r.q=Ds,r.r=Ia,r.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=function(){return rb||(rb=new Wm("ImageRasterizer")),rb},r.u=function(){return(function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)})()},r.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},r.w=bi,r.x=Yb,r.y=lh,r.z=Pa}),D(["./shared"],function(r){function q(Le){const J=Le?Le.url.toString():void 0;return J?performance.getEntriesByName(J):[]}function H(Le){if(typeof Le=="number"||typeof Le=="boolean"||typeof Le=="string"||Le==null)return JSON.stringify(Le);if(Array.isArray(Le)){let re="[";for(const ge of Le)re+=`${H(ge)},`;return`${re}]`}let J="{";for(const re of Object.keys(Le).sort())J+=`${re}:${H(Le[re])},`;return`${J}}`}function ie(Le){let J="";for(const re of r.bx)J+=`/${H(Le[re])}`;return J}function Q(Le,J){return(function re(ge){return typeof ge=="string"&&ge===J||(Array.isArray(ge)?ge.some(re):!(!ge||typeof ge!="object")&&Object.values(ge).some(re))})(Le)}class me{constructor(J){this.keyCache={},this._layers={},this._layerConfigs={},J&&this.replace(J)}replace(J,re){this._layerConfigs={},this._layers={},this.update(J,[],re)}update(J,re,ge){this._options=ge;for(const _e of J)this._layerConfigs[_e.id]=_e,(this._layers[_e.id]=r.du(_e,this.scope,null,this._options)).compileFilter(ge),this.keyCache[_e.id]&&delete this.keyCache[_e.id];for(const _e of re)delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e];this.familiesBySource={};const Me=(function(_e,ke){const We={};for(let Ke=0;Ke<_e.length;Ke++){const At=_e[Ke];let vt=ke&&ke[At.id];vt||(At.type==="symbol"?vt=At.id:(vt=ie(At),At.type==="line"&&At.paint&&Q(At.paint["line-width"],"line-progress")&&(vt+=`/${H(At.paint["line-width"])}`))),ke&&(ke[At.id]=vt);let Zt=We[vt];Zt||(Zt=We[vt]=[]),Zt.push(At)}const je=[];for(const Ke in We)je.push(We[Ke]);return je})(Object.values(this._layerConfigs),this.keyCache);for(const _e of Me){const ke=_e.map(Zt=>this._layers[Zt.id]),We=ke[0];if(We.visibility==="none")continue;const je=We.source||"";let Ke=this.familiesBySource[je];Ke||(Ke=this.familiesBySource[je]={});const At=We.sourceLayer||"_geojsonTileLayer";let vt=Ke[At];vt||(vt=Ke[At]=[]),vt.push(ke)}}}const we=1*r.fl;class Ae{constructor(J){const re={},ge=[];for(const We in J){const je=J[We],Ke=re[We]={};for(const At in je.glyphs){const vt=je.glyphs[+At];if(!vt||vt.bitmap.width===0||vt.bitmap.height===0)continue;const Zt=vt.metrics.localGlyph?we:1,oi={x:0,y:0,w:vt.bitmap.width+2*Zt,h:vt.bitmap.height+2*Zt};ge.push(oi),Ke[At]=oi}}const{w:Me,h:_e}=r.G(ge),ke=new r.fk({width:Me||1,height:_e||1});for(const We in J){const je=J[We];for(const Ke in je.glyphs){const At=je.glyphs[+Ke];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const vt=re[We][Ke],Zt=At.metrics.localGlyph?we:1;r.fk.copy(At.bitmap,ke,{x:0,y:0},{x:vt.x+Zt,y:vt.y+Zt},At.bitmap)}}this.image=ke,this.positions=re}}function he(Le,J,re){Le[J]?re&&(Le[J].center=re):Le[J]={floorIds:new Set,center:re||[0,0],floors:{}}}function Re(Le,J,re,ge){for(const Me of J)he(Le,Me),Le[Me].floors[re]=ge,Le[Me].floorIds.add(re)}function Ne(Le){return{id:Le.properties.id.toString(),center:Le.properties.center.toString().split(";").map(Number)}}function Ge(Le){return{id:Le.properties.id.toString(),isDefault:!!Le.properties.is_default&&Le.properties.is_default,connections:Le.properties.connected_floor_ids?new Set(Le.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Le.properties.conflicted_floor_ids?new Set(Le.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Le.properties.building_ids?new Set(Le.properties.building_ids.toString().split(";")):new Set,name:Le.properties.name.toString(),zIndex:Le.properties.z_index}}function Ue(Le,J){return J.every(re=>Le.properties&&Le.properties[re]!=null)}function rt(Le){return Ue(Le,["type","id","name"])&&Le.properties.type==="building"}function Pt(Le){return Ue(Le,["type","id","name","z_index"])&&Le.properties.type==="floor"}r.fj(Ae,"GlyphAtlas");class Bt{constructor(J){this.tileID=new r.aQ(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.lut=J.lut,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.scope=J.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.request&&J.request.collectResourceTiming,this.promoteId=J.promoteId,this.isSymbolTile=J.isSymbolTile,this.tileTransform=r.aZ(J.tileID.canonical,J.projection),this.projection=J.projection,this.worldview=J.worldview,this.localizableLayerIds=J.localizableLayerIds,this.brightness=J.brightness,this.extraShadowCaster=!!J.extraShadowCaster,this.tessellationStep=J.tessellationStep,this.scaleFactor=J.scaleFactor,this.worldview=J.worldview,this.indoor=J.indoor}parse(J,re,ge,Me,_e,ke){this.status="parsing",this.data=J,this.collisionBoxArray=new r.b3;const We=new r.fm(Object.keys(J.layers).sort()),je=new r.fn(this.tileID,this.promoteId);je.bucketLayerIDs=[];const Ke={},At=new r.fo(256,256),vt={featureIndex:je,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:At,availableImages:ge,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Mi=this.indoor.indoorState.activeFloorsVisible,ji=(function(li,bi,jn){const xr=(function(Kn,sn){if(!Kn)return r.w("No source layers defined in indoor specification"),sn;if(Kn.size===0)return sn;const ir=Kn.difference(sn);for(const Dn of ir)r.w(`Missing source layer required in indoor specification: ${Dn}`);return sn.intersection(sn)})(bi.sourceLayers,new Set(Object.keys(li.layers))),Qn=bi.indoorState,Cr=(function(Kn,sn,ir,Dn){const On=new Set,Un=new Set,br=new Set,hs=new Map,Qr={},yl=qs=>{const no=hs.get(qs)||new Set;for(const Ca of On)if((hs.get(Ca)||new Set).has(qs)||no.has(Ca))return!0;return!1};for(const qs of sn){const no=Kn.layers[qs];if(no)for(let Ca=0;Ca<no.length;Ca++){const rs=no.feature(Ca);if(rt(rs)){const{id:_o,center:ro}=Ne(rs);he(Qr,_o,ro),On.add(_o);continue}if(Pt(rs)){const{id:_o,isDefault:ro,connections:qa,conflicts:Ia,buildings:Qo,name:rh,zIndex:vl}=Ge(rs);Re(Qr,Qo,_o,{name:rh,zIndex:vl}),hs.set(_o,Ia),(_o===Dn||qa.has(Dn))&&On.add(_o),Un.add(_o),ro&&br.add(_o)}}else r.w(`indoor source layer not found: ${qs}`)}if(ir)for(const qs of ir)Un.has(qs)&&(yl(qs)||On.add(qs));for(const qs of br)On.has(qs)||yl(qs)||On.add(qs);return{buildings:Qr,activeFloors:On}})(li,xr,Qn.lastActiveFloors,Qn.selectedFloorId);return jn.send("setIndoorData",Cr),Cr})(J,this.indoor,_e);vt.activeFloors=Mi?ji.activeFloors:void 0}const Zt=[],oi=re.familiesBySource[this.source];for(const Mi in oi){const ji=J.layers[Mi];if(!ji)continue;let li=!1,bi=!1,jn=!1;for(const sn of oi[Mi])sn[0].type==="symbol"?li=!0:bi=!0,sn[0].is3D()&&sn[0].type!=="model"&&(jn=!0);if(this.extraShadowCaster&&!jn||this.isSymbolTile===!0&&!li||this.isSymbolTile===!1&&!bi)continue;ji.version===1&&r.w(`Vector tile source "${this.source}" layer "${Mi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const xr=We.encode(Mi),Qn=[],Cr=this.localizableLayerIds&&this.localizableLayerIds.has(Mi);let Kn=!1;for(let sn=0,ir=0;sn<ji.length;sn++){const Dn=ji.feature(sn),On=je.getId(Dn,Mi),Un=Dn.properties?Dn.properties.worldview:null;if(Cr&&this.worldview&&typeof Un=="string")if(Un==="all")Dn.properties.$localized=!0;else{if(!Un.split(",").includes(this.worldview))continue;Dn.properties.$localized=!0,Dn.properties.worldview=this.worldview}!Kn&&Dn.properties&&Dn.properties.hasOwnProperty(r.fp)&&(Kn=!0),Qn.push({feature:Dn,id:On,index:ir,sourceLayerIndex:xr}),ir++}Kn&&!vt.elevationFeatures&&J.layers.hasOwnProperty(r.fq)&&(vt.elevationFeatures=r.fr.parseFrom(J.layers[r.fq],this.canonical));for(const sn of oi[Mi]){const ir=sn[0];if(this.extraShadowCaster&&(!ir.is3D()||ir.type==="model")||this.isSymbolTile!==void 0&&ir.type==="symbol"!==this.isSymbolTile||ir.minzoom&&this.zoom<Math.floor(ir.minzoom)||ir.maxzoom&&this.zoom>=ir.maxzoom||ir.visibility==="none")continue;Tt(sn,this.zoom,vt.brightness,ge,this.worldview);const Dn=Ke[ir.id]=ir.createBucket({index:je.bucketLayerIDs.length,layers:sn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Me,worldview:this.worldview,localizable:Cr,availableImages:ge});je.bucketLayerIDs.push(sn.map(Un=>r.B(Un.id,Un.scope)));let On=Dn.prepare?Dn.prepare():null;On!=null?(On=On.then(()=>Dn.populate(Qn,vt,this.tileID.canonical,this.tileTransform)),Zt.push(On)):Dn.populate(Qn,vt,this.tileID.canonical,this.tileTransform)}}const hi=()=>{let Mi,ji,li,bi,jn,xr;At.trim();const Qn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Cr=()=>{if(Mi)return this.status="done",ke(Mi);if(this.extraShadowCaster)this.status="done",ke(null,{buckets:Object.values(Ke).filter(sn=>!sn.isEmpty()),featureIndex:je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:vt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(ji&&li&&bi){const sn=new Ae(ji),ir=new Map;for(const[Un,br]of li.entries()){const{imagePosition:hs}=r.fu(Un,br,r.fv);ir.set(Un,hs)}const Dn={};for(const Un in Ke){const br=Ke[Un];br instanceof r.b4&&(Tt(br.layers,this.zoom,vt.brightness,ge,this.worldview),Dn[Un]=r.fw(br,ji,sn.positions,li,ir,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,jn,this.worldview,ge))}const On={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(_e,li,jn,()=>{On.iconsPending=!1,Kn(Dn,sn,On)}),this.rasterizeIfNeeded(_e,bi,xr,()=>{On.patternsPending=!1,Kn(Dn,sn,On)})}},Kn=(sn,ir,Dn,On)=>{if(Dn.iconsPending||Dn.patternsPending)return;const Un=new r.fx(li,bi,this.lut);for(const br in Ke){const hs=Ke[br];if(br in sn)r.fy(hs,sn[br],this.showCollisionBoxes,ge,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,li,Un);else if(hs.hasPattern&&(hs instanceof r.ba||hs instanceof r.bb||hs instanceof r.ea)){Tt(hs.layers,this.zoom,vt.brightness,ge,this.worldview);const Qr=Object.fromEntries(Un.patternPositions);hs.addFeatures(vt,this.tileID.canonical,Qr,ge,this.tileTransform,this.brightness)}}this.status="done",ke(null,{buckets:Object.values(Ke).filter(br=>!br.isEmpty()),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ir.image,lineAtlas:At,imageAtlas:Un,brightness:vt.brightness})};if(!this.extraShadowCaster){const sn=r.fs(vt.glyphDependencies,On=>Object.keys(On).map(Number));Object.keys(sn).length?_e.send("getGlyphs",{uid:this.uid,stacks:sn},(On,Un)=>{Mi||(Mi=On,ji=Un,Cr())},void 0,!1,Qn):ji={};const ir=Array.from(vt.iconDependencies.keys()).map(On=>r.I.parse(On));ir.length?_e.send("getImages",{images:ir,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(On,Un)=>{Mi||(Mi=On,li=new Map,jn=this.updateImageMapAndGetImageTaskQueue(li,Un,vt.iconDependencies),Cr())},void 0,!1,Qn):(li=new Map,jn=new Map);const Dn=Array.from(vt.patternDependencies.keys()).map(On=>r.I.parse(On));Dn.length?_e.send("getImages",{images:Dn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(On,Un)=>{Mi||(Mi=On,bi=new Map,xr=this.updateImageMapAndGetImageTaskQueue(bi,Un,vt.patternDependencies),Cr())},void 0,!1,Qn):(bi=new Map,xr=new Map)}if(vt.elevationFeatures&&vt.elevationFeatures.length>0){const sn=[];for(const Dn of Object.values(Ke))if(Dn instanceof r.bb){const On=Dn.getUnevaluatedPortalGraph();On&&sn.push(On)}const ir=r.ft.evaluate(sn);for(const Dn of Object.values(Ke))if(Dn instanceof r.bb){const On=J.layers[We.decode(Dn.sourceLayerIndex)];Dn.setEvaluatedPortalGraph(ir,On,this.tileID.canonical,vt.availableImages,vt.brightness)}}Cr()};Zt.length>0?Promise.allSettled(Zt).then(hi).catch(ke):hi()}updateParameters(J){this.scaleFactor=J.scaleFactor,this.showCollisionBoxes=J.showCollisionBoxes,this.projection=J.projection,this.brightness=J.brightness,this.tileTransform=r.aZ(J.tileID.canonical,J.projection),this.extraShadowCaster=J.extraShadowCaster,this.lut=J.lut,this.worldview=J.worldview,this.indoor=J.indoor}rasterizeIfNeeded(J,re,ge,Me){Array.from(re.values()).some(_e=>_e.usvg)?this.rasterize(J,re,ge,Me):Me()}updateImageMapAndGetImageTaskQueue(J,re,ge){const Me=new Map;for(const _e of re.keys()){const ke=ge.get(_e)||[];for(const We of ke){const je=We.toString(),Ke=re.get(We.id.toString());Ke.usvg?Me.has(je)||(Me.set(je,We),J.set(je,Object.assign({},Ke))):J.set(je,Ke)}}return Me}rasterize(J,re,ge,Me){this.rasterizeTask=J.send("rasterizeImages",{scope:this.scope,tasks:ge},(_e,ke)=>{if(!_e)for(const[We,je]of ke.entries()){const Ke=Object.assign(re.get(We),{data:je});re.set(We,Ke)}Me()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Tt(Le,J,re,ge,Me){const _e=new r.ac(J,{brightness:re,worldview:Me});for(const ke of Le)ke.recalculate(_e,ge)}class Ht extends r.E{constructor(J,re,ge,Me,_e,ke,We){super(),this.actor=J,this.layerIndex=re,this.availableImages=ge,this.availableModels=Me,this.loadVectorData=ke||r.aL,this.loading={},this.loaded={},this.deduped=new r.aK(J.scheduler),this.isSpriteLoaded=_e,this.scheduler=J.scheduler,this.brightness=We}loadTile(J,re){const ge=J.uid,Me=J&&J.request,_e=Me&&Me.collectResourceTiming,ke=this.loading[ge]=new Bt(J);ke.abort=this.loadVectorData(J,(We,je)=>{const Ke=!this.loading[ge];if(delete this.loading[ge],ke.cancelRasterize(),Ke||We||!je)return ke.status="done",Ke||(this.loaded[ge]=ke),re(We);const At=je.rawData,vt={},Zt=r.aM(je.responseHeaders);Zt&&Zt.expires&&(vt.expires=Zt.expires),Zt&&Zt.cacheControl&&(vt.cacheControl=Zt.cacheControl),ke.vectorTile=je.vectorTile||new r.fz(new r.bt(At));const oi=()=>{ke.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(hi,Mi)=>{if(hi||!Mi)return re(hi);const ji={};if(_e){const li=q(Me);li.length>0&&(ji.resourceTiming=JSON.parse(JSON.stringify(li)))}re(null,Object.assign({rawTileData:At.slice(0),responseHeaders:je.responseHeaders},Mi,vt,ji))})};this.isSpriteLoaded?oi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(oi,{type:"parseTile",isSymbolTile:J.isSymbolTile,zoom:J.tileZoom}):oi()}),this.loaded=this.loaded||{},this.loaded[ge]=ke})}reloadTile(J,re){const ge=this.loaded,Me=J.uid;if(ge&&ge[Me]){const _e=ge[Me];_e.updateParameters(J);const ke=(We,je)=>{const Ke=_e.reloadCallback;Ke&&(delete _e.reloadCallback,_e.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ke)),re(We,je)};_e.status==="parsing"?_e.reloadCallback=ke:_e.status==="done"&&(_e.vectorTile?_e.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ke):ke())}else re(null,void 0)}abortTile(J,re){const ge=J.uid,Me=this.loading[ge];Me&&(Me.abort&&Me.abort(),delete this.loading[ge]),re()}removeTile(J,re){const ge=this.loaded,Me=J.uid;ge&&ge[Me]&&delete ge[Me],re()}}class Ei{loadTile(J,re){const{uid:ge,encoding:Me,rawImageData:_e,padding:ke}=J,We=ImageBitmap&&_e instanceof ImageBitmap?this.getImageData(_e,ke):_e;re(null,new r.fA(ge,We,Me,ke<1))}reloadTile(J,re){re(null,null)}abortTile(J,re){re()}removeTile(J,re){re()}getImageData(J,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);const ge=this.offscreenCanvasContext.getImageData(-re,-re,J.width+2*re,J.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}r.bs.setPbf(r.bt);class rn{constructor(J){this._mrt=new r.bs(J.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=J.uid,this.tileID=J.tileID,this.source=J.source}parse(J,re){const ge=this._mrt;this.status="parsing",this._entireBuffer=J;try{ge.parseHeader(J),this._isHeaderLoaded=!0;const Me=[];for(const _e in ge.layers){const ke=ge.getLayer(_e),We=ke.getDataRange(ke.getBandList()),je=ge.createDecodingTask(We),Ke=J.slice(We.firstByte,We.lastByte+1),At=r.bs.performDecoding(Ke,je).then(vt=>je.complete(null,vt)).catch(vt=>je.complete(vt,null));Me.push(At)}Promise.allSettled(Me).then(()=>re(null,ge)).catch(_e=>re(_e))}catch(Me){re(Me)}}}class en{constructor(J){this.actor=J,this.loading={},this.loaded={}}loadTile(J,re){const ge=J.uid,Me=J.request,_e=this.loading[ge]=new rn(J),{cancel:ke}=r.bu(Me,(We,je,Ke)=>{const At=!this.loading[ge];if(delete this.loading[ge],At||We||!je)return _e.status="done",At||(this.loaded[ge]=_e),re(We);_e.parse(je,(vt,Zt)=>{if(vt||!Zt)return re(vt);re(null,Zt,Ke)}),this.loaded[ge]=_e});_e.abort=ke}reloadTile(J,re){re(null,void 0)}abortTile(J,re){const ge=J.uid,Me=this.loading[ge];Me&&(Me.abort&&Me.abort(),delete this.loading[ge]),re()}removeTile(J,re){const ge=J.uid;this.loaded[ge]&&delete this.loaded[ge],re()}decodeRasterArray(J,re){r.bs.performDecoding(J.buffer,J.task).then(ge=>re(null,ge)).catch(ge=>re(ge))}}const Ui=r.fB.prototype.toGeoJSON;class si{constructor(J){this._feature=J,this.extent=r.al,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const re of this._feature.geometry)J.push([new r.P(re[0],re[1])]);return J}{const J=[];for(const re of this._feature.geometry){const ge=[];for(const Me of re)ge.push(new r.P(Me[0],Me[1]));J.push(ge)}return J}}toGeoJSON(J,re,ge){return Ui.call(this,J,re,ge)}}class Ji{constructor(J,re){this.name=J,this.extent=r.al,this.length=re.length,this._jsonFeatures=re}feature(J){return new si(this._jsonFeatures[J])}}class Si{constructor(J){this.layers={},this.extent=r.al;for(const re of Object.keys(J))this.layers[re]=new Ji(re,J[re])}}const Xe=64/4096;class gt{constructor(){this.features=new Map}clear(){this.features.clear()}load(J=[],re){for(const ge of J){const Me=ge.id;if(Me==null)continue;let _e=this.features.get(Me);_e&&this.updateCache(_e,re),ge.geometry?(_e=mi(ge),this.updateCache(_e,re),this.features.set(Me,_e)):this.features.delete(Me),this.updateCache(_e,re)}}updateCache(J,re){for(const{canonical:ge,uid:Me}of Object.values(re)){const{z:_e,x:ke,y:We}=ge;yt(J,Math.pow(2,_e),ke,We)&&delete re[Me]}}getTile(J,re,ge){const Me=Math.pow(2,J),_e=[];for(const ke of this.features.values())yt(ke,Me,re,ge)&&_e.push(bt(ke,Me,re,ge));return{features:_e}}getFeatures(){return[...this.features.values()]}}function yt({minX:Le,minY:J,maxX:re,maxY:ge},Me,_e,ke){return Le<(_e+1+Xe)/Me&&J<(ke+1+Xe)/Me&&re>(_e-Xe)/Me&&ge>(ke-Xe)/Me}function mi(Le){const{id:J,geometry:re,properties:ge}=Le;if(!re)return;if(re.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Me,coordinates:_e}=re,ke={id:J,type:1,geometry:[],tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},We=ke.geometry;if(Me==="Point")Ci(_e,We,ke);else if(Me==="MultiPoint")for(const je of _e)Ci(je,We,ke);else if(Me==="LineString")ke.type=2,Fe(_e,We,ke);else if(Me==="MultiLineString")ke.type=2,wt(_e,We,ke);else if(Me==="Polygon")ke.type=3,wt(_e,We,ke,!0);else{if(Me!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ke.type=3;for(const je of _e)wt(je,We,ke,!0)}return ke}function Ci([Le,J],re,ge){const Me=r.aF(Le);let _e=r.aJ(J);_e=_e<0?0:_e>1?1:_e,re.push(Me,_e),ge.minX=Math.min(ge.minX,Me),ge.minY=Math.min(ge.minY,_e),ge.maxX=Math.max(ge.maxX,Me),ge.maxY=Math.max(ge.maxY,_e)}function Fe(Le,J,re,ge=!1,Me=!1){const _e=[];for(const ke of Le)Ci(ke,_e,re);J.push(_e),ge&&(function(ke,We){let je=0;for(let Ke=0,At=ke.length,vt=At-2;Ke<At;vt=Ke,Ke+=2)je+=(ke[Ke]-ke[vt])*(ke[Ke+1]+ke[vt+1]);if(je>0===We)for(let Ke=0,At=ke.length;Ke<At/2;Ke+=2){const vt=ke[Ke],Zt=ke[Ke+1];ke[Ke]=ke[At-2-Ke],ke[Ke+1]=ke[At-1-Ke],ke[At-2-Ke]=vt,ke[At-1-Ke]=Zt}})(_e,Me)}function wt(Le,J,re,ge=!1){for(let Me=0;Me<Le.length;Me++)Fe(Le[Me],J,re,ge,Me===0)}function bt(Le,J,re,ge){const{id:Me,type:_e,geometry:ke,tags:We}=Le,je=[];if(_e===1)(function(Ke,At,vt,Zt,oi){for(let hi=0;hi<Ke.length;hi+=2){const Mi=Math.round(r.al*(Ke[hi+0]*At-vt)),ji=Math.round(r.al*(Ke[hi+1]*At-Zt));oi.push([Mi,ji])}})(ke,J,re,ge,je);else if(_e===2)for(const Ke of ke)Gt(Ke,J,re,ge,je);else if(_e===3)for(const Ke of ke)ci(Ke,J,re,ge,je);return{id:Me,type:_e,geometry:je,tags:We}}function Gt(Le,J,re,ge,Me){const ke=r.al+128;let We;for(let je=0;je<Le.length-2;je+=2){let Ke=Math.round(r.al*(Le[je+0]*J-re)),At=Math.round(r.al*(Le[je+1]*J-ge)),vt=Math.round(r.al*(Le[je+2]*J-re)),Zt=Math.round(r.al*(Le[je+3]*J-ge));const oi=vt-Ke,hi=Zt-At;Ke<-128&&vt<-128||(Ke<-128?(At+=Math.round(hi*((-128-Ke)/oi)),Ke=-128):vt<-128&&(Zt=At+Math.round(hi*((-128-Ke)/oi)),vt=-128),At<-128&&Zt<-128||(At<-128?(Ke+=Math.round(oi*((-128-At)/hi)),At=-128):Zt<-128&&(vt=Ke+Math.round(oi*((-128-At)/hi)),Zt=-128),Ke>=ke&&vt>=ke||(Ke>=ke?(At+=Math.round(hi*((ke-Ke)/oi)),Ke=ke):vt>=ke&&(Zt=At+Math.round(hi*((ke-Ke)/oi)),vt=ke),At>=ke&&Zt>=ke||(At>=ke?(Ke+=Math.round(oi*((ke-At)/hi)),At=ke):Zt>=ke&&(vt=Ke+Math.round(oi*((ke-At)/hi)),Zt=ke),We&&Ke===We[We.length-1][0]&&At===We[We.length-1][1]||(We=[[Ke,At]],Me.push(We)),We.push([vt,Zt])))))}}function ci(Le,J,re,ge,Me){const _e=(re-Xe)/J,ke=(ge-Xe)/J,We=(re+1+Xe)/J,je=(ge+1+Xe)/J;function Ke(Zt,oi){let hi=0;return Zt<_e?hi|=1:Zt>We&&(hi|=2),oi<ke?hi|=4:oi>je&&(hi|=8),hi}let At=[];for(let Zt=1;Zt<=8;Zt*=2){let oi=Le[Le.length-2],hi=Le[Le.length-1],Mi=!(Ke(oi,hi)&Zt);for(let ji=0;ji<Le.length;ji+=2){const li=Le[ji],bi=Le[ji+1],jn=!(Ke(li,bi)&Zt);jn!==Mi&&(8&Zt?At.push(oi+(li-oi)*(je-hi)/(bi-hi),je):4&Zt?At.push(oi+(li-oi)*(ke-hi)/(bi-hi),ke):2&Zt?At.push(We,hi+(bi-hi)*(We-oi)/(li-oi)):1&Zt&&At.push(_e,hi+(bi-hi)*(_e-oi)/(li-oi))),jn&&At.push(li,bi),oi=li,hi=bi,Mi=jn}if(!(Le=At).length||Zt===8)break;At=[]}const vt=[];for(let Zt=0;Zt<At.length;Zt+=2)vt.push([Math.round(r.al*(At[Zt]*J-re)),Math.round(r.al*(At[Zt+1]*J-ge))]);vt.length&&Me.push(vt)}function Bi({name:Le,features:J},re){re.writeStringField(1,Le),re.writeVarintField(5,r.al);const ge=new Map,Me=new Map,_e={keys:ge,values:Me,feature:null};for(const ke of J)_e.feature=ke,re.writeMessage(2,Qt,_e);for(const ke of ge.keys())re.writeStringField(3,ke);for(const ke of Me.keys())re.writeMessage(4,Oi,ke)}function Qt(Le,J){const re=Le.feature;re.id!==void 0&&Number.isSafeInteger(+re.id)&&J.writeVarintField(1,+re.id),re.tags&&J.writeMessage(2,Ii,Le),J.writeVarintField(3,re.type),J.writeMessage(4,Fi,re)}function Ii({keys:Le,values:J,feature:re},ge){for(const Me of Object.keys(re.tags)){let _e=re.tags[Me];if(_e===null)continue;let ke=Le.get(Me);ke===void 0&&(ke=Le.size,Le.set(Me,ke)),ge.writeVarint(ke);const We=typeof _e;We!=="string"&&We!=="boolean"&&We!=="number"&&(_e=JSON.stringify(_e));let je=J.get(_e);je===void 0&&(je=J.size,J.set(_e,je)),ge.writeVarint(je)}}function fi(Le,J){return(J<<3)+(7&Le)}function Ri(Le){return Le<<1^Le>>31}function Fi(Le,J){const{geometry:re,type:ge}=Le;let Me=0,_e=0;if(ge===1){J.writeVarint(fi(1,re.length));for(const ke of re){const We=ke[0]-Me,je=ke[1]-_e;J.writeVarint(Ri(We)),J.writeVarint(Ri(je)),Me+=We,_e+=je}}else for(const ke of re){if(ke.length===0)continue;J.writeVarint(fi(1,1));const We=ke.length-(ge===3?1:0);for(let je=0;je<We;je++){je===1&&J.writeVarint(fi(2,We-1));const Ke=ke[je][0]-Me,At=ke[je][1]-_e;J.writeVarint(Ri(Ke)),J.writeVarint(Ri(At)),Me+=Ke,_e+=At}ge===3&&J.writeVarint(fi(7,1))}}function Oi(Le,J){const re=typeof Le;re==="string"?J.writeStringField(1,Le):re==="boolean"?J.writeBooleanField(7,Le):re==="number"&&(Le%1!=0?J.writeDoubleField(3,Le):Le<0?J.writeSVarintField(6,Le):J.writeVarintField(5,Le))}const vn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Le=>Le},Mr=Math.fround||(Vs=new Float32Array(1),Le=>(Vs[0]=+Le,Vs[0]));var Vs;class Gs{constructor(J){this.options=Object.assign(Object.create(vn),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:re,minZoom:ge,maxZoom:Me}=this.options;re&&console.time("total time");const _e=`prepare ${J.length} points`;re&&console.time(_e),this.points=J;const ke=[];for(let je=0;je<J.length;je++){const Ke=J[je];if(!Ke.geometry)continue;const[At,vt]=Ke.geometry.coordinates,Zt=Mr(ws(At)),oi=Mr(Ts(vt));ke.push(Zt,oi,1/0,je,-1,1),this.options.reduce&&ke.push(0)}let We=this.trees[Me+1]=this._createTree(ke);re&&console.timeEnd(_e);for(let je=Me;je>=ge;je--){const Ke=+Date.now();We=this.trees[je]=this._createTree(this._cluster(We,je)),re&&console.log("z%d: %d clusters in %dms",je,We.numItems,+Date.now()-Ke)}return re&&console.timeEnd("total time"),this}getClusters(J,re){let ge=((J[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,J[1]));let _e=J[2]===180?180:((J[2]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)ge=-180,_e=180;else if(ge>_e){const vt=this.getClusters([ge,Me,180,ke],re),Zt=this.getClusters([-180,Me,_e,ke],re);return vt.concat(Zt)}const We=this.trees[this._limitZoom(re)],je=We.range(ws(ge),Ts(ke),ws(_e),Ts(Me)),Ke=We.data,At=[];for(const vt of je){const Zt=this.stride*vt;At.push(Ke[Zt+5]>1?Jr(Ke,Zt,this.clusterProps):this.points[Ke[Zt+3]])}return At}getChildren(J){const re=this._getOriginId(J),ge=this._getOriginZoom(J),Me="No cluster with the specified id.",_e=this.trees[ge];if(!_e)throw new Error(Me);const ke=_e.data;if(re*this.stride>=ke.length)throw new Error(Me);const We=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),je=_e.within(ke[re*this.stride],ke[re*this.stride+1],We),Ke=[];for(const At of je){const vt=At*this.stride;ke[vt+4]===J&&Ke.push(ke[vt+5]>1?Jr(ke,vt,this.clusterProps):this.points[ke[vt+3]])}if(Ke.length===0)throw new Error(Me);return Ke}getLeaves(J,re,ge){const Me=[];return this._appendLeaves(Me,J,re=re||10,ge=ge||0,0),Me}getTile(J,re,ge){const Me=this.trees[this._limitZoom(J)],_e=Math.pow(2,J),{extent:ke,radius:We}=this.options,je=We/ke,Ke=(ge-je)/_e,At=(ge+1+je)/_e,vt={features:[]};return this._addTileFeatures(Me.range((re-je)/_e,Ke,(re+1+je)/_e,At),Me.data,re,ge,_e,vt),re===0&&this._addTileFeatures(Me.range(1-je/_e,Ke,1,At),Me.data,_e,ge,_e,vt),re===_e-1&&this._addTileFeatures(Me.range(0,Ke,je/_e,At),Me.data,-1,ge,_e,vt),vt.features.length?vt:null}getClusterExpansionZoom(J){let re=this._getOriginZoom(J)-1;for(;re<=this.options.maxZoom;){const ge=this.getChildren(J);if(re++,ge.length!==1)break;J=ge[0].properties.cluster_id}return re}_appendLeaves(J,re,ge,Me,_e){const ke=this.getChildren(re);for(const We of ke){const je=We.properties;if(je&&je.cluster?_e+je.point_count<=Me?_e+=je.point_count:_e=this._appendLeaves(J,je.cluster_id,ge,Me,_e):_e<Me?_e++:J.push(We),J.length===ge)break}return _e}_createTree(J){const re=new r.c4(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<J.length;ge+=this.stride)re.add(J[ge],J[ge+1]);return re.finish(),re.data=J,re}_addTileFeatures(J,re,ge,Me,_e,ke){for(const We of J){const je=We*this.stride,Ke=re[je+5]>1;let At,vt,Zt;if(Ke)At=Cn(re,je,this.clusterProps),vt=re[je],Zt=re[je+1];else{const Mi=this.points[re[je+3]];At=Mi.properties;const[ji,li]=Mi.geometry.coordinates;vt=ws(ji),Zt=Ts(li)}const oi={type:1,geometry:[[Math.round(this.options.extent*(vt*_e-ge)),Math.round(this.options.extent*(Zt*_e-Me))]],tags:At};let hi;hi=Ke||this.options.generateId?re[je+3]:this.points[re[je+3]].id,hi!==void 0&&(oi.id=hi),ke.features.push(oi)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,re){const{radius:ge,extent:Me,reduce:_e,minPoints:ke}=this.options,We=ge/(Me*Math.pow(2,re)),je=J.data,Ke=[],At=this.stride;for(let vt=0;vt<je.length;vt+=At){if(je[vt+2]<=re)continue;je[vt+2]=re;const Zt=je[vt],oi=je[vt+1],hi=J.within(je[vt],je[vt+1],We),Mi=je[vt+5];let ji=Mi;for(const li of hi){const bi=li*At;je[bi+2]>re&&(ji+=je[bi+5])}if(ji>Mi&&ji>=ke){let li,bi=Zt*Mi,jn=oi*Mi,xr=-1;const Qn=(vt/At<<5)+(re+1)+this.points.length;for(const Cr of hi){const Kn=Cr*At;if(je[Kn+2]<=re)continue;je[Kn+2]=re;const sn=je[Kn+5];bi+=je[Kn]*sn,jn+=je[Kn+1]*sn,je[Kn+4]=Qn,_e&&(li||(li=this._map(je,vt,!0),xr=this.clusterProps.length,this.clusterProps.push(li)),_e(li,this._map(je,Kn)))}je[vt+4]=Qn,Ke.push(bi/ji,jn/ji,1/0,Qn,-1,ji),_e&&Ke.push(xr)}else{for(let li=0;li<At;li++)Ke.push(je[vt+li]);if(ji>1)for(const li of hi){const bi=li*At;if(!(je[bi+2]<=re)){je[bi+2]=re;for(let jn=0;jn<At;jn++)Ke.push(je[bi+jn])}}}}return Ke}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,re,ge){if(J[re+5]>1){const ke=this.clusterProps[J[re+6]];return ge?Object.assign({},ke):ke}const Me=this.points[J[re+3]].properties,_e=this.options.map(Me);return ge&&_e===Me?Object.assign({},_e):_e}}function Jr(Le,J,re){return{type:"Feature",id:Le[J+3],properties:Cn(Le,J,re),geometry:{type:"Point",coordinates:[(ge=Le[J],360*(ge-.5)),Aa(Le[J+1])]}};var ge}function Cn(Le,J,re){const ge=Le[J+5],Me=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,_e=Le[J+6],ke=_e===-1?{}:Object.assign({},re[_e]);return Object.assign(ke,{cluster:!0,cluster_id:Le[J+3],point_count:ge,point_count_abbreviated:Me})}function ws(Le){return Le/360+.5}function Ts(Le){const J=Math.sin(Le*Math.PI/180),re=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return re<0?0:re>1?1:re}function Aa(Le){const J=(180-360*Le)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function _r(Le,J,re,ge){let Me=ge;const _e=J+(re-J>>1);let ke,We=re-J;const je=Le[J],Ke=Le[J+1],At=Le[re],vt=Le[re+1];for(let Zt=J+3;Zt<re;Zt+=3){const oi=go(Le[Zt],Le[Zt+1],je,Ke,At,vt);if(oi>Me)ke=Zt,Me=oi;else if(oi===Me){const hi=Math.abs(Zt-_e);hi<We&&(ke=Zt,We=hi)}}Me>ge&&(ke-J>3&&_r(Le,J,ke,ge),Le[ke+2]=Me,re-ke>3&&_r(Le,ke,re,ge))}function go(Le,J,re,ge,Me,_e){let ke=Me-re,We=_e-ge;if(ke!==0||We!==0){const je=((Le-re)*ke+(J-ge)*We)/(ke*ke+We*We);je>1?(re=Me,ge=_e):je>0&&(re+=ke*je,ge+=We*je)}return ke=Le-re,We=J-ge,ke*ke+We*We}function tr(Le,J,re,ge){const Me={id:Le??null,type:J,geometry:re,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")Ss(Me,re);else if(J==="Polygon")Ss(Me,re[0]);else if(J==="MultiLineString")for(const _e of re)Ss(Me,_e);else if(J==="MultiPolygon")for(const _e of re)Ss(Me,_e[0]);return Me}function Ss(Le,J){for(let re=0;re<J.length;re+=3)Le.minX=Math.min(Le.minX,J[re]),Le.minY=Math.min(Le.minY,J[re+1]),Le.maxX=Math.max(Le.maxX,J[re]),Le.maxY=Math.max(Le.maxY,J[re+1])}function Ur(Le,J,re,ge){if(!J.geometry)return;const Me=J.geometry.coordinates;if(Me&&Me.length===0)return;const _e=J.geometry.type,ke=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2);let We=[],je=J.id;if(re.promoteId?je=J.properties[re.promoteId]:re.generateId&&(je=ge||0),_e==="Point")Xo(Me,We);else if(_e==="MultiPoint")for(const Ke of Me)Xo(Ke,We);else if(_e==="LineString")io(Me,We,ke,!1);else if(_e==="MultiLineString"){if(re.lineMetrics){for(const Ke of Me)We=[],io(Ke,We,ke,!1),Le.push(tr(je,"LineString",We,J.properties));return}Co(Me,We,ke,!1)}else if(_e==="Polygon")Co(Me,We,ke,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(const Ke of J.geometry.geometries)Ur(Le,{id:je,geometry:Ke,properties:J.properties},re,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ke of Me){const At=[];Co(Ke,At,ke,!0),We.push(At)}}Le.push(tr(je,_e,We,J.properties))}function Xo(Le,J){J.push(Vr(Le[0]),Ps(Le[1]),0)}function io(Le,J,re,ge){let Me,_e,ke=0;for(let je=0;je<Le.length;je++){const Ke=Vr(Le[je][0]),At=Ps(Le[je][1]);J.push(Ke,At,0),je>0&&(ke+=ge?(Me*At-Ke*_e)/2:Math.sqrt(Math.pow(Ke-Me,2)+Math.pow(At-_e,2))),Me=Ke,_e=At}const We=J.length-3;J[2]=1,_r(J,0,We,re),J[We+2]=1,J.size=Math.abs(ke),J.start=0,J.end=J.size}function Co(Le,J,re,ge){for(let Me=0;Me<Le.length;Me++){const _e=[];io(Le[Me],_e,re,ge),J.push(_e)}}function Vr(Le){return Le/360+.5}function Ps(Le){const J=Math.sin(Le*Math.PI/180),re=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return re<0?0:re>1?1:re}function Wr(Le,J,re,ge,Me,_e,ke,We){if(ge/=J,_e>=(re/=J)&&ke<ge)return Le;if(ke<re||_e>=ge)return null;const je=[];for(const Ke of Le){const At=Ke.geometry;let vt=Ke.type;const Zt=Me===0?Ke.minX:Ke.minY,oi=Me===0?Ke.maxX:Ke.maxY;if(Zt>=re&&oi<ge){je.push(Ke);continue}if(oi<re||Zt>=ge)continue;let hi=[];if(vt==="Point"||vt==="MultiPoint")Yo(At,hi,re,ge,Me);else if(vt==="LineString")$r(At,hi,re,ge,Me,!1,We.lineMetrics);else if(vt==="MultiLineString")Gr(At,hi,re,ge,Me,!1);else if(vt==="Polygon")Gr(At,hi,re,ge,Me,!0);else if(vt==="MultiPolygon")for(const Mi of At){const ji=[];Gr(Mi,ji,re,ge,Me,!0),ji.length&&hi.push(ji)}if(hi.length){if(We.lineMetrics&&vt==="LineString"){for(const Mi of hi)je.push(tr(Ke.id,vt,Mi,Ke.tags));continue}vt!=="LineString"&&vt!=="MultiLineString"||(hi.length===1?(vt="LineString",hi=hi[0]):vt="MultiLineString"),vt!=="Point"&&vt!=="MultiPoint"||(vt=hi.length===3?"Point":"MultiPoint"),je.push(tr(Ke.id,vt,hi,Ke.tags))}}return je.length?je:null}function Yo(Le,J,re,ge,Me){for(let _e=0;_e<Le.length;_e+=3){const ke=Le[_e+Me];ke>=re&&ke<=ge&&ha(J,Le[_e],Le[_e+1],Le[_e+2])}}function $r(Le,J,re,ge,Me,_e,ke){let We=yr(Le);const je=Me===0?Ko:Es;let Ke,At,vt=Le.start;for(let ji=0;ji<Le.length-3;ji+=3){const li=Le[ji],bi=Le[ji+1],jn=Le[ji+2],xr=Le[ji+3],Qn=Le[ji+4],Cr=Me===0?li:bi,Kn=Me===0?xr:Qn;let sn=!1;ke&&(Ke=Math.sqrt(Math.pow(li-xr,2)+Math.pow(bi-Qn,2))),Cr<re?Kn>re&&(At=je(We,li,bi,xr,Qn,re),ke&&(We.start=vt+Ke*At)):Cr>ge?Kn<ge&&(At=je(We,li,bi,xr,Qn,ge),ke&&(We.start=vt+Ke*At)):ha(We,li,bi,jn),Kn<re&&Cr>=re&&(At=je(We,li,bi,xr,Qn,re),sn=!0),Kn>ge&&Cr<=ge&&(At=je(We,li,bi,xr,Qn,ge),sn=!0),!_e&&sn&&(ke&&(We.end=vt+Ke*At),J.push(We),We=yr(Le)),ke&&(vt+=Ke)}let Zt=Le.length-3;const oi=Le[Zt],hi=Le[Zt+1],Mi=Me===0?oi:hi;Mi>=re&&Mi<=ge&&ha(We,oi,hi,Le[Zt+2]),Zt=We.length-3,_e&&Zt>=3&&(We[Zt]!==We[0]||We[Zt+1]!==We[1])&&ha(We,We[0],We[1],We[2]),We.length&&J.push(We)}function yr(Le){const J=[];return J.size=Le.size,J.start=Le.start,J.end=Le.end,J}function Gr(Le,J,re,ge,Me,_e){for(const ke of Le)$r(ke,J,re,ge,Me,_e,!1)}function ha(Le,J,re,ge){Le.push(J,re,ge)}function Ko(Le,J,re,ge,Me,_e){const ke=(_e-J)/(ge-J);return ha(Le,_e,re+(Me-re)*ke,1),ke}function Es(Le,J,re,ge,Me,_e){const ke=(_e-re)/(Me-re);return ha(Le,J+(ge-J)*ke,_e,1),ke}function Io(Le,J){const re=[];for(let ge=0;ge<Le.length;ge++){const Me=Le[ge],_e=Me.type;let ke;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")ke=Ro(Me.geometry,J);else if(_e==="MultiLineString"||_e==="Polygon"){ke=[];for(const We of Me.geometry)ke.push(Ro(We,J))}else if(_e==="MultiPolygon"){ke=[];for(const We of Me.geometry){const je=[];for(const Ke of We)je.push(Ro(Ke,J));ke.push(je)}}re.push(tr(Me.id,_e,ke,Me.tags))}return re}function Ro(Le,J){const re=[];re.size=Le.size,Le.start!==void 0&&(re.start=Le.start,re.end=Le.end);for(let ge=0;ge<Le.length;ge+=3)re.push(Le[ge]+J,Le[ge+1],Le[ge+2]);return re}function Jo(Le,J){if(Le.transformed)return Le;const re=1<<Le.z,ge=Le.x,Me=Le.y;for(const _e of Le.features){const ke=_e.geometry,We=_e.type;if(_e.geometry=[],We===1)for(let je=0;je<ke.length;je+=2)_e.geometry.push(ot(ke[je],ke[je+1],J,re,ge,Me));else for(let je=0;je<ke.length;je++){const Ke=[];for(let At=0;At<ke[je].length;At+=2)Ke.push(ot(ke[je][At],ke[je][At+1],J,re,ge,Me));_e.geometry.push(Ke)}}return Le.transformed=!0,Le}function ot(Le,J,re,ge,Me,_e){return[Math.round(re*(Le*ge-Me)),Math.round(re*(J*ge-_e))]}function It(Le,J,re,ge,Me){const _e=J===Me.maxZoom?0:Me.tolerance/((1<<J)*Me.extent),ke={features:[],numPoints:0,numSimplified:0,numFeatures:Le.length,source:null,x:re,y:ge,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const We of Le)ui(ke,We,_e,Me);return ke}function ui(Le,J,re,ge){const Me=J.geometry,_e=J.type,ke=[];if(Le.minX=Math.min(Le.minX,J.minX),Le.minY=Math.min(Le.minY,J.minY),Le.maxX=Math.max(Le.maxX,J.maxX),Le.maxY=Math.max(Le.maxY,J.maxY),_e==="Point"||_e==="MultiPoint")for(let We=0;We<Me.length;We+=3)ke.push(Me[We],Me[We+1]),Le.numPoints++,Le.numSimplified++;else if(_e==="LineString")Mn(ke,Me,Le,re,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(let We=0;We<Me.length;We++)Mn(ke,Me[We],Le,re,_e==="Polygon",We===0);else if(_e==="MultiPolygon")for(let We=0;We<Me.length;We++){const je=Me[We];for(let Ke=0;Ke<je.length;Ke++)Mn(ke,je[Ke],Le,re,!0,Ke===0)}if(ke.length){let We=J.tags||null;if(_e==="LineString"&&ge.lineMetrics){We={};for(const Ke in J.tags)We[Ke]=J.tags[Ke];We.mapbox_clip_start=Me.start/Me.size,We.mapbox_clip_end=Me.end/Me.size}const je={geometry:ke,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:We};J.id!==null&&(je.id=J.id),Le.features.push(je)}}function Mn(Le,J,re,ge,Me,_e){const ke=ge*ge;if(ge>0&&J.size<(Me?ke:ge))return void(re.numPoints+=J.length/3);const We=[];for(let je=0;je<J.length;je+=3)(ge===0||J[je+2]>ke)&&(re.numSimplified++,We.push(J[je],J[je+1])),re.numPoints++;Me&&(function(je,Ke){let At=0;for(let vt=0,Zt=je.length,oi=Zt-2;vt<Zt;oi=vt,vt+=2)At+=(je[vt]-je[oi])*(je[vt+1]+je[oi+1]);if(At>0===Ke)for(let vt=0,Zt=je.length;vt<Zt/2;vt+=2){const oi=je[vt],hi=je[vt+1];je[vt]=je[Zt-2-vt],je[vt+1]=je[Zt-1-vt],je[Zt-2-vt]=oi,je[Zt-1-vt]=hi}})(We,_e),Le.push(We)}const In={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Xr{constructor(J,re){const ge=(re=this.options=(function(_e,ke){for(const We in ke)_e[We]=ke[We];return _e})(Object.create(In),re)).debug;if(ge&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");let Me=(function(_e,ke){const We=[];if(_e.type==="FeatureCollection")for(let je=0;je<_e.features.length;je++)Ur(We,_e.features[je],ke,je);else Ur(We,_e.type==="Feature"?_e:{geometry:_e},ke);return We})(J,re);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Me=(function(_e,ke){const We=ke.buffer/ke.extent;let je=_e;const Ke=Wr(_e,1,-1-We,We,0,-1,2,ke),At=Wr(_e,1,1-We,2+We,0,-1,2,ke);return(Ke||At)&&(je=Wr(_e,1,-We,1+We,0,-1,2,ke)||[],Ke&&(je=Io(Ke,1).concat(je)),At&&(je=je.concat(Io(At,-1)))),je})(Me,re),Me.length&&this.splitTile(Me,0,0,0),ge&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,re,ge,Me,_e,ke,We){const je=[J,re,ge,Me],Ke=this.options,At=Ke.debug;for(;je.length;){Me=je.pop(),ge=je.pop(),re=je.pop(),J=je.pop();const vt=1<<re,Zt=Gn(re,ge,Me);let oi=this.tiles[Zt];if(!oi&&(At>1&&console.time("creation"),oi=this.tiles[Zt]=It(J,re,ge,Me,Ke),this.tileCoords.push({z:re,x:ge,y:Me}),At)){At>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,ge,Me,oi.numFeatures,oi.numPoints,oi.numSimplified),console.timeEnd("creation"));const sn=`z${re}`;this.stats[sn]=(this.stats[sn]||0)+1,this.total++}if(oi.source=J,_e==null){if(re===Ke.indexMaxZoom||oi.numPoints<=Ke.indexMaxPoints)continue}else{if(re===Ke.maxZoom||re===_e)continue;if(_e!=null){const sn=_e-re;if(ge!==ke>>sn||Me!==We>>sn)continue}}if(oi.source=null,J.length===0)continue;At>1&&console.time("clipping");const hi=.5*Ke.buffer/Ke.extent,Mi=.5-hi,ji=.5+hi,li=1+hi;let bi=null,jn=null,xr=null,Qn=null,Cr=Wr(J,vt,ge-hi,ge+ji,0,oi.minX,oi.maxX,Ke),Kn=Wr(J,vt,ge+Mi,ge+li,0,oi.minX,oi.maxX,Ke);J=null,Cr&&(bi=Wr(Cr,vt,Me-hi,Me+ji,1,oi.minY,oi.maxY,Ke),jn=Wr(Cr,vt,Me+Mi,Me+li,1,oi.minY,oi.maxY,Ke),Cr=null),Kn&&(xr=Wr(Kn,vt,Me-hi,Me+ji,1,oi.minY,oi.maxY,Ke),Qn=Wr(Kn,vt,Me+Mi,Me+li,1,oi.minY,oi.maxY,Ke),Kn=null),At>1&&console.timeEnd("clipping"),je.push(bi||[],re+1,2*ge,2*Me),je.push(jn||[],re+1,2*ge,2*Me+1),je.push(xr||[],re+1,2*ge+1,2*Me),je.push(Qn||[],re+1,2*ge+1,2*Me+1)}}getTile(J,re,ge){J=+J,re=+re,ge=+ge;const Me=this.options,{extent:_e,debug:ke}=Me;if(J<0||J>24)return null;const We=1<<J,je=Gn(J,re=re+We&We-1,ge);if(this.tiles[je])return Jo(this.tiles[je],_e);ke>1&&console.log("drilling down to z%d-%d-%d",J,re,ge);let Ke,At=J,vt=re,Zt=ge;for(;!Ke&&At>0;)At--,vt>>=1,Zt>>=1,Ke=this.tiles[Gn(At,vt,Zt)];return Ke&&Ke.source?(ke>1&&(console.log("found parent tile z%d-%d-%d",At,vt,Zt),console.time("drilling down")),this.splitTile(Ke.source,At,vt,Zt,J,re,ge),ke>1&&console.timeEnd("drilling down"),this.tiles[je]?Jo(this.tiles[je],_e):null):null}}function Gn(Le,J,re){return 32*((1<<Le)*re+J)+Le}function pt(Le,J){const re=Le.tileID.canonical;if(!this._geoJSONIndex)return void J(null,null);const ge=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!ge)return void J(null,null);const Me=Ke=>Ke.tags&&"3d_elevation_id"in Ke.tags&&"source"in Ke.tags&&Ke.tags.source==="elevation",_e=ge.features.filter(Ke=>Me(Ke));let ke={_geojsonTileLayer:ge.features};_e.length>0&&(ke={_geojsonTileLayer:ge.features.filter(Ke=>!Me(Ke)),hd_road_elevation:_e});const We=new Si(ke),je=(function(Ke){const At=new r.bt;for(const vt of Object.keys(Ke))At.writeMessage(3,Bi,{name:vt,features:Ke[vt]});return At.finish()})(ke).buffer;J(null,{vectorTile:We,rawData:je})}class Yn extends Ht{constructor(J,re,ge,Me,_e,ke,We){super(J,re,ge,Me,_e,pt,We),ke&&(this.loadGeoJSON=ke),this._dynamicIndex=new gt}loadData(J,re){const ge=J&&J.request,Me=ge&&ge.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(J,(_e,ke)=>{if(_e||!ke)return re(_e);if(typeof ke!="object")return re(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));{try{if(J.filter){const je=r.U(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(je.result==="error")throw new Error(je.value.map(Ke=>`${Ke.key}: ${Ke.message}`).join(", "));ke.features=ke.features.filter(Ke=>je.value.evaluate({zoom:0},Ke))}J.dynamic?(ke.type==="Feature"&&(ke={type:"FeatureCollection",features:[ke]}),J.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ke.features,this.loaded),J.cluster&&(ke.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=J.cluster?new Gs((function({superclusterOptions:je,clusterProperties:Ke}){if(!Ke||!je)return je;const At={},vt={},Zt={accumulated:null,zoom:0},oi={properties:null},hi=Object.keys(Ke);for(const Mi of hi){const[ji,li]=Ke[Mi],bi=r.U(li),jn=r.U(typeof ji=="string"?[ji,["accumulated"],["get",Mi]]:ji);At[Mi]=bi.value,vt[Mi]=jn.value}return je.map=Mi=>{oi.properties=Mi;const ji={};for(const li of hi)ji[li]=At[li].evaluate(Zt,oi);return ji},je.reduce=(Mi,ji)=>{oi.properties=ji;for(const li of hi)Zt.accumulated=Mi[li],Mi[li]=vt[li].evaluate(Zt,oi)},je})(J)).load(ke.features):J.dynamic?this._dynamicIndex:(function(je,Ke){return new Xr(je,Ke)})(ke,J.geojsonVtOptions)}catch(je){return re(je)}const We={};if(Me){const je=q(ge);je&&(We.resourceTiming={},We.resourceTiming[J.source]=JSON.parse(JSON.stringify(je)))}re(null,We)}})}reloadTile(J,re){const ge=this.loaded;return ge&&ge[J.uid]?J.partial?re(null,void 0):super.reloadTile(J,re):this.loadTile(J,re)}loadGeoJSON(J,re){if(J.request)r.m(J.request,re);else{if(typeof J.data!="string")return re(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return re(null,JSON.parse(J.data))}catch{return re(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(J,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(J.clusterId))}catch(ge){re(ge)}}getClusterChildren(J,re){try{re(null,this._geoJSONIndex.getChildren(J.clusterId))}catch(ge){re(ge)}}getClusterLeaves(J,re){try{re(null,this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset))}catch(ge){re(ge)}}}class or{constructor(J,re,ge){this.tileID=new r.aQ(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=J.projection,this.brightness=re,this.worldview=ge}parse(J,re,ge,Me){this.status="parsing";const _e=new r.aQ(ge.tileID.overscaledZ,ge.tileID.wrap,ge.tileID.canonical.z,ge.tileID.canonical.x,ge.tileID.canonical.y),ke=[],We=re.familiesBySource[ge.source],je=new r.fn(_e,ge.promoteId);je.bucketLayerIDs=[],je.is3DTile=!0,r.fC(J).then(Ke=>{if(!Ke)return Me(new Error("Could not parse tile"));const At=Ke.json.extensionsUsed&&Ke.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ke.json.asset.extras&&Ke.json.asset.extras.MAPBOX_mesh_features,vt=Ke.json.extensionsUsed&&Ke.json.extensionsUsed.includes("EXT_meshopt_compression"),Zt=new r.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const oi in We)for(const hi of We[oi]){const Mi=hi[0];je.bucketLayerIDs.push(hi.map(bi=>r.B(bi.id,bi.scope))),Mi.recalculate(Zt,[]);const ji=r.fD(Ke,1/r.d7(ge.tileID.canonical)),li=new r.fE(hi,ji,_e,At,vt,this.brightness,je,this.worldview);At||(li.needsUpload=!0),ke.push(li),li.evaluate(Mi)}this.status="done",Me(null,{buckets:ke,featureIndex:je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ke=>Me(new Error(Ke.message)))}}class vr{constructor(J,re,ge,Me,_e,ke,We,je){this.actor=J,this.layerIndex=re,this.availableImages=ge,this.availableModels=Me,this.brightness=We,this.loading={},this.loaded={},this.worldview=je}loadTile(J,re){const ge=J.uid,Me=this.loading[ge]=new or(J,this.brightness,this.worldview);r.bu(J.request,(_e,ke)=>{const We=!this.loading[ge];return delete this.loading[ge],We||_e?(Me.status="done",We||(this.loaded[ge]=Me),re(_e)):ke&&ke.byteLength!==0?void Me.parse(ke,this.layerIndex,J,(je,Ke)=>{Me.status="done",this.loaded=this.loaded||{},this.loaded[ge]=Me,je||!Ke?re(je):re(null,Ke)}):(Me.status="done",this.loaded[ge]=Me,re())})}reloadTile(J,re){const ge=this.loaded,Me=J.uid;if(ge&&ge[Me]){const _e=ge[Me];_e.projection=J.projection,_e.brightness=J.brightness;const ke=(We,je)=>{_e.reloadCallback&&(delete _e.reloadCallback,this.loadTile(J,re)),re(We,je)};_e.status==="parsing"?_e.reloadCallback=ke:_e.status==="done"&&this.loadTile(J,re)}}abortTile(J,re){const ge=J.uid;this.loading[ge]&&delete this.loading[ge],re()}removeTile(J,re){const ge=this.loaded,Me=J.uid;ge&&ge[Me]&&delete ge[Me],re()}}class Ni{constructor(J){this.self=J,this.actor=new r.fG(J,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.cm({name:"mercator"}),this.workerSourceTypes={vector:Ht,geojson:Yn,"raster-dem":Ei,"raster-array":en,"batched-model":vr},this.workerSources={},this.self.registerWorkerSource=(re,ge)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=ge},this.self.registerRTLTextPlugin=re=>{if(r.fH.isParsed())throw new Error("RTL text plugin already registered.");r.fH.setState({pluginStatus:r.fI.parsed,pluginURL:r.fH.getPluginURL()}),r.fH.applyArabicShaping=re.applyArabicShaping,r.fH.processBidirectionalText=re.processBidirectionalText,r.fH.processStyledBidirectionalText=re.processStyledBidirectionalText;for(const ge of this.rtlPluginParsingListeners)ge(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(J,re,ge){delete this.layerIndexes[J],delete this.availableImages[J],delete this.availableModels[J],delete this.workerSources[J],ge()}checkIfReady(J,re,ge){ge()}setReferrer(J,re){this.referrer=re}spriteLoaded(J,re){this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={});const{scope:ge,isLoaded:Me}=re;if(this.isSpriteLoaded[J][ge]=Me,this.workerSources[J]&&this.workerSources[J][ge])for(const _e in this.workerSources[J][ge]){const ke=this.workerSources[J][ge][_e];for(const We in ke){const je=ke[We];je instanceof Ht&&(je.isSpriteLoaded=Me,je.fire(new r.z("isSpriteLoaded")))}}}setImages(J,re,ge){this.availableImages[J]||(this.availableImages[J]={});const{scope:Me,images:_e}=re;if(this.availableImages[J][Me]=_e,this.workerSources[J]&&this.workerSources[J][Me]){for(const ke in this.workerSources[J][Me]){const We=this.workerSources[J][Me][ke];for(const je in We)We[je].availableImages=_e}ge()}else ge()}setModels(J,{scope:re,models:ge},Me){if(this.availableModels[J]||(this.availableModels[J]={}),this.availableModels[J][re]=ge,this.workerSources[J]&&this.workerSources[J][re]){for(const _e in this.workerSources[J][re]){const ke=this.workerSources[J][re][_e];for(const We in ke)ke[We].availableModels=ge}Me()}else Me()}setProjection(J,re){this.projections[J]=r.cm(re)}setBrightness(J,re,ge){this.brightness=re,ge()}setWorldview(J,re,ge){this.worldview=re,ge()}setLayers(J,re,ge){this.getLayerIndex(J,re.scope).replace(re.layers,re.options),ge()}updateLayers(J,re,ge){this.getLayerIndex(J,re.scope).update(re.layers,re.removedIds,re.options),ge()}loadTile(J,re,ge){re.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,re.type,re.source,re.scope).loadTile(re,ge)}decodeRasterArray(J,re,ge){this.getWorkerSource(J,re.type,re.source,re.scope).decodeRasterArray(re,ge)}reloadTile(J,re,ge){re.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,re.type,re.source,re.scope).reloadTile(re,ge)}abortTile(J,re,ge){this.getWorkerSource(J,re.type,re.source,re.scope).abortTile(re,ge)}removeTile(J,re,ge){this.getWorkerSource(J,re.type,re.source,re.scope).removeTile(re,ge)}removeSource(J,re,ge){if(!(this.workerSources[J]&&this.workerSources[J][re.scope]&&this.workerSources[J][re.scope][re.type]&&this.workerSources[J][re.scope][re.type][re.source]))return;const Me=this.workerSources[J][re.scope][re.type][re.source];delete this.workerSources[J][re.scope][re.type][re.source],Me.removeSource!==void 0?Me.removeSource(re,ge):ge()}loadWorkerSource(J,re,ge){try{this.self.importScripts(re.url),ge()}catch(Me){ge(Me)}}syncRTLPluginState(J,re,ge){if(r.fH.isParsed())ge(null,!0);else if(r.fH.isParsing())this.rtlPluginParsingListeners.push(ge);else try{r.fH.setState(re);const Me=r.fH.getPluginURL();!r.fH.isLoaded()||r.fH.isParsed()||r.fH.isParsing()||Me==null||(r.fH.setState({pluginStatus:r.fI.parsing,pluginURL:r.fH.getPluginURL()}),this.self.importScripts(Me),r.fH.isParsed()?ge(null,!0):this.rtlPluginParsingListeners.push(ge))}catch(Me){ge(Me)}}setDracoUrl(J,re){this.dracoUrl=re}getAvailableImages(J,re){this.availableImages[J]||(this.availableImages[J]={});let ge=this.availableImages[J][re];return ge||(ge=[]),ge}getAvailableModels(J,re){this.availableModels[J]||(this.availableModels[J]={});let ge=this.availableModels[J][re];return ge||(ge={}),ge}getLayerIndex(J,re){this.layerIndexes[J]||(this.layerIndexes[J]={});let ge=this.layerIndexes[J][re];return ge||(ge=this.layerIndexes[J][re]=new me,ge.scope=re),ge}getWorkerSource(J,re,ge,Me){const _e=this.workerSources;return _e[J]||(_e[J]={}),_e[J][Me]||(_e[J][Me]={}),_e[J][Me][re]||(_e[J][Me][re]={}),this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={}),_e[J][Me][re][ge]||(_e[J][Me][re][ge]=new this.workerSourceTypes[re]({send:(ke,We,je,Ke,At,vt)=>this.actor.send(ke,We,je,J,At,vt),scheduler:this.actor.scheduler},this.getLayerIndex(J,Me),this.getAvailableImages(J,Me),this.getAvailableModels(J,Me),this.isSpriteLoaded[J][Me],void 0,this.brightness,this.worldview)),_e[J][Me][re][ge]}rasterizeImagesWorker(J,re,ge){const Me=new Map;for(const[_e,{image:ke,imageVariant:We}]of re.tasks.entries()){const je=this.imageRasterizer.rasterize(We,ke,re.scope,J);Me.set(_e,je)}ge(void 0,Me)}removeRasterizedImages(J,re,ge){this.imageRasterizer.removeImagesFromCacheByIds(re.imageIds,re.scope,J),ge()}enforceCacheSizeLimit(J,re){r.fJ(re)}getWorkerPerformanceMetrics(J,re,ge){ge(void 0,void 0)}}return r.fF(self)&&(self.worker=new Ni(self)),Ni}),D(["./shared"],function(r){var q="3.18.0";const H={create:"create",load:"load",fullLoad:"fullLoad"},ie={mark(c){performance.mark(c)},measure(c,t,o){performance.measure(c,t,o)}};function Q(c){const t=c.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var me,we={},Ae=(function(){if(me)return we;function c(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,b,E=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(E);try{b=new Worker(C),v=!0}catch{v=!1}return b&&b.terminate(),URL.revokeObjectURL(C),v})()?(function(){var v=document.createElement("canvas");v.width=v.height=1;var b=v.getContext("2d");if(!b)return!1;var E=b.getImageData(0,0,1,1);return E&&E.width===v.width})()?(o[g=u&&u.failIfMajorPerformanceCaveat]===void 0&&(o[g]=(function(v){var b,E=(function(C){var P=document.createElement("canvas"),z=Object.create(c.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=C,P.getContext("webgl2",z)})(v);if(!E)return!1;try{b=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!b||E.isContextLost())&&(E.shaderSource(b,"void main() {}"),E.compileShader(b),E.getShaderParameter(b,E.COMPILE_STATUS)===!0)})(g)),o[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}me=1,we.supported=c,we.notSupportedReason=t;var o={};return c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},we})();function he(c,t,o){const u=document.createElement(c);return t!=null&&(u.className=t),o&&o.appendChild(u),u}function Re(c,t,o){const u=document.createElementNS("http://www.w3.org/2000/svg",c);for(const g of Object.keys(t))u.setAttributeNS(null,g,String(t[g]));return o&&o.appendChild(u),u}const Ne=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ge=Ne&&Ne.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ue;function rt(){Ne&&Ge&&(Ue=Ne[Ge],Ne[Ge]="none")}function Pt(){Ne&&Ge&&(Ne[Ge]=Ue)}function Bt(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",Bt,!0)}function Tt(){window.addEventListener("click",Bt,!0),window.setTimeout(()=>{window.removeEventListener("click",Bt,!0)},0)}function Ht(c,t){const o=c.getBoundingClientRect();return en(c,o,t)}function Ei(c,t){const o=c.getBoundingClientRect(),u=[];for(let g=0;g<t.length;g++)u.push(en(c,o,t[g]));return u}function rn(c){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&c.button===2&&c.ctrlKey?0:c.button}function en(c,t,o){const u=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new r.P((o.clientX-t.left)*u,(o.clientY-t.top)*u)}const Ui="01",si="NO_ACCESS_TOKEN";class Ji{constructor(t,o,u){this._transformRequestFn=t,this._customAccessToken=o,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=(function(){let o="";for(let u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ui,o].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeStyleURL(t,o){if(!r.h(t))return t;const u=Xe(t);return u.params.push(`sdk=js-${q}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeGlyphsURL(t,o){if(!r.h(t))return t;const u=Xe(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeModelURL(t,o){if(!r.h(t))return t;const u=Xe(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeSourceURL(t,o,u,g){if(!r.h(t))return t;const v=Xe(t);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),u&&v.params.push(`language=${u}`),g&&v.params.push(`worldview=${g}`),this._makeAPIURL(v,this._customAccessToken||o)}normalizeIconsetURL(t,o){const u=Xe(t);return r.h(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||o)):gt(u)}normalizeSpriteURL(t,o,u,g){const v=Xe(t);return r.h(t)?(v.path=`/styles/v1${v.path}/sprite${o}${u}`,this._makeAPIURL(v,this._customAccessToken||g)):(v.path+=`${o}${u}`,gt(v))}normalizeTileURL(t,o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.h(t))return t;const g=Xe(t);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||u&&g.authority!=="raster"&&u===512?"@2x":""}${r.k.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${r.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${r.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${r.e.TILE_URL_VERSION}${g.path}`);const v=this._customAccessToken||(function(b){for(const E of b){const C=E.match(/^access_token=(.*)$/);if(C)return C[1]}return null})(g.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,v)}canonicalizeTileURL(t,o){const u=Xe(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let g="mapbox://";u.path.match(/^\/raster\/v1\//)?g+=`raster/${u.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${u.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${u.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let v=u.params;return o&&(v=v.filter(b=>!b.match(/^access_token=/))),v.length&&(g+=`?${v.join("&")}`),g}canonicalizeTileset(t,o){const u=!!o&&r.h(o),g=[];for(const v of t.tiles||[])r.j(v)?g.push(this.canonicalizeTileURL(v,u)):g.push(v);return g}_makeAPIURL(t,o){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=Xe(r.e.API_URL);if(t.protocol=g.protocol,t.authority=g.authority,t.protocol==="http"){const v=t.params.indexOf("secure");v>=0&&t.params.splice(v,1)}if(g.path!=="/"&&(t.path=`${g.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return gt(t);if(o=o||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(v=>v.indexOf("access_token")===-1),t.params.push(`access_token=${o||""}`),gt(t)}}const Si=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Xe(c){const t=c.match(Si);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function gt(c){const t=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${t}`}const yt="mapbox.eventData";function mi(c){if(!c)return null;const t=c.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.l(t[1]))}catch{return null}}class Ci{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const o=mi(r.e.ACCESS_TOKEN);let u="";return u=o&&o.u?r.f(o.u):r.e.ACCESS_TOKEN||"",t?`${yt}.${t}:${u}`:`${yt}:${u}`}fetchEventData(){const t=r.s("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid"),g=this.getStorageKey("uuidTimestamp");if(t)try{const v=localStorage.getItem(o);v&&(this.eventData=JSON.parse(v));const b=localStorage.getItem(u);b&&(this.anonId=b);const E=localStorage.getItem(g);E&&(this.anonIdTimestamp=Number(E));const C=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<C)&&this.refreshUUID()}catch{r.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=r.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=r.s("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid"),g=this.getStorageKey("uuidTimestamp"),v=this.anonId,b=this.anonIdTimestamp;if(t&&v)try{localStorage.setItem(u,v),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData)),b&&localStorage.setItem(g,b.toString())}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,u,g){if(!r.e.EVENTS_URL)return;const v=Xe(r.e.EVENTS_URL);v.params.push(`access_token=${g||r.e.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(t).toISOString()},E=o?Object.assign(b,o):b,C={url:gt(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=r.p(C,P=>{this.pendingRequest=null,u(P),this.saveEventData(),this.processRequests(g)})}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}class Fe extends Ci{constructor(t){super("metrics"),t&&(this.data=t)}postMetricsEvent(t){if(!r.e.EVENTS_URL||!t&&!r.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID();const o=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:o},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:u}=this.queue.shift();this.postEvent(o,u,()=>{},t)}}const wt=new class extends Ci{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(c)&&c.some(o=>r.h(o)||r.j(o))&&this.queueRequest(Date.now(),t)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=mi(r.e.ACCESS_TOKEN),o=t?t.u:r.e.ACCESS_TOKEN;let u=o!==this.eventData.tokenU;r.v(this.anonId)||(this.refreshUUID(),u=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),b=new Date(g),E=(g-this.eventData.lastSuccess)/864e5;u=u||E>=1||E<-1||v.getDate()!==b.getDate()}else u=!0;u?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:q,skuId:Ui,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=g,this.eventData.tokenU=o)},c):this.processRequests()}},bt=wt.postTurnstileEvent.bind(wt),Gt=new class extends Ci{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,t,o,u){this.skuToken=t,this.errorCb=u,r.e.EVENTS_URL&&(o||r.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},o):this.errorCb(new Error(si)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID(),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:q,skuId:Ui,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c))}remove(){this.errorCb=null}},ci=Gt.postMapLoadEvent.bind(Gt),Bi=new class extends Ci{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(c){let t=this.mapInstanceIdMap.get(c);return t||(t=r.u(),this.mapInstanceIdMap.set(c,t)),t}getEventId(c){const t=this.eventIdPerMapInstanceMap.get(c)||0;return this.eventIdPerMapInstanceMap.set(c,t+1),t}postStyleLoadEvent(c,t){const{map:o,style:u,importedStyles:g}=t;if(!r.e.EVENTS_URL||!c&&!r.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(o),b={mapInstanceId:v,eventId:this.getEventId(v),style:u};g.length&&(b.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:b},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,()=>{},c)}},Qt=Bi.postStyleLoadEvent.bind(Bi),Ii=new Fe({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),fi=Ii.postMetricsEvent.bind(Ii),Ri=new Fe({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Fi=Ri.postMetricsEvent.bind(Ri),Oi=new class extends Ci{constructor(){super("gljs.performance")}postPerformanceEvent(c,t){r.e.EVENTS_URL&&(c||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:o}=this.queue.shift(),u=(function(g){const v=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),E=(function(V){const X={};if(V){for(const Z in V)if(Z!=="other")for(const Y of V[Z]){const ne=`${Z}ResolveRangeMin`,ue=`${Z}ResolveRangeMax`,ce=`${Z}RequestCount`,ae=`${Z}RequestCachedCount`;X[ne]=Math.min(X[ne]||1/0,Y.startTime),X[ue]=Math.max(X[ue]||-1/0,Y.responseEnd);const Ee=xe=>{X[xe]===void 0&&(X[xe]=0),++X[xe]};Y.transferSize!==void 0&&Y.transferSize===0&&Ee(ae),Ee(ce)}}return X})((function(V,X){const Z={};if(V)for(const Y of V){const ne=X(Y);Z[ne]===void 0&&(Z[ne]=[]),Z[ne].push(Y)}return Z})(v,Q)),C=window.devicePixelRatio,P=navigator.connection||navigator.mozConnection||navigator.webkitConnection,z=P?P.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},N=(V,X,Z)=>{Z!=null&&V.push({name:X,value:Z.toString()})};for(const V in E)N(U.counters,V,E[V]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(N(U.counters,"interactionRangeMin",g.interactionRange[0]),N(U.counters,"interactionRangeMax",g.interactionRange[1])),b)for(const V of Object.values(H)){const X=b.find(Z=>Z.name===V);X&&N(U.counters,V,X.startTime)}return N(U.counters,"visibilityHidden",g.visibilityHidden),N(U.attributes,"style",(function(V){if(V)for(const X of V){const Z=X.name.split("?")[0];if(r.i(Z)){const Y=Z.split("/").slice(-2);if(Y.length===2)return`mapbox://styles/${Y[0]}/${Y[1]}`}}})(v)),N(U.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),N(U.attributes,"fogEnabled",g.fogEnabled?"true":"false"),N(U.attributes,"projection",g.projection),N(U.attributes,"zoom",g.zoom),N(U.metadata,"devicePixelRatio",C),N(U.metadata,"connectionEffectiveType",z),N(U.metadata,"navigatorUserAgent",navigator.userAgent),N(U.metadata,"screenWidth",window.screen.width),N(U.metadata,"screenHeight",window.screen.height),N(U.metadata,"windowWidth",window.innerWidth),N(U.metadata,"windowHeight",window.innerHeight),N(U.metadata,"mapWidth",g.width/C),N(U.metadata,"mapHeight",g.height/C),N(U.metadata,"webglRenderer",g.renderer),N(U.metadata,"webglVendor",g.vendor),N(U.metadata,"sdkVersion",q),N(U.metadata,"sdkIdentifier","mapbox-gl-js"),U})(o);for(const g of u.metadata);for(const g of u.counters);for(const g of u.attributes);this.postEvent(t,u,()=>{},c)}},vn=Oi.postPerformanceEvent.bind(Oi),Mr=new class extends Ci{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,t,o,u){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const g=Xe(r.e.API_URL+r.e.SESSION_PATH);g.params.push(`sku=${t||""}`),g.params.push(`access_token=${u||r.e.ACCESS_TOKEN||""}`);const v={url:gt(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(v,b=>{this.pendingRequest=null,o(b),this.saveEventData(),this.processRequests(u)})}getSessionAPI(c,t,o,u){this.skuToken=t,this.errorCb=u,r.e.SESSION_PATH&&r.e.API_URL&&(o||r.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},o):this.errorCb(new Error(si)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c)}remove(){this.errorCb=null}},Vs=Mr.getSessionAPI.bind(Mr),Gs=new Set;function Jr(c,t){t?Gs.add(c):Gs.delete(c)}class Cn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,o){this._updatedSourceCaches[t]=o,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const o=t.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(t.id),this.setDirty()}removeLayer(t){const o=t.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][t.id]=t,this._updatedLayers[o].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const o in this._updatedLayers)t[o]=t[o]||{},t[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)t[o]=t[o]||{},t[o].removedIds=Object.keys(this._removedLayers[o]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,o){this._updatedImages[o]=this._updatedImages[o]||new Set,this._updatedImages[o].add(r.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function ws(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ts extends r.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.r()&&(this.imageRasterizerDispatcher=new r.D(r.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new r.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const o=this.atlasTexture.get(t);o&&(o.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,o){this.imageProviders.has(o)||this.imageProviders.set(o,new Map),this.imageProviders.get(o).set(t.id,t)}removeImageProvider(t,o){this.imageProviders.has(o)&&this.imageProviders.get(o).delete(t)}getPendingImageProviders(){const t=[];for(const o of this.imageProviders.values())for(const u of o.values())u.hasPendingRequests()&&t.push(u);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,o){if(this.loaded.get(o)!==t&&(this.loaded.set(o,t),t)){for(const{ids:u,callback:g}of this.requestors)this._notify(u,o,g);this.requestors=[]}}hasImage(t,o){return!!this.getImage(t,o)}getImage(t,o){return this.images.get(o).get(t.toString())}addImage(t,o,u){this._validate(t,u)&&this.images.get(o).set(t.toString(),u)}_validate(t,o){let u=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "content" value`))),u=!1),u}_validateStretch(t,o){if(!t)return!0;let u=0;for(const g of t){if(g[0]<u||g[1]<g[0]||o<g[1])return!1;u=g[1]}return!0}_validateContent(t,o){return t?t.length!==4||!o.usvg&&(t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,o,u){const g=this.images.get(o).get(t.toString());u.version=g.version+1,this.images.get(o).set(t.toString(),u),this.updatedImages.get(o).add(t),this.removeFromImageRasterizerCache(t,o)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,o){this.spriteFormat!=="raster"&&(r.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:o}):this.imageRasterizer.removeImagesFromCacheByIds([t],o))}removeImage(t,o){const u=this.images.get(o),g=u.get(t.toString());u.delete(t.toString()),this.patterns.get(o).delete(t.toString()),this.removeFromImageRasterizerCache(t,o),g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(o=>r.I.from(o))}getImages(t,o,u){const g=[],v=[],b=this.imageProviders.get(o);for(const z of t){if(!z.iconsetId){g.push(z);continue}const U=b.get(z.iconsetId);U&&(this.getImage(z,o)?v.push(z):U.addPendingRequest(z))}if(g.length===0)return void this._notify(v,o,u);let E=!0;const C=!!this.loaded.get(o),P=this.images.get(o);if(!C)for(const z of g)P.has(z.toString())||(E=!1);C||E?this._notify(g,o,u):this.requestors.push({ids:g,scope:o,callback:u})}rasterizeImages(t,o){const u=new Map,{tasks:g,scope:v}=t;for(const[b,E]of g.entries()){const C=this.getImage(E.id,v);C&&u.set(b,{image:C,imageVariant:E})}this._rasterizeImages(v,u,o)}_rasterizeImages(t,o,u){if(r.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:o,scope:t},u);else{const g=new Map;for(const[v,{image:b,imageVariant:E}]of o.entries())g.set(v,this.imageRasterizer.rasterize(E,b,t,0));u(void 0,g)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,o,u){const g=this.images.get(o),v=new Map;for(const b of t){if(!g.get(b.toString())){if(b.iconsetId)continue;this.fire(new r.z("styleimagemissing",{id:b.name}))}const E=g.get(b.toString());if(!E){r.w(`Image "${b.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const C={data:E.usvg?null:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,usvg:E.usvg,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)};E.usvg&&Object.assign(C,{width:E.icon.usvg_tree.width,height:E.icon.usvg_tree.height}),v.set(r.I.toString(b),C)}u(null,v)}getPixelSize(t){const{width:o,height:u}=this.atlasImage.get(t);return{width:o,height:u}}getPattern(t,o,u){const g=t.toString(),v=this.patterns.get(o),b=v.get(g),E=this.getImage(t,o);if(!E)return null;if(b){if(b.position.version===E.version)return b.position;b.position.version=E.version}else{if(E.usvg&&!E.data){const C=this.getPatternInFlightId(g,o);if(this.patternsInFlight.has(C))return null;this.patternsInFlight.add(C);const P=new r.A(t).scaleSelf(r.o.devicePixelRatio),z=new Map([[P.toString(),{image:E,imageVariant:P}]]);return this._rasterizeImages(o,z,(U,N)=>this.storePatternImage(P,o,E,u,N)),null}this.storePattern(t,o,E)}return this._updatePatternAtlas(o,u),v.get(g).position}getPatternInFlightId(t,o){return r.B(t,o)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,o,u,g,v){const b=t.toString(),E=v?v.get(b):void 0;E&&(u.data=E,this.storePattern(t.id,o,u),this._updatePatternAtlas(o,g),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),o)))}storePattern(t,o,u){const g={w:u.data.width+2*r.C,h:u.data.height+2*r.C,x:0,y:0},v=new r.F(g,u,r.C);this.patterns.get(o).set(t.toString(),{bin:g,position:v})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,o){const u=t.gl;let g=this.atlasTexture.get(o);g?this.dirty&&(g.update(this.atlasImage.get(o)),this.dirty=!1):(g=new r.T(t,this.atlasImage.get(o),u.RGBA8),this.atlasTexture.set(o,g)),g.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,o){const u=this.patterns.get(t),g=Array.from(u.values()).map(({bin:P})=>P),{w:v,h:b}=r.G(g),E=this.atlasImage.get(t);E.resize({width:v||1,height:b||1});const C=this.images.get(t);for(const[P,{bin:z,position:U}]of u.entries()){let N=U.padding;const V=z.x+N,X=z.y+N,Z=C.get(P).data,Y=Z.width,ne=Z.height;N=N>1?N-1:N,r.q.copy(Z,E,{x:0,y:0},{x:V,y:X},{width:Y,height:ne},o),r.q.copy(Z,E,{x:0,y:ne-N},{x:V,y:X-N},{width:Y,height:N},o),r.q.copy(Z,E,{x:0,y:0},{x:V,y:X+ne},{width:Y,height:N},o),r.q.copy(Z,E,{x:Y-N,y:0},{x:V-N,y:X},{width:N,height:ne},o),r.q.copy(Z,E,{x:0,y:0},{x:V+Y,y:X},{width:N,height:ne},o),r.q.copy(Z,E,{x:Y-N,y:ne-N},{x:V-N,y:X-N},{width:N,height:N},o),r.q.copy(Z,E,{x:0,y:ne-N},{x:V+Y,y:X-N},{width:N,height:N},o),r.q.copy(Z,E,{x:0,y:0},{x:V+Y,y:X+ne},{width:N,height:N},o),r.q.copy(Z,E,{x:Y-N,y:0},{x:V-N,y:X+ne},{width:N,height:N},o)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,o){const u=this.images.get(o);for(const g of t){if(this.callbackDispatchedThisFrame.get(o).has(g.toString()))continue;this.callbackDispatchedThisFrame.get(o).add(g.toString());const v=u.get(g.toString());ws(v)&&this.updateImage(g,o,v)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Aa(c){const t=c.value,o=c.valueSpec,u=c.style,g=c.styleSpec,v=c.key,b=c.arrayElementValidator||ot;if(!Array.isArray(t))return[new r.V(v,t,`array expected, ${r.K(t)} found`)];if(o.length&&t.length!==o.length)return[new r.V(v,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new r.V(v,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let E={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};g.$version<7&&(E.function=o.function),r.H(o.value)&&(E=o.value);let C=[];for(let P=0;P<t.length;P++)C=C.concat(b({array:t,arrayIndex:P,value:t[P],valueSpec:E,style:u,styleSpec:g,key:`${v}[${P}]`},!0));return C}function _r(c){const t=c.key,o=c.value,u=c.valueSpec;if(!r.L(o))return[new r.V(t,o,`number expected, ${r.K(o)} found`)];if(o!=o)return[new r.V(t,o,"number expected, NaN found")];if("minimum"in u){let g=u.minimum;if(Array.isArray(u.minimum)&&(g=u.minimum[c.arrayIndex]),o<g)return[new r.V(t,o,`${o} is less than the minimum value ${g}`)]}if("maximum"in u){let g=u.maximum;if(Array.isArray(u.maximum)&&(g=u.maximum[c.arrayIndex]),o>g)return[new r.V(t,o,`${o} is greater than the maximum value ${g}`)]}return[]}function go(c){const t=c.key,o=c.value;if(!r.H(o))return[new r.V(t,o,`object expected, ${r.K(o)} found`)];const u=c.valueSpec,g=r.J(o.type);let v,b,E,C={};const P=g!=="categorical"&&o.property===void 0,z=!P,U=(function(Z){const Y=Z.stops;return Array.isArray(Y)&&Array.isArray(Y[0])&&r.H(Y[0][0])})(o),N=It({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(Z){if(g==="identity")return[new r.V(Z.key,Z.value,'identity function may not have a "stops" property')];let Y=[];const ne=Z.value;return Y=Y.concat(Aa({key:Z.key,value:ne,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:V})),Array.isArray(ne)&&ne.length===0&&Y.push(new r.V(Z.key,ne,"array must have at least one stop")),Y},default:function(Z){return ot({key:Z.key,value:Z.value,valueSpec:u,style:Z.style,styleSpec:Z.styleSpec})}}});return g==="identity"&&P&&N.push(new r.V(c.key,c.value,'missing required property "property"')),g==="identity"||o.stops||N.push(new r.V(c.key,c.value,'missing required property "stops"')),g==="exponential"&&u.expression&&!r.M(u)&&N.push(new r.V(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(z&&!r.N(u)?N.push(new r.V(c.key,c.value,"property functions not supported")):P&&!r.O(u)&&N.push(new r.V(c.key,c.value,"zoom functions not supported"))),g!=="categorical"&&!U||o.property!==void 0||N.push(new r.V(c.key,c.value,'"property" property is required')),N;function V(Z){let Y=[];const ne=Z.value,ue=Z.key;if(!Array.isArray(ne))return[new r.V(ue,ne,`array expected, ${r.K(ne)} found`)];if(ne.length!==2)return[new r.V(ue,ne,`array length 2 expected, length ${ne.length} found`)];if(U){if(!r.H(ne[0]))return[new r.V(ue,ne,`object expected, ${r.K(ne[0])} found`)];const ce=ne[0];if(ce.zoom===void 0)return[new r.V(ue,ne,"object stop key must have zoom")];if(ce.value===void 0)return[new r.V(ue,ne,"object stop key must have value")];const ae=r.J(ce.zoom);if(typeof ae!="number")return[new r.V(ue,ce.zoom,"stop zoom values must be numbers")];if(E&&E>ae)return[new r.V(ue,ce.zoom,"stop zoom values must appear in ascending order")];ae!==E&&(E=ae,b=void 0,C={}),Y=Y.concat(It({key:`${ue}[0]`,value:ne[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:_r,value:X}}))}else Y=Y.concat(X({key:`${ue}[0]`,value:ne[0],style:Z.style,styleSpec:Z.styleSpec},ne));return r.Q(r.S(ne[1]))?Y.concat([new r.V(`${ue}[1]`,ne[1],"expressions are not allowed in function stops.")]):Y.concat(ot({key:`${ue}[1]`,value:ne[1],valueSpec:u,style:Z.style,styleSpec:Z.styleSpec}))}function X(Z,Y){const ne=r.K(Z.value),ue=r.J(Z.value),ce=Z.value!==null?Z.value:Y;if(v){if(ne!==v)return[new r.V(Z.key,ce,`${ne} stop domain type must match previous stop domain type ${v}`)]}else v=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean"&&typeof ue!="number"&&typeof ue!="string"&&typeof ue!="boolean")return[new r.V(Z.key,ce,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&g!=="categorical"){let ae=`number expected, ${ne} found`;return r.N(u)&&g===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(Z.key,ce,ae)]}return g!=="categorical"||ne!=="number"||typeof ue=="number"&&isFinite(ue)&&Math.floor(ue)===ue?g!=="categorical"&&ne==="number"&&typeof ue=="number"&&typeof b=="number"&&b!==void 0&&ue<b?[new r.V(Z.key,ce,"stop domain values must appear in ascending order")]:(b=ue,g==="categorical"&&ue in C?[new r.V(Z.key,ce,"stop domain values must be unique")]:(C[ue]=!0,[])):[new r.V(Z.key,ce,`integer expected, found ${String(ue)}`)]}}function tr(c){const t=(c.expressionContext==="property"?r.W:r.U)(r.S(c.value),c.valueSpec);if(t.result==="error")return t.value.map(u=>new r.V(`${c.key}${u.key}`,c.value,u.message));const o=t.value.expression||t.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!o.outputDefined())return[new r.V(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!r.Z(o))return[new r.V(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return Ss(o,c);if(c.expressionContext==="appearance")return Ur(o,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!r.X(o,["zoom","feature-state"]))return[new r.V(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!r.Y(o))return[new r.V(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ss(c,t){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const g of t.valueSpec.expression.parameters)o.delete(g);if(o.size===0)return[];const u=[];return c instanceof r._&&o.has(c.name)?[new r.V(t.key,t.value,`["${c.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(c.eachChild(g=>{u.push(...Ss(g,t))}),u)}function Ur(c,t){const o=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const g of t.valueSpec.expression.parameters)o.add(g);if(o.size===0)return[];const u=[];return c instanceof r._&&!o.has(c.name)?[new r.V(t.key,t.value,`["${c.name}"] is not an allowed parameter`)]:(c.eachChild(g=>{u.push(...Ur(g,t))}),u)}function Xo(c){const t=c.key,o=c.value,u=c.valueSpec,g=[];return Array.isArray(u.values)?u.values.indexOf(r.J(o))===-1&&g.push(new r.V(t,o,`expected one of [${u.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(u.values).indexOf(r.J(o))===-1&&g.push(new r.V(t,o,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(o)} found`)),g}function io(c){return r.a2(r.S(c.value))?tr(Object.assign({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):Co(c)}function Co(c){const t=c.value,o=c.key;if(!Array.isArray(t))return[new r.V(o,t,`array expected, ${r.K(t)} found`)];if(t.length<1)return[new r.V(o,t,"filter array must have at least 1 element")];const u=c.styleSpec;let g=Xo({key:`${o}[0]`,value:t[0],valueSpec:u.filter_operator});const v=()=>{t.length>=2&&(r.a0(t[1])||g.push(new r.V(`${o}[1]`,t[1],`string expected, ${r.K(t[1])} found`)));for(let b=2;b<t.length;b++)r.J(t[1])==="$type"?g=g.concat(Xo({key:`${o}[${b}]`,value:t[b],valueSpec:u.geometry_type})):r.a0(t[b])||r.L(t[b])||r.$(t[b])||g.push(new r.V(`${o}[${b}]`,t[b],`string, number, or boolean expected, ${r.K(t[b])} found.`))};switch(r.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.J(t[1])==="$type"&&g.push(new r.V(o,t,`"$type" cannot be use with operator "${t[0]}"`)),t.length!==3&&g.push(new r.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`)),v();break;case"==":case"!=":t.length!==3&&g.push(new r.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`)),v();break;case"in":case"!in":v();break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)g=g.concat(Co({key:`${o}[${b}]`,value:t[b],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":t.length!==2?g.push(new r.V(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):r.a0(t[1])||g.push(new r.V(`${o}[1]`,t[1],`string expected, ${r.K(t[1])} found`))}return g}function Vr(c,t){const o=c.key,u=c.style,g=c.layer,v=c.styleSpec,b=c.value,E=c.objectKey,C=v[`${t}_${c.layerType}`];if(!C)return[];const P=E.match(/^(.*)-use-theme$/);if(P&&C[P[1]])return r.Q(r.S(b))?[].concat(ot({key:o,value:b,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:E})):ot({key:o,value:b,valueSpec:{type:"string"},style:u,styleSpec:v});const z=E.match(/^(.*)-transition$/);if(t==="paint"&&z&&C[z[1]]&&C[z[1]].transition)return ot({key:o,value:b,valueSpec:v.transition,style:u,styleSpec:v});const U=c.valueSpec||C[E];if(!U)return[new r.a3(o,b,`unknown property "${E}"`)];let N;if(r.a0(b)&&r.N(U)&&!U.tokens&&(N=/^{([^}]+)}$/.exec(b))){const X=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new r.V(o,b,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${X}.`)]}const V=[];if(c.layerType==="symbol")E!=="text-field"||!u||u.glyphs||u.imports||V.push(new r.V(o,b,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&r.a4(r.S(b))&&r.J(b.type)==="identity"&&V.push(new r.V(o,b,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&t==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&r.N(U)&&(r.a5(U)||r.O(U))){const X=r.W(r.S(b),U).value,Z="expression"in X&&X.expression||"_styleExpression"in X&&X._styleExpression&&X._styleExpression.expression;Z&&!r.X(Z,["measure-light"])&&(E==="model-emissive-strength"&&r.Y(Z)&&r.Z(Z)||V.push(new r.V(o,b,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return V.concat(ot({key:c.key,value:b,valueSpec:U,style:u,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:E}))}function Ps(c){return Vr(c,"paint")}function Wr(c){return Vr(c,"layout")}function Yo(c){let t=[];const o=c.value,u=c.key,g=c.style,v=c.styleSpec;if(!r.H(o))return[new r.V(u,o,"object expected")];o.type||o.ref||t.push(new r.V(u,o,'either "type" or "ref" is required'));let b=r.J(o.type);const E=r.J(o.ref);if(o.id){const C=r.J(o.id);for(let P=0;P<c.arrayIndex;P++){const z=g.layers[P];r.J(z.id)===C&&t.push(new r.V(u,o.id,`duplicate layer id "${C}", previously used at line ${z.id.__line__}`))}}if("ref"in o){let C;["type","source","source-layer","filter","layout"].forEach(P=>{P in o&&t.push(new r.V(u,o[P],`"${P}" is prohibited for ref layers`))}),g.layers.forEach(P=>{r.J(P.id)===E&&(C=P)}),C?C.ref?t.push(new r.V(u,o.ref,"ref cannot reference another ref layer")):b=r.J(C.type):typeof E=="string"&&t.push(new r.V(u,o.ref,`ref layer "${E}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(o.source)if(r.a0(o.source)){const C=g.sources&&g.sources[o.source],P=C&&r.J(C.type);C?P==="vector"&&b==="raster"?t.push(new r.V(u,o.source,`layer "${o.id}" requires a raster source`)):P==="raster"&&b!=="raster"?t.push(new r.V(u,o.source,`layer "${o.id}" requires a vector source`)):P!=="vector"||o["source-layer"]?P==="raster-dem"&&b!=="hillshade"?t.push(new r.V(u,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(b)?b==="line"&&o.paint&&(o.paint["line-gradient"]||o.paint["line-trim-offset"])&&P==="geojson"&&!C.lineMetrics?t.push(new r.V(u,o,`layer "${o.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):b==="raster-particle"&&P!=="raster-array"&&t.push(new r.V(u,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):t.push(new r.V(u,o.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(u,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new r.V(u,o.source,`source "${o.source}" not found`))}else t.push(new r.V(`${u}.source`,o.source,'"source" must be a string'));else t.push(new r.V(u,o,'missing required property "source"'));return t=t.concat(It({key:u,value:o,valueSpec:v.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ot({key:`${u}.type`,value:o.type,valueSpec:v.layer.type,style:c.style,styleSpec:c.styleSpec,object:o,objectKey:"type"}),filter:C=>io(Object.assign({layerType:b},C)),layout:C=>It({layer:o,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":P=>Wr(Object.assign({layerType:b},P))}}),paint:C=>It({layer:o,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":P=>Ps(Object.assign({layerType:b,layer:o},P))}}),appearances(C){const P=Aa({key:C.key,value:C.value,valueSpec:C.valueSpec,style:C.style,styleSpec:C.styleSpec,arrayElementValidator:N=>(function(V){const{key:X,layer:Z,layerType:Y}=V,ne=r.J(V.value),ue=r.J(ne.name),ce=r.J(ne.condition),ae=It({key:X,value:ne,valueSpec:V.styleSpec.appearance,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{condition:Ee=>(function(xe){const Se=[];return Se.push(...tr({key:xe.key,value:xe.object.condition,valueSpec:r.a6.appearance.condition,expressionContext:"appearance"})),Se})(Object.assign({layer:Z,layerType:Y},Ee)),properties:Ee=>(function(xe){const Se=[],{styleSpec:ye,layer:fe,layerType:De}=xe,Pe=ye[`paint_${De}`],Be=ye[`layout_${De}`],He=xe.object[xe.objectKey];for(const Ve in He){const Qe=Ve in Pe?"paint":Ve in Be?"layout":void 0;if(!Qe){Se.push(new r.V(xe.key,Ve,`unknown property "${Ve}" for layer type "${De}"`));continue}const ct=Object.assign({},xe,{key:`${xe.key}.${Ve}`,object:He,objectKey:Ve,layer:fe,layerType:De,value:He[Ve],valueSpec:Qe==="paint"?Pe[Ve]:Be[Ve]});Se.push(...Vr(ct,Qe))}return Se})(Object.assign({layer:Z,layerType:Y},Ee))}});return ue!=="hidden"&&ce===void 0&&ae.push(new r.V(V.key,"name",'Appearance with name different than "hidden" must have a condition')),ae})(Object.assign({layerType:b,layer:o},N))}),z=Array.isArray(C.value)?C.value:[],U=new Set;return z.forEach((N,V)=>{const X=r.J(N.name);if(X)if(U.has(X)){const Z=r.J(o.id);P.push(new r.V(C.key,X,`Duplicated appearance name "${X}" for layer "${Z}"`))}else U.add(X)}),P}}})),t}function $r({key:c,value:t}){return r.a0(t)?[]:[new r.V(c,t,`string expected, ${r.K(t)} found`)]}const yr={promoteId:function c({key:t,value:o}){if(r.a0(o))return $r({key:t,value:o});if(Array.isArray(o)){const g=[],v=r.S(o),b=r.U(v);return b.result==="error"&&b.value.forEach(E=>{g.push(new r.V(`${t}${E.key}`,null,`${E.message}`))}),r.X(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||g.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),g}if(!r.H(o))return[new r.V(t,o,`string, expression or object expected, "${r.K(o)}" found`)];const u=[];for(const g in o)u.push(...c({key:`${t}.${g}`,value:o[g]}));return u}};function Gr(c){const t=c.value,o=c.key,u=c.styleSpec,g=c.style;if(!r.H(t))return[new r.V(o,t,`object expected, ${r.K(t)} found`)];if(!("type"in t))return[new r.V(o,t,'"type" is required')];const v=r.J(t.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&("url"in t||"tiles"in t||b.push(new r.a3(o,t,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(It({key:o,value:t,valueSpec:u[`source_${v.replace("-","_")}`],style:c.style,styleSpec:u,objectElementValidators:yr})),b;case"geojson":if(b=It({key:o,value:t,valueSpec:u.source_geojson,style:g,styleSpec:u,objectElementValidators:yr}),"cluster"in t&&"clusterProperties"in t){if(!r.H(t.clusterProperties))return[new r.V(`${o}.clusterProperties`,t,`object expected, ${r.K(t)} found`)];for(const E in t.clusterProperties){const C=t.clusterProperties[E];if(!Array.isArray(C))return[new r.V(`${o}.clusterProperties.${E}`,C,"array expected")];const[P,z]=C,U=typeof P=="string"?[P,["accumulated"],["get",E]]:P;b.push(...tr({key:`${o}.${E}.map`,value:z,expressionContext:"cluster-map"})),b.push(...tr({key:`${o}.${E}.reduce`,value:U,expressionContext:"cluster-reduce"}))}}return b;case"video":return It({key:o,value:t,valueSpec:u.source_video,style:g,styleSpec:u});case"image":return It({key:o,value:t,valueSpec:u.source_image,style:g,styleSpec:u});case"canvas":return[new r.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xo({key:`${o}.type`,value:t.type,valueSpec:{values:ha(u)}})}}function ha(c){return c.source.reduce((t,o)=>{const u=c[o];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values||{}))),t},[])}function Ko(c){const t=c.value,o=c.styleSpec,u=o.light,g=c.style;if(t===void 0)return[];if(!r.H(t))return[new r.V("light",t,`object expected, ${r.K(t)} found`)];let v=[];for(const b in t){const E=b.match(/^(.*)-transition$/),C=b.match(/^(.*)-use-theme$/);v=v.concat(C&&u[C[1]]?ot({key:b,value:t[b],valueSpec:{type:"string"},style:g,styleSpec:o}):E&&u[E[1]]&&u[E[1]].transition?ot({key:b,value:t[b],valueSpec:o.transition,style:g,styleSpec:o}):u[b]?ot({key:b,value:t[b],valueSpec:u[b],style:g,styleSpec:o}):[new r.V(b,t[b],`unknown property "${b}"`)])}return v}function Es(c){const t=c.value;if(!t)return[];const o=c.key;if(!r.H(t))return[new r.V(o,t,`object expected, ${r.K(t)} found`)];let u=[];const g=c.styleSpec,v=g["light-3d"],b=c.style,E=c.style.lights;for(const z of["type","id"])if(!(z in t))return u=u.concat([new r.V(o,t,`missing property "${z}"`)]),u;if(!r.a0(t.type))return u=u.concat([new r.V(`${o}.type`,t.type,"string expected")]),u;if(E)for(let z=0;z<c.arrayIndex;z++){const U=r.J(t.type),N=E[z];r.J(N.type)===U&&u.push(new r.V(o,t.id,`duplicate light type "${t.type}", previously defined at line ${N.id.__line__}`))}const C=`properties_light_${t.type}`;if(!(C in g))return u=u.concat([new r.V(`${o}.type`,t,`Invalid light type ${t.type}`)]),u;const P=g[C];for(const z in t)if(z==="properties"){const U=t[z];if(!r.H(U))return u=u.concat([new r.V("properties",U,`object expected, ${r.K(U)} found`)]),u;for(const N in U){const V=N.match(/^(.*)-transition$/),X=N.match(/^(.*)-use-theme$/);u=u.concat(X&&P[X[1]]?ot({key:z,value:U[N],valueSpec:{type:"string"},style:b,styleSpec:g}):V&&P[V[1]]&&P[V[1]].transition?ot({key:z,value:t[z],valueSpec:g.transition,style:b,styleSpec:g}):P[N]?ot({key:N,value:U[N],valueSpec:P[N],style:b,styleSpec:g}):[new r.a3(c.key,U[N],`unknown property "${N}"`)])}}else u=u.concat(v[z]?ot({key:z,value:t[z],valueSpec:v[z],style:b,styleSpec:g}):[new r.a3(z,t[z],`unknown property "${z}"`)]);return u}function Io(c){const t=c.value,o=c.key,u=c.style,g=c.styleSpec,v=g.terrain;if(t==null)return[];if(!r.H(t))return[new r.V("terrain",t,`object expected, ${r.K(t)} found`)];let b=[];for(const E in t){const C=E.match(/^(.*)-transition$/),P=E.match(/^(.*)-use-theme$/);b=b.concat(P&&v[P[1]]?ot({key:E,value:t[E],valueSpec:{type:"string"},style:u,styleSpec:g}):C&&v[C[1]]&&v[C[1]].transition?ot({key:E,value:t[E],valueSpec:g.transition,style:u,styleSpec:g}):v[E]?ot({key:E,value:t[E],valueSpec:v[E],style:u,styleSpec:g}):[new r.a3(E,t[E],`unknown property "${E}"`)])}if(t.source)if(r.a0(t.source)){const E=u.sources&&u.sources[t.source],C=E&&r.J(E.type);E?C!=="raster-dem"&&b.push(new r.V(`${o}.source`,t.source,`terrain cannot be used with a source of type ${C}, it only be used with a "raster-dem" source type`)):b.push(new r.V(`${o}.source`,t.source,`source "${t.source}" not found`))}else b.push(new r.V(`${o}.source`,t.source,"source must be a string"));else b.push(new r.V(o,t,'terrain is missing required property "source"'));return b}function Ro(c){const t=c.value,o=c.style,u=c.styleSpec,g=u.fog;if(t===void 0)return[];if(!r.H(t))return[new r.V("fog",t,`object expected, ${r.K(t)} found`)];let v=[];for(const b in t){const E=b.match(/^(.*)-transition$/),C=b.match(/^(.*)-use-theme$/);v=v.concat(C&&g[C[1]]?ot({key:b,value:t[b],valueSpec:{type:"string"},style:o,styleSpec:u}):E&&g[E[1]]&&g[E[1]].transition?ot({key:b,value:t[b],valueSpec:u.transition,style:o,styleSpec:u}):g[b]?ot({key:b,value:t[b],valueSpec:g[b],style:o,styleSpec:u}):[new r.a3(b,t[b],`unknown property "${b}"`)])}return v}const Jo={"*":()=>[],array:Aa,boolean:function(c){const t=c.value,o=c.key;return r.$(t)?[]:[new r.V(o,t,`boolean expected, ${r.K(t)} found`)]},number:_r,color:function({key:c,value:t}){return r.a0(t)?r.a1.parseCSSColor(t)===null?[new r.V(c,t,`color expected, "${t}" found`)]:[]:[new r.V(c,t,`color expected, ${r.K(t)} found`)]},enum:Xo,filter:io,function:go,layer:Yo,object:It,source:Gr,model:r.a7,light:Ko,"light-3d":Es,terrain:Io,fog:Ro,string:$r,formatted:function(c){return $r(c).length===0?[]:tr(c)},resolvedImage:function(c){return $r(c).length===0?[]:tr(c)},projection:function(c){const t=c.value,o=c.styleSpec,u=o.projection,g=c.style;if(r.H(t)){let v=[];for(const b in t)v=v.concat(ot({key:b,value:t[b],valueSpec:u[b],style:g,styleSpec:o}));return v}return r.a0(t)?[]:[new r.V("projection",t,`object or string expected, ${r.K(t)} found`)]},import:function(c){const t=c.key,{value:o,styleSpec:u}=c;if(!r.H(o))return[new r.V(t,o,"import must be an object")];const{data:g,...v}=o;Object.defineProperty(v,"__line__",{value:o.__line__,enumerable:!1});let b=It(Object.assign({},c,{value:v,valueSpec:u.import}));return r.J(v.id)===""&&b.push(new r.V(`${c.key}.id`,v,"import id can't be an empty string")),g&&(b=b.concat(Mn(g,u,{key:`${c.key}.data`}))),b},iconset:function(c){const t=c.value,o=c.key,u=c.styleSpec,g=c.style;if(!r.H(t))return[new r.V(o,t,"object expected")];if(!t.type)return[new r.V(o,t,'"type" is required')];const v=r.J(t.type);let b=[];if(b=b.concat(It({key:o,value:t,valueSpec:u[`iconset_${v}`],style:g,styleSpec:u})),(function(E,C){return!(E!=="source"||!C.source)})(v,t)){const E=g.sources&&g.sources[t.source],C=E&&r.J(E.type);E?C!=="raster-array"&&b.push(new r.V(o,t.source,`iconset cannot be used with a source of type ${String(C)}, it only be used with a "raster-array" source type`)):b.push(new r.V(o,t.source,`source "${t.source}" not found`))}return b}};function ot(c,t=!1){const o=c.value,u=c.valueSpec,g=c.styleSpec;if(u.expression){if(r.a4(r.J(o)))return go(c);if(r.Q(r.S(o)))return tr(c)}if(u.type&&Jo[u.type]){const v=Jo[u.type](c);return t===!0&&v.length>0&&Array.isArray(c.value)?tr(c):v}return It(Object.assign({},c,{valueSpec:u.type?g[u.type]:u}))}function It(c){const t=c.key,o=c.value,u=c.valueSpec||{},g=c.objectElementValidators||{},v=c.style,b=c.styleSpec;if(!r.H(o))return[new r.V(t,o,`object expected, ${r.K(o)} found`)];let E=[];for(const C in o){const P=C.split(".")[0];let z;g[P]?z=g[P]:u[P]?z=ot:g["*"]?z=g["*"]:u["*"]&&(z=ot),z?E=E.concat(z({key:(t&&`${t}.`)+C,value:o[C],valueSpec:u[P]||u["*"],style:v,styleSpec:b,object:o,objectKey:C},o)):E.push(new r.a3(t,o[C],`unknown property "${C}"`))}for(const C in u){if(g[C])continue;const P=u[C];P.required&&P.default===void 0&&o[C]===void 0&&E.push(new r.V(t,o,`missing required property "${C}"`))}return E}function ui({key:c,value:t}){const o=$r({key:c,value:t});if(o.length)return o;const u=t;return u.indexOf("{fontstack}")===-1&&o.push(new r.V(c,t,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&o.push(new r.V(c,t,'"glyphs" url must include a "{range}" token')),o}function Mn(c,t=r.a6,o={}){return It({key:o.key||"",value:c,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:c,objectElementValidators:{glyphs:ui}})}function In(c,t=r.a6){return _e(Mn(c,t))}const Xr=c=>_e(Gr(c)),Gn=c=>_e(Ko(c)),pt=c=>_e(Es(c)),Yn=c=>_e(Io(c)),or=c=>_e(Ro(c)),vr=c=>_e((function(t){const o=t.value,u=t.style,g=t.styleSpec,v=g.snow;if(o===void 0)return[];if(!r.H(o))return[new r.V("snow",o,`object expected, ${r.K(o)} found`)];let b=[];for(const E in o){const C=E.match(/^(.*)-transition$/);b=b.concat(C&&v[C[1]]&&v[C[1]].transition?ot({key:E,value:o[E],valueSpec:g.transition,style:u,styleSpec:g}):v[E]?ot({key:E,value:o[E],valueSpec:v[E],style:u,styleSpec:g}):[new r.a3(E,o[E],`unknown property "${E}"`)])}return b})(c)),Ni=c=>_e((function(t){const o=t.value,u=t.style,g=t.styleSpec,v=g.rain;if(o===void 0)return[];if(!r.H(o))return[new r.V("rain",o,`object expected, ${r.K(o)} found`)];let b=[];for(const E in o){const C=E.match(/^(.*)-transition$/);b=b.concat(C&&v[C[1]]&&v[C[1]].transition?ot({key:E,value:o[E],valueSpec:g.transition,style:u,styleSpec:g}):v[E]?ot({key:E,value:o[E],valueSpec:v[E],style:u,styleSpec:g}):[new r.a3(E,o[E],`unknown property "${E}"`)])}return b})(c)),Le=c=>_e(Yo(c)),J=c=>_e(io(c)),re=c=>_e(Ps(c)),ge=c=>_e(Wr(c)),Me=c=>_e(r.a7(c));function _e(c){return c.slice().sort((t,o)=>t.line&&o.line?t.line-o.line:0)}function ke(c,t){let o=!1;if(t&&t.length)for(const u of t)u instanceof r.a3?r.w(u.message):(c.fire(new r.y(new Error(u.message))),o=!0);return o}const We=r.a6.light;let je;class Ke extends r.E{constructor(t,o="flat"){super(),this._transitionable=new r.a8(je||(je=new r.a9({anchor:new r.aa(We.anchor),position:new r.ab(We.position),color:new r.aa(We.color),intensity:new r.aa(We.intensity)}))),this.setLight(t,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o,u={}){this._validate(Gn,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=o)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,u){return(!u||u.validate!==!1)&&ke(this,t.call(In,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}const At=r.a6.terrain;let vt=class extends r.E{constructor(c,t,o,u,g){super(),this.scope=o,this._transitionable=new r.a8(new r.a9({source:new r.aa(At.source),exaggeration:new r.aa(At.exaggeration)}),o,u),this._transitionable.setTransitionOrValue(c,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=g}get(){return this._transitionable.serialize()}set(c,t){this._transitionable.setTransitionOrValue(c,t)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new r.ac(c,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const c=this._transitionable._values.exaggeration;if(!c)return null;const t=c.value.expression;if(!t)return null;let o=-1,u=-1,g=1;for(const v of t.zoomStops)g=t.evaluate(new r.ac(v,{worldview:this.worldview})),g>.01?(o=v,u=-1):u=v;return g<.01&&o>0&&u>o?[o,u]:null}isZoomDependent(){const c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof r.ad}};const Zt=.05;function oi(c,t,o,u){const g=r.ah(45,65,o),[v,b]=hi(c,u);let E=1-Math.min(1,Math.exp((t-v)/(b-v)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*g*c.alpha}function hi(c,t){const o=.5/Math.tan(.5*t);return[c.range[0]+o,c.range[1]+o]}function Mi(c,t,o,u,g){const v=r.af([],[t,o,u],g.mercatorFogMatrix);return oi(c,r.ag(v),g.pitch,g._fov)}function ji(c,t,o,u,g,v,b){const E=[[o,u,0],[g,u,0],[g,v,0],[o,v,0]];let C=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(const z of E){const U=r.af([],z,t),N=r.ag(U);C=Math.min(C,N),P=Math.max(P,N)}return[oi(c,C,b.pitch,b._fov),oi(c,P,b.pitch,b._fov)]}const li=r.a6.fog;class bi extends r.E{constructor(t,o,u,g){super();const v=new r.a9({range:new r.aa(li.range),color:new r.aa(li.color),"color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.aa(li["high-color"]),"high-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.aa(li["space-color"]),"space-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.aa(li["horizon-blend"]),"star-intensity":new r.aa(li["star-intensity"]),"vertical-range":new r.aa(li["vertical-range"])});this._transitionable=new r.a8(v,u,new Map(g)),this.set(t,g),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new r.ai(v),this.scope=u}get state(){const t=this._transform,o=t.projection.name==="globe",u=r.aj(t.zoom),g=this.properties.get("range"),v=[.5,3];return{range:o?[r.ak(v[0],g[0],u),r.ak(v[1],g[1],u)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o,u={}){if(this._validate(or,t,u))return;const g=Object.assign({},t);for(const v of Object.keys(li))g[v]===void 0&&(g[v]=li[v].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ah(45,65,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?(function(u,g,v){const b=r.ae.fromLngLat(g),E=v.elevation?v.elevation.getAtPointOrZero(b):0;return Mi(u,b.x,b.y,E,v)})(this.state,t,o):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(t.toUnwrapped());return ji(this.state,o,0,0,r.al,r.al,this._transform)}getOpacityForBounds(t,o,u,g,v){return this._transform.projection.supportsFog?ji(this.state,t,o,u,g,v,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?hi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const u of o){const g=t.points[u];let v;if(g[2]>=0)v=g;else{const b=t.points[u-4];v=r.am(b,g,b[2]/(b[2]-g[2]))}if(Mi(this.state,v[0],v[1],0,this._transform)>=Zt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,u){return(!u||u.validate!==!1)&&ke(this,t.call(In,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let jn,xr,Qn,Cr=class extends r.E{constructor(c,t,o,u){super();const g=jn||(jn=new r.a9({density:new r.aa(r.a6.snow.density),intensity:new r.aa(r.a6.snow.intensity),color:new r.aa(r.a6.snow.color),opacity:new r.aa(r.a6.snow.opacity),vignette:new r.aa(r.a6.snow.vignette),"vignette-color":new r.aa(r.a6.snow["vignette-color"]),"center-thinning":new r.aa(r.a6.snow["center-thinning"]),direction:new r.aa(r.a6.snow.direction),"flake-size":new r.aa(r.a6.snow["flake-size"])}));this._transitionable=new r.a8(g,o,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(g),this.scope=o}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),u=r.an(o[0]),g=-Math.max(r.an(o[1]),.01),v=[Math.cos(u)*Math.cos(g),Math.sin(u)*Math.cos(g),Math.sin(g)],b=this.properties.get("vignette"),E=this.properties.get("vignette-color");return E.a=b,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(t.r,t.g,t.b,t.a*c),direction:v,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(c,t,o={}){if(this._validate(vr,c,o))return;const u=Object.assign({},c),g=r.a6.snow;for(const v of Object.keys(g))u[v]===void 0&&(u[v]=g[v].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,o){return(!o||o.validate!==!1)&&ke(this,c.call(In,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}},Kn=class extends r.E{constructor(c,t,o,u){super();const g=xr||(xr=new r.a9({density:new r.aa(r.a6.rain.density),intensity:new r.aa(r.a6.rain.intensity),color:new r.aa(r.a6.rain.color),opacity:new r.aa(r.a6.rain.opacity),vignette:new r.aa(r.a6.rain.vignette),"vignette-color":new r.aa(r.a6.rain["vignette-color"]),"center-thinning":new r.aa(r.a6.rain["center-thinning"]),direction:new r.aa(r.a6.rain.direction),"droplet-size":new r.aa(r.a6.rain["droplet-size"]),"distortion-strength":new r.aa(r.a6.rain["distortion-strength"])}));this._transitionable=new r.a8(g,o,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(g),this.scope=o}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),u=r.an(o[0]),g=-Math.max(r.an(o[1]),.01),v=[Math.cos(u)*Math.cos(g),Math.sin(u)*Math.cos(g),Math.sin(g)],b=this.properties.get("vignette-color");return b.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(t.r,t.g,t.b,t.a*c),direction:v,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(c,t,o={}){if(this._validate(Ni,c,o))return;const u=Object.assign({},c),g=r.a6.rain;for(const v of Object.keys(g))u[v]===void 0&&(u[v]=g[v].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,o){return(!o||o.validate!==!1)&&ke(this,c.call(In,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}};class sn extends r.E{constructor(t,o,u,g){super(),this.scope=u,this._options=t,this.properties=new r.ai(o),this._transitionable=new r.a8(o,u,new Map(g)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,o){this._options=t,this._transitionable.setTransitionOrValue(t.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const ir=()=>Qn||(Qn=new r.a9({color:new r.aa(r.a6.properties_light_ambient.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_ambient.intensity)}));let Dn;const On=()=>Dn||(Dn=new r.a9({direction:new r.ap(r.a6.properties_light_directional.direction),color:new r.aa(r.a6.properties_light_directional.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_directional.intensity),"cast-shadows":new r.aa(r.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new r.aa(r.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.aa(r.a6.properties_light_directional["shadow-intensity"]),"shadow-draw-before-layer":new r.aa(r.a6.properties_light_directional["shadow-draw-before-layer"])}));class Un{constructor(t,o,u){this.screenBounds=t,this.cameraPoint=u.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=o,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,u)}static createFromScreenPoints(t,o){let u,g;if(t instanceof r.P||typeof t[0]=="number"){const v=r.P.convert(t);u=[v],g=o.isPointAboveHorizon(v)}else{const v=r.P.convert(t[0]),b=r.P.convert(t[1]),E=v.add(b)._div(2);u=[v,b],g=r.aq(v,b).every(C=>o.isPointAboveHorizon(C))&&o.isPointAboveHorizon(E)}return new Un(u,g,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const o=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],g=r.aq(o,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<u.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?g[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(g[3]=this.cameraPoint)),r.ar(g,t)}bufferedCameraGeometryGlobe(t){const o=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],g=r.aq(o,u,t),v=this.cameraPoint.clone();switch(3*((v.y>o.y)+(v.y>u.y))+((v.x>o.x)+(v.x>u.x))){case 0:g[0]=v,g[4]=v.clone();break;case 1:g.splice(1,0,v);break;case 2:g[1]=v;break;case 3:g.splice(4,0,v);break;case 5:g.splice(2,0,v);break;case 6:g[3]=v;break;case 7:g.splice(3,0,v);break;case 8:g[2]=v}return g}containsTile(t,o,u,g=0){const v=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/o._pixelsPerMercatorPixel+1,b=u?this._bufferedCameraMercator(v,o):this._bufferedScreenMercator(v,o);let E=t.tileID.wrap+(b.unwrapped?g:0);const C=b.polygon.map(Y=>r.as(t.tileTransform,Y,E));if(!r.at(C,0,0,r.al,r.al))return;E=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const P=this.screenGeometryMercator.polygon.map(Y=>r.au(t.tileTransform,Y,E)),z=P.map(Y=>new r.P(Y[0],Y[1])),U=o.getFreeCameraOptions().position||new r.ae(0,0,0),N=r.au(t.tileTransform,U,E),V=P.map(Y=>{const ne=r.av(Y,Y,N);return r.aw(ne,ne),new r.ax(N,ne)}),X=r.ay(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:V,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(Z=r.az(C),Z.min.x=r.aA(Z.min.x,0,r.al),Z.min.y=r.aA(Z.min.y,0,r.al),Z.max.x=r.aA(Z.max.x,0,r.al),Z.max.y=r.aA(Z.max.y,0,r.al),Z),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:X};var Z}_bufferedScreenMercator(t,o){const u=Qr(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[u]=g,g}}_bufferedCameraMercator(t,o){const u=Qr(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[u]=g,g}}_projectAndResample(t,o){const u=(function(v,b){const E=r.aB([],b.pixelMatrix,b.globeMatrix),C=[0,-r.aD,0,1],P=[0,r.aD,0,1],z=[0,0,0,1];r.aC(C,C,E),r.aC(P,P,E),r.aC(z,z,E);const U=new r.P(C[0]/C[3],C[1]/C[3]),N=new r.P(P[0]/P[3],P[1]/P[3]),V=r.aE(v,U)&&C[3]<z[3],X=r.aE(v,N)&&P[3]<z[3];if(!V&&!X)return null;const Z=(function(Se,ye,fe){for(let De=1;De<Se.length;De++){const Pe=hs(ye.pointCoordinate3D(Se[De-1]).x),Be=hs(ye.pointCoordinate3D(Se[De]).x);if(fe<0){if(Pe<Be)return{idx:De,t:-Pe/(Be-1-Pe)}}else if(Be<Pe)return{idx:De,t:(1-Pe)/(Be+1-Pe)}}return null})(v,b,V?-1:1);if(!Z)return null;const{idx:Y,t:ne}=Z;let ue=Y>1?br(v.slice(0,Y),b):[],ce=Y<v.length?br(v.slice(Y),b):[];ue=ue.map(Se=>new r.P(hs(Se.x),Se.y)),ce=ce.map(Se=>new r.P(hs(Se.x),Se.y));const ae=[...ue];ae.length===0&&ae.push(ce[ce.length-1]);const Ee=r.ak(ae[ae.length-1].y,(ce.length===0?ue[0]:ce[0]).y,ne);let xe;return xe=V?[new r.P(0,Ee),new r.P(0,0),new r.P(1,0),new r.P(1,Ee)]:[new r.P(1,Ee),new r.P(1,1),new r.P(0,1),new r.P(0,Ee)],ae.push(...xe),ce.length===0?ae.push(ue[0]):ae.push(...ce),{polygon:ae.map(Se=>new r.ae(Se.x,Se.y)),unwrapped:!1}})(t,o);if(u)return u;const g=(function(v,b){let E=!1,C=-1/0,P=0;for(let U=0;U<v.length-1;U++)v[U].x>C&&(C=v[U].x,P=U);for(let U=0;U<v.length-1;U++){const N=(P+U)%(v.length-1),V=v[N],X=v[N+1];Math.abs(V.x-X.x)>.5&&(V.x<X.x?(V.x+=1,N===0&&(v[v.length-1].x+=1)):(X.x+=1,N+1===v.length-1&&(v[0].x+=1)),E=!0)}const z=r.aF(b.center.lng);return E&&z<Math.abs(z-1)&&v.forEach(U=>{U.x-=1}),{polygon:v,unwrapped:E}})(br(t,o).map(v=>new r.P(hs(v.x),v.y)),o);return{polygon:g.polygon.map(v=>new r.ae(v.x,v.y)),unwrapped:g.unwrapped}}}function br(c,t){return r.aG(c,o=>{const u=t.pointCoordinate3D(o);o.x=u.x,o.y=u.y},1/256)}function hs(c){return c<0?1+c%1:c%1}function Qr(c){return 100*c|0}function yl(c,t,o,u,g){const v=function(E,C){if(E)return g(E);if(C){if(c.url&&C.tiles&&c.tiles&&delete c.tiles,C.variants){if(!Array.isArray(C.variants))return g(new Error("variants must be an array"));for(const z of C.variants){if(z==null||typeof z!="object"||z.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(z.capabilities))return g(new Error("capabilities must be an array"));if(z.capabilities.length===1&&z.capabilities[0]==="meshopt"){C=Object.assign(C,z);break}}}const P=r.aH(Object.assign({},C,c),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);P.tiles=t.canonicalizeTileset(P,c.url),g(null,P)}},b=(function(E,C,P){if(!E)return null;if(!C&&!P)return E;P=P||E.worldview_default;const z=Object.values(E.language||{});if(z.length===0)return null;const U=Object.values(E.worldview||{});if(U.length===0)return null;const N=z.every(X=>X===C),V=U.every(X=>X===P);return N&&V?E:C in(E.language_options||{})||P in(E.worldview_options||{})?null:E.language_options&&E.worldview_options?E:null})(c.data,o,u);return b?r.o.frame(()=>v(null,b)):c.url?r.m(t.transformRequest(t.normalizeSourceURL(c.url,null,o,u),r.R.Source),v):r.o.frame(()=>{const{data:E,...C}=c;v(null,C)})}function qs(c,t){const o=Math.pow(2,t.z),u=Math.floor(r.aF(c.getWest())*o),g=Math.floor(r.aJ(c.getNorth())*o),v=Math.ceil(r.aF(c.getEast())*o),b=Math.ceil(r.aJ(c.getSouth())*o);return t.x>=u&&t.x<v&&t.y>=g&&t.y<b}class no{constructor(t,o,u){this.bounds=t?r.aI.convert(this.validateBounds(t)):null,this.minzoom=o||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const o of t)this.extraBounds.push(r.aI.convert(this.validateBounds(o)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!qs(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const o of this.extraBounds)if(qs(o,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const o=new no(t.bounds,t.minzoom,t.maxzoom);return o.addExtraBounds(t.extra_bounds),o}}class Ca extends r.E{constructor(t,o,u,g){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,r.aH(o,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new r.aK}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=yl(this._options,this.map._requestManager,o,u,(g,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new r.y(g));else if(v){if(Object.assign(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const b of v.vector_layers)this.vectorLayerIds.push(b.id),v.worldview&&v.worldview[b.source]&&this.localizableLayerIds.add(b.id)}this.tileBounds=no.fromTileJSON(v),bt(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(g)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,o){const u=t.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(u),v=this.map._requestManager.transformRequest(g,r.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,E=b?{image:b.image.clone()}:null,C={request:v,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:E,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.getIndoorTileOptions(this.id,this.scope)};if(this.hasWorldviews&&r.h(u)&&(C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",C,P.bind(this));else if(t.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",C,P.bind(this),void 0,!0);else{const z=r.aL.call({deduped:this._deduped},C,(U,N)=>{if(U||!N)P.call(this,U);else{const V=r.aM(N.responseHeaders);C.data={rawData:N.rawData.slice(0),expires:V.expires,cacheControl:V.cacheControl},t.actor&&t.actor.send("loadTile",C,P.bind(this),void 0,!0)}},!0);t.request={cancel:z}}function P(z,U){return delete t.request,t.aborted?o(null):z&&z instanceof r.aN&&z.status!==404?o(z):(U&&U.resourceTiming&&(t.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&t.setExpiryData(U),t.loadVectorData(U,this.map.painter),r.aO(this.dispatcher),o(null,U),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class rs extends r.E{constructor(t,o,u,g){super(),this.id=t,this.dispatcher=u,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},o),Object.assign(this,r.aH(o,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const o=this.map.getWorldview();this._tileJSONRequest=yl(this._options,this.map._requestManager,null,o,(u,g)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new r.y(u)):g&&(Object.assign(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map(v=>v.id)),this.tileBounds=no.fromTileJSON(g),bt(g.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(u)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const u=r.o.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=r.n(this.map._requestManager.transformRequest(g,r.R.Tile),(v,b,E)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(v)return t.state="errored",o(v);if(!b)return o(null);const C=r.aM(E);this.map._refreshExpiredTiles&&t.setExpiryData(C),t.setTexture(b,this.map.painter),t.state="loaded",r.aO(this.dispatcher),o(null)})}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o&&o()}unloadTile(t,o){t.texture&&t.texture instanceof r.T?(t.destroy(!1),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function _o([c,t],o,u,{scaled:g=!0}={}){const{tileSize:v,buffer:b}=u,{x:E,y:C,z:P}=o;if(!isFinite(E)||!isFinite(C)||!isFinite(P))throw new Error("Invalid MRT header");const z=2**P,U=z*r.aF(c),N=z*r.aJ(t);return(function([V,X],Z,{scaled:Y=!0}={}){if(!Z)throw new Error("bandView is undefined");const{data:ne,tileSize:ue,buffer:ce,offset:ae,scale:Ee,dimension:xe}=Z;if(V<-ce||V>ue+ce||X<-ce||X>ue+ce)throw new Error(`Point (${V}, ${X}) out of bounds for tileSize=${ue}, buffer=${ce}`);const Se=(X+ce)*(ue+2*ce)+(V+ce);if(new Uint32Array(ne.buffer)[Se]===4294967295)return null;let ye=[];ye=Y?[]:new Z.data.constructor(xe);for(let fe=0;fe<xe;fe++)ye[fe]=Math.round(1e12*(ne[xe*Se+fe]*Ee+ae))/1e12;return ye})([Math.min(Math.max(-b,Math.floor((U-E)*v)),v-1+b),Math.min(Math.max(-b,Math.floor((N-C)*v)),v-1+b)],u,{scaled:g})}class ro extends rs{constructor(t,o,u,g){super(t,o,u,g),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},o)}triggerRepaint(t){const o=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);o&&o.enabled&&u&&o._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,o){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(u,r.R.Tile),v={request:g,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=g,t.actor||(t.actor=this.dispatcher.getActor());const b=(E,C,P)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(E)return E.name==="AbortError"?void 0:(t.state="errored",o(E));if(this.map._refreshExpiredTiles&&C){const z=r.aM(P);t.setExpiryData(z)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!C)return o(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=C}o(null)};t.request=this.partial?t.fetchHeader(void 0,b.bind(this)):t.actor.send("loadTile",v,b.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){const u=t.texturePerLayer;if(t.flushAllQueues(),u.size){t.destroy(!1);for(const g of u.values())this.map.painter.saveTileTexture(g)}else t.destroy()}prepareTile(t,o,u,g){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(o,u,g,(v,b)=>{if(v)return t.state="errored",this.fire(new r.y(v)),void this.triggerRepaint(t);b&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(u,b,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:v})=>v===t),u=o&&o.fields,g=u&&u.bands&&u.bands;return g?g[0]:0}getTextureDescriptor(t,o,u){if(!t)return;const g=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let v=null;o instanceof r.aR?v=o.paint.get("raster-array-band"):o instanceof r.aS&&(v=o.paint.get("raster-particle-array-band"));const b=v||this.getInitialBand(g);if(b==null)return;if(!t.textureDescriptorPerLayer.get(o.id))return void this.prepareTile(t,g,o.id,b);if(t.updateNeeded(o.id,b)&&!u)return;const E=t.textureDescriptorPerLayer.get(o.id);return Object.assign({},E,{texture:t.texturePerLayer.get(o.id)})}getImages(t,o){const u=new Map;for(const g of t)for(const v of o){const[b,E]=v.split("/"),C=g.getLayer(b);if(!C||!C.hasBand(E)||!C.hasDataForBand(E))continue;const{bytes:P,tileSize:z,buffer:U}=C.getBandView(E),N=z+2*U,V={data:new r.q({width:N,height:N},P),pixelRatio:2,sdf:!1,usvg:!1,version:0};u.set(v,V)}return u}queryRasterArrayValueByBandId(t,o,u){const g=o._mrt;return new Promise(v=>{const b={},E=new Set;for(const[C,P]of Object.entries(g.layers)){if(u.layerName&&C!==u.layerName)continue;const z={};b[C]=z;for(const{bands:U}of P.dataIndex)for(const N of U)u.bands&&!u.bands.includes(N)||(E.add(r.B(C,N)),o.fetchBand(C,null,N,V=>{r.o.frame(()=>{z[N]=V?null:_o([t.lng,t.lat],g,P.getBandView(N)),E.delete(r.B(C,N)),E.size===0&&v(b)})},!1))}E.size===0&&v(b)})}_loadTileForQuery(t,o){if(this._loadTileLoaded[t.uid])return void o(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(o);this._loadTilePending[t.uid]=[o];const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(u,r.R.Tile);t.actor.send("loadTile",{request:g,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(v,b,E)=>{if(v)return this._loadTilePending[t.uid].forEach(C=>C(v,null)),void delete this._loadTilePending[t.uid];if(!b)return this._loadTilePending[t.uid].forEach(C=>C(null,null)),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&b){const C=r.aM(E);t.setExpiryData(C)}t._mrt=b,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(C=>C(null,b)),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]},void 0,!0)}queryRasterArrayValueByAllBands(t,o,u){return new Promise((g,v)=>{this._loadTileForQuery(o,(b,E)=>{b?v(b):g(E?this.queryRasterArrayValueByBandId(t,o,u):null)})})}queryRasterArrayValue(t,o){const u=r.aT.convert(t),g=this.findLoadedParent(u);return g&&g._mrt?o.bands||!this.partial?this.queryRasterArrayValueByBandId(u,g,o):this.queryRasterArrayValueByAllBands(u,g,o):Promise.resolve(null)}findLoadedParent(t){const o=r.ae.fromLngLat(t,this.map.transform.tileSize),u=this.maxzoom+1,g=1<<u,v=Math.floor(o.x),b=Math.floor((o.x-v)*g),E=Math.floor(o.y*g),C=this.map.style.getSourceCache(this.id),P=new r.aQ(u,v,u,b,E);return C.findLoadedParent(P,this.minzoom)}}const qa={vector:Ca,raster:rs,"raster-dem":class extends rs{constructor(c,t,o,u){super(c,t,o,u),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const o=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(g,v){g&&(c.state="errored",t(g)),v&&(c.dem=v,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=r.n(this.map._requestManager.transformRequest(o,r.R.Tile),(function(g,v,b){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(g)c.state="errored",t(g);else if(v){const E=r.aM(b);this.map._refreshExpiredTiles&&c.setExpiryData(E);const C=ImageBitmap&&v instanceof ImageBitmap&&r.r(),P=1-(v.width-r.aP(v.width))/2;P<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const z=C?v:r.o.getImageData(v,P),U={uid:c.uid,tileID:c.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:P};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadTile",U,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){const t=c.canonical,o=Math.pow(2,t.z),u=(t.x-1+o)%o,g=t.x===0?c.wrap-1:c.wrap,v=(t.x+1+o)%o,b=t.x+1===o?c.wrap+1:c.wrap,E={};return E[new r.aQ(c.overscaledZ,g,t.z,u,t.y).key]={backfilled:!1},E[new r.aQ(c.overscaledZ,b,t.z,v,t.y).key]={backfilled:!1},t.y>0&&(E[new r.aQ(c.overscaledZ,g,t.z,u,t.y-1).key]={backfilled:!1},E[new r.aQ(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},E[new r.aQ(c.overscaledZ,b,t.z,v,t.y-1).key]={backfilled:!1}),t.y+1<o&&(E[new r.aQ(c.overscaledZ,g,t.z,u,t.y+1).key]={backfilled:!1},E[new r.aQ(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},E[new r.aQ(c.overscaledZ,b,t.z,v,t.y+1).key]={backfilled:!1}),E}},"raster-array":ro,geojson:class extends r.E{constructor(c,t,o,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(u),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const g=r.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*g,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*g,extent:r.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*g,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof c!="string"&&(c.type==="Feature"&&(c={type:"FeatureCollection",features:[c]}),c.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof c!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const o of this._data.features)t.set(o.id,o);for(const o of c.features)t.set(o.id,o);this._data.features=[...t.values()]}else this._data=c;return this._updateWorkerData(!0),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterLeaves(c,t,o,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:t,offset:o},u),this}_updateWorkerData(c=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:c},this.workerOptions);t.scope=this.scope;const o=this._data;typeof o=="string"?(t.request=this.map._requestManager.transformRequest(r.o.resolveURL(o),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,g)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new r.y(u));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),c&&(this._partialReload=!0),this.fire(new r.z("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(c),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const c=r.B(this.id,this.scope);this.map.style.clearSource(c),this._updateWorkerData()}loadTile(c,t){const o=c.actor?"reloadTile":"loadTile";c.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,g=u?{image:u.image.clone()}:null,v=this._partialReload,b={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:v,worldview:this.map.getWorldview(),indoor:this.map.getIndoorTileOptions(this.id,this.scope)};c.request=this.actor.send(o,b,(E,C)=>v&&!C?(c.state="loaded",t(null)):(delete c.request,c.destroy(!1),c.aborted?t(null):E?t(E):(c.loadVectorData(C,this.map.painter,o==="reloadTile"),t(null))),void 0,o==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c,t){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(c){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aU{constructor(c,t,o,u){super(c,t,o,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aV(this.urls,(t,o)=>{this._loaded=!0,t?this.fire(new r.y(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(c,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aU,model:r.aX,"batched-model":class extends r.E{constructor(c,t,o,u){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(c){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=yl(this._options,this.map._requestManager,t,o,(u,g)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new r.y(u))):g&&(Object.assign(this,g),g.bounds&&(this.tileBounds=new no(g.bounds,this.minzoom,this.maxzoom)),bt(g.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,t){const o=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(o,r.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.o.devicePixelRatio,promoteId:this.promoteId};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=t;else{if(c.buckets){const v=Object.values(c.buckets);for(const b of v)b.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",u,g.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",u,g.bind(this),void 0,!0);function g(v,b){return c.aborted?t(null):v&&v.status!==404?t(v):(this.map._refreshExpiredTiles&&b&&c.setExpiryData(b),c.loadModelData(b,this.map.painter),c.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends r.aU{constructor(c,t,o,u){super(c,t,o,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new r.y(new r.V(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(c){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof r.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends r.E{constructor(c,t,o,u){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new no(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,r.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this.map=c,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:o,z:u}=c.canonical;return this._implementation.hasTile({x:t,y:o,z:u})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:o,y:u,z:g}=c.tileID.canonical,v=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:o,y:u,z:g},{signal:v.signal})).then((function(b){return delete c.request,c.aborted?(c.state="unloaded",t(null)):b===void 0?(c.state="errored",t(null)):b===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null)):(function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement})(b)?(this.loadTileData(c,b),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.name!=="AbortError"&&(c.state="errored",t(b))}),c.request.cancel=()=>v.abort()}loadTileData(c,t){c.setTexture(t,this.map.painter)}unloadTile(c,t){if(c.texture&&c.texture instanceof r.T?(c.destroy(!1),c.texture&&c.texture instanceof r.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){const{x:o,y:u,z:g}=c.tileID.canonical;this._implementation.unloadTile({x:o,y:u,z:g})}t&&t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){const c=r.B(this.id,this.scope);this.map.style.clearSource(c)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},Ia=function(c,t,o,u){const g=new qa[t.type](c,t,o,u);if(g.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${g.id}`);return r.aY(["load","abort","unload","serialize","prepare"],g),g};function Qo(c,t,o=""){return`${o}:${t.id||""}:${t.layer.id}:${(function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:g,importId:v}=u;return`featureset:${g}${v?`:import:${v}`:""}`}})(c.target)}`}function rh(c,t,o,u=""){if(c.uniqueFeatureID){const g=Qo(c,t,u);if(o.has(g))return!0;o.add(g)}return!1}function vl(c,t,o,u,g=!1,v=void 0){const b=t.sourceCache.transform,E=t.sourceCache.tilesIn(c,t.has3DLayers,g);E.sort(xf);const C=[];for(const P of E){const z=P.tile.queryRenderedFeatures(t,P,o,u,b,g,v);Object.keys(z).length&&C.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:z})}for(const P in t.layers){const z=t.layers[P];if(z.styleLayer){const U=z.styleLayer.queryRenderedFeatures(c,t.sourceCache,u);Object.keys(U).length&&C.push({wrappedTileID:0,queryResults:U})}}return C.length===0?{}:(function(P){const z={},U={};for(const N of P){const V=N.queryResults,X=N.wrappedTileID,Z=U[X]=U[X]||{};for(const Y in V){const ne=V[Y],ue=Z[Y]=Z[Y]||{},ce=z[Y]=z[Y]||[];for(const ae of ne)ue[ae.featureIndex]||(ue[ae.featureIndex]=!0,ce.push(ae))}}return z})(C)}function yg(c,t,o,u,g,v){const b={},E=u.queryRenderedSymbols(c),C=[];for(const P of Object.keys(E).map(Number))C.push(g[P]);C.sort(xf);for(const P of C){const z=P.featureIndex.lookupSymbolFeatures(E[P.bucketInstanceId],P.bucketIndex,P.sourceLayerIndex,t,o,v);for(const U in z){const N=b[U]=b[U]||[],V=z[U];V.sort((X,Z)=>{const Y=P.featureSortOrder;if(Y){const ne=Y.indexOf(X.featureIndex);return Y.indexOf(Z.featureIndex)-ne}return Z.featureIndex-X.featureIndex});for(const X of V)N.push(X)}}return b}function Vp(c,t){const o=c.getRenderableIds().map(v=>c.getTileByID(v)),u=[],g={};for(let v=0;v<o.length;v++){const b=o[v],E=b.tileID.canonical.key;g[E]||(g[E]=!0,b.querySourceFeatures(u,t))}return u}function xf(c,t){const o=c.tileID,u=t.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function dd(c,t){const o={};if(!t)return o;for(const u of c){const g=u.layerIds.map(v=>t.getLayer(v)).filter(Boolean);if(g.length!==0){u.layers=g,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(v=>g.filter(b=>b.id===v)[0]));for(const v of g)o[v.fqid]=u}}return o}const As=32,da=33,Ra=new Uint16Array(8184);for(let c=0;c<2046;c++){let t=c+2,o=0,u=0,g=0,v=0,b=0,E=0;for(1&t?g=v=b=As:o=u=E=As;(t>>=1)>1;){const P=o+g>>1,z=u+v>>1;1&t?(g=o,v=u,o=b,u=E):(o=g,u=v,g=b,v=E),b=P,E=z}const C=4*c;Ra[C+0]=o,Ra[C+1]=u,Ra[C+2]=g,Ra[C+3]=v}const ds=new Uint16Array(2178),Ma=new Uint8Array(1089),Ac=new Uint16Array(1089);function Ha(c){return c===0?-.03125:c===32?.03125:0}const Da={type:2,extent:r.al,loadGeometry:()=>[[new r.P(0,0),new r.P(r.al+1,0),new r.P(r.al+1,r.al+1),new r.P(0,r.al+1),new r.P(0,0)]]};class Gl{constructor(t,o,u,g,v,b){this.tileID=t,this.uid=r.b2(),this.uses=0,this.tileSize=o,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection),this.worldview=b,this._hasAppearances=null}registerFadeDuration(t){const o=t+this.timeAdded;o<r.o.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,o,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=dd(t.buckets,o.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const v=this.buckets[g];if(v instanceof r.b4){if(this.hasSymbolBuckets=!0,!u)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const v=this.buckets[g];if(v instanceof r.b4&&v.hasRTLText){this.hasRTLText=!0,r.b5();break}}this.queryPadding=0;for(const g in this.buckets){const v=this.buckets[g],b=o.style.getOwnLayer(g);if(!b)continue;const E=b.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,E)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,o,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,dd(t.buckets,o.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,o){for(const v in this.buckets){const b=this.buckets[v];if(b.uploadPending()){let E={},C=[],P={zoom:0,pitch:0,brightness:0,worldview:""};if(o){if(o.style){C=o.style.listImages();const z=b.layers[0],U=z.sourceLayer||"_geojsonTileLayer",N=o.style.getLayerSourceCache(z);N&&(E=N._state.getState(U,void 0))}P={zoom:o.transform.zoom||0,pitch:o.transform.pitch||0,brightness:o.style.getBrightness()||0,worldview:o.worldview||""}}b.upload(t,this.tileID.canonical,E,C,P)}}const u=t.gl,g=this.imageAtlas;g&&!g.uploaded&&(this.imageAtlasTexture=new r.T(t,g.image,u.RGBA8,{useMipmap:!!g.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,u.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,u.R8),this.lineAtlas.uploaded=!0)}prepare(t,o,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=o.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(o)),(this._lastUpdatedBrightness||g||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this.updateBuckets(o,this._lastUpdatedBrightness!==g),this._lastUpdatedBrightness=g))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const o in this.buckets){const u=this.buckets[o];u.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,u.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,o,u,g,v,b,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const C=this.evaluateQueryRenderedFeaturePadding(),P=(function(z,U){const N=r.bq([],[.5*z.width,.5*-z.height,1]);return r.br(N,N,[1,-1,0]),r.aB(N,N,z.calculateProjMatrix(U.toUnwrapped())),Float32Array.from(N)})(v,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:o,pixelPosMatrix:P,transform:g,availableImages:u,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:C,scope:E})}querySourceFeatures(t,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const g=u.loadVTLayers(),v=o?o.sourceLayer:"",b=g._geojsonTileLayer||g[v];if(!b)return;const E=r.b6(o&&o.filter),{z:C,x:P,y:z}=this.tileID.canonical,U={z:C,x:P,y:z};for(let N=0;N<b.length;N++){const V=b.feature(N);if(E.needGeometry){const Y=r.b7(V,!0);if(!E.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Y,this.tileID.canonical))continue}else if(!E.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),V))continue;const X=u.getId(V,v),Z=new r.b8(V,C,P,z,X);Z.tile=U,t.push(Z)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const u=r.b9(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let g=!1;if(this.expirationTime>u)g=!1;else if(o)if(this.expirationTime<o)g=!0;else{const v=this.expirationTime-o;v?this.expirationTime=u+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const o in this.buckets)if(t.style.hasLayer(o)&&this.buckets[o].layers.some(u=>u.appearances&&u.appearances.length>0))return!0;return!1}updateBuckets(t,o){if(!this.latestFeatureIndex||!t.style)return;const u=t.style.listImages(),g=t.style.getBrightness();for(const v in this.buckets){if(!t.style.hasLayer(v))continue;const b=this.buckets[v],E=b.layers[0],C=E.sourceLayer||"_geojsonTileLayer",P=t.style.getLayerSourceCache(E);let z={};P&&(z=P._state.getState(C,void 0));const U=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},N=Object.keys(z).length>0&&!o;b.hasAppearances=b.layers.some(Z=>Z.appearances&&Z.appearances.length>0);const V=N?b.stateDependentLayers:b.layers;if(N&&b.stateDependentLayers.length!==0||o){const Z=this.latestFeatureIndex.loadVTLayers();b.update(z,Z[C],u,U,V,o,g)}if(N&&b.stateDependentLayers.length!==0||o||b.hasAppearances){const Z={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};b.updateAppearances(this.tileID.canonical,z,u,Z,t.imageManager)}(b instanceof r.ba||b instanceof r.bb)&&t._terrain&&t._terrain.enabled&&P&&b.uploadPending()&&t._terrain._clearRenderCacheForTile(P.id,this.tileID);const X=t&&t.style&&t.style.getOwnLayer(v);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.o.now()+t}setTexture(t,o){const u=o.context,g=u.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(u,t,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(t,o){const u={};for(const g of o)u[g]=!0;this.dependencies[t]=u}hasDependency(t,o){for(const u of t){const g=this.dependencies[u];if(g){for(const v of o)if(g[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const u=r.bc(Da,this.tileID.canonical,this.tileTransform)[0],g=new r.bd,v=new r.be;for(let b=0;b<u.length;b++){const{x:E,y:C}=u[b];g.emplaceBack(E,C),v.emplaceBack(b)}v.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(v),this._tileDebugBuffer=t.createVertexBuffer(g,r.bf.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,g.length,v.length)}_makeTileBoundsBuffers(t,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const u=r.bc(Da,this.tileID.canonical,this.tileTransform)[0];let g,v;if(this.isRaster){const b=(function(E,C){const P=r.aZ(E,C),z=Math.pow(2,E.z);for(let Y=0;Y<da;Y++)for(let ne=0;ne<da;ne++){const ue=r.a_((E.x+(ne+Ha(ne))/As)/z),ce=r.a$((E.y+(Y+Ha(Y))/As)/z),ae=C.project(ue,ce),Ee=Y*da+ne;ds[2*Ee+0]=Math.round((ae.x*P.scale-P.x)*r.al),ds[2*Ee+1]=Math.round((ae.y*P.scale-P.y)*r.al)}Ma.fill(0),Ac.fill(0);for(let Y=2045;Y>=0;Y--){const ne=4*Y,ue=Ra[ne+0],ce=Ra[ne+1],ae=Ra[ne+2],Ee=Ra[ne+3],xe=ue+ae>>1,Se=ce+Ee>>1,ye=xe+Se-ce,fe=Se+ue-xe,De=ce*da+ue,Pe=Ee*da+ae,Be=Se*da+xe,He=Math.hypot((ds[2*De+0]+ds[2*Pe+0])/2-ds[2*Be+0],(ds[2*De+1]+ds[2*Pe+1])/2-ds[2*Be+1])>=16;Ma[Be]=Ma[Be]||(He?1:0),Y<1022&&(Ma[Be]=Ma[Be]||Ma[(ce+fe>>1)*da+(ue+ye>>1)]||Ma[(Ee+fe>>1)*da+(ae+ye>>1)])}const U=new r.b1,N=new r.b0;let V=0;function X(Y,ne){const ue=ne*da+Y;return Ac[ue]===0&&(U.emplaceBack(ds[2*ue+0],ds[2*ue+1],Y*r.al/As,ne*r.al/As),Ac[ue]=++V),Ac[ue]-1}function Z(Y,ne,ue,ce,ae,Ee){const xe=Y+ue>>1,Se=ne+ce>>1;if(Math.abs(Y-ae)+Math.abs(ne-Ee)>1&&Ma[Se*da+xe])Z(ae,Ee,Y,ne,xe,Se),Z(ue,ce,ae,Ee,xe,Se);else{const ye=X(Y,ne),fe=X(ue,ce),De=X(ae,Ee);N.emplaceBack(ye,fe,De)}}return Z(0,0,As,As,As,0),Z(As,As,0,0,0,As),{vertices:U,indices:N}})(this.tileID.canonical,o);g=b.vertices,v=b.indices}else{g=new r.b1,v=new r.b0;for(const{x:E,y:C}of u)g.emplaceBack(E,C,0,0);const b=r.bh(g.int16.subarray(0,4*g.length),void 0,4);for(let E=0;E<b.length;E+=3)v.emplaceBack(b[E],b[E+1],b[E+2])}this._tileBoundsBuffer=t.createVertexBuffer(g,r.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(v),this._tileBoundsSegments=r.bg.simpleSegment(0,0,g.length,v.length)}_makeGlobeTileDebugBuffers(t,o){const u=o.projection;if(!u||u.name!=="globe"||o.freezeTileCoverage)return;const g=this.tileID.canonical,v=r.bj(g,o),b=r.bk(v),E=r.aj(o.zoom);let C;E>0&&(C=r.bl(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,g,o,b,C,E),this._makeGlobeTileDebugTextBuffer(t,g,o,b,C,E)}_globePoint(t,o,u,g,v,b,E){let C=r.bm(t,o,u);if(b){const P=1<<u.z,z=r.aF(g.center.lng),U=r.aJ(g.center.lat),N=(u.x+.5)/P-z;let V=0;N>.5?V=-1:N<-.5&&(V=1);let X=(t/r.al+u.x)/P+V,Z=(o/r.al+u.y)/P;X=(X-z)*g._pixelsPerMercatorPixel+z,Z=(Z-U)*g._pixelsPerMercatorPixel+U;const Y=[X*g.worldSize,Z*g.worldSize,0];r.af(Y,Y,b),C=r.bn(C,Y,E)}return r.af(C,C,v)}_makeGlobeTileDebugBorderBuffer(t,o,u,g,v,b){const E=new r.bd,C=new r.be,P=new r.bo,z=(N,V,X,Z,Y)=>{const ne=(X-N)/(Y-1),ue=(Z-V)/(Y-1),ce=E.length;for(let ae=0;ae<Y;ae++){const Ee=N+ae*ne,xe=V+ae*ue;E.emplaceBack(Ee,xe);const Se=this._globePoint(Ee,xe,o,u,g,v,b);P.emplaceBack(Se[0],Se[1],Se[2]),C.emplaceBack(ce+ae)}},U=r.al;z(0,0,U,0,16),z(U,0,U,U,16),z(U,U,0,U,16),z(0,U,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(C),this._tileDebugBuffer=t.createVertexBuffer(E,r.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(P,r.bp.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,E.length,C.length)}_makeGlobeTileDebugTextBuffer(t,o,u,g,v,b){const E=r.al/4,C=new r.bd,P=new r.b0,z=new r.bo,U=25;P.reserve(32),C.reserve(U),z.reserve(U);const N=(V,X)=>U*V+X;for(let V=0;V<U;V++){const X=V*E;for(let Z=0;Z<U;Z++){const Y=Z*E;C.emplaceBack(Y,X);const ne=this._globePoint(Y,X,o,u,g,v,b);z.emplaceBack(ne[0],ne[1],ne[2])}}for(let V=0;V<4;V++)for(let X=0;X<4;X++){const Z=N(V,X),Y=N(V,X+1),ne=N(V+1,X),ue=N(V+1,X+1);P.emplaceBack(Z,Y,ne),P.emplaceBack(ne,Y,ue)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(P),this._tileDebugTextBuffer=t.createVertexBuffer(C,r.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(z,r.bp.members),this._tileDebugTextSegments=r.bg.simpleSegment(0,0,U,32)}destroy(t=!0){for(const o in this.buckets)this.buckets[o].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof r.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bs.setPbf(r.bt);class sh extends Gl{constructor(t,o,u,g,v){super(t,o,u,g,v),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,o,u){const g=u.context,v=g.gl;let b=this.texturePerLayer.get(t)||u.getTileTexture(o.width);b&&b instanceof r.T?b.update(o,{premultiply:!1}):b=new r.T(g,o,v.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,b)}flushQueues(t){const o=this._workQueuePerLayer.get(t)||[],u=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()();for(;u.length;)u.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const o=this._workQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const o=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}}fetchHeader(t=16384,o){const u=this._mrt=new r.bs(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.bu(g,(v,b,E)=>{if(v)o(v);else try{const C=u.getHeaderLength(b);if(C>t)return void(this.request=this.fetchHeader(C,o));u.parseHeader(b),this._isHeaderLoaded=!0;let P=0;for(const z of Object.values(u.layers))P=Math.max(P,z.dataIndex[z.dataIndex.length-1].lastByte);b.byteLength>=P&&(this.entireBuffer=b),o(null,this.entireBuffer||b,E)}catch(C){o(C)}}),this.request}fetchBandForRender(t,o,u,g){this.fetchBand(t,o,u,v=>{if(v)return void g(v);this.updateTextureDescriptor(t,o,u);const b=this.textureDescriptorPerLayer.get(o);g(null,b?b.img:null)})}fetchBand(t,o,u,g,v=!0){const b=this._mrt;if(!this._isHeaderLoaded||!b)return void g(new Error("Tile header is not ready"));const E=this.actor;if(!E)return void g(new Error("Can't fetch tile band without an actor"));let C;const P=r.B(String(u),r.B(this.tileID.key,t));let z=this._taskQueue.get(P);z?z.add(g):(z=new Set,z.add(g),this._taskQueue.set(P,z));const U=(Z,Y)=>{C.complete(Z,Y),Z?g(Z):(z.forEach(ne=>ne(null,Y)),this._taskQueue.delete(P))},N=(Z,Y)=>{if(Z)return g(Z);const ne=E.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:Y,task:C},U,void 0,!0);if(o!==null){const ue=this._workQueuePerLayer.get(o)||[];ue.push(()=>{ne&&ne.cancel(),C.cancel()}),this._workQueuePerLayer.has(o)||this._workQueuePerLayer.set(o,ue)}};let V;try{V=b.getLayer(t)}catch(Z){if(this.state==="reloading")return;throw Z}if(!V)return void g(new Error(`Unknown sourceLayer "${t}"`));if(V.hasDataForBand(u))return z.forEach(Z=>Z(null,null)),void this._taskQueue.delete(P);const X=V.getDataRange([u]);if(C=b.createDecodingTask(X),!C||C.tasks.length)if(o!==null&&this.flushQueues(o),this.entireBuffer)N(null,this.entireBuffer.slice(X.firstByte,X.lastByte+1));else{const Z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${X.firstByte}-${X.lastByte}`}}),Y=r.bu(Z,N);if(o!==null){const ne=this._fetchQueuePerLayer.get(o)||[];ne.push(()=>{Y.cancel(),C.cancel()}),this._fetchQueuePerLayer.has(o)||this._fetchQueuePerLayer.set(o,ne)}}}updateNeeded(t,o){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==o||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,o,u){if(!this._mrt)return;const g=this._mrt.getLayer(t);if(!g||!g.hasBand(u)||!g.hasDataForBand(u))return;const{bytes:v,tileSize:b,buffer:E,offset:C,scale:P}=g.getBandView(u),z=b+2*E,U=new r.q({width:z,height:z},v),N=this.texturePerLayer.get(o);N&&N instanceof r.T&&N.update(U,{premultiply:!1}),this.textureDescriptorPerLayer.set(o,{layer:t,band:u,img:U,buffer:E,offset:C,tileSize:b,format:g.pixelFormat,mix:[P,256*P,65536*P,16777216*P]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const o of this.texturePerLayer.values())o&&o instanceof r.T&&o.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Gp{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,u){const g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const v={value:o,timeout:void 0};if(u!==void 0&&(v.timeout=setTimeout(()=>{this.remove(t,v)},u)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const u=t.wrapped().key,g=o===void 0?0:this.data[u].indexOf(o),v=this.data[u][g];return this.data[u].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(v.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const u in this.data)for(const g of this.data[u])t(g.value)||o.push(g);for(const u of o)this.remove(u.value.tileID,u)}}class oh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,u){const g=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},Object.assign(this.stateChanges[t][g],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const v in this.state[t])v!==g&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(const v in this.state[t][g])u[v]||(this.deletedStates[t][g][v]=null)}else for(const v in u)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][v]===null&&delete this.deletedStates[t][g][v]}removeFeatureState(t,o,u){if(this.deletedStates[t]===null)return;const g=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(u in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][u]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,o){const u=this.state[t]||{},g=this.stateChanges[t]||{},v=this.deletedStates[t];if(v===null)return{};if(o!==void 0){const E=String(o),C=Object.assign({},u[E],g[E]);if(v){const P=v[o];if(P===null)return{};for(const z in P)delete C[z]}return C}const b=Object.assign({},u,g);if(v)for(const E in v)delete b[E];return b}initializeTileState(t,o){t.refreshFeatureState(o)}coalesceChanges(t,o){const u={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const v={};for(const b in this.stateChanges[g])this.state[g][b]||(this.state[g][b]={}),Object.assign(this.state[g][b],this.stateChanges[g][b]),v[b]=this.state[g][b];u[g]=v}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const v={};if(this.deletedStates[g]===null)for(const b in this.state[g])v[b]={},this.state[g][b]={};else for(const b in this.deletedStates[g]){if(this.deletedStates[g][b]===null)this.state[g][b]={};else if(this.state[g][b])for(const E of Object.keys(this.deletedStates[g][b]))delete this.state[g][b][E];v[b]=this.state[g][b]}u[g]=u[g]||{},Object.assign(u[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const g in t)t[g].refreshFeatureState(o)}}class es extends r.E{constructor(t,o,u){super(),this.id=t,this._onlySymbols=u,o.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new Gp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new oh,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,o){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(t,this.map?this.map.painter:void 0),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(su).map(t=>t.key)}getRenderableIds(t,o){const u=[];for(const g in this._tiles)this._isIdRenderable(+g,t,o)&&u.push(this._tiles[g]);return t?u.sort((g,v)=>{const b=g.tileID,E=v.tileID,C=new r.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),P=new r.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-E.overscaledZ||P.y-C.y||P.x-C.x}).map(g=>g.tileID.key):u.map(g=>g.tileID).sort(su).map(g=>g.key)}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,o){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=o),this._loadTile(u,this._tileLoaded.bind(this,u,t,o)))}_tileLoaded(t,o,u,g,v){if(g){if(t.state="errored",g.status!==404)this._source.fire(new r.y(g,{tile:t}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const E=this.map.painter.terrain;this.update(this.transform,E.getScaledDemTileSize(),!0),E.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=r.o.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let b=new Map;v&&v.responseHeaders&&(b=v.responseHeaders),this._source.fire(new r.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:b}))}_backfillDEM(t){const o=this.getRenderableIds();for(let g=0;g<o.length;g++){const v=o[g];if(t.neighboringTiles&&t.neighboringTiles[v]){const b=this.getTileByID(v);u(t,b),u(b,t)}}function u(g,v){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let b=v.tileID.canonical.x-g.tileID.canonical.x;const E=v.tileID.canonical.y-g.tileID.canonical.y,C=Math.pow(2,g.tileID.canonical.z),P=v.tileID.key;b===0&&E===0||Math.abs(E)>1||(Math.abs(b)>1&&(Math.abs(b+C)===1?b+=C:Math.abs(b-C)===1&&(b-=C)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,b,E),g.neighboringTiles&&g.neighboringTiles[P]&&(g.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,u,g){for(const v in this._tiles){let b=this._tiles[v];if(g[v]||!b.hasData()||b.tileID.overscaledZ<=o||b.tileID.overscaledZ>u)continue;let E=b.tileID;for(;b&&b.tileID.overscaledZ>o+1;){const P=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[P.key],b&&b.hasData()&&(E=P)}let C=E;for(;C.overscaledZ>o;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]){g[E.key]=E;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=t.overscaledZ-1;u>=o;u--){const g=t.scaledTo(u),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,o){o=o||this._source.tileSize;const u=Math.ceil(t.width/o)+1,g=Math.ceil(t.height/o)+1,v=Math.floor(u*g*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(E)}handleWrapJump(t){const o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){const u={};for(const g in this._tiles){const v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+o),u[v.tileID.key]=v}this._tiles=u;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(t,o,u,g,v){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let E,C=this._source.maxzoom;const P=this.map&&this.map.painter?this.map.painter._terrain:null;if(P&&P.sourceCache===this&&P.attenuationRange()){const N=P.attenuationRange()[0],V=Math.floor(N)-Math.log2(P.getDemUpscale());C>V&&(C=V)}if(this.used||this.usedForTerrain){if(this._source.tileID)E=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(N=>new r.aQ(N.canonical.z,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y));else if(this.tileCoverLift!==0){const N=t.clone();N.tileCoverLift=this.tileCoverLift,E=N.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&t.projection.name==="globe"&&(E.push(new r.aQ(1,0,1,0,0)),E.push(new r.aQ(1,0,1,1,0)),E.push(new r.aQ(1,0,1,0,1)),E.push(new r.aQ(1,0,1,1,1)))}else if(E=t.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const N=this._source.hasTile.bind(this._source);E=E.filter(V=>N(V))}}else E=[];if(E.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ql(this._source.type)){const N=t.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),V=Math.min(N,this._source.maxzoom);if(b){const X=t.extendTileCover(E,V);for(const Z of X)E.push(Z)}else if(v){const X=t.extendTileCoverToNearPlane(E,this.transform.getFrustum(V),V);for(const Z of X)E.push(Z)}else if(this.castsShadows&&g){const X=t.extendTileCover(E,V,g,16);for(const Z of X)this._shadowCasterTiles[Z.key]=!0,E.push(Z)}}const z=this._updateRetainedTiles(E);if(ql(this._source.type)&&E.length!==0){const N={},V={},X=Object.keys(z);for(const Y of X){const ne=z[Y],ue=this._tiles[Y];if(!ue||ue.fadeEndTime&&ue.fadeEndTime<=r.o.now())continue;const ce=this.findLoadedParent(ne,Math.max(ne.overscaledZ-es.maxOverzooming,this._source.minzoom));ce&&(this._addTile(ce.tileID),N[ce.tileID.key]=ce.tileID),V[Y]=ne}const Z=E[E.length-1].overscaledZ;for(const Y in this._tiles){const ne=this._tiles[Y];if(z[Y]||!ne.hasData())continue;let ue=ne.tileID;for(;ue.overscaledZ>Z;){ue=ue.scaledTo(ue.overscaledZ-1);const ce=this._tiles[ue.key];if(ce&&ce.hasData()&&V[ue.key]){z[Y]=ne.tileID;break}}}for(const Y in N)z[Y]||(this._coveredTiles[Y]=!0,z[Y]=N[Y])}for(const N in z)this._tiles[N].clearFadeHold();const U=r.bv(this._tiles,z);for(const N of U){const V=this._tiles[N];V.hasSymbolBuckets&&!V.holdingForFade()?V.setHoldDuration(this.map._fadeDuration):V.hasSymbolBuckets&&!V.symbolFadeFinished()||this._removeTile(+N)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const o={};if(t.length===0)return o;const u={},g=t.reduce((P,z)=>Math.min(P,z.overscaledZ),1/0),v=t[0].overscaledZ,b=Math.max(v-es.maxOverzooming,this._source.minzoom),E=Math.max(v+es.maxUnderzooming,this._source.minzoom),C={};for(const P of t){const z=this._addTile(P);o[P.key]=P,z.hasData()||g<this._source.maxzoom&&(C[P.key]=P)}this._retainLoadedChildren(C,g,E,o);for(const P of t){let z=this._tiles[P.key];if(z.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const N=P.children(this._source.maxzoom)[0],V=this.getTile(N);if(V&&V.hasData()){o[N.key]=N;continue}}else{const N=P.children(this._source.maxzoom);if(o[N[0].key]&&o[N[1].key]&&o[N[2].key]&&o[N[3].key])continue}let U=z.wasRequested();for(let N=P.overscaledZ-1;N>=b;--N){const V=P.scaledTo(N);if(u[V.key]||(u[V.key]=!0,z=this.getTile(V),!z&&U&&(z=this._addTile(V)),z&&(o[V.key]=V,U=z.wasRequested(),z.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let u,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){u=this._loadedParentTiles[g.key];break}o.push(g.key);const v=g.scaledTo(g.overscaledZ-1);if(u=this._getLoadedTile(v),u)break;g=v}for(const v of o)this._loadedParentTiles[v]=u}}_addTile(t){let o=this._tiles[t.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const u=!!o;if(!u){const g=this.map?this.map.painter:null,v=this._source.tileSize*t.overscaleFactor();o=this._source.type==="raster-array"?new sh(t,v,this.transform.tileZoom,g,this._isRaster):new Gl(t,v,this.transform.tileZoom,g,this._isRaster,this._source.worldview),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))}return o.uses++,this._tiles[t.key]=o,u||this._source.fire(new r.z("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=o.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,o,u){const g=[],v=this.transform;if(!v)return g;const b=v.projection.name==="globe",E=r.aF(v.center.lng);for(const C in this._tiles){const P=this._tiles[C];if(u&&P.clearQueryDebugViz(),P.holdingForFade())continue;let z;if(b){const U=P.tileID.canonical;if(U.z===0){const N=[Math.abs(r.aA(E,...yo(U,-1))-E),Math.abs(r.aA(E,...yo(U,1))-E)];z=[0,2*N.indexOf(Math.min(...N))-1]}else{const N=[Math.abs(r.aA(E,...yo(U,-1))-E),Math.abs(r.aA(E,...yo(U,0))-E),Math.abs(r.aA(E,...yo(U,1))-E)];z=[N.indexOf(Math.min(...N))-1]}}else z=[0];for(const U of z){const N=t.containsTile(P,v,o,U);N&&g.push(N)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,o){const u=this.getRenderableIds(t,o).map(v=>this._tiles[v].tileID),g=this.transform.projection.name==="globe";for(const v of u)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=g?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return u}sortCoordinatesByDistance(t){const o=t.slice(),u=this.transform._camera.position,g=this.transform._camera.forward(),v={};for(const b of o){const E=1/(1<<b.canonical.z);v[b.key]=((b.canonical.x+.5)*E+b.wrap-u[0])*g[0]+((b.canonical.y+.5)*E-u[1])*g[1]-u[2]*g[2]}return o.sort((b,E)=>v[b.key]-v[E.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(ql(this._source.type))for(const t in this._tiles){const o=this._tiles[t];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=r.o.now())return!0}return!1}setFeatureState(t,o,u){this._state.updateState(t=t||"_geojsonTileLayer",o,u)}removeFeatureState(t,o,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,u)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,u){const g=this._tiles[t];g&&g.setDependencies(o,u)}reloadTilesForDependencies(t,o){for(const u in this._tiles)this._tiles[u].hasDependency(t,o)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,o))}_preloadTiles(t,o){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(t,o))};return void this._source.on("data",C)}const u=new Map,g=Array.isArray(t)?t:[t],v=this.map.painter.terrain,b=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const C of g){const P=C.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of P)u.set(z.key,z);this.usedForTerrain&&C.updateElevation(!1)}const E=Array.from(u.values());r.bw(E,(C,P)=>{const z=new Gl(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(z,U=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),P(U,z)})},o)}}function su(c,t){const o=Math.abs(2*c.wrap)-+(c.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||u-o||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function ql(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function yo(c,t){const o=1<<c.z;return[c.x/o+t,(c.x+1)/o+t]}es.maxOverzooming=10,es.maxUnderzooming=3;class ou{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,o=!1;for(const u in this.style._mergedLayers){const g=this.style._mergedLayers[u];if(g.type==="fill-extrusion"||g.type==="building")this.layers.push({layer:g,visible:t,visibilityChanged:o});else if(g.type==="model"){const v=this.style.getLayerSource(g);v&&v.type==="batched-model"&&this.layers.push({layer:g,visible:t,visibilityChanged:o})}}}onNewFrame(t){this.layersGotHidden=!1;for(const o of this.layers){const u=o.layer;let g=!1;u.type==="fill-extrusion"?g=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="building"?g=!u.isHidden(t)&&u.paint.get("building-opacity")>0:u.type==="model"&&(g=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!g&&o.visible,o.visible=g}}updateZOffset(t,o){this.currentBuildingBuckets=[];for(const g of this.layers){const v=g.layer,b=this.style.getLayerSourceCache(v);let E=1;v.type==="fill-extrusion"?E=g.visible?v.paint.get("fill-extrusion-vertical-scale"):0:v.type==="building"&&(E=g.visible?v.paint.get("building-vertical-scale"):0);let C=b?b.getTile(o):null;if(!C&&b)for(const P in b._tiles){const z=b._tiles[P];if(o.canonical.isChildOf(z.tileID.canonical)){C=z;break}}this.currentBuildingBuckets.push({bucket:C?C.getBucket(v):null,tileID:C?C.tileID:o,verticalScale:E})}t.hasAnyZOffset=!1;let u=!1;for(let g=0;g<t.symbolInstances.length;g++){const v=t.symbolInstances.get(g),b=v.zOffset,E=this._getHeightAtTileOffset(o,v.tileAnchorX,v.tileAnchorY);v.zOffset=E!==Number.NEGATIVE_INFINITY?E:b,u||b===v.zOffset||(u=!0),t.hasAnyZOffset||v.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,o,u,g){let v=o,b=u;if(t.canonical.z!==g.canonical.z){const E=g.canonical,C=1/(1<<t.canonical.z-E.z);v=(o+t.canonical.x*r.al)*C-E.x*r.al|0,b=(u+t.canonical.y*r.al)*C-E.y*r.al|0}return{tileX:v,tileY:b}}_getHeightAtTileOffset(t,o,u){let g,v;for(let b=0;b<this.layers.length;++b){const E=this.layers[b].layer;if(E.type!=="fill-extrusion"&&E.type!=="building")continue;const{bucket:C,tileID:P,verticalScale:z}=this.currentBuildingBuckets[b];if(!C)continue;const{tileX:U,tileY:N}=this._mapCoordToOverlappingTile(t,o,u,P),V=C.getHeightAtTileCoord(U,N);V&&V.height!==void 0&&(V.hidden?g=V.height:v=Math.max(V.height*z,v||0))}if(v!==void 0)return v;for(let b=0;b<this.layers.length;++b){const E=this.layers[b];if(E.layer.type!=="model"||!E.visible)continue;const{bucket:C,tileID:P}=this.currentBuildingBuckets[b];if(!C)continue;const{tileX:z,tileY:U}=this._mapCoordToOverlappingTile(t,o,u,P),N=C.getHeightAtTileCoord(z,U);if(N&&!N.hidden)return N.height===void 0&&g!==void 0?Math.min(N.maxHeight,g)*N.verticalScale:N.height?N.height*N.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function bf(c,t){const o={};for(const u in c)u!=="ref"&&(o[u]=c[u]);return r.bx.forEach(u=>{u in t&&(o[u]=t[u])}),o}function wf(c){c=c.slice();const t=Object.create(null);for(let o=0;o<c.length;o++)t[c[o].id]=c[o];for(let o=0;o<c.length;o++)"ref"in c[o]&&(c[o]=bf(c[o],t[c[o].ref]));return c}const on={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Hl(c,t,o){o.push({command:on.addSource,args:[c,t[c]]})}function fd(c,t,o){t.push({command:on.removeSource,args:[c]}),o[c]=!0}function Mo(c,t,o,u){fd(c,o,u),Hl(c,t,o)}function Cc(c,t,o){let u;for(u in c[o])if(c[o].hasOwnProperty(u)&&u!=="data"&&!r.by(c[o][u],t[o][u]))return!1;for(u in t[o])if(t[o].hasOwnProperty(u)&&u!=="data"&&!r.by(c[o][u],t[o][u]))return!1;return!0}function Ic(c,t,o,u,g,v){let b;for(b in t=t||{},c=c||{})c.hasOwnProperty(b)&&(r.by(c[b],t[b])||o.push({command:v,args:[u,b,t[b],g]}));for(b in t)t.hasOwnProperty(b)&&!c.hasOwnProperty(b)&&(r.by(c[b],t[b])||o.push({command:v,args:[u,b,t[b],g]}))}function Oa(c){return c.id}function pd(c,t){return c[t.id]=t,c}function ah(c,t,o){const u=t.createTileMatrix(c,c.worldSize,o.toUnwrapped());return r.aB(new Float32Array(16),c.projMatrix,u)}function qp(c,t,o){if(t.projection.name===o.projection.name)return c.projMatrix;const u=o.clone();return u.setProjection(t.projection),ah(u,t.getProjection(),c)}function xl(c,t,o){return t.name===o.projection.name?c.projMatrix:ah(o,t,c)}class Pa{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.aA(t,0,1);let o=1,u=this._distances[o];const g=t*this.paddedLength+this.padding;for(;u<g&&o<this._distances.length;)u=this._distances[++o];const v=o-1,b=this._distances[v],E=u-b,C=E>0?(g-b)/E:0;return this.points[v].mult(1-C).add(this.points[o].mult(C))}}class lh{constructor(t,o,u){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(o/u);for(let b=0;b<this.xCellCount*this.yCellCount;b++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,u,g,v){this._forEachCell(o,u,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(t,o,u,g){this._forEachCell(o-g,u-g,o+g,u+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(u),this.circles.push(g)}_insertBoxCell(t,o,u,g,v,b){this.boxCells[v].push(b)}_insertCircleCell(t,o,u,g,v,b){this.circleCells[v].push(b)}_query(t,o,u,g,v,b){if(u<0||t>this.width||g<0||o>this.height)return!v&&[];const E=[];if(t<=0&&o<=0&&this.width<=u&&this.height<=g){if(v)return!0;for(let C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const P=this.circles[3*C],z=this.circles[3*C+1],U=this.circles[3*C+2];E.push({key:this.circleKeys[C],x1:P-U,y1:z-U,x2:P+U,y2:z+U})}return b?E.filter(b):E}return this._forEachCell(t,o,u,g,this._queryCell,E,{hitTest:v,seenUids:{box:{},circle:{}}},b),v?E.length>0:E}_queryCircle(t,o,u,g,v){const b=t-u,E=t+u,C=o-u,P=o+u;if(E<0||b>this.width||P<0||C>this.height)return!g&&[];const z=[];return this._forEachCell(b,C,E,P,this._queryCellCircle,z,{hitTest:g,circle:{x:t,y:o,radius:u},seenUids:{box:{},circle:{}}},v),g?z.length>0:z}query(t,o,u,g,v){return this._query(t,o,u,g,!1,v)}hitTest(t,o,u,g,v){return this._query(t,o,u,g,!0,v)}hitTestCircle(t,o,u,g){return this._queryCircle(t,o,u,!0,g)}_queryCell(t,o,u,g,v,b,E,C){const P=E.seenUids,z=this.boxCells[v];if(z!==null){const N=this.bboxes;for(const V of z)if(!P.box[V]){P.box[V]=!0;const X=4*V;if(t<=N[X+2]&&o<=N[X+3]&&u>=N[X+0]&&g>=N[X+1]&&(!C||C(this.boxKeys[V]))){if(E.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[V],x1:N[X],y1:N[X+1],x2:N[X+2],y2:N[X+3]})}}}const U=this.circleCells[v];if(U!==null){const N=this.circles;for(const V of U)if(!P.circle[V]){P.circle[V]=!0;const X=3*V;if(this._circleAndRectCollide(N[X],N[X+1],N[X+2],t,o,u,g)&&(!C||C(this.circleKeys[V]))){if(E.hitTest)return b.push(!0),!0;{const Z=N[X],Y=N[X+1],ne=N[X+2];b.push({key:this.circleKeys[V],x1:Z-ne,y1:Y-ne,x2:Z+ne,y2:Y+ne})}}}}}_queryCellCircle(t,o,u,g,v,b,E,C){const P=E.circle,z=E.seenUids,U=this.boxCells[v];if(U!==null){const V=this.bboxes;for(const X of U)if(!z.box[X]){z.box[X]=!0;const Z=4*X;if(this._circleAndRectCollide(P.x,P.y,P.radius,V[Z+0],V[Z+1],V[Z+2],V[Z+3])&&(!C||C(this.boxKeys[X])))return b.push(!0),!0}}const N=this.circleCells[v];if(N!==null){const V=this.circles;for(const X of N)if(!z.circle[X]){z.circle[X]=!0;const Z=3*X;if(this._circlesCollide(V[Z],V[Z+1],V[Z+2],P.x,P.y,P.radius)&&(!C||C(this.circleKeys[X])))return b.push(!0),!0}}}_forEachCell(t,o,u,g,v,b,E,C){const P=this._convertToXCellCoord(t),z=this._convertToYCellCoord(o),U=this._convertToXCellCoord(u),N=this._convertToYCellCoord(g);for(let V=P;V<=U;V++)for(let X=z;X<=N;X++)if(v.call(this,t,o,u,g,this.xCellCount*X+V,b,E,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,u,g,v,b){const E=g-t,C=v-o,P=u+b;return P*P>E*E+C*C}_circleAndRectCollide(t,o,u,g,v,b,E){const C=(b-g)/2,P=Math.abs(t-(g+C));if(P>C+u)return!1;const z=(E-v)/2,U=Math.abs(o-(v+z));if(U>z+u)return!1;if(P<=C||U<=z)return!0;const N=P-C,V=U-z;return N*N+V*V<=u*u}}const vg=Math.tan(85*Math.PI/180);function au(c,t,o,u,g,v,b){const E=r.bC();if(o)if(v.name==="globe"){const C=r.bD(g,t);r.aB(E,E,C)}else{const C=r.bE([],b);E[0]=C[0],E[1]=C[1],E[4]=C[2],E[5]=C[3],u||r.bB(E,E,g.angle)}else r.aB(E,g.labelPlaneMatrix,c);return E}function $l(c,t,o,u,g,v,b){const E=au(c,t,o,u,g,v,b);return v.name==="globe"&&o||(E[2]=E[6]=E[10]=E[14]=0),E}function so(c,t,o,u,g,v,b){if(o){if(v.name==="globe"){const E=au(c,t,o,u,g,v,b);return r.bl(E,E),r.aB(E,c,E),E}{const E=r.bz(c),C=r.bA([]);return C[0]=b[0],C[1]=b[1],C[4]=b[2],C[5]=b[3],r.aB(E,E,C),u||r.bB(E,E,-g.angle),E}}return g.glCoordMatrix}function za(c,t,o,u){const g=[c,t,o,1];o?r.aC(g,g,u):Sf(g,g,u);const v=g[3];return g[0]/=v,g[1]/=v,g[2]/=v,g}function Tf(c,t){return Math.min(.5+c/t*.5,1.5)}function xg(c,t){const o=c[0]/c[3],u=c[1]/c[3];return o>=-t[0]&&o<=t[0]&&u>=-t[1]&&u<=t[1]}function xn(c,t,o,u,g,v,b,E,C,P,z=1){const U=o.transform,N=u?c.textSizeData:c.iconSizeData,V=r.bK(N,o.transform.zoom,z),X=U.projection.name==="globe",Z=[256/o.width*2+1,256/o.height*2+1],Y=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Y.clear();let ne=null;X&&(ne=u?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const ue=c.lineVertexArray,ce=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,ae=o.transform.width/o.transform.height;let Ee,xe=!1;for(let Se=0;Se<ce.length;Se++){const ye=ce.get(Se),{numGlyphs:fe,writingMode:De}=ye;if(De!==r.bL.vertical||xe||Ee===r.bL.horizontal||(xe=!0),Ee=De,(ye.hidden||De===r.bL.vertical)&&!xe){Hs(fe,Y);continue}xe=!1;const Pe=new r.P(ye.tileAnchorX,ye.tileAnchorY),Be=c.elevationType==="road",He=!!U.elevation||Be;let{x:Ve,y:Qe,z:ct}=U.projection.projectTilePoint(Pe.x,Pe.y,P.canonical),$e=null;if(He){const Kt=Be?c.getElevationFeatureForText(Se):null;$e={getElevation:C,elevation:U.elevation,elevationFeature:Kt};const[ai,_i,Pi]=C(Pe,U.elevation,Kt);Ve+=ai,Qe+=_i,ct+=Pi}const Oe=[Ve,Qe,ct,1];if(r.aC(Oe,Oe,t),!xg(Oe,Z)){Hs(fe,Y);continue}const nt=Oe[3],Ze=Tf(o.transform.getCameraToCenterDistance(U.projection),nt),lt=r.bM(N,V,ye),St=b?lt/Ze:lt*Ze,kt=za(Ve,Qe,ct,g);if(kt[3]<=0){Hs(fe,Y);continue}let Ct={};const Et=r.an(c.layers[0].layout.get("text-max-angle")),ei=Math.cos(Et),Yt=b?null:$e,Nt=bg(ye,St,!1,E,t,g,v,c.glyphOffsetArray,ue,Y,ne,kt,Pe,Ct,ae,Yt,U.projection,P,b,ei);xe=Nt.useVertical,Yt&&Nt.needsFlipping&&(Ct={}),(Nt.notEnoughRoom||xe||Nt.needsFlipping&&bg(ye,St,!0,E,t,g,v,c.glyphOffsetArray,ue,Y,ne,kt,Pe,Ct,ae,Yt,U.projection,P,b,ei).notEnoughRoom)&&Hs(fe,Y)}u?(c.text.dynamicLayoutVertexBuffer.updateData(Y),ne&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(ne)):(c.icon.dynamicLayoutVertexBuffer.updateData(Y),ne&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(ne))}function Hp(c,t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y){const{lineStartIndex:ne,glyphStartIndex:ue,segment:ce}=E,ae=ue+E.numGlyphs,Ee=ne+E.lineLength,xe=t.getoffsetX(ue),Se=t.getoffsetX(ae-1),ye=lu(c*xe,o,u,g,v,b,ce,ne,Ee,C,P,z,U,N,!0,V,X,Z,Y);if(!ye)return null;const fe=lu(c*Se,o,u,g,v,b,ce,ne,Ee,C,P,z,U,N,!0,V,X,Z,Y);return fe?{first:ye,last:fe}:null}function $p(c,t,o,u){return c===r.bL.horizontal&&Math.abs(u)>Math.abs(o)?{useVertical:!0}:c===r.bL.vertical?u>0?{needsFlipping:!0}:null:t!==0&&(function(g,v){return g===0||Math.abs(v/g)>vg})(o,u)?t===1?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function bg(c,t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y,ne,ue,ce){const ae=t/24,Ee=c.lineOffsetX*ae,xe=c.lineOffsetY*ae,{lineStartIndex:Se,glyphStartIndex:ye,numGlyphs:fe,segment:De,writingMode:Pe,flipState:Be}=c,He=Se+c.lineLength,Ve=Qe=>{if(z){const[nt,Ze,lt]=Qe.up,St=P.length;r.bN(z,St+0,nt,Ze,lt),r.bN(z,St+1,nt,Ze,lt),r.bN(z,St+2,nt,Ze,lt),r.bN(z,St+3,nt,Ze,lt)}const[ct,$e,Oe]=Qe.point;r.bO(P,ct,$e,Oe,Qe.angle)};if(fe>1){const Qe=Hp(ae,E,Ee,xe,o,U,N,c,C,v,V,Z,!1,Y,ne,ue,ce);if(!Qe)return{notEnoughRoom:!0};if(u&&!o){let[ct,$e,Oe]=Qe.first.point,[nt,Ze,lt]=Qe.last.point;[ct,$e]=za(ct,$e,Oe,b),[nt,Ze]=za(nt,Ze,lt,b);const St=$p(Pe,Be,(nt-ct)*X,Ze-$e);if(c.flipState=St&&St.needsFlipping?1:2,St)return St}Ve(Qe.first);for(let ct=ye+1;ct<ye+fe-1;ct++){const $e=lu(ae*E.getoffsetX(ct),Ee,xe,o,U,N,De,Se,He,C,v,V,Z,!1,!1,Y,ne,ue,ce);if(!$e)return P.length-=4*(ct-ye),{notEnoughRoom:!0};Ve($e)}Ve(Qe.last)}else{if(u&&!o){const ct=za(N.x,N.y,0,g),$e=Se+De+1,Oe=new r.P(C.getx($e),C.gety($e)),nt=za(Oe.x,Oe.y,0,g),Ze=nt[3]>0?nt:Zp(N,Oe,ct,1,g,void 0,Y,ne.canonical),lt=$p(Pe,Be,(Ze[0]-ct[0])*X,Ze[1]-ct[1]);if(c.flipState=lt&&lt.needsFlipping?1:2,lt)return lt}const Qe=lu(ae*E.getoffsetX(ye),Ee,xe,o,U,N,De,Se,He,C,v,V,Z,!1,!1,Y,ne,ue,ce);if(!Qe)return{notEnoughRoom:!0};Ve(Qe)}return{}}function vi(c,t,o,u,g){const{x:v,y:b,z:E}=u.projectTilePoint(c.x,c.y,t);if(!g)return za(v,b,E,o);const[C,P,z]=g.getElevation(c,g.elevation,g.elevationFeature);return za(v+C,b+P,E+z,o)}function Zp(c,t,o,u,g,v,b,E){const C=vi(c.sub(t)._unit()._add(c),E,g,b,v);return r.av(C,o,C),r.aw(C,C),r.bH(C,o,C,u)}function lu(c,t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y,ne,ue){const ce=u?c-t:c+t;let ae=ce>0?1:-1,Ee=0;u&&(ae*=-1,Ee=Math.PI),ae<0&&(Ee+=Math.PI);let xe=E+b+(ae>0?0:1)|0,Se=g,ye=g,fe=0,De=0;const Pe=Math.abs(ce),Be=[],He=[];let Ve=v,Qe=Ve,ct=r.bF([]);const $e=()=>Zp(Qe,Ve,ye,Pe-fe+1,z,N,Z,Y.canonical);for(;fe+De<=Pe;){if(xe+=ae,xe<E||xe>=C)return null;if(ye=Se,Qe=Ve,Be.push(ye),V&&He.push(Qe),Ve=new r.P(P.getx(xe),P.gety(xe)),Se=U[xe],!Se){const Yt=vi(Ve,Y.canonical,z,Z,N);Se=Yt[3]>0?U[xe]=Yt:$e()}fe+=De;const Et=r.av([],Se,ye),ei=r.bG(ye,Se);if(o&&ei>0&&De>0&&r.bJ(ct,Et)/(De*ei)<ue)return null;De=ei,ct=Et}X&&N&&(U[xe]&&(Se=$e(),De=r.bG(ye,Se),ct=r.av([],Se,ye)),U[xe]=Se);const Oe=(Pe-fe)/De,nt=Ve.sub(Qe)._mult(Oe)._add(Qe),Ze=r.bH([],ye,ct,Oe);let lt=[0,0,1],St=ct[0],kt=ct[1];if(ne&&(lt=Z.upVector(Y.canonical,nt.x,nt.y),lt[0]!==0||lt[1]!==0||lt[2]!==1)){const Et=[lt[2],0,-lt[0]],ei=r.bI([],lt,Et);r.aw(Et,Et),r.aw(ei,ei),St=r.bJ(ct,Et),kt=r.bJ(ct,ei)}if(o){const Et=r.bI([],lt,ct);r.aw(Et,Et),r.bH(Ze,Ze,Et,o*ae)}const Ct=Ee+Math.atan2(kt,St);return Be.push(Ze),V&&He.push(nt),{point:Ze,angle:Ct,path:Be,tilePath:He,up:lt}}function Hs(c,t){const o=t.length,u=o+4*c;t.resize(u),t.float32.fill(-1/0,4*o,4*u)}function Sf(c,t,o){const u=t[0],g=t[1];return c[0]=o[0]*u+o[4]*g+o[12],c[1]=o[1]*u+o[5]*g+o[13],c[3]=o[3]*u+o[7]*g+o[15],c}const Do=100;class ri{constructor(t,o,u=new lh(t.width+200,t.height+200,25),g=new lh(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=g,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Do,this.screenBottomBoundary=t.height+Do,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,u,g,v,b,E,C,P,z,U){let N=u.projectedAnchorX,V=u.projectedAnchorY,X=u.projectedAnchorZ;const Z=u.tileAnchorX,Y=u.tileAnchorY,ne=u.elevation,ue=u.tileID,ce=t.getProjection();if(ne&&ue){const[He,Ve,Qe]=ce.upVector(ue.canonical,u.tileAnchorX,u.tileAnchorY),ct=ce.upVectorScale(ue.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=He*ne*ct,V+=Ve*ne*ct,X+=Qe*ne*ct}const ae=t.projection.name==="globe",Ee=t.projection.name==="globe"?r.aj(this.transform.zoom):0;if(ue&&ae&&Ee<1&&!b){const He=1<<ue.canonical.z,Ve=r.bP(Z,Y);r.bQ(Ve,Ve,1/r.al),r.bR(Ve,Ve,r.bP(ue.canonical.x,ue.canonical.y)),r.bQ(Ve,Ve,1/He),r.bS(Ve,Ve,r.bP(g[0],g[1])),Ve[0]=r.bT(Ve[0],-.5,.5),r.bQ(Ve,Ve,r.al);const Qe=r.bU(Ve[0],Ve[1],r.al/(2*Math.PI),1);r.aC(Qe,Qe,v),N=r.ak(N,Qe[0],Ee),V=r.ak(V,Qe[1],Ee),X=r.ak(X,Qe[2],Ee)}const xe=this.projectAndGetPerspectiveRatio(z,N,V,X,u.tileID,ce.name==="globe"||!!ne||this.transform.pitch>0,ce),Se=P*xe.perspectiveRatio,ye=(u.x1*o+E.x-u.padding)*Se+xe.point.x,fe=(u.y1*o+E.y-u.padding)*Se+xe.point.y,De=(u.x2*o+E.x+u.padding)*Se+xe.point.x,Pe=(u.y2*o+E.y+u.padding)*Se+xe.point.y,Be=xe.perspectiveRatio<=.55||xe.occluded;return!this.isInsideGrid(ye,fe,De,Pe)||!C&&this.grid.hitTest(ye,fe,De,Pe,U)||Be?{box:[],offscreen:!1,occluded:xe.occluded}:{box:[ye,fe,De,Pe],offscreen:this.isOffscreen(ye,fe,De,Pe),occluded:!1}}placeCollisionCircles(t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y){const ne=[],ue=this.transform.elevation,ce=t.getProjection(),ae=t.elevationType==="road",Ee=!!ue||ae,xe=r.bV.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,ce),Se=new r.P(u.tileAnchorX,u.tileAnchorY),ye=new r.P(u.tileAnchorX,u.tileAnchorY);let{x:fe,y:De,z:Pe}=ce.projectTilePoint(ye.x,ye.y,Y.canonical),Be=null;if(Ee){const ei=ae?t.getElevationFeatureForText(g):null;Be={getElevation:xe,elevation:ue,elevationFeature:ei};const[Yt,Nt,Kt]=xe(Se,ue,ei);fe+=Yt,De+=Nt,Pe+=Kt}const He=ce.name==="globe",Ve=this.projectAndGetPerspectiveRatio(C,fe,De,Pe,Y,He||!!ue||this.transform.pitch>0,ce),{perspectiveRatio:Qe}=Ve,ct=(N?E/Qe:E*Qe)/r.bY,$e=za(fe,De,Pe,P),Oe=u.lineOffsetX*ct,nt=u.lineOffsetY*ct,Ze=r.an(t.layers[0].layout.get("text-max-angle")),lt=Math.cos(Ze),St=Ve.signedDistanceFromCamera>0?Hp(ct,b,Oe,nt,ae&&u.flipState===1,$e,ye,u,v,P,{},Ee&&!N?Be:null,N&&Ee,ce,Y,N,lt):null;let kt=!1,Ct=!1,Et=!0;if(St&&!Ve.occluded){const ei=.5*X*Qe+Z,Yt=new r.P(-100,-100),Nt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Kt=new Pa,{first:ai,last:_i}=St,Pi=ai.path.length;let Zi=[];for(let Ti=Pi-1;Ti>=1;Ti--)Zi.push(ai.path[Ti]);for(let Ti=1;Ti<_i.path.length;Ti++)Zi.push(_i.path[Ti]);const yi=2.5*ei;z&&(Zi=Zi.map(([Ti,dn,an],wn)=>(Ee&&!He&&(an=xe(wn<Pi-1?ai.tilePath[Pi-1-wn]:_i.tilePath[wn-Pi+2],ue,Be.elevationFeature)[2]),za(Ti,dn,an,z))),Zi.some(Ti=>Ti[3]<=0)&&(Zi=[]));let zi=[];if(Zi.length>0){let Ti=1/0,dn=-1/0,an=1/0,wn=-1/0;for(const tn of Zi)Ti=Math.min(Ti,tn[0]),an=Math.min(an,tn[1]),dn=Math.max(dn,tn[0]),wn=Math.max(wn,tn[1]);dn>=Yt.x&&Ti<=Nt.x&&wn>=Yt.y&&an<=Nt.y&&(zi=[Zi.map(tn=>new r.P(tn[0],tn[1]))],(Ti<Yt.x||dn>Nt.x||an<Yt.y||wn>Nt.y)&&(zi=r.bW(zi,Yt.x,Yt.y,Nt.x,Nt.y)))}for(const Ti of zi){Kt.reset(Ti,.25*ei);let dn=0;dn=Kt.length<=.5*ei?1:Math.ceil(Kt.paddedLength/yi)+1;for(let an=0;an<dn;an++){const wn=an/Math.max(dn-1,1),tn=Kt.lerp(wn),Li=tn.x+Do,un=tn.y+Do;ne.push(Li,un,ei,0);const Xn=Li-ei,Tn=un-ei,pn=Li+ei,Di=un+ei;if(Et=Et&&this.isOffscreen(Xn,Tn,pn,Di),Ct=Ct||this.isInsideGrid(Xn,Tn,pn,Di),!o&&this.grid.hitTestCircle(Li,un,ei,V)&&(kt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:kt,occluded:!1}}}}return{circles:!U&&kt||!Ct?[]:ne,offscreen:Et,collisionDetected:kt,occluded:Ve.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,g=1/0,v=-1/0,b=-1/0;for(const z of t){const U=new r.P(z.x+Do,z.y+Do);u=Math.min(u,U.x),g=Math.min(g,U.y),v=Math.max(v,U.x),b=Math.max(b,U.y),o.push(U)}const E=this.grid.query(u,g,v,b).concat(this.ignoredGrid.query(u,g,v,b)),C={},P={};for(const z of E){const U=z.key;if(C[U.bucketInstanceId]===void 0&&(C[U.bucketInstanceId]={}),C[U.bucketInstanceId][U.featureIndex])continue;const N=[new r.P(z.x1,z.y1),new r.P(z.x2,z.y1),new r.P(z.x2,z.y2),new r.P(z.x1,z.y2)];r.bX(o,N)&&(C[U.bucketInstanceId][U.featureIndex]=!0,P[U.bucketInstanceId]===void 0&&(P[U.bucketInstanceId]=[]),P[U.bucketInstanceId].push(U.featureIndex))}return P}insertCollisionBox(t,o,u,g,v){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:g,collisionGroupID:v},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,u,g,v){const b=o?this.ignoredGrid:this.grid,E={bucketInstanceId:u,featureIndex:g,collisionGroupID:v};for(let C=0;C<t.length;C+=4)b.insertCircle(E,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,o,u,g,v,b,E){const C=[o,u,g,1];let P=!1;g||this.transform.pitch>0?(r.aC(C,C,t),this.fogState&&v&&E.name!=="globe"&&(P=(function(N,V,X,Z,Y,ne){const ue=ne.calculateFogTileMatrix(Y),ce=[V,X,Z];return r.af(ce,ce,ue),oi(N,r.ag(ce),ne.pitch,ne._fov)})(this.fogState,o,u,g,v.toUnwrapped(),this.transform)>.9)):Sf(C,C,t);const z=C[3];return{point:new r.P((C[0]/z+1)/2*this.transform.width+Do,(-C[1]/z+1)/2*this.transform.height+Do),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/z*.5,1.5),signedDistanceFromCamera:z,occluded:b&&C[2]>z||P}}isOffscreen(t,o,u,g){return u<Do||t>=this.screenRightBoundary||g<Do||o>this.screenBottomBoundary}isInsideGrid(t,o,u,g){return u>=0&&t<this.gridRightBoundary&&g>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=r.bA([]);return r.br(t,t,[-100,-100,0]),t}}class _n{constructor(t,o,u,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):g&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class fn{constructor(t,o,u,g,v,b=!1){this.text=new _n(t?t.text:null,o,u,v),this.icon=new _n(t?t.icon:null,o,g,v),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class vo{constructor(t,o,u,g=!1){this.text=t,this.icon=o,this.skipFade=u,this.clipped=g}}class ch{constructor(){this.invProjMatrix=r.bC(),this.viewportMatrix=r.bC(),this.circles=[]}}class An{constructor(t,o,u,g,v){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=g,this.tileID=v}}class Ef{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[t]}}function uh(c,t,o,u,g){const{horizontalAlign:v,verticalAlign:b}=r.c1(c),E=-(v-.5)*t,C=-(b-.5)*o,P=r.c2(c,u);return new r.P(E+P[0]*g,C+P[1]*g)}function cu(c,t,o,u,g){const v=new r.P(c,t);return o&&v._rotate(u?g:-g),v}class oo{constructor(t,o,u,g,v,b){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new ri(this.transform,v),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Ef(u),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,o,u,g,v=1){const b=u.getBucket(o),E=u.latestFeatureIndex;if(!b||!E||o.fqid!==b.layerIds[0])return;const C=b.layers[0].layout,P=b.layers[0].paint,z=u.collisionBoxArray,U=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),N=u.tileSize/r.al,V=u.tileID.toUnwrapped();this.transform.setProjection(b.projection);const X=(Z=u.tileID,Y=b.getProjection(),ne=this.transform,Y.name===this.projection?ne.calculateProjMatrix(Z.toUnwrapped()):ah(ne,Y,Z));var Z,Y,ne;const ue=C.get("text-pitch-alignment")==="map",ce=C.get("text-rotation-alignment")==="map";o.compileFilter(o.options);const ae=o.dynamicFilter(),Ee=o.dynamicFilterNeedsFeature(),xe=this.transform.calculatePixelsToTileUnitsMatrix(u),Se=$l(X,u.tileID.canonical,ue,ce,this.transform,b.getProjection(),xe);let ye=null;const fe=b.getProjection().createInversionMatrix(this.transform,u.tileID.canonical);if(ue){const Oe=so(X,u.tileID.canonical,ue,ce,this.transform,b.getProjection(),xe);ye=r.aB([],this.transform.labelPlaneMatrix,Oe)}let De=null;ae&&u.latestFeatureIndex&&(De={unwrappedTileID:V,dynamicFilter:ae,dynamicFilterNeedsFeature:Ee}),this.retainedQueryData[b.bucketInstanceId]=new An(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,u.tileID);const[Pe,Be]=b.layers[0].layout.get("text-size-scale-range"),He=r.aA(v,Pe,Be),[Ve,Qe]=C.get("icon-size-scale-range"),ct=r.aA(v,Ve,Qe),$e={bucket:b,layout:C,paint:P,posMatrix:X,invMatrix:fe,mercatorCenter:[r.aF(this.transform.center.lng),r.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Se,labelToScreenMatrix:ye,clippingData:De,scale:U,textPixelRatio:N,holdingForFade:u.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:r.bK(b.textSizeData,this.transform.zoom,He),partiallyEvaluatedIconSize:r.bK(b.iconSizeData,this.transform.zoom,ct),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(g)for(const Oe of b.sortKeyRanges){const{sortKey:nt,symbolInstanceStart:Ze,symbolInstanceEnd:lt}=Oe;t.push({sortKey:nt,symbolInstanceStart:Ze,symbolInstanceEnd:lt,parameters:$e})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:$e})}attemptAnchorPlacement(t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y,ne,ue,ce,ae,Ee){const{textOffset0:xe,textOffset1:Se,crossTileID:ye}=Z,fe=[xe,Se],De=uh(t,b,E,fe,C),Pe=this.collisionIndex.placeCollisionBox(ne,C,o,u,g,v,cu(De.x,De.y,P,z,this.transform.angle),X,U,N,V.predicate);if(ce){const Be=ne.getSymbolInstanceIconSize(Ee,this.transform.zoom,Z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ne,Be,ce,u,g,v,cu(De.x,De.y,P,z,this.transform.angle),X,U,N,V.predicate).box.length===0)return}if(Pe.box.length>0){let Be;return this.prevPlacement&&this.prevPlacement.variableOffsets[ye]&&this.prevPlacement.placements[ye]&&this.prevPlacement.placements[ye].text&&(Be=this.prevPlacement.variableOffsets[ye].anchor),this.variableOffsets[ye]={textOffset:fe,width:b,height:E,anchor:t,textScale:C,prevAnchor:Be},this.markUsedJustification(ne,t,Z,ue),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,ue,Z),this.placedOrientations[ye]=ue),{shift:De,placedGlyphBoxes:Pe}}}placeLayerBucketPart(t,o,u,g,v=1){const{bucket:b,layout:E,paint:C,posMatrix:P,textLabelPlaneMatrix:z,labelToScreenMatrix:U,clippingData:N,textPixelRatio:V,mercatorCenter:X,invMatrix:Z,holdingForFade:Y,collisionBoxArray:ne,partiallyEvaluatedTextSize:ue,partiallyEvaluatedIconSize:ce,collisionGroup:ae,latestFeatureIndex:Ee}=t.parameters,xe=E.get("text-optional"),Se=E.get("icon-optional"),ye=E.get("text-allow-overlap"),fe=E.get("icon-allow-overlap"),De=E.get("text-rotation-alignment")==="map",Pe=E.get("icon-rotation-alignment")==="map",Be=E.get("text-pitch-alignment")==="map",He=C.get("symbol-z-offset"),Ve=E.get("symbol-elevation-reference")==="sea",Qe=E.get("symbol-placement"),[ct,$e]=E.get("text-size-scale-range"),[Oe,nt]=E.get("icon-size-scale-range"),Ze=r.aA(v,ct,$e),lt=r.aA(v,Oe,nt),St=E.get("text-variable-anchor"),kt=De&&Qe!=="point",Ct=Pe&&Qe!=="point",Et=St&&b.hasTextData(),ei=b.hasIconTextFit()&&Et&&b.hasIconData();this.transform.setProjection(b.projection);const Yt=Et||kt,Nt=Ct||ei;let Kt=ye&&(fe||!b.hasIconData()||Se),ai=fe&&(ye||!b.hasTextData()||xe);const _i=!He.isConstant();!b.collisionArrays&&ne&&b.deserializeCollisionBoxes(ne),u&&g&&b.updateCollisionDebugBuffers(this.transform.zoom,ne,Ze,lt);const Pi=(yi,zi,Ti)=>{const{crossTileID:dn,numVerticalGlyphVertices:an}=yi;let wn=null;if(N&&N.dynamicFilterNeedsFeature||_i){const rr=this.retainedQueryData[b.bucketInstanceId];wn=Ee.loadFeature({featureIndex:yi.featureIndex,bucketIndex:rr.bucketIndex,sourceLayerIndex:rr.sourceLayerIndex,layoutVertexArrayOffset:0});const Dr=wn.properties?wn.properties.worldview:null;if(b.localizable&&b.worldview&&typeof Dr=="string")if(Dr==="all")wn.properties.$localized=!0;else{if(!Dr.split(",").includes(b.worldview))return;wn.properties.$localized=!0,wn.properties.worldview=b.worldview}}if(N&&!(0,N.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:b.worldview},wn,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new r.P(yi.tileAnchorX,yi.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[dn]=new vo(!1,!1,!1,!0),void o.add(dn);const tn=He.evaluate(wn,{});if(o.has(dn))return;if(Y)return void(this.placements[dn]=new vo(!1,!1,!1));let Li=!1,un=!1,Xn=!0,Tn=!1,pn=!1,Di=null,ki={box:null,offscreen:null,occluded:null},Bn={box:null},dr=null,Rn=null,Fn=null,Xs=0,Rs=0,as=0;Ti.textFeatureIndex?Xs=Ti.textFeatureIndex:yi.useRuntimeCollisionCircles&&(Xs=yi.featureIndex),Ti.verticalTextFeatureIndex&&(Rs=Ti.verticalTextFeatureIndex);const mn=b.elevationFeatures?b.elevationFeatures[yi.elevationFeatureIndex]:void 0,No=rr=>{rr.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Dr=this.transform.elevation;rr.elevation=Ve?tn:tn+r.bV.getAtTileOffset(rr.tileID,new r.P(rr.tileAnchorX,rr.tileAnchorY),Dr,mn),rr.elevation+=yi.zOffset},Ms=Ti.textBox;if(Ms){No(Ms);const rr=Vn=>{let kr=r.bL.horizontal;if(b.allowVerticalPlacement&&!Vn&&this.prevPlacement){const is=this.prevPlacement.placedOrientations[dn];is&&(this.placedOrientations[dn]=is,kr=is,this.markUsedOrientation(b,kr,yi))}return kr},Dr=(Vn,kr)=>{if(b.allowVerticalPlacement&&an>0&&Ti.verticalTextBox){for(const is of b.writingModes)if(is===r.bL.vertical?(ki=kr(),Bn=ki):ki=Vn(),ki&&ki.box&&ki.box.length)break}else ki=Vn()};if(St){let Vn=St;if(this.prevPlacement&&this.prevPlacement.variableOffsets[dn]){const lr=this.prevPlacement.variableOffsets[dn];Vn.indexOf(lr.anchor)>0&&(Vn=Vn.filter(jo=>jo!==lr.anchor),Vn.unshift(lr.anchor))}const kr=(lr,jo,$h)=>{const cl=b.getSymbolInstanceTextSize(ue,yi,this.transform.zoom,zi),ju=(lr.x2-lr.x1)*cl+2*lr.padding,Uu=(lr.y2-lr.y1)*cl+2*lr.padding,Uo=yi.hasIconTextFit&&!fe?jo:null;Uo&&No(Uo);let ba={box:[],offscreen:!1,occluded:!1};const ul=ye?2*Vn.length:Vn.length;for(let la=0;la<ul;++la){const Hn=this.attemptAnchorPlacement(Vn[la%Vn.length],lr,X,Z,Yt,ju,Uu,cl,De,Be,V,P,ae,la>=Vn.length,yi,zi,b,$h,Uo,ue,ce);if(Hn&&(ba=Hn.placedGlyphBoxes,ba&&ba.box&&ba.box.length)){Li=!0,Di=Hn.shift;break}}return ba};Dr(()=>kr(Ms,Ti.iconBox,r.bL.horizontal),()=>{const lr=Ti.verticalTextBox;return lr&&No(lr),b.allowVerticalPlacement&&!(ki&&ki.box&&ki.box.length)&&an>0&&lr?kr(lr,Ti.verticalIconBox,r.bL.vertical):{box:null,offscreen:null,occluded:null}}),ki&&(Li=ki.box,Xn=ki.offscreen,Tn=ki.occluded);const is=rr(!(!ki||!ki.box));if(!Li&&this.prevPlacement){const lr=this.prevPlacement.variableOffsets[dn];lr&&(this.variableOffsets[dn]=lr,this.markUsedJustification(b,lr.anchor,yi,is))}}else{const Vn=(kr,is)=>{const lr=b.getSymbolInstanceTextSize(ue,yi,this.transform.zoom,zi),jo=this.collisionIndex.placeCollisionBox(b,lr,kr,X,Z,Yt,new r.P(0,0),ye,V,P,ae.predicate);return jo&&jo.box&&jo.box.length&&(this.markUsedOrientation(b,is,yi),this.placedOrientations[dn]=is),jo};Dr(()=>Vn(Ms,r.bL.horizontal),()=>{const kr=Ti.verticalTextBox;return b.allowVerticalPlacement&&an>0&&kr?(No(kr),Vn(kr,r.bL.vertical)):{box:null,offscreen:null,occluded:null}}),rr(!!(ki&&ki.box&&ki.box.length))}}if(dr=ki,Li=dr&&dr.box&&dr.box.length>0,Xn=dr&&dr.offscreen,Tn=dr&&dr.occluded,yi.useRuntimeCollisionCircles){const rr=yi.centerJustifiedTextSymbolIndex>=0?yi.centerJustifiedTextSymbolIndex:yi.verticalPlacedTextSymbolIndex,Dr=b.text.placedSymbolArray.get(rr),Vn=r.bM(b.textSizeData,ue,Dr),kr=E.get("text-padding");Rn=this.collisionIndex.placeCollisionCircles(b,ye,Dr,rr,b.lineVertexArray,b.glyphOffsetArray,Vn,P,z,U,u,Be,ae.predicate,yi.collisionCircleDiameter*Vn/r.bY,kr,this.retainedQueryData[b.bucketInstanceId].tileID),Li=ye||Rn.circles.length>0&&!Rn.collisionDetected,Xn=Xn&&Rn.offscreen,Tn=Rn.occluded}if(Ti.iconFeatureIndex&&(as=Ti.iconFeatureIndex),Ti.iconBox){const rr=Dr=>{No(Dr);const Vn=yi.hasIconTextFit&&Di?cu(Di.x,Di.y,De,Be,this.transform.angle):new r.P(0,0),kr=b.getSymbolInstanceIconSize(ce,this.transform.zoom,yi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,kr,Dr,X,Z,Nt,Vn,fe,V,P,ae.predicate)};Bn&&Bn.box&&Bn.box.length&&Ti.verticalIconBox?(Fn=rr(Ti.verticalIconBox),un=Fn.box.length>0):(Fn=rr(Ti.iconBox),un=Fn.box.length>0),Xn=Xn&&Fn.offscreen,pn=Fn.occluded}const Ys=xe||yi.numHorizontalGlyphVertices===0&&an===0,aa=Se||yi.numIconVertices===0;if(Ys||aa?aa?Ys||(un=un&&Li):Li=un&&Li:un=Li=un&&Li,Li&&dr&&dr.box&&this.collisionIndex.insertCollisionBox(dr.box,E.get("text-ignore-placement"),b.bucketInstanceId,Bn&&Bn.box&&Rs?Rs:Xs,ae.ID),un&&Fn&&this.collisionIndex.insertCollisionBox(Fn.box,E.get("icon-ignore-placement"),b.bucketInstanceId,as,ae.ID),Rn&&(Li&&this.collisionIndex.insertCollisionCircles(Rn.circles,E.get("text-ignore-placement"),b.bucketInstanceId,Xs,ae.ID),u)){const rr=b.bucketInstanceId;let Dr=this.collisionCircleArrays[rr];Dr===void 0&&(Dr=this.collisionCircleArrays[rr]=new ch);for(let Vn=0;Vn<Rn.circles.length;Vn+=4)Dr.circles.push(Rn.circles[Vn+0]),Dr.circles.push(Rn.circles[Vn+1]),Dr.circles.push(Rn.circles[Vn+2]),Dr.circles.push(Rn.collisionDetected?1:0)}const So=b.projection.name!=="globe";Kt=Kt&&(So||!Tn),ai=ai&&(So||!pn),this.placements[dn]=new vo(Li||Kt,un||ai,Xn||b.justReloaded),o.add(dn)},Zi=this.retainedQueryData[b.bucketInstanceId].tileID;if(b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,Zi),b.elevationType==="road"&&b.updateRoadElevation(Zi.canonical),b.updateZOffset(),b.sortFeaturesByY){const yi=b.getSortedSymbolIndexes(this.transform.angle);for(let zi=yi.length-1;zi>=0;--zi){const Ti=yi[zi];Pi(b.symbolInstances.get(Ti),Ti,b.collisionArrays[Ti])}b.hasAnyZOffset&&r.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){const yi=b.getSortedIndexesByZOffset();for(let zi=0;zi<yi.length;++zi){const Ti=yi[zi];Pi(b.symbolInstances.get(Ti),Ti,b.collisionArrays[Ti])}}else for(let yi=t.symbolInstanceStart;yi<t.symbolInstanceEnd;yi++)Pi(b.symbolInstances.get(yi),yi,b.collisionArrays[yi]);if(u&&b.bucketInstanceId in this.collisionCircleArrays){const yi=this.collisionCircleArrays[b.bucketInstanceId];r.bl(yi.invProjMatrix,P),yi.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(t,o,u,g){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:C,crossTileID:P}=u,z=r.c3(o),U=g===r.bL.vertical?C:z==="left"?v:z==="center"?b:z==="right"?E:-1;v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=U>=0&&v!==U?0:P),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=U>=0&&b!==U?0:P),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=U>=0&&E!==U?0:P),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:P)}markUsedOrientation(t,o,u){const g=o===r.bL.horizontal||o===r.bL.horizontalOnly?o:0,v=o===r.bL.vertical?o:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:P}=u,z=t.text.placedSymbolArray;b>=0&&(z.get(b).placedOrientation=g),E>=0&&(z.get(E).placedOrientation=g),C>=0&&(z.get(C).placedOrientation=g),P>=0&&(z.get(P).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const g=o?o.symbolFadeChange(t):1,v=o?o.opacities:{},b=o?o.variableOffsets:{},E=o?o.placedOrientations:{};for(const C in this.placements){const P=this.placements[C],z=v[C];z?(this.opacities[C]=new fn(z,g,P.text,P.icon,null,P.clipped),u=u||P.text!==z.text.placed||P.icon!==z.icon.placed):(this.opacities[C]=new fn(null,g,P.text,P.icon,P.skipFade,P.clipped),u=u||P.text||P.icon)}for(const C in v){const P=v[C];if(!this.opacities[C]){const z=new fn(P,g,!1,!1);z.isHidden()||(this.opacities[C]=z,u=u||P.text.placed||P.icon.placed)}}for(const C in b)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=b[C]);for(const C in E)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=E[C]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o,u,g){g&&(this.lastReplacementSourceUpdateTime=g.updateTime);const v=new Set;for(const b of o){const E=b.getBucket(t);E&&b.latestFeatureIndex&&t.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,v,b,b.collisionBoxArray,u,g,b.tileID,t.scope),E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,b.tileID),E.elevationType==="road"&&E.updateRoadElevation(b.tileID.canonical),E.updateZOffset())}}updateBucketOpacities(t,o,u,g,v,b,E,C){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const P=t.layers[0].layout,z=t.layers[0].paint,U=!!t.layers[0].dynamicFilter(),N=new fn(null,0,!1,!1,!0),V=P.get("text-allow-overlap"),X=P.get("icon-allow-overlap"),Z=P.get("text-variable-anchor"),Y=P.get("text-rotation-alignment")==="map",ne=P.get("text-pitch-alignment")==="map",ue=z.get("symbol-z-offset"),ce=P.get("symbol-elevation-reference")==="sea",ae=!ue.isConstant(),Ee=new fn(null,0,V&&(X||!t.hasIconData()||P.get("icon-optional")),X&&(V||!t.hasTextData()||P.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);const xe=(ye,fe,De)=>{for(let Pe=0;Pe<fe/4;Pe++)ye.opacityVertexArray.emplaceBack(De)};let Se=0;b&&t.updateReplacement(E,b);for(let ye=0;ye<t.symbolInstances.length;ye++){const fe=t.symbolInstances.get(ye),{numHorizontalGlyphVertices:De,numVerticalGlyphVertices:Pe,crossTileID:Be,numIconVertices:He,tileAnchorX:Ve,tileAnchorY:Qe}=fe;let ct=null;const $e=this.retainedQueryData[t.bucketInstanceId];ae&&fe&&$e&&(ct=u.latestFeatureIndex.loadFeature({featureIndex:fe.featureIndex,bucketIndex:$e.bucketIndex,sourceLayerIndex:$e.sourceLayerIndex,layoutVertexArrayOffset:0}));const Oe=ue.evaluate(ct,{}),nt=o.has(Be);let Ze=this.opacities[Be];nt?Ze=N:Ze||(Ze=Ee,this.opacities[Be]=Ze),o.add(Be);const lt=De>0||Pe>0,St=He>0,kt=this.placedOrientations[Be],Ct=kt===r.bL.vertical,Et=kt===r.bL.horizontal||kt===r.bL.horizontalOnly;!lt&&!St||Ze.isHidden()||Se++;let ei=!1;if((lt||St)&&b)for(const Yt of t.activeReplacements){if(r.bZ(Yt,v,r.b_.Symbol,C)||Yt.min.x>Ve||Ve>Yt.max.x||Yt.min.y>Qe||Qe>Yt.max.y)continue;const Nt=r.b$(Ve,Qe,E.canonical,Yt.footprintTileId.canonical);if(ei=r.c0(Nt,Yt.footprint),ei)break}if(lt){const Yt=ei?Cs:$s(Ze.text);xe(t.text,De,Ct?Cs:Yt),xe(t.text,Pe,Et?Cs:Yt);const Nt=Ze.text.isHidden(),{leftJustifiedTextSymbolIndex:Kt,centerJustifiedTextSymbolIndex:ai,rightJustifiedTextSymbolIndex:_i,verticalPlacedTextSymbolIndex:Pi}=fe,Zi=t.text.placedSymbolArray,yi=Nt||Ct?1:0;Kt>=0&&(Zi.get(Kt).hidden=yi),ai>=0&&(Zi.get(ai).hidden=yi),_i>=0&&(Zi.get(_i).hidden=yi),Pi>=0&&(Zi.get(Pi).hidden=Nt||Et?1:0);const zi=this.variableOffsets[Be];zi&&this.markUsedJustification(t,zi.anchor,fe,kt);const Ti=this.placedOrientations[Be];Ti&&(this.markUsedJustification(t,"left",fe,Ti),this.markUsedOrientation(t,Ti,fe))}if(St){const Yt=ei?Cs:$s(Ze.icon),{placedIconSymbolIndex:Nt,verticalPlacedIconSymbolIndex:Kt}=fe,ai=t.icon.placedSymbolArray,_i=Ze.icon.isHidden()?1:0;Nt>=0&&(xe(t.icon,He,Ct?Cs:Yt),ai.get(Nt).hidden=_i),Kt>=0&&(xe(t.icon,fe.numVerticalIconVertices,Et?Cs:Yt),ai.get(Kt).hidden=_i)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Yt=t.collisionArrays[ye];if(Yt){let Nt=new r.P(0,0),Kt=!0;if(Yt.textBox||Yt.verticalTextBox){if(Z){const _i=this.variableOffsets[Be];_i?(Nt=uh(_i.anchor,_i.width,_i.height,_i.textOffset,_i.textScale),Y&&Nt._rotate(ne?this.transform.angle:-this.transform.angle)):Kt=!1}U&&(Kt=!Ze.clipped),Yt.textBox&&Or(t.textCollisionBox.collisionVertexArray,Ze.text.placed,!Kt||Ct,Oe,ce,Nt.x,Nt.y),Yt.verticalTextBox&&Or(t.textCollisionBox.collisionVertexArray,Ze.text.placed,!Kt||Et,Oe,ce,Nt.x,Nt.y)}const ai=Kt&&!!(!Et&&Yt.verticalIconBox);Yt.iconBox&&Or(t.iconCollisionBox.collisionVertexArray,Ze.icon.placed,ai,Oe,ce,fe.hasIconTextFit?Nt.x:0,fe.hasIconTextFit?Nt.y:0),Yt.verticalIconBox&&Or(t.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!ai,Oe,ce,fe.hasIconTextFit?Nt.x:0,fe.hasIconTextFit?Nt.y:0)}}}if(t.fullyClipped=Se===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ye.invProjMatrix,t.placementViewportMatrix=ye.viewportMatrix,t.collisionCircleArray=ye.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>t}isStale(){return this.stale}setStale(){this.stale=!0}}function Or(c,t,o,u,g,v,b){c.emplaceBack(t?1:0,o?1:0,v||0,b||0,u,g?1:0),c.emplaceBack(t?1:0,o?1:0,v||0,b||0,u,g?1:0),c.emplaceBack(t?1:0,o?1:0,v||0,b||0,u,g?1:0),c.emplaceBack(t?1:0,o?1:0,v||0,b||0,u,g?1:0)}const Wp=Math.pow(2,25),Zl=Math.pow(2,24),Xp=Math.pow(2,17),hh=Math.pow(2,16),md=Math.pow(2,9),Af=Math.pow(2,8),gd=Math.pow(2,1);function $s(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,o=Math.floor(127*c.opacity);return o*Wp+t*Zl+o*Xp+t*hh+o*md+t*Af+o*gd+t}const Cs=0;class Oo{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,o,u,g,v,b){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(E,g,t[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,P)=>C.sortKey-P.sortKey));this._currentPartIndex<E.length;){const C=E[this._currentPartIndex];if(o.placeLayerBucketPart(C,this._seenCrossTileIDs,u,C.symbolInstanceStart===0,b),this._currentPartIndex++,v())return!0}return!1}}class Yp{startNewPlacement(t,o,u,g,v,b,E,C){return this.placement=new oo(t,g,v,b,E,C),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=!1,this._showCollisionBoxes=u,this._fadeDuration=g,this._done=!1,this._inProgressLayer=null,this}requestFullPlacement(){this._forceFullPlacement=!0}isFullPlacementRequested(){return this._forceFullPlacement}setStale(){this.placement&&(this.placement.stale=!0)}isStale(){return!!this.placement&&this.placement.stale}isDone(){return this._done}continuePlacement(t,o,u,g,v){const b=r.o.now(),E=()=>{const C=r.o.now()-b;return!this.isFullPlacementRequested()&&this._fadeDuration!==0&&C>2};for(;this._currentPlacementIndex>=0;){const C=o[t[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&C.visibility!=="none"&&(!C.minzoom||C.minzoom<=P)&&(!C.maxzoom||C.maxzoom>P)){const z=C,U=z.layout.get("symbol-z-elevate"),N=z.layout.get("symbol-sort-key").constantOr(1)!==void 0,V=z.layout.get("symbol-z-order"),X=V==="viewport-y"||V==="auto"&&!(V!=="viewport-y"&&N),Z=z.layout.get("text-allow-overlap")||z.layout.get("icon-allow-overlap")||z.layout.get("text-ignore-placement")||z.layout.get("icon-ignore-placement"),Y=X&&Z,ne=this._inProgressLayer=this._inProgressLayer||new Oo(z),ue=r.B(C.source,C.scope);if(ne.continuePlacement(U||Y?g[ue]:u[ue],this.placement,this._showCollisionBoxes,C,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._forceFullPlacement=!1,this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Rc=512/r.al/2;class ts{constructor(t,o,u){this.tileID=t,this.bucketInstanceId=u,this.index=new r.c4(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=t.canonical.x*r.al,v=t.canonical.y*r.al;for(let b=0;b<o.length;b++){const{key:E,crossTileID:C,tileAnchorX:P,tileAnchorY:z}=o.get(b),U=Math.floor((g+P)*Rc),N=Math.floor((v+z)*Rc);this.index.add(U,N),this.keys.push(E),this.crossTileIDs.push(C)}this.index.finish()}findMatches(t,o,u){const g=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),v=Rc/Math.pow(2,o.canonical.z-this.tileID.canonical.z),b=o.canonical.x*r.al,E=o.canonical.y*r.al;for(let C=0;C<t.length;C++){const P=t.get(C);if(P.crossTileID)continue;const{key:z,tileAnchorX:U,tileAnchorY:N}=P,V=Math.floor((b+U)*v),X=Math.floor((E+N)*v),Z=this.index.range(V-g,X-g,V+g,X+g).sort((Y,ne)=>Y-ne);for(const Y of Z){const ne=this.crossTileIDs[Y];if(this.keys[Y]===z&&!u.has(ne)){u.add(ne),P.crossTileID=ne;break}}}}}class $a{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const u in this.indexes){const g=this.indexes[u],v={};for(const b in g){const E=g[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+o),v[E.tileID.key]=E}this.indexes[u]=v}this.lng=t}addBucket(t,o,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<o.symbolInstances.length;v++)o.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const g=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const b=this.indexes[v];if(Number(v)>t.overscaledZ)for(const E in b){const C=b[E];C.tileID.isChildOf(t)&&C.findMatches(o.symbolInstances,t,g)}else{const E=b[t.scaledTo(Number(v)).key];E&&E.findMatches(o.symbolInstances,t,g)}}for(let v=0;v<o.symbolInstances.length;v++){const b=o.symbolInstances.get(v);b.crossTileID||(b.crossTileID=u.generate(),g.add(b.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ts(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const u of o.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let o=!1;for(const u in this.indexes){const g=this.indexes[u];for(const v in g)t[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,g[v]),delete g[v],o=!0)}return o}}class Pr{constructor(){this.layerIndexes={},this.crossTileIDs=new $a,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,u,g){let v=this.layerIndexes[t.fqid];v===void 0&&(v=this.layerIndexes[t.fqid]=new fa);let b=!1;const E={};g.name!=="globe"&&v.handleWrapJump(u);for(const C of o){const P=C.getBucket(t);P&&t.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(C.tileID,P,this.crossTileIDs)&&(b=!0),E[P.bucketInstanceId]=!0)}return v.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(t){const o={};t.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const Mc=771;class wi{constructor(t,o,u,g){this.blendFunction=t,this.blendColor=o.toNonPremultipliedRenderColor(null),this.mask=u,this.blendEquation=g}}wi.Replace=[1,0,1,0],wi.disabled=new wi(wi.Replace,r.ao.transparent,[!1,!1,!1,!1]),wi.unblended=new wi(wi.Replace,r.ao.transparent,[!0,!0,!0,!0]),wi.alphaBlended=new wi([1,Mc,1,Mc],r.ao.transparent,[!0,!0,!0,!0]),wi.alphaBlendedNonPremultiplied=new wi([770,Mc,770,Mc],r.ao.transparent,[!0,!0,!0,!0]),wi.multiply=new wi([774,0,774,0],r.ao.transparent,[!0,!0,!0,!0]),wi.additive=new wi([1,1,1,1],r.ao.transparent,[!0,!0,!0,!0]);class ii{constructor(t,o,u){this.func=t,this.mask=o,this.range=u}}ii.ReadOnly=!1,ii.ReadWrite=!0,ii.disabled=new ii(519,ii.ReadOnly,[0,1]);const uu=7680;class xi{constructor(t,o,u,g,v,b){this.test=t,this.ref=o,this.mask=u,this.fail=g,this.depthFail=v,this.pass=b}}xi.disabled=new xi({func:519,mask:0},0,0,uu,uu,uu);const dh=1029,fh=2305;class gi{constructor(t,o,u){this.enable=t,this.mode=o,this.frontFace=u}}function Cf(c,t){const o=r.ca(c,3);r.cc(c,t),r.cg(c,3,o)}function Kp(c,t){const o=r.c7([]);return r.c8(o,o,-t),r.c9(o,o,-c),o}function bl(c,t){const o=[c[0],c[1],0],u=[t[0],t[1],0];if(r.ag(o)>=1e-15){const b=r.aw([],o);r.c5(u,b,r.bJ(u,b)),t[0]=u[0],t[1]=u[1]}const g=r.bI([],t,c);if(r.c6(g)<1e-15)return null;const v=Math.atan2(-g[1],g[0]);return Kp(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),v)}gi.disabled=new gi(!1,dh,fh),gi.backCCW=new gi(!0,dh,fh),gi.backCW=new gi(!0,dh,2304),gi.frontCW=new gi(!0,1028,2304),gi.frontCCW=new gi(!0,1028,fh);class wg{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){const o=t instanceof r.ae?t:new r.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=r.bT(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o,u){if(this.orientation=null,!this.position)return;const g=this.position,v=u||(this._elevation?this._elevation.getAtPointOrZero(r.ae.fromLngLat(t)):0),b=r.ae.fromLngLat(t,v),E=[b.x-g.x,b.y-g.y,b.z-g.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=bl(E,o)}setPitchBearing(t,o){this.orientation=Kp(r.an(t),r.an(-o))}}class ph{constructor(t,o){this._transform=r.bA([]),this.orientation=o,this.position=t}get mercatorPosition(){const t=this.position;return new r.ae(t[0],t[1],t[2])}get position(){const t=r.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&r.cg(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.c7([]),t&&Cf(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=Kp(t,o),Cf(this._transform,this._orientation)}forward(){const t=r.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){const u=new Float64Array(16);return r.bl(u,this.getWorldToCamera(t,o)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,o,u){const g=this.position;r.c5(g,g,-t);const v=new Float64Array(16);return r.bq(v,[u,u,u]),r.br(v,v,g),v[10]*=o,v}getWorldToCamera(t,o){const u=new Float64Array(16),g=new Float64Array(4),v=this.position;return r.cb(g,this._orientation),r.c5(v,v,-t),r.cc(u,g),r.br(u,u,v),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=o,u[9]*=o,u[10]*=o,u[11]*=o,u}getCameraToClipPerspective(t,o,u,g){const v=new Float64Array(16);return r.cd(v,t,o,u,g),v}getCameraToClipOrthographic(t,o,u,g,v,b){const E=new Float64Array(16);return r.ce(E,t,o,u,g,v,b),E}getDistanceToElevation(t,o=!1){const u=t===0?0:r.cf(t,o?r.a$(this.position[1]):this.position[1]),g=this.forward();return(u-this.position[2])/g[2]}clone(){return new ph([...this.position],[...this.orientation])}}const Po=(c,t)=>({u_matrix:c,u_ground_shadow_factor:t});class zo{constructor(t=0,o=0,u=0,g=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=u,this.right=g}interpolate(t,o,u){return o.top!=null&&t.top!=null&&(this.top=r.ak(t.top,o.top,u)),o.bottom!=null&&t.bottom!=null&&(this.bottom=r.ak(t.bottom,o.bottom,u)),o.left!=null&&t.left!=null&&(this.left=r.ak(t.left,o.left,u)),o.right!=null&&t.right!=null&&(this.right=r.ak(t.right,o.right,u)),this}getCenter(t,o){const u=r.aA((this.left+t-this.right)/2,0,t),g=r.aA((this.top+o-this.bottom)/2,0,o);return new r.P(u,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new zo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ea=15;class _d{constructor(t,o,u,g,v,b,E){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=g??60,this.setProjection(b),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new r.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new zo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ph,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new _d(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ea}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,o=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return r.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=r.cm(this.projectionOptions);const u=this.getProjection(),g=!r.by(o,u);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.cm({name:"mercator"});const o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const o=-t*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=r.cn(),r.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=r.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let g=0,v=0;for(let b=0;b<o.length;b++){const E=new r.P(o[b][0]*this.width,u+o[b][1]*(this.height-u)),C=t.pointCoordinate(E);if(!C)continue;const P=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);g+=C[3]*P,v+=P}return v===0?NaN:g/v}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*o,g=this._mercatorZfromZoom(t),v=this._mercatorZfromZoom(this._maxZoom),b=Math.max(g-u,v);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}equals(t){const o=this.elevation,u=t.elevation,g=o!=null!=(u!=null)||o&&u&&o.exaggeration()!==u.exaggeration();return this.width===t.width&&this.height===t.height&&this.center.lng===t.center.lng&&this.center.lat===t.center.lat&&this.zoom===t.zoom&&this.bearing===t.bearing&&this.pitch===t.pitch&&this.fov===t.fov&&this.projection.name===t.projection.name&&this._edgeInsets.equals(t.padding)&&!g}computeZoomRelativeTo(t){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];const g=r.ag(r.av([],this._camera.position,u));return r.aA(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!r.cp(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];r.cq(u,this._camera.position)||(this._setCameraPosition(u),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,o=new wg;return o.position=new r.ae(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!r.cr(t))return!1;r.cs(t,t);const o=r.ct([],[0,0,-1],t),u=r.ct([],[0,-1,0],t);if(u[2]<0)return!1;const g=bl(o,u);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(t){const o=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;t[2]=r.aA(t[2],g/u,g/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,u){this._unmodified=!1,this._edgeInsets.interpolate(t,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new r.cu(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new r.P(0,0)),g=this.pointCoordinate(new r.P(this.width,0)),v=this.pointCoordinate(new r.P(this.width,this.height)),b=this.pointCoordinate(new r.P(0,this.height)),E=Math.floor(Math.min(u.x,g.x,v.x,b.x)),C=Math.floor(Math.max(u.x,g.x,v.x,b.x)),P=1;for(let z=E-P;z<=C+P;z++)z!==0&&o.push(new r.cu(z,t))}return o}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,o,u,g){let v=[];const b=u!=null,E=!b;if(E&&this.zoom<o||b&&u[0]===0&&u[1]===0)return v;const C=new Set,P=(U,N,V,X,Z)=>{const Y=r.cY(N,U,V,X,Z);C.has(Y)||(v.push(new r.aQ(U,N,V,X,Z)),C.add(Y))};for(let U=0;U<t.length;U++){const N=t[U];if(E&&N.canonical.z!==o||b&&g!==void 0&&g>N.canonical.z)continue;const V=N.canonical,X=N.overscaledZ,Z=N.wrap,Y=1<<V.z,ne=V.x+1<Y,ue=V.x>0,ce=V.y+1<Y,ae=V.y>0,Ee=N.wrap-(ue?0:1),xe=N.wrap+(ne?0:1),Se=ue?V.x-1:Y-1,ye=ne?V.x+1:0;if(b)u[0]<0?(P(X,xe,V.z,ye,V.y),u[1]<0&&ce&&(P(X,Z,V.z,V.x,V.y+1),P(X,xe,V.z,ye,V.y+1)),u[1]>0&&ae&&(P(X,Z,V.z,V.x,V.y-1),P(X,xe,V.z,ye,V.y-1))):u[0]>0?(P(X,Ee,V.z,Se,V.y),u[1]<0&&ce&&(P(X,Z,V.z,V.x,V.y+1),P(X,Ee,V.z,Se,V.y+1)),u[1]>0&&ae&&(P(X,Z,V.z,V.x,V.y-1),P(X,Ee,V.z,Se,V.y-1))):u[1]<0&&ce?P(X,Z,V.z,V.x,V.y+1):ae&&P(X,Z,V.z,V.x,V.y-1);else{const fe=N.visibleQuadrants;1&fe&&(P(X,Ee,V.z,Se,V.y),ae&&(P(X,Z,V.z,V.x,V.y-1),P(X,Ee,V.z,Se,V.y-1))),2&fe&&(P(X,xe,V.z,ye,V.y),ae&&(P(X,Z,V.z,V.x,V.y-1),P(X,xe,V.z,ye,V.y-1))),4&fe&&(P(X,Ee,V.z,Se,V.y),ce&&(P(X,Z,V.z,V.x,V.y+1),P(X,Ee,V.z,Se,V.y+1))),8&fe&&(P(X,xe,V.z,ye,V.y),ce&&(P(X,Z,V.z,V.x,V.y+1),P(X,xe,V.z,ye,V.y+1)))}}const z=[];for(const U of v)v.some(N=>U.isChildOf(N))||z.push(U);if(v=z.filter(U=>!t.some(N=>!!(U.overscaledZ<o&&N.isChildOf(U))||U.equals(N)||U.isChildOf(N))),E){const U=1<<o,N=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=[U*N.x,U*N.y],X=4,Z=X*X;v=v.filter(Y=>{const ne=Y.canonical.x+.5-V[0],ue=Y.canonical.y+.5-V[1];return ne*ne+ue*ue<Z})}return v}extendTileCoverToNearPlane(t,o,u){const g=[],v=new Set;for(const ue of t)v.add(ue.key);const b=(ue,ce,ae,Ee,xe)=>{const Se=r.cY(ce,ue,ae,Ee,xe);v.has(Se)||(g.push(new r.aQ(ue,ce,ae,Ee,xe)),v.add(Se))},E=t.reduce((ue,ce)=>Math.max(ue,ce.overscaledZ),u),C=1<<u,P=[new r.P(0,0),new r.P(r.al,0),new r.P(r.al,r.al),new r.P(0,r.al)],z=new r.P(0,0),U=new r.P(0,0),N=(ue,ce)=>{const ae=Math.floor(ue[0]),Ee=Math.floor(ue[1]),xe=(ue[0]-ae)*r.al,Se=(ue[1]-Ee)*r.al,ye=Math.floor(ce[0]),fe=Math.floor(ce[1]),De=(ce[0]-ye)*r.al,Pe=(ce[1]-fe)*r.al;for(let Be=-1;Be<=1;Be++){const He=ae+Be;if(!(He<0||He>=C)){z.x=xe-Be*r.al,U.x=De-(He-ye)*r.al;for(let Ve=-1;Ve<=1;Ve++){const Qe=Ee+Ve;z.y=Se-Ve*r.al,U.y=Pe-(Qe-fe)*r.al,r.cZ(z,U,P)&&b(E,0,u,He,Qe)}}}},V=o.points,X=V[r.cv],Z=V[r.cw],Y=this._projectToGround(X,V[r.cx]),ne=this._projectToGround(Z,V[r.cy]);return N(X,Y),N(Z,ne),g}_projectToGround(t,o){return r.cz(r.cA(),t,o,t[2]/(t[2]-o[2]))}coveringTiles(t){let o=this.coveringZoomLevel(t);const u=o,g=this.elevation&&this.elevation.exaggeration(),v=g&&!t.isTerrainDEM,b=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);const E=this.locationCoordinate(this.center),C=this.center.lat,P=1<<o,z=[P*E.x,P*E.y,0],U=this.projection.name==="globe",N=!U,V=r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,N),X=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=P*r.cf(1,this.center.lat),Y=this._camera.position[2]/r.cf(1,this.center.lat),ne=[P*X.x,P*X.y,Y*(N?1:Z)],ue=U||g,ce=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ae=this.isLODDisabled(!0)?o:0;let Ee;if(this._elevation&&t.isTerrainDEM)Ee=1e4*this._elevation.exaggeration();else if(this._elevation){const Oe=this._elevation.getMinMaxForVisibleTiles();Ee=Oe?Oe.max:this._centerAltitude}else Ee=this._centerAltitude;const xe=t.isTerrainDEM?-Ee:this._elevation?this._elevation.getMinElevationBelowMSL():0,Se=this.projection.isReprojectedInTileSpace?r.cC(this):1,ye=Oe=>{const Ze=new r.ae(Oe.x+25e-6,Oe.y,Oe.z),lt=new r.ae(Oe.x,Oe.y+25e-6,Oe.z),St=Oe.toLngLat(),kt=Ze.toLngLat(),Ct=lt.toLngLat(),Et=this.locationCoordinate(St),ei=this.locationCoordinate(kt),Yt=this.locationCoordinate(Ct),Nt=Math.hypot(ei.x-Et.x,ei.y-Et.y),Kt=Math.hypot(Yt.x-Et.x,Yt.y-Et.y);return Math.sqrt(Nt*Kt)*Se/25e-6},fe=Oe=>{const nt=Ee,Ze=xe;return{aabb:r.cF(this,P,0,0,0,Oe,Ze,nt,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:nt,wrap:Oe,fullyVisible:!1}},De=[];let Pe=[];const Be=o,He=t.reparseOverscaled?u:o,Ve=(Y-this._centerAltitude)*Z,Qe=Oe=>{if(!this._elevation||!Oe.tileID||!b)return;const nt=this._elevation.getMinMaxForTile(Oe.tileID),Ze=Oe.aabb;nt?(Ze.min[2]=nt.min,Ze.max[2]=nt.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(Oe.shouldSplit=$e(Oe),Oe.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},ct=(Oe,nt)=>{if(.707*nt<Oe)return 1;const Ze=nt/Oe;return Ze/(1.4144271570014144+(Math.pow(1.1,Ze-1.4144271570014144+1)-1)/(1.1-1)-1)},$e=Oe=>{if(Oe.zoom<ae)return!0;if(Oe.zoom===Be)return!1;if(Oe.shouldSplit!=null)return Oe.shouldSplit;const nt=Oe.aabb.distanceX(ne),Ze=Oe.aabb.distanceY(ne);let lt=Ve,St=1;if(U){lt=Oe.aabb.distanceZ(ne);const Kt=Math.pow(2,Oe.zoom),ai=r.a$((Oe.y+1)/Kt),_i=r.a$(Oe.y/Kt),Pi=Math.min(Math.max(C,ai),_i),Zi=r.d1(Pi)/r.d1(C);if(St=Pi===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Zi/this._mercatorScaleRatio),this.zoom<=r.c_&&Oe.zoom===Be-1&&Zi>=.9)return!0}else if(v&&(lt=Oe.aabb.distanceZ(ne)*Z),this.projection.isReprojectedInTileSpace&&u<=5){const Kt=Math.pow(2,Oe.zoom),ai=ye(new r.ae((Oe.x+.5)/Kt,(Oe.y+.5)/Kt));St=ai>.85?1:ai}if(!b&&!U){const Kt=Math.sqrt(nt*nt+Ze*Ze+lt*lt);let ai=(1<<Be-Oe.zoom)*ce*St;return ai*=ct(Math.max(lt,Ve),Kt),Kt<ai}let kt=Number.MAX_VALUE,Ct=0;const Et=Oe.aabb.getCorners(),ei=[];for(const Kt of Et){r.av(ei,Kt,ne),U||(v?ei[2]*=Z:ei[2]=Ve);const ai=r.bJ(ei,this._camera.forward());ai<kt&&(kt=ai,Ct=Math.abs(ei[2]))}let Yt=(1<<Be-Oe.zoom)*ce*St;if(Yt*=ct(Math.max(Ct,Ve),kt),kt<Yt)return!0;const Nt=Oe.aabb.closestPoint(z);return Nt[0]===z[0]&&Nt[1]===z[1]};if(this.renderWorldCopies)for(let Oe=1;Oe<=3;Oe++)De.push(fe(-Oe)),De.push(fe(Oe));for(De.push(fe(0));De.length>0;){const Oe=De.pop(),nt=Oe.x,Ze=Oe.y;let lt=Oe.fullyVisible;const St=()=>this.projection.name==="globe"&&(Oe.y===0||Oe.y===(1<<Oe.zoom)-1);if(!lt){let kt=ue?Oe.aabb.intersects(V):Oe.aabb.intersectsFlat(V);if(kt===0&&St()){const Ct=new r.cD(Oe.zoom,nt,Ze);kt=r.cE(this,P,Ct,!0).intersects(V)}if(kt===0)continue;lt=kt===2}if(Oe.zoom===Be||!$e(Oe)){const kt=Oe.zoom===Be?He:Oe.zoom;if(t.minzoom&&t.minzoom>kt)continue;let Ct=0;if(!lt){let Nt=ue?Oe.aabb.intersectsPrecise(V):Oe.aabb.intersectsPreciseFlat(V);if(Nt===0&&St()){const Kt=new r.cD(Oe.zoom,nt,Ze);Nt=r.cE(this,P,Kt,!0).intersectsPrecise(V)}if(Nt===0)continue;if(t.calculateQuadrantVisibility)if(V.containsPoint(Oe.aabb.center))Ct=15;else for(let Kt=0;Kt<4;Kt++)Oe.aabb.quadrant(Kt).intersects(V)!==0&&(Ct|=1<<Kt)}const Et=z[0]-(.5+nt+(Oe.wrap<<Oe.zoom))*(1<<o-Oe.zoom),ei=z[1]-.5-Ze,Yt=Oe.tileID?Oe.tileID:new r.aQ(kt,Oe.wrap,Oe.zoom,nt,Ze);t.calculateQuadrantVisibility&&(Yt.visibleQuadrants=Ct),Pe.push({tileID:Yt,distanceSq:Et*Et+ei*ei});continue}for(let kt=0;kt<4;kt++){const Ct=(nt<<1)+kt%2,Et=(Ze<<1)+(kt>>1),ei={aabb:b?Oe.aabb.quadrant(kt):r.cF(this,P,Oe.zoom+1,Ct,Et,Oe.wrap,Oe.minZ,Oe.maxZ,this.projection),zoom:Oe.zoom+1,x:Ct,y:Et,wrap:Oe.wrap,fullyVisible:lt,tileID:void 0,shouldSplit:void 0,minZ:Oe.minZ,maxZ:Oe.maxZ};v&&!U&&(ei.tileID=new r.aQ(Oe.zoom+1===Be?He:Oe.zoom+1,Oe.wrap,Oe.zoom+1,Ct,Et),Qe(ei)),De.push(ei)}}if(this.fogCullDistSq){const Oe=this.fogCullDistSq,nt=this.horizonLineFromTop();Pe=Pe.filter(Ze=>{const lt=[0,0,0,1],St=[r.al,r.al,0,1],kt=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());r.aC(lt,lt,kt),r.aC(St,St,kt);const Ct=r.cG([],lt,St),Et=r.cH([],lt,St),ei=r.c$(Ct,Et);if(ei===0)return!0;let Yt=!1;const Nt=this._elevation;if(Nt&&ei>Oe&&nt!==0){const Kt=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let ai;t.isTerrainDEM||(ai=Nt.getMinMaxForTile(Ze.tileID)),ai||(ai={min:xe,max:Ee});const _i=r.cI(this.rotation),Pi=[_i[0]*r.al,_i[1]*r.al,ai.max];r.af(Pi,Pi,Kt),Yt=(1-Pi[1])*this.height*.5<nt}return ei<Oe||Yt})}return Pe.sort((Oe,nt)=>Oe.distanceSq-nt.distanceSq).map(Oe=>Oe.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const o=r.aA(t.lat,-r.cJ,r.cJ),u=this.projection.project(t.lng,o);return new r.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,o){let u,g;const v=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;u=(o.x-v.x)/E,g=(o.y-v.y)/E}else{const E=this.pointCoordinate(o),C=this.pointCoordinate(v);u=E.x-C.x,g=E.y-C.y}const b=this.locationCoordinate(t);this.setLocation(new r.ae(b.x-u,b.y-g))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,o){return this.projection.locationPoint(this,t,o)}locationPoint3D(t,o){return this.projection.locationPoint(this,t,o,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,o){return this.coordinateLocation(this.pointCoordinate3D(t,o))}locationCoordinate(t,o){const u=o?r.cf(o,t.lat):void 0,g=this.projection.project(t.lng,t.lat);return new r.ae(g.x,g.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){const u=o??this._centerAltitude,g=[t.x,t.y,0,1],v=[t.x,t.y,1,1];r.aC(g,g,this.pixelMatrixInverse),r.aC(v,v,this.pixelMatrixInverse);const b=v[3];r.cK(g,g,1/g[3]),r.cK(v,v,1/b);const E=g[2],C=v[2];return{p0:g,p1:v,t:E===C?0:(u-E)/(C-E)}}screenPointToMercatorRay(t){const o=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return r.aC(o,o,this.pixelMatrixInverse),r.aC(u,u,this.pixelMatrixInverse),r.cK(o,o,1/o[3]),r.cK(u,u,1/u[3]),o[2]=r.cf(o[2],this._center.lat)*this.worldSize,u[2]=r.cf(u[2],this._center.lat)*this.worldSize,r.cK(o,o,1/this.worldSize),r.cK(u,u,1/this.worldSize),new r.ax([o[0],o[1],o[2]],r.aw([],r.av([],u,o)))}rayIntersectionCoordinate(t){const{p0:o,p1:u,t:g}=t,v=r.cf(o[2],this._center.lat),b=r.cf(u[2],this._center.lat);return new r.ae(r.ak(o[0],u[0],g)/this.worldSize,r.ak(o[1],u[1],g)/this.worldSize,r.ak(v,b,g))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t,o){if(!this.elevation)return this.pointCoordinate(t,o);let u=this.projection.pointCoordinate3D(this,t.x,t.y);if(u)return new r.ae(u[0],u[1],u[2]);let g=0,v=this.horizonLineFromTop();if(t.y>v)return this.pointCoordinate(t,o);const b=.02*v,E=t.clone();for(let C=0;C<10&&v-g>b;C++){E.y=r.ak(g,v,.66);const P=this.projection.pointCoordinate3D(this,E.x,E.y);P?(v=E.y,u=P):g=E.y}return u?new r.ae(u[0],u[1],u[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.cL)return!this.isPointAboveHorizon(t);const o=this.pointCoordinate(t);return o.y>=0&&o.y<=1}_coordinatePoint(t,o){const u=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,g=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return r.aC(g,g,this.pixelMatrix),g[3]>0?new r.P(g[0]/g[3],g[1]/g[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:o}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,v=this.pointLocation3D(new r.P(o,t)),b=this.pointLocation3D(new r.P(g,t)),E=this.pointLocation3D(new r.P(g,u)),C=this.pointLocation3D(new r.P(o,u));let P=Math.min(v.lng,b.lng,E.lng,C.lng),z=Math.max(v.lng,b.lng,E.lng,C.lng),U=Math.min(v.lat,b.lat,E.lat,C.lat),N=Math.max(v.lat,b.lat,E.lat,C.lat);const V=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,Z=(Y,ne,ue,ce,ae)=>{const Ee=(Y+ue)/2,xe=(ne+ce)/2,Se=new r.P(Ee,xe),{lng:ye,lat:fe}=this.pointLocation3D(Se),De=Math.max(0,P-ye,U-fe,ye-z,fe-N);P=Math.min(P,ye),z=Math.max(z,ye),U=Math.min(U,fe),N=Math.max(N,fe),(ae<X||De>V)&&(Z(Y,ne,Ee,xe,ae+1),Z(Ee,xe,ue,ce,ae+1))};if(Z(o,t,g,t,1),Z(g,t,g,u,1),Z(g,u,o,u,1),Z(o,u,o,t,1),this.projection.name==="globe"){const[Y,ne]=r.cM(this);Y?(N=90,z=180,P=-180):ne&&(U=-90,z=180,P=-180)}return new r.aI(new r.aT(P,U),new r.aT(z,N))}_getBoundsRectangular(t,o){const{top:u,left:g}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=new r.P(g,u),C=new r.P(b,u),P=new r.P(b,v),z=new r.P(g,v);let U=this.pointCoordinate(E,t),N=this.pointCoordinate(C,t);const V=this.pointCoordinate(P,o),X=this.pointCoordinate(z,o),Z=(Y,ne)=>(ne.y-Y.y)/(ne.x-Y.x);return U.y>1&&N.y>=0?U=new r.ae((1-X.y)/Z(X,U)+X.x,1):U.y<0&&N.y<=1&&(U=new r.ae(-X.y/Z(X,U)+X.x,0)),N.y>1&&U.y>=0?N=new r.ae((1-V.y)/Z(V,N)+V.x,1):N.y<0&&U.y<=1&&(N=new r.ae(-V.y/Z(V,N)+V.x,0)),new r.aI().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=t.visibleDemTiles.reduce((u,g)=>{if(g.dem){const v=g.dem.tree;u.min=Math.min(u.min,v.minimums[0]),u.max=Math.max(u.max,v.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-r.cJ,this.maxLat=r.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aF(this.minLng)*this.tileSize,this.worldMaxX=r.aF(this.maxLng)*this.tileSize,this.worldMinY=r.aJ(this.maxLat)*this.tileSize,this.worldMaxY=r.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){const o=t.key,u=this._distanceTileDataCache;if(u[o])return u[o];const g=t.canonical,v=1/this.height,b=this.cameraWorldSize,E=b/this.zoomScale(g.z),C=(g.x+Math.pow(2,g.z)*t.wrap)*E,P=g.y*E,z=this.point;z.x*=b/this.worldSize,z.y*=b/this.worldSize;const U=this.angle,N=Math.sin(-U),V=-Math.cos(-U);return u[o]={bearing:[N,V],center:[(z.x-C)*v,(z.y-P)*v],scale:E/r.al*v},u[o]}calculateFogTileMatrix(t){const o=t.key,u=this._fogTileMatrixCache;if(u[o])return u[o];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.aB(g,this.worldToFogMatrix,g),u[o]=new Float32Array(g),u[o]}calculateProjMatrix(t,o=!1,u=!1){const g=t.key;let v;if(v=u?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,v[g])return v[g];const b=this.calculatePosMatrix(t,this.worldSize);let E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,r.aB(b,E,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(t){const o=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[o])return u[o];const g=r.cN(t,this);return u[o]=g,u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,o=r.bq([],[t,t,t]);return r.aB(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const o=r.cf(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(o),g=this._camera.forward(),v=r.cf(1,this._center.lat);u[2]/=v,g[2]/=v,r.aw(g,g);const b=t.raycast(u,g,t.exaggeration());if(b){const E=r.bH([],u,g,b),C=new r.ae(E[0],E[1],r.cf(E[2],r.a$(E[1]))),P=(C.z+r.ag([C.x-u[0],C.y-u[1],C.z-u[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const o=this._elevation,u=r.cf(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=o.getAtPointOrZero(new r.ae(...g)),b=this.pixelsPerMeter/this.worldSize*v,E=this._minimumHeightOverTerrain(),C=g[2]-b;if(C<=E)if(C<0||t){const P=this.locationCoordinate(this._center,this._centerAltitude),z=[g[0],g[1],P.z-g[2]],U=r.ag(z);z[2]-=(E-C)/this._pixelsPerMercatorPixel;const N=r.ag(z);if(N===0)return;r.c5(z,z,U/N*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],P.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const N=this.center;return N.lat=r.aA(N.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(N.lng=r.aA(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}const o=this._unmodified,{x:u,y:g}=this.point;let v=0,b=u,E=g;const C=this.width/2,P=this.height/2,z=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(g-P<z&&(E=z+P),g+P>U&&(E=U-P),U-z<this.height&&(v=Math.max(v,this.height/(U-z)),E=(U+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const N=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,X=this.worldSize/2-(N+V)/2;b=(u+X+this.worldSize)%this.worldSize-X,b-C<N&&(b=N+C),b+C>V&&(b=V-C),V-N<this.width&&(v=Math.max(v,this.width/(V-N)),b=(V+N)/2)}b===u&&E===g||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(b,E))),v&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,o=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.cf(1,this.center.lat)/r.cf(1,r.d2));const g=r.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?u:1,b=this._camera.getWorldToCamera(this.worldSize,v);let E;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-t.x/this.width,C[9]=2*t.y/this.height,this.isOrthographic){let fe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),De=fe*this.aspect,Pe=-De,Be=-fe;De-=t.x,Pe-=t.x,fe+=t.y,Be+=t.y,E=this._camera.getCameraToClipOrthographic(Pe,De,Be,fe,this._nearZ,this._farZ),((He,Ve,Qe,ct)=>{for(let $e=0;$e<16;$e++)He[$e]=r.ak(Ve[$e],Qe[$e],ct)})(E,E,C,r.d0(this.pitch>=ea?1:this.pitch/ea))}else E=C;const P=r.cP([],C,b);let z=r.cP([],E,b);if(this.projection.isReprojectedInTileSpace){const fe=this.locationCoordinate(this.center),De=r.bA([]);r.br(De,De,[fe.x*this.worldSize,fe.y*this.worldSize,0]),r.aB(De,De,r.cQ(this)),r.br(De,De,[-fe.x*this.worldSize,-fe.y*this.worldSize,0]),r.aB(z,z,De),r.aB(P,P,De),this.inverseAdjustmentMatrix=r.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cS([],z,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=z,this.invProjMatrix=r.bl(new Float64Array(16),this.projMatrix),o){const fe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);fe[8]=2*-t.x/this.width,fe[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.cP([],fe,b)}else this.expandedFarZProjMatrix=this.projMatrix;const U=r.bl([],E);this.frustumCorners=r.cT.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const N=new Float32Array(16);r.bA(N),r.cS(N,N,[1,-1,1]),r.cU(N,N,this._pitch),r.bB(N,N,this.angle);const V=r.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bz(V);const X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-t.x/this.width,V[9]=2*(t.y+X)/this.height,this.skyboxMatrix=r.aB(N,V,N);const Z=this.point,Y=Z.x,ne=Z.y,ue=this.width%2/2,ce=this.height%2/2,ae=Math.cos(this.angle),Ee=Math.sin(this.angle),xe=Y-Math.round(Y)+ae*ue+Ee*ce,Se=ne-Math.round(ne)+ae*ce+Ee*ue,ye=new Float64Array(z);if(r.br(ye,ye,[xe>.5?xe-1:xe,Se>.5?Se-1:Se,0]),this.alignedProjMatrix=ye,z=r.bC(),r.cS(z,z,[this.width/2,-this.height/2,1]),r.br(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=r.bC(),r.cS(z,z,[1,-1,1]),r.br(z,z,[-1,-1,0]),r.cS(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=r.aB(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},z=r.bl(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cV(this);const fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.af(fe,fe,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,u=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,v=[t,t,o];r.c5(v,v,g),r.c5(u,u,-1),r.cW(u,u,v);const b=r.bC();r.br(b,b,u),r.cS(b,b,v),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,g)}_computeCameraPosition(t){const o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),g=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-u[0]*v,g.y/this.worldSize-u[1]*v,t/this.worldSize*this._centerAltitude-u[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],g=t[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(v=Math.min((o-u)/g,1)),this._camera.position=r.bH([],this._camera.position,t,v),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,o=this._camera.forward(),{pitch:u,bearing:g}=this._camera.getPitchBearing(),v=r.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.an(this._maxPitch)),E=Math.max((t[2]-v)/Math.cos(u),b),C=this._zoomFromMercatorZ(E);r.bH(t,t,o,E),this._pitch=r.aA(u,r.an(this.minPitch),r.an(this.maxPitch)),this.angle=r.bT(g,-Math.PI,Math.PI),this._setZoom(r.aA(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let o=0,u=r.cL,g=0,v=1/0;for(;u-o>1e-6&&u>o;){const b=o+.5*(u-o),E=this.tileSize*Math.pow(2,b),C=this.getCameraToCenterDistance(this.projection,b,E),P=this.scaleZoom(C/(Math.max(0,t)*this.tileSize)),z=Math.abs(b-P);z<v&&(v=z,g=b),b<P?o=b:u=b}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){const u=Math.min(t.x,o.x),g=Math.max(t.x,o.x),v=Math.min(t.y,o.y),b=Math.max(t.y,o.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new r.P(u,v),new r.P(g,b),new r.P(u,b),new r.P(g,v)],C=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const z of E){const U=this.pointRayIntersection(z);if(U.t<0)return!0;const N=this.rayIntersectionCoordinate(U);if(N.x<C||N.y<0||N.x>P||N.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,o){const u=r.ag(r.av([],this._camera.position,t)),g=this._zoomFromMercatorZ(u)+o;return u-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([o,u,g],v){const b=[o,u,g,1];r.aC(b,b,v);const E=b[3]=Math.max(b[3],1e-6);return b[0]/=E,b[1]/=E,b[2]/=E,b})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,o=this.zoom,u=this.worldSize){const g=r.cO(t,o,this.width,this.height,1024),v=t.pixelSpaceConversion(this.center.lat,u,g);let b=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(b=r.ak(1,b,r.d0(this.pitch>=ea?1:this.pitch/ea))),b}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.aB(t,t,this.globeMatrix),t}getFrustum(t){return r.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const pa=(c,t)=>{if(t>0&&c.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=c.transform,u=Math.max(Math.abs(o._zoom-(c.minCutoffZoom-1)),1),g=o.isLODDisabled(!1)?r.ah(60,45,o.pitch):r.ah(30,15,o.pitch),v=o._farZ-o._nearZ,b=t*o.height,E=((1-(C=g))*o.cameraToCenterDistance+C*(o._farZ+b))*u;var C;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(E-o._nearZ)/v,(E-b-o._nearZ)/v]}}},Wl=2048;class Tg{constructor(t,o){this.aabb=t,this.lastCascade=o}}class hu{add(t,o){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],o.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],o.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],o.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],o.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],o.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],o.max[2])):this.receivers[t.key]=new Tg(o,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,o,u){const g=r.d9.fromPoints(t.points);let v=0;for(const b in this.receivers){const E=this.receivers[b];if(!E||!g.intersectsAabb(E.aabb))continue;E.aabb.min=g.closestPoint(E.aabb.min),E.aabb.max=g.closestPoint(E.aabb.max);const C=E.aabb.getCorners();for(let P=0;P<u.length;P++){let z=!0;for(const U of C){const N=[U[0]*o,U[1]*o,U[2]];if(r.af(N,N,u[P].matrix),N[0]<-1||N[0]>1||N[1]<-1||N[1]>1){z=!1;break}}if(E.lastCascade=P,v=Math.max(v,P),z)break}}return v+1}}class yd{constructor(t){this.painter=t,this._enabled=!1,this._drawShadowAfterLayer=-1,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new hu,this._depthMode=new ii(t.context.gl.LEQUAL,ii.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,o){const u=this.painter;if(this._enabled=!1,this._drawShadowAfterLayer=-1,this._receivers.clear(),!o||!o.properties)return;const g=o.properties.get("shadow-intensity"),v=o.properties.get("shadow-draw-before-layer");if(!o.shadowsEnabled()||g<=0)return;let b=-1,E=0;for(const ne of u.style.order){const ue=u.style._mergedLayers[ne];ue.hasShadowPass()&&!ue.isHidden(t.zoom)&&(b=E),v&&v===ne&&(this._drawShadowAfterLayer=E>0?E-1:0),E+=1}if(this._enabled=b>=0,!this.enabled)return;this._drawShadowAfterLayer<0&&(this._drawShadowAfterLayer=b);const C=u.context,P=Wl,z=Wl;if(this._cascades.length===0||Wl!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ne=0;ne<2;++ne){const ue=u._shadowMapDebug,ce=C.gl,ae=C.createFramebuffer(P,z,ue?1:0,"texture"),Ee=new r.T(C,{width:P,height:z,data:null},ce.DEPTH_COMPONENT16);if(ae.depthAttachment.set(Ee.texture),ue){const xe=new r.T(C,{width:P,height:z,data:null},ce.RGBA8);ae.colorAttachment0.set(xe.texture)}this._cascades.push({framebuffer:ae,texture:Ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cB,scale:0})}}this.shadowDirection=If(o);let U=0;if(t.elevation){const ne=t.elevation,ue=[1e4,-1e4];ne.visibleDemTiles.filter(ce=>ce.dem).forEach(ce=>{const ae=ce.dem.tree;ue[0]=Math.min(ue[0],ae.minimums[0]),ue[1]=Math.max(ue[1],ae.maximums[0])}),ue[0]!==1e4&&(U=(ue[1]-ue[0])*ne.exaggeration())}const N=1.5*t.cameraToCenterDistance,V=3*N,X=new Float64Array(16);for(let ne=0;ne<this._cascades.length;++ne){const ue=this._cascades[ne];let ce=t.height/50,ae=1;ne===0?ae=N:(ce=N,ae=V);const[Ee,xe]=Rf(t,this.shadowDirection,ce,ae,Wl,U);ue.scale=t.scale,ue.matrix=Ee,ue.boundingSphereRadius=xe,r.bl(X,ue.matrix),ue.frustum=r.cB.fromInvProjectionMatrix(X,1,0,!0),ue.far=ae}const Z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Z].far,this._cascades[Z].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Wl,this._uniformValues.u_shadowmap_0=11,this._uniformValues.u_shadowmap_1=12,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Y=u.transform.elevation;for(const ne of this._groundShadowTiles){let ue={min:0,max:0};if(Y){const ce=Y.getMinMaxForTile(ne);ce&&(ue=ce)}this.addShadowReceiver(ne.toUnwrapped(),ue.min,ue.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,o){if(!this.enabled)return;const u=this.painter,g=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),g.viewport.set([0,0,Wl,Wl]);for(let v=0;v<this._numCascadesToRender;++v){u.currentShadowCascade=v,g.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),g.clear({color:r.ao.white,depth:1});for(const b of t.order){const E=t._mergedLayers[b];if(!E.hasShadowPass()||E.isHidden(u.transform.zoom))continue;const C=t.getLayerSourceCache(E),P=C?o[C.id]:void 0;(E.type==="model"||P&&P.length)&&u.renderLayer(u,C,E,P)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,o=t.style,u=t.context,g=u.gl,v=o.directionalLight,b=o.ambientLight;if(!v||!b)return;const E=[],C=pa(t,t.longestCutoffRange);C.shouldRenderCutoff&&E.push("RENDER_CUTOFF"),E.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&E.push("NORMAL_OFFSET");const P=xo(o,v,b),z=new ii(g.LEQUAL,ii.ReadOnly,t.depthRangeFor3D),U=new xi({func:g.EQUAL,mask:255},0,255,g.KEEP,g.KEEP,g.KEEP);for(const N of this._groundShadowTiles){const V=N.toUnwrapped(),X=t.isTileAffectedByFog(N),Z=t.getOrCreateProgram("groundShadow",{defines:E,overrideFog:X});this.setupShadows(V,Z),t.uploadCommonUniforms(u,Z,V,null,C);const Y=Po(t.transform.calculateProjMatrix(V),P);Z.draw(t,g.TRIANGLES,z,U,wi.multiply,gi.disabled,Y,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?wi.unblended:wi.disabled}getShadowPassDepthMode(){return this._depthMode}getGroundShadowLayerIndex(){return this._drawShadowAfterLayer}calculateShadowPassMatrixFromTile(t){const o=this.painter.transform,u=o.calculatePosMatrix(t,o.worldSize);return r.aB(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){const o=r.bz(t);return r.aB(o,this._cascades[this.painter.currentShadowCascade].matrix,t),o}setupShadows(t,o,u){if(!this.enabled)return;const g=this.painter.transform,v=this.painter.context,b=v.gl,E=this._uniformValues,C=new Float64Array(16),P=g.calculatePosMatrix(t,g.worldSize);for(let z=0;z<this._cascades.length;z++)r.aB(C,this._cascades[z].matrix,P),E[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(b.TEXTURE0+11+z),this._cascades[z].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=!!u,this.useNormalOffset){const z=r.d7(t.canonical),U=2/g.tileSize*r.al/Wl,N=U*this._cascades[0].boundingSphereRadius,V=U*this._cascades[this._cascades.length-1].boundingSphereRadius,X=(u==="vector-tile"?1:3)*(function(Z){const Y=r.aA((Z-22)/-22,0,1);return .125*(1-Y)+4*Y})(g.zoom);E.u_shadow_normal_offset=[z,N*X,V*X],E.u_shadow_bias=[1e-4,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(v,E)}setupShadowsFromMatrix(t,o,u=!1){if(!this.enabled)return;const g=this.painter.context,v=g.gl,b=this._uniformValues,E=new Float64Array(16);for(let C=0;C<2;C++)r.aB(E,this._cascades[C].matrix,t),b[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),g.activeTexture.set(v.TEXTURE0+11+C),this._cascades[C].texture.bindExtraParam(v.LINEAR,v.LINEAR,v.CLAMP_TO_EDGE,v.CLAMP_TO_EDGE,v.GREATER);this.useNormalOffset=u,u?(b.u_shadow_normal_offset=[1,3,3],b.u_shadow_bias=[6e-5,.0012,.012]):b.u_shadow_bias=[36e-5,.0012,.012],o.setShadowUniformValues(g,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,o,u,g){if(g[2]>=0)return{};const v=(function(C,P,z){const U=z/(1<<C.canonical.z);return new r.d9([C.canonical.x*U+C.wrap*z,C.canonical.y*U+C.wrap*z,0],[(C.canonical.x+1)*U+C.wrap*z,(C.canonical.y+1)*U+C.wrap*z,P])})(t,o,u).getCorners(),b=o/-g[2];g[0]<0?(r.d8(v[0],v[0],[g[0]*b,0,0]),r.d8(v[3],v[3],[g[0]*b,0,0])):g[0]>0&&(r.d8(v[1],v[1],[g[0]*b,0,0]),r.d8(v[2],v[2],[g[0]*b,0,0])),g[1]<0?(r.d8(v[0],v[0],[0,g[1]*b,0]),r.d8(v[1],v[1],[0,g[1]*b,0])):g[1]>0&&(r.d8(v[2],v[2],[0,g[1]*b,0]),r.d8(v[3],v[3],[0,g[1]*b,0]));const E={};return E.vertices=v,E.planes=[Xl(v[1],v[0],v[4]),Xl(v[2],v[1],v[5]),Xl(v[3],v[2],v[6]),Xl(v[0],v[3],v[7])],E}addShadowReceiver(t,o,u){this._receivers.add(t,r.d9.fromTileIdAndHeight(t,o,u))}getMaxCascadeForTile(t){const o=this._receivers.get(t);return o&&o.lastCascade?o.lastCascade:0}}function Xl(c,t,o){const u=r.av([],o,t),g=r.av([],c,t),v=r.bI([],u,g),b=r.ag(v);return b===0?[0,0,1,0]:(r.c5(v,v,1/b),[v[0],v[1],v[2],-r.bJ(v,t)])}function If(c){const t=c.properties.get("direction"),o=r.d4(t.x,t.y,t.z);o[2]=r.aA(o[2],0,75);const u=r.d6([o[0],o[1],o[2]]);return r.d5(u.x,u.y,u.z)}function xo(c,t,o){const u=t.properties.get("color-use-theme")==="none",g=t.properties.get("color"),v=t.properties.get("intensity"),b=t.properties.get("direction"),E=[b.x,b.y,b.z],C=o.properties.get("color-use-theme")==="none",P=o.properties.get("color"),z=o.properties.get("intensity"),U=Math.max(r.bJ([0,0,1],E),0),N=[0,0,0];r.c5(N,P.toPremultipliedRenderColor(C?null:c.getLut(t.scope)).toArray01Linear().slice(0,3),z);const V=[0,0,0];return r.c5(V,g.toPremultipliedRenderColor(u?null:c.getLut(o.scope)).toArray01Linear().slice(0,3),U*v),r.db([N[0]>0?N[0]/(N[0]+V[0]):0,N[1]>0?N[1]/(N[1]+V[1]):0,N[2]>0?N[2]/(N[2]+V[2]):0])}function Rf(c,t,o,u,g,v){const b=c.zoom,E=c.scale,C=c.worldSize,P=1/C,z=c.aspect,U=Math.sqrt(1+z*z)*Math.tan(.5*c.fovX),N=U*U,V=u-o,X=u+o;let Z,Y;N>V/X?(Z=u,Y=u*U):(Z=.5*X*(1+N),Y=.5*Math.sqrt(V*V+2*(u*u+o*o)*N+X*X*N*N));const ne=c.projection.pixelsPerMeter(c.center.lat,C),ue=c._camera.getCameraToWorldMercator(),ce=[0,0,-Z*P];r.af(ce,ce,ue);let ae=Y*P;const Ee=function(lt){return lt[0]/=E,lt[1]/=E,lt[2]=r.cf(lt[2],c._center.lat),lt},xe=c._edgeInsets;if(!(xe.left===0&&xe.top===0&&xe.right===0&&xe.bottom===0||xe.left===xe.right&&xe.top===xe.bottom)){const lt=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?ne:1),St=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,o,u);St[8]=2*-c.centerOffset.x/c.width,St[9]=2*c.centerOffset.y/c.height;const kt=new Float64Array(16);r.cP(kt,St,lt);const Ct=new Float64Array(16);r.bl(Ct,kt);const Et=r.cB.fromInvProjectionMatrix(Ct,C,b,!0);for(const ei of Et.points){const Yt=Ee(ei);ae=Math.max(ae,r.c6(r.da([],ce,Yt)))}}ae*=g/(g-1);const Se=Math.acos(t[2]),ye=Math.atan2(-t[0],-t[1]),fe=new ph;fe.position=ce,fe.setPitchBearing(Se,ye);const De=fe.getWorldToCamera(C,ne),Pe=ae*C,Be=Math.min(c._mercatorZfromZoom(17)*C*-2,-2*Pe),He=fe.getCameraToClipOrthographic(-Pe,Pe,-Pe,Pe,Be,(Pe+v*ne)/t[2]),Ve=new Float64Array(16);r.aB(Ve,He,De);const Qe=r.d5(Math.floor(1e6*ce[0])/1e6*C,Math.floor(1e6*ce[1])/1e6*C,0),ct=.5*g,$e=[0,0,0];r.af($e,Qe,Ve),r.c5($e,$e,ct);const Oe=[Math.floor($e[0]),Math.floor($e[1]),Math.floor($e[2])],nt=[0,0,0];r.av(nt,$e,Oe),r.c5(nt,nt,-1/ct);const Ze=new Float64Array(16);return r.bA(Ze),r.br(Ze,Ze,nt),r.aB(Ve,Ze,Ve),[Ve,Pe]}class vd extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,o){return r.dc(this.requestManager.transformRequest(o,r.R.Model).url).then(u=>{if(!u)return;const g=r.dd(u),v=new r.de(t,o,void 0,void 0,g);return v.computeBoundsAndApplyParent(),v}).catch(u=>{if(u&&u.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${t} from ${o}: ${u.message}`)))})}load(t,o,u={forceReload:!1}){this.models[o]||(this.models[o]={});const g=Object.keys(t),v=[],b=[];for(const E of g){const C=t[E];this.hasURLBeenRequested(C)&&!u.forceReload||(this.modelByURL[C]={modelId:E,scope:o},v.push(this.loadModel(E,C)),b.push(E)),this.models[o][E]||(this.models[o][E]={model:null,numReferences:1})}this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+b.length,Promise.allSettled(v).then(E=>{for(let C=0;C<E.length;C++){const{status:P}=E[C];if(P==="rejected")continue;const{value:z}=E[C];this.models[o][b[C]]||(this.models[o][b[C]]={model:null,numReferences:1}),this.models[o][b[C]].model=z}this.numModelsLoading[o]-=b.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(E=>{this.fire(new r.y(new Error(`Could not load models: ${E.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,o,u={exactIdMatch:!1}){return!!(u.exactIdMatch?this.getModel(t,o):this.getModelByURL(this.modelUris[o][t]))}getModel(t,o){return this.models[o]||(this.models[o]={}),this.models[o][t]?this.models[o][t].model:void 0}getModelByURL(t){if(!t)return null;const o=this.modelByURL[t];return o?this.models[o.scope][o.modelId].model:null}hasModelBeenAdded(t,o){return this.models[o]&&this.models[o][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,o,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const g=this.requestManager.normalizeModelURL(o);if((this.hasModel(t,u,{exactIdMatch:!0})||this.hasModelBeenAdded(t,u))&&this.modelUris[u][t]===g)this.models[u][t].numReferences++;else if(this.hasURLBeenRequested(g)){const{scope:v,modelId:b}=this.modelByURL[g];this.models[v][b].numReferences++}else this.modelUris[u][t]=g,this.load({[t]:this.modelUris[u][t]},u)}addModelURLs(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const u=this.modelUris[o];for(const g in t)u[g]=this.requestManager.normalizeModelURL(t[g])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const u={};for(const g of t)this.hasModel(g,o,{exactIdMatch:!0})||this.hasURLBeenRequested(g)?this.models[o][g].numReferences++:this.modelUris[o][g]&&!this.hasURLBeenRequested(g)?u[g]=this.modelUris[o][g]:!this.hasURLBeenRequested(g)&&r.df(g,!1)&&(this.modelUris[o][g]=this.requestManager.normalizeModelURL(g),u[g]=this.modelUris[o][g]);this.load(u,o)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,o,u=!1,g=!1){if(this.models[o]&&this.models[o][t]&&(this.models[o][t].numReferences--,this.models[o][t].numReferences===0||g)){const v=this.modelUris[o][t];u||delete this.modelUris[o][t],delete this.modelByURL[v];const b=this.models[o][t].model;if(!b)return;delete this.models[o][t],b.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const o of Object.keys(this.models[t])){const u=this.models[t][o].model;delete this.models[t][o],u&&u.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,o){this.models[o]||(this.models[o]={});for(const u in this.models[o])this.models[o][u].model&&this.models[o][u].model.upload(t.context)}}const Za=r.a6.colorTheme,ma=new r.a9({data:new r.aa(Za.data)});function Jp(c){if(!c.metadata||!c.metadata.content_area)return;const t=r.o.devicePixelRatio,{left:o,top:u,width:g,height:v}=c.metadata.content_area,b=o*t,E=u*t;return[b,E,b+g*t,E+v*t]}function Qp(c){if(c)return c.map(([t,o])=>[t*r.o.devicePixelRatio,o*r.o.devicePixelRatio])}class du{constructor(t,o,u){this.id=t,this.scope=o,this.sourceCache=u,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const o=this.sourceCache.getVisibleCoordinates();if(o.length===0)return t;const u=this.sourceCache.getSource();if(!(u instanceof ro))return t;const g=o.map(b=>this.sourceCache.getTile(b)),v=u.getImages(g,Array.from(this.pendingRequests));for(const[b,E]of v)t.set(r.I.from({name:b,iconsetId:this.id}),E),this.pendingRequests.delete(b);for(const b of this.pendingRequests)this.missingRequests.add(b);return this.pendingRequests.clear(),t}}class Mf{constructor(){r.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.style&&this._map.style.indoorManager.on("selector-update",o=>this._onIndoorUpdate(o)),this._container}_createButton(t,o){const u=he("button",t,this._container);return u.type="button",u.addEventListener("click",o),u}_createSeparator(){return he("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,o){this._map&&(t.setAttribute("aria-label",o),t.textContent=o)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.style&&(this._map.style.indoorManager.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const o=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",o&&Array.from(this._container.children).forEach(u=>u.remove()),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const o=this._map;this._model&&o&&o._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});he("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,o){for(let u=0;u<t.length;u++){const g=t[u],v=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(g.id)});this._setButtonTitle(v,g.zIndex.toString()),this._model&&g.id===this._model.selectedFloorId&&o&&v.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(v),u<t.length-1&&this._createSeparator()}}}class Sg extends r.E{constructor(t){super(),this._style=t,this._buildings={},this._indoorControl=null,this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},r.aY(["_updateUI"],this),this._style.on("style.load",()=>{this._style.isIndoorEnabled()&&(this._style.map.on("load",this._updateUI),this._style.map.on("move",this._updateUI),this._style.map.on("idle",this._updateUI),this._updateUI())})}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null,this._removeIndoorControl()}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[o,u]of Object.entries(t.buildings))if(this._buildings[o])for(const g of u.floorIds)this._buildings[o].floors[g]||(this._buildings[o].floors[g]=u.floors[g]);else this._buildings[o]=u;for(const o of t.activeFloors)this._activeFloors.add(o);this._updateIndoorSelector()}getIndoorTileOptions(t,o){const u=this._style.getIndoorSourceLayers(t,o);return u&&this._indoorState?{sourceLayers:u,indoorState:this._indoorState}:null}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Mf,this._style.map.addControl(this._indoorControl,"right"))}_removeIndoorControl(){this._indoorControl&&(this._indoorControl.onRemove(),this._indoorControl=null)}_updateUI(){const t=this._style.map.transform,o=(function(u,g,v,b){let E=null,C=Number.MAX_SAFE_INTEGER;if(b<16)return null;for(const[P,z]of Object.entries(u)){const U=z.center;if(U){const N=g.distanceTo(r.aT.convert(U));N<C&&v.contains(U)&&(C=N,E=P)}}return E})(this._buildings,t.center,t.getBounds(),t.zoom);o!==this._closestBuildingId&&(this._closestBuildingId=o,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,o=this._closestBuildingId,u=o&&t?t[o]:void 0;if(!u)return this._removeIndoorControl(),void this.fire(new r.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));this._addIndoorControl();let g=null;for(const b of u.floorIds)if(this._activeFloors&&this._activeFloors.has(b)){g=b;break}const v=Array.from(u.floorIds).map(b=>({id:b,name:u.floors[b].name,zIndex:u.floors[b].zIndex})).sort((b,E)=>E.zIndex-b.zIndex);this.fire(new r.z("selector-update",{selectedFloorId:g,activeFloorsVisible:this._activeFloorsVisible,floors:v}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}const wl=(c,t)=>ke(c,t&&t.filter(o=>o.identifier!=="source.canvas")),Eg=r.aH(on,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Ag=r.aH(on,["setCenter","setZoom","setBearing","setPitch"]),Df=new Set(["background","sky","slot","custom"]),Of={version:8,layers:[],sources:{}},Yl={duration:300,delay:0};class bo extends r.E{constructor(t,o={}){super(),this.map=t,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=Object.assign({},Yl),this._buildingIndex=new ou(this),this.crossTileSymbolIndex=new Pr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=o.styleChanges||new Cn,this._hasDataDrivenEmissive=!1,this.indoorManager=new Sg(this),this.dispatcher=o.dispatcher?o.dispatcher:new r.D(r.dh(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new Ts(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new r.di(t._requestManager,o.localFontFamily?r.dj.all:o.localIdeographFontFamily?r.dj.ideographs:r.dj.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new vd(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._indoorDependentLayers=o.indoorDependentLayers?o.indoorDependentLayers:new Set,this._config=o.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:o.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",r.dk());const u=this;this._rtlTextPluginCallback=bo.registerForPluginStateChange(g=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,b)=>{if(r.dl(v),b&&b.every(E=>E))for(const E in u._sourceCaches){const C=u._sourceCaches[E],P=C.getSource().type;P!=="vector"&&P!=="geojson"||C.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const v=this.getOwnSource(g.sourceId);if(v&&v.vectorLayerIds)for(const b in this._layers){const E=this._layers[b];E.source===v.id&&this._validateLayer(E)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.h(t))return t;const o=r.dm(t);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${r.dn(JSON.stringify(t))}`}_diffStyle(t,o,u){this.globalId=this._getGlobalId(t);const g=(v,b)=>{try{b(null,this.setState(v,u))}catch(E){b(E,!1)}};if(typeof t=="string"){const v=this.map._requestManager.normalizeStyleURL(t),b=this.map._requestManager.transformRequest(v,r.R.Style);r.m(b,(E,C)=>{E?this.fire(new r.y(E)):C&&g(C,o)})}else typeof t=="object"&&g(t,o)}loadURL(t,o={}){this.fire(new r.z("dataloading",{dataType:"style"}));const u=typeof o.validate=="boolean"?o.validate:!r.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,o.accessToken),this.resolvedImports.add(t);const g=this.importsCache.get(t);if(g)return this._load(g,u);const v=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.m(v,(b,E)=>{if(this._request=null,b)this.fire(new r.y(b));else if(E)return this.importsCache.set(t,E),this._load(E,u)})}loadJSON(t,o={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.o.frame(()=>{this._request=null,this._load(t,o.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(Of,!1)}_loadImports(t,o,u){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const v of t){const b=this._createFragmentStyle(v),E=new Promise(z=>{b.once("style.import.load",z),b.once("error",z)}).then(()=>this.mergeAll());if(g.push(E),this.resolvedImports.has(v.url)){b.loadEmpty();continue}const C=v.data||this.importsCache.get(v.url);C?(b.loadJSON(C,{validate:o}),this._isInternalStyle(C)&&(b.globalId=null)):v.url?b.loadURL(v.url,{validate:o}):b.loadEmpty();const P={style:b,id:v.id,config:v.config};if(u){const z=this.fragments.findIndex(({id:U})=>U===u);this.fragments=this.fragments.slice(0,z).concat(P).concat(this.fragments.slice(z))}else this.fragments.push(P)}return Promise.allSettled(g)}getImportGlobalIds(t=this,o=new Set){for(const u of t.fragments)u.style.globalId&&o.add(u.style.globalId),this.getImportGlobalIds(u.style,o);return[...o.values()]}_createFragmentStyle(t){const o=this.scope?r.B(t.id,this.scope):t.id;let u;const g=this._initialConfig&&this._initialConfig[o];(t.config||g)&&(u=Object.assign({},t.config,g));const v=new bo(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,o){if(this._isInternalStyle(t)){const v=Object.assign({},Of,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(v,o)}if(this.updateConfig(this._config,t.schema),o&&wl(this,In(t)))return;this._loaded=!0,this.stylesheet=r.dp(t);const u=()=>{for(const C in t.sources)this.addSource(C,t.sources[C],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const C in t.iconsets)this.addIconset(C,t.iconsets[C]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const v=wf(this.stylesheet.layers);if(this._order=v.map(C=>C.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const C=this.stylesheet.lights[0];this.light=new Ke(C.properties,C.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ke(this.stylesheet.light)),this._layers={};for(const C of v){const P=r.du(C,this.scope,this._styleColorTheme.lut,this.options);P.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(P.fqid),this._hasAppearances=this._hasAppearances||P.getAppearances().length!==0,P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P;const z=this.getOwnLayerSourceCache(P),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&P.canCastShadows()&&U&&(z.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const b=this.stylesheet.terrain;b&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(b,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const E=this.isRootStyle();t.imports?this._loadImports(t.imports,o).then(()=>{this._reloadImports(),this.fire(new r.z(E?"style.load":"style.import.load"))}).catch(C=>{this.fire(new r.y(new Error("Failed to load imports",C))),this.fire(new r.z(E?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(E?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const v=this._evaluateColorThemeData(g);this._loadColorTheme(v).then(()=>{u()}).catch(b=>{r.w(`Couldn't load color theme from the stylesheet: ${b}`),u()})}else this._styleColorTheme.lut=null,u()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(t=>t.style.hasAppearances())}mergeAll(){let t,o,u,g,v,b,E,C,P,z;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(N=>{if(N.stylesheet){if(N.light!=null&&(t=N.light),N.stylesheet.lights)for(const V of N.stylesheet.lights)V.type==="ambient"&&N.ambientLight!=null&&(o=N.ambientLight),V.type==="directional"&&N.directionalLight!=null&&(u=N.directionalLight);g=this._prioritizeTerrain(g,N.terrain,N.stylesheet.terrain),N.stylesheet.fog&&N.fog!=null&&(v=N.fog),N.stylesheet.snow&&N.snow!=null&&(b=N.snow),N.stylesheet.rain&&N.rain!=null&&(E=N.rain),N.stylesheet.camera!=null&&(z=N.stylesheet.camera),N.stylesheet.projection!=null&&(C=N.stylesheet.projection),N.stylesheet.transition!=null&&(P=N.stylesheet.transition),U[N.scope]=N._styleColorTheme}}),this.light=t,this.ambientLight=o,this.directionalLight=u,this.fog=v,this.snow=b,this.rain=E,this._styleColorThemeForScope=U,g===null?delete this.terrain:this.terrain=g,this.camera=z||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=Object.assign({},Yl,P),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const o=u=>{for(const g of u.fragments)o(g.style);t(u)};o(this)}_prioritizeTerrain(t,o,u){const g=t&&t.drapeRenderMode===0;return u===null?o&&o.drapeRenderMode===0?o:g?t:null:o!=null&&(!t||g||o&&o.drapeRenderMode===1)?o:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{t=this._prioritizeTerrain(t,o.terrain,o.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(t=o.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},o={},u={};this.forEachFragmentStyle(g=>{for(const v in g._sourceCaches){const b=r.B(v,g.scope);t[b]=g._sourceCaches[v]}for(const v in g._otherSourceCaches){const b=r.B(v,g.scope);o[b]=g._otherSourceCaches[v]}for(const v in g._symbolSourceCaches){const b=r.B(v,g.scope);u[b]=g._symbolSourceCaches[v]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=u}mergeIndoor(){this.forEachFragmentStyle(t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const o of Object.values(t.stylesheet.indoor)){const u=o,g=r.B(u.sourceId,t.scope);this._mergedIndoor[g]=new Set(u.sourceLayers||[])}})}mergeLayers(){const t={},o=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const E of b._order){const C=b._layers[E];if(C.type==="slot"){const P=r.dq(E);if(t[P])continue;t[P]=[]}C.slot&&t[C.slot]?t[C.slot].push(C):o.push(C)}}),this._mergedOrder=[];let g=-1;const v=(b=[])=>{for(const E of b)if(E.type==="slot"){const C=r.dq(E.id);t[C]&&v(t[C]),this._mergedSlots.push(C)}else{const C=r.B(E.id,E.scope);this._mergedOrder.push(C),u[C]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0,g=this._mergedOrder.length-1),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};if(v(o),this._has3DLayers){const b={};for(let E=0;E<this._mergedOrder.length;++E){const C=this._mergedOrder[E];b[C]=E===g?1:E<g?u[C].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((E,C)=>b[E]-b[C])}this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(o,u,g){const v=Object.assign({},u);for(const E of Object.keys(Za))v[E]===void 0&&(v[E]=Za[E].default);const b=new r.a8(ma,o,new Map(g));return b.setTransitionOrValue(v,g),b.untransitioned().possiblyEvaluate(new r.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,g)=>{const v="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let b=t;b.startsWith(v)||(b=v+b);const E=r.I.from("mapbox-reserved-lut"),C=new Image;C.src=b,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void u();this._styleColorTheme.lutLoading=!1;const{width:P,height:z,data:U}=r.o.getImageData(C);if(z>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(P!==z*z)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(E)&&this.removeImage(E),this.addImage(E,{data:new r.q({width:P,height:z},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const N=this.imageManager.getImage(E,this.scope);N?(this._styleColorTheme.lut={image:N.data,data:t},u()):g(new Error("Missing LUT image."))}})}getLut(t){const o=this._styleColorThemeForScope[t];return o?o.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(o,u,g){let v,b,E;const C=r.o.devicePixelRatio>1?"@2x":"";let P=r.m(u.transformRequest(u.normalizeSpriteURL(o,C,".json"),r.R.SpriteJSON),(N,V)=>{P=null,E||(E=N,v=V,U())}),z=r.n(u.transformRequest(u.normalizeSpriteURL(o,C,".png"),r.R.SpriteImage),(N,V)=>{z=null,E||(E=N,b=V,U())});function U(){if(E)g(E);else if(v&&b){const N=r.o.getImageData(b),V={};for(const X in v){const{width:Z,height:Y,x:ne,y:ue,sdf:ce,pixelRatio:ae,stretchX:Ee,stretchY:xe,content:Se}=v[X],ye=new r.q({width:Z,height:Y});r.q.copy(N,ye,{x:ne,y:ue},{x:0,y:0},{width:Z,height:Y},null),V[X]={data:ye,pixelRatio:ae!==void 0?ae:1,sdf:ce!==void 0&&ce,stretchX:Ee,stretchY:xe,content:Se,usvg:!1,version:0}}g(null,V)}}return{cancel(){P&&(P.cancel(),P=null),z&&(z.cancel(),z=null)}}})(t,this.map._requestManager,(o,u)=>{if(this._spriteRequest=null,o)this.fire(new r.y(o));else if(u){const g=new Map;for(const v in u)g.set(r.I.from(v),u[v]);this.addImages(g)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}addIconset(t,o){if(o.type==="sprite")return void this._loadSprite(o.url);const u=this.getOwnSourceCache(o.source);if(!u)return void this.fire(new r.y(new Error(`Source "${o.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const g=u.getSource();if(g.type!=="raster-array")return void this.fire(new r.y(new Error(`Source "${o.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));g.partial=!1;const v=new du(t,this.scope,u);this.imageManager.addImageProvider(v,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!r.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const o=this.map._spriteFormat==="auto";var u,g;this._spriteRequest=(g=(v,b)=>{if(this._spriteRequest=null,v)o?this._loadSprite(t):this.fire(new r.y(v));else if(b){const E=new Map;for(const C in b)E.set(r.I.from(C),b[C]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bu((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),r.R.Iconset),(v,b)=>{if(v)return void g(v);const E={},C=r.dg(new r.bt(b));for(const P of C.icons){const z={version:1,pixelRatio:r.o.devicePixelRatio,content:Jp(P),stretchX:P.metadata?Qp(P.metadata.stretch_x_areas):void 0,stretchY:P.metadata?Qp(P.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:P};E[P.name]=z}g(null,E)}))}_validateLayer(t){const o=this.getOwnSource(t.source);if(!o)return;const u=t.sourceLayer;u&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(u)===-1)&&this.fire(new r.y(new Error(`Source layer "${u}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,o)=>{const u=this.fragments[o];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const o in this._sourceCaches){const u=this._sourceCaches[o].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const o=[];for(const u of t){const g=this._layers[u];g&&g.type!=="custom"&&o.push(g.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const t in this._mergedLayers){const o=this._mergedLayers[t];if(o._transitionablePaint&&o._transitionablePaint._values){const u=o._transitionablePaint._values["line-emissive-strength"];if(u&&u.value&&u.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const o=this.getOwnLayer(t);if(o)return o;this.fire(new r.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const o=this.getOwnSource(t);if(o)return o;this.fire(new r.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,o){const u=this.map.painter;if(u)for(let g=t.minzoom||0;g<(t.maxzoom||25.5);g++){const v=t.getProgramIds();if(v)for(const b of v){const E=t.getDefaultProgramParams(b,o.zoom,this._styleColorTheme.lut);E&&(u.style=this,this.fog&&(u._fogVisible=!0,E.overrideFog=!0,u.getOrCreateProgram(b,E)),u._fogVisible=!1,E.overrideFog=!1,u.getOrCreateProgram(b,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,u.getOrCreateProgram(b,E)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const o=this.calculateLightsBrightness();t.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const u=this._changes.isDirty();let g=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const C in E){const{updatedIds:P,removedIds:z}=E[C];(P||z)&&(this._updateWorkerLayers(C,P,z),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const v={};for(const E in this._mergedSourceCaches){const C=this._mergedSourceCaches[E];v[E]=C.used,C.used=!1,C.tileCoverLift=0}for(const E of this._mergedOrder){const C=this._mergedLayers[E];if(C.visibility!=="none"&&C.recalculate(t,this._availableImages),!C.isHidden(t.zoom)){const P=this.getLayerSourceCache(C);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,t)}):this.precompilePrograms(C,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();const b=this.imageManager.getPendingImageProviders();for(const E of b)E.sourceCache.used=!0;for(const E in v){const C=this._mergedSourceCaches[E];v[E]!==C.used&&C.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),u&&this.fire(new r.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const o of t){const u=o.resolvePendingRequests(),g=this.getFragmentStyle(o.scope);g&&g.addImages(u)}}_updateTilesForChangedImages(){const t={};for(const o in this._mergedSourceCaches){const u=this._mergedSourceCaches[o].getSource().scope;t[u]=t[u]||this._changes.getUpdatedImages(u),t[u].length!==0&&this._mergedSourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t[u])}for(const o in t)this._changes.resetUpdatedImages(o)}_updateWorkerLayers(t,o,u){const g=this.getFragmentStyle(t);g&&this.dispatcher.broadcast("updateLayers",{layers:o?g._serializeLayers(o):[],scope:t,removedIds:u||[],options:g.options})}setState(t,o){if(this._checkLoaded(),wl(this,In(t)))return!1;(t=r.dp(t)).layers=wf(t.layers);const u=(function(b,E){if(!b)return[{command:on.setStyle,args:[E]}];let C=[];try{if(!r.by(b.version,E.version))return[{command:on.setStyle,args:[E]}];if(r.by(b.center,E.center)||C.push({command:on.setCenter,args:[E.center]}),r.by(b.zoom,E.zoom)||C.push({command:on.setZoom,args:[E.zoom]}),r.by(b.bearing,E.bearing)||C.push({command:on.setBearing,args:[E.bearing]}),r.by(b.pitch,E.pitch)||C.push({command:on.setPitch,args:[E.pitch]}),r.by(b.sprite,E.sprite)||C.push({command:on.setSprite,args:[E.sprite]}),r.by(b.glyphs,E.glyphs)||C.push({command:on.setGlyphs,args:[E.glyphs]}),r.by(b.imports,E.imports)||(function(V=[],X=[],Z){X=X||[];const Y=(V=V||[]).map(Oa),ne=X.map(Oa),ue=V.reduce(pd,{}),ce=X.reduce(pd,{}),ae=Y.slice();let Ee,xe,Se,ye;for(Ee=0,xe=0;Ee<Y.length;Ee++)Se=Y[Ee],ce.hasOwnProperty(Se)?xe++:(Z.push({command:on.removeImport,args:[Se]}),ae.splice(ae.indexOf(Se,xe),1));for(Ee=0,xe=0;Ee<ne.length;Ee++)Se=ne[ne.length-1-Ee],ae[ae.length-1-Ee]!==Se&&(ue.hasOwnProperty(Se)?(Z.push({command:on.removeImport,args:[Se]}),ae.splice(ae.lastIndexOf(Se,ae.length-xe),1)):xe++,ye=ae[ae.length-Ee],Z.push({command:on.addImport,args:[ce[Se],ye]}),ae.splice(ae.length-Ee,0,Se));for(const fe of X){const De=ue[fe.id];De&&(delete De.data,r.by(De,fe)||Z.push({command:on.updateImport,args:[fe.id,fe]}))}})(b.imports,E.imports,C),r.by(b.transition,E.transition)||C.push({command:on.setTransition,args:[E.transition]}),r.by(b.light,E.light)||C.push({command:on.setLight,args:[E.light]}),r.by(b.fog,E.fog)||C.push({command:on.setFog,args:[E.fog]}),r.by(b.snow,E.snow)||C.push({command:on.setSnow,args:[E.snow]}),r.by(b.rain,E.rain)||C.push({command:on.setRain,args:[E.rain]}),r.by(b.projection,E.projection)||C.push({command:on.setProjection,args:[E.projection]}),r.by(b.lights,E.lights)||C.push({command:on.setLights,args:[E.lights]}),r.by(b.camera,E.camera)||C.push({command:on.setCamera,args:[E.camera]}),r.by(b.iconsets,E.iconsets)||(function(V,X,Z){let Y;for(Y in X=X||{},V=V||{})V.hasOwnProperty(Y)&&(X.hasOwnProperty(Y)||Z.push({command:on.removeIconset,args:[Y]}));for(Y in X){if(!X.hasOwnProperty(Y))continue;const ne=X[Y];V.hasOwnProperty(Y)?r.by(V[Y],ne)||(Z.push({command:on.removeIconset,args:[Y]}),Z.push({command:on.addIconset,args:[Y,ne]})):Z.push({command:on.addIconset,args:[Y,ne]})}})(b.iconsets,E.iconsets,C),!r.by(b["color-theme"],E["color-theme"]))return[{command:on.setStyle,args:[E]}];const P={},z=[];(function(V,X,Z,Y){let ne;for(ne in X=X||{},V=V||{})V.hasOwnProperty(ne)&&(X.hasOwnProperty(ne)||fd(ne,Z,Y));for(ne in X){if(!X.hasOwnProperty(ne))continue;const ue=X[ne];V.hasOwnProperty(ne)?r.by(V[ne],ue)||(V[ne].type==="geojson"&&ue.type==="geojson"&&Cc(V,X,ne)?Z.push({command:on.setGeoJSONSourceData,args:[ne,ue.data]}):Mo(ne,X,Z,Y)):Hl(ne,X,Z)}})(b.sources,E.sources,z,P);const U=[];b.layers&&b.layers.forEach(V=>{V.source&&P[V.source]?C.push({command:on.removeLayer,args:[V.id]}):U.push(V)});let N=b.terrain;N&&P[N.source]&&(C.push({command:on.setTerrain,args:[void 0]}),N=void 0),C=C.concat(z),r.by(N,E.terrain)||C.push({command:on.setTerrain,args:[E.terrain]}),(function(V,X,Z){X=X||[];const Y=(V=V||[]).map(Oa),ne=X.map(Oa),ue=V.reduce(pd,{}),ce=X.reduce(pd,{}),ae=Y.slice(),Ee=Object.create(null);let xe,Se,ye,fe,De,Pe,Be;for(xe=0,Se=0;xe<Y.length;xe++)ye=Y[xe],ce.hasOwnProperty(ye)?Se++:(Z.push({command:on.removeLayer,args:[ye]}),ae.splice(ae.indexOf(ye,Se),1));for(xe=0,Se=0;xe<ne.length;xe++)ye=ne[ne.length-1-xe],ae[ae.length-1-xe]!==ye&&(ue.hasOwnProperty(ye)?(Z.push({command:on.removeLayer,args:[ye]}),ae.splice(ae.lastIndexOf(ye,ae.length-Se),1)):Se++,Pe=ae[ae.length-xe],Z.push({command:on.addLayer,args:[ce[ye],Pe]}),ae.splice(ae.length-xe,0,ye),Ee[ye]=!0);for(xe=0;xe<ne.length;xe++)if(ye=ne[xe],fe=ue[ye],De=ce[ye],!Ee[ye]&&!r.by(fe,De))if(r.by(fe.source,De.source)&&r.by(fe["source-layer"],De["source-layer"])&&r.by(fe.type,De.type)){for(Be in Ic(fe.layout,De.layout,Z,ye,null,on.setLayoutProperty),Ic(fe.paint,De.paint,Z,ye,null,on.setPaintProperty),r.by(fe.slot,De.slot)||Z.push({command:on.setSlot,args:[ye,De.slot]}),r.by(fe.filter,De.filter)||Z.push({command:on.setFilter,args:[ye,De.filter]}),r.by(fe.minzoom,De.minzoom)&&r.by(fe.maxzoom,De.maxzoom)||Z.push({command:on.setLayerZoomRange,args:[ye,De.minzoom,De.maxzoom]}),fe)fe.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?Ic(fe[Be],De[Be],Z,ye,Be.slice(6),on.setPaintProperty):r.by(fe[Be],De[Be])||Z.push({command:on.setLayerProperty,args:[ye,Be,De[Be]]}));for(Be in De)De.hasOwnProperty(Be)&&!fe.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?Ic(fe[Be],De[Be],Z,ye,Be.slice(6),on.setPaintProperty):r.by(fe[Be],De[Be])||Z.push({command:on.setLayerProperty,args:[ye,Be,De[Be]]}))}else Z.push({command:on.removeLayer,args:[ye]}),Pe=ae[ae.lastIndexOf(ye)+1],Z.push({command:on.addLayer,args:[De,Pe]})})(U,E.layers,C)}catch(P){console.warn("Unable to compute style diff:",P),C=[{command:on.setStyle,args:[E]}]}return C})(this.serialize(),t).filter(b=>!(b.command in Ag));if(u.length===0)return!1;const g=u.filter(b=>!(b.command in Eg));if(g.length>0)throw new Error(`Unimplemented: ${g.map(b=>b.command).join(", ")}.`);const v=[];return u.forEach(b=>{v.push(this[b.command](...b.args))}),o&&Promise.all(v).then(o).catch(o),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[o,u]of t.entries()){if(this.getImage(o))return this.fire(new r.y(new Error(`An image with the name "${o.name}" already exists.`)));this.imageManager.addImage(o,this.scope,u),this._changes.updateImage(o,this.scope)}return this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this}addImage(t,o){return this.getImage(t)?this.fire(new r.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,o),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this)}updateImage(t,o,u=!1){this.imageManager.updateImage(t,this.scope,o),u&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new r.z("data",{dataType:"style"})),this}addModel(t,o,u={}){return this._checkLoaded(),this._validate(Me,`models.${t}`,o,null,u)||(this.modelManager.addModel(t,o,this.getActualScope()),this.fire(new r.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,o,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Xr,`sources.${t}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const g=Ia(t,o,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));const v=b=>{const E=(b?"symbol:":"other:")+g.id,C=r.B(E,this.scope),P=this._sourceCaches[E]=new es(C,g,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=P,P.onAdd(this.map)};v(!1),o.type!=="vector"&&o.type!=="geojson"||v(!0),g.onAdd&&g.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const o=this.getOwnSource(t);if(!o)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const g=Object.entries(this.stylesheet.iconsets).find(([v,b])=>b.type==="source"&&b.source===t);if(g)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while iconset "${g[0]}" is using it.`)))}const u=this.getOwnSourceCaches(t);for(const g of u){const v=r.dq(g.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(g.id),g.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getOwnSource(t).setData(o),this._changes.setDirty()}getOwnSource(t){const o=this.getOwnSourceCache(t);return o&&o.getSource()}getOwnSources(){const t=[];for(const o in this._otherSourceCaches){const u=this.getOwnSourceCache(o);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const o in t){const u=t[o]._tiles;for(const g in u){const v=u[g];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const v of t){if(this._validate(pt,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(v),b.updateTransitions(o)}else this.ambientLight=new sn(v,ir(),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(v),b.updateTransitions(o)}else this.directionalLight=new sn(v,On(),this.scope,this.options)}}const u=Object.assign(o,{worldview:this.map.getWorldview()}),g=new r.ac(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,o=this.ambientLight;if(!t||!o)return;const u=N=>.2126*(N[0]<=.03928?N[0]/12.92:Math.pow((N[0]+.055)/1.055,2.4))+.7152*(N[1]<=.03928?N[1]/12.92:Math.pow((N[1]+.055)/1.055,2.4))+.0722*(N[2]<=.03928?N[2]/12.92:Math.pow((N[2]+.055)/1.055,2.4)),g=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),v=t.properties.get("intensity"),b=t.properties.get("direction"),E=1-r.d4(b.x,b.y,b.z)[2]/90,C=u(g)*v*E,P=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),z=o.properties.get("intensity"),U=u(P)*z;return Number(((C+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(r.dr(t)){const o=r.ds(t),u=this.fragments.find(({id:v})=>v===o);if(!u)return;const g=r.dq(t);return u.style.getFragmentStyle(g)}{const o=this.fragments.find(({id:u})=>u===t);return o?o.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const o={},u=(g,v="")=>`${g}::${v}`;this._featuresetSelectors={};for(const g in t){const v=this._featuresetSelectors[g]=[];for(const b of t[g].selectors){if(b.featureNamespace){const C=this.getOwnLayer(b.layer);if(!C){r.w(`Layer is undefined for selector: ${b.layer}`);continue}const P=u(C.source,C.sourceLayer);if(P in o&&o[P]!==b.featureNamespace){r.w(`"featureNamespace ${b.featureNamespace} of featureset ${g}'s selector is not associated to the same source, skip this selector`);continue}o[P]=b.featureNamespace}let E;if(b.properties)for(const C in b.properties){const P=r.U(b.properties[C]);P.result==="success"&&(E=E||{},E[C]=P.value)}v.push({layerId:b.layer,namespace:b.featureNamespace,properties:E,uniqueFeatureID:b._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const o=this.getFragmentStyle(t);if(!o||!o.stylesheet.featuresets)return[];const u=[];for(const g in o.stylesheet.featuresets)u.push({featuresetId:g,importId:o.scope?o.scope:void 0});return u}getFeaturesetLayers(t,o){const u=this.getFragmentStyle(o),g=u.stylesheet.featuresets;if(!g||!g[t])return this.fire(new r.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const v=[];for(const b of g[t].selectors){const E=u.getOwnLayer(b.layer);E&&v.push(E)}return v}getConfigProperty(t,o){const u=this.getFragmentStyle(t);if(!u)return null;const g=r.B(o,u.scope),v=u.options.get(g),b=v?v.value||v.default:null;return b?b.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,o){const u=r.B(t,o);return this._mergedIndoor[u]}setIndoorData(t,o){this.indoorManager.setIndoorData(o)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,o,u){const g=this.getFragmentStyle(t);if(!g)return;const v=g.stylesheet.schema;if(!v||!v[o])return;const b=r.U(u);if(b.result!=="success")return void wl(this,b.value);const E=b.value.expression,C=r.B(o,g.scope),P=g.options.get(C);if(!P)return;let z;const{minValue:U,maxValue:N,stepValue:V,type:X,values:Z}=v[o],Y=r.U(v[o].default);Y.result==="success"&&(z=Y.value.expression),z?(this.options.set(C,Object.assign({},P,{value:E,default:z,minValue:U,maxValue:N,stepValue:V,type:X,values:Z})),this.updateConfigDependencies(o)):this.fire(new r.y(new Error(`No schema defined for the config option "${o}" in the "${t}" fragment.`)))}getConfig(t){const o=this.getFragmentStyle(t);if(!o)return null;const u=o.stylesheet.schema;if(!u)return null;const g={};for(const v in u){const b=r.B(v,o.scope),E=o.options.get(b),C=E?E.value||E.default:null;g[v]=C?C.serialize():null}return g}setConfig(t,o){const u=this.getFragmentStyle(t);u&&(u.updateConfig(o,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const o=this.getFragmentStyle(t);return o?o.stylesheet.schema:null}setSchema(t,o){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=o,u.updateConfig(u._config,o),this.updateConfigDependencies())}updateConfig(t,o){if(this._config=t,t||o)if(o)for(const u in o){let g,v;const b=r.U(o[u].default);if(b.result==="success"&&(g=b.value.expression),t&&t[u]!==void 0){const N=r.U(t[u]);N.result==="success"&&(v=N.value.expression)}const{minValue:E,maxValue:C,stepValue:P,type:z,values:U}=o[u];if(g){const N=r.B(u,this.scope);this.options.set(N,{default:g,value:v,minValue:E,maxValue:C,stepValue:P,type:z,values:U})}else this.fire(new r.y(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,o=()=>!0){for(const u of t){const g=this.getLayer(u);g&&o(g)&&(g.possiblyEvaluateVisibility(),this._updateLayer(g),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,o=>!t||o.expressionDependencies.configDependencies.has(t)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(o=>{const u=o._styleColorTheme.colorThemeOverride?o._styleColorTheme.colorThemeOverride:o._styleColorTheme.colorTheme;if(u){const g=o._evaluateColorThemeData(u);(!o._styleColorTheme.lut&&g!==""||o._styleColorTheme.lut&&g!==o._styleColorTheme.lut.data)&&o.setColorTheme(u)}}),this._changes.setDirty()}addLayer(t,o,u={}){this._checkLoaded();const g=t.id;if(this._layers[g])return void this.fire(new r.y(new Error(`Layer with id "${g}" already exists on this map`)));let v;if(t.type==="custom"){if(wl(this,r.dt(t)))return;v=r.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(g,t.source),t=r.dp(t),t=Object.assign(t,{source:g})),this._validate(Le,`layers.${g}`,t,{arrayIndex:-1},u))return;v=r.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}})}const b=r.B(v.source,v.scope);v.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b),v.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b);let E=this._order.length;if(o){const U=this._order.indexOf(o);if(U===-1)return void this.fire(new r.y(new Error(`Layer with id "${o}" does not exist on this map.`)));v.slot&&v.slot!==this._layers[o].slot?r.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`):E=U}this._order.splice(E,0,g),this._handleLayerOrderChange(),this._layers[g]=v;const C=this.getOwnLayerSourceCache(v),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&v.canCastShadows()&&P&&(C.castsShadows=!0);const z=this._changes.getRemovedLayer(v);if(z&&v.source&&C&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const U=r.B(v.source,v.scope);z.type!==v.type?this._changes.updateSourceCache(U,"clear"):(this._changes.updateSourceCache(U,"reload"),C.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(t,o){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===o)return;const g=this._order.indexOf(t);this._order.splice(g,1);let v=this._order.length;if(o){const b=this._order.indexOf(o);if(b===-1)return void this.fire(new r.y(new Error(`Layer with id "${o}" does not exist on this map.`)));u.slot&&u.slot!==this._layers[o].slot?r.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`):v=b}this._order.splice(v,0,t),this._changes.setDirty(),this._handleLayerOrderChange(),this.mergeLayers()}removeLayer(t){this._checkLoaded();const o=this._checkLayer(t);if(!o)return;o.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._handleLayerOrderChange(),this._configDependentLayers.delete(o.fqid),this._indoorDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const g=this.getOwnLayerSourceCache(o);if(g&&g.castsShadows){let v=!1;for(const b in this._layers)if(this._layers[b].source===o.source&&this._layers[b].canCastShadows()){v=!0;break}g.castsShadows=v}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,u){this._checkLoaded();const g=this._checkLayer(t);g&&(g.minzoom===o&&g.maxzoom===u||(o!=null&&(g.minzoom=o),u!=null&&(g.maxzoom=u),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,o){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==o&&(u.slot=o,this._updateLayer(u))}setFilter(t,o,u={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!r.by(g.filter,o))return o==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(J,`layers.${g.id}.filter`,o,{layerType:g.type},u)||(g.filter=r.dp(o),this._updateLayer(g)))}getFilter(t){const o=this._checkLayer(t);if(o)return r.dp(o.filter)}setLayoutProperty(t,o,u,g={}){this._checkLoaded();const v=this._checkLayer(t);if(v&&!r.by(v.getLayoutProperty(o),u)){if(u!=null&&(!g||g.validate!==!1)&&wl(v,ge.call(In,{key:`layers.${t}.layout.${o}`,layerType:v.type,objectKey:o,value:u,styleSpec:r.a6,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(o,u),v.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),v.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(v.fqid),this._updateLayer(v)}}setLayerProperty(t,o,u,g={}){this._checkLoaded();const v=this._checkLayer(t);v&&(o==="appearances"?(v.setAppearances(u),this._changes.setDirty()):v.isPaintProperty(o)?this.setPaintProperty(t,o,u,g):this.setLayoutProperty(t,o,u,g))}getLayoutProperty(t,o){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(o)}setPaintProperty(t,o,u,g={}){this._checkLoaded();const v=this._checkLayer(t);if(!v||r.by(v.getPaintProperty(o),u)||u!=null&&(!g||g.validate!==!1)&&wl(v,re.call(In,{key:`layers.${t}.paint.${o}`,layerType:v.type,objectKey:o,value:u,styleSpec:r.a6})))return;const b=v.setPaintProperty(o,u);v.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),v.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(v.fqid),b&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(t,o){const u=this._checkLayer(t);if(u)return u.getPaintProperty(o)}setFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:P}=t.target,z=this.getFragmentStyle(P),U=z.getFeaturesetLayers(C);for(const{source:N,sourceLayer:V}of U)z.setFeatureState({id:t.id,source:N,sourceLayer:V},o)}else if("layerId"in t.target){const{layerId:C}=t.target,P=this.getLayer(C);this.setFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},o)}return}const u=t.source,g=t.sourceLayer,v=this._checkSource(u);if(!v)return;const b=v.type;if(b==="geojson"&&g)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!g)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const E=this.getOwnSourceCaches(u);for(const C of E)C.setFeatureState(g,t.id,o)}removeFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:P}=t.target,z=this.getFragmentStyle(P),U=z.getFeaturesetLayers(C);for(const{source:N,sourceLayer:V}of U)z.removeFeatureState({id:t.id,source:N,sourceLayer:V},o)}else if("layerId"in t.target){const{layerId:C}=t.target,P=this.getLayer(C);this.removeFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},o)}return}const u=t.source,g=this._checkSource(u);if(!g)return;const v=g.type,b=v==="vector"?t.sourceLayer:void 0;if(v==="vector"&&!b)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const E=this.getOwnSourceCaches(u);for(const C of E)C.removeFeatureState(b,t.id,o)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let v;if("featuresetId"in t.target){const{featuresetId:b,importId:E}=t.target,C=this.getFragmentStyle(E),P=C.getFeaturesetLayers(b);for(const{source:z,sourceLayer:U}of P){const N=C.getFeatureState({id:t.id,source:z,sourceLayer:U});if(N&&!v)v=N;else if(!r.by(v,N))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:b}=t.target,E=this.getLayer(b);v=this.getFeatureState({id:t.id,source:E.source,sourceLayer:E.sourceLayer})}return v}const o=t.source,u=t.sourceLayer,g=this._checkSource(o);if(g){if(g.type!=="vector"||u)return t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(u,t.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),o=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,featuresets:this.stylesheet.featuresets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,indoor:this.stylesheet.indoor,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(t){for(const o of Object.values(this._mergedLayers))t(o)&&this._updateLayer(o)}_updateLayer(t){this._changes.updateLayer(t);const o=this.getLayerSourceCache(t),u=r.B(t.source,t.scope),g=this._changes.getUpdatedSourceCaches();t.source&&!g[u]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),o.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const o=E=>this._mergedLayers[E].is3D(!!this.terrain),u=this.order,g={},v=[];for(let E=u.length-1;E>=0;E--){const C=u[E];if(o(C)){g[C]=E;for(const P of t){const z=P[C];if(z)for(const U of z)v.push(U)}}}v.sort((E,C)=>C.intersectionZ-E.intersectionZ);const b=[];for(let E=u.length-1;E>=0;E--){const C=u[E];if(o(C))for(let P=v.length-1;P>=0;P--){const z=v[P].feature;if(z.layer&&g[z.layer.id]<E)break;b.push(z),v.pop()}else for(const P of t){const z=P[C];if(z)for(const U of z)b.push(U.feature)}}return b}queryRasterValue(t,o,u){const g=this.getOwnSource(t);return g?g.type!=="raster-array"?(this.fire(new r.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):g.queryRasterArrayValue(o,u):(this.fire(new r.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,o,u){let g;o&&!Array.isArray(o)&&o.filter&&(this._validate(J,"queryRenderedFeatures.filter",o.filter,null,o),g=r.b6(o.filter));const v={},b=z=>{if(Df.has(z.type))return;const U=this.getOwnLayerSourceCache(z),N=v[U.id]=v[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};z.is3D(!!this.terrain)&&(N.has3DLayers=!0),N.layers[z.fqid]=N.layers[z.fqid]||{styleLayer:z,targets:[]},N.layers[z.fqid].targets.push({filter:g})};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const z of o.layers){const U=this._layers[z];if(!U)return this.fire(new r.y(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];b(U)}}else for(const z in this._layers)b(this._layers[z]);const E=this._queryRenderedFeatures(t,v,u),C=this._flattenAndSortRenderedFeatures(E),P=[];for(const z of C)r.dw(z.layer.id)===this.scope&&P.push(z);return P}queryRenderedFeatureset(t,o,u){let g;o&&!Array.isArray(o)&&o.filter&&(this._validate(J,"queryRenderedFeatures.filter",o.filter,null,o),g=r.b6(o.filter));const v="mock",b=[];if(o&&o.target)b.push(Object.assign({},o,{targetId:v,filter:g}));else{const z=this.getFeaturesetDescriptors();for(const U of z)b.push({targetId:v,filter:g,target:U});for(const{style:U}of this.fragments){const N=U.getFeaturesetDescriptors();for(const V of N)b.push({targetId:v,filter:g,target:V})}}const E=this.queryRenderedTargets(t,b,u),C=[],P=new Set;for(const z of E)for(const U of z.variants[v])rh(U,z,P)||C.push(new r.dx(z,U));return C}queryRenderedTargets(t,o,u){const g={},v=(E,C,P,z)=>{const U=g[C.id]=g[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(U.layers[E.fqid]=U.layers[E.fqid]||{styleLayer:E,targets:[]},E.is3D(!!this.terrain)&&(U.has3DLayers=!0),!z)return P.uniqueFeatureID=!1,void U.layers[E.fqid].targets.push(P);U.layers[E.fqid].targets.push(Object.assign({},P,{namespace:z.namespace,properties:z.properties,uniqueFeatureID:z.uniqueFeatureID}))};for(const E of o)if("featuresetId"in E.target){const{featuresetId:C,importId:P}=E.target,z=this.getFragmentStyle(P);if(!z||!z._featuresetSelectors)continue;const U=z._featuresetSelectors[C];if(!U){this.fire(new r.y(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const N of U){const V=z.getOwnLayer(N.layerId);V&&!Df.has(V.type)&&v(V,z.getOwnLayerSourceCache(V),E,N)}}else if("layerId"in E.target){const{layerId:C}=E.target,P=this.getLayer(C);if(!P||Df.has(P.type))continue;v(P,this.getLayerSourceCache(P),E)}const b=this._queryRenderedFeatures(t,g,u);return this._flattenAndSortRenderedFeatures(b)}_queryRenderedFeatures(t,o,u){const g=[],v=!!this.map._showQueryGeometry,b=Un.createFromScreenPoints(t,u);for(const E in o){const C=vl(b,o[E],this._availableImages,u,v,this.getActualScope());Object.keys(C).length&&g.push(C)}if(this.placement)for(const E in o){if(!o[E].sourceCache._onlySymbols)continue;const C=yg(b.screenGeometry,o[E],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(C).length&&g.push(C)}return g}querySourceFeatures(t,o){const u=o&&o.filter;u&&this._validate(J,"querySourceFeatures.filter",u,null,o);let g=[];const v=this.getOwnSourceCaches(t);for(const b of v)g=g.concat(Vp(b,o));return g}addSourceType(t,o,u){return bo.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(bo.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,o,u={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const E in t)if(!r.by(t[E],g[E])){v=!0;break}if(!v)return;const b=this._getTransitionParameters();this.light.setLight(t,o,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,o=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const g=!("source"in t)||t.source==null;if(o===1){if(this.disableElevatedTerrain)return;if("source"in u&&typeof u.source=="object"){const E="terrain-dem-src";this.addSource(E,u.source),u=r.dp(u),u=Object.assign(u,{source:E})}const v=Object.assign({},u),b={};if(this.terrain&&g){v.source=this.terrain.get().source;const E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(b.style=E.serialize())}if(this._validate(Yn,"terrain",v,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&o!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,o),this.fire(new r.z("data",{dataType:"style"}))}else{const v=this.terrain,b=v.get();for(const E of Object.keys(r.a6.terrain))!u.hasOwnProperty(E)&&r.a6.terrain[E].default&&(u[E]=r.a6.terrain[E].default);for(const E in t)if(!r.by(t[E],b[E])){v.set(t,this.options),this.stylesheet.terrain=t;const C=this._getTransitionParameters({duration:0});v.updateTransitions(C),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const o=this.fog=new bi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}_createSnow(t){const o=this.snow=new Cr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}_createRain(t){const o=this.rain=new Kn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!r.by(o.get(),t)){o.set(t,this.options),this.stylesheet.fog=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const o=this.snow;if(!r.by(o.get(),t)){o.set(t,this.options),this.stylesheet.snow=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const o=this.rain;if(!r.by(o.get(),t)){o.set(t,this.options),this.stylesheet.rain=o.get();const u=this._getTransitionParameters({duration:0});o.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(const g in this._sourceCaches)this._sourceCaches[g].clearTiles()},o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!o)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(o);this._loadColorTheme(u).then(()=>{this.fire(new r.z("colorthemeset")),t()}).catch(g=>{r.w(`Couldn't set color theme: ${g}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,o){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=o,u._reloadColorTheme())}_getTransitionParameters(t){return{now:r.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],o=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):o.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){const u=this.terrain=new vt(t,o,this.scope,this.options,this.map.getWorldview());o===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});u.updateTransitions(g)}_force3DLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,u,g,v={}){if(v&&v.validate===!1)return!1;const b=Object.assign({},this.serialize());return wl(this,t.call(In,Object.assign({key:o,style:b,value:u,styleSpec:r.a6},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.indoorManager.destroy(),this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const o=this.getSourceCaches(t);for(const u of o)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const o=this._mergedLayers[t];o._clear&&o._clear()}}reloadSource(t){const o=this.getSourceCaches(t);for(const u of o)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let o;this.directionalLight&&(o=If(this.directionalLight));const u=new Set,g=new Set;for(const v in this._mergedLayers){const b=this._mergedLayers[v];b.type==="building"&&u.add(b.source),b.hasElevation()&&!g.has(b.source)&&g.add(b.source)}for(const v in this._mergedSourceCaches){const b=this._mergedSourceCaches[v],E=g.has(b._source.id);u.has(b._source.id)&&(b._source.reparseOverscaled=!1),b.update(t,void 0,void 0,o,E)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const o=this._sourceCaches[t];o.resume(),o.reload()}}_handleLayerOrderChange(){this._requestFullLabelPlacement(),this.fire(new r.z("neworder"))}_requestFullLabelPlacement(){this.pauseablePlacement||(this.pauseablePlacement=new Yp),this.pauseablePlacement.requestFullPlacement()}_setLabelPlacementStale(){this.placement&&this.placement.setStale()}_updatePlacement(t,o,u,g,v){this.pauseablePlacement||(this.pauseablePlacement=new Yp);let b=!1,E=!1;const C={},P={};for(const Z of this._mergedOrder){const Y=this._mergedLayers[Z];if(Y.type!=="symbol")continue;const ne=r.B(Y.source,Y.scope);let ue=C[ne];if(!ue){const ae=this.getLayerSourceCache(Y);if(!ae)continue;const Ee=ae.getRenderableIds(!0).map(xe=>ae.getTileByID(xe));P[ne]=Ee.slice(),ue=C[ne]=Ee.sort((xe,Se)=>Se.tileID.overscaledZ-xe.tileID.overscaledZ||(xe.tileID.isLessThan(Se.tileID)?-1:1))}const ce=this.crossTileSymbolIndex.addLayer(Y,ue,t.center.lng,t.projection);b=b||ce}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder);const z=!!(this.placement&&!t.equals(this.placement.transform)),U=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!v||this.placement.lastReplacementSourceUpdateTime!==v.updateTime)),N=z||U||b,V=(N||this.pauseablePlacement.isStale())&&u===0,X=this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.o.now(),t.zoom)&&u!==0;if((this.pauseablePlacement.isFullPlacementRequested()||!this.pauseablePlacement.placement||V||X)&&(this.pauseablePlacement=this.pauseablePlacement.startNewPlacement(t,this._mergedOrder,o,u,g,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex)),this.pauseablePlacement.isDone()?N&&u!==0&&this.pauseablePlacement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,C,P,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.o.now()),E=!0),b&&this.pauseablePlacement.setStale()),E||b){this._buildingIndex.onNewFrame(t.zoom);for(let Z=0;Z<this._mergedOrder.length;Z++){const Y=this._mergedLayers[this._mergedOrder[Z]];if(Y.type!=="symbol"||Y.visibility==="none")continue;const ne=this.isLayerClipped(Y);this.placement.updateLayerOpacities(Y,C[r.B(Y.source,Y.scope)],Z,ne?v:null)}}return!this.pauseablePlacement.isDone()||this.placement.isStale()||this.placement.hasTransitions(r.o.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,o){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:v})=>v===t.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!o)return u.push(t),this._loadImports([t],!0);const g=u.findIndex(({id:v})=>v===o);return g===-1&&this.fire(new r.y(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,g).concat(t).concat(u.slice(g)),this._loadImports([t],!0,o)}updateImport(t,o){this._checkLoaded();const u=this.stylesheet.imports||[],g=this.getImportIndex(t);return g===-1?this:typeof o=="string"?(this.setImportUrl(t,o),this):(o.url&&o.url!==u[g].url&&this.setImportUrl(t,o.url),r.by(o.config,u[g].config)||this.setImportConfig(t,o.config,o.data.schema),r.by(o.data,u[g].data)||this.setImportData(t,o.data),this)}moveImport(t,o){this._checkLoaded();let u=this.stylesheet.imports||[];const g=this.getImportIndex(t);if(g===-1)return this;const v=this.getImportIndex(o);if(v===-1)return this;const b=u[g],E=this.fragments[g];return u=u.filter(({id:C})=>C!==t),this.fragments=this.fragments.filter(({id:C})=>C!==t),this.stylesheet.imports=u.slice(0,v).concat(b).concat(u.slice(v)),this.fragments=this.fragments.slice(0,v).concat(E).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(t,o){this._checkLoaded();const u=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;u[g].url=o;const v=this.fragments[g];return v.style=this._createFragmentStyle(u[g]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(o),this}setImportData(t,o){this._checkLoaded();const u=this.getImportIndex(t),g=this.stylesheet.imports||[];return u===-1?this:o?(this.fragments[u].style.setState(o),this._reloadImports(),this):(delete g[u].data,this.setImportUrl(t,g[u].url))}setImportConfig(t,o,u){this._checkLoaded();const g=this.getImportIndex(t),v=this.stylesheet.imports||[];if(g===-1)return this;o?v[g].config=o:delete v[g].config;const b=this.fragments[g];u&&b.style.stylesheet&&(b.style.stylesheet.schema=u);const E=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=o,b.style.updateConfig(o,E),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const o=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(o.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const o=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return o===-1&&this.fire(new r.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),o}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const o in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[o];u&&t.push(u.getSource())}return t}getSource(t,o){const u=this.getSourceCache(t,o);return u&&u.getSource()}getLayerSource(t){const o=this.getLayerSourceCache(t);return o&&o.getSource()}getSourceCache(t,o){const u=r.B(t,o);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const o=r.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[t]&&o.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&o.push(this._mergedSymbolSourceCaches[t]),o}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const o in t){const u=t[o];u==="reload"?this.reloadSource(o):u==="clear"&&this.clearSource(o)}}updateLayers(t){const o=this._changes.getUpdatedPaintProperties();for(const u of o){const g=this.getLayer(u);g&&g.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,o,u){this.imageManager.getImages(o.images,o.scope,u),this._updateTilesForChangedImages();const g=b=>{if(b){const E=o.images.map(C=>r.I.toString(C));b.setDependencies(o.tileID.key,o.type,E)}},v=r.B(o.source,o.scope);g(this._mergedOtherSourceCaches[v]),g(this._mergedSymbolSourceCaches[v]),o.images.some(b=>b.iconsetId)&&this.fire(new r.z("data",{dataType:"style"}))}rasterizeImages(t,o,u){this.imageManager.rasterizeImages(o,u)}getGlyphs(t,o,u){this.glyphManager.getGlyphs(o.stacks,u)}getResource(t,o,u){return r.dz(o,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){const o=this.getOwnSourceCaches(t);return o.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${t}'`))),!1):o.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,o){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const u=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),g=t.type==="building";if(t.is3D(!!this.terrain)){if(u||g||o&&o.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}bo.getSourceType=function(c){return qa[c]},bo.setSourceType=function(c,t){qa[c]=t},bo.registerForPluginStateChange=r.dA;var ga=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,mh=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ao=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Wa="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",xd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,fu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,wo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,pu=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,zt=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Pf=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,gh=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Tl=/#include\s+"([^"]+)"/g,Sl=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Lo=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Kl=new Set(["ifdef","ifndef","elif","if","defined"]),ko=new Set;zs(ga,ko),zs(ao,ko),zs(mh,ko);const Jl={"_prelude_fog.vertex.glsl":fu,"_prelude_terrain.vertex.glsl":xd,"_prelude_shadow.vertex.glsl":Pf,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":wo,"_prelude_shadow.fragment.glsl":gh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":pu,"_prelude_raster_particle.glsl":zt},mu={};Qi("",xd),Qi(wo,fu),Qi(gh,Pf),Qi(pu,""),Qi(zt,"");const Dc=Qi(mh,ao),_h=ga,Cg=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",_h,Dc.fragmentSource].join(`
`),zf=["precision highp float;",_h,Dc.vertexSource].join(`
`);var Lf={background:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Qi(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Qi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Qi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Qi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Qi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Qi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Qi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Qi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Qi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Qi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Qi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Qi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Qi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Qi(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform highp vec2 u_trim_gradient_mix_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
in float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;
#ifdef VARIABLE_LINE_WIDTH
blur=mix(blur,0.0,stub_side);
#endif
float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef VARIABLE_LINE_WIDTH
alpha=mix(alpha,1.0,stub_side);
#endif
alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);highp float gradient_trim_color_mix_factor=0.0;
#ifdef RENDER_LINE_GRADIENT
gradient_trim_color_mix_factor=smoothstep(u_trim_gradient_mix_range.x,u_trim_gradient_mix_range.y,line_progress);
#endif
highp vec4 trim_color=mix(u_trim_color,out_color,gradient_trim_color_mix_factor);out_color=mix(u_trim_gradient_mix_range.x < 1.0 ? color : out_color,trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
#ifndef VARIABLE_LINE_WIDTH
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
out float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;offset=-1.0*offset*u_width_scale;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;float left_width=a_z_offset_width.y;float right_width=a_z_offset_width.z;halfwidth=(u_width_scale*(left ? left_width : right_width))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;offset=border_width > 0.0 ? (left_width+right_width)*u_width_scale*0.5 : offset;halfwidth=border_width > 0.0 ? border_width*u_width_scale*0.5 : halfwidth;bool zero_right_width=border_width==0.0 && right_width==0.0;stub_side=zero_right_width ?-normal.y : 0.0;v_normal=!left && zero_right_width ? vec2(0.0) : v_normal;ANTIALIASING=!left && zero_right_width ? 0.0 : ANTIALIASING;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Qi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Qi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Qi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Qi(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define USING_APPEARANCE 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance==USING_APPEARANCE) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Qi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Qi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Wa),skyboxGradient:Qi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Wa),skyboxCapture:Qi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Qi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;
#ifdef DITHERED_DISCARD
uniform float u_dithered_discard_threshold;
#endif
uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef DITHERED_DISCARD
if (abs(u_dithered_discard_threshold) < 1.0) {float ditherValue=fract(52.9829189*fract(0.06711056*gl_FragCoord.x+0.00583715*gl_FragCoord.y));float compareValue=mix(1.0-ditherValue,ditherValue,step(0.0,u_dithered_discard_threshold));if (abs(u_dithered_discard_threshold) < compareValue) {discard;}}
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Qi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Qi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Qi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Qi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Qi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Qi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function zs(c,t){const o=c.split(`
`);for(let u of o){if(u=u.trimStart(),u[0]!=="#"||!u.includes("if")||u.startsWith("#endif"))continue;const g=u.match(Lo);if(g)for(const v of g)Kl.has(v)||t.add(v)}}function Qi(c,t){const o=new Set,u=[],g=[];c=c.replace(Tl,(b,E)=>(g.push(E),"")),t=t.replace(Tl,(b,E)=>(u.push(E),""));let v=new Set(ko);zs(c,v),zs(t,v);for(const b of[...u,...g])mu[b]||(mu[b]=new Set,zs(Jl[b],mu[b])),v=new Set([...v,...mu[b]]);return{fragmentSource:c=c.replace(Sl,(b,E,C,P,z)=>(o.add(z),E==="define"?`
#ifndef HAS_UNIFORM_u_${z}
in ${C} ${P} ${z};
#else
uniform ${C} ${P} u_${z};
#endif
`:E==="initialize"?`
#ifdef HAS_UNIFORM_u_${z}
    ${C} ${P} ${z} = u_${z};
#endif
`:E==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${C} ${P} ${z};
#endif
`:E==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(Sl,(b,E,C,P,z)=>{const U=`MATERIAL_ATTRIBUTE_OFFSET_${z}`,N=P==="float"?"vec2":P,V=`GET_ATTRIBUTE_${N}(a_${z}, materialInfo, ${U})`,X=z.match(/color/)?"color":N;return E==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${z}
in ${C} ${P} a_${z};
#endif
`:o.has(z)?E==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
    #if !defined(${U})
        in ${C} ${N} a_${z};
    #endif
out ${C} ${P} ${z};
#else
uniform ${C} ${P} u_${z};
#endif
`:E==="initialize"?X==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${C} ${P} ${z} = u_${z};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${z})
    #ifdef ${U}
        ${z} = unpack_mix_${X}(${V}, u_${z}_t);
    #else
        ${z} = unpack_mix_${X}(a_${z}, u_${z}_t);
    #endif
#else
    ${C} ${P} ${z} = u_${z};
#endif
`:E==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${C} ${P} a_${z};
    out ${C} ${P} ${z};
#endif
`:E==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${z} = a_${z};
#endif
`:void 0:E==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
    #if !defined(${U})
        in ${C} ${N} a_${z};
    #endif
#else
uniform ${C} ${P} u_${z};
#endif
`:E==="define-instanced"?X==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${z}0;
in vec4 a_${z}1;
in vec4 a_${z}2;
in vec4 a_${z}3;
#else
uniform ${C} ${P} u_${z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${C} ${N} a_${z};
#else
uniform ${C} ${P} u_${z};
#endif
`:E==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${C} ${P} ${z} = a_${z};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    #ifdef ${U}
        ${C} ${P} ${z} = ${V};
    #else
        ${C} ${P} ${z} = a_${z};
    #endif
#else
    ${C} ${P} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    #ifdef ${U}
        ${C} ${P} ${z} = unpack_mix_${X}(${V}, u_${z}_t);
    #else
        ${C} ${P} ${z} = unpack_mix_${X}(a_${z}, u_${z}_t);
    #endif
#else
    ${C} ${P} ${z} = u_${z};
#endif
`}),usedDefines:v,vertexIncludes:u,fragmentIncludes:g}}class yh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,u,g,v,b,E,C){this.context=t;let P=this.boundPaintVertexBuffers.length!==g.length;for(let U=0;!P&&U<g.length;U++)this.boundPaintVertexBuffers[U]!==g[U]&&(P=!0);let z=this.boundDynamicVertexBuffers.length!==E.length;for(let U=0;!z&&U<E.length;U++)this.boundDynamicVertexBuffers[U]!==E[U]&&(z=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||P||z||this.boundIndexBuffer!==v||this.boundVertexOffset!==b)this.freshBind(o,u,g,v,b,E,C);else{t.bindVertexArrayOES.set(this.vao);for(const U of E)U&&(U.bind(),C&&U.instanceCount&&U.setVertexAttribDivisor(t.gl,o,C));v&&v.dynamicDraw&&v.bind()}}freshBind(t,o,u,g,v,b,E){const C=this.context,P=C.gl;this.vao&&this.destroy(),this.vao=C.gl.createVertexArray(),C.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=b,o.enableAttributes(P,t),o.bind(),o.setVertexAttribPointers(P,t,v);for(const z of u)z.enableAttributes(P,t),z.bind(),z.setVertexAttribPointers(P,t,v);for(const z of b)z&&(z.enableAttributes(P,t),z.bind(),z.setVertexAttribPointers(P,t,v),E&&z.instanceCount&&z.setVertexAttribDivisor(P,t,E));g&&g.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function kf(c,t){const o=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new r.ae(0,u/o).toLngLat().lat,new r.ae(0,(u+1)/o).toLngLat().lat]}function bd(c,t,o,u,g,v,b){const E=c.context,C=E.gl,P=o.hillshadeFBO;if(!P)return;c.prepareDrawTile();const z=c.isTileAffectedByFog(t),U=[];c.terrain&&c.terrain.renderingToTexture&&c.emissiveMode==="mrt-fallback"&&U.push("USE_MRT1");const N=c.getOrCreateProgram("hillshade",{overrideFog:z,defines:U});E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,P.colorAttachment0.get());const V=((ne,ue,ce,ae)=>{const Ee=ce.paint.get("hillshade-shadow-color"),xe=ce.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Se=ce.paint.get("hillshade-highlight-color"),ye=ce.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",fe=ce.paint.get("hillshade-accent-color"),De=ce.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Pe=ce.paint.get("hillshade-emissive-strength");let Be=r.an(ce.paint.get("hillshade-illumination-direction"));if(ce.paint.get("hillshade-illumination-anchor")==="viewport")Be-=ne.transform.angle;else if(ne.style&&ne.style.enable3dLights()&&ne.style.directionalLight){const Ve=ne.style.directionalLight.properties.get("direction"),Qe=r.d4(Ve.x,Ve.y,Ve.z);Be=r.an(Qe[1])}const He=!ne.options.moving;return{u_matrix:ae||ne.transform.calculateProjMatrix(ue.tileID.toUnwrapped(),He),u_image:0,u_latrange:kf(0,ue.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),Be],u_shadow:Ee.toPremultipliedRenderColor(xe?null:ce.lut),u_highlight:Se.toPremultipliedRenderColor(ye?null:ce.lut),u_emissive_strength:Pe,u_accent:fe.toPremultipliedRenderColor(De?null:ce.lut)}})(c,o,u,c.terrain?t.projMatrix:null);c.uploadCommonUniforms(E,N,t.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:Z,tileBoundsSegments:Y}=c.getTileBoundsBuffers(o);N.draw(c,C.TRIANGLES,g,v,b,gi.disabled,V,u.id,X,Z,Y)}function ta(c,t,o){if(!t.needsDEMTextureUpload)return;const u=c.context,g=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(o.stride);const v=o.getPixels();t.demTexture?t.demTexture.update(v,{premultiply:!1}):t.demTexture=new r.T(u,v,g.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function La(c,t,o){const u=c.context,g=u.gl;if(!t.dem)return;const v=t.dem;if(u.activeTexture.set(g.TEXTURE1),ta(c,t,v),!t.demTexture)return;t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const b=v.dim;u.activeTexture.set(g.TEXTURE0);let E=t.hillshadeFBO;if(!E){const N=new r.T(u,{width:b,height:b,data:null},g.RGBA8);N.bind(g.LINEAR,g.CLAMP_TO_EDGE),E=t.hillshadeFBO=u.createFramebuffer(b,b,1,"renderbuffer"),E.colorAttachment0.set(N.texture)}u.bindFramebuffer.set(E.framebuffer),u.viewport.set([0,0,b,b]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:P,tileBoundsSegments:z}=c.getMercatorTileBoundsBuffers(),U=[];c.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),c.terrain&&c.terrain.renderingToTexture&&c.emissiveMode==="mrt-fallback"&&U.push("USE_MRT1"),c.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(c,g.TRIANGLES,ii.disabled,xi.disabled,wi.unblended,gi.disabled,((N,V)=>{const X=V.stride,Z=r.bC();return r.ce(Z,0,r.al,-r.al,0,0,1),r.br(Z,Z,[0,-r.al,0]),{u_matrix:Z,u_image:1,u_dimension:[X,X],u_zoom:N.overscaledZ}})(t.tileID,v),o.id,C,P,z),t.needsHillshadePrepare=!1}class zn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class El extends zn{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Xa extends zn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ya extends zn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class wd extends zn{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Td extends zn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ql extends zn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class gu extends zn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class fs extends zn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class wr extends zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class Zn extends zn{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Al extends zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class _a extends zn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Oc extends zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class Ka extends zn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Sd extends zn{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Bf extends zn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class ec extends zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class Ja extends zn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ff extends zn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let vh=class extends zn{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class Nf extends zn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ka extends zn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Cl extends zn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Pc extends zn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class tc extends zn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class em extends zn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ed extends zn{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class zc extends zn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class xh extends zn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ic extends zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Zs extends zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class _u extends zn{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class Ad extends _u{constructor(t,o,u=0){super(t,o),this.attachmentPoint=t.gl.COLOR_ATTACHMENT0+u}setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachmentPoint,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class bh extends _u{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Cd extends _u{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ig extends bh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ar=(c,t,o,u)=>({u_matrix:c,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:o,u_emissive_texture_available:u}),wh=(c,t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:o,u_zoom_transition:g,u_merc_center:v,u_image0:0,u_image1:1,u_frustum_tl:b,u_frustum_tr:E,u_frustum_br:C,u_frustum_bl:P,u_globe_pos:z,u_globe_radius:U,u_viewport:N,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:X,u_emissive_texture_available:Z});function nc(c,t){return c!=null&&t!=null&&!(!c.hasData()||!t.hasData())&&c.demTexture!=null&&t.demTexture!=null&&c.tileID.key!==t.tileID.key}const ya=new class{constructor(){this.operations={}}newMorphing(c,t,o,u,g){if(c in this.operations){const v=this.operations[c];v.to.tileID.key!==o.tileID.key&&(v.queued=o)}else this.operations[c]={startTime:u,phase:0,duration:g,from:t,to:o,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const o=this.operations[t];for(o.phase=(c-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Th={0:null,1:"TERRAIN_VERTEX_MORPHING"};function rc(c,t,o){if(t===0)return 0;const u=t<1&&o===514?.25/t:1;return 6*Math.pow(1.5,22-c)*Math.max(t,1)*u}function Lc(c,t){const o=1<<c.z;return!t&&(c.x===0||c.x===o-1)||c.y===0||c.y===o-1}function Sh(c,t){if(!c.style||!c.style.enable3dLights())return;const o=c.context,u=o.gl;o.activeTexture.set(u.TEXTURE1),t?t.bind(u.LINEAR,u.CLAMP_TO_EDGE):c.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}const Eh=c=>({u_matrix:c});function Id(c,t,o,u,g){if(g>0){const v=r.o.now(),b=(v-c.timeAdded)/g,E=t?(v-t.timeAdded)/g:-1,C=o.getSource(),P=u.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),z=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(c.tileID.overscaledZ-P),U=z&&c.refreshedUponExpiration?1:r.aA(z?b:1-E,0,1);return t?{opacity:1,mix:1-U,isFading:b<1}:{opacity:U,mix:0,isFading:b<1}}return{opacity:1,mix:0,isFading:!1}}class Rd extends es{constructor(t){const o=Ia("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",o,!1),o.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class sc extends es{constructor(t){const o=Ia("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,u){if(t.freezeTileCoverage)return;this.transform=t;const g=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,b)=>{if(v[b.key]="",!this._tiles[b.key]){const E=new Gl(b,this._source.tileSize*b.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);E.state="loaded",this._tiles[b.key]=E}return v},{});for(const v in this._tiles)v in g||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(t){const o=this.proxyCachedFBO[t];if(o!==void 0){const u=Object.values(o);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Md extends r.aQ{constructor(t,o,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=u}}class Ah extends r.bV{constructor(t,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,g,v]=(function(){const C=new r.bd,P=new r.b0,z=131;C.reserve(17161),P.reserve(33800);const U=r.al/128,N=r.al+U/2,V=N+U;for(let Z=-U;Z<V;Z+=U)for(let Y=-U;Y<V;Y+=U){const ne=Y<0||Y>N||Z<0||Z>N?24575:0,ue=r.aA(Math.round(Y),0,r.al),ce=r.aA(Math.round(Z),0,r.al);C.emplaceBack(ue+ne,ce)}const X=(Z,Y)=>{const ne=Y*z+Z;P.emplaceBack(ne+1,ne,ne+z),P.emplaceBack(ne+z,ne+z+1,ne+1)};for(let Z=1;Z<129;Z++)for(let Y=1;Y<129;Y++)X(Y,Z);return[0,129].forEach(Z=>{for(let Y=0;Y<130;Y++)X(Y,Z),X(Z,Y)}),[C,P,32768]})(),b=t.context;this.gridBuffer=b.createVertexBuffer(u,r.bf.members),this.gridIndexBuffer=b.createIndexBuffer(g),this.gridSegments=r.bg.simpleSegment(0,0,u.length,g.length),this.gridNoSkirtSegments=r.bg.simpleSegment(0,0,u.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new sc(o.map),this.orthoMatrix=r.bC(),r.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.al,0,r.al,0,1);const E=b.gl;this._overlapStencilMode=new xi({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Rd(o.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,o,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const g=t.terrain.properties,v=t.terrain.drapeRenderMode===0,b=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.o.now();const E=t.terrain&&t.terrain.scope,C=g.get("source"),P=v?this._mockSourceCache:t.getSourceCache(C,E);if(!P)return void r.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=P,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(o):g.get("exaggeration"),!o.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(o,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),o.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const o=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const g=o!=null?u-o:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const v=t.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(v);let E=v-this._previousZoom;const C=this._previousUpdateTimestamp;let P=v;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(v-P)>.5&&(E=.5*(v-P+E)),E*g<0&&(P+=E)),this._evaluationZoom=P;const z=b.getExaggeration(P),U=z===b.getExaggeration(Math.max(0,P-.1));if(U&&Math.abs(z-this._exaggeration)<.01)return z;let N=Math.min(.1,.00375*(this._updateTimestamp-C));return(U||z<.1||Math.abs(E)<1e-4)&&(N=Math.min(.2,4*N)),r.ak(this._exaggeration,z,N)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(r.ae.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=o.getIds().map(C=>{const P=o.getTileByID(C).tileID;return P.projMatrix=u.calculateProjMatrix(P.toUnwrapped()),P});(function(C,P){const z=P.transform.pointCoordinate(P.transform.getCameraPoint()),U=new r.P(z.x,z.y);C.sort((N,V)=>{if(V.overscaledZ-N.overscaledZ)return V.overscaledZ-N.overscaledZ;const X=new r.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),Z=new r.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),Y=U.mult(1<<N.canonical.z);return Y.x-=.5,Y.y-=.5,Y.distSqr(X)-Y.distSqr(Z)})})(g,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},g.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const C in b){const P=b[C];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,t[C],v),P.usedForTerrain))continue;const z=t[C];P.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[o.id]=g.map(C=>new Md(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const E={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const P=this.terrainTileForTile[C.key];if(!P)continue;const z=P.tileID.key;z in E||(this._visibleDemTiles.push(P),E[z]=z)}}_assignTerrainTiles(t){this._initializing||t.forEach(o=>{if(this.terrainTileForTile[o.key])return;const u=this._findTileCoveringTileID(o,this.sourceCache);u&&(this.terrainTileForTile[o.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,o=t.gl;for(const u in this.terrainTileForTile){const g=this.terrainTileForTile[u],v=g.dem;!v||g.demTexture&&!g.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),ta(this.painter,g,v))}}_prepareDemTileUniforms(t,o,u,g){if(!o||o.demTexture==null)return!1;const v=t.tileID.canonical,b=Math.pow(2,o.tileID.canonical.z-v.z),E=g||"";return u[`u_dem_tl${E}`]=[v.x*b%1,v.y*b%1],u[`u_dem_scale${E}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const o=this._visibleDemTiles.reduce((u,g)=>{if(!g.dem)return u;const v=g.dem.tree.minimums[0];return v>0&&t++,u+v},0);return t?o/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);const u=this._getLoadedAreaMinimum(),g=new r.dL({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(g,{premultiply:!1}):v=this._emptyDEMTexture=new r.T(t,g,o.R32F,{premultiply:!1}),v}setupElevationDraw(t,o,u){const g=this.painter.context,v=g.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let E=null,C=null,P=1;if(u&&u.morphing&&this._useVertexMorphing){const V=u.morphing.srcDemTile,X=u.morphing.dstDemTile;P=u.morphing.phase,V&&X&&(this._prepareDemTileUniforms(t,V,b,"_prev")&&(C=V),this._prepareDemTileUniforms(t,X,b)&&(E=X))}const z=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let U=null;var N;if(this.enabled?C&&E?(U=E.demTexture,g.activeTexture.set(v.TEXTURE4),C.demTexture.bind(z(C),v.CLAMP_TO_EDGE),b.u_dem_lerp=P):(E=this.terrainTileForTile[t.tileID.key],U=this._prepareDemTileUniforms(t,E,b)?E.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,g.activeTexture.set(v.TEXTURE2),U&&(b.u_dem_size=(N=U).size[0]===1?1:N.size[0]-2,U.bind(z(E),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,o,b),u&&u.useMeterToDem&&E){const V=(1<<E.tileID.canonical.z)*r.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=V}if(u&&u.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),o.setTerrainUniformValues(g,b),this.painter.transform.projection.name==="globe"){const V=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);o.setGlobeUniformValues(g,V)}}globeUniformValues(t,o,u){const g=t.projection;return{u_tile_tl_up:g.upVector(o,0,0),u_tile_tr_up:g.upVector(o,r.al,0),u_tile_br_up:g.upVector(o,r.al,r.al),u_tile_bl_up:g.upVector(o,0,r.al),u_tile_up_scale:u?r.dM(1):g.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const o=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(g,v,b,E,C){if(g.transform.projection.name==="globe")(function(P,z,U,N,V){const X=P.context,Z=X.gl;let Y,ne;const ue=P.transform,ce=r.dE(P,X,ue),ae=(He,Ve)=>{if(ne===Ve)return;const Qe=[Th[Ve],"PROJECTION_GLOBE_VIEW"];ce&&Qe.push("CUSTOM_ANTIALIASING");const ct=P.isTileAffectedByFog(He);Y=P.getOrCreateProgram("globeRaster",{defines:Qe,overrideFog:ct}),ne=Ve},Ee=P.colorModeForRenderPass(),xe=new ii(Z.LEQUAL,ii.ReadWrite,P.depthRangeFor3D);ya.update(V);const Se=r.dF(ue),ye=[r.aF(ue.center.lng),r.aJ(ue.center.lat)],fe=P.globeSharedBuffers,De=[ue.width*r.o.devicePixelRatio,ue.height*r.o.devicePixelRatio],Pe=Float32Array.from(ue.globeMatrix),Be={useDenormalizedUpVectorScale:!0};{const He=P.transform,Ve=rc(He.zoom,z.exaggeration(),z.sourceCache._source.tileSize);ne=-1;const Qe=Z.TRIANGLES;for(const ct of N){const $e=U.getTile(ct),Oe=xi.disabled,nt=z.prevTerrainTileForTile[ct.key],Ze=z.terrainTileForTile[ct.key];nc(nt,Ze)&&ya.newMorphing(ct.key,nt,Ze,V,250),Sh(P,$e.emissiveTexture),X.activeTexture.set(Z.TEXTURE0),$e.texture&&$e.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const lt=ya.getMorphValuesForProxy(ct.key),St=lt?1:0;lt&&Object.assign(Be,{morphing:{srcDemTile:lt.from,dstDemTile:lt.to,phase:r.dD(lt.phase)}});const kt=r.dG(ct.canonical),Ct=r.dH(kt.getCenter().lat),Et=r.dI(ct.canonical,kt,Ct,He.worldSize/He._pixelsPerMercatorPixel),ei=r.bk(r.dJ(ct.canonical)),Yt=P.emissiveMode==="mrt-fallback"?1:0,Nt=wh(He.expandedFarZProjMatrix,Pe,Se,ei,r.aj(He.zoom),ye,He.frustumCorners.TL,He.frustumCorners.TR,He.frustumCorners.BR,He.frustumCorners.BL,He.globeCenterInViewSpace,He.globeRadius,De,Ve,He._farZ,Yt,Et);if(ae(ct,St),Y&&(z.setupElevationDraw($e,Y,Be),P.uploadCommonUniforms(X,Y,ct.toUnwrapped()),fe)){const[Kt,ai,_i]=fe.getGridBuffers(Ct,Ve!==0);Y.draw(P,Qe,xe,Oe,Ee,gi.backCCW,Nt,"globe_raster",Kt,ai,_i)}}}if(fe&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){const He=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&He.push("CUSTOM_ANTIALIASING"),Y=P.getOrCreateProgram("globeRaster",{defines:He});for(const Ve of N){const{x:Qe,y:ct,z:$e}=Ve.canonical,Oe=ct===0,nt=ct===(1<<$e)-1,[Ze,lt,St,kt]=fe.getPoleBuffers($e,!1);if(kt&&(Oe||nt)){const Ct=U.getTile(Ve);Sh(P,Ct.emissiveTexture),X.activeTexture.set(Z.TEXTURE0),Ct.texture&&Ct.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let Et=r.dK($e,Qe,ue);const ei=r.bk(r.dJ(Ve.canonical)),Yt=P.emissiveMode==="mrt-fallback"?1:0,Nt=(Kt,ai)=>Kt.draw(P,Z.TRIANGLES,xe,xi.disabled,Ee,gi.disabled,wh(ue.expandedFarZProjMatrix,Et,Et,ei,0,ye,ue.frustumCorners.TL,ue.frustumCorners.TR,ue.frustumCorners.BR,ue.frustumCorners.BL,ue.globeCenterInViewSpace,ue.globeRadius,De,0,ue._farZ,Yt),"globe_pole_raster",ai,St,kt);z.setupElevationDraw(Ct,Y,Be),P.uploadCommonUniforms(X,Y,Ve.toUnwrapped()),Oe&&P.renderDefaultNorthPole&&Nt(Y,Ze),nt&&P.renderDefaultSouthPole&&(Et=r.cS(r.bC(),Et,[1,-1,1]),Nt(Y,lt))}}}})(g,v,b,E,C);else{const P=g.context,z=P.gl;let U,N;const V=g.shadowRenderer,X=pa(g,g.longestCutoffRange),Z=Ee=>{if(N===Ee)return;const xe=[];xe.push(Th[Ee]),X.shouldRenderCutoff&&xe.push("RENDER_CUTOFF"),V&&(xe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),V.useNormalOffset&&xe.push("NORMAL_OFFSET")),U=g.getOrCreateProgram("terrainRaster",{defines:xe}),N=Ee},Y=g.colorModeForRenderPass(),ne=new ii(z.LEQUAL,ii.ReadWrite,g.depthRangeFor3D);ya.update(C);const ue=g.transform,ce=rc(ue.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let ae=[0,0,0];if(V){const Ee=g.style.directionalLight,xe=g.style.ambientLight;Ee&&xe&&(ae=xo(g.style,Ee,xe))}{N=-1;const Ee=z.TRIANGLES,[xe,Se]=[v.gridIndexBuffer,v.gridSegments];for(const ye of E){const fe=b.getTile(ye),De=xi.disabled,Pe=v.prevTerrainTileForTile[ye.key],Be=v.terrainTileForTile[ye.key];nc(Pe,Be)&&ya.newMorphing(ye.key,Pe,Be,C,250),Sh(g,fe.emissiveTexture),P.activeTexture.set(z.TEXTURE0),fe.texture&&fe.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const He=ya.getMorphValuesForProxy(ye.key),Ve=He?1:0;let Qe;He&&(Qe={morphing:{srcDemTile:He.from,dstDemTile:He.to,phase:r.dD(He.phase)}});const ct=g.emissiveMode==="mrt-fallback"?1:0,$e=ar(ye.projMatrix,Lc(ye.canonical,ue.renderWorldCopies)?ce/10:ce,ae,ct);if(Z(Ve),!U)continue;v.setupElevationDraw(fe,U,Qe);const Oe=ye.toUnwrapped();V&&V.setupShadows(Oe,U),g.uploadCommonUniforms(P,U,Oe,null,X),U.draw(g,Ee,ne,De,Y,gi.backCCW,$e,"terrain_raster",v.gridBuffer,xe,Se)}}}})(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const o=this.painter,u=this.painter.context,g=this.proxySourceCache,v=this.proxiedCoords[g.id],b=this._drapedRenderBatches.shift(),E=o.style.order,C=[];this._updateFBOs(o.emissiveMode==="mrt-fallback");let P=0;for(const z of v){const U=g.getTileByID(z.proxyTileKey),N=g.proxyCachedFBO[z.key]?g.proxyCachedFBO[z.key][t]:void 0,V=N!==void 0?g.renderCache[N]:this.pool[P++],X=N!==void 0;if(U.texture=V.tex,U.emissiveTexture=V.emissiveTex,X&&!V.dirty){C.push(U.tileID);continue}u.bindFramebuffer.set(V.fb.framebuffer);const Z=u.gl;let Y;Z.drawBuffers(o.emissiveMode==="mrt-fallback"?[Z.COLOR_ATTACHMENT0,Z.COLOR_ATTACHMENT1]:[Z.COLOR_ATTACHMENT0]),this.renderedToTile=!1,V.dirty&&(u.clear({color:r.ao.transparent,stencil:0}),V.dirty=!1);for(let ne=b.start;ne<=b.end;++ne){const ue=o.style._mergedLayers[E[ne]];if(ue.isHidden(o.transform.zoom))continue;const ce=o.style.getLayerSourceCache(ue),ae=ce?this.proxyToSource[z.key][ce.id]:[z];if(!ae)continue;const Ee=ae;u.viewport.set([0,0,V.fb.width,V.fb.height]),Y!==(ce?ce.id:null)&&(this._setupStencil(V,ae,ue,ce),Y=ce?ce.id:null),o.renderLayer(o,ce,ue,Ee)}if(Z.drawBuffers([Z.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const ne of this._pendingGroundEffectLayers){const ue=o.style._mergedLayers[E[ne]];if(ue.isHidden(o.transform.zoom))continue;const ce=o.style.getLayerSourceCache(ue),ae=ce?this.proxyToSource[z.key][ce.id]:[z];if(!ae)continue;const Ee=ae;u.viewport.set([0,0,V.fb.width,V.fb.height]),Y!==(ce?ce.id:null)&&(this._setupStencil(V,ae,ue,ce),Y=ce?ce.id:null),o.renderLayer(o,ce,ue,Ee)}this.renderedToTile?(V.dirty=!0,C.push(U.tileID)):X||--P,P===5&&(P=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),b.end+1}postRender(){}isLayerOrderingCorrect(t){const o=t.order.length;let u=-1,g=o;for(let v=0;v<o;++v)this._style.isLayerDraped(t._mergedLayers[t.order[v]])?u=Math.max(u,v):g=Math.min(g,v);return g>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{t=Math.min(t,o.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,o,u){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const b=v.tileID,E=1<<b.overscaledZ,{x:C,y:P}=b.canonical,z=C/E,U=(C+1)/E,N=P/E,V=(P+1)/E;return{minx:z,miny:N,maxx:U,maxy:V,t:v.dem.tree.raycastRoot(z,N,U,V,t,o,u),tile:v}});g.sort((v,b)=>(v.t!==null?v.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const v of g){if(v.t==null)return null;const b=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,t,o,u);if(b!=null)return b}return null}_createFBO(){const t=this.painter.context,o=t.gl,u=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);const g=new r.T(t,{width:u[0],height:u[1],data:null},o.RGBA8);g.bind(o.LINEAR,o.CLAMP_TO_EDGE);const v=t.createFramebuffer(u[0],u[1],1,null);let b;return v.colorAttachment0.set(g.texture),this._emissiveTexture&&(b=new r.T(t,{width:u[0],height:u[1],data:null},o.R8),b.bind(o.LINEAR,o.CLAMP_TO_EDGE),v.createColorAttachment(t,1),v.colorAttachment1.set(b.texture)),v.depthAttachment=new Ig(t,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:v,tex:g,emissiveTex:b,dirty:!1}}_updateFBOs(t){if(this._emissiveTexture!==t){for(const o of this.pool)this._updateFBO(o,t);for(const o of this.proxySourceCache.renderCache)this._updateFBO(o,t);this._emissiveTexture=t}}_updateFBO(t,o){const u=t.fb,g=this.painter.context,v=g.gl,b=this.drapeBufferSize;if(o){const E=new r.T(g,{width:b[0],height:b[1],data:null},v.R8);E.bind(v.LINEAR,v.CLAMP_TO_EDGE),t.emissiveTex=E,u.createColorAttachment(g,1),u.colorAttachment1.set(E.texture)}else t.emissiveTex=void 0,u.removeColorAttachment(g,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const o=this._style._mergedLayers[t],u=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!u&&o.shouldRedrape():!u&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof Ca){t=!0;break}if(!t)return;const o={};for(let u=0;u<this._style.order.length;++u){const g=this._style._mergedLayers[this._style.order[u]],v=this._style.getLayerSourceCache(g);if(!v||o[v.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="line")continue;const b=g.widthExpression(),E=g.emissiveStrengthExpression();if(b instanceof r.ad||E instanceof r.ad){o[v.id]=!0;for(const C of this.proxyCoords){const P=this.proxyToSource[C.key][v.id];if(P)for(const z of P)this._clearRenderCacheForTile(v.id,z)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof rs){t=!0;break}if(!t)return;const o={};for(let u=0;u<this._style.order.length;++u){const g=this._style._mergedLayers[this._style.order[u]],v=this._style.getLayerSourceCache(g);if(!v||o[v.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const b=g.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const C=this.proxyToSource[E.key][v.id];if(C)for(const P of C){const z=Id(v.getTile(P),v.findLoadedParent(P,0),v,this.painter.transform,b);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(v.id,P)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,o=t.length;if(o===0)return;const u=[];this._pendingGroundEffectLayers=[];let g,v=0,b=this._style._mergedLayers[t[v]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++v<o;)b=this._style._mergedLayers[t[v]];for(;v<o;++v){const E=this._style._mergedLayers[t[v]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?g===void 0&&(g=v):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),g!==void 0&&(u.push({start:g,end:v-1}),g=void 0)))}if(g!==void 0&&u.push({start:g,end:v-1}),u.length!==0){const E=u[u.length-1];this._pendingGroundEffectLayers.every(C=>C>E.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const b=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let E=0;E<b.length;++E){const C=Object.values(b[E]);o.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,g=this._tilesDirty;for(let b=u.length-1;b>=0;b--){const E=u[b];if(o.getTileByID(E.key),o.proxyCachedFBO[E.key]!==void 0){const C=t[E.key],P=this.proxyToSource[E.key];let z=0;for(const U in P){const N=P[U],V=C[U];if(!V||V.length!==N.length||N.some((X,Z)=>X!==V[Z]||g[U]&&g[U].hasOwnProperty(X.key))){z=-1;break}++z}for(const U in o.proxyCachedFBO[E.key])o.renderCache[o.proxyCachedFBO[E.key][U]].dirty=z<0||z!==Object.values(C).length}}const v=[...this._drapedRenderBatches];v.sort((b,E)=>E.end-E.start-(b.end-b.start));for(const b of v)for(const E of u){if(o.proxyCachedFBO[E.key])continue;let C=o.renderCachePool.pop();C===void 0&&o.renderCache.length<50&&(C=o.renderCache.length,o.renderCache.push(this._createFBO())),C!==void 0&&(o.proxyCachedFBO[E.key]={},o.proxyCachedFBO[E.key][b.start]=C,o.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,u,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,b=v.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let E;if(u.isTileClipped())E=o.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):xi.disabled}_renderTileClippingMasks(t,o){const u=this.painter,g=this.painter.context,v=g.gl;u._tileClippingMaskIDs={},g.setColorMode(wi.disabled),g.setDepthMode(ii.disabled);const b=u.getOrCreateProgram("clippingMask");for(const E of t){const C=u._tileClippingMaskIDs[E.key]=--o;b.draw(u,v.TRIANGLES,ii.disabled,new xi({func:v.ALWAYS,mask:0},C,255,v.KEEP,v.KEEP,v.REPLACE),wi.disabled,gi.disabled,Eh(E.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;const u=[t.x,t.y,1,1];r.aC(u,u,o.pixelMatrixInverse),r.cK(u,u,1/u[3]),u[0]/=o.worldSize,u[1]/=o.worldSize;const g=o._camera.position,v=r.cf(1,o.center.lat),b=[g[0],g[1],g[2]/v,0],E=r.da([],u.slice(0,3),b);r.aw(E,E);const C=this.raycast(b,E,this._exaggeration);return C!==null&&C?(r.bH(b,b,E,C),b[3]=b[2],b[2]*=v,b):null}_setupProxiedCoordsForOrtho(t,o,u){if(t.getSource()instanceof r.aU)return this._setupProxiedCoordsForImageSource(t,o,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const g=this.proxiedCoords[t.id]=[],v=this.proxyCoords;for(let C=0;C<v.length;C++){const P=v[C],z=this._findTileCoveringTileID(P,t);if(z){const U=this._createProxiedId(P,z,u[P.key]&&u[P.key][t.id]);g.push(U),this.proxyToSource[P.key][t.id]=[U]}}let b=!1;const E=new Set;for(let C=0;C<o.length;C++){const P=t.getTile(o[C]);if(!P||!P.hasData())continue;const z=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==P.tileID.canonical.z){const U=this.proxyToSource[z.tileID.key][t.id],N=this._createProxiedId(z.tileID,P,u[z.tileID.key]&&u[z.tileID.key][t.id]);U?U.splice(U.length-1,0,N):this.proxyToSource[z.tileID.key][t.id]=[N];const V=this.proxyToSource[z.tileID.key][t.id];E.has(V)||E.add(V),g.push(N),b=!0}}if(this._sourceTilesOverlap[t.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const C of E)C.sort((P,z)=>z.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(t,o,u){if(!t.getSource().loaded())return;const g=this.proxiedCoords[t.id]=[],v=this.proxyCoords,b=t.getSource(),E=b.tileID;if(!E)return;const C=new r.P(E.x,E.y)._div(1<<E.z),P=b.coordinates.map(r.ae.fromLngLat).reduce((U,N)=>(U.min.x=Math.min(U.min.x,N.x-C.x),U.min.y=Math.min(U.min.y,N.y-C.y),U.max.x=Math.max(U.max.x,N.x-C.x),U.max.y=Math.max(U.max.y,N.y-C.y),U),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(U,N)=>{const V=U.wrap+U.canonical.x/(1<<U.canonical.z),X=U.canonical.y/(1<<U.canonical.z),Z=r.al/(1<<U.canonical.z),Y=N.wrap+N.canonical.x/(1<<N.canonical.z),ne=N.canonical.y/(1<<N.canonical.z);return V+Z<Y+P.min.x||V>Y+P.max.x||X+Z<ne+P.min.y||X>ne+P.max.y};for(let U=0;U<v.length;U++){const N=v[U];for(let V=0;V<o.length;V++){const X=t.getTile(o[V]);if(!X||!X.hasData()||z(N,X.tileID))continue;const Z=this._createProxiedId(N,X,u[N.key]&&u[N.key][t.id]),Y=this.proxyToSource[N.key][t.id];Y?Y.push(Z):this.proxyToSource[N.key][t.id]=[Z],g.push(Z)}}}_createProxiedId(t,o,u){let g=this.orthoMatrix;if(u){const v=u.find(b=>b.key===o.tileID.key);if(v)return v}if(o.tileID.key!==t.key){const v=t.canonical.z-o.tileID.canonical.z;let b,E,C;g=r.bC();const P=o.tileID.wrap-t.wrap<<t.overscaledZ;v>0?(b=r.al>>v,E=b*((o.tileID.canonical.x<<v)-t.canonical.x+P),C=b*((o.tileID.canonical.y<<v)-t.canonical.y)):(b=r.al<<-v,E=r.al*(o.tileID.canonical.x-(t.canonical.x+P<<-v)),C=r.al*(o.tileID.canonical.y-(t.canonical.y<<-v))),r.ce(g,0,b,0,b,0,1),r.br(g,g,[E,C,0])}return new Md(o.tileID,t.key,g)}_findTileCoveringTileID(t,o){let u=o.getTile(t);if(u&&u.hasData())return u;const g=this._findCoveringTileCache[o.id],v=g[t.key];if(u=v?o.getTileByID(v):null,u&&u.hasData()||v===null)return u;let b=u?u.tileID:t,E=b.overscaledZ;const C=o.getSource().minzoom,P=[];if(!v){const U=o.getSource().maxzoom;if(t.canonical.z>=U){const N=t.canonical.z-U;o.getSource().reparseOverscaled?(E=Math.max(t.canonical.z+2,o.transform.tileZoom),b=new r.aQ(E,t.wrap,U,t.canonical.x>>N,t.canonical.y>>N)):N!==0&&(E=U,b=new r.aQ(E,t.wrap,U,t.canonical.x>>N,t.canonical.y>>N))}b.key!==t.key&&(P.push(b.key),u=o.getTile(b))}const z=U=>{P.forEach(N=>{g[N]=U}),P.length=0};for(E-=1;E>=C&&(!u||!u.hasData());E--){u&&z(u.tileID.key);const U=b.calculateScaledKey(E);if(u=o.getTileByID(U),u&&u.hasData())break;const N=g[U];if(N===null)break;N===void 0?P.push(U):u=o.getTileByID(N)}return z(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[o.key]=!0}}function yu(c,t,o){const u=(function(E,C,P){const z=r.bJ(C,E),U=r.bJ(P,[.2126,.7152,.0722]),N=(X,Z,Y)=>(1-Y)*X+Y*Z,V=N(1-.3*Math.min(U,1),1,Math.min(z+1,1));return N(.92,1,Math.asin(r.aA(C[2],-1,1))/Math.PI+.5)*V})(c,[0,0,1],t),g=[0,0,0];r.c5(g,o.slice(0,3),u);const v=[0,0,0];r.c5(v,t.slice(0,3),c[2]);const b=[0,0,0];return r.d8(b,g,v),r.db(b)}const Ch=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],tm=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Dd{static cacheKey(t,o,u,g){const v=[o];g&&v.push(g.cacheKey);for(const b of u)t.usedDefines.has(b)&&v.push(b);return v.join("/")}constructor(t,o,u,g,v,b){const E=t.gl;this.program=E.createProgram(),this.configuration=g,this.name=o,this.fixedDefines=[...b];const C=`#version 300 es
${(g?g.defines():[]).concat(b.map(Z=>`#define ${Z}`)).join(`
`)}`,P=[C,Cg];for(const Z of u.fragmentIncludes)P.push(Jl[Z]);P.push(u.fragmentSource);const z=P.join(`
`),U=[C,zf];for(const Z of u.vertexIncludes)U.push(Jl[Z]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&U.push("uniform int u_instanceID;"),U.push(u.vertexSource);let N=U.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(N=N.replaceAll("gl_InstanceID","u_instanceID"));const V=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(V,z),E.compileShader(V),E.attachShader(this.program,V);const X=E.createShader(E.VERTEX_SHADER);E.isContextLost()?this.failedToCreate=!0:(E.shaderSource(X,N),E.compileShader(X),E.attachShader(this.program,X),this.attributes={},E.linkProgram(this.program),E.deleteShader(X),E.deleteShader(V),this.fixedUniforms=v(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=g?g.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Z=>({u_instanceID:new r.ch(Z)}))(t)),(b.includes("TERRAIN")||o.includes("symbol")||o.includes("circle"))&&(this.terrainUniforms=(Z=>({u_dem:new r.ch(Z),u_dem_prev:new r.ch(Z),u_dem_tl:new r.ck(Z),u_dem_scale:new r.cj(Z),u_dem_tl_prev:new r.ck(Z),u_dem_scale_prev:new r.cj(Z),u_dem_size:new r.cj(Z),u_dem_lerp:new r.cj(Z),u_exaggeration:new r.cj(Z),u_depth:new r.ch(Z),u_depth_size_inv:new r.ck(Z),u_depth_range_unpack:new r.ck(Z),u_occluder_half_size:new r.cj(Z),u_occlusion_depth_offset:new r.cj(Z),u_meter_to_dem:new r.cj(Z),u_label_plane_matrix_inv:new r.cl(Z)}))(t)),b.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new r.ci(Z),u_tile_tr_up:new r.ci(Z),u_tile_br_up:new r.ci(Z),u_tile_bl_up:new r.ci(Z),u_tile_up_scale:new r.cj(Z)}))(t)),b.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new r.cl(Z),u_fog_range:new r.ck(Z),u_fog_color:new r.d3(Z),u_fog_horizon_blend:new r.cj(Z),u_fog_vertical_limit:new r.ck(Z),u_fog_temporal_offset:new r.cj(Z),u_frustum_tl:new r.ci(Z),u_frustum_tr:new r.ci(Z),u_frustum_br:new r.ci(Z),u_frustum_bl:new r.ci(Z),u_globe_pos:new r.ci(Z),u_globe_radius:new r.cj(Z),u_globe_transition:new r.cj(Z),u_is_globe:new r.ch(Z),u_viewport:new r.ck(Z)}))(t)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Z=>({u_cutoff_params:new r.d3(Z)}))(t)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Z=>({u_lighting_ambient_color:new r.ci(Z),u_lighting_directional_dir:new r.ci(Z),u_lighting_directional_color:new r.ci(Z),u_ground_radiance:new r.ci(Z)}))(t)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Z=>({u_light_matrix_0:new r.cl(Z),u_light_matrix_1:new r.cl(Z),u_fade_range:new r.ck(Z),u_shadow_normal_offset:new r.ci(Z),u_shadow_intensity:new r.cj(Z),u_shadow_texel_size:new r.cj(Z),u_shadow_map_resolution:new r.cj(Z),u_shadow_direction:new r.ci(Z),u_shadow_bias:new r.ci(Z),u_shadowmap_0:new r.ch(Z),u_shadowmap_1:new r.ch(Z)}))(t)))}getAttributeLocation(t,o){let u=this.attributes[o];return u===void 0&&(u=this.attributes[o]=t.getAttribLocation(this.program,o)),u}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in o)u[g]&&u[g].set(this.program,g,o[g])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in o)u[g]&&u[g].set(this.program,g,o[g])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in o)u[g].set(this.program,g,o[g])}}setCutoffUniformValues(t,o){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in o)u[g].set(this.program,g,o[g])}}setLightsUniformValues(t,o){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in o)u[g].set(this.program,g,o[g])}}setShadowUniformValues(t,o){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const g in o)u[g].set(this.program,g,o[g])}_drawDebugWireframe(t,o,u,g,v,b,E,C,P,z){const U=t.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const N=t.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||t._terrain&&t._terrain.renderingToTexture||!Ch.includes(this.name))||!(!U.layers3D||!tm.includes(this.name))))return;const V=N.gl,X=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,v,N);if(!X)return;const Z=[...this.fixedDefines,"DEBUG_WIREFRAME"],Y=t.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});N.program.set(Y.program);const ne=(ae,Ee,xe)=>{if(Ee[ae]&&xe[ae])for(const Se in Ee[ae])xe[ae][Se]&&xe[ae][Se].set(xe.program,Se,Ee[ae][Se].current)};P&&P.setUniforms(Y.program,N,Y.binderUniforms,E,{zoom:C}),ne("fixedUniforms",this,Y),ne("terrainUniforms",this,Y),ne("globeUniforms",this,Y),ne("fogUniforms",this,Y),ne("lightsUniforms",this,Y),ne("shadowUniforms",this,Y),X.bind(),N.setColorMode(new wi([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],r.ao.transparent,[!0,!0,!0,!1])),N.setDepthMode(new ii(o.func===V.LESS?V.LEQUAL:o.func,ii.ReadOnly,o.range)),N.setStencilMode(xi.disabled);const ue=3*b.primitiveLength*2,ce=3*b.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ae=z||1;for(let Ee=0;Ee<ae;++Ee)Y.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ee),V.drawElements(V.LINES,ue,V.UNSIGNED_SHORT,ce)}else z&&z>1?V.drawElementsInstanced(V.LINES,ue,V.UNSIGNED_SHORT,ce,z):V.drawElements(V.LINES,ue,V.UNSIGNED_SHORT,ce);v.bind(),N.program.set(this.program),N.setDepthMode(o),N.setStencilMode(u),N.setColorMode(g)}checkUniforms(t,o,u){if(this.fixedDefines.includes(o)){for(const g of Object.keys(u))if(!u[g].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${g} not set but required by ${o} being defined`)}}draw(t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y){const ne=t.context,ue=ne.gl;if(this.failedToCreate)return;ne.program.set(this.program),ne.setDepthMode(u),ne.setStencilMode(g),ne.setColorMode(v),ne.setCullFace(b);for(const[ye,fe]of this.fixedUniformsEntries)fe.set(this.program,ye,E[ye]);X&&X.setUniforms(this.program,ne,this.binderUniforms,N,{zoom:V});const ce={[ue.POINTS]:1,[ue.LINES]:2,[ue.TRIANGLES]:3,[ue.LINE_STRIP]:1}[o];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const ae=Z||[],Ee=X?X.getPaintVertexBuffers():[],xe=o===ue.TRIANGLES&&z,Se=Y&&Y>0?1:void 0;for(const ye of U.get()){const fe=ye.vaos||(ye.vaos={});if((fe[C]||(fe[C]=new yh)).bind(ne,this,P,Ee,z,ye.vertexOffset,ae,Se),this.forceManualRenderingForInstanceIDShaders){const De=Y||1;for(let Pe=0;Pe<De;++Pe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Pe),z?ue.drawElements(o,ye.primitiveLength*ce,ue.UNSIGNED_SHORT,ye.primitiveOffset*ce*2):ue.drawArrays(o,ye.vertexOffset,ye.vertexLength)}else Y&&Y>1?ue.drawElementsInstanced(o,ye.primitiveLength*ce,ue.UNSIGNED_SHORT,ye.primitiveOffset*ce*2,Y):z?ue.drawElements(o,ye.primitiveLength*ce,ue.UNSIGNED_SHORT,ye.primitiveOffset*ce*2):ue.drawArrays(o,ye.vertexOffset,ye.vertexLength);xe&&this._drawDebugWireframe(t,u,g,v,z,ye,N,V,X,Y)}}}function Od(c,t,o=0){const u=Math.pow(2,t.tileID.overscaledZ),g=t.tileSize*Math.pow(2,c.transform.tileZoom)/u,v=g*(t.tileID.canonical.x+t.tileID.wrap*u),b=g*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(t,1,c.transform.tileZoom),u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b],u_pattern_transition:o}}const Pd={terrain:0,flat:1},Rg=r.bC(),Il=(c,t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y,ne)=>{const ue=t.style.light,ce=ue.properties.get("position"),ae=[ce.x,ce.y,ce.z],Ee=r.dO();ue.properties.get("anchor")==="viewport"&&(r.dP(Ee,-t.transform.angle),r.dQ(ae,ae,Ee));const xe=ue.properties.get("color").toPremultipliedRenderColor(null),Se=t.transform,ye={u_matrix:c,u_lightpos:ae,u_lightintensity:ue.properties.get("intensity"),u_lightcolor:[xe.r,xe.g,xe.b],u_vertical_gradient:+o,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Rg,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Pd[P],u_base_type:Pd[z],u_ao:g,u_edge_radius:v,u_width_scale:b,u_flood_light_color:X,u_vertical_scale:Z,u_flood_light_intensity:Y,u_ground_shadow_factor:ne};return Se.projection.name==="globe"&&(ye.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],ye.u_zoom_transition=U,ye.u_inv_rot_matrix=V,ye.u_merc_center=N,ye.u_up_dir=Se.projection.upVector(new r.cD(0,0,0),N[0]*r.al,N[1]*r.al),ye.u_height_lift=C),ye},oc=(c,t,o,u,g,v)=>({u_matrix:c,u_edge_radius:t,u_width_scale:o,u_vertical_scale:u,u_height_type:Pd[g],u_base_type:Pd[v]}),im=(c,t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y,ne)=>{const ue=Il(c,t,o,u,g,v,b,E,P,z,U,N,V,X,Z,Y,1,[0,0,0]),ce={u_height_factor:-Math.pow(2,E.overscaledZ)/C.tileSize/8};return Object.assign(ue,Od(t,C,ne),ce)},kc=(c,t,o)=>({u_matrix:c,u_emissive_strength:t,u_ground_shadow_factor:o}),Bc=(c,t,o,u,g,v=0)=>Object.assign(kc(c,t,g),Od(o,u,v)),Ih=(c,t,o,u)=>({u_matrix:c,u_world:o,u_emissive_strength:t,u_ground_shadow_factor:u}),zd=(c,t,o,u,g,v,b=0)=>Object.assign(Bc(c,t,o,u,v,b),{u_world:g}),vu=(c,t)=>({u_matrix:c,u_depth_bias:t}),Qa=(c,t)=>({u_matrix:c,u_ground_shadow_factor:t}),Fc=(c,t,o,u,g)=>({u_matrix:c,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:o,u_height_scale:u,u_reset_depth:g}),Rl=(c,t,o,u,g,v,b,E,C)=>({u_matrix:c,u_normal_matrix:t,u_opacity:o,u_faux_facade_ao_intensity:u,u_camera_pos:g,u_tile_to_meter:v,u_facade_emissive_chance:b,u_flood_light_color:E,u_flood_light_intensity:C}),nm=c=>({u_matrix:c}),Bo=c=>({u_matrix:c}),Ld=(c,t,o,u,g,v,b,E)=>{const C=r.al/v.tileSize;return{u_matrix:c,u_inv_rot_matrix:t,u_camera_to_center_distance:o.getCameraToCenterDistance(E),u_extrude_scale:[o.pixelsToGLUnits[0]/C,o.pixelsToGLUnits[1]/C],u_zoom_transition:u,u_tile_id:b,u_merc_center:g}},Rh=(c,t,o,u)=>({u_matrix:c,u_inv_matrix:t,u_camera_to_center_distance:o.getCameraToCenterDistance(u),u_viewport_size:[o.width,o.height]}),Ml=(c,t,o=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:o}),ac=r.bC(),xu=(c,t,o,u,g,v,b)=>{const E=c.transform,C=E.projection.name==="globe",P=C?r.dR(E.zoom,t.canonical)*E._pixelsPerMercatorPixel:r.ay(o,1,v),z={u_matrix:t.projMatrix,u_extrude_scale:P,u_intensity:b,u_inv_rot_matrix:ac,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){z.u_inv_rot_matrix=u,z.u_merc_center=g,z.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],z.u_zoom_transition=r.aj(E.zoom);const U=g[0]*r.al,N=g[1]*r.al;z.u_up_dir=E.projection.upVector(new r.cD(0,0,0),U,N)}return z};function Mh(c,[t,o,u,g],[v,b]){if(v===b)return[0,0,0,0];const E=255*(c-1)/(c*(b-v));return[t*E,o*E,u*E,g*E]}function jf(c,t,[o,u]){return o===u?0:.5/c+(t-o)*(c-1)/(c*(u-o))}const bu=(c,t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y,ne,ue,ce,ae)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:u,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:P,u_fade_t:z.mix,u_opacity:z.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:r.dT(U.paint.get("raster-saturation")),u_contrast_factor:r.dS(U.paint.get("raster-contrast")),u_spin_weights:lc(U.paint.get("raster-hue-rotate")),u_perspective_transform:N,u_raster_elevation:V,u_zoom_transition:b,u_merc_center:E,u_cutoff_params:C,u_colorization_mix:Mh(r.dU,Z,ne),u_colorization_offset:jf(r.dU,Y,ne),u_color_ramp:X,u_texture_offset:[ce/(ue+2*ce),ue/(ue+2*ce)],u_texture_res:[ue+2*ce,ue+2*ce],u_emissive_strength:ae});function lc(c){c*=Math.PI/180;const t=Math.sin(c),o=Math.cos(c);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const wu=.05,Mg=(c,t,o,u,g,v,b,E,C,P,z,U)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:u,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:P,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:b,u_merc_center:E,u_cutoff_params:C}),Tu=(c,t,o,u,g,v,b,E,C,P)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_tile_offset:o,u_velocity:u,u_color_ramp:v,u_velocity_res:g,u_max_speed:b,u_uv_offset:E,u_data_scale:[255*C[0],255*C[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[wu,wu]}),Uf=(c,t,o,u,g,v,b,E,C,P)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_velocity:o,u_velocity_res:u,u_max_speed:g,u_speed_factor:v,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:[255*C[0],255*C[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[wu,wu]}),kd=r.bC(),Su=(c,t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y,ne,ue,ce,ae,Ee,xe,Se)=>{const ye=g.transform,fe={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ye.getCameraToCenterDistance(ue),u_rotate_symbol:+o,u_aspect_ratio:ye.width/ye.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:b,u_coord_matrix:E,u_is_text:+P,u_elevation_from_sea:C?1:0,u_pitch_with_map:+u,u_texsize:z,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:kd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:kd,u_up_vector:[0,-1,0],u_color_adj_mat:Ee,u_icon_transition:xe||0,u_gamma_scale:u?g.transform.getCameraToCenterDistance(ue)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:r.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Se||1,u_ground_shadow_factor:ce,u_inv_matrix:r.bl(r.bC(),b),u_normal_scale:ae,u_lutTexture:10};return ue.name==="globe"&&(fe.u_tile_id=[V.canonical.x,V.canonical.y,1<<V.canonical.z],fe.u_zoom_transition=X,fe.u_inv_rot_matrix=Y,fe.u_merc_center=Z,fe.u_camera_forward=ye._camera.forward(),fe.u_ecef_origin=r.dV(ye.globeMatrix,V.toUnwrapped()),fe.u_tile_matrix=Float32Array.from(ye.globeMatrix),fe.u_up_vector=ne),fe},Dl=(c,t,o,u)=>({u_matrix:c,u_emissive_strength:t,u_opacity:o,u_color:u}),lo=(c,t,o,u,g,v,b,E,C)=>Object.assign((function(P,z,U,N,V,X){const{width:Z,height:Y}=N.imageManager.getPixelSize(z),ne=Math.pow(2,X.tileID.overscaledZ),ue=X.tileSize*Math.pow(2,N.transform.tileZoom)/ne,ce=ue*(X.tileID.canonical.x+X.tileID.wrap*ne),ae=ue*X.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[Z,Y],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:V?[N.transform.width,-1*N.transform.height]:[1/r.ay(X,1,N.transform.tileZoom),1/r.ay(X,1,N.transform.tileZoom)],u_pixel_coord_upper:[ce>>16,ae>>16],u_pixel_coord_lower:[65535&ce,65535&ae]}})(0,v,b,u,E,C),{u_matrix:c,u_emissive_strength:t,u_opacity:o}),Ws=new Float32Array(r.bA([])),el=(c,t,o,u,g,v,b,E,C,P,z,U,N,V=[0,0,0],X,Z,Y)=>{const ne=g.style.light,ue=ne.properties.get("position"),ce=[-ue.x,-ue.y,ue.z],ae=r.dO();ne.properties.get("anchor")==="viewport"&&(r.dP(ae,-g.transform.angle),r.dQ(ce,ce,ae));const Ee=z.alphaMode==="MASK",xe=ne.properties.get("color").toNonPremultipliedRenderColor(null),Se=N.paint.get("model-ambient-occlusion-intensity"),ye=N.paint.get("model-color").constantOr(r.ao.white).toNonPremultipliedRenderColor(null);return ye.a=N.paint.get("model-color-mix-intensity").constantOr(0),Y&&(ye.r=Y[0],ye.g=Y[1],ye.b=Y[2],ye.a=Y[3]),Z&&(ye.r=Z.color.r,ye.g=Z.color.g,ye.b=Z.color.b,ye.a=Z.colorMix,U=Z.emissionStrength,v*=Z.opacity),{u_matrix:c,u_lighting_matrix:t,u_normal_matrix:o,u_node_matrix:u||Ws,u_lightpos:ce,u_lightintensity:ne.properties.get("intensity"),u_lightcolor:[xe.r,xe.g,xe.b],u_camera_pos:V,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+Ee,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:b.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:C,u_roughnessFactor:P,u_baseColorTexture:5,u_metallicRoughnessTexture:6,u_normalTexture:7,u_occlusionTexture:8,u_emissionTexture:9,u_lutTexture:10,u_color_mix:ye.toArray01(),u_aoIntensity:Se,u_emissive_strength:U,u_occlusionTextureTransform:X||[0,0,0,0]}},Eu=(c,t=Ws,o=Ws)=>({u_matrix:c,u_instance:t,u_node_matrix:o}),Bd={fillExtrusion:c=>({u_matrix:new r.cl(c),u_lightpos:new r.ci(c),u_lightintensity:new r.cj(c),u_lightcolor:new r.ci(c),u_vertical_gradient:new r.cj(c),u_opacity:new r.cj(c),u_edge_radius:new r.cj(c),u_width_scale:new r.cj(c),u_ao:new r.ck(c),u_height_type:new r.ch(c),u_base_type:new r.ch(c),u_tile_id:new r.ci(c),u_zoom_transition:new r.cj(c),u_inv_rot_matrix:new r.cl(c),u_merc_center:new r.ck(c),u_up_dir:new r.ci(c),u_height_lift:new r.cj(c),u_flood_light_color:new r.ci(c),u_vertical_scale:new r.cj(c),u_flood_light_intensity:new r.cj(c),u_ground_shadow_factor:new r.ci(c)}),fillExtrusionDepth:c=>({u_matrix:new r.cl(c),u_edge_radius:new r.cj(c),u_width_scale:new r.cj(c),u_vertical_scale:new r.cj(c),u_height_type:new r.ch(c),u_base_type:new r.ch(c)}),fillExtrusionPattern:c=>({u_matrix:new r.cl(c),u_lightpos:new r.ci(c),u_lightintensity:new r.cj(c),u_lightcolor:new r.ci(c),u_vertical_gradient:new r.cj(c),u_height_factor:new r.cj(c),u_edge_radius:new r.cj(c),u_width_scale:new r.cj(c),u_ao:new r.ck(c),u_height_type:new r.ch(c),u_base_type:new r.ch(c),u_tile_id:new r.ci(c),u_zoom_transition:new r.cj(c),u_inv_rot_matrix:new r.cl(c),u_merc_center:new r.ck(c),u_up_dir:new r.ci(c),u_height_lift:new r.cj(c),u_image:new r.ch(c),u_texsize:new r.ck(c),u_pixel_coord_upper:new r.ck(c),u_pixel_coord_lower:new r.ck(c),u_tile_units_to_pixels:new r.cj(c),u_opacity:new r.cj(c),u_pattern_transition:new r.cj(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new r.cl(c),u_opacity:new r.cj(c),u_ao_pass:new r.cj(c),u_meter_to_tile:new r.cj(c),u_ao:new r.ck(c),u_flood_light_intensity:new r.cj(c),u_flood_light_color:new r.ci(c),u_attenuation:new r.cj(c),u_edge_radius:new r.cj(c),u_fb:new r.ch(c),u_fb_size:new r.cj(c),u_dynamic_offset:new r.cj(c)}),fill:c=>({u_matrix:new r.cl(c),u_emissive_strength:new r.cj(c),u_ground_shadow_factor:new r.ci(c)}),fillPattern:c=>({u_matrix:new r.cl(c),u_emissive_strength:new r.cj(c),u_image:new r.ch(c),u_texsize:new r.ck(c),u_pixel_coord_upper:new r.ck(c),u_pixel_coord_lower:new r.ck(c),u_tile_units_to_pixels:new r.cj(c),u_ground_shadow_factor:new r.ci(c),u_pattern_transition:new r.cj(c)}),fillOutline:c=>({u_matrix:new r.cl(c),u_emissive_strength:new r.cj(c),u_world:new r.ck(c),u_ground_shadow_factor:new r.ci(c)}),fillOutlinePattern:c=>({u_matrix:new r.cl(c),u_emissive_strength:new r.cj(c),u_world:new r.ck(c),u_image:new r.ch(c),u_texsize:new r.ck(c),u_pixel_coord_upper:new r.ck(c),u_pixel_coord_lower:new r.ck(c),u_tile_units_to_pixels:new r.cj(c),u_ground_shadow_factor:new r.ci(c),u_pattern_transition:new r.cj(c)}),building:c=>({u_matrix:new r.cl(c),u_normal_matrix:new r.cl(c),u_opacity:new r.cj(c),u_faux_facade_ao_intensity:new r.cj(c),u_camera_pos:new r.ci(c),u_tile_to_meter:new r.cj(c),u_facade_emissive_chance:new r.cj(c),u_flood_light_color:new r.ci(c),u_flood_light_intensity:new r.cj(c)}),buildingBloom:c=>({u_matrix:new r.cl(c)}),buildingDepth:c=>({u_matrix:new r.cl(c)}),elevatedStructuresDepth:c=>({u_matrix:new r.cl(c),u_depth_bias:new r.cj(c)}),elevatedStructures:c=>({u_matrix:new r.cl(c),u_ground_shadow_factor:new r.ci(c)}),elevatedStructuresDepthReconstruct:c=>({u_matrix:new r.cl(c),u_camera_pos:new r.ci(c),u_depth_bias:new r.cj(c),u_height_scale:new r.cj(c),u_reset_depth:new r.cj(c)}),circle:r.dY,collisionBox:c=>({u_matrix:new r.cl(c),u_inv_rot_matrix:new r.cl(c),u_camera_to_center_distance:new r.cj(c),u_extrude_scale:new r.ck(c),u_zoom_transition:new r.cj(c),u_merc_center:new r.ck(c),u_tile_id:new r.ci(c)}),collisionCircle:c=>({u_matrix:new r.cl(c),u_inv_matrix:new r.cl(c),u_camera_to_center_distance:new r.cj(c),u_viewport_size:new r.ck(c)}),debug:c=>({u_color:new r.dB(c),u_matrix:new r.cl(c),u_overlay:new r.ch(c),u_overlay_scale:new r.cj(c)}),clippingMask:c=>({u_matrix:new r.cl(c)}),heatmap:c=>({u_extrude_scale:new r.cj(c),u_intensity:new r.cj(c),u_matrix:new r.cl(c),u_inv_rot_matrix:new r.cl(c),u_merc_center:new r.ck(c),u_tile_id:new r.ci(c),u_zoom_transition:new r.cj(c),u_up_dir:new r.ci(c)}),heatmapTexture:c=>({u_image:new r.ch(c),u_color_ramp:new r.ch(c),u_opacity:new r.cj(c)}),hillshade:c=>({u_matrix:new r.cl(c),u_image:new r.ch(c),u_latrange:new r.ck(c),u_light:new r.ck(c),u_shadow:new r.dB(c),u_highlight:new r.dB(c),u_emissive_strength:new r.cj(c),u_accent:new r.dB(c)}),hillshadePrepare:c=>({u_matrix:new r.cl(c),u_image:new r.ch(c),u_dimension:new r.ck(c),u_zoom:new r.cj(c)}),line:r.dX,linePattern:r.dW,raster:c=>({u_matrix:new r.cl(c),u_normalize_matrix:new r.cl(c),u_globe_matrix:new r.cl(c),u_merc_matrix:new r.cl(c),u_grid_matrix:new r.dC(c),u_tl_parent:new r.ck(c),u_scale_parent:new r.cj(c),u_fade_t:new r.cj(c),u_opacity:new r.cj(c),u_image0:new r.ch(c),u_image1:new r.ch(c),u_brightness_low:new r.cj(c),u_brightness_high:new r.cj(c),u_saturation_factor:new r.cj(c),u_contrast_factor:new r.cj(c),u_spin_weights:new r.ci(c),u_perspective_transform:new r.ck(c),u_raster_elevation:new r.cj(c),u_zoom_transition:new r.cj(c),u_merc_center:new r.ck(c),u_cutoff_params:new r.d3(c),u_colorization_mix:new r.d3(c),u_colorization_offset:new r.cj(c),u_color_ramp:new r.ch(c),u_texture_offset:new r.ck(c),u_texture_res:new r.ck(c),u_emissive_strength:new r.cj(c)}),rasterParticle:c=>({u_matrix:new r.cl(c),u_normalize_matrix:new r.cl(c),u_globe_matrix:new r.cl(c),u_merc_matrix:new r.cl(c),u_grid_matrix:new r.dC(c),u_tl_parent:new r.ck(c),u_scale_parent:new r.cj(c),u_fade_t:new r.cj(c),u_opacity:new r.cj(c),u_image0:new r.ch(c),u_image1:new r.ch(c),u_raster_elevation:new r.cj(c),u_zoom_transition:new r.cj(c),u_merc_center:new r.ck(c),u_cutoff_params:new r.d3(c)}),rasterParticleTexture:c=>({u_texture:new r.ch(c),u_opacity:new r.cj(c)}),rasterParticleDraw:c=>({u_particle_texture:new r.ch(c),u_particle_texture_side_len:new r.cj(c),u_tile_offset:new r.ck(c),u_velocity:new r.ch(c),u_color_ramp:new r.ch(c),u_velocity_res:new r.ck(c),u_max_speed:new r.cj(c),u_uv_offset:new r.ck(c),u_data_scale:new r.ck(c),u_data_offset:new r.cj(c),u_particle_pos_scale:new r.cj(c),u_particle_pos_offset:new r.ck(c)}),rasterParticleUpdate:c=>({u_particle_texture:new r.ch(c),u_particle_texture_side_len:new r.cj(c),u_velocity:new r.ch(c),u_velocity_res:new r.ck(c),u_max_speed:new r.cj(c),u_speed_factor:new r.cj(c),u_reset_rate:new r.cj(c),u_rand_seed:new r.cj(c),u_uv_offset:new r.ck(c),u_data_scale:new r.ck(c),u_data_offset:new r.cj(c),u_particle_pos_scale:new r.cj(c),u_particle_pos_offset:new r.ck(c)}),symbol:c=>({u_is_size_zoom_constant:new r.ch(c),u_is_size_feature_constant:new r.ch(c),u_size_t:new r.cj(c),u_size:new r.cj(c),u_camera_to_center_distance:new r.cj(c),u_rotate_symbol:new r.ch(c),u_aspect_ratio:new r.cj(c),u_fade_change:new r.cj(c),u_matrix:new r.cl(c),u_label_plane_matrix:new r.cl(c),u_coord_matrix:new r.cl(c),u_is_text:new r.ch(c),u_elevation_from_sea:new r.ch(c),u_pitch_with_map:new r.ch(c),u_texsize:new r.ck(c),u_texsize_icon:new r.ck(c),u_texture:new r.ch(c),u_texture_icon:new r.ch(c),u_gamma_scale:new r.cj(c),u_device_pixel_ratio:new r.cj(c),u_tile_id:new r.ci(c),u_zoom_transition:new r.cj(c),u_inv_rot_matrix:new r.cl(c),u_merc_center:new r.ck(c),u_camera_forward:new r.ci(c),u_tile_matrix:new r.cl(c),u_up_vector:new r.ci(c),u_ecef_origin:new r.ci(c),u_is_halo:new r.ch(c),u_icon_transition:new r.cj(c),u_color_adj_mat:new r.cl(c),u_scale_factor:new r.cj(c),u_ground_shadow_factor:new r.ci(c),u_inv_matrix:new r.cl(c),u_normal_scale:new r.cj(c),u_lutTexture:new r.ch(c)}),background:c=>({u_matrix:new r.cl(c),u_emissive_strength:new r.cj(c),u_opacity:new r.cj(c),u_color:new r.dB(c)}),backgroundPattern:c=>({u_matrix:new r.cl(c),u_emissive_strength:new r.cj(c),u_opacity:new r.cj(c),u_image:new r.ch(c),u_pattern_tl:new r.ck(c),u_pattern_br:new r.ck(c),u_texsize:new r.ck(c),u_pattern_size:new r.ck(c),u_pixel_coord_upper:new r.ck(c),u_pixel_coord_lower:new r.ck(c),u_pattern_units_to_pixels:new r.ck(c)}),terrainRaster:c=>({u_matrix:new r.cl(c),u_image0:new r.ch(c),u_image1:new r.ch(c),u_skirt_height:new r.cj(c),u_ground_shadow_factor:new r.ci(c),u_emissive_texture_available:new r.cj(c)}),skybox:c=>({u_matrix:new r.cl(c),u_sun_direction:new r.ci(c),u_cubemap:new r.ch(c),u_opacity:new r.cj(c),u_temporal_offset:new r.cj(c)}),skyboxGradient:c=>({u_matrix:new r.cl(c),u_color_ramp:new r.ch(c),u_center_direction:new r.ci(c),u_radius:new r.cj(c),u_opacity:new r.cj(c),u_temporal_offset:new r.cj(c)}),skyboxCapture:c=>({u_matrix_3f:new r.dC(c),u_sun_direction:new r.ci(c),u_sun_intensity:new r.cj(c),u_color_tint_r:new r.d3(c),u_color_tint_m:new r.d3(c),u_luminance:new r.cj(c)}),globeRaster:c=>({u_proj_matrix:new r.cl(c),u_globe_matrix:new r.cl(c),u_normalize_matrix:new r.cl(c),u_merc_matrix:new r.cl(c),u_zoom_transition:new r.cj(c),u_merc_center:new r.ck(c),u_image0:new r.ch(c),u_image1:new r.ch(c),u_grid_matrix:new r.dC(c),u_skirt_height:new r.cj(c),u_far_z_cutoff:new r.cj(c),u_frustum_tl:new r.ci(c),u_frustum_tr:new r.ci(c),u_frustum_br:new r.ci(c),u_frustum_bl:new r.ci(c),u_globe_pos:new r.ci(c),u_globe_radius:new r.cj(c),u_viewport:new r.ck(c),u_emissive_texture_available:new r.cj(c)}),globeAtmosphere:c=>({u_frustum_tl:new r.ci(c),u_frustum_tr:new r.ci(c),u_frustum_br:new r.ci(c),u_frustum_bl:new r.ci(c),u_horizon:new r.cj(c),u_transition:new r.cj(c),u_fadeout_range:new r.cj(c),u_atmosphere_fog_color:new r.d3(c),u_high_color:new r.d3(c),u_space_color:new r.d3(c),u_temporal_offset:new r.cj(c),u_horizon_angle:new r.cj(c)}),model:c=>({u_matrix:new r.cl(c),u_lighting_matrix:new r.cl(c),u_normal_matrix:new r.cl(c),u_node_matrix:new r.cl(c),u_lightpos:new r.ci(c),u_lightintensity:new r.cj(c),u_lightcolor:new r.ci(c),u_camera_pos:new r.ci(c),u_opacity:new r.cj(c),u_baseColorFactor:new r.d3(c),u_emissiveFactor:new r.d3(c),u_metallicFactor:new r.cj(c),u_roughnessFactor:new r.cj(c),u_baseTextureIsAlpha:new r.ch(c),u_alphaMask:new r.ch(c),u_alphaCutoff:new r.cj(c),u_baseColorTexture:new r.ch(c),u_metallicRoughnessTexture:new r.ch(c),u_normalTexture:new r.ch(c),u_occlusionTexture:new r.ch(c),u_emissionTexture:new r.ch(c),u_lutTexture:new r.ch(c),u_color_mix:new r.d3(c),u_aoIntensity:new r.cj(c),u_emissive_strength:new r.cj(c),u_occlusionTextureTransform:new r.d3(c)}),modelDepth:c=>({u_matrix:new r.cl(c),u_instance:new r.cl(c),u_node_matrix:new r.cl(c)}),groundShadow:c=>({u_matrix:new r.cl(c),u_ground_shadow_factor:new r.ci(c)}),stars:c=>({u_matrix:new r.cl(c),u_up:new r.ci(c),u_right:new r.ci(c),u_intensity_multiplier:new r.cj(c)}),snowParticle:c=>({u_modelview:new r.cl(c),u_projection:new r.cl(c),u_time:new r.cj(c),u_cam_pos:new r.ci(c),u_velocityConeAperture:new r.cj(c),u_velocity:new r.cj(c),u_horizontalOscillationRadius:new r.cj(c),u_horizontalOscillationRate:new r.cj(c),u_boxSize:new r.cj(c),u_billboardSize:new r.cj(c),u_simpleShapeParameters:new r.ck(c),u_screenSize:new r.ck(c),u_thinningCenterPos:new r.ck(c),u_thinningShape:new r.ci(c),u_thinningAffectedRatio:new r.cj(c),u_thinningParticleOffset:new r.cj(c),u_particleColor:new r.d3(c),u_direction:new r.ci(c)}),rainParticle:c=>({u_modelview:new r.cl(c),u_projection:new r.cl(c),u_time:new r.cj(c),u_cam_pos:new r.ci(c),u_texScreen:new r.ch(c),u_velocityConeAperture:new r.cj(c),u_velocity:new r.cj(c),u_boxSize:new r.cj(c),u_rainDropletSize:new r.ck(c),u_distortionStrength:new r.cj(c),u_rainDirection:new r.ci(c),u_color:new r.d3(c),u_screenSize:new r.ck(c),u_thinningCenterPos:new r.ck(c),u_thinningShape:new r.ci(c),u_thinningAffectedRatio:new r.cj(c),u_thinningParticleOffset:new r.cj(c),u_shapeDirectionalPower:new r.cj(c),u_shapeNormalPower:new r.cj(c),u_mode:new r.cj(c)}),vignette:c=>({u_vignetteShape:new r.ci(c),u_vignetteColor:new r.d3(c)}),occlusion:c=>({u_matrix:new r.cl(c),u_anchorPos:new r.ci(c),u_screenSizePx:new r.ck(c),u_occluderSizePx:new r.ck(c),u_color:new r.d3(c)})};class co{constructor(t,o,u,g){this.id=co.uniqueIdxCounter,co.uniqueIdxCounter++,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||g||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=co.uniqueIdxCounter,co.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}co.uniqueIdxCounter=0;const ia={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ps{constructor(t,o,u,g,v,b){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=g,this.instanceCount=b,this.context=t;const E=t.gl;this.buffer=E.createBuffer(),t.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||v||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let u=0;u<this.attributes.length;u++){const g=o.getAttributeLocation(t,this.attributes[u].name);g!==-1&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,o,u){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],b=o.getAttributeLocation(t,v.name);b!==-1&&t.vertexAttribPointer(b,v.components,t[ia[v.type]],!1,this.itemSize,v.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,o,u){for(let g=0;g<this.attributes.length;g++){const v=o.getAttributeLocation(t,this.attributes[g].name);v!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(v,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ol{constructor(t,o,u,g,v){this.context=t,this.width=o,this.height=u;const b=this.framebuffer=t.gl.createFramebuffer();g>0&&(this.colorAttachment0=new Ad(t,b,0)),g>1&&(this.colorAttachment1=new Ad(t,b,1)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new bh(t,b):new Cd(t,b))}createColorAttachment(t,o){o===0?this.colorAttachment0=new Ad(t,this.framebuffer,0):o===1&&(this.colorAttachment1=new Ad(t,this.framebuffer,1))}removeColorAttachment(t,o){const u=this.context.gl;let g;o===0?(g=this.colorAttachment0.get(),this.colorAttachment0=void 0):o===1&&(g=this.colorAttachment1.get(),this.colorAttachment1=void 0),g&&u.deleteTexture(g)}destroy(){const t=this.context.gl;if(this.colorAttachment0){const o=this.colorAttachment0.get();o&&t.deleteTexture(o)}if(this.colorAttachment1){const o=this.colorAttachment1.get();o&&t.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&t.deleteTexture(o)}t.deleteFramebuffer(this.framebuffer)}}class Ba{constructor(t,o){this.gl=t,this.clearColor=new El(this),this.clearDepth=new Xa(this),this.clearStencil=new Ya(this),this.colorMask=new wd(this),this.depthMask=new Td(this),this.stencilMask=new Ql(this),this.stencilFunc=new gu(this),this.stencilOp=new fs(this),this.stencilTest=new wr(this),this.depthRange=new Zn(this),this.depthTest=new Al(this),this.depthFunc=new _a(this),this.blend=new Oc(this),this.blendFunc=new Ka(this),this.blendColor=new Sd(this),this.blendEquation=new Bf(this),this.cullFace=new ec(this),this.cullFaceSide=new Ja(this),this.frontFace=new Ff(this),this.program=new vh(this),this.activeTexture=new Nf(this),this.viewport=new ka(this),this.bindFramebuffer=new Cl(this),this.bindRenderbuffer=new Pc(this),this.bindTexture=new tc(this),this.bindVertexBuffer=new em(this),this.bindElementBuffer=new Ed(this),this.bindVertexArrayOES=new zc(this),this.pixelStoreUnpack=new xh(this),this.pixelStoreUnpackPremultiplyAlpha=new ic(this),this.pixelStoreUnpackFlipY=new Zs(this),this.options=o?Object.assign({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=o&&!!o.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=t.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o,u){return new co(this,t,o,u)}createVertexBuffer(t,o,u,g,v){return new ps(this,t,o,u,g,v)}createRenderbuffer(t,o,u){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,t,o,u),this.bindRenderbuffer.set(null),v}createFramebuffer(t,o,u,g){return new Ol(this,t,o,u,g)}clear({color:t,depth:o,stencil:u,colorMask:g}){const v=this.gl;let b=0;t&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(g||[!0,!0,!0,!0])),o!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),v.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.by(t.blendFunction,wi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Mt;function Tr(c,t,o,u,g,v,b){const E=c.context,C=E.gl,P=c.transform,z=[r.aF(P.center.lng),r.aJ(P.center.lat)],U=o.layout.get("symbol-placement"),N=o.layout.get("text-variable-anchor"),V=o.layout.get("icon-rotation-alignment")==="map",X=o.layout.get("text-rotation-alignment")==="map",Z=U!=="point",Y=[];let ne=0,ue=0;for(let ye=0;ye<u.length;ye++){const fe=u[ye],De=t.getTile(fe),Pe=De.getBucket(o);if(!Pe)continue;const Be=Pe.getProjection().createInversionMatrix(P,fe.canonical),He=[],Ve=qp(fe,Pe,P),Qe=!b&&V&&Z,ct=b&&X&&Z,$e=N&&Pe.hasTextData(),Oe=Pe.hasIconTextFit()&&$e&&Pe.hasIconData(),nt=Qe||ct||b&&$e||Oe,Ze=Pe.projection.name==="globe",lt=Ze?r.aj(P.zoom):0;Ze&&(He.push("PROJECTION_GLOBE_VIEW"),nt&&He.push("PROJECTED_POS_ON_VIEWPORT"));const St=c.getOrCreateProgram("collisionBox",{defines:He});let kt=Ve;g[0]===0&&g[1]===0||(kt=c.translatePosMatrix(Ve,De,g,v));const Ct=b?Pe.textCollisionBox:Pe.iconCollisionBox,Et=Pe.collisionCircleArray;if(Et.length>0){const Yt=r.bC(),Nt=kt;r.cP(Yt,Pe.placementInvProjMatrix,P.glCoordMatrix),r.cP(Yt,Yt,Pe.placementViewportMatrix),Y.push({circleArray:Et,circleOffset:ue,transform:Nt,invTransform:Yt,projection:Pe.getProjection()}),ne+=Et.length/4,ue=ne}if(!Ct)continue;c.terrain&&c.terrain.setupElevationDraw(De,St);const ei=Ze?[fe.canonical.x,fe.canonical.y,1<<fe.canonical.z]:[0,0,0];St.draw(c,C.LINES,ii.disabled,xi.disabled,c.colorModeForRenderPass(),gi.disabled,Ld(kt,Be,P,lt,z,De,ei,Pe.getProjection()),o.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,null,P.zoom,null,[Ct.collisionVertexBuffer,Ct.collisionVertexBufferExt])}if(!b||!Y.length)return;const ce=c.getOrCreateProgram("collisionCircle"),ae=new r.dZ;ae.resize(4*ne),ae._trim();let Ee=0;for(const ye of Y)for(let fe=0;fe<ye.circleArray.length/4;fe++){const De=4*fe,Pe=ye.circleArray[De+0],Be=ye.circleArray[De+1],He=ye.circleArray[De+2],Ve=ye.circleArray[De+3];ae.emplace(Ee++,Pe,Be,He,Ve,0),ae.emplace(Ee++,Pe,Be,He,Ve,1),ae.emplace(Ee++,Pe,Be,He,Ve,2),ae.emplace(Ee++,Pe,Be,He,Ve,3)}(!Mt||Mt.length<2*ne)&&(Mt=(function(ye){const fe=2*ye,De=new r.b0;De.resize(fe),De._trim();for(let Pe=0;Pe<fe;Pe++){const Be=6*Pe;De.uint16[Be+0]=4*Pe+0,De.uint16[Be+1]=4*Pe+1,De.uint16[Be+2]=4*Pe+2,De.uint16[Be+3]=4*Pe+2,De.uint16[Be+4]=4*Pe+3,De.uint16[Be+5]=4*Pe+0}return De})(ne));const xe=E.createIndexBuffer(Mt,!0),Se=E.createVertexBuffer(ae,r.d_.members,!0);for(const ye of Y){const fe=Rh(ye.transform,ye.invTransform,P,ye.projection);ce.draw(c,C.TRIANGLES,ii.disabled,xi.disabled,c.colorModeForRenderPass(),gi.disabled,fe,o.id,Se,xe,r.bg.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,P.zoom)}Se.destroy(),xe.destroy()}const Sr=r.bC();function Fa(c){const t=c._camera.getWorldToCamera(c.worldSize,1),o=r.aB([],t,c.globeMatrix);r.bl(o,o);const u=[0,0,0],g=[0,1,0,0];return r.aC(g,g,o),u[0]=g[0],u[1]=g[1],u[2]=g[2],r.aw(u,u),u}function Au({width:c,height:t,anchor:o,textOffset:u,textScale:g},v){const{horizontalAlign:b,verticalAlign:E}=r.c1(o),C=-(b-.5)*c,P=-(E-.5)*t,z=r.c2(o,u);return new r.P((C/g+z[0])*v,(P/g+z[1])*v)}function Nc(c,t,o,u,g,v,b,E,C,P){const z=c.text.placedSymbolArray,U=c.text.dynamicLayoutVertexArray,N=c.icon.dynamicLayoutVertexArray,V={},X=c.getProjection(),Z=xl(b,X,g),Y=g.elevation,ne=X.upVectorScale(b.canonical,g.center.lat,g.worldSize).metersToTile;U.clear();for(let ue=0;ue<z.length;ue++){const ce=z.get(ue),{tileAnchorX:ae,tileAnchorY:Ee,numGlyphs:xe}=ce,Se=ce.hidden||!ce.crossTileID||c.allowVerticalPlacement&&!ce.placedOrientation?null:u[ce.crossTileID];if(Se){let ye=0,fe=0,De=0;const Pe=c.elevationType==="road";if(Y||Pe){const Ze=Pe?c.getElevationFeatureForText(ue):null,lt=r.bV.getAtTileOffset(b,new r.P(ae,Ee),Y,Ze),[St,kt,Ct]=X.upVector(b.canonical,ae,Ee);ye=lt*St*ne,fe=lt*kt*ne,De=lt*Ct*ne}let[Be,He,Ve,Qe]=za(ce.projectedAnchorX+ye,ce.projectedAnchorY+fe,ce.projectedAnchorZ+De,o?Z:v);const ct=Tf(g.getCameraToCenterDistance(X),Qe);let $e=r.bM(c.textSizeData,C,ce)*ct/r.bY;o&&($e*=c.tilePixelRatio/E);const Oe=Au(Se,$e);o?({x:Be,y:He,z:Ve}=X.projectTilePoint(ae+Oe.x,Ee+Oe.y,b.canonical),[Be,He,Ve]=za(Be+ye,He+fe,Ve+De,v)):(t&&Oe._rotate(-g.angle),Be+=Oe.x,He+=Oe.y,Ve=0);const nt=c.allowVerticalPlacement&&ce.placedOrientation===r.bL.vertical?Math.PI/2:0;for(let Ze=0;Ze<xe;Ze++)r.bO(U,Be,He,Ve,nt);P&&ce.associatedIconIndex>=0&&(V[ce.associatedIconIndex]={x:Be,y:He,z:Ve,angle:nt})}else Hs(xe,U)}if(P){N.clear();const ue=c.icon.placedSymbolArray;for(let ce=0;ce<ue.length;ce++){const ae=ue.get(ce),{numGlyphs:Ee}=ae,xe=V[ce];if(ae.hidden||!xe)Hs(Ee,N);else{const{x:Se,y:ye,z:fe,angle:De}=xe;for(let Pe=0;Pe<Ee;Pe++)r.bO(N,Se,ye,fe,De)}}c.icon.dynamicLayoutVertexBuffer.updateData(N)}c.text.dynamicLayoutVertexBuffer.updateData(U)}function Cu(c,t,o,u,g,v,b={}){const E=o.paint.get("icon-translate"),C=o.paint.get("text-translate"),P=o.paint.get("icon-translate-anchor"),z=o.paint.get("text-translate-anchor"),U=o.layout.get("icon-rotation-alignment"),N=o.layout.get("text-rotation-alignment"),V=o.layout.get("icon-pitch-alignment"),X=o.layout.get("text-pitch-alignment"),Z=o.layout.get("icon-keep-upright"),Y=o.layout.get("text-keep-upright"),ne=o.paint.get("icon-color-saturation"),ue=o.paint.get("icon-color-contrast"),ce=o.paint.get("icon-color-brightness-min"),ae=o.paint.get("icon-color-brightness-max"),Ee=o.layout.get("symbol-elevation-reference")==="sea",xe=o.layout.get("icon-image-use-theme")==="none",Se=c.context,ye=Se.gl,fe=c.transform,De=U==="map",Pe=N==="map",Be=V==="map",He=X==="map",Ve=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Qe=!1;const ct=c.depthModeForSublayer(0,ii.ReadOnly),$e=new ii(c.context.gl.LEQUAL,ii.ReadOnly,c.depthRangeFor3D),Oe=[r.aF(fe.center.lng),r.aJ(fe.center.lat)],nt=o.layout.get("text-variable-anchor"),Ze=fe.projection.name==="globe",lt=[],St=[0,-1,0];for(const kt of u){const Ct=t.getTile(kt),Et=Ct.getBucket(o);if(!Et||Et.projection.name==="mercator"&&Ze||Et.fullyClipped)continue;const ei=Et.projection.name==="globe",Yt=ei?r.aj(fe.zoom):0,Nt=xl(kt,Et.getProjection(),fe),Kt=fe.calculatePixelsToTileUnitsMatrix(Ct),ai=nt&&Et.hasTextData(),_i=Et.hasIconTextFit()&&ai&&Et.hasIconData(),Pi=Et.getProjection().createInversionMatrix(fe,kt.canonical),Zi=(1<<Ct.tileID.canonical.z)*r.al/c.transform.worldSize,yi=pn=>{let Di=[0,0,0];if(pn){const ki=c.style.directionalLight,Bn=c.style.ambientLight;ki&&Bn&&(Di=xo(c.style,ki,Bn))}return Di},zi=pn=>{fe.depthOcclusionForSymbolsAndCircles&&(o.hasOcclusionOpacityProperties||c.terrain)&&(pn.push("DEPTH_D24"),pn.push("DEPTH_OCCLUSION"))},Ti=pn=>{o.lut&&!xe&&(o.lut.texture||(o.lut.texture=new r.d$(c.context,o.lut.image,[o.lut.image.height,o.lut.image.height,o.lut.image.height],Se.gl.RGBA8)),Se.activeTexture.set(Se.gl.TEXTURE0+10),o.lut.texture&&o.lut.texture.bind(Se.gl.LINEAR,Se.gl.CLAMP_TO_EDGE),pn.push("APPLY_LUT_ON_GPU"))},dn=()=>{const pn=De&&o.layout.get("symbol-placement")!=="point",Di=[];zi(Di),Ti(Di);const ki=pn||_i,Bn=Et.elevationType==="road",dr=c.shadowRenderer,Rn=Bn&&Be&&!!dr&&dr.enabled,Fn=yi(Rn),Xs=Bn&&Be&&!c.terrain?$e:ct,Rs=o.paint.get("icon-image-cross-fade");c.terrainRenderModeElevated()&&Be&&Di.push("PITCH_WITH_MAP_TERRAIN"),ei&&(Di.push("PROJECTION_GLOBE_VIEW"),ki&&Di.push("PROJECTED_POS_ON_VIEWPORT")),Rs>0&&Et.hasAnySecondaryIcon&&Di.push("ICON_TRANSITION"),!Et.icon.zOffsetVertexBuffer||Bn&&c.terrain||Di.push("Z_OFFSET"),ne===0&&ue===0&&ce===0&&ae===1||Di.push("COLOR_ADJUSTMENT"),Et.sdfIcons&&Di.push("RENDER_SDF"),Rn&&Di.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Bn&&Be&&!c.terrain&&Et.icon.orientationVertexBuffer&&Di.push("ELEVATED_ROADS");const as=Et.icon.programConfigurations.get(o.id),mn=c.getOrCreateProgram("symbol",{config:as,defines:Di}),No=Ct.imageAtlasTexture?Ct.imageAtlasTexture.size:[0,0],Ms=Et.iconSizeData,Ys=r.bK(Ms,fe.zoom),aa=Be||!fe.isOrthographic,So=au(Nt,Ct.tileID.canonical,Be,De,fe,Et.getProjection(),Kt),rr=so(Nt,Ct.tileID.canonical,Be,De,fe,Et.getProjection(),Kt),Dr=c.translatePosMatrix(rr,Ct,E,P,!0),Vn=c.translatePosMatrix(Nt,Ct,E,P),kr=ki?Sr:So,is=De&&!Be&&!pn;let lr=St;!Ze&&!fe.mercatorFromTransition||De||(lr=Fa(fe));const jo=ei?lr:St,$h=o.getColorAdjustmentMatrix(ne,ue,ce,ae),cl=Su(Ms.kind,Ys,is,Be,c,Vn,kr,Dr,Ee,!1,No,[0,0],0,kt,Yt,Oe,Pi,jo,Et.getProjection(),Fn,Zi,$h,Rs,null),ju=Ct.imageAtlasTexture?Ct.imageAtlasTexture:null,Uu=o.layout.get("icon-size").constantOr(0)!==1||Et.iconsNeedLinear,Uo=Et.sdfIcons||c.options.rotating||c.options.zooming||Uu||aa?ye.LINEAR:ye.NEAREST,ba=Et.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,ul=c.terrain&&Be&&pn?r.bl(r.bC(),So):Sr;if(pn&&Et.icon){const la=r.bV.getAtTileOffsetFunc(kt,fe.center.lat,fe.worldSize,Et.getProjection()),Hn=$l(Nt,Ct.tileID.canonical,Be,De,fe,Et.getProjection(),Kt),mc=o.layout.get("icon-size-scale-range"),cp=r.aA(c.scaleFactor,mc[0],mc[1]);xn(Et,Nt,c,!1,Hn,rr,Be,Z,la,kt,cp)}return{program:mn,buffers:Et.icon,uniformValues:cl,atlasTexture:ju,atlasTextureIcon:null,atlasInterpolation:Uo,atlasInterpolationIcon:null,isSDF:Et.sdfIcons,hasHalo:ba,depthMode:Xs,tile:Ct,renderWithShadows:Rn,labelPlaneMatrixInv:ul}},an=()=>{const pn=Pe&&o.layout.get("symbol-placement")!=="point",Di=[],ki=pn||nt||_i,Bn=Et.elevationType==="road",dr=c.shadowRenderer,Rn=Bn&&He&&!!dr&&dr.enabled,Fn=yi(Rn),Xs=Bn&&He&&!c.terrain?$e:ct;c.terrainRenderModeElevated()&&He&&Di.push("PITCH_WITH_MAP_TERRAIN"),ei&&(Di.push("PROJECTION_GLOBE_VIEW"),ki&&Di.push("PROJECTED_POS_ON_VIEWPORT")),!Et.text.zOffsetVertexBuffer||Bn&&c.terrain||Di.push("Z_OFFSET"),Et.iconsInText&&Di.push("RENDER_TEXT_AND_SYMBOL"),Di.push("RENDER_SDF"),Rn&&Di.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Bn&&He&&!c.terrain&&Et.text.orientationVertexBuffer&&Di.push("ELEVATED_ROADS"),zi(Di);const Rs=Et.text.programConfigurations.get(o.id),as=c.getOrCreateProgram("symbol",{config:Rs,defines:Di});let mn,No=[0,0],Ms=null;const Ys=Et.textSizeData;Et.iconsInText&&(No=Ct.imageAtlasTexture?Ct.imageAtlasTexture.size:[0,0],Ms=Ct.imageAtlasTexture?Ct.imageAtlasTexture:null,mn=He||!fe.isOrthographic||c.options.rotating||c.options.zooming||Ys.kind==="composite"||Ys.kind==="camera"?ye.LINEAR:ye.NEAREST);const aa=Ct.glyphAtlasTexture?Ct.glyphAtlasTexture.size:[0,0],So=o.layout.get("text-size-scale-range"),rr=r.aA(c.scaleFactor,So[0],So[1]),Dr=r.bK(Ys,fe.zoom,rr),Vn=au(Nt,Ct.tileID.canonical,He,Pe,fe,Et.getProjection(),Kt),kr=so(Nt,Ct.tileID.canonical,He,Pe,fe,Et.getProjection(),Kt),is=c.translatePosMatrix(kr,Ct,C,z,!0),lr=c.translatePosMatrix(Nt,Ct,C,z),jo=ki?Sr:Vn,$h=Pe&&!He&&!pn;let cl=St;!Ze&&!fe.mercatorFromTransition||Pe||(cl=Fa(fe));const ju=Su(Ys.kind,Dr,$h,He,c,lr,jo,is,Ee,!0,aa,No,0,kt,Yt,Oe,Pi,ei?cl:St,Et.getProjection(),Fn,Zi,null,null,rr),Uu=Ct.glyphAtlasTexture?Ct.glyphAtlasTexture:null,Uo=ye.LINEAR,ba=o.paint.get("text-halo-width").constantOr(1)!==0,ul=c.terrain&&He&&pn?r.bl(r.bC(),Vn):Sr;if(pn&&Et.text){const la=r.bV.getAtTileOffsetFunc(kt,fe.center.lat,fe.worldSize,Et.getProjection()),Hn=$l(Nt,Ct.tileID.canonical,He,Pe,fe,Et.getProjection(),Kt);xn(Et,Nt,c,!0,Hn,kr,He,Y,la,kt,rr)}return{program:as,buffers:Et.text,uniformValues:ju,atlasTexture:Uu,atlasTextureIcon:Ms,atlasInterpolation:Uo,atlasInterpolationIcon:mn,isSDF:!0,hasHalo:ba,depthMode:Xs,tile:Ct,renderWithShadows:Rn,labelPlaneMatrixInv:ul}},wn=Et.icon.segments.get().length,tn=Et.text.segments.get().length,Li=wn&&!b.onlyText?dn():null,un=tn&&!b.onlyIcons?an():null,Xn=o.paint.get("icon-opacity").constantOr(1),Tn=o.paint.get("text-opacity").constantOr(1);if(Ve&&Et.canOverlap){Qe=!0;const pn=Xn&&!b.onlyText?Et.icon.segments.get():[],Di=Tn&&!b.onlyIcons?Et.text.segments.get():[];for(const ki of pn)lt.push({segments:new r.bg([ki]),sortKey:ki.sortKey,state:Li});for(const ki of Di)lt.push({segments:new r.bg([ki]),sortKey:ki.sortKey,state:un})}else b.onlyText||lt.push({segments:Xn?Et.icon.segments:new r.bg([]),sortKey:0,state:Li}),b.onlyIcons||lt.push({segments:Tn?Et.text.segments:new r.bg([]),sortKey:0,state:un})}Qe&&lt.sort((kt,Ct)=>kt.sortKey-Ct.sortKey);for(const kt of lt){const Ct=kt.state;if(Ct)if(c.terrain?c.terrain.setupElevationDraw(Ct.tile,Ct.program,{useDepthForOcclusion:fe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ct.labelPlaneMatrixInv}):c.setupDepthForOcclusion(fe.depthOcclusionForSymbolsAndCircles,Ct.program),Se.activeTexture.set(ye.TEXTURE0),Ct.atlasTexture&&Ct.atlasTexture.bind(Ct.atlasInterpolation,ye.CLAMP_TO_EDGE,!0),Ct.atlasTextureIcon&&(Se.activeTexture.set(ye.TEXTURE1),Ct.atlasTextureIcon&&Ct.atlasTextureIcon.bind(Ct.atlasInterpolationIcon,ye.CLAMP_TO_EDGE,!0)),Ct.renderWithShadows&&c.shadowRenderer.setupShadows(Ct.tile.tileID.toUnwrapped(),Ct.program,"vector-tile"),c.uploadCommonLightUniforms(c.context,Ct.program),Ct.hasHalo){const Et=Ct.uniformValues;Et.u_is_halo=1,jc(Ct.buffers,kt.segments,o,c,Ct.program,Ct.depthMode,g,v,Et,2),Et.u_is_halo=0}else{if(Ct.isSDF){const Et=Ct.uniformValues;Ct.hasHalo&&(Et.u_is_halo=1,jc(Ct.buffers,kt.segments,o,c,Ct.program,Ct.depthMode,g,v,Et,1)),Et.u_is_halo=0}jc(Ct.buffers,kt.segments,o,c,Ct.program,Ct.depthMode,g,v,Ct.uniformValues,1)}}}function jc(c,t,o,u,g,v,b,E,C,P){const z=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer,c.orientationVertexBuffer];g.draw(u,u.context.gl.TRIANGLES,v,b,E,gi.disabled,C,o.id,c.layoutVertexBuffer,c.indexBuffer,t,o.paint,u.transform.zoom,c.programConfigurations.get(o.id),z,P)}function Uc(c,t){const o=1<<c.canonical.z,u=(t.x*o-c.canonical.x-c.wrap*o)*r.al,g=(t.y*o-c.canonical.y)*r.al,v=r.e8(t.z,t.y);return r.d5(u,g,v)}function rm(c,t,o,u,g){if(!o.layout||o.layout.get("fill-elevation-reference")==="none"||o.paint.get("fill-opacity").constantOr(1)===0)return;const v=c.context.gl,b=new ii(c.context.gl.LEQUAL,ii.ReadWrite,c.depthRangeFor3D),E=new ii(c.context.gl.GREATER,ii.ReadWrite,c.depthRangeFor3D),C=(function(V){let X=.01;return V.isOrthographic&&(X=r.ak(1e-4,X,r.d0(V.pitch>=ea?1:V.pitch/ea))),2*X})(c.transform),P=c.transform.getFreeCameraOptions().position,z="elevatedStructuresDepthReconstruct",U=c.getOrCreateProgram(z,{defines:["DEPTH_RECONSTRUCTION"]}),N=c.getOrCreateProgram(z);for(const V of u){const X=t.getTile(V),Z=X.getBucket(o);if(!Z)continue;const Y=Z.elevatedStructures;if(!Y)continue;const ne=Z.elevationBufferData.heightRange,ue=Uc(V.toUnwrapped(),P),ce=c.translatePosMatrix(V.projMatrix,X,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));let ae,Ee,xe,Se;if(g==="initialize"){if(!ne||ne.min>=1||Y.depthSegments.segments[0].primitiveLength===0)continue;ae=Fc(ce,ue,C,1,0),Ee=b,xe=Y.depthSegments,Se=U}else if(g==="reset"){if(!ne||ne.min>=0||Y.maskSegments.segments[0].primitiveLength===0)continue;ae=Fc(ce,ue,0,0,1),Ee=E,xe=Y.maskSegments,Se=U}else if(g==="geometry"){if(Y.depthSegments.segments[0].primitiveLength===0)continue;ae=Fc(ce,ue,C,1,0),Ee=b,xe=Y.depthSegments,Se=N}Se.draw(c,v.TRIANGLES,Ee,xi.disabled,wi.disabled,gi.disabled,ae,o.id,Y.vertexBuffer,Y.indexBuffer,xe,o.paint,c.transform.zoom)}}function zr(c,t,o,u){const{painter:g,sourceCache:v,layer:b,coords:E,colorMode:C,elevationType:P,terrainEnabled:z,pass:U}=c,N=g.context.gl,V=b.paint.get("fill-pattern"),X=b.paint.get("fill-pattern-cross-fade"),Z=V.constantOr(null);let Y=P;P!=="road"||t&&!z||(Y="none");const ne=Y==="road",ue=c.painter.shadowRenderer,ce=ne&&!!ue&&ue.enabled,ae=new ii(g.context.gl.LEQUAL,ii.ReadOnly,g.depthRangeFor3D);let Ee=[0,0,0];if(ce){const fe=g.style.directionalLight,De=g.style.ambientLight;fe&&De&&(Ee=xo(g.style,fe,De))}const xe=V&&V.constantOr(1),Se=g.terrain&&g.terrain.renderingToTexture,ye=(fe,De)=>{let Pe,Be,He,Ve,Qe;De?(Pe=xe&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",He=N.LINES):(Pe=xe?"fillPattern":"fill",He=N.TRIANGLES);for(const ct of E){const $e=v.getTile(ct);if(xe&&!$e.patternsLoaded())continue;const Oe=$e.getBucket(b);if(!Oe)continue;const nt=t?Oe.elevationBufferData:Oe.bufferData;if(nt.isEmpty())continue;g.prepareDrawTile();const Ze=nt.programConfigurations.get(b.id),lt=g.isTileAffectedByFog(ct),St=[],kt=[];ne&&(St.push("ELEVATED_ROADS"),kt.push(nt.elevatedLayoutVertexBuffer)),ce&&St.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Se&&o&&St.push("USE_MRT1"),xe&&(g.context.activeTexture.set(N.TEXTURE0),$e.imageAtlasTexture&&$e.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Ze.updatePaintBuffers());let Ct=!1;if(Z&&$e.imageAtlas){const Kt=$e.imageAtlas,ai=r.e3.from(Z),_i=ai.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Pi=ai.getSecondary(),Zi=Kt.patternPositions.get(_i),yi=Pi?Kt.patternPositions.get(Pi.scaleSelf(r.o.devicePixelRatio).toString()):null;Ct=!!Zi&&!!yi,Zi&&Ze.setConstantPatternPositions(Zi,yi)}X>0&&(Ct||Ze.getPatternTransitionVertexBuffer("fill-pattern"))&&St.push("FILL_PATTERN_TRANSITION");const Et=g.getOrCreateProgram(Pe,{config:Ze,overrideFog:lt,defines:St}),ei=g.translatePosMatrix(ct.projMatrix,$e,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));ce&&ue.setupShadows($e.tileID.toUnwrapped(),Et,"vector-tile");const Yt=b.paint.get("fill-emissive-strength");if(De){Ve=nt.lineIndexBuffer,Qe=nt.lineSegments;const Kt=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[N.drawingBufferWidth,N.drawingBufferHeight];Be=Pe==="fillOutlinePattern"&&xe?zd(ei,Yt,g,$e,Kt,Ee,X):Ih(ei,Yt,Kt,Ee)}else Ve=nt.indexBuffer,Qe=nt.triangleSegments,Be=xe?Bc(ei,Yt,g,$e,Ee,X):kc(ei,Yt,Ee);g.uploadCommonUniforms(g.context,Et,ct.toUnwrapped());let Nt=fe;(P==="road"&&!z||P==="offset")&&(Nt=ae),Et.draw(g,He,Nt,u||g.stencilModeForClipping(ct),C,gi.disabled,Be,b.id,nt.layoutVertexBuffer,Ve,Qe,b.paint,g.transform.zoom,Ze,kt)}};g.renderPass===U&&ye(g.depthModeForSublayer(1,g.renderPass==="opaque"?ii.ReadWrite:ii.ReadOnly),!1),Y==="none"&&g.renderPass==="translucent"&&b.paint.get("fill-antialias")&&ye(g.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,ii.ReadOnly),!0)}function Vc(c,t,o,u,g,v,b,E){o.resetLayerRenderingStats(c);const C=c.context,P=C.gl,z=c.transform,U=o.paint.get("fill-extrusion-pattern"),N=o.paint.get("fill-extrusion-pattern-cross-fade"),V=U.constantOr(null),X=U.constantOr(1),Z=o.paint.get("fill-extrusion-opacity"),Y=c.style.enable3dLights(),ne=o.paint.get(Y&&!X?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ue=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),ne],ce=o.layout.get("fill-extrusion-edge-radius"),ae=ce>0&&!o.paint.get("fill-extrusion-rounded-roof"),Ee=ae?0:ce,xe=z.projection.name==="globe"?r.eb():0,Se=z.projection.name==="globe",ye=Se?r.aj(z.zoom):0,fe=[r.aF(z.center.lng),r.aJ(z.center.lat)],De=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Pe=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(De?null:o.lut).toArray01().slice(0,3),Be=o.paint.get("fill-extrusion-flood-light-intensity"),He=o.paint.get("fill-extrusion-vertical-scale"),Ve=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Qe=o.paint.get("fill-extrusion-height-alignment"),ct=o.paint.get("fill-extrusion-base-alignment"),$e=pa(c,o.paint.get("fill-extrusion-cutoff-fade-range")),Oe=[];let nt;Se&&Oe.push("PROJECTION_GLOBE_VIEW"),ue[0]>0&&Oe.push("FAUX_AO"),ae&&Oe.push("ZERO_ROOF_RADIUS"),E&&Oe.push("HAS_CENTROID"),Be>0&&Oe.push("FLOOD_LIGHT"),$e.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF"),Ve&&Oe.push("RENDER_WALL_MODE");const Ze=c.renderPass==="shadow",lt=c.shadowRenderer,St=Ze&&!!lt,kt=Ze?gi.disabled:gi.backCCW;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let Ct=[0,0,0];if(lt){const Yt=c.style.directionalLight,Nt=c.style.ambientLight;Yt&&Nt&&(Ct=xo(c.style,Yt,Nt)),Ze||(Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),lt.useNormalOffset&&Oe.push("NORMAL_OFFSET")),nt=Oe.concat(["SHADOWS_SINGLE_CASCADE"])}const Et=St?"fillExtrusionDepth":X?"fillExtrusionPattern":"fillExtrusion",ei=o.getLayerRenderingStats();for(const Yt of u){const Nt=t.getTile(Yt),Kt=Nt.getBucket(o);if(!Kt||Kt.projection.name!==z.projection.name)continue;let ai=!1;lt&&(ai=lt.getMaxCascadeForTile(Yt.toUnwrapped())===0);const _i=c.isTileAffectedByFog(Yt),Pi=Kt.programConfigurations.get(o.id);let Zi=!1;if(V&&Nt.imageAtlas){const tn=Nt.imageAtlas,Li=r.e3.from(V),un=Li.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Xn=Li.getSecondary(),Tn=tn.patternPositions.get(un),pn=Xn?tn.patternPositions.get(Xn.scaleSelf(r.o.devicePixelRatio).toString()):null;Zi=!!Tn&&!!pn,Tn&&Pi.setConstantPatternPositions(Tn,pn)}N>0&&(Zi||Pi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Oe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const yi=c.getOrCreateProgram(Et,{config:Pi,defines:ai?nt:Oe,overrideFog:_i});if(c.terrain&&c.terrain.setupElevationDraw(Nt,yi,{useMeterToDem:!0}),!Kt.centroidVertexBuffer){const tn=yi.getAttributeLocation(P,"a_centroid_pos");tn!==-1&&P.vertexAttrib2f(tn,0,0)}!Ze&&lt&&lt.setupShadows(Nt.tileID.toUnwrapped(),yi,"vector-tile"),X&&(c.context.activeTexture.set(P.TEXTURE0),Nt.imageAtlasTexture&&Nt.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Pi.updatePaintBuffers());const zi=o.paint.get("fill-extrusion-vertical-gradient"),Ti=1/Kt.tileToMeter;let dn;if(Ze&&lt){if(Fd(Nt.tileID,Kt.maxHeight,c))continue;const tn=lt.calculateShadowPassMatrixFromTile(Nt.tileID.toUnwrapped());dn=oc(tn,Ee,Ti,He,Qe,ct)}else{const tn=c.translatePosMatrix(Yt.expandedProjMatrix,Nt,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Li=z.projection.createInversionMatrix(z,Yt.canonical);dn=X?im(tn,c,zi,Z,ue,Ee,Ti,Yt,Nt,xe,Qe,ct,ye,fe,Li,Pe,He,N):Il(tn,c,zi,Z,ue,Ee,Ti,Yt,xe,Qe,ct,ye,fe,Li,Pe,He,Be,Ct)}c.uploadCommonUniforms(C,yi,Yt.toUnwrapped(),null,$e);let an=Kt.segments;if(z.projection.name==="mercator"&&!Ze&&(an=Kt.getVisibleSegments(Nt.tileID,c.terrain,c.transform.getFrustum(0)),!an.get().length))continue;if(ei)if(Ze)for(const tn of an.get())ei.numRenderedVerticesInShadowPass+=tn.primitiveLength;else for(const tn of an.get())ei.numRenderedVerticesInTransparentPass+=tn.primitiveLength;const wn=[];(c.terrain||E)&&wn.push(Kt.centroidVertexBuffer),Se&&wn.push(Kt.layoutVertexExtBuffer),Ve&&wn.push(Kt.wallVertexBuffer),yi.draw(c,C.gl.TRIANGLES,g,v,b,kt,dn,o.id,Kt.layoutVertexBuffer,Kt.indexBuffer,an,o.paint,c.transform.zoom,Pi,wn)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}class Iu{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function tl(c,t,o,u,g,v,b,E,C,P,z,U,N,V,X,Z,Y,ne,ue,ce){const ae=t.context,Ee=ae.gl,xe=t.transform,Se=t.transform.zoom,ye=[],fe=c.translate,De=c.translateAnchor,Pe=c.edgeRadius,Be=pa(t,c.cutoffFadeRange);z==="clear"?(ye.push("CLEAR_SUBPASS"),ce&&(ye.push("CLEAR_FROM_TEXTURE"),ae.activeTexture.set(Ee.TEXTURE0),ce.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE))):z==="sdf"?ye.push("SDF_SUBPASS"):z==="emissive"&&(ye.push("USE_MRT1"),ae.activeTexture.set(Ee.TEXTURE0),ce.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)),ne&&ye.push("HAS_CENTROID"),Be.shouldRenderCutoff&&ye.push("RENDER_CUTOFF");const He=(Ve,Qe,ct,$e,Oe)=>{let nt=ye;Qe.groundRadiusBuffer!=null&&(nt=ye.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Ze=Qe.programConfigurations.get(u.id),lt=t.isTileAffectedByFog(Ve),St=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ze,defines:nt,overrideFog:lt}),kt=((Et,ei,Yt,Nt,Kt,ai,_i,Pi,Zi,yi,zi)=>({u_matrix:ei,u_opacity:Yt,u_ao_pass:Nt?1:0,u_meter_to_tile:Kt,u_ao:ai,u_flood_light_intensity:_i,u_flood_light_color:Pi,u_attenuation:Zi,u_edge_radius:yi,u_fb:0,u_fb_size:zi,u_dynamic_offset:1}))(0,$e,U,P,Oe,[N,V*Oe],X,Z,Y,Se>=17?0:Pe*Oe,ce?ce.size[0]:0),Ct=[];ne&&Ct.push(Qe.hiddenByLandmarkVertexBuffer),Qe.groundRadiusBuffer!=null&&Ct.push(Qe.groundRadiusBuffer),t.uploadCommonUniforms(ae,St,Ve.toUnwrapped(),null,Be),St.draw(t,ae.gl.TRIANGLES,v,b,E,C,kt,u.id,Qe.vertexBuffer,Qe.indexBuffer,ct,u.paint,Se,Ze,Ct)};for(const Ve of g){const Qe=o.getTile(Ve),ct=Qe.getBucket(u);if(!ct||ct.projection.name!==xe.projection.name||!ct.groundEffect||ct.groundEffect&&!ct.groundEffect.hasData())continue;const $e=ct.groundEffect,Oe=1/ct.tileToMeter;{const nt=t.translatePosMatrix(Ve.projMatrix,Qe,fe,De),Ze=$e.getDefaultSegment();He(Ve,$e,Ze,nt,Oe)}if(ue)for(let nt=0;nt<4;nt++){const Ze=r.e9[nt](Ve),lt=o.getTile(Ze);if(!lt)continue;const St=lt.getBucket(u);if(!St||St.projection.name!==xe.projection.name||!St.groundEffect||St.groundEffect&&!St.groundEffect.hasData())continue;const kt=St.groundEffect;let Ct,Et;nt===0?(Ct=[-r.al,0,0],Et=1):nt===1?(Ct=[r.al,0,0],Et=0):nt===2?(Ct=[0,-r.al,0],Et=3):(Ct=[0,r.al,0],Et=2);const ei=kt.regionSegments[Et];if(!ei)continue;const Yt=new Float32Array(16);r.br(Yt,Ve.projMatrix,Ct),He(Ve,kt,ei,t.translatePosMatrix(Yt,Qe,fe,De),Oe)}}}function sm(c,t,o,u,g,v,b){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const E=v?v.findDEMTileFor(o):null;if(!(E&&E.dem||b))return;v&&E&&E.dem&&u.selfDEMTileTimestamp!==E.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=E.dem._timestamp);const C=(Y,ne)=>{(Y.flags|ne.flags)&r.ec?(Y.flags|=r.ec,ne.flags|=r.ec):(Y.flags&=~r.ec,ne.flags&=~r.ec)},P=Y=>new r.P(Math.ceil((Y+r.ed)*r.ee),0),z=Y=>{const ne=t.getSource().minzoom,ue=ae=>{const Ee=t.getTileByID(ae);if(Ee&&Ee.hasData())return Ee.getBucket(g)},ce=[0,-1,1];for(const ae of ce){if(Y.overscaledZ+ae<ne)continue;const Ee=ue(Y.calculateScaledKey(Y.overscaledZ+ae));if(Ee)return Ee}},U=[0,0,0],N=(Y,ne)=>(U[0]=Math.min(Y.min.y,ne.min.y),U[1]=Math.max(Y.max.y,ne.max.y),U[2]=r.al-ne.min.x>Y.max.x?ne.min.x-r.al:Y.max.x,U),V=(Y,ne)=>(U[0]=Math.min(Y.min.x,ne.min.x),U[1]=Math.max(Y.max.x,ne.max.x),U[2]=r.al-ne.min.y>Y.max.y?ne.min.y-r.al:Y.max.y,U),X=[(Y,ne)=>N(Y,ne),(Y,ne)=>N(ne,Y),(Y,ne)=>V(Y,ne),(Y,ne)=>V(ne,Y)],Z=(Y,ne,ue,ce,ae,Ee,xe)=>{if(!v)return 0;const Se=[[Ee?ue:Y,Ee?Y:ue,0],[Ee?ue:ne,Ee?ne:ue,0]],ye=xe<0?r.al+xe:xe,fe=[Ee?ye:(Y+ne)/2,Ee?(Y+ne)/2:ye,0];return ue===0&&xe<0||ue!==0&&xe>0?v.getForTilePoints(ae,[fe],!0,ce):Se.push(fe),v.getForTilePoints(o,Se,!0,E),Math.max(Se[0][2],Se[1][2],fe[2])/v.exaggeration()};for(let Y=0;Y<4;Y++){const ne=u.borderFeatureIndices[Y];if(ne.length===0)continue;const ue=r.e9[Y](o),ce=z(ue);if(!(ce&&ce instanceof r.ea))continue;const ae=v?v.findDEMTileFor(ue):null;if(!(ae&&ae.dem||b)||(v&&ae&&ae.dem&&u.borderDEMTileTimestamp[Y]!==ae.dem._timestamp&&(u.borderDoneWithNeighborZ[Y]=-1,u.borderDEMTileTimestamp[Y]=ae.dem._timestamp),u.borderDoneWithNeighborZ[Y]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const Ee=(Y<2?1:5)-Y,xe=ce.borderDoneWithNeighborZ[Ee]!==u.canonical.z,Se=ce.borderFeatureIndices[Ee];let ye=0;if(u.canonical.z!==ce.canonical.z){for(const fe of ne)u.showCentroid(u.featuresOnBorder[fe]);if(xe)for(const fe of Se)ce.showCentroid(ce.featuresOnBorder[fe]);u.borderDoneWithNeighborZ[Y]=ce.canonical.z,ce.borderDoneWithNeighborZ[Ee]=u.canonical.z}for(const fe of ne){const De=u.featuresOnBorder[fe],Pe=u.centroidData[De.centroidDataIndex],Be=De.borders[Y];let He;for(;ye<Se.length;){He=ce.featuresOnBorder[Se[ye]];const Ve=He.borders[Ee];if(Ve[1]>Be[0]+3||Ve[0]>Be[0]-3)break;ce.showCentroid(He),ye++}if(He&&ye<Se.length){const Ve=ye;let Qe=0;for(;!(He.borders[Ee][0]>Be[1]-3)&&(Qe++,++ye!==Se.length);)He=ce.featuresOnBorder[Se[ye]];He=ce.featuresOnBorder[Se[Ve]];let ct=!1;if(Qe>=1){const nt=He.borders[Ee];Math.abs(Be[0]-nt[0])<3&&Math.abs(Be[1]-nt[1])<3&&(Qe=1,ct=!0,ye=Ve+1)}else if(Qe===0){u.showCentroid(De);continue}const $e=ce.centroidData[He.centroidDataIndex];b&&ct&&C(Pe,$e);const Oe=De.intersectsCount()>1||He.intersectsCount()>1;if(Qe>1)ye=Ve,Pe.centroidXY=$e.centroidXY=new r.P(0,0);else if(ae&&ae.dem&&!Oe){const nt=X[Y](Pe,$e),Ze=Y%2?r.al-1:0,lt=Z(nt[0],Math.min(r.al-1,nt[1]),Ze,ae,ue,Y<2,nt[2]);Pe.centroidXY=$e.centroidXY=P(lt)}else Oe?Pe.centroidXY=$e.centroidXY=new r.P(0,0):(Pe.centroidXY=u.encodeBorderCentroid(De),$e.centroidXY=ce.encodeBorderCentroid(He));u.writeCentroidToBuffer(Pe),ce.writeCentroidToBuffer($e)}else u.showCentroid(De)}u.borderDoneWithNeighborZ[Y]=ce.canonical.z,ce.borderDoneWithNeighborZ[Ee]=u.canonical.z}(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}const Dg=[1,0,0],Vf=[0,1,0],Gf=[0,0,1];function Fd(c,t,o){const u=o.transform,g=o.shadowRenderer;if(!g)return!0;const v=c.toUnwrapped(),b=u.tileSize*g._cascades[o.currentShadowCascade].scale;let E=t;if(u.elevation){const Z=u.elevation.getMinMaxForTile(c);Z&&(E+=Z.max)}const C=[...g.shadowDirection];C[2]=-C[2];const P=g.computeSimplifiedTileShadowVolume(v,E,b,C);if(!P)return!1;const z=[Dg,Vf,Gf,C,[C[0],0,C[2]],[0,C[1],C[2]]],U=u.projection.name==="globe",N=u.scaleZoom(b),V=r.cB.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,N,!U),X=g.getCurrentCascadeFrustum();return V.intersectsPrecise(P.vertices,P.planes,z)===0||X.intersectsPrecise(P.vertices,P.planes,z)===0}function Is(c){const{painter:t,source:o,layer:u,coords:g}=c;let v=c.defines;const b=t.context,E=t.renderPass==="shadow",C=t.renderPass==="light-beam",P=t.shadowRenderer,z=r.ef(t.transform.center.lat,t.transform.zoom),U=pa(t,u.paint.get("building-cutoff-fade-range"));U.shouldRenderCutoff&&(v=v.concat("RENDER_CUTOFF")),c.floodLightIntensity>0&&(v=v.concat("FLOOD_LIGHT"));for(const N of g){const V=o.getTile(N),X=V.getBucket(u);if(!X)continue;P&&P.getMaxCascadeForTile(N.toUnwrapped())===0&&(v=v.concat("SHADOWS_SINGLE_CASCADE"));const Z=X.programConfigurations.get(u.id);let Y,ne,ue,ce=t.translatePosMatrix(N.expandedProjMatrix,V,[0,0],"map");if(ce=r.cS(r.bC(),ce,[1,1,c.verticalScale]),E&&P){if(Fd(V.tileID,X.maxHeight*z,t))continue;let Ee=P.calculateShadowPassMatrixFromTile(V.tileID.toUnwrapped());Ee=r.cS(r.bC(),Ee,[1,1,c.verticalScale]),ue=Bo(Ee),Y=ne=t.getOrCreateProgram("buildingDepth",{config:Z,defines:v,overrideFog:!1})}else if(C)Y=ne=t.getOrCreateProgram("buildingBloom",{config:Z,defines:v,overrideFog:!1}),ue=nm(ce);else{const Ee=t.transform.calculatePosMatrix(N.toUnwrapped(),t.transform.worldSize);r.cS(Ee,Ee,[1,1,c.verticalScale]);const xe=r.bC();r.cS(xe,Ee,[1,-1,1/z]),r.bl(xe,xe),r.eg(xe,xe);const Se=t.transform.getFreeCameraOptions().position,ye=1<<N.canonical.z;if(ue=Rl(ce,xe,c.opacity,c.facadeAOIntensity,[((Se.x-N.wrap)*ye-N.canonical.x)*r.al,(Se.y*ye-N.canonical.y)*r.al,Se.z*ye*r.al],X.tileToMeter,c.facadeEmissiveChance,c.floodLightColor,c.floodLightIntensity),ne=t.getOrCreateProgram("building",{config:Z,defines:v,overrideFog:!1}),c.depthOnly===!0)Y=ne;else{const fe=v.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);Y=t.getOrCreateProgram("building",{config:Z,defines:fe,overrideFog:!1})}P&&(P.setupShadowsFromMatrix(Ee,ne,!0),Y!==ne&&P.setupShadowsFromMatrix(Ee,Y,!0))}const ae=(Ee,xe)=>{if(C){const Se=Ee.entranceBloom;xe.draw(t,b.gl.TRIANGLES,c.depthMode,xi.disabled,c.blendMode,gi.disabled,ue,u.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segmentsBucket,u.paint,t.transform.zoom,Z,[Se.layoutAttenuationBuffer,Se.layoutColorBuffer])}else{const Se=Ee.segmentsBucket;let ye=[Ee.layoutNormalBuffer,Ee.layoutCentroidBuffer,Ee.layoutColorBuffer,Ee.layoutFloodLightDataBuffer];Ee.layoutFacadePaintBuffer&&(ye=ye.concat([Ee.layoutFacadeDataBuffer,Ee.layoutFacadeVerticalRangeBuffer,Ee.layoutFacadePaintBuffer])),xe.draw(t,b.gl.TRIANGLES,c.depthMode,xi.disabled,c.blendMode,E?gi.disabled:gi.backCW,ue,u.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Se,u.paint,t.transform.zoom,Z,ye)}};t.uploadCommonUniforms(b,ne,N.toUnwrapped(),null,U),X.buildingWithoutFacade&&ae(X.buildingWithoutFacade,ne),X.buildingWithFacade&&(Y!==ne&&t.uploadCommonUniforms(b,Y,N.toUnwrapped(),null,U),ae(X.buildingWithFacade,Y))}}function Yr(c,t,o,u,g,v,b,E,C,P,z,U,N){const V=c.context.gl,X=c.depthModeForSublayer(1,ii.ReadOnly,V.LEQUAL,!0),Z=.1*(1-(Y=z))+3*Y;var Y;const ne=c._showOverdrawInspector,ue=U,ce=new Iu;ne||tl(ce,c,t,o,u,X,new xi({func:V.ALWAYS,mask:255},255,255,V.KEEP,V.KEEP,V.REPLACE),new wi([V.ONE,V.ONE,V.ONE,V.ONE],r.ao.transparent,[!1,!1,!1,!0],V.MIN),gi.disabled,g,"sdf",v,b,E,C,P,Z,ue,!1);{const ae=ne?xi.disabled:new xi({func:V.EQUAL,mask:255},255,255,V.KEEP,V.DECR,V.DECR),Ee=ne?c.colorModeForRenderPass():new wi([V.ONE_MINUS_DST_ALPHA,V.DST_ALPHA,V.ONE,V.ONE],r.ao.transparent,[!0,!0,!0,!0]);tl(ce,c,t,o,u,X,ae,Ee,gi.disabled,g,"color",v,b,E,C,P,Z,ue,!1)}}function Dh(c){return[c[0]*r.eh,c[1]*r.eh,c[2]*r.eh,0]}function Gc(c,t,o,u,g,v,b,E,C){const P=u.getSource(),z=o.globeSharedBuffers;if(!z)return;let U,N,V;if(t&&(U=u.getTile(t)),P instanceof r.aU?(N=P.texture,V=r.dK(0,0,o.transform)):U&&t&&(N=U.texture,V=r.dK(t.canonical.z,t.canonical.x,o.transform)),!N||!V)return;c||(V=r.cS(r.bC(),V,[1,-1,1]));const X=o.context,Z=X.gl,Y=g.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,ne=o.colorModeForDrapableLayerRenderPass(v),ue=b.defines;ue.push("GLOBE_POLES");const ce=new ii(Z.LEQUAL,ii.ReadWrite,o.depthRangeFor3D),ae=Float32Array.from(o.transform.expandedFarZProjMatrix),Ee=Float32Array.from(r.bk(r.dJ(new r.cD(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),X.activeTexture.set(Z.TEXTURE0),N.bind(Y,Z.CLAMP_TO_EDGE),X.activeTexture.set(Z.TEXTURE1),N.bind(Y,Z.CLAMP_TO_EDGE),"useMipmap"in N&&X.extTextureFilterAnisotropic&&o.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const[xe,Se,ye,fe]=t?z.getPoleBuffers(t.canonical.z,!1):z.getPoleBuffers(0,!0),De=g.paint.get("raster-elevation");let Pe;c?(Pe=xe,o.renderDefaultNorthPole=De!==0):(Pe=Se,o.renderDefaultSouthPole=De!==0);const Be=Dh(b.mix),He=((Qe,ct,$e,Oe,nt,Ze,lt,St,kt,Ct,Et,ei,Yt)=>bu(Qe,ct,$e,new Float32Array(16),new Float32Array(9),[0,0],Oe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],St,2,Ct,Et,ei,1,0,Yt))(ae,Ee,V,r.aj(o.transform.zoom),0,g,0,De,0,Be,b.offset,b.range,v),Ve=o.getOrCreateProgram("raster",{defines:ue});o.uploadCommonUniforms(X,Ve,null),Ve.draw(o,Z.TRIANGLES,ce,C,ne,E,He,g.id,Pe,ye,fe)}function Nd(c){if(c.isOrthographic)return[0,0,0,0];const t=c._nearZ,o=c.projection.farthestPixelDistance(c),u=o-t,g=.2*c.height,v=t+g;return[t,o,(v-g-t)/u,(v-t)/u]}function qf(c,t,o,u){if(c)return t instanceof ro&&c instanceof sh?t.getTextureDescriptor(c,o,!0):{texture:c.texture,mix:Dh(u.mix),offset:u.offset,buffer:0,tileSize:1}}var il=r.ei([{name:"a_index",type:"Int16",components:1}]);class jd{constructor(t,o,u,g){const v={width:u[0],height:u[1],data:null},b=t.gl;this.targetColorTexture=new r.T(t,v,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,v,b.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(o,g),this.lastInvalidatedAt=0}updateParticleTexture(t,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,g=o.width*o.height;this.particleTexture0=new r.T(this.context,o,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,o,u.RGBA8,{premultiply:!1,useMipmap:!1});const v=new r.ej;v.reserve(g);for(let b=0;b<g;b++)v.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(v,il.members,!0),this.particleSegment=r.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ud(c,t,o){if(!c)return null;const u=t.getTextureDescriptor(c,o,!0);if(!u)return null;let{texture:g,mix:v,offset:b,tileSize:E,buffer:C,format:P}=u;if(!g||!P)return null;let z=!1;return P==="uint32"&&(z=!0,v[3]=0,v=Mh(r.ek,v,[0,o.paint.get("raster-particle-max-speed")]),b=jf(r.ek,b,[0,o.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[C/(E+2*C),E/(E+2*C)],tileSize:E,scalarData:z,scale:v,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function Hf(c){const t=c._nearZ,o=c.projection.farthestPixelDistance(c),u=o-t,g=.2*c.height,v=t+g;return[t,o,(v-g-t)/u,(v-t)/u]}const $f=new r.ao(1,0,0,1),Zf=new r.ao(0,1,0,1),Wf=new r.ao(0,0,1,1),Og=new r.ao(1,0,1,1),Pg=new r.ao(0,1,1,1);function om(c,t,o,u,g,v){for(let b=0;b<o.length;b++)if(g){const P=new r.ao(u.r*.8,u.g*.8,u.b*.8,1);Pl(c,t,o[b],u,-1,-1,v),Pl(c,t,o[b],u,-1,1,v),Pl(c,t,o[b],u,1,1,v),Pl(c,t,o[b],u,1,-1,v),Pl(c,t,o[b],P,0,0,v)}else Pl(c,t,o[b],u,0,0,v)}function Pl(c,t,o,u,g,v,b){const E=c.context,C=c.transform,P=E.gl,z=C.projection.name==="globe",U=z?["PROJECTION_GLOBE_VIEW"]:[];let N=r.bz(o.projMatrix);if(z&&r.aj(C.zoom)>0){const Be=r.bj(o.canonical,C),He=r.el(Be);N=r.aB(new Float32Array(16),C.globeMatrix,He),r.aB(N,C.projMatrix,N)}const V=r.bC();V[12]+=2*g/(r.o.devicePixelRatio*C.width),V[13]+=2*v/(r.o.devicePixelRatio*C.height),r.aB(N,V,N);const X=c.getOrCreateProgram("debug",{defines:U}),Z=t.getTileByID(o.key);c.terrain&&c.terrain.setupElevationDraw(Z,X);const Y=ii.disabled,ne=xi.disabled,ue=c.colorModeForRenderPass(),ce="$debug";E.activeTexture.set(P.TEXTURE0),c.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),z?Z._makeGlobeTileDebugBuffers(c.context,C):Z._makeDebugTileBoundsBuffers(c.context,C.projection);const ae=Z._tileDebugBuffer||c.debugBuffer,Ee=Z._tileDebugIndexBuffer||c.debugIndexBuffer,xe=Z._tileDebugSegments||c.debugSegments;if(X.draw(c,P.LINE_STRIP,Y,ne,ue,gi.disabled,Ml(N,u.toPremultipliedRenderColor(null)),ce,ae,Ee,xe,null,null,null,[Z._globeTileDebugBorderBuffer]),b){const Be=Z.latestRawTileData,He=Math.floor((Be&&Be.byteLength||0)/1024);let Ve=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Ve+=` => ${o.overscaledZ}`),Ve+=` ${Z.state}`,Ve+=` ${He}kb`,(function(Qe,ct){Qe.initDebugOverlayCanvas();const $e=Qe.debugOverlayCanvas,Oe=Qe.context.gl,nt=Qe.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,$e.width,$e.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(ct,5,5),nt.strokeText(ct,5,5),Qe.debugOverlayTexture.update($e),Qe.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)})(c,Ve)}const Se=t.getTile(o).tileSize,ye=512/Math.min(Se,512)*(o.overscaledZ/C.zoom)*.5,fe=Z._tileDebugTextBuffer||c.debugBuffer,De=Z._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,Pe=Z._tileDebugTextSegments||c.debugSegments;X.draw(c,P.TRIANGLES,Y,ne,wi.alphaBlended,gi.disabled,Ml(N,r.ao.transparent.toPremultipliedRenderColor(null),ye),ce,fe,De,Pe,null,null,null,[Z._globeTileDebugTextBuffer])}function am(c,t,o,u){Vd(c,0,t+o/2,c.transform.width,o,u)}function lm(c,t,o,u){Vd(c,t-o/2,0,o,c.transform.height,u)}function Vd(c,t,o,u,g,v){const b=c.context,E=b.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*r.o.devicePixelRatio,o*r.o.devicePixelRatio,u*r.o.devicePixelRatio,g*r.o.devicePixelRatio),b.clear({color:v}),E.disable(E.SCISSOR_TEST)}const cm=r.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:zg}=cm;function zl(c,t,o,u){c.emplaceBack(t,o,u)}class To{constructor(t){this.vertexArray=new r.em,this.indices=new r.b0,zl(this.vertexArray,-1,-1,1),zl(this.vertexArray,1,-1,1),zl(this.vertexArray,-1,1,1),zl(this.vertexArray,1,1,1),zl(this.vertexArray,-1,-1,-1),zl(this.vertexArray,1,-1,-1),zl(this.vertexArray,-1,1,-1),zl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,zg),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.bg.simpleSegment(0,0,36,12)}}function cc(c,t,o,u,g,v){const b=c.context.gl,E=t.paint.get("sky-atmosphere-color"),C=t.paint.get("sky-atmosphere-halo-color"),P=t.paint.get("sky-atmosphere-sun-intensity"),z=((U,N,V,X,Z)=>({u_matrix_3f:U,u_sun_direction:N,u_sun_intensity:V,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(r.eo(r.dO(),u),g,P,E.toPremultipliedRenderColor(null),C.toPremultipliedRenderColor(null));b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+v,t.skyboxTexture,0),o.draw(c,b.TRIANGLES,ii.disabled,xi.disabled,wi.unblended,gi.frontCW,z,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const uo=r.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class uc{constructor(t){const o=new r.ep;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const u=new r.b0;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,uo.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=r.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const um=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class hm{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Xf{constructor(t){this.colorModeAlphaBlendedWriteRGB=new wi([1,Mc,1,Mc],r.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new wi([1,0,1,0],r.ao.transparent,[!1,!1,!1,!0]),this.params=new hm,this.updateNeeded=!0}update(t){const o=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new uc(o);const u=this.params.sizeRange,g=this.params.intensityRange,v=(function(z){const U=r.eq(30),N=[];for(let V=0;V<z;++V){const X=2*Math.PI*U(),Z=Math.acos(1-2*U())-.5*Math.PI;N.push(r.d5(Math.cos(Z)*Math.cos(X),Math.cos(Z)*Math.sin(X),Math.sin(Z)))}return N})(this.params.starsCount),b=r.eq(300),E=new r.er,C=new r.b0;let P=0;for(let z=0;z<v.length;++z){const U=r.c5([],v[z],200),N=Math.max(0,1+.01*u*(1*b()-.5)),V=Math.max(0,1+.01*g*(1*b()-.5));E.emplaceBack(U[0],U[1],U[2],-1,-1,N,V),E.emplaceBack(U[0],U[1],U[2],1,-1,N,V),E.emplaceBack(U[0],U[1],U[2],1,1,N,V),E.emplaceBack(U[0],U[1],U[2],-1,1,N,V),C.emplaceBack(P+0,P+1,P+2),C.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=o.createVertexBuffer(E,um.members),this.starsIdx=o.createIndexBuffer(C),this.starsSegments=r.bg.simpleSegment(0,0,E.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,o){const u=t.context,g=u.gl,v=t.transform,b=new ii(g.LEQUAL,ii.ReadOnly,[0,1]),E=r.aj(v.zoom),C=t.style.getLut(o.scope),P=o.properties.get("color-use-theme")==="none",z=o.properties.get("color").toNonPremultipliedRenderColor(P?null:C),U=o.properties.get("high-color-use-theme")==="none",N=o.properties.get("high-color").toNonPremultipliedRenderColor(U?null:C),V=o.properties.get("space-color-use-theme")==="none",X=o.properties.get("space-color").toNonPremultipliedRenderColor(V?null:C),Z=5e-4,Y=r.es(o.properties.get("horizon-blend"),0,1,Z,.25),ne=r.dE(t,u,v)&&Y===Z?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,ue=t.frameCounter/1e3%1,ce=r.ag(v.globeCenterInViewSpace),ae=Math.sqrt(Math.pow(ce,2)-Math.pow(ne,2)),Ee=Math.acos(ae/ce),xe=Se=>{const ye=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Se&&ye.push("ALPHA_PASS");const fe=t.getOrCreateProgram("globeAtmosphere",{defines:ye}),De=((Be,He,Ve,Qe,ct,$e,Oe,nt,Ze,lt,St,kt)=>({u_frustum_tl:Be,u_frustum_tr:He,u_frustum_br:Ve,u_frustum_bl:Qe,u_horizon:ct,u_transition:$e,u_fadeout_range:Oe,u_atmosphere_fog_color:nt.toArray01(),u_high_color:Ze.toArray01(),u_space_color:lt.toArray01(),u_temporal_offset:St,u_horizon_angle:kt}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,E,Y,z,N,X,ue,Ee);t.uploadCommonUniforms(u,fe);const Pe=this.atmosphereBuffer;Pe&&fe.draw(t,g.TRIANGLES,b,xi.disabled,Se?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,gi.backCW,De,Se?"atmosphere_glow_alpha":"atmosphere_glow",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments)};xe(!1),xe(!0)}drawStars(t,o){const u=r.aA(o.properties.get("star-intensity"),0,1);if(u===0)return;const g=t.context,v=g.gl,b=t.transform,E=t.getOrCreateProgram("stars"),C=r.c7([]);r.c9(C,C,-b._pitch),r.c8(C,C,-b.angle),r.c9(C,C,r.an(b._center.lat)),r.et(C,C,-r.an(b._center.lng));const P=r.cc(new Float32Array(16),C),z=r.aB([],b.starsProjMatrix,P),U=r.eo([],P),N=r.eu([],U),V=[0,1,0];r.dQ(V,V,N),r.c5(V,V,this.params.sizeMultiplier);const X=[1,0,0];r.dQ(X,X,N),r.c5(X,X,this.params.sizeMultiplier);const Z=(Y=V,ne=X,ue=u,{u_matrix:Float32Array.from(z),u_up:Y,u_right:ne,u_intensity_multiplier:ue});var Y,ne,ue;t.uploadCommonUniforms(g,E),this.starsVx&&this.starsIdx&&E.draw(t,v.TRIANGLES,ii.disabled,xi.disabled,this.colorModeAlphaBlendedWriteRGB,gi.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class qc{constructor(){this.visibleTiles=[]}updateBorders(t,o){const u=[],g=[],v=t._getRenderableCoordinates(!1,!0);for(const C of v){const P=t.getTile(C);if(!P.hasData())continue;const z=P.getBucket(o);z&&(z.isEmpty()||(u.push(C.key),g.push({bucket:z,tileID:C.canonical})))}let b=u.length!==this.visibleTiles.length;if(!b){u.sort();for(let C=0;C<u.length;C++)if(u[C]!==this.visibleTiles[C]){b=!0;break}}if(!b)return;const E=new Set;this.visibleTiles=u,g.sort((C,P)=>C.tileID.z-P.tileID.z||C.tileID.x-P.tileID.x||C.tileID.y-P.tileID.y);for(const C of g){const P=new Array,z=new Array,U=C.bucket;for(const N of U.featuresOnBorder)E.has(N.featureId)?z.push(N.footprintIndex):(E.add(N.featureId),P.push(N.footprintIndex));U.updateFootprintHiddenFlags(P,r.ev,!1),U.updateFootprintHiddenFlags(z,r.ev,!0)}}}function Yf(c,t){const o=[...c],u=t.cameraWorldSizeForFog/t.worldSize,g=r.bA([]);return r.cS(g,g,[u,u,1]),r.aB(o,g,o),r.aB(o,t.worldToFogMatrix,o),o}function na(c,t,o,u,g){const v=o.material,b=u.context,{baseColorTexture:E,metallicRoughnessTexture:C}=v.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:z,emissionTexture:U}=v;function N(X,Z,Y){if(X&&(c.push(Z),b.activeTexture.set(b.gl.TEXTURE0+Y),X.gfxTexture)){const{minFilter:ne,magFilter:ue,wrapS:ce,wrapT:ae}=X.sampler;X.gfxTexture.bindExtraParam(ne,ue,ce,ae)}}N(E,"HAS_TEXTURE_u_baseColorTexture",5),N(C,"HAS_TEXTURE_u_metallicRoughnessTexture",6),N(P,"HAS_TEXTURE_u_normalTexture",7),N(z,"HAS_TEXTURE_u_occlusionTexture",8),N(U,"HAS_TEXTURE_u_emissionTexture",9),g&&(g.texture||(g.texture=new r.d$(u.context,g.image,[g.image.height,g.image.height,g.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+10),g.texture&&g.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),c.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(o.texcoordBuffer)),o.colorBuffer&&(c.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(o.colorBuffer)),o.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(o.normalBuffer)),o.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(o.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||c.push("DIFFUSE_SHADED");const V=u.shadowRenderer;V&&(c.push("RENDER_SHADOWS","DEPTH_TEXTURE"),V.useNormalOffset&&c.push("NORMAL_OFFSET"))}function bn(c,t,o,u,g,v){const b=c.modelOpacity,E=t.context,C=new ii(t.context.gl.LEQUAL,c.isLightMesh?ii.ReadOnly:ii.ReadWrite,t.depthRangeFor3D),P=t.transform,z=c.mesh,U=z.material,N=U.pbrMetallicRoughness,V=t.style.fog;let X;X=t.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:r.aB([],u.zScaleMatrix,c.nodeModelMatrix),r.aB(X,u.negCameraPosMatrix,X);const Z=r.bl([],X);r.eg(Z,Z);const Y=o.paint.get("model-color-use-theme").constantOr("default")==="none",ne=o.paint.get("model-emissive-strength").constantOr(0),ue=el(new Float32Array(c.worldViewProjection),new Float32Array(X),new Float32Array(Z),null,t,b,N.baseColorFactor,U.emissiveFactor,N.metallicFactor,N.roughnessFactor,U,ne,o,void 0,void 0,c.materialOverride,c.modelColor),ce={defines:[]},ae=[],Ee=t.shadowRenderer;Ee&&(Ee.useNormalOffset=!1),na(ce.defines,ae,z,t,Y?null:o.lut);let xe=null;if(V){const fe=Yf(c.nodeModelMatrix,t.transform);if(xe=new Float32Array(fe),P.projection.name!=="globe"){const De=z.aabb.min,Pe=z.aabb.max,[Be,He]=V.getOpacityForBounds(fe,De[0],De[1],Pe[0],Pe[1]);ce.overrideFog=Be>=Zt||He>=Zt}}const Se=pa(t,o.paint.get("model-cutoff-fade-range"));Se.shouldRenderCutoff&&ce.defines.push("RENDER_CUTOFF");const ye=t.getOrCreateProgram("model",ce);t.uploadCommonUniforms(E,ye,null,xe,Se),t.renderPass!=="shadow"&&Ee&&Ee.setupShadowsFromMatrix(c.nodeModelMatrix,ye),ye.draw(t,E.gl.TRIANGLES,C,g,v,z.material.doubleSided?gi.disabled:gi.backCCW,ue,o.id,z.vertexBuffer,z.indexBuffer,z.segments,o.paint,t.transform.zoom,void 0,ae)}function Oh(c,t){return c.style._importedAsBasemap?"basemap":t.scope}function Ru(c,t,o,u,g,v,b,E,C,P){const z=c.transform,U=!!t.isGeometryBloom&&t.isGeometryBloom;if(U&&c.renderPass==="shadow")return;const N=z.projection.name==="globe"?r.eD(o,z):[...o];r.aB(N,N,t.globalMatrix);const V=r.aB([],u,N);if(t.meshes)for(const X of t.meshes){const Z=E.get(X.material.name);if(Z&&Z.opacity<=0)continue;if(X.material.alphaMode!=="BLEND"){b.push({mesh:X,depth:0,modelIndex:g,worldViewProjection:V,nodeModelMatrix:N,isLightMesh:U,materialOverride:Z,modelOpacity:C,modelColor:P});continue}const Y=r.af([],X.centroid,V);!z.isOrthographic&&Y[2]<=0||v.push({mesh:X,depth:Y[2],modelIndex:g,worldViewProjection:V,nodeModelMatrix:N,isLightMesh:U,materialOverride:Z,modelOpacity:C,modelColor:P})}if(t.children)for(const X of t.children)Ru(c,X,o,u,g,v,b,E,C,P)}function Ph(c,t,o,u){const g=o.shadowRenderer;if(!g)return;const v=g.getShadowPassDepthMode(),b=g.getShadowPassColorMode(),E=g.calculateShadowPassMatrixFromMatrix(t),C=Eu(E);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,v,xi.disabled,b,gi.disabled,C,u.id,c.vertexBuffer,c.indexBuffer,c.segments,u.paint,o.transform.zoom,void 0,void 0)}function dm(c,t,o,u,g,v){for(const b of g){const E=Object.assign({},u);E.part=b;const C={type:"Unknown",id:t,properties:E},P={orientation:c.paint.get("model-rotation").evaluate(C,o)};v.set(b,P)}}function fm(c,t,o,u,g,v){for(const b of g){const E=Object.assign({},u);E.part=b;const C={type:"Unknown",id:t,properties:E},P={color:c.paint.get("model-color").evaluate(C,o),colorMix:c.paint.get("model-color-mix-intensity").evaluate(C,o),opacity:c.paint.get("model-opacity").evaluate(C,o),emissionStrength:c.paint.get("model-emissive-strength").evaluate(C,o)};v.set(b,P)}}function Kf(c,t,o,u,g){let v=!1;for(const E of u)E.modelOpacity!==1&&(bn(E,c,t,g[E.modelIndex],xi.disabled,wi.disabled),v=!0);for(const E of u)bn(E,c,t,g[E.modelIndex],E.modelOpacity!==1?c.stencilModeFor3D():xi.disabled,c.colorModeForRenderPass());v&&c.resetStencilClippingMasks();const b=wi.additive;for(const E of o)bn(E,c,t,g[E.modelIndex],xi.disabled,E.isLightMesh?b:c.colorModeForRenderPass())}function Hc(c,t,o){const u=t.updateZoomBasedPaintProperties(),g=(function(v,b,E){let C,P,z,U=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&U>0){const N=v.terrain,V=N.findDEMTileFor(E);V&&V.dem?C=r.eF.create(N,E,V):U=0}if(U===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),U===b.validForExaggeration&&(U===0||C&&C._demTile&&C._demTile.tileID===b.validForDEMTile.id&&C._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const N in b.instancesPerModel){const V=b.instancesPerModel[N];for(let X=0;X<V.instancedDataArray.length;++X){const Z=(C?U*C.getElevationAt(0|V.instancedDataArray.float32[16*X],0|V.instancedDataArray.float32[16*X+1],!0,!0):0)+V.instancesEvaluatedElevation[X];V.instancedDataArray.float32[16*X+6]=Z,P=P?Math.min(b.terrainElevationMin,Z):Z,z=z?Math.max(b.terrainElevationMax,Z):Z}}return b.terrainElevationMin=P||0,b.terrainElevationMax=z||0,b.validForExaggeration=U,b.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0})(c,t,o);(u||g)&&(t.uploaded=!1,t.upload(c.context))}const ho={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.d9([0,0,0],[r.al,r.al,0])};function Dt(c,t){const o=1<<c.canonical.z,u=t.getFreeCameraOptions().position,g=t.elevation,v=c.canonical.x/o,b=(c.canonical.x+1)/o,E=c.canonical.y/o,C=(c.canonical.y+1)/o;let P=t._centerAltitude;if(g){const V=g.getMinMaxForTile(c);V&&V.max>P&&(P=V.max)}const z=r.aA(u.x,v,b)-u.x,U=r.aA(u.y,E,C)-u.y,N=r.cf(P,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(z*z+U*U+N*N))}function Ut(c,t,o,u,g,v,b){const E=c.context,C=c.renderPass==="shadow",P=c.shadowRenderer,z=C&&P?P.getShadowPassDepthMode():new ii(E.gl.LEQUAL,ii.ReadWrite,c.depthRangeFor3D),U=c.isTileAffectedByFog(v),N=c.transform.projection.name==="globe";if(o.meshes)for(const V of o.meshes){const X=N?[]:["MODEL_POSITION_ON_GPU"],Z=[];let Y,ne,ue;const ce=!N&&u.instancedDataArray.length>20;ce&&X.push("INSTANCED_ARRAYS");const ae=pa(c,t.paint.get("model-cutoff-fade-range"));if(ae.shouldRenderCutoff&&X.push("RENDER_CUTOFF"),C&&P)Y=c.getOrCreateProgram("modelDepth",{defines:X}),ne=Eu(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(o.globalMatrix)),ue=P.getShadowPassColorMode();else{na(X,Z,V,c,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),Y=c.getOrCreateProgram("model",{defines:X,overrideFog:U});const xe=V.material,Se=xe.pbrMetallicRoughness,ye=t.paint.get("model-opacity").constantOr(1),fe=t.paint.get("model-emissive-strength").constantOr(0);ne=el(v.expandedProjMatrix,Float32Array.from(o.globalMatrix),new Float32Array(16),null,c,ye,Se.baseColorFactor,xe.emissiveFactor,Se.metallicFactor,Se.roughnessFactor,xe,fe,t,g),P&&(b.shadowUniformsInitialized?Y.setShadowUniformValues(E,P.getShadowUniformValues()):(P.setupShadows(v.toUnwrapped(),Y,"model-tile"),b.shadowUniformsInitialized=!0)),ue=ae.shouldRenderCutoff||ye<1||xe.alphaMode!=="OPAQUE"?wi.alphaBlended:wi.unblended}c.uploadCommonUniforms(E,Y,v.toUnwrapped(),null,ae);const Ee=V.material.doubleSided?gi.disabled:gi.backCCW;if(ce)Z.push(u.instancedDataBuffer),Y.draw(c,E.gl.TRIANGLES,z,xi.disabled,ue,Ee,ne,t.id,V.vertexBuffer,V.indexBuffer,V.segments,t.paint,c.transform.zoom,void 0,Z,u.instancedDataArray.length);else{const xe=C?"u_instance":"u_normal_matrix";for(let Se=0;Se<u.instancedDataArray.length;++Se)ne[xe]=new Float32Array(u.instancedDataArray.arrayBuffer,64*Se,16),Y.draw(c,E.gl.TRIANGLES,z,xi.disabled,ue,Ee,ne,t.id,V.vertexBuffer,V.indexBuffer,V.segments,t.paint,c.transform.zoom,void 0,Z)}}if(o.children)for(const V of o.children)Ut(c,t,V,u,g,v,b)}const Mu=[1,-1,1];function nr(c,t,o,u){if(!o.modelManager)return!0;const g=o.modelManager;if(!o.shadowRenderer)return!0;const v=o.shadowRenderer,b=t.aabb;let E=!0,C=c.maxHeight;if(C===0){let z=0;for(const U in c.instancesPerModel){const N=g.getModel(U,u);N?z=Math.max(z,Math.max(Math.max(N.aabb.max[0],N.aabb.max[1]),N.aabb.max[2])):E=!1}C=c.maxScale*z*1.41+c.maxVerticalOffset,E&&(c.maxHeight=C)}b.max[2]=C,b.min[2]+=c.terrainElevationMin,b.max[2]+=c.terrainElevationMax,r.af(b.min,b.min,t.tileMatrix),r.af(b.max,b.max,t.tileMatrix);const P=b.intersects(v.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=P===2),P===0}function qe(c,t){const o=c.uniformValues.u_cutoff_params[0],u=c.uniformValues.u_cutoff_params[1],g=c.uniformValues.u_cutoff_params[2],v=c.uniformValues.u_cutoff_params[3];return u===o||v===g?1:r.aA(((t-o)/(u-o)-g)/(v-g),0,1)}function pm(c,t,o,u){if(t.pitch<20)return 1;const g=t.getWorldToCameraMatrix();r.aB(g,g,c);const v=r.bU(o.min[0],o.min[1],o.min[2],1);let b=r.aC(r.eG(),v,g),E=b,C=b;v[1]=o.max[1],b=r.aC(r.eG(),v,g),E=b[1]<E[1]?b:E,C=b[1]>C[1]?b:C,v[0]=o.max[0],b=r.aC(r.eG(),v,g),E=b[1]<E[1]?b:E,C=b[1]>C[1]?b:C,v[1]=o.min[1],b=r.aC(r.eG(),v,g),E=b[1]<E[1]?b:E,C=b[1]>C[1]?b:C;const P=r.aA(u[0],0,1),z=100*t.pixelsPerMeter*r.aA(u[1],0,1),U=r.aA(u[2],0,1),N=r.eH(r.eG(),E,C,P),V=Math.tan(.5*t.fovX),X=-N[2]*V;if(z===0)return N[1]<-Math.abs(X)?U:1;const Z=(-Math.abs(X)-N[1])/z,Y=(ue,ce,ae)=>(1-ae)*ue+ae*ce,ne=r.aA(Y(1,U,Z),U,1);return Y(1,ne,r.aA((t.pitch-20)/20,0,1))}class Jf{}class Gd{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,o,u){{const U=this._storage.get(o.id);if(U)return U.lastUsedFrameIdx=t,U.buf}const g=u.gl,v=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),b=new ArrayBuffer(v),E=new Int16Array(b);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const C=new r.eJ;for(let U=0;U<v/2;U+=3){const N=E[U],V=E[U+1],X=E[U+2];C.emplaceBack(N,V),C.emplaceBack(V,X),C.emplaceBack(X,N)}const P=u.bindVertexArrayOES.current,z=new Jf;return z.buf=new co(u,C),z.lastUsedFrameIdx=t,this._storage.set(o.id,z),u.bindVertexArrayOES.set(P),z.buf}update(t){for(const[o,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(o))}destroy(){for(const[t,o]of this._storage)o.buf.destroy(),this._storage.delete(t)}}class Qf{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const mm=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class qd{constructor(t){this.revealStart=11,this.revealRange=2}}const Du=r.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Lg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,o){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const b=new r.eK,E=new r.b0;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(1,1),b.emplaceBack(-1,1),E.emplaceBack(0,1,2),E.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(b,Du.members),this.vignetteIdx=t.context.createIndexBuffer(E)}const g=r.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const b={u_vignetteShape:(v={vignetteShape:[o.start,o.range,Math.pow(10,o.fadePower)],vignetteColor:[o.color.r,o.color.g,o.color.b,o.color.a*o.strength]}).vignetteShape,u_vignetteColor:v.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,ii.disabled,xi.disabled,wi.alphaBlended,gi.disabled,b,"vignette",this.vignetteVx,this.vignetteIdx,g)}var v}}class Y_{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,o){const u=t.getFreeCameraOptions().position,g=u.toAltitude(),v=u.toLngLat(),b=r.an(v.lng),E=r.an(v.lat),C=t.pixelsPerMeter/o,P=b*r.eM,z=r.eM*Math.log(Math.tan(Math.PI/4+E/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+z,N=-this._elevationPrev+g;this._accumulatedOffsetX+=(-this._offsetXPrev+P)*C,this._accumulatedOffsetY+=U*C,this._accumulatedElevation+=N*C,this._offsetXPrev=P,this._offsetYPrev=z,this._elevationPrev=g}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function gm(c,t){return[-(c[0]-Math.floor(c[0]/t)*t),-(c[1]-Math.floor(c[1]/t)*t),-(c[2]-Math.floor(c[2]/t)*t)]}function zh(c){const t=r.eq(1323123451230),o=[];for(let u=0;u<c;++u){const g=2*t()-1,v=2*t()-1,b=2*t()-1;o.push(r.d5(g,v,b))}return o}function ra(c,t,o,u,g){const v=r.aA((g-o)/(u-o),0,1);return(1-v)*c+v*t}class Hd{constructor(t){this._movement=new Y_,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Lg,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,o){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const g=u.starsProjMatrix,v=r.c7([]);r.c9(v,v,r.an(90)-u._pitch),r.c8(v,v,-u.angle);const b=r.cc(new Float32Array(16),v),E=r.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=r.eg([],E),P=r.aB([],C,b),z=Date.now()/1e3;return this._accumulatedTimeFromStart+=(z-this._prevTime)*o,this._prevTime=z,{projectionMatrix:g,modelviewMatrix:P}}}class $d extends Hd{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new qd("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const u=zh(this.particlesCount),g=new r.eN,v=new r.b0;let b=0;const E=r.eq(1323123451230);for(let C=0;C<u.length;++C){const P=u[C],z=[2*E()-1,E(),E(),E()];g.emplaceBack(P[0],P[1],P[2],-1,-1,...z),g.emplaceBack(P[0],P[1],P[2],1,-1,...z),g.emplaceBack(P[0],P[1],P[2],1,1,...z),g.emplaceBack(P[0],P[1],P[2],-1,1,...z),v.emplaceBack(b+0,b+1,b+2),v.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=o.createVertexBuffer(g,mm.members),this.particlesIdx=o.createIndexBuffer(v)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const o=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(o.revealStart>u)return;const g=ra(0,1,o.revealStart,o.revealStart+o.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const v=structuredClone(this._params);let b=[-v.direction.x,v.direction.y,-100];r.aw(b,b);const E=structuredClone(this._vignetteParams);E.strength*=g,v.overrideStyleParameters||(v.intensity=t.style.rain.state.density,v.timeFactor=t.style.rain.state.intensity,v.color=structuredClone(t.style.rain.state.color),b=structuredClone(t.style.rain.state.direction),v.screenThinning.intensity=t.style.rain.state.centerThinning,v.dropletSizeX=t.style.rain.state.dropletSize[0],v.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],v.distortionStrength=100*t.style.rain.state.distortionStrength,E.strength=1,E.color=structuredClone(t.style.rain.state.vignetteColor));const C=this.updateOnRender(t,v.timeFactor),P=t.context,z=P.gl,U=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(P,{width:t.width,height:t.height,data:null},z.RGBA8)),v.distortionStrength>0&&(P.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),z.copyTexSubImage2D(z.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const N=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(P,N),P.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const V=[v.color.r,v.color.g,v.color.b,v.color.a],X=(Z,Y)=>{const ne=gm(this._movement.getPosition(),Z),ue=v.dropletSizeX,ce=v.dropletSizeX*v.dropletSizeYScale,ae=t.width/2,Ee=t.height/2,xe=ra(0,v.screenThinning.start,0,1,v.screenThinning.intensity),Se=ra(.001,v.screenThinning.range,0,1,v.screenThinning.intensity),ye=ra(0,v.screenThinning.particleOffset,0,1,v.screenThinning.intensity),fe=(De={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ne,velocityConeAperture:v.velocityConeAperture,velocity:v.velocity,boxSize:Z,rainDropletSize:[ue,ce],distortionStrength:v.distortionStrength,rainDirection:b,color:V,screenSize:[U.width,U.height],thinningCenterPos:[ae,Ee],thinningShape:[xe,Se,Math.pow(10,v.screenThinning.fadePower)],thinningAffectedRatio:v.screenThinning.affectedRatio,thinningParticleOffset:ye,shapeDirectionalPower:v.shapeDirPower,shapeNormalPower:v.shapeNormalPower,mode:Y?0:1},{u_modelview:Float32Array.from(De.modelview),u_projection:Float32Array.from(De.projection),u_time:De.time,u_cam_pos:De.camPos,u_texScreen:0,u_velocityConeAperture:De.velocityConeAperture,u_velocity:De.velocity,u_boxSize:De.boxSize,u_rainDropletSize:De.rainDropletSize,u_distortionStrength:De.distortionStrength,u_rainDirection:De.rainDirection,u_color:De.color,u_screenSize:De.screenSize,u_thinningCenterPos:De.thinningCenterPos,u_thinningShape:De.thinningShape,u_thinningAffectedRatio:De.thinningAffectedRatio,u_thinningParticleOffset:De.thinningParticleOffset,u_shapeDirectionalPower:De.shapeDirectionalPower,u_shapeNormalPower:De.shapeNormalPower,u_mode:De.mode});var De;const Pe=Math.round(v.intensity*this.particlesCount),Be=r.bg.simpleSegment(0,0,4*Pe,2*Pe);N.draw(t,z.TRIANGLES,ii.disabled,xi.disabled,wi.alphaBlended,gi.disabled,fe,"rain_particles",this.particlesVx,this.particlesIdx,Be)};v.distortionStrength>0&&X(v.boxSize,!0),X(v.boxSize,!1),this._vignette.draw(t,E)}}const Zd=r.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Lh extends Hd{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new qd("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const u=zh(this.particlesCount),g=new r.eO,v=new r.b0;let b=0;const E=r.eq(1323123451230);for(let C=0;C<u.length;++C){const P=u[C],z=E(),U=E(),N=E(),V=[C/u.length,z,U,N],X=[E(),E()];g.emplaceBack(P[0],P[1],P[2],-1,-1,...V,...X),g.emplaceBack(P[0],P[1],P[2],1,-1,...V,...X),g.emplaceBack(P[0],P[1],P[2],1,1,...V,...X),g.emplaceBack(P[0],P[1],P[2],-1,1,...V,...X),v.emplaceBack(b+0,b+1,b+2),v.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=o.createVertexBuffer(g,Zd.members),this.particlesIdx=o.createIndexBuffer(v)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const o=structuredClone(this._params);let u=[-o.direction.x,o.direction.y,-100];r.aw(u,u);const g=structuredClone(this._vignetteParams),v=o.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=t.transform.zoom;if(v.revealStart>b)return;const E=ra(0,1,v.revealStart,v.revealStart+v.revealRange,b);g.strength*=E,o.overrideStyleParameters||(o.intensity=t.style.snow.state.density,o.timeFactor=t.style.snow.state.intensity,o.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),o.screenThinning.intensity=t.style.snow.state.centerThinning,o.billboardSize=2.79*t.style.snow.state.flakeSize,g.strength=1,g.color=structuredClone(t.style.snow.state.vignetteColor));const C=this.updateOnRender(t,o.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const P=t.context,z=P.gl,U=t.transform,N=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(P,N),((V,X,Z)=>{const Y=gm(this._movement.getPosition(),V),ne=U.width/2,ue=U.height/2,ce=ra(0,Z.screenThinning.start,0,1,Z.screenThinning.intensity),ae=ra(.001,Z.screenThinning.range,0,1,Z.screenThinning.intensity),Ee=ra(0,Z.screenThinning.particleOffset,0,1,Z.screenThinning.intensity),xe=(Se={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Y,velocityConeAperture:Z.velocityConeAperture,velocity:Z.velocity,horizontalOscillationRadius:Z.horizontalOscillationRadius,horizontalOscillationRate:Z.horizontalOscillationRate,boxSize:V,billboardSize:1*Z.billboardSize,simpleShapeParameters:[Z.shapeFadeStart,Z.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[ne,ue],thinningShape:[ce,ae,Math.pow(10,Z.screenThinning.fadePower)],thinningAffectedRatio:Z.screenThinning.affectedRatio,thinningParticleOffset:Ee,color:[Z.color.r,Z.color.g,Z.color.b,Z.color.a],direction:u},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_horizontalOscillationRadius:Se.horizontalOscillationRadius,u_horizontalOscillationRate:Se.horizontalOscillationRate,u_boxSize:Se.boxSize,u_billboardSize:Se.billboardSize,u_simpleShapeParameters:Se.simpleShapeParameters,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_particleColor:Se.color,u_direction:Se.direction});var Se;const ye=Math.round(Z.intensity*this.particlesCount),fe=r.bg.simpleSegment(0,0,4*ye,2*ye);this.particlesVx&&this.particlesIdx&&N.draw(t,z.TRIANGLES,ii.disabled,xi.disabled,wi.alphaBlended,gi.disabled,xe,"snow_particles",this.particlesVx,this.particlesIdx,fe)})(o.boxSize,0,o),this._vignette.draw(t,g)}}const nl={symbol:function(c,t,o,u,g){if(c.renderPass!=="translucent")return;const v=xi.disabled,b=c.colorModeForRenderPass(),E=o.layout.get("text-variable-anchor"),C=o.layout.get("text-size-scale-range"),P=r.aA(c.scaleFactor,C[0],C[1]);E&&(function(N,V,X,Z,Y,ne,ue,ce){const ae=V.transform,Ee=Y==="map",xe=ne==="map";for(const Se of N){const ye=Z.getTile(Se),fe=ye.getBucket(X);if(!fe||!fe.text||!fe.text.segments.get().length)continue;const De=r.bK(fe.textSizeData,ae.zoom,ce),Pe=xl(Se,fe.getProjection(),ae),Be=ae.calculatePixelsToTileUnitsMatrix(ye),He=au(Pe,ye.tileID.canonical,xe,Ee,ae,fe.getProjection(),Be),Ve=fe.hasIconTextFit()&&fe.hasIconData();De&&Nc(fe,Ee,xe,ue,ae,He,Se,Math.pow(2,ae.zoom-ye.tileID.overscaledZ),De,Ve)}})(u,c,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),g,P);const z=o.paint.get("icon-opacity").constantOr(1)!==0,U=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(z||U)?Cu(c,t,o,u,v,b):(z&&Cu(c,t,o,u,v,b,{onlyIcons:!0}),U&&Cu(c,t,o,u,v,b,{onlyText:!0})),t.map.showCollisionBoxes&&(Tr(c,t,o,u,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Tr(c,t,o,u,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,o,u){if(c.renderPass!=="translucent")return;const g=o.paint.get("circle-opacity"),v=o.paint.get("circle-stroke-width"),b=o.paint.get("circle-stroke-opacity"),E=o.layout.get("circle-sort-key").constantOr(1)!==void 0,C=o.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(v.constantOr(1)===0||b.constantOr(1)===0))return;const P=c.context,z=P.gl,U=c.transform,N=!(!c.terrain||!c.terrain.enabled),V=o.layout.get("circle-elevation-reference"),X=c.depthModeForSublayer(0,ii.ReadOnly),Z=new ii(c.context.gl.LEQUAL,ii.ReadOnly,c.depthRangeFor3D),Y=V==="none"||N?X:Z,ne=xi.disabled,ue=c.colorModeForDrapableLayerRenderPass(C),ce=U.projection.name==="globe",ae=[r.aF(U.center.lng),r.aJ(U.center.lat)],Ee=[];for(let Se=0;Se<u.length;Se++){const ye=u[Se],fe=t.getTile(ye),De=fe.getBucket(o);if(!De||De.projection.name!==U.projection.name)continue;const Pe=De.programConfigurations.get(o.id),Be=De.layoutVertexBuffer,He=De.globeExtVertexBuffer,Ve=De.indexBuffer,Qe=r.e0(o),ct=[He],$e=c.isTileAffectedByFog(ye);ce&&Qe.push("PROJECTION_GLOBE_VIEW"),Qe.push("DEPTH_D24"),c.terrain&&U.depthOcclusionForSymbolsAndCircles&&Qe.push("DEPTH_OCCLUSION"),De.hasElevation&&!c.terrain&&(Qe.push("ELEVATED_ROADS"),ct.push(De.elevatedLayoutVertexBuffer));const Oe=c.getOrCreateProgram("circle",{config:Pe,defines:Qe,overrideFog:$e}),nt=U.projection.createInversionMatrix(U,ye.canonical),Ze={programConfiguration:Pe,program:Oe,layoutVertexBuffer:Be,dynamicBuffers:ct,indexBuffer:Ve,uniformValues:r.e1(c,ye,fe,nt,ae,o),tile:fe};if(E){const lt=De.segments.get();for(const St of lt)Ee.push({segments:new r.bg([St]),sortKey:St.sortKey,state:Ze})}else Ee.push({segments:De.segments,sortKey:0,state:Ze})}E&&Ee.sort((Se,ye)=>Se.sortKey-ye.sortKey);const xe={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const Se of Ee){const{programConfiguration:ye,program:fe,layoutVertexBuffer:De,dynamicBuffers:Pe,indexBuffer:Be,uniformValues:He,tile:Ve}=Se.state,Qe=Se.segments;c.terrain&&c.terrain.setupElevationDraw(Ve,fe,xe),c.uploadCommonUniforms(P,fe,Ve.tileID.toUnwrapped()),fe.draw(c,z.TRIANGLES,Y,ne,ue,gi.disabled,He,o.id,De,Be,Qe,o.paint,U.zoom,ye,Pe)}},heatmap:function(c,t,o,u){if(o.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const g=c.context,v=g.gl,b=xi.disabled,E=new wi([v.ONE,v.ONE,v.ONE,v.ONE],r.ao.transparent,[!0,!0,!0,!0]);(function(V,X,Z,Y){const ne=V.gl,ue=X.width*Y,ce=X.height*Y;V.activeTexture.set(ne.TEXTURE1),V.viewport.set([0,0,ue,ce]);let ae=Z.heatmapFbo;if(!ae||ae&&(ae.width!==ue||ae.height!==ce)){ae&&ae.destroy();const Ee=ne.createTexture();ne.bindTexture(ne.TEXTURE_2D,Ee),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MAG_FILTER,ne.LINEAR),ae=Z.heatmapFbo=V.createFramebuffer(ue,ce,1,null),(function(xe,Se,ye,fe,De,Pe){const Be=xe.gl;Be.texImage2D(Be.TEXTURE_2D,0,xe.extRenderToTextureHalfFloat?Be.RGBA16F:Be.RGBA,De,Pe,0,Be.RGBA,xe.extRenderToTextureHalfFloat?Be.HALF_FLOAT:Be.UNSIGNED_BYTE,null),fe.colorAttachment0.set(ye)})(V,0,Ee,ae,ue,ce)}else ne.bindTexture(ne.TEXTURE_2D,ae.colorAttachment0.get()),V.bindFramebuffer.set(ae.framebuffer)})(g,c,o,c.transform.projection.name==="globe"?.5:.25),g.clear({color:r.ao.transparent});const C=c.transform,P=C.projection.name==="globe",z=P?["PROJECTION_GLOBE_VIEW"]:[],U=P?gi.frontCCW:gi.disabled,N=[r.aF(C.center.lng),r.aJ(C.center.lat)];for(let V=0;V<u.length;V++){const X=u[V];if(t.hasRenderableParent(X))continue;const Z=t.getTile(X),Y=Z.getBucket(o);if(!Y||Y.projection.name!==C.projection.name)continue;const ne=c.isTileAffectedByFog(X),ue=Y.programConfigurations.get(o.id),ce=c.getOrCreateProgram("heatmap",{config:ue,defines:z,overrideFog:ne}),{zoom:ae}=c.transform;c.terrain&&c.terrain.setupElevationDraw(Z,ce),c.uploadCommonUniforms(g,ce,X.toUnwrapped());const Ee=C.projection.createInversionMatrix(C,X.canonical);ce.draw(c,v.TRIANGLES,ii.disabled,b,E,U,xu(c,X,Z,Ee,N,ae,o.paint.get("heatmap-intensity")),o.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,o.paint,c.transform.zoom,ue,P?[Y.globeExtVertexBuffer]:null)}g.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),(function(g,v){const b=g.context,E=b.gl,C=v.heatmapFbo;if(!C)return;b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment0.get()),b.activeTexture.set(E.TEXTURE1);let P=v.colorRampTexture;P||(P=v.colorRampTexture=new r.T(b,v.colorRamp,E.RGBA8)),P.bind(E.LINEAR,E.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,E.TRIANGLES,ii.disabled,xi.disabled,g.colorModeForRenderPass(),gi.disabled,((z,U)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,v),v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)})(c,o))},line:function(c,t,o,u){if(c.renderPass!=="translucent")return;const g=o.paint.get("line-opacity"),v=o.paint.get("line-width");if(g.constantOr(1)===0||v.constantOr(1)===0)return;const b=o.paint.get("line-emissive-strength").isConstant(),E=o.paint.get("line-emissive-strength").constantOr(0),C=o.paint.get("line-occlusion-opacity"),P=o.layout.get("line-elevation-reference"),z=o.layout.get("line-width-unit")==="meters",U=P==="sea",N=!(!c.terrain||!c.terrain.enabled),V=c.context,X=V.gl;if(o.hasElevatedBuckets&&c.transform.projection.name==="globe")return;const Z=o.layout.get("line-cross-slope"),Y=Z!==void 0,ne=Z<1,ue=c.colorModeForDrapableLayerRenderPass(b?E:null),ce=c.terrain&&c.terrain.renderingToTexture,ae=ce?1:r.o.devicePixelRatio,Ee=o.paint.get("line-dasharray"),xe=Ee.constantOr(1),Se=o.layout.get("line-cap"),ye=Ee.constantOr(null),fe=Se.constantOr(null),De=o.paint.get("line-pattern"),Pe=De.constantOr(1),Be=o.paint.get("line-pattern-cross-fade"),He=De.constantOr(null),Ve=o.paint.get("line-opacity").constantOr(1);let Qe=!Pe&&Ve!==1||c.depthOcclusion&&C>0&&C<1;const ct=o.paint.get("line-gradient"),$e=Pe?"linePattern":"line",Oe=r.e2(o);let nt;if(ce&&c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(Qe=!1),C!==0&&c.depthOcclusion){const kt=o.paint._values["line-opacity"];kt&&kt.value&&kt.value.kind==="constant"?nt=kt.value:r.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}v.value.kind!=="constant"&&v.value.isLineProgressConstant===!1&&Oe.push("VARIABLE_LINE_WIDTH"),ce&&(c.emissiveMode!=="dual-source-blending"||b?c.emissiveMode==="mrt-fallback"&&Oe.push("USE_MRT1"):Oe.push("DUAL_SOURCE_BLENDING"));const Ze=(kt,Ct,Et,ei,Yt,Nt)=>{for(const Kt of kt){const ai=t.getTile(Kt);if(Pe&&!ai.patternsLoaded())continue;const _i=ai.getBucket(o);if(!_i||_i.elevationType!=="none"&&!Yt||_i.elevationType==="none"&&Yt)continue;c.prepareDrawTile();const Pi=[...Ct],Zi=c.shadowRenderer,yi=_i.elevationType==="road"&&!!Zi&&Zi.enabled;let zi=[0,0,0];if(yi){const ki=c.style.directionalLight,Bn=c.style.ambientLight;ki&&Bn&&(zi=xo(c.style,ki,Bn)),Pi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Ti=_i.programConfigurations.get(o.id);let dn=!1;if(He&&ai.imageAtlas){const ki=r.e3.from(He),Bn=ki.getPrimary().scaleSelf(ae).toString(),dr=ai.imageAtlas.patternPositions.get(Bn),Rn=ki.getSecondary(),Fn=Rn?ai.imageAtlas.patternPositions.get(Rn.scaleSelf(ae).toString()):null;dn=!!dr&&!!Fn,dr&&Ti.setConstantPatternPositions(dr,Fn)}Be>0&&(dn||Ti.getPatternTransitionVertexBuffer("line-pattern"))&&Pi.push("LINE_PATTERN_TRANSITION");const an=c.isTileAffectedByFog(Kt),wn=c.getOrCreateProgram($e,{config:Ti,defines:Pi,overrideFog:an});if(!Pe&&ye&&fe&&ai.lineAtlas){const ki=ai.lineAtlas.getDash(ye,fe);ki&&Ti.setConstantPatternPositions(ki)}yi&&Zi.setupShadows(ai.tileID.toUnwrapped(),wn,"vector-tile");let[tn,Li]=o.paint.get("line-trim-offset");(fe==="round"||fe==="square")&&tn!==Li&&(tn===0&&(tn-=1),Li===1&&(Li+=1));const un=ce?Kt.projMatrix:null,Xn=z?1/_i.tileToMeter/r.ay(ai,1,c.transform.zoom):1,Tn=z?1/_i.tileToMeter/r.ay(ai,1,Math.floor(c.transform.zoom)):1,pn=Pe?r.e4(c,ai,o,un,ae,Xn,Tn,[tn,Li],zi,Be):r.e5(c,ai,o,un,_i.lineClipsArray.length,ae,Xn,Tn,[tn,Li],zi);if(ct){const ki=_i.gradients[o.id];let Bn=ki.texture;if(o.gradientVersion!==ki.version){let dr=256;if(o.stepInterpolant){const Rn=t.getSource().maxzoom,Fn=Kt.canonical.z===Rn?Math.ceil(1<<c.transform.maxZoom-Kt.canonical.z):1;dr=r.aA(r.e6(_i.maxLineLength/r.al*1024*Fn),256,V.maxTextureSize)}ki.gradient=r.e7({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:dr,image:ki.gradient||void 0,clips:_i.lineClipsArray}),ki.texture?ki.texture.update(ki.gradient):ki.texture=new r.T(V,ki.gradient,X.RGBA8),ki.version=o.gradientVersion,Bn=ki.texture}V.activeTexture.set(X.TEXTURE1),Bn.bind(o.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}xe&&(V.activeTexture.set(X.TEXTURE0),ai.lineAtlasTexture&&ai.lineAtlasTexture.bind(X.LINEAR,X.REPEAT),Ti.updatePaintBuffers()),Pe&&(V.activeTexture.set(X.TEXTURE0),ai.imageAtlasTexture&&ai.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Ti.updatePaintBuffers()),Yt&&!U&&c.terrain.setupElevationDraw(ai,wn),c.uploadCommonUniforms(V,wn,Kt.toUnwrapped());const Di=ki=>{nt!=null&&(nt.value=Ve*C),wn.draw(c,X.TRIANGLES,Et,ki,ue,gi.disabled,pn,o.id,_i.layoutVertexBuffer,_i.indexBuffer,_i.segments,o.paint,c.transform.zoom,Ti,[_i.layoutVertexBuffer2,_i.patternVertexBuffer,_i.zOffsetVertexBuffer]),nt!=null&&(nt.value=Ve)};if(Qe&&!Yt){const ki=c.stencilModeForClipping(Kt).ref;ki===0&&ce&&V.clear({stencil:0});const Bn={func:X.EQUAL,mask:255};pn.u_alpha_discard_threshold=.8,Di(new xi(Bn,ki,255,X.KEEP,X.KEEP,X.INVERT)),pn.u_alpha_discard_threshold=0,Di(new xi(Bn,ki,255,X.KEEP,X.KEEP,X.KEEP))}else pn.u_alpha_discard_threshold=Qe&&Yt&&Nt?.8:0,Di(Yt?ei:c.stencilModeForClipping(Kt))}};let lt=c.depthModeForSublayer(0,ii.ReadOnly);const St=new ii(c.depthOcclusion?X.GREATER:X.LEQUAL,ii.ReadOnly,c.depthRangeFor3D);if(o.hasNonElevatedBuckets){const kt=!ce&&c.terrain;C!==0&&kt?r.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`):kt?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${o.id}.`):Ze(u,Oe,lt,xi.disabled,!1,!0)}if(o.hasElevatedBuckets){P==="hd-road-markup"?N||(lt=St,Oe.push("ELEVATED_ROADS")):(Oe.push("ELEVATED"),lt=St,Y&&Oe.push(ne?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),U&&Oe.push("ELEVATION_REFERENCE_SEA"));const kt=Qe?c.stencilModeFor3D():xi.disabled;c.forceTerrainMode=!0,Ze(u,Oe,lt,kt,!0,!0),Qe&&Ze(u,Oe,lt,kt,!0,!1),c.forceTerrainMode=!1}Qe&&(c.resetStencilClippingMasks(),ce&&V.clear({stencil:0})),C===0||c.depthOcclusion||ce||c.layersWithOcclusionOpacity.push(c.currentLayer)},fill:function(c,t,o,u){const g=o.paint.get("fill-color"),v=o.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const b=o.paint.get("fill-emissive-strength"),E=c.colorModeForDrapableLayerRenderPass(b),C=o.paint.get("fill-pattern"),P=c.opaquePassEnabledForLayer()&&!C.constantOr(1)&&g.constantOr(r.ao.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";let z="none";o.layout.get("fill-elevation-reference")!=="none"?z="road":o.paint.get("fill-z-offset").constantOr(1)!==0&&(z="offset");const U=!(!c.terrain||!c.terrain.enabled),N={painter:c,sourceCache:t,layer:o,coords:u,colorMode:E,elevationType:z,terrainEnabled:U,pass:P};if(c.renderPass==="shadow")return void(c.shadowRenderer&&z==="road"&&!U&&(function(X){const{painter:Z,sourceCache:Y,layer:ne,coords:ue}=X,ce=Z.context.gl,ae=X.painter.shadowRenderer;for(const Ee of ue){const xe=Y.getTile(Ee),Se=xe.getBucket(ne);if(!Se)continue;const ye=Se.elevatedStructures;if(!ye||!ye.shadowCasterSegments||ye.shadowCasterSegments.segments[0].primitiveLength===0)continue;Z.prepareDrawTile();const fe=Se.bufferData.programConfigurations.get(ne.id),De=Z.isTileAffectedByFog(Ee),Pe=Z.getOrCreateProgram("elevatedStructuresDepth",{config:fe,overrideFog:De}),Be=ae.calculateShadowPassMatrixFromTile(xe.tileID.toUnwrapped());Z.uploadCommonUniforms(Z.context,Pe,Ee.toUnwrapped());const He=vu(Be,0);Pe.draw(Z,ce.TRIANGLES,ae.getShadowPassDepthMode(),xi.disabled,ae.getShadowPassColorMode(),gi.disabled,He,ne.id,ye.vertexBuffer,ye.indexBuffer,ye.shadowCasterSegments,ne.paint,Z.transform.zoom,fe)}})(N));const V=c.emissiveMode==="mrt-fallback";if(z!=="offset"){if(zr(N,!1,V),z==="road"){const X=!U&&c.renderPass==="translucent";X&&rm(c,t,o,u,"geometry"),zr(N,!0,V,xi.disabled),X&&(function(Z){const{painter:Y,sourceCache:ne,layer:ue,coords:ce,colorMode:ae}=Z,Ee=Y.context.gl,xe=Z.painter.shadowRenderer,Se=!!xe&&xe.enabled,ye=new ii(Y.context.gl.LEQUAL,ii.ReadOnly,Y.depthRangeFor3D);let fe=[0,0,0];if(Se){const Pe=Y.style.directionalLight,Be=Y.style.ambientLight;Pe&&Be&&(fe=xo(Y.style,Pe,Be))}const De=Pe=>{for(const Be of ce){const He=ne.getTile(Be),Ve=He.getBucket(ue);if(!Ve)continue;const Qe=Ve.elevatedStructures;if(!Qe)continue;let ct,$e;if(Pe?(ct=Qe.renderableBridgeSegments,$e=Qe.bridgeProgramConfigurations.get(ue.id)):(ct=Qe.renderableTunnelSegments,$e=Qe.tunnelProgramConfigurations.get(ue.id)),!ct||ct.segments[0].primitiveLength===0)continue;$e.updatePaintBuffers(),Y.prepareDrawTile();const Oe=Y.isTileAffectedByFog(Be),nt=[];Se&&nt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ze=Y.getOrCreateProgram("elevatedStructures",{config:$e,overrideFog:Oe,defines:nt}),lt=Y.translatePosMatrix(Be.projMatrix,He,ue.paint.get("fill-translate"),ue.paint.get("fill-translate-anchor"));Se&&xe.setupShadows(He.tileID.toUnwrapped(),Ze,"vector-tile");const St=Qa(lt,fe);Y.uploadCommonUniforms(Y.context,Ze,Be.toUnwrapped()),Ze.draw(Y,Ee.TRIANGLES,ye,xi.disabled,ae,gi.backCCW,St,ue.id,Qe.vertexBuffer,Qe.indexBuffer,ct,ue.paint,Y.transform.zoom,$e,[Qe.vertexBufferNormal])}};De(!0),De(!1)})(N)}}else zr(N,!1,V,c.stencilModeFor3D())},"fill-extrusion":function(c,t,o,u){const g=o.paint.get("fill-extrusion-opacity"),v=c.context,b=v.gl,E=c.terrain,C=E&&E.renderingToTexture;if(g===0)return;const P=c.emissiveMode==="mrt-fallback",z=c.conflationActive&&c.style.isLayerClipped(o,t.getSource()),U=c.style.order.indexOf(o.fqid);if(z&&(function(N,V,X,Z,Y){for(const ne of Z){const ue=V.getTile(ne).getBucket(X);ue&&(ue.updateReplacement(ne,N.replacementSource,Y),ue.uploadCentroid(N.context))}})(c,t,o,u,U),E||z)for(const N of u){const V=t.getTile(N).getBucket(o);V&&sm(c.context,t,N,V,o,E,z)}if(c.renderPass==="shadow"&&c.shadowRenderer){const N=c.shadowRenderer;if(E&&g<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ad)return;const V=N.getShadowPassDepthMode(),X=N.getShadowPassColorMode();Vc(c,t,o,u,V,xi.disabled,X,z)}else if(c.renderPass==="translucent"){const N=!o.paint.get("fill-extrusion-pattern").constantOr(1),V=o.paint.get("fill-extrusion-color").constantOr(r.ao.white);if(!C&&V.a!==0){const X=new ii(c.context.gl.LEQUAL,ii.ReadWrite,c.depthRangeFor3D);g===1&&N?Vc(c,t,o,u,X,xi.disabled,wi.unblended,z):(Vc(c,t,o,u,X,xi.disabled,wi.disabled,z),Vc(c,t,o,u,X,c.stencilModeFor3D(),c.colorModeForRenderPass(),z),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&N&&(!E&&c.transform.projection.name!=="globe"||C)){const X=o.paint.get("fill-extrusion-opacity"),Z=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ne=o.paint.get("fill-extrusion-flood-light-intensity"),ue=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ce=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ue?null:o.lut).toArray01().slice(0,3),ae=Z>0&&Y>0,Ee=ne>0,xe=(fe,De,Pe)=>(1-Pe)*fe+Pe*De,Se=new Iu;Se.translate=o.paint.get("fill-extrusion-translate"),Se.translateAnchor=o.paint.get("fill-extrusion-translate-anchor"),Se.edgeRadius=o.layout.get("fill-extrusion-edge-radius"),Se.cutoffFadeRange=o.paint.get("fill-extrusion-cutoff-fade-range");const ye=fe=>{const De=c.depthModeForSublayer(1,ii.ReadOnly,b.LEQUAL,!0),Pe=o.paint.get(fe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Be=xe(.1,3,Pe),He=c._showOverdrawInspector;if(!He){const Ve=new xi({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Qe=new wi([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!1,!1,!1,!0],b.MIN);tl(Se,c,t,o,u,De,Ve,Qe,gi.disabled,fe,"sdf",X,Z,Y,ne,ce,Be,z,!1)}{const Ve=He?xi.disabled:new xi({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Qe=He?c.colorModeForRenderPass():new wi([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],r.ao.transparent,[!0,!0,!0,!0]);tl(Se,c,t,o,u,De,Ve,Qe,gi.disabled,fe,"color",X,Z,Y,ne,ce,Be,z,!1)}};if(C){const fe=()=>{const Pe=E.drapeBufferSize[0],Be=E.drapeBufferSize[1];let He=E.framebufferCopyTexture;return He&&(!He||He.size[0]===Pe&&He.size[1]===Be)||(He&&He.destroy(),He=E.framebufferCopyTexture=new r.T(v,new r.q({width:Pe,height:Be}),b.RGBA8)),He.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,Pe,Be),He},De=(Pe,Be,He)=>{const Ve=c.depthModeForSublayer(1,ii.ReadOnly,b.LEQUAL,!1),Qe=o.paint.get(Pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ct=xe(.1,3,Qe);{const $e=new wi([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!1,!1,!1,!0]);tl(Se,c,t,o,u,Ve,xi.disabled,$e,gi.disabled,Pe,"clear",X,Z,Y,ne,ce,ct,z,Be)}{const $e=new xi({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Oe=new wi([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!1,!1,!1,!0],b.MIN);tl(Se,c,t,o,u,Ve,$e,Oe,gi.disabled,Pe,"sdf",X,Z,Y,ne,ce,ct,z,Be)}P&&!Pe&&(He=fe());{const $e=Pe?b.ZERO:b.ONE_MINUS_DST_ALPHA,Oe=new xi({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),nt=new wi([$e,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],r.ao.transparent,[!0,!0,!0,!0]);tl(Se,c,t,o,u,Ve,Oe,nt,gi.disabled,Pe,"color",X,Z,Y,ne,ce,ct,z,Be)}if(!P||Pe){const $e=new wi([b.ONE,b.ONE,b.ONE,Pe?b.ZERO:b.ONE],r.ao.transparent,[!1,!1,!1,!0],Pe?b.FUNC_ADD:b.MAX);tl(Se,c,t,o,u,Ve,xi.disabled,$e,gi.disabled,Pe,"clear",X,Z,Y,ne,ce,ct,z,Be,He)}else{b.drawBuffers([b.NONE,b.COLOR_ATTACHMENT1]);const $e=new xi({func:b.EQUAL,mask:255},254,255,b.KEEP,b.DECR,b.DECR),Oe=new wi([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!0,!1,!1,!1],b.MAX);tl(Se,c,t,o,u,Ve,$e,Oe,gi.disabled,Pe,"emissive",X,Z,Y,ne,ce,ct,z,Be,He),b.drawBuffers([b.COLOR_ATTACHMENT0])}};if(ae||Ee){let Pe;c.prepareDrawTile(),P&&!ae||(Pe=fe()),ae&&De(!0,!1,Pe),Ee&&De(!1,!0,Pe)}}else ae&&ye(!0),Ee&&ye(!1),(ae||Ee)&&c.resetStencilClippingMasks()}}},building:function(c,t,o,u){c.currentLayer<c.firstLightBeamLayer&&(c.firstLightBeamLayer=c.currentLayer);const g=o.paint.get("building-ambient-occlusion-ground-intensity"),v=o.paint.get("building-ambient-occlusion-ground-radius"),b=o.paint.get("building-ambient-occlusion-ground-attenuation"),E=o.paint.get("building-opacity");if(E<=0)return;let C=g>0&&v>0,P=!0;const z=o.paint.get("building-vertical-scale");if(z<=0)return;c.shadowRenderer||(P=!1);const U=c.conflationActive&&c.style.isLayerClipped(o,t.getSource()),N=c.style.order.indexOf(o.fqid);if((function(V,X,Z,Y,ne,ue){for(const ce of ue){const ae=X.getTile(ce).getBucket(Z);ae&&(ne&&ae.updateReplacement(ce,V.replacementSource,Y),ae.uploadUpdatedIndexBuffer(V.context))}})(c,t,o,N,U,u),(function(V,X,Z,Y){for(const ne of Y){const ue=X.getTile(ne).getBucket(Z);ue&&ue.needsEvaluation()&&ue.uploadUpdatedColorBuffer(V.context)}})(c,t,o,u),o.resetLayerRenderingStats(c),c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0),c.renderPass==="shadow"&&c.shadowRenderer){const V=c.shadowRenderer,X=[],Z=V.getShadowPassDepthMode();Is({painter:c,source:t,layer:o,coords:u,defines:X,blendMode:V.getShadowPassColorMode(),depthMode:Z,opacity:E,verticalScale:z,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(c.renderPass==="translucent"){let V=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];P&&(V=V.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),c.shadowRenderer&&c.shadowRenderer.useNormalOffset&&(V=V.concat("NORMAL_OFFSET"));const X=o.paint.get("building-facade-emissive-chance"),Z=o.paint.get("building-ambient-occlusion-intensity"),Y=o.paint.get("building-flood-light-intensity"),ne=o.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",ue=o.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ne?null:o.lut).toArray01().slice(0,3),ce=o.paint.get("building-flood-light-ground-attenuation"),ae=Y>0,Ee=new ii(c.context.gl.LEQUAL,ii.ReadWrite,c.depthRangeFor3D);E<1&&Is({painter:c,source:t,layer:o,coords:u,defines:V,blendMode:wi.disabled,depthMode:Ee,opacity:E,verticalScale:z,facadeEmissiveChance:X,facadeAOIntensity:Z,floodLightIntensity:Y,floodLightColor:ue,depthOnly:!0});const xe=c.colorModeForRenderPass();Is({painter:c,source:t,layer:o,coords:u,defines:V,blendMode:xe,depthMode:Ee,opacity:E,verticalScale:z,facadeEmissiveChance:X,facadeAOIntensity:Z,floodLightIntensity:Y,floodLightColor:ue}),C&&Yr(c,t,o,u,!0,E,g,v,Y,ue,b,U),ae&&Yr(c,t,o,u,!1,E,g,v,Y,ue,ce,U)}else if(c.renderPass==="light-beam"){const V=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],X=new ii(c.context.gl.LEQUAL,ii.ReadOnly,c.depthRangeFor3D);Is({painter:c,source:t,layer:o,coords:u,defines:V,blendMode:wi.alphaBlended,depthMode:X,opacity:E,verticalScale:z,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1),c.resetStencilClippingMasks()},hillshade:function(c,t,o,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;const g=c.context,v=c.terrain&&c.terrain.renderingToTexture,[b,E]=c.renderPass!=="translucent"||v?[{},u]:c.stencilConfigForOverlap(u);for(const C of E){const P=t.getTile(C);if(P.needsHillshadePrepare&&c.renderPass==="offscreen")La(c,P,o);else if(c.renderPass==="translucent"){const z=c.depthModeForSublayer(0,ii.ReadOnly),U=o.paint.get("hillshade-emissive-strength"),N=c.colorModeForDrapableLayerRenderPass(U),V=v&&c.terrain?c.terrain.stencilModeForRTTOverlap(C):b[C.overscaledZ];bd(c,C,P,o,z,V,N)}}g.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,o,u,g,v){if(c.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const b=c.transform.projection.name==="globe",E=o.paint.get("raster-elevation")!==0,C=E&&b;if(c.renderElevatedRasterBackface&&!C)return;const P=c.context,z=P.gl,U=t.getSource(),N=(function(xe,Se,ye,fe,De){const Pe=Se.paint.get("raster-color"),Be=xe.type==="raster-array",He=[],Ve=Se.paint.get("raster-resampling"),Qe=Se.paint.get("raster-color-mix");let ct=Se.paint.get("raster-color-range");const $e=[Qe[0],Qe[1],Qe[2],0],Oe=Qe[3];let nt=Ve==="nearest"?fe.NEAREST:fe.LINEAR;if(Be&&(He.push("RASTER_ARRAY"),Pe||He.push("RASTER_COLOR"),Ve==="linear"&&He.push("RASTER_ARRAY_LINEAR"),nt=fe.NEAREST,!ct&&xe.rasterLayers)){const Ze=xe.rasterLayers.find(({id:lt})=>lt===Se.sourceLayer);Ze&&Ze.fields&&Ze.fields.range&&(ct=Ze.fields.range)}if(ct=ct||[0,1],Pe){He.push("RASTER_COLOR"),ye.activeTexture.set(fe.TEXTURE2),Se.updateColorRamp(ct);let Ze=Se.colorRampTexture;Ze||(Ze=Se.colorRampTexture=new r.T(ye,Se.colorRamp,fe.RGBA8)),Ze.bind(nt,fe.CLAMP_TO_EDGE)}return De&&He.push("USE_MRT1"),{mix:$e,range:ct,offset:Oe,defines:He,resampling:nt}})(U,o,P,z,c.terrain&&c.terrain.renderingToTexture&&c.emissiveMode==="mrt-fallback");if(U instanceof r.aU&&!u.length&&!b)return;const V=o.paint.get("raster-emissive-strength"),X=c.colorModeForDrapableLayerRenderPass(V),Z=c.terrain&&c.terrain.renderingToTexture,Y=!c.options.moving,ne=o.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(U instanceof r.aU&&!u.length&&(U.onNorthPole||U.onSouthPole)){const xe=E?c.stencilModeFor3D():xi.disabled;return void Gc(!!U.onNorthPole,null,c,t,o,V,N,gi.disabled,xe)}if(!u.length)return;const[ue,ce]=U instanceof r.aU||Z?[{},u]:c.stencilConfigForOverlap(u),ae=ce[ce.length-1].overscaledZ;C&&N.defines.push("PROJECTION_GLOBE_VIEW"),E&&N.defines.push("RENDER_CUTOFF");const Ee=(xe,Se,ye)=>{for(const fe of xe){const De=fe.toUnwrapped(),Pe=t.getTile(fe);if(Z&&(!Pe||!Pe.hasData()))continue;P.activeTexture.set(z.TEXTURE0);const Be=qf(Pe,U,o,N);if(!Be||!Be.texture)continue;const{texture:He,mix:Ve,offset:Qe,tileSize:ct,buffer:$e}=Be;let Oe,nt;Z?(Oe=ii.disabled,nt=fe.projMatrix):E?(Oe=new ii(z.LEQUAL,ii.ReadWrite,c.depthRangeFor3D),nt=b?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(De,Y)):(Oe=c.depthModeForSublayer(fe.overscaledZ-ae,o.paint.get("raster-opacity")===1?ii.ReadWrite:ii.ReadOnly,z.LESS),nt=c.transform.calculateProjMatrix(De,Y));const Ze=c.terrain&&Z?c.terrain.stencilModeForRTTOverlap(fe):ue[fe.overscaledZ],lt=v?0:o.paint.get("raster-fade-duration");Pe.registerFadeDuration(lt);const St=t.findLoadedParent(fe,0),kt=Id(Pe,St,t,c.transform,lt);let Ct,Et;!kt.isFading&&Pe.refreshedUponExpiration&&(Pe.refreshedUponExpiration=!1),c.terrain&&c.terrain.prepareDrawTile(),P.activeTexture.set(z.TEXTURE0),He.bind(ne,z.CLAMP_TO_EDGE),P.activeTexture.set(z.TEXTURE1),St?(St.texture&&St.texture.bind(ne,z.CLAMP_TO_EDGE),Ct=Math.pow(2,St.tileID.overscaledZ-Pe.tileID.overscaledZ),Et=[Pe.tileID.canonical.x*Ct%1,Pe.tileID.canonical.y*Ct%1]):He.bind(ne,z.CLAMP_TO_EDGE),"useMipmap"in He&&P.extTextureFilterAnisotropic&&c.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const ei=c.transform;let Yt;const Nt=E?Nd(ei):[0,0,0,0];let Kt,ai,_i,Pi,Zi,yi=0;if(C&&U instanceof r.aU&&U.coordinates.length>3)Kt=Float32Array.from(r.bk(r.dJ(new r.cD(0,0,0)))),ai=Float32Array.from(ei.globeMatrix),_i=Float32Array.from(r.dF(ei)),Pi=[r.aF(ei.center.lng),r.aJ(ei.center.lat)],Yt=U.elevatedGlobePerspectiveTransform,Zi=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const an=r.dG(fe.canonical);yi=r.dH(an.getCenter().lat),Kt=Float32Array.from(r.bk(r.dJ(fe.canonical))),ai=Float32Array.from(ei.globeMatrix),_i=Float32Array.from(r.dF(ei)),Pi=[r.aF(ei.center.lng),r.aJ(ei.center.lat)],Yt=[0,0],Zi=Float32Array.from(r.dI(fe.canonical,an,yi,ei.worldSize/ei._pixelsPerMercatorPixel))}else Yt=U instanceof r.aU?U.perspectiveTransform:[0,0],Kt=new Float32Array(16),ai=new Float32Array(9),_i=new Float32Array(16),Pi=[0,0],Zi=new Float32Array(9);const zi=bu(nt,Kt,ai,_i,Zi,Et||[0,0],r.aj(c.transform.zoom),Pi,Nt,Ct||1,kt,o,Yt,E?o.paint.get("raster-elevation"):0,2,Ve,Qe,N.range,ct,$e,V),Ti=c.isTileAffectedByFog(fe),dn=c.getOrCreateProgram("raster",{defines:N.defines,overrideFog:Ti});if(c.uploadCommonUniforms(P,dn,De),U instanceof r.aU){const an=U.elevatedGlobeVertexBuffer,wn=U.elevatedGlobeIndexBuffer;if(Z||!b)U.boundsBuffer&&U.boundsSegments&&dn.draw(c,z.TRIANGLES,Oe,xi.disabled,X,gi.disabled,zi,o.id,U.boundsBuffer,c.quadTriangleIndexBuffer,U.boundsSegments);else if(an&&wn){const tn=ei.zoom<=r.c_?U.elevatedGlobeSegments:U.getSegmentsForLongitude(ei.center.lng);tn&&dn.draw(c,z.TRIANGLES,Oe,xi.disabled,X,Se,zi,o.id,an,wn,tn)}}else if(C){Oe=new ii(z.LEQUAL,ii.ReadOnly,c.depthRangeFor3D);const an=c.globeSharedBuffers;if(an){const[wn,tn,Li]=an.getGridBuffers(yi,!1);dn.draw(c,z.TRIANGLES,Oe,ye||Ze,c.colorModeForRenderPass(),Se,zi,o.id,wn,tn,Li)}}else{const{tileBoundsBuffer:an,tileBoundsIndexBuffer:wn,tileBoundsSegments:tn}=c.getTileBoundsBuffers(Pe);dn.draw(c,z.TRIANGLES,Oe,Ze,X,gi.disabled,zi,o.id,an,wn,tn)}}if(!(U instanceof r.aU)&&C)for(const fe of xe){const De=fe.canonical.y===(1<<fe.canonical.z)-1;fe.canonical.y===0&&Gc(!0,fe,c,t,o,V,N,Se,ye||xi.disabled),De&&Gc(!1,fe,c,t,o,V,N,Se===gi.frontCW?gi.backCW:gi.frontCW,ye||xi.disabled)}};C?Ee(ce,c.renderElevatedRasterBackface?gi.backCW:gi.frontCW,c.stencilModeFor3D()):Ee(ce,gi.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,t,o,u,g,v){c.renderPass==="offscreen"&&(function(b,E,C,P){if(!P.length)return;const z=b.context,U=z.gl,N=E.getSource();if(!(N instanceof ro))return;const V=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let X=C.particlePositionRGBAImage;if(!X||X.width!==V){const ce=(function(ae){const Ee=ae*ae,xe=new Uint8Array(4*Ee),Se=function(fe){return fe|=0,fe=Math.imul(2747636419^fe,2654435769),fe=Math.imul(fe^fe>>>16,2654435769),((fe=Math.imul(fe^fe>>>16,2654435769))>>>0)/4294967296},ye=.9090909090909091;for(let fe=0;fe<Ee;fe++){const De=ye*(Se(2*fe+0)+wu),Pe=ye*(Se(2*fe+1)+wu),Be=255*De%1,He=255*Pe%1,Ve=Be,Qe=Pe-He/255,ct=He;xe[4*fe+0]=255*(De-Be/255),xe[4*fe+1]=255*Ve,xe[4*fe+2]=255*Qe,xe[4*fe+3]=255*ct}return xe})(V);X=C.particlePositionRGBAImage=new r.q({width:V,height:V},ce)}let Z=C.particleFramebuffer;Z?Z.width!==V&&(Z.destroy(),Z=C.particleFramebuffer=z.createFramebuffer(V,V,1,null)):Z=C.particleFramebuffer=z.createFramebuffer(V,V,1,null);const Y=[];for(const ce of P){const ae=E.getTile(ce);if(!(ae instanceof sh))continue;const Ee=Ud(ae,N,C);if(!Ee)continue;const xe=[ae.tileSize,ae.tileSize];let Se=C.tileFramebuffer;Se||(Se=C.tileFramebuffer=z.createFramebuffer(xe[0],xe[1],1,null));let ye=ae.rasterParticleState;ye||(ye=ae.rasterParticleState=new jd(z,ce,xe,X));const fe=ye.update(C.lastInvalidatedAt);ye.particleTextureDimension!==V&&ye.updateParticleTexture(ce,X);const De=ye.targetColorTexture;ye.targetColorTexture=ye.backgroundColorTexture,ye.backgroundColorTexture=De;const Pe=ye.particleTexture0;ye.particleTexture0=ye.particleTexture1,ye.particleTexture1=Pe,Y.push([ce,Ee,ye,fe])}if(Y.length===0)return;const ne=r.o.now(),ue=C.previousDrawTimestamp?.001*(ne-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=ne,C.hasColorMap()){z.activeTexture.set(U.TEXTURE0+2);let ce=C.colorRampTexture;ce||(ce=C.colorRampTexture=new r.T(z,C.colorRamp,U.RGBA8)),ce.bind(U.LINEAR,U.CLAMP_TO_EDGE)}z.bindFramebuffer.set(C.tileFramebuffer.framebuffer),(function(ce,ae,Ee){const xe=ce.context,Se=xe.gl,ye=ae.tileFramebuffer;xe.activeTexture.set(Se.TEXTURE0);const fe={u_texture:0,u_opacity:1.05*(Pe=ae.paint.get("raster-particle-fade-opacity-factor"))/(Pe+.05)},De=ce.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Pe;for(const Be of Ee){const[,,He,Ve]=Be;ye.colorAttachment0.set(He.targetColorTexture.texture),xe.viewport.set([0,0,ye.width,ye.height]),xe.clear({color:r.ao.transparent}),Ve&&(He.backgroundColorTexture.bind(Se.NEAREST,Se.CLAMP_TO_EDGE),De.draw(ce,Se.TRIANGLES,ii.disabled,xi.disabled,wi.alphaBlended,gi.disabled,fe,ae.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments))}})(b,C,Y),(function(ce,ae,Ee,xe){const Se=ce.context,ye=Se.gl,fe=Ee.tileFramebuffer,De=ce.transform.projection.name==="globe",Pe=Ee.paint.get("raster-particle-max-speed");for(const Be of xe){const[He,Ve,Qe]=Be;Se.activeTexture.set(ye.TEXTURE0+0),Ve.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),fe.colorAttachment0.set(Qe.targetColorTexture.texture);const ct=ce.getOrCreateProgram("rasterParticleDraw",{defines:Ve.defines,overrideFog:!1});Se.activeTexture.set(ye.TEXTURE0+1);const $e=Ve.scalarData?[]:[0,1,2,3].map(Ze=>r.e9[Ze](He));$e.push(He);const Oe=He.canonical.x,nt=He.canonical.y;for(const Ze of $e){const lt=ae.getTile(De?Ze.wrapped():Ze);if(!lt)continue;const St=lt.rasterParticleState;if(!St)continue;const kt=Ze.canonical.x+(1<<Ze.canonical.z)*(Ze.wrap-He.wrap),Ct=Ze.canonical.y;St.particleTexture0.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const Et=Tu(1,St.particleTexture0.size[0],[kt-Oe,Ct-nt],0,Ve.texture.size,2,Pe,Ve.textureOffset,Ve.scale,Ve.offset);ct.draw(ce,ye.POINTS,ii.disabled,xi.disabled,wi.alphaBlended,gi.disabled,Et,Ee.id,St.particleIndexBuffer,void 0,St.particleSegment)}}})(b,E,C,Y),z.bindFramebuffer.set(C.particleFramebuffer.framebuffer),(function(ce,ae,Ee,xe){const Se=ce.context,ye=Se.gl,fe=ae.paint.get("raster-particle-max-speed"),De=xe*ae.paint.get("raster-particle-speed-factor")*.15,Pe=(function(He){return Math.pow(He,6)})(.01+1*ae.paint.get("raster-particle-reset-rate-factor")),Be=ae.particleFramebuffer;Se.viewport.set([0,0,Be.width,Be.height]);for(const He of Ee){const[,Ve,Qe]=He;Se.activeTexture.set(ye.TEXTURE0+0),Ve.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),Se.activeTexture.set(ye.TEXTURE0+1);const ct=Qe.particleTexture0;ct.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const $e=Uf(1,ct.size[0],0,Ve.texture.size,fe,De,Pe,Ve.textureOffset,Ve.scale,Ve.offset);Be.colorAttachment0.set(Qe.particleTexture1.texture),Se.clear({color:r.ao.transparent}),ce.getOrCreateProgram("rasterParticleUpdate",{defines:Ve.defines}).draw(ce,ye.TRIANGLES,ii.disabled,xi.disabled,wi.unblended,gi.disabled,$e,ae.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments)}})(b,C,Y,ue)})(c,t,o,u),c.renderPass==="translucent"&&((function(b,E,C,P){const z=b.context,U=z.gl,N=E.getSource().tileSize,V=5*(1-r.ah(r.cL,r.cL+1,b.transform.zoom))*N+C.paint.get("raster-particle-elevation"),X=!b.options.moving,Z=b.transform.projection.name==="globe";if(!P.length)return;const[Y,ne]=b.stencilConfigForOverlap(P),ue=[];Z&&ue.push("PROJECTION_GLOBE_VIEW");const ce=b.stencilModeFor3D();for(const ae of ne){const Ee=ae.toUnwrapped(),xe=E.getTile(ae);if(!xe.rasterParticleState)continue;const Se=xe.rasterParticleState,ye=100;xe.registerFadeDuration(ye);const fe=E.findLoadedParent(ae,0),De=Id(xe,fe,E,b.transform,ye);let Pe,Be;b.terrain&&b.terrain.prepareDrawTile(),z.activeTexture.set(U.TEXTURE0),Se.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),z.activeTexture.set(U.TEXTURE1),fe&&fe.rasterParticleState?(fe.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Pe=Math.pow(2,fe.tileID.overscaledZ-xe.tileID.overscaledZ),Be=[xe.tileID.canonical.x*Pe%1,xe.tileID.canonical.y*Pe%1]):Se.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const He=Z?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(Ee,X),Ve=b.transform,Qe=Hf(Ve),ct=r.dG(ae.canonical),$e=r.dH(ct.getCenter().lat);let Oe,nt,Ze,lt,St;Z?(Oe=Float32Array.from(r.bk(r.dJ(ae.canonical))),nt=Float32Array.from(Ve.globeMatrix),Ze=Float32Array.from(r.dF(Ve)),lt=[r.aF(Ve.center.lng),r.aJ(Ve.center.lat)],St=Float32Array.from(r.dI(ae.canonical,ct,$e,Ve.worldSize/Ve._pixelsPerMercatorPixel))):(Oe=new Float32Array(16),nt=new Float32Array(9),Ze=new Float32Array(16),lt=[0,0],St=new Float32Array(9));const kt=Mg(He,Oe,nt,Ze,St,Be||[0,0],r.aj(b.transform.zoom),lt,Qe,Pe||1,De,V),Ct=b.isTileAffectedByFog(ae),Et=b.getOrCreateProgram("rasterParticle",{defines:ue,overrideFog:Ct});if(b.uploadCommonUniforms(z,Et,Ee),Z){const ei=new ii(U.LEQUAL,ii.ReadOnly,b.depthRangeFor3D),Yt=0,Nt=b.globeSharedBuffers;if(Nt){const[Kt,ai,_i]=Nt.getGridBuffers($e,Yt!==0);Et.draw(b,U.TRIANGLES,ei,ce,wi.alphaBlended,b.renderElevatedRasterBackface?gi.frontCCW:gi.backCCW,kt,C.id,Kt,ai,_i)}}else{const ei=b.depthModeForSublayer(0,ii.ReadOnly),Yt=Y[ae.overscaledZ],{tileBoundsBuffer:Nt,tileBoundsIndexBuffer:Kt,tileBoundsSegments:ai}=b.getTileBoundsBuffers(xe);Et.draw(b,U.TRIANGLES,ei,Yt,wi.alphaBlended,gi.disabled,kt,C.id,Nt,Kt,ai)}}b.resetStencilClippingMasks()})(c,t,o,u),c.style.map.triggerRepaint())},background:function(c,t,o,u){const g=o.paint.get("background-color"),v=o.paint.get("background-color-use-theme").constantOr("default")==="none",b=o.paint.get("background-opacity"),E=o.paint.get("background-emissive-strength"),C=o.paint.get("background-pitch-alignment")==="viewport";if(b===0)return;const P=c.context,z=P.gl,U=c.transform,N=U.tileSize,V=o.paint.get("background-pattern");let X;if(V!==void 0&&(V===null||(X=c.imageManager.getPattern(r.I.from(V.toString()),o.scope,c.style.getLut(o.scope)),!X)))return;const Z=!V&&g.a===1&&b===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==Z)return;const Y=xi.disabled,ne=c.depthModeForSublayer(0,Z==="opaque"?ii.ReadWrite:ii.ReadOnly),ue=c.colorModeForDrapableLayerRenderPass(E),ce=V?"backgroundPattern":"background";let ae,Ee=u;Ee||(ae=c.getBackgroundTiles(),Ee=Object.values(ae).map(Se=>Se.tileID)),V&&(P.activeTexture.set(z.TEXTURE0),c.imageManager.bind(c.context,o.scope));const xe=[];if(c.terrain&&c.terrain.renderingToTexture&&c.emissiveMode==="mrt-fallback"&&xe.push("USE_MRT1"),C){const Se=c.getOrCreateProgram(ce,{overrideFog:!1,overrideRtt:!0,defines:xe}),ye=new Float32Array(r.bA([])),fe=new r.aQ(0,0,0,0,0),De=V?lo(ye,E,b,c,0,o.scope,X,C,{tileID:fe,tileSize:N}):Dl(ye,E,b,g.toPremultipliedRenderColor(v?null:o.lut));return void Se.draw(c,z.TRIANGLES,ne,Y,ue,gi.disabled,De,o.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments)}for(const Se of Ee){const ye=c.isTileAffectedByFog(Se),fe=c.getOrCreateProgram(ce,{overrideFog:ye,defines:xe}),De=Se.toUnwrapped(),Pe=u?Se.projMatrix:c.transform.calculateProjMatrix(De);c.prepareDrawTile();const Be=t?t.getTile(Se):ae?ae[Se.key]:new Gl(Se,N,U.zoom,c),He=V?lo(Pe,E,b,c,0,o.scope,X,C,{tileID:Se,tileSize:N}):Dl(Pe,E,b,g.toPremultipliedRenderColor(v?null:o.lut));c.uploadCommonUniforms(P,fe,De);const{tileBoundsBuffer:Ve,tileBoundsIndexBuffer:Qe,tileBoundsSegments:ct}=c.getTileBoundsBuffers(Be);fe.draw(c,z.TRIANGLES,ne,Y,ue,gi.disabled,He,o.id,Ve,Qe,ct)}},sky:function(c,t,o){const u=c._atmosphere?r.aj(c.transform.zoom):1,g=o.paint.get("sky-opacity")*u;if(g===0)return;const v=c.context,b=o.paint.get("sky-type"),E=new ii(v.gl.LEQUAL,ii.ReadOnly,[0,1]),C=c.frameCounter/1e3%1;b==="atmosphere"?c.renderPass==="offscreen"?o.needsSkyboxCapture(c)&&((function(P,z){const U=P.context,N=U.gl;let V=z.skyboxFbo;if(!V){V=z.skyboxFbo=U.createFramebuffer(32,32,1,null),z.skyboxGeometry=new To(U),z.skyboxTexture=U.gl.createTexture(),N.bindTexture(N.TEXTURE_CUBE_MAP,z.skyboxTexture),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MAG_FILTER,N.LINEAR);for(let ne=0;ne<6;++ne)N.texImage2D(N.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,N.RGBA,32,32,0,N.RGBA,N.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(V.framebuffer),U.viewport.set([0,0,32,32]);const X=z.getCenter(P,!0),Z=P.getOrCreateProgram("skyboxCapture"),Y=new Float64Array(16);r.bA(Y),r.en(Y,Y,.5*-Math.PI),cc(P,z,Z,Y,X,0),r.bA(Y),r.en(Y,Y,.5*Math.PI),cc(P,z,Z,Y,X,1),r.bA(Y),r.cU(Y,Y,.5*-Math.PI),cc(P,z,Z,Y,X,2),r.bA(Y),r.cU(Y,Y,.5*Math.PI),cc(P,z,Z,Y,X,3),r.bA(Y),cc(P,z,Z,Y,X,4),r.bA(Y),r.en(Y,Y,Math.PI),cc(P,z,Z,Y,X,5),U.viewport.set([0,0,P.width,P.height])})(c,o),o.markSkyboxValid(c)):c.renderPass==="sky"&&(function(P,z,U,N,V){const X=P.context,Z=X.gl,Y=P.transform,ne=P.getOrCreateProgram("skybox");X.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,z.skyboxTexture);const ue=((ce,ae,Ee,xe,Se)=>({u_matrix:ce,u_sun_direction:ae,u_cubemap:0,u_opacity:xe,u_temporal_offset:Se}))(Y.skyboxMatrix,z.getCenter(P,!1),0,N,V);P.uploadCommonUniforms(X,ne),ne.draw(P,Z.TRIANGLES,U,xi.disabled,P.colorModeForRenderPass(),gi.backCW,ue,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)})(c,o,E,g,C):b==="gradient"&&c.renderPass==="sky"&&(function(P,z,U,N,V){const X=P.context,Z=X.gl,Y=P.transform,ne=P.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new To(X)),X.activeTexture.set(Z.TEXTURE0);let ue=z.colorRampTexture;ue||(ue=z.colorRampTexture=new r.T(X,z.colorRamp,Z.RGBA8)),ue.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const ce=((ae,Ee,xe,Se,ye)=>({u_matrix:ae,u_color_ramp:0,u_center_direction:Ee,u_radius:r.an(xe),u_opacity:Se,u_temporal_offset:ye}))(Y.skyboxMatrix,z.getCenter(P,!1),z.paint.get("sky-gradient-radius"),N,V);P.uploadCommonUniforms(X,ne),ne.draw(P,Z.TRIANGLES,U,xi.disabled,P.colorModeForRenderPass(),gi.backCW,ce,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)})(c,o,E,g,C)},custom:function(c,t,o,u){const g=c.context,v=o.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&o.isDraped(t)){if(c.renderPass==="offscreen"){const b=v.prerender;if(b){if(c.setCustomLayerDefaults(),g.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const E=c.transform.pointMerc;b.call(v,g.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),r.aj(c.transform.zoom),[E.x,E.y],c.transform.pixelsPerMeterRatio)}else b.call(v,g.gl,c.transform.customLayerMatrix());g.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const E=v.renderToTile;if(E){const C=u[0].canonical,P={x:C.x+u[0].wrap*(v.wrapTileId?0:1<<C.z),y:C.y,z:C.z};g.setDepthMode(ii.disabled),g.setStencilMode(xi.disabled),g.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),E.call(v,g.gl,P),g.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),g.setColorMode(c.colorModeForRenderPass()),g.setStencilMode(xi.disabled);const b=v.renderingMode==="3d"?new ii(c.context.gl.LEQUAL,ii.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,ii.ReadOnly);if(g.setDepthMode(b),c.transform.projection.name==="globe"){const E=c.transform.pointMerc;v.render(g.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),r.aj(c.transform.zoom),[E.x,E.y],c.transform.pixelsPerMeterRatio)}else v.render(g.gl,c.transform.customLayerMatrix());g.setDirty(),c.setBaseState(),g.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,t,o,u){if(c.renderPass==="opaque")return;const g=o.paint.get("model-opacity").constantOr(1),v=o.paint.get("model-elevation-reference"),b=v==="ground",E=v==="ground";if(g===0)return;const C=o.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!C||c.terrain&&g<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof r.ad))return;const P=c.shadowRenderer,z=o.paint.get("model-receive-shadows");P&&(P.useNormalOffset=!0,z||(P.enabled=!1));const U=()=>{P&&(P.useNormalOffset=!0,z||(P.enabled=!0))},N=t.getSource();if(c.renderPass==="light-beam"&&N.type!=="batched-model")return;if(N.type==="vector"||N.type==="geojson")return(function(ae,Ee,xe,Se,ye){const fe=ae.transform,De=fe.projection.name==="globe",Pe=fe.getFreeCameraOptions().position;if(!ae.modelManager)return;const Be=ae.modelManager;xe.modelManager=Be;const He=ae.shadowRenderer;if(!xe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ve=xe._unevaluatedLayout._values["model-id"],Qe=Object.assign({},xe.layout.get("model-id").parameters),ct=ae.style.order.indexOf(xe.fqid),$e=xe.paint.get("model-opacity").constantOr(1);for(const Oe of Se){const nt=Ee.getTile(Oe).getBucket(xe);if(!nt||nt.projection.name!==fe.projection.name)continue;const Ze=nt.getModelUris();if(Ze&&!nt.modelsRequested&&(Be.addModelsFromBucket(Ze,ye),nt.modelsRequested=!0),De)Qe.zoom=Oe.overscaledZ;else{const Nt=Dt(Oe,fe);Qe.zoom=Nt}const lt=Ve.possiblyEvaluate(Qe);if(Hc(ae,nt,Oe),ho.shadowUniformsInitialized=!1,ho.useSingleShadowCascade=!!He&&He.getMaxCascadeForTile(Oe.toUnwrapped())===0,ae.renderPass==="shadow"&&He){if(ae.currentShadowCascade===1&&nt.isInsideFirstShadowMapFrustum)continue;const Nt=fe.calculatePosMatrix(Oe.toUnwrapped(),fe.worldSize);if(ho.tileMatrix.set(Nt),ho.shadowTileMatrix=Float32Array.from(He.calculateShadowPassMatrixFromMatrix(Nt)),ho.aabb.min=[0,0,0],ho.aabb.max[0]=ho.aabb.max[1]=r.al,ho.aabb.max[2]=0,nr(nt,ho,ae,xe.scope))continue}const St=1<<Oe.canonical.z,kt=[((Pe.x-Oe.wrap)*St-Oe.canonical.x)*r.al,(Pe.y*St-Oe.canonical.y)*r.al,Pe.z*St*r.al];ae.conflationActive&&Object.keys(nt.instancesPerModel).length>0&&ae.style.isLayerClipped(xe,Ee.getSource())&&nt.updateReplacement(Oe,ae.replacementSource,ct,xe.scope)&&(nt.uploaded=!1,nt.upload(ae.context));let Ct=0;const Et=new Array,ei=new Array,Yt=new Array;for(let Nt in nt.instancesPerModel){const Kt=nt.instancesPerModel[Nt];Kt.features.length>0&&!De&&(Nt=lt.evaluate(Kt.features[0].feature,{}));const ai=Be.getModel(Nt,ye);if(ai||Be.hasURLBeenRequested(Nt)||nt.modelUris.includes(Nt)||(nt.modelUris.push(Nt),nt.modelsRequested=!1),ai&&ai.uploaded)if(De){const _i=r.c5([],[Pe.x,Pe.y,Pe.z],ae.transform.worldSize);r.ew(_i,_i);for(let Pi=0;Pi<Kt.instancedDataArray.length;++Pi){const Zi=[0,0,0],yi=[1,1,1],zi=r.ex(),Ti=Kt.tileCoordinatesForInstance(Pi),dn=Kt.transformForInstance(Pi);r.ey(yi,dn),r.ez(zi,dn),r.eA(Zi,zi);const an=Kt.translationForInstance(Pi),wn=new r.aT(0,0);r.eB(nt.canonical,wn,Ti.x,Ti.y);const tn=r.bC();r.eC(tn,ai,ae.transform,wn,Zi,yi,an,!0,!1,!1);const Li=Kt.colorForInstance(Pi),un=r.bA([]),Xn=r.ef(wn.lat,ae.transform.zoom),Tn=r.bq([],[1,1,1/Xn]);r.br(un,un,_i),Yt.push({zScaleMatrix:Tn,negCameraPosMatrix:un});for(const pn of ai.nodes)Ru(ae,pn,tn,ae.transform.expandedFarZProjMatrix,Ct,Et,ei,ai.materialOverrides,$e,Li);++Ct}}else for(const _i of ai.nodes)Ut(ae,xe,_i,Kt,kt,Oe,ho)}if(De)if(ae.renderPass==="shadow"){for(const Nt of ei)Ph(Nt.mesh,Nt.nodeModelMatrix,ae,xe);for(const Nt of Et)Ph(Nt.mesh,Nt.nodeModelMatrix,ae,xe)}else Kf(ae,xe,Et,ei,Yt)}})(c,t,o,u,Oh(c,o)),void U();if(!N.loaded())return;if(N.type==="batched-model")return(function(ae,Ee,xe,Se){xe.resetLayerRenderingStats(ae);const ye=ae.context,fe=ae.transform,De=ae.style.fog,Pe=ae.shadowRenderer;if(fe.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${fe.projection.name} projection is not yet implemented`);const Be=ae.transform.getFreeCameraOptions().position,He=r.c5([],[Be.x,Be.y,Be.z],ae.transform.worldSize),Ve=r.ew([],He),Qe=r.bA([]),ct=r.ef(fe.center.lat,fe.zoom),$e=r.bq([],[1,1,1/ct]);r.br(Qe,Qe,Ve);const Oe=xe.paint.get("model-opacity").constantOr(1),nt=new ii(ye.gl.LEQUAL,ii.ReadWrite,ae.depthRangeFor3D),Ze=new ii(ye.gl.LEQUAL,ii.ReadOnly,ae.depthRangeFor3D),lt=new r.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),St=ae.renderPass==="shadow",kt=St&&Pe?Pe.getCurrentCascadeFrustum():fe.getFrustum(fe.scaleZoom(fe.worldSize)),Ct=xe.paint.get("model-front-cutoff"),Et=Ct[2]<1,ei=pa(ae,xe.paint.get("model-cutoff-fade-range")),Yt=xe.getLayerRenderingStats();(function(Nt,Kt,ai,_i){const Pi=Nt.terrain?Nt.terrain.exaggeration():0,Zi=Nt.transform.zoom;for(const yi of _i){const zi=Kt.getTile(yi).getBucket(ai);zi&&(zi.setFilter(ai.filter),Nt.conflationActive&&zi.updateReplacement(yi,Nt.replacementSource),zi.evaluateTransform(Nt,ai),Nt.terrain&&Pi>0&&zi.elevationUpdate(Nt.terrain,Pi,yi,ai.source),zi.needsReEvaluation(Nt,Zi,ai)&&zi.evaluate(ai))}})(ae,Ee,xe,Se),(function(){let Nt,Kt,ai;Et?(Nt=Se.length-1,Kt=-1,ai=-1):(Nt=0,Kt=Se.length,ai=1);const _i=new Float64Array(16),Pi=r.cA(),Zi=new r.P(0,0);for(let yi=Nt;yi!==Kt;yi+=ai){const zi=Se[yi],Ti=Ee.getTile(zi).getBucket(xe);if(!Ti||!Ti.uploaded)continue;let dn=!1;Pe&&(dn=Pe.getMaxCascadeForTile(zi.toUnwrapped())===0);const an=fe.calculatePosMatrix(zi.toUnwrapped(),fe.worldSize),wn=Ti.modelTraits;!St&&Et&&(r.bl(_i,an),r.af(Pi,He,_i),Zi.x=Pi[0],Zi.y=Pi[1]);const tn=[];Ti.setFilter(xe.filter);for(const Li of Ti.getNodesInfo()){if(Li.hiddenByReplacement||!Li.node.meshes)continue;const un=Li.node;let Xn=0;ae.terrain&&un.elevation&&(Xn=un.elevation*ae.terrain.exaggeration());const Tn=(()=>{const mn=Li.aabb;return lt.min=[...mn.min],lt.max=[...mn.max],lt.min[2]+=Xn,lt.max[2]+=Xn,r.af(lt.min,lt.min,an),r.af(lt.max,lt.max,an),lt})(),pn=Li.evaluatedScale;if(pn[0]<=1&&pn[1]<=1&&pn[2]<=1&&Tn.intersects(kt)===0)continue;if(!St&&Et){const mn=.16666666666666666;Li.cameraCollisionOpacity=He[0]>Tn.min[0]&&He[0]<Tn.max[0]&&He[1]>Tn.min[1]&&He[1]<Tn.max[1]&&He[2]*ct<Tn.max[2]&&un.footprint&&r.c0(Zi,un.footprint)?Math.max(Li.cameraCollisionOpacity-mn,0):Math.min(1,Li.cameraCollisionOpacity+mn)}const Di=[...an],ki=1/r.d7(zi.canonical),Bn=un.anchor?un.anchor[0]:0,dr=un.anchor?un.anchor[1]:0;r.br(Di,Di,[Bn*(pn[0]-1)+Li.evaluatedTranslation[0]*ki,dr*(pn[1]-1)+Li.evaluatedTranslation[1]*ki,Xn+Li.evaluatedTranslation[2]]),r.cq(pn,r.eE)||r.cS(Di,Di,pn);const Rn=r.aB([],Di,un.globalMatrix),Fn=r.aB([],fe.expandedFarZProjMatrix,Rn),Xs=r.aB([],fe.expandedFarZProjMatrix,Di),Rs=r.aC([],[Bn,dr,Xn,1],Fn)[2];un.hidden=!1;let as=Oe;St||(Et&&(as*=Li.cameraCollisionOpacity,as*=pm(Di,fe,Li.aabb,Ct)),as*=qe(ei,Rs)),as!==0?tn.push({nodeInfo:Li,depth:Rs,opacity:as,wvpForNode:Fn,wvpForTile:Xs,nodeModelMatrix:Rn,tileModelMatrix:Di}):un.hidden=!0}St||tn.sort((Li,un)=>!Et||Li.opacity===1&&un.opacity===1?Li.depth<un.depth?-1:1:Li.opacity===1?-1:un.opacity===1?1:Li.depth>un.depth?-1:1);for(const Li of tn){const un=Li.nodeInfo,Xn=un.node;let Tn=r.aB([],$e,Li.tileModelMatrix);r.aB(Tn,Qe,Tn);const pn=r.bl([],Tn);r.eg(pn,pn),r.cS(pn,pn,Mu),Tn=r.aB(Tn,Tn,Xn.globalMatrix);const Di=ae.renderPass==="light-beam",ki=xe.paint.get("model-color-use-theme").constantOr("default")==="none",Bn=wn&r.eI.HasMapboxMeshFeatures,dr=Bn?0:un.evaluatedRMEA[0][2];for(let Rn=0;Rn<Xn.meshes.length;++Rn){const Fn=Xn.meshes[Rn],Xs=Rn===Xn.lightMeshIndex;let Rs=Li.wvpForNode;if(Xs){if(!Di&&!ae.terrain&&ae.shadowRenderer){ae.currentLayer<ae.firstLightBeamLayer&&(ae.firstLightBeamLayer=ae.currentLayer);continue}Rs=Li.wvpForTile}else if(Di)continue;const as={defines:[]},mn=[];if(!St&&Pe&&(Pe.useNormalOffset=!!Fn.normalBuffer),na(as.defines,mn,Fn,ae,ki?null:xe.lut),Bn||as.defines.push("DIFFUSE_SHADED"),dn&&as.defines.push("SHADOWS_SINGLE_CASCADE"),Yt&&(St?Yt.numRenderedVerticesInShadowPass+=Fn.vertexArray.length:Yt.numRenderedVerticesInTransparentPass+=Fn.vertexArray.length),St){Ph(Fn,Li.nodeModelMatrix,ae,xe);continue}let No=null;if(De){const Dr=Yf(Li.nodeModelMatrix,ae.transform);if(No=new Float32Array(Dr),fe.projection.name!=="globe"){const Vn=Fn.aabb.min,kr=Fn.aabb.max,[is,lr]=De.getOpacityForBounds(Dr,Vn[0],Vn[1],kr[0],kr[1]);as.overrideFog=is>=Zt||lr>=Zt}}const Ms=Fn.material;let Ys;Ms.occlusionTexture&&Ms.occlusionTexture.offsetScale&&(Ys=Ms.occlusionTexture.offsetScale,as.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const aa=ae.getOrCreateProgram("model",as);!St&&Pe&&Pe.setupShadowsFromMatrix(Li.tileModelMatrix,aa,Pe.useNormalOffset),ae.uploadCommonUniforms(ye,aa,null,No);const So=Ms.pbrMetallicRoughness;So.metallicFactor=.9,So.roughnessFactor=.5;const rr=el(new Float32Array(Rs),new Float32Array(Tn),new Float32Array(pn),new Float32Array(Xn.globalMatrix),ae,Li.opacity,So.baseColorFactor,Ms.emissiveFactor,So.metallicFactor,So.roughnessFactor,Ms,dr,xe,[0,0,0],Ys);!Xs&&(un.hasTranslucentParts||Li.opacity<1)&&aa.draw(ae,ye.gl.TRIANGLES,nt,xi.disabled,wi.disabled,gi.backCCW,rr,xe.id,Fn.vertexBuffer,Fn.indexBuffer,Fn.segments,xe.paint,ae.transform.zoom,void 0,mn),aa.draw(ae,ye.gl.TRIANGLES,Xs?Ze:nt,xi.disabled,Xs||Li.opacity<1||un.hasTranslucentParts?wi.alphaBlended:wi.unblended,gi.backCCW,rr,xe.id,Fn.vertexBuffer,Fn.indexBuffer,Fn.segments,xe.paint,ae.transform.zoom,void 0,mn)}}}})()})(c,t,o,u),void U();if(N.type!=="model")return;const V=N.getModels(),X=[],Z=c.transform.getFreeCameraOptions().position,Y=r.c5([],[Z.x,Z.y,Z.z],c.transform.worldSize);r.ew(Y,Y);const ne=[],ue=[];let ce=0;for(const ae of V){const Ee=t.getFeatureState("",ae.id),xe={type:"Unknown",id:ae.id,properties:ae.featureProperties},Se=o.paint.get("model-rotation").evaluate(xe,Ee),ye=o.paint.get("model-scale").evaluate(xe,Ee),fe=o.paint.get("model-translation").evaluate(xe,Ee),De=o.paint.get("model-opacity").evaluate(xe,Ee);dm(o,ae.id,Ee,ae.featureProperties,ae.nodeOverrideNames,ae.nodeOverrides),fm(o,ae.id,Ee,ae.featureProperties,ae.materialOverrideNames,ae.materialOverrides),ae.nodeOverrides.size>0&&ae.computeBoundsAndApplyParent(),ae.computeModelMatrix(c,Se,ye,fe,E,b,!1);const Pe=r.bA([]),Be=r.ef(ae.position.lat,c.transform.zoom),He=r.bq([],[1,1,1/Be]);r.br(Pe,Pe,Y),X.push({zScaleMatrix:He,negCameraPosMatrix:Pe});for(const Ve of ae.nodes)Ru(c,Ve,ae.matrix,c.transform.expandedFarZProjMatrix,ce,ne,ue,ae.materialOverrides,De);ce++}if(ne.sort((ae,Ee)=>Ee.depth-ae.depth),c.renderPass!=="shadow")Kf(c,o,ne,ue,X),U();else{for(const ae of ue)Ph(ae.mesh,ae.nodeModelMatrix,c,o);for(const ae of ne)Ph(ae.mesh,ae.nodeModelMatrix,c,o);U()}}},ep={line:function(c,t,o){if(c.hasElevatedBuckets=!1,c.hasNonElevatedBuckets=!1,c._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||c._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const g of u){const v=t.getTile(g).getBucket(c);if(v&&(v.elevationType!=="none"?c.hasElevatedBuckets=!0:c.hasNonElevatedBuckets=!0,c.hasElevatedBuckets&&c.hasNonElevatedBuckets))break}}}else c.hasNonElevatedBuckets=!0},model:function(c,t,o){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,Oh(o,c)));if(u.type==="batched-model"||u.type!=="model")return;const g=u.getModels();for(const v of g)v.upload(o.context)},raster:function(c,t,o){const u=t.getSource();if(!(u instanceof ro&&u.loaded()))return;const g=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!g)return;const v=c.paint.get("raster-array-band")||u.getInitialBand(g);if(v==null)return;const b=t.getIds().map(E=>t.getTileByID(E));for(const E of b)E.updateNeeded(c.id,v)&&u.prepareTile(E,g,c.id,v)},"raster-particle":function(c,t,o){const u=t.getSource();if(!(u instanceof ro&&u.loaded()))return;const g=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!g)return;const v=c.paint.get("raster-particle-array-band")||u.getInitialBand(g);if(v==null)return;const b=t.getIds().map(E=>t.getTileByID(E));for(const E of b)E.updateNeeded(c.id,v)&&u.prepareTile(E,g,c.id,v)}},Wd={fill:rm},_m={fill:function(c,t,o,u){if(!o.layout||o.layout.get("fill-elevation-reference")==="none"||o.paint.get("fill-opacity").constantOr(1)===0)return;const g=c.context.gl,v=new ii(g.LEQUAL,ii.ReadOnly,c.depthRangeFor3D),b=new xi({func:g.ALWAYS,mask:255},255,255,g.KEEP,g.KEEP,g.REPLACE),E=c.transform.getFreeCameraOptions().position,C=c.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const P of u){const z=t.getTile(P),U=z.getBucket(o);if(!U)continue;const N=U.elevatedStructures;if(!N||N.depthSegments.segments[0].primitiveLength===0)continue;const V=Uc(P.toUnwrapped(),E),X=c.translatePosMatrix(P.projMatrix,z,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),Z=Fc(X,V,0,1,0);C.draw(c,g.TRIANGLES,v,b,wi.disabled,gi.disabled,Z,o.id,N.vertexBuffer,N.indexBuffer,N.depthSegments,o.paint,c.transform.zoom)}}};class tp{constructor(t,o,u,g,v){this.context=new Ba(t,o),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=r.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const b=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const C of b)this._debugParams.enabledLayers[C]=!0;for(const C of b);this.occlusionParams=new Qf,this.setup(),this.numSublayers=es.maxUnderzooming+es.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new yd(this),this._wireframeDebugCache=new Gd,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const E=new r.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,E,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g,this.worldview=v,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(t,o){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ah(this,t));const g=this._terrain;this.transform.elevation=u?g:null,g.update(t,this.transform,o),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(t){const o=t.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,g]=o.getFovAdjustedRange(this.transform._fov);if(u>g)return void(this.transform.fogCullDistSq=null);const v=u+.78*(g-u);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ah(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,o){if(this.width=t*r.o.devicePixelRatio,this.height=o*r.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,o=new r.bd;o.emplaceBack(0,0),o.emplaceBack(r.al,0),o.emplaceBack(0,r.al),o.emplaceBack(r.al,r.al),this.tileExtentBuffer=t.createVertexBuffer(o,r.bf.members),this.tileExtentSegments=r.bg.simpleSegment(0,0,4,2);const u=new r.bd;u.emplaceBack(0,0),u.emplaceBack(r.al,0),u.emplaceBack(0,r.al),u.emplaceBack(r.al,r.al),this.debugBuffer=t.createVertexBuffer(u,r.bf.members),this.debugSegments=r.bg.simpleSegment(0,0,4,5);const g=new r.bd;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,r.bf.members),this.viewportSegments=r.bg.simpleSegment(0,0,4,2);const v=new r.b1;v.emplaceBack(0,0,0,0),v.emplaceBack(r.al,0,r.al,0),v.emplaceBack(0,r.al,0,r.al),v.emplaceBack(r.al,r.al,r.al,r.al),this.mercatorBoundsBuffer=t.createVertexBuffer(v,r.bi.members),this.mercatorBoundsSegments=r.bg.simpleSegment(0,0,4,2);const b=new r.b0;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const E=new r.be;for(const P of[0,1,3,2,0])E.emplaceBack(P);this.debugIndexBuffer=t.createIndexBuffer(E),this.emptyTexture=new r.T(t,new r.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.bC();const C=this.context.gl;this.stencilClearMode=new xi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,ii.disabled,this.stencilClearMode,wi.disabled,gi.disabled,Eh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,u){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const C of u)if(this._tileClippingMaskIDs[C.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=o.id;const g=this.context,v=g.gl;this.nextStencilID+u.length>256&&this.clearStencil(),g.setColorMode(wi.disabled),g.setDepthMode(ii.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of u){const C=o.getTile(E),P=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:U,tileBoundsSegments:N}=this.getTileBoundsBuffers(C);b.draw(this,v.TRIANGLES,ii.disabled,new xi({func:v.ALWAYS,mask:0},P,255,v.KEEP,v.KEEP,v.REPLACE),wi.disabled,gi.disabled,Eh(E.projMatrix),"$clipping",z,U,N)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new xi({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const o=this.context.gl;return new xi({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,u=t.sort((b,E)=>E.overscaledZ-b.overscaledZ),g=u[u.length-1].overscaledZ,v=u[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const b={};for(let E=0;E<v;E++)b[E+g]=new xi({func:o.GEQUAL,mask:255},E+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=v,[b,u]}return[{[g]:xi.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new wi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?wi.unblended:wi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?t!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new wi([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new r.ao(0,0,0,t??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new wi([o.ONE,o.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,o.ONE_MINUS_SRC_ALPHA],r.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(t,o,u,g=!1){if(this.depthOcclusion)return new ii(this.context.gl.GREATER,ii.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return ii.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ii(u||this.context.gl.LEQUAL,o,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,o=Math.ceil(this.width),u=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),v=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&u!==0&&(this.depthFBO=new Ol(this.context,o,u,0,"texture"),this.depthTexture=new r.T(this.context,{width:o,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),t.bindTexture(t.TEXTURE_2D,v),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,o,u,0,0,o,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,o)=>t+o/this._fpsHistory.length,0))}render(t,o){const u=r.o.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=o;const g=this.style._mergedLayers,v=!(!this.terrain||!this.terrain.enabled),b=()=>this.style._getOrder(v).filter($e=>{const Oe=g[$e];return!(Oe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Oe.type]});let E=b(),C=!1,P=!1,z=null,U=0,N=!1;for(const $e of E){const Oe=g[$e];Oe.visibility!=="none"&&(Oe.type==="circle"?C=!0:Oe.type==="building"?(z=Oe,++U):Oe.type==="symbol"&&(Oe.hasOcclusionOpacityProperties?P=!0:C=!0))}this.updateEmissiveMode();let V=E.map($e=>g[$e]);const X=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.o.now()),this.imageManager.beginFrame();for(const $e in X){const Oe=X[$e];Oe.used&&(Oe.prepare(this.context),Oe.getSource().usedInConflation&&++U)}let Z=!1;for(const $e of V)$e.isHidden(this.transform.zoom)||($e.type==="clip"&&(Z=!0),this.prepareLayer($e));const Y={},ne={},ue={},ce={},ae={};for(const $e in X){const Oe=X[$e];Y[$e]=Oe.getVisibleCoordinates(),ne[$e]=Y[$e].slice().reverse(),ue[$e]=Oe.getVisibleCoordinates(!0).reverse(),ce[$e]=Oe.getShadowCasterCoordinates(),ae[$e]=Oe.sortCoordinatesByDistance(Y[$e])}const Ee=$e=>{const Oe=this.style.getLayerSourceCache($e);return Oe&&Oe.used?Oe.getSource():null};if(U||Z||this._clippingActiveLastFrame){const $e=[],Oe=[];let nt=0;for(const Ze of V)this.isSourceForClippingOrConflation(Ze,Ee(Ze))&&($e.push(Ze),Oe.push(nt)),nt++;if($e&&(Z||$e.length>1)||this._clippingActiveLastFrame){Z=!1;const Ze=[];for(let lt=0;lt<$e.length;lt++){const St=$e[lt],kt=Oe[lt],Ct=this.style.getLayerSourceCache(St);if(!Ct||!Ct.used||!Ct.getSource().usedInConflation&&St.type!=="clip"&&St.type!=="building")continue;let Et=r.eQ,ei=r.b_.None;const Yt=[];let Nt=!0;if(St.type==="building")Et=r.eS;else if(St.type==="clip"){Et=kt;for(const Kt of St.layout.get("clip-layer-types"))ei|=Kt==="model"?r.b_.Model:Kt==="symbol"?r.b_.Symbol:r.b_.FillExtrusion;for(const Kt of St.layout.get("clip-layer-scope"))Yt.push(Kt);St.isHidden(this.transform.zoom)?Nt=!1:Z=!0}Nt&&Ze.push({layer:St.fqid,cache:Ct,order:Et,clipMask:ei,clipScope:Yt})}this.replacementSource.setSources(Ze),N=!0}}this._clippingActiveLastFrame=Z,N||this.replacementSource.clear(),this.conflationActive=N,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let $e=0;$e<V.length;$e++){const Oe=V[$e];if(Oe.visibility==="none")continue;const nt=Oe.cutoffRange();if(this.longestCutoffRange=Math.max(nt,this.longestCutoffRange),nt>0){const Ze=Ee(Oe);Ze&&(this.minCutoffZoom=Math.max(Ze.minzoom,this.minCutoffZoom)),Oe.minzoom&&(this.minCutoffZoom=Math.max(Oe.minzoom,this.minCutoffZoom))}Oe.is3D(v)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=$e),this._lastOcclusionLayer=$e)}const xe=this.style&&this.style.fog;xe?(this._fogVisible=xe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=xe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ue),this.opaquePassCutoff=0,E=b(),V=E.map($e=>g[$e]));const Se=this._shadowRenderer;if(Se){Se.updateShadowParameters(this.transform,this.style.directionalLight);for(const $e in X)for(const Oe of Y[$e]){let nt={min:0,max:0};this.terrain&&(nt=this.terrain.getMinMaxForTile(Oe)||nt),Se.addShadowReceiver(Oe.toUnwrapped(),nt.min,nt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Xf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ye=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),fe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ye&&!this._snow&&(this._snow=new Lh(this)),!ye&&this._snow&&(this._snow.destroy(),delete this._snow),fe&&!this._rain&&(this._rain=new $d(this)),!fe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),z){this.buildingTileBorderManager||(this.buildingTileBorderManager=new qc);const $e=this.style.getLayerSourceCache(z);this.buildingTileBorderManager.updateBorders($e,z)}if(!Gs.has(this.context.gl))return;this.renderPass="offscreen";for(const $e of V){const Oe=t.getLayerSourceCache($e);if(!$e.hasOffscreenPass()||$e.isHidden(this.transform.zoom))continue;const nt=Oe?ne[Oe.id]:void 0;($e.type==="custom"||$e.type==="raster"||$e.type==="raster-particle"||$e.isSky()||nt&&nt.length)&&this.renderLayer(this,Oe,$e,nt)}this.depthRangeFor3D=[0,1-(V.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ce)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const De=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Pe=(()=>{if(o.showOverdrawInspector)return r.ao.black;const $e=this.style.fog;if($e&&this.transform.projection.supportsFog){const Oe=this.style.getLut($e.scope);if(!De){const nt=$e.properties.get("color-use-theme")==="none",Ze=$e.properties.get("color").toNonPremultipliedRenderColor(nt?null:Oe).toArray01();return new r.ao(...Ze)}if(De){const nt=$e.properties.get("space-color-use-theme")==="none",Ze=$e.properties.get("space-color").toNonPremultipliedRenderColor(nt?null:Oe).toArray01();return new r.ao(...Ze)}}return r.ao.transparent})();if(this.context.clear({color:Pe,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&De&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const $e=V[this.currentLayer],Oe=t.getLayerSourceCache($e);if($e.isSky())continue;const nt=Oe?($e.is3D(v)?ae:ne)[Oe.id]:void 0;this._renderTileClippingMasks($e,Oe,nt),this.renderLayer(this,Oe,$e,nt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&De&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const $e=V[this.currentLayer],Oe=t.getLayerSourceCache($e);$e.isSky()&&this.renderLayer(this,Oe,$e,Oe?ne[Oe.id]:void 0)}function Be($e,Oe){let nt;return Oe&&(nt=($e.type==="symbol"?ue:$e.is3D(v)?ae:ne)[Oe.id]),nt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<E.length;){const $e=V[this.currentLayer];if($e.type==="raster"||$e.type==="raster-particle"){const Oe=t.getLayerSourceCache($e);this.renderLayer(this,Oe,$e,Be($e,Oe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;const He=Se?Se.getGroundShadowLayerIndex():-1;let Ve=!1,Qe=-1;for(let $e=0;$e<E.length;++$e){const Oe=V[$e];Oe.isHidden(this.transform.zoom)||Oe.is3D(v)&&(Qe=$e)}P&&Qe===-1&&(C=!0);let ct=!1;for(;this.currentLayer<E.length;){const $e=V[this.currentLayer],Oe=t.getLayerSourceCache($e);if($e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped($e)){if($e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!ct&&$e.is3D(v)&&!v){const nt=this.currentLayer,Ze=lt=>{for(this.currentLayer=0;this.currentLayer<V.length;this.currentLayer++){const St=V[this.currentLayer];if(Wd[St.type]){const kt=this.style.getLayerSourceCache(St);Wd[St.type](this,kt,St,Be(St,kt),lt)}}};Ze("initialize"),Ze("reset"),this.currentLayer=nt,ct=!0}if(C&&!Ve&&this.terrain&&!this.transform.isOrthographic&&(Ve=!0,this.blitDepth()),P&&Qe!==-1&&this.currentLayer===Qe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks($e,Oe,Oe?Y[Oe.id]:void 0),this.renderLayer(this,Oe,$e,Be($e,Oe)),!this.terrain&&Se&&this.currentLayer===He){{this.clearStencil(),this.resetStencilClippingMasks();const nt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<V.length;this.currentLayer++){const Ze=V[this.currentLayer];if(_m[Ze.type]){const lt=this.style.getLayerSourceCache(Ze);_m[Ze.type](this,lt,Ze,Be(Ze,lt))}}this.currentLayer=nt}if(Se.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const nt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=nt;this.currentLayer++){const Ze=V[this.currentLayer];if(!Ze.hasLightBeamPass())continue;const lt=t.getLayerSourceCache(Ze);this.renderLayer(this,lt,Ze,lt?ne[lt.id]:void 0)}this.currentLayer=nt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const nt=this.currentLayer;this.depthOcclusion=!0;for(const Ze of this.layersWithOcclusionOpacity){this.currentLayer=Ze;const lt=V[this.currentLayer],St=t.getLayerSourceCache(lt),kt=St?ne[St.id]:void 0;this.terrain||this._renderTileClippingMasks(lt,St,St?Y[St.id]:void 0),this.renderLayer(this,St,lt,kt)}this.depthOcclusion=!1,this.currentLayer=nt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $e=null;V.forEach(Oe=>{const nt=t.getLayerSourceCache(Oe);nt&&!Oe.isHidden(this.transform.zoom)&&nt.getVisibleCoordinates().length&&(!$e||$e.getSource().maxzoom<nt.getSource().maxzoom)&&($e=nt)}),$e&&this.options.showTileBoundaries&&om(this,$e,$e.getVisibleCoordinates(),r.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&om(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function($e){const Oe=$e.transform.padding;am($e,$e.transform.height-(Oe.top||0),3,$f),am($e,Oe.bottom||0,3,Zf),lm($e,Oe.left||0,3,Wf),lm($e,$e.transform.width-(Oe.right||0),3,Og);const nt=$e.transform.centerPoint;(function(Ze,lt,St,kt){Vd(Ze,lt-1,St-10,2,20,kt),Vd(Ze,lt-10,St-1,20,2,kt)})($e,nt.x,$e.transform.height-nt.y,Pg)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),N||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:o}=this.transform.projection,u=!o||!o.includes(t.type);if(ep[t.type]&&(u||this.terrain&&t.type==="custom")){const g=this.style.getLayerSourceCache(t);ep[t.type](t,g,this)}this.gpuTimingEnd()}renderLayer(t,o,u,g){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||g&&g.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||nl[u.type](t,o,u,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,u=this.context.gl;let g=this.gpuTimers[t.id];g||(g=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),g.calls++,u.beginQuery(o.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,o=this.context.gl,u=o.createQuery();this.deferredRenderGpuTimeQueries.push(u),o.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const o={};for(const u in t){const g=t[u],v=this.context.extTimerQuery,b=v.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(g.query),o[u]=b}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.gl;let u=0;for(const g of t)u+=o.getQueryParameter(g,o.QUERY_RESULT)/1e6,o.deleteQuery(g);return u}translatePosMatrix(t,o,u,g,v){if(!u[0]&&!u[1])return t;const b=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(b){const P=Math.sin(b),z=Math.cos(b);u=[u[0]*z-u[1]*P,u[0]*P+u[1]*z]}const E=[v?u[0]:r.ay(o,u[0],this.transform.zoom),v?u[1]:r.ay(o,u[1],this.transform.zoom),0],C=new Float32Array(16);return r.br(C,t,E),C}saveTileTexture(t){if(t.context!==this.context)return;const o=t.size[0],u=this._tileTextures[o];u?u.push(t):this._tileTextures[o]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,o,u){const g=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,v=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||g||o!==void 0&&!o||v.push("FOG","FOG_DITHERING"),g&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(t,o){this.cache=this.cache||{};const u=o&&o.defines||[],g=o&&o.config,v=this.currentGlobalDefines(t,o&&o.overrideFog,o&&o.overrideRtt).concat(u),b=Dd.cacheKey(Lf[t],t,v,g);return this.cache[b]||(this.cache[b]=new Dd(this.context,t,Lf[t],g,Bd[t],v)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,o){if(this.style.enable3dLights()){const u=this.style.directionalLight,g=this.style.ambientLight;if(u&&g){const v=((b,E,C)=>{const P=b.properties.get("direction"),z=b.properties.get("color-use-theme")==="none",U=b.properties.get("color").toNonPremultipliedRenderColor(z?null:C.getLut(b.scope)).toArray01(),N=b.properties.get("intensity"),V=E.properties.get("color-use-theme")==="none",X=E.properties.get("color").toNonPremultipliedRenderColor(V?null:C.getLut(E.scope)).toArray01(),Z=E.properties.get("intensity"),Y=[P.x,P.y,P.z],ne=r.dN(X,Z),ue=r.dN(U,N);return{u_lighting_ambient_color:ne,u_lighting_directional_dir:Y,u_lighting_directional_color:ue,u_ground_radiance:yu(Y,ue,ne)}})(u,g,this.style);o.setLightsUniformValues(t,v)}}}uploadCommonUniforms(t,o,u,g,v){if(this.uploadCommonLightUniforms(t,o),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const E=b.getOpacity(this.transform.pitch),C=((P,z,U,N,V,X,Z,Y,ne,ue,ce,ae)=>{const Ee=P.transform,xe=z.properties.get("color-use-theme")==="none",Se=z.properties.get("color").toNonPremultipliedRenderColor(xe?null:P.style.getLut(z.scope)).toArray01();Se[3]=N;const ye=P.frameCounter/1e3%1,[fe,De]=z.properties.get("vertical-range");return{u_fog_matrix:U?Ee.calculateFogTileMatrix(U):ae||P.identityMat,u_fog_range:z.getFovAdjustedRange(Ee._fov),u_fog_color:Se,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(fe,De),De],u_fog_temporal_offset:ye,u_frustum_tl:V,u_frustum_tr:X,u_frustum_br:Z,u_frustum_bl:Y,u_globe_pos:ne,u_globe_radius:ue,u_viewport:ce,u_globe_transition:r.aj(Ee.zoom),u_is_globe:+(Ee.projection.name==="globe")}})(this,b,u,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.o.devicePixelRatio,this.transform.height*r.o.devicePixelRatio],g);o.setFogUniformValues(t,C)}v&&o.setCutoffUniformValues(t,v.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,o=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const g of u)o[g.key]=t[g.key]||new Gl(g,512,this.transform.tileZoom,this,void 0,this.worldview);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,o){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[t.key];return o||(this._cachedTileFogOpacities[t.key]=o=this.style.fog.getOpacityForTile(t)),o[0]>=Zt||o[1]>=Zt}setupDepthForOcclusion(t,o,u){const g=this.context,v=g.gl,b=!!u;var E;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(v.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((E=this.depthRangeFor3D)[1]-E[0]),-1-2*E[0]/(E[1]-E[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),g.activeTexture.set(v.TEXTURE0),b||o.setTerrainUniformValues(g,u)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const t=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=t?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function ip(c,t){let o=!1,u=null;const g=()=>{u=null,o&&(c(),u=setTimeout(g,t),o=!1)};return()=>(o=!0,u||g(),u)}class fo{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ip(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const o=ym(t);if(this._hashName){const u=this._hashName;let g=!1;const v=location.hash.slice(1).split("&").map(b=>{const E=b.split("=")[0];return E===u?(g=!0,`${E}=${o}`):b}).filter(b=>b);return g||v.push(`${u}=${o}`),`#${v.join("&")}`}return`#${o}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(o=u)}),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(Number(u)))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ym(c,t){const o=c.getCenter(),u=Math.round(100*c.getZoom())/100,g=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),b=Math.round(o.lng*v)/v,E=Math.round(o.lat*v)/v,C=c.getBearing(),P=c.getPitch();let z=t?`/${b}/${E}/${u}`:`${u}/${E}/${b}`;return(C||P)&&(z+="/"+Math.round(10*C)/10),P&&(z+=`/${Math.round(P)}`),z}const sa={linearity:.3,easing:r.eT(0,0,.3,1)},kg=Object.assign({deceleration:2500,maxSpeed:1400},sa),qn=Object.assign({deceleration:20,maxSpeed:1400},sa),$i=Object.assign({deceleration:1e3,maxSpeed:360},sa),Xd=Object.assign({deceleration:1e3,maxSpeed:90},sa);class hc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=r.o.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)o.zoom+=v.zoomDelta||0,o.bearing+=v.bearingDelta||0,o.pitch+=v.pitchDelta||0,v.panDelta&&o.pan._add(v.panDelta),v.around&&(o.around=v.around),v.pinchAround&&(o.pinchAround=v.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(o.pan.mag()){const v=Ll(o.pan.mag(),u,Object.assign({},kg,t||{}));g.offset=o.pan.mult(v.amount/o.pan.mag()),g.center=this._map.transform.center,rl(g,v)}if(o.zoom){const v=Ll(o.zoom,u,qn);g.zoom=this._map.transform.zoom+v.amount,rl(g,v)}if(o.bearing){const v=Ll(o.bearing,u,$i);g.bearing=this._map.transform.bearing+r.aA(v.amount,-179,179),rl(g,v)}if(o.pitch){const v=Ll(o.pitch,u,Xd);g.pitch=this._map.transform.pitch+v.amount,rl(g,v)}if(g.zoom||g.bearing){const v=o.pinchAround===void 0?o.around:o.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function rl(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function Ll(c,t,o){const{maxSpeed:u,linearity:g,deceleration:v}=o,b=r.aA(c*g/(t/1e3),-u,u),E=Math.abs(b)/(v*g);return{easing:o.easing,duration:1e3*E,amount:b*(E/2)}}class ms extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,u,g={}){const v=Ht(o.getCanvasContainer(),u),b=o.unproject(v);super(t,Object.assign({point:v,lngLat:b,originalEvent:u},g)),this._defaultPrevented=!1,this.target=o}}class kh extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,u){const g=t==="touchend"?u.changedTouches:u.touches,v=Ei(o.getCanvasContainer(),g),b=v.map(C=>o.unproject(C)),E=v.reduce((C,P,z,U)=>C.add(P.div(U.length)),new r.P(0,0));super(t,{points:v,point:E,lngLats:b,lngLat:o.unproject(E),originalEvent:u}),this._defaultPrevented=!1}}class Yd extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class ss{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Yd(this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new ms(t.type,this._map,t))}mouseup(t){this._map.fire(new ms(t.type,this._map,t))}preclick(t){const o=new MouseEvent("preclick",t);this._map.fire(new ms(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new ms(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new ms(t.type,this._map,t))}mouseover(t){this._map.fire(new ms(t.type,this._map,t))}mouseout(t){this._map.fire(new ms(t.type,this._map,t))}touchstart(t){return this._firePreventable(new kh(t.type,this._map,t))}touchmove(t){this._map.fire(new kh(t.type,this._map,t))}touchend(t){this._map.fire(new kh(t.type,this._map,t))}touchcancel(t){this._map.fire(new kh(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ls{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new ms(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ms("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new ms(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class va{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(rt(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const u=o,g=this._startPos,v=this._lastPos;if(!g||!v||v.equals(u)||!this._box&&u.dist(g)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=he("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(g.x,u.x),E=Math.max(g.x,u.x),C=Math.min(g.y,u.y),P=Math.max(g.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${C}px)`,this._box.style.width=E-b+"px",this._box.style.height=P-C+"px")})}mouseupWindow(t,o){if(!this._active)return;const u=this._startPos,g=o;if(u&&t.button===0){if(this.reset(),Tt(),u.x!==g.x||u.y!==g.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(u,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Pt(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new r.z(t,{originalEvent:o}))}}function sl(c,t){const o={};for(let u=0;u<c.length;u++)o[c[u].identifier]=t[u];return o}class Ou{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=(function(g){const v=new r.P(0,0);for(const b of g)v._add(b);return v.div(g.length)})(o),this.touches=sl(u,o)))}touchmove(t,o,u){if(this.aborted||!this.centroid)return;const g=sl(u,o);for(const v in this.touches){const b=g[v];(!b||b.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,o,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Pu{constructor(t){this.singleTap=new Ou(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,u){this.singleTap.touchstart(t,o,u)}touchmove(t,o,u){this.singleTap.touchmove(t,o,u)}touchend(t,o,u){const g=this.singleTap.touchend(t,o,u);if(g){const v=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(g)<30;if(v&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class zu{constructor(){this._zoomIn=new Pu({numTouches:1,numTaps:2}),this._zoomOut=new Pu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,u){this._zoomIn.touchstart(t,o,u),this._zoomOut.touchstart(t,o,u)}touchmove(t,o,u){this._zoomIn.touchmove(t,o,u),this._zoomOut.touchmove(t,o,u)}touchend(t,o,u){const g=this._zoomIn.touchend(t,o,u),v=this._zoomOut.touchend(t,o,u);return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(g)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const np=0,ol=2,rp={[np]:1,[ol]:2},xa={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class $c{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;const u=rn(t);this._correctButton(t,u)&&(this._lastPoint=o,this._eventButton=u)}mousemoveWindow(t,o){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&(function(g,v){const b=rp[v];return g.buttons===void 0||(g.buttons&b)!==b})(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(u,o)}}mouseupWindow(t){this._lastPoint&&rn(t)===this._eventButton&&(this._moved&&Tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bh extends $c{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class Kd extends $c{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?xa[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const u=.8*(o.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Jd extends $c{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?xa[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const u=-.5*(o.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Kr{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),r.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,o,u){return this._calculateTransform(t,o,u)}touchmove(t,o,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!r.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,u)}}touchend(t,o,u){this._calculateTransform(t,o,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,u){u.length>0&&(this._active=!0);const g=sl(u,o),v=new r.P(0,0),b=new r.P(0,0);let E=0;for(const P in g){const z=g[P],U=this._touches[P];U&&(v._add(z),b._add(z.sub(U)),E++,g[P]=z)}if(this._touches=g,E<this._minTouches||!b.mag())return;const C=b.div(E);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(E),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=he("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Lu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,u){return{}}touchstart(t,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,u){const g=this._firstTwoTouches;if(!g)return;t.preventDefault();const[v,b]=g,E=Zc(u,o,v),C=Zc(u,o,b);if(!E||!C)return;const P=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],P,t)}touchend(t,o,u){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,b=Zc(u,o,g),E=Zc(u,o,v);b&&E||(this._active&&Tt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zc(c,t,o){for(let u=0;u<c.length;u++)if(c[u].identifier===o)return t[u]}function Fh(c,t){return Math.log2(c/t)}class Wc extends Lu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Fh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Fh(this._distance,u),pinchAround:o}}}function Nh(c,t){return 180*c.angleWith(t)/Math.PI}class jh extends Lu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Nh(this._vector,u),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const g=Nh(t,u);return Math.abs(g)<o}}function ku(c){return Math.abs(c.y)>Math.abs(c.x)}class Xc extends Lu{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,ku(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,u){const g=this._lastPoints;if(!g)return;const v=t[0].sub(g[0]),b=t[1].sub(g[1]);return this._map._cooperativeGestures&&!r.eU()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(v,b,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5})}gestureBeginsVertically(t,o,u){if(this._valid!==void 0)return this._valid;const g=t.mag()>=2,v=o.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const b=t.y>0==o.y>0;return ku(t)&&ku(o)&&b}}const Qd={panStep:100,bearingStep:15,pitchStep:10};class Uh{constructor(){const t=Qd;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,u=0,g=0,v=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(u=0,g=0),{cameraAnimation:E=>{const C=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:al,zoom:o?Math.round(C)+o*(t.shiftKey?2:1):C,bearing:E.getBearing()+u*this._bearingStep,pitch:E.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-b*this._panStep],center:E.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function al(c){return c*(2-c)}const Bu=4.000244140625,vm=1/450;class ef{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=vm,r.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=r.o.now(),g=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Bu===0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Ht(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Bu?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&z!==0&&(z=1/z);const U=o(),N=Math.pow(2,U),V=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(V*z))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:o(),g=this._startZoom,v=this._easing;let b,E=!1;if(this._type==="wheel"&&g&&v){const P=Math.min((r.o.now()-this._lastWheelEventTime)/200,1),z=v(P);b=r.ak(g,u,z),P<1?this._frameId||(this._frameId=!0):E=!0}else b=u,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=b-o();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=r.eV;if(this._prevEase){const u=this._prevEase,g=(r.o.now()-u.start)/u.duration,v=u.easing(g+.01)-u.easing(g),b=.27/Math.sqrt(v*v+1e-4)*.01,E=Math.sqrt(.0729-b*b);o=r.eT(b,E,.25,1)}return this._prevEase={start:r.o.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=he("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class kl{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class sp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xm{constructor(){this._tap=new Pu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=o[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,o,u))}touchmove(t,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const g=o[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,o,u)}touchend(t,o,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,o,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tf{constructor(t,o,u){this._el=t,this._mousePan=o,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vh{constructor(t,o,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class qr{constructor(t,o,u,g){this._el=t,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const nf=c=>c.zoom||c.drag||c.pitch||c.rotate;class Bg extends r.z{}class bm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){const u=r.av([],o,t);this.radius=r.ag(u[2]<0?r.eX([],u,this.constants):[u[0],u[1],0])}projectRay(t){r.eX(t,t,this.constants),r.aw(t,t),r.eY(t,t,this.constants);const o=r.c5([],t,this.radius);if(o[2]>0){const u=r.c5([],[0,0,1],r.bJ(o,[0,0,1])),g=r.c5([],r.aw([],[o[0],o[1],0]),this.radius),v=r.d8([],o,r.c5([],r.av([],r.d8([],g,u),o),2));o[0]=v[0],o[1]=v[1]}return o}}function dc(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class fc{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hc(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new bm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),r.aY(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,v,b]of this._listeners){const E=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(v,E,b)}}destroy(){for(const[t,o,u]of this._listeners){const g=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(o,g,u)}}_addDefaultHandlers(t){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new ss(o,t));const g=o.boxZoom=new va(o,t);this._add("boxZoom",g);const v=new zu,b=new sp;o.doubleClickZoom=new kl(b,v),this._add("tapZoom",v),this._add("clickZoom",b);const E=new xm;this._add("tapDragZoom",E);const C=o.touchPitch=new Xc(o);this._add("touchPitch",C);const P=new Kd(t),z=new Jd(t);o.dragRotate=new Vh(t,P,z),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const U=new Bh(t),N=new Kr(o,t);o.dragPan=new tf(u,U,N),this._add("mousePan",U),this._add("touchPan",N,["touchZoom","touchRotate"]);const V=new jh,X=new Wc;o.touchZoomRotate=new qr(u,X,V,E),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ls(o));const Z=o.scrollZoom=new ef(o,this);this._add("scrollZoom",Z,["mousePan"]);const Y=o.keyboard=new Uh;this._add("keyboard",Y);for(const ne of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ne]&&o[ne].enable(t[ne])}_add(t,o,u){this._handlers.push({handlerName:t,handler:o,allowed:u}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!nf(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,o,u){for(const g in t)if(g!==u&&(!o||o.indexOf(g)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const o=[];for(const u of t)this._el.contains(u.target)&&o.push(u);return o}handleEvent(t,o){this._updatingCamera=!0;const u=t.type==="renderFrame",g=u?void 0:t,v={needsRenderFrame:!1},b={},E={},C=t.touches?this._getMapTouches(t.touches):void 0,P=C?Ei(this._el,C):u?void 0:Ht(this._el,t);for(const{handlerName:N,handler:V,allowed:X}of this._handlers){if(!V.isEnabled())continue;let Z;this._blockedByActive(E,X,N)?V.reset():V[o||t.type]&&(Z=V[o||t.type](t,P,C),this.mergeHandlerResult(v,b,Z,N,g),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||V.isActive())&&(E[N]=V)}const z={};for(const N in this._previousActiveHandlers)E[N]||(z[N]=g);this._previousActiveHandlers=E,(Object.keys(z).length||dc(v))&&(this._changes.push([v,b,z]),this._triggerRenderFrame()),(Object.keys(E).length||dc(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=v;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(t,o,u,g,v){if(!u)return;Object.assign(t,u);const b={handlerName:g,originalEvent:u.originalEvent||v};u.zoomDelta!==void 0&&(o.zoom=b),u.panDelta!==void 0&&(o.drag=b),u.pitchDelta!==void 0&&(o.pitch=b),u.bearingDelta!==void 0&&(o.rotate=b)}_applyChanges(){const t={},o={},u={};for(const[g,v,b]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.aroundCoord!==void 0&&(t.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),Object.assign(o,v),Object.assign(u,b);this._updateMapTransform(t,o,u),this._changes=[]}_updateMapTransform(t,o,u){const g=this._map,v=g.transform,b=ue=>[ue.x,ue.y,ue.z];if((()=>{const ue=this._eventsInProgress.drag;return ue&&!this._handlersById[ue.handlerName].isActive()})()&&!dc(t)){const ue=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),ue!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&g._stop(!0),!dc(t))return void this._fireEvents(o,u,!0);let{panDelta:E,zoomDelta:C,bearingDelta:P,pitchDelta:z,around:U,aroundCoord:N,pinchAround:V}=t;v._isCameraConstrained&&(C>0&&(C=0),v._isCameraConstrained=!1),V!==void 0&&(U=V),(C||(ue=>o[ue]&&!this._eventsInProgress[ue])("drag"))&&U&&(this._dragOrigin=b(v.pointCoordinate3D(U)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",g._stop(!0),U=U||g.transform.centerPoint,P&&(v.bearing+=P),z&&(v.pitch+=z),v._updateCameraState();const X=[0,0,0];if(E)if(v.projection.name==="mercator"){const ue=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U).dir),ce=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U.sub(E)).dir);X[0]=ce[0]-ue[0],X[1]=ce[1]-ue[1]}else{const ue=v.pointCoordinate(U);if(v.projection.name==="globe"){E=E.rotate(-v.angle);const ce=v._pixelsPerMercatorPixel/v.worldSize;X[0]=-E.x*r.eW(r.a$(ue.y))*ce,X[1]=-E.y*r.eW(v.center.lat)*ce}else{const ce=v.pointCoordinate(U.sub(E));ue&&ce&&(X[0]=ce.x-ue.x,X[1]=ce.y-ue.y)}}const Z=v.zoom,Y=[0,0,0];if(C){const ue=b(N||v.pointCoordinate3D(U)),ce={dir:r.aw([],r.av([],ue,v._camera.position))};if(ce.dir[2]<0){const ae=v.zoomDeltaToMovement(ue,C);r.c5(Y,ce.dir,ae)}}const ne=r.d8(X,X,Y);v._translateCameraConstrained(ne),C&&Math.abs(v.zoom-Z)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,u,!0)}_fireEvents(t,o,u){const g=nf(this._eventsInProgress),v=nf(t),b={};for(const z in t){const{originalEvent:U}=t[z];this._eventsInProgress[z]||(b[`${z}start`]=U),this._eventsInProgress[z]=t[z]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const z in b)this._fireEvent(z,b[z]);v&&this._fireEvent("move",v.originalEvent);for(const z in t){const{originalEvent:U}=t[z];this._fireEvent(z,U)}const E={};let C;for(const z in this._eventsInProgress){const{handlerName:U,originalEvent:N}=this._eventsInProgress[z];this._handlersById[U].isActive()||(delete this._eventsInProgress[z],C=o[U]||N,E[`${z}end`]=C)}for(const z in E)this._fireEvent(z,E[z]);const P=nf(this._eventsInProgress);if(u&&(g||v)&&!P){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;z?(U(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:C})):(this._map.fire(new r.z("moveend",{originalEvent:C})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new r.z(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Bg("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const op="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class wm extends r.E{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,r.aY(["_renderFrameCallback"],this)}getCenter(){return new r.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,u){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},o),u)}panTo(t,o,u){return this.easeTo(Object.assign({center:t},o),u)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,u){return this.easeTo(Object.assign({zoom:t},o),u)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,u){return this.easeTo(Object.assign({bearing:t},o),u)}resetNorth(t,o){return this.rotateTo(0,Object.assign({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=r.aI.convert(t);const u=o&&o.bearing||0,g=o&&o.pitch||0,v=t.getNorthWest(),b=t.getSouthEast();return this._cameraForBounds(this.transform,v,b,u,g,o)}_extendPadding(t){const o={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},o,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},o,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,o){const u=o.max[0]-o.min[0],g=o.max[1]-o.min[1];return u/g>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):g/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,u,g,v,b){const E=t.clone(),C=this._extendCameraOptions(b);E.bearing=g,E.pitch=v;const P=r.aT.convert(o),z=r.aT.convert(u),U=.5*(P.lat+z.lat),N=.5*(P.lng+z.lng),V=r.eZ(U,N),X=r.aw([],V),Z=r.aw([],r.bI([],X,[0,1,0])),Y=r.bI([],Z,X),ne=[Z[0],Z[1],Z[2],0,Y[0],Y[1],Y[2],0,X[0],X[1],X[2],0,0,0,0,1],ue=[V,r.eZ(P.lat,P.lng),r.eZ(z.lat,P.lng),r.eZ(z.lat,z.lng),r.eZ(P.lat,z.lng),r.eZ(U,P.lng),r.eZ(U,z.lng),r.eZ(P.lat,N),r.eZ(z.lat,N)];let ce=r.d9.fromPoints(ue.map(Ze=>[r.bJ(Z,Ze),r.bJ(Y,Ze),r.bJ(X,Ze)]));const ae=r.af([],ce.center,ne);r.e_(ae)===0&&r.e$(ae,0,0,1),r.aw(ae,ae),r.c5(ae,ae,r.aD),E.center=r.f0(ae);const Ee=E.getWorldToCameraMatrix(),xe=r.bl(new Float64Array(16),Ee);ce=r.d9.applyTransform(ce,r.aB([],Ee,ne));const Se=this._extendAABB(ce,E,C,g);if(!Se)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=Se,r.af(ae,ae,Ee);const ye=.5*(ce.max[2]-ce.min[2]),fe=this._minimumAABBFrustumDistance(E,ce),De=r.c5([],[0,0,1],ye),Pe=r.d8(De,ae,De),Be=fe+(E.pitch===0?0:r.bG(ae,Pe)),He=E.globeCenterInViewSpace,Ve=r.av([],ae,[He[0],He[1],He[2]]);r.aw(Ve,Ve),r.c5(Ve,Ve,Be);const Qe=r.d8([],ae,Ve);r.af(Qe,Qe,xe);const ct=r.eM/r.aD,$e=r.ag(Qe),Oe=r.cf(Math.max($e*ct-r.eM,Number.EPSILON),0),nt=Math.min(E.zoomFromMercatorZAdjusted(Oe),C.maxZoom);return nt>.5*(r.c_+r.cL)?(E.setProjection({name:"mercator"}),E.zoom=nt,this._cameraForBounds(E,o,u,g,v,b)):{center:E.center,zoom:nt,bearing:g,pitch:v}}_extendAABB(t,o,u,g){const v=.5*((u.padding.left||0)+(u.padding.right||0)),b=.5*((u.padding.top||0)+(u.padding.bottom||0)),E=b,C=v,P=v,z=b,U=o.width-(C+P),N=o.height-(E+z),V=r.av([],t.max,t.min),X=Math.min(U/V[0],N/V[1]),Z=Math.min(o.scaleZoom(o.scale*X),u.maxZoom);if(isNaN(Z))return null;const Y=o.scale/o.zoomScale(Z),ne=new r.d9([t.min[0]-C*Y,t.min[1]-z*Y,t.min[2]],[t.max[0]+P*Y,t.max[1]+E*Y,t.max[2]]),ue=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new r.P(u.offset.x,u.offset.y):r.P.convert(u.offset)).rotate(-r.an(g));return ne.center[0]-=ue.x*Y,ne.center[1]+=ue.y*Y,ne}queryTerrainElevation(t,o){const u=this.transform.elevation;return u?(o=Object.assign({},{exaggerated:!0},o),u.getAtPoint(r.ae.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,u,g,v,b){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,o,u,g,v,b);const E=t.clone(),C=this._extendCameraOptions(b);E.bearing=g,E.pitch=v;const P=r.aT.convert(o),z=r.aT.convert(u),U=new r.aT(P.lng,z.lat),N=new r.aT(z.lng,P.lat),V=E.project(P),X=E.project(z),Z=this.queryTerrainElevation(P),Y=this.queryTerrainElevation(z),ne=this.queryTerrainElevation(U),ue=this.queryTerrainElevation(N),ce=[[V.x,V.y,Math.min(Z||0,Y||0,ne||0,ue||0)],[X.x,X.y,Math.max(Z||0,Y||0,ne||0,ue||0)]];let ae=r.d9.fromPoints(ce);const Ee=E.getWorldToCameraMatrix(),xe=r.bl(new Float64Array(16),Ee);ae=r.d9.applyTransform(ae,Ee);const Se=this._extendAABB(ae,E,C,g);if(!Se)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=Se;const ye=.5*r.av([],ae.max,ae.min)[2],fe=this._minimumAABBFrustumDistance(E,ae),De=[0,0,1,0];r.aC(De,De,Ee),r.f1(De,De);const Pe=r.c5([],De,fe+ye),Be=r.d8([],ae.center,Pe);r.af(ae.center,ae.center,xe),r.af(Be,Be,xe);const He=E.unproject(new r.P(ae.center[0],ae.center[1])),Ve=r.f2(E.projection,He),Qe=Math.pow(2,Ve),ct=Math.min(E._zoomFromMercatorZ(Be[2]*E.pixelsPerMeter*Qe/E.worldSize),C.maxZoom);return E.mercatorFromTransition&&ct<.5*(r.c_+r.cL)?(E.setProjection({name:"globe"}),E.zoom=ct,this._cameraForBounds(E,o,u,g,v,b)):{center:He,zoom:ct,bearing:g,pitch:v}}fitBounds(t,o,u){const g=this.cameraForBounds(t,o);return this._fitInternal(g,o,u)}fitScreenCoordinates(t,o,u,g,v){const b=r.P.convert(t),E=r.P.convert(o),C=new r.P(Math.min(b.x,E.x),Math.min(b.y,E.y)),P=new r.P(Math.max(b.x,E.x),Math.max(b.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,E))return this;const z=this.transform.pointLocation3D(C),U=this.transform.pointLocation3D(P),N=this.transform.pointLocation3D(new r.P(C.x,P.y)),V=this.transform.pointLocation3D(new r.P(P.x,C.y)),X=[Math.min(z.lng,U.lng,N.lng,V.lng),Math.min(z.lat,U.lat,N.lat,V.lat)],Z=[Math.max(z.lng,U.lng,N.lng,V.lng),Math.max(z.lat,U.lat,N.lat,V.lat)],Y=g&&g.pitch?g.pitch:this.getPitch(),ne=this._cameraForBounds(this.transform,X,Z,u,Y,g);return this._fitInternal(ne,g,v)}_fitInternal(t,o,u){return t?(o=Object.assign(t,o)).linear?this.easeTo(o,u):this.flyTo(o,u):this}jumpTo(t,o){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let g=!1,v=!1,b=!1;"zoom"in t&&u.zoom!==+t.zoom&&(g=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=r.aT.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(v=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(b=!0,u.pitch=+t.pitch);const E=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(E))if(t.retainPadding===!1){const C=u.clone();C.padding=E,u.setLocationAtPoint(u.center,C.centerPoint)}else u.padding=E;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new r.z("movestart",o)).fire(new r.z("move",o)),g&&this.fire(new r.z("zoomstart",o)).fire(new r.z("zoom",o)).fire(new r.z("zoomend",o)),v&&this.fire(new r.z("rotatestart",o)).fire(new r.z("rotate",o)).fire(new r.z("rotateend",o)),b&&this.fire(new r.z("pitchstart",o)).fire(new r.z("pitch",o)).fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(op),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){const u=this.transform;if(!u.projection.supportsFreeCamera)return r.w(op),this;this.stop();const g=u.zoom,v=u.pitch,b=u.bearing;u.setFreeCameraOptions(t);const E=g!==u.zoom,C=v!==u.pitch,P=b!==u.bearing;return this.fire(new r.z("movestart",o)).fire(new r.z("move",o)),E&&this.fire(new r.z("zoomstart",o)).fire(new r.z("zoom",o)).fire(new r.z("zoomend",o)),P&&this.fire(new r.z("rotatestart",o)).fire(new r.z("rotate",o)).fire(new r.z("rotateend",o)),C&&this.fire(new r.z("pitchstart",o)).fire(new r.z("pitch",o)).fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:r.eV},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,g=this.getZoom(),v=this.getBearing(),b=this.getPitch(),E=this.getPadding(),C="zoom"in t?+t.zoom:g,P="bearing"in t?this._normalizeBearing(t.bearing,v):v,z="pitch"in t?+t.pitch:b,U=this._extendPadding(t.padding),N=r.P.convert(t.offset);let V,X,Z;if(u.projection.name==="globe"){const De=r.ae.fromLngLat(u.center),Pe=N.rotate(-u.angle);De.x+=Pe.x/u.worldSize,De.y+=Pe.y/u.worldSize;const Be=De.toLngLat(),He=r.aT.convert(t.center||Be);this._normalizeCenter(He),V=u.centerPoint.add(Pe),X=new r.P(De.x,De.y).mult(u.worldSize),Z=new r.P(r.aF(He.lng),r.aJ(He.lat)).mult(u.worldSize).sub(X)}else{V=u.centerPoint.add(N);const De=u.pointLocation(V),Pe=r.aT.convert(t.center||De);this._normalizeCenter(Pe),X=u.project(De),Z=u.project(Pe).sub(X)}const Y=u.zoomScale(C-g);let ne,ue;t.around&&(ne=r.aT.convert(t.around),ue=u.locationPoint(ne));const ce=this._zooming||C!==g,ae=this._rotating||v!==P,Ee=this._pitching||z!==b,xe=!u.isPaddingEqual(U),Se=t.retainPadding===!1?u.clone():u,ye=De=>Pe=>{if(ce&&(De.zoom=r.ak(g,C,Pe)),ae&&(De.bearing=r.ak(v,P,Pe)),Ee&&(De.pitch=r.ak(b,z,Pe)),xe&&(Se.interpolatePadding(E,U,Pe),V=Se.centerPoint.add(N)),ne)De.setLocationAtPoint(ne,ue);else{const Be=De.zoomScale(De.zoom-g),He=C>g?Math.min(2,Y):Math.max(.5,Y),Ve=Math.pow(He,1-Pe),Qe=De.unproject(X.add(Z.mult(Pe*Ve)).mult(Be));De.setLocationAtPoint(De.renderWorldCopies?Qe.wrap():Qe,V)}return t.preloadOnly||this._fireMoveEvents(o),De};if(t.preloadOnly){const De=this._emulate(ye,t.duration,u);return this._preloadTiles(De),this}const fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ce,this._rotating=ae,this._pitching=Ee,this._padding=xe,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,fe),this._ease(ye(u),De=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(o,De)},t),this}_prepareEase(t,o,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||u.moving||this.fire(new r.z("movestart",t)),this._zooming&&!u.zooming&&this.fire(new r.z("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new r.z("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new r.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.z("move",t)),this._zooming&&this.fire(new r.z("zoom",t)),this._rotating&&this.fire(new r.z("rotate",t)),this._pitching&&this.fire(new r.z("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new r.z("zoomend",t)),g&&this.fire(new r.z("rotateend",t)),v&&this.fire(new r.z("pitchend",t)),this.fire(new r.z("moveend",t))}flyTo(t,o){if(this._prefersReducedMotion(t)){const Ze=r.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ze,o)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:r.eV},t);const u=this.transform,g=this.getZoom(),v=this.getBearing(),b=this.getPitch(),E=this.getPadding(),C="zoom"in t?r.aA(+t.zoom,u.minZoom,u.maxZoom):g,P="bearing"in t?this._normalizeBearing(t.bearing,v):v,z="pitch"in t?+t.pitch:b,U=this._extendPadding(t.padding),N=u.zoomScale(C-g),V=r.P.convert(t.offset);let X=u.centerPoint.add(V);const Z=u.pointLocation(X),Y=r.aT.convert(t.center||Z);this._normalizeCenter(Y);const ne=u.project(Z),ue=u.project(Y).sub(ne);let ce=t.curve;const ae=Math.max(u.width,u.height),Ee=ae/N,xe=ue.mag();if("minZoom"in t){const Ze=r.aA(Math.min(t.minZoom,g,C),u.minZoom,u.maxZoom),lt=ae/u.zoomScale(Ze-g);ce=Math.sqrt(lt/xe*2)}const Se=ce*ce;function ye(Ze){const lt=(Ee*Ee-ae*ae+(Ze?-1:1)*Se*Se*xe*xe)/(2*(Ze?Ee:ae)*Se*xe);return Math.log(Math.sqrt(lt*lt+1)-lt)}function fe(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function De(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Pe=ye(0);let Be=function(Ze){return De(Pe)/De(Pe+ce*Ze)},He=function(Ze){return ae*((De(Pe)*(fe(lt=Pe+ce*Ze)/De(lt))-fe(Pe))/Se)/xe;var lt},Ve=(ye(1)-Pe)/ce;if(Math.abs(xe)<1e-6||!isFinite(Ve)){if(Math.abs(ae-Ee)<1e-6)return this.easeTo(t,o);const Ze=Ee<ae?-1:1;Ve=Math.abs(Math.log(Ee/ae))/ce,He=function(){return 0},Be=function(lt){return Math.exp(Ze*ce*lt)}}t.duration="duration"in t?+t.duration:1e3*Ve/("screenSpeed"in t?+t.screenSpeed/ce:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Qe=v!==P,ct=z!==b,$e=!u.isPaddingEqual(U),Oe=t.retainPadding===!1?u.clone():u,nt=Ze=>lt=>{const St=lt*Ve,kt=1/Be(St);Ze.zoom=lt===1?C:g+Ze.scaleZoom(kt),Qe&&(Ze.bearing=r.ak(v,P,lt)),ct&&(Ze.pitch=r.ak(b,z,lt)),$e&&(Oe.interpolatePadding(E,U,lt),X=Oe.centerPoint.add(V));const Ct=lt===1?Y:Ze.unproject(ne.add(ue.mult(He(St))).mult(kt));return Ze.setLocationAtPoint(Ze.renderWorldCopies?Ct.wrap():Ct,X),Ze._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),Ze};if(t.preloadOnly){const Ze=this._emulate(nt,t.duration,u);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=Qe,this._pitching=ct,this._padding=$e,this._prepareEase(o,!1),this._ease(nt(u),()=>this._afterEase(o),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,o)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,o,u){u.animate===!1||u.duration===0?(t(1),o()):(this._easeStart=r.o.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.o.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=r.bT(t,-180,180);const u=Math.abs(t-o);return Math.abs(t-360-o)<u&&(t-=360),Math.abs(t+360-o)<u&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const u=t.lng-o.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,o,u){const g=Math.ceil(15*o/1e3),v=[],b=t(u.clone());for(let E=0;E<=g;E++){const C=b(E/g);v.push(C.clone())}return v}_preloadTiles(t,o){}}class Gh{constructor(t={}){this.options=t,r.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const o=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=he("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const g=he("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",u),this._innerContainer=he("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const u=o.reduce((g,v,b)=>(v.value&&(g+=`${v.key}=${v.value}${b<o.length-1?"&":""}`),g),"?");t.href=`${r.e.FEEDBACK_URL}/${u}#${ym(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const o=this._map.style._mergedSourceCaches;for(const g in o){const v=o[g];if(v.used){const b=v.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t.sort((g,v)=>g.length-v.length),t=t.filter((g,v)=>{for(let b=v+1;b<t.length;b++)if(t[b].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.map(g=>(function(v){const b=new DOMParser().parseFromString(v,"text/html");return Array.from(b.body.querySelectorAll("*")).reverse().forEach(E=>{const C=E.textContent||"";if(E.tagName!=="A")return void E.replaceWith(...E.childNodes);const P=E.getAttribute("href");if(!P||!/^(https?:|mailto:)/i.test(P))return void E.replaceWith(b.createTextNode(C));const z=b.createElement("a");z.href=P,z.textContent=C,z.rel="noopener nofollow";const U=E.getAttribute("class");U&&(z.className=U),E.replaceWith(z)}),b.body.innerHTML})(g)).join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ll{constructor(){r.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=he("div","mapboxgl-ctrl");const o=he("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const o in t){const u=t[o].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Tm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const g of u)if(g.id===t)return void(g.cancelled=!0)}run(t=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Wn{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const o=r.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,u){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+u}}const Sm={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ap extends r.z{constructor(t,o,u,g){const{point:v,lngLat:b,originalEvent:E,target:C}=t;super(t.type,{point:v,lngLat:b,originalEvent:E,target:C}),this.preventDefault=()=>{t.preventDefault()},this.id=o,this.interaction=u,this.feature=g}}class Em{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,o){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=o.filter;let g=o.type;u&&this.filters.set(t,r.b6(u)),g==="mouseover"&&(g="mouseenter"),g==="mouseout"&&(g="mouseleave");const v=this.interactionsByType.get(g)||new Map;g==="mouseenter"||g==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,o)):v.size===0&&this.map.on(g,this.handleType),v.size===0&&this.interactionsByType.set(g,v),v.set(t,o),this.typeById.set(t,g)}get(t){const o=this.typeById.get(t);if(!o)return;const u=this.interactionsByType.get(o);return u?u.get(t):void 0}remove(t){const o=this.typeById.get(t);if(!o)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(o);u&&(u.delete(t),o==="mouseenter"||o==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(o,this.handleType))}queryTargets(t,o){const u=[];for(const[g,v]of o)v.target&&u.push({targetId:g,target:v.target,filter:this.filters.get(g)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const o=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());o.length&&(t.type="mouseenter",this.handleType(t,o));const u=new Map;for(const[g,{feature:v}]of this.prevHoveredFeatures)this.hoveredFeatures.has(g)||u.set(v.id,v);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const o=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);o.length&&(t.type="mouseleave",this.handleType(t,o)),this.hoveredFeatures.clear()}handleType(t,o){const u=t.type==="mouseenter";if(u&&!this.interactionsByType.has(t.type))return void r.w("mouseenter interaction required for mouseleave to work.");const g=Array.from(this.interactionsByType.get(t.type)).reverse(),v=!!o;o=o||this.queryTargets(t.point,g);let b=!1;const E=new Set;for(const C of o){for(const[P,z]of g){if(!z.target)continue;const U=C.variants?C.variants[P]:null;if(U){for(const N of U){if(rh(N,C,E,P))continue;const V=new r.dx(C,N),X=Qo(N,C,P);v&&V.id!==void 0&&(V.state=this.map.getFeatureState(V));const Z=u?this.prevHoveredFeatures.get(X):null,Y=new ap(t,P,z,V),ne=Z?Z.stop:z.handler(Y);if(u&&this.hoveredFeatures.set(X,{feature:C,stop:ne}),ne!==!1){b=!0;break}}if(b)break}}if(b)break}if(!b)for(const[C,P]of g){const{handler:z,target:U}=P;if(!U&&z(new ap(t,C,P,null))!==!1)break}}}function lp(c,t){if(Array.isArray(c)&&Array.isArray(t)){const o=new Set(c),u=new Set(t);return o.size===u.size&&c.every(g=>u.has(g))}return r.by(c,t)}const qh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Bl={showCompass:!0,showZoom:!0,visualizePitch:!1};class os{constructor(t,o,u=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Kd({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new Jd({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),rt()}move(t,o){const u=this.map,g=this.mouseRotate.mousemoveWindow(t,o),v=g&&g.bearingDelta;if(v&&u.setBearing(u.getBearing()+v),this.mousePitch){const b=this.mousePitch.mousemoveWindow(t,o),E=b&&b.pitchDelta;E&&u.setPitch(u.getPitch()+E)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Pt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Ht(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Ht(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ei(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Ei(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Fu(c,t,o){if(c=new r.aT(c.lng,c.lat),t){const u=new r.aT(c.lng-360,c.lat),g=new r.aT(c.lng+360,c.lat),v=360*Math.ceil(Math.abs(c.lng-o.center.lng)/360),b=o.locationPoint3D(c).distSqr(t),E=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint3D(u).distSqr(t)<b&&(E||Math.abs(u.lng-o.center.lng)<v)?c=u:o.locationPoint3D(g).distSqr(t)<b&&(E||Math.abs(g.lng-o.center.lng)<v)&&(c=g)}for(;Math.abs(c.lng-o.center.lng)>180;){const u=o.locationPoint3D(c);if(u.x>=0&&u.y>=0&&u.x<=o.width&&u.y<=o.height)break;c.lng>o.center.lng?c.lng-=360:c.lng+=360}return c}const Na={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Er={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Hr extends r.E{constructor(t,o){super(),(t instanceof HTMLElement||o)&&(t=Object.assign({element:t},o)),r.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:u="center",color:g="#3FB1CE",scale:v=1,draggable:b=!1,clickTolerance:E=0,rotation:C=Er.rotation,rotationAlignment:P=Er.rotationAlignment,pitchAlignment:z=Er.pitchAlignment,occludedOpacity:U=Er.occludedOpacity,altitude:N=Er.altitude}=t||{};this._anchor=u,this._color=g,this._scale=v,this._draggable=b,this._clickTolerance=E,this._rotation=C,this._rotationAlignment=P,this._pitchAlignment=z,this._occludedOpacity=U,this._altitude=N,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Z=>{Z.preventDefault()}),this._element.addEventListener("mousedown",Z=>{Z.preventDefault()});const V=this._element.classList;for(const Z in Na)V.remove(`mapboxgl-marker-anchor-${Z}`);V.add(`mapboxgl-marker-anchor-${this._anchor}`);const X=t&&t.className?t.className.trim().split(/\s+/):[];V.add(...X),this._popup=null}_createDefaultMarker(){const t=he("div"),o=Re("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const u=Re("radialGradient",{id:"shadowGradient"},Re("defs",{},o));Re("stop",{offset:"10%","stop-opacity":.4},u),Re("stop",{offset:"100%","stop-opacity":.05},u),Re("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},o)}return Re("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},o),Re("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},o),Re("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},o),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Er.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const o=t.code,u=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const o=t.originalEvent.target,u=this._element;this._popup&&(o===u||u.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,o=this._pos;if(!t||!o)return!1;const u=t.unproject(o,this._altitude),g=t.getFreeCameraOptions();if(!g.position)return!1;const v=g.position.toLngLat();return v.distanceTo(u)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(o,this._altitude);let g;t._showingGlobe()&&r.f5(t.transform,this._lngLat)?g=0:(g=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Na[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const t=this._pos,o=this._map,u=this.getPitchAlignment();if(!o||!t||u!=="map")return"";if(!o._showingGlobe()){const C=o.getPitch();return C?`rotateX(${C}deg)`:""}const g=r.cX(r.f6(o.transform,this._lngLat)),v=t.sub(r.f7(o.transform)),b=Math.abs(v.x)+Math.abs(v.y);if(b===0)return"";const E=g/b;return`rotateX(${-v.y*E}deg) rotateY(${v.x*E}deg)`}_calculateZTransform(){const t=this._pos,o=this._map;if(!o||!t)return"";let u=0;const g=this.getRotationAlignment();if(g==="map")if(o._showingGlobe()){const v=o.project(new r.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),b=o.project(new r.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(v);u=r.cX(Math.atan2(b.y,b.x))-90}else u=-o.getBearing();else if(g==="horizon"){const v=r.ah(4,6,o.getZoom()),b=r.f7(o.transform);b.y+=v*o.transform.height;const E=t.sub(b),C=r.cX(Math.atan2(E.y,E.x));u=(C>90?C-270:C+90)*(1-v)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Fu(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const o=this._map;if(!o)return;const u=this._pointerdownPos,g=this._positionDelta;if(u&&g){if(!this._isDragging){const v=this._clickTolerance||o._clickTolerance;if(t.point.dist(u)<v)return;this._isDragging=!0}this._pos=t.point.sub(g),this._lngLat=o.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(t){const o=this._map,u=this._pos;o&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Er.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Er.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Er.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Er.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const oa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1,showButton:!0,followUserLocation:!0},Hh={maxWidth:100,unit:"metric"},Lr={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Fo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},pc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nu(c=new r.P(0,0),t="bottom"){if(typeof c=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new r.P(0,c);case"top-left":return new r.P(o,o);case"top-right":return new r.P(-o,o);case"bottom":return new r.P(0,-c);case"bottom-left":return new r.P(o,-o);case"bottom-right":return new r.P(-o,-o);case"left":return new r.P(c,0);case"right":return new r.P(-c,0)}return new r.P(0,0)}return c instanceof r.P||Array.isArray(c)?r.P.convert(c):r.P.convert(c[t]||[0,0])}return{version:q,supported:Ae.supported,setRTLTextPlugin:r.fb,getRTLTextPluginStatus:r.fa,Map:class extends wm{constructor(c){ie.mark(H.create);const t=c;if((c=Object.assign({},qh,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&r.f3(window)&&(c.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new _d(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies,null,null),c),this._repaint=!!c.repaint,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new Tm,this._domRenderTaskQueue=new Tm,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.b2(),this._locale=Object.assign({},Sm,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._tessellationStep=c.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=c.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Wn(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=c.scaleFactor,this._requestManager=new Ji(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?Object.assign({},c.contextCreateOptions):{},typeof c.container=="string"){const o=document.getElementById(c.container);if(!o)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=o}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),this._spriteFormat=c.spriteFormat,r.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new fc(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||r.e.DEFAULT_STYLE,{config:c.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),c.hash&&(this._hash=new fo(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});const o=c.bounds;o&&(this.resize(),this.fitBounds(o,Object.assign({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new Gh({customAttribution:c.customAttribution})),this._logoControl=new ll,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new r.z(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new r.z(`${o.dataType}dataloading`,o))}),this._interactions=new Em(this)}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=c.onAdd(this);this._controls.push(c);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.z("movestart",c)).fire(new r.z("move",c)),this.fire(new r.z("resize",c)),t&&this.fire(new r.z("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(r.aI.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(c){return this._scaleFactor=c,this.painter.scaleFactor=c,this.style&&this.style._setLabelPlacementStale(),this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(t=>t==="auto"?navigator.language:t):c}setLanguage(c){const t=this._parseLanguage(c);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,t=c.projection.name;let o;t==="globe"&&c.zoom>=r.cL?(c.setMercatorFromTransition(),o=!0):t==="mercator"&&c.zoom<r.cL&&(c.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(c,t){return this._updateProjection(c||t||{name:"mercator"})}_updateProjection(c){let t;const o=this.transform.mercatorFromTransition;t=c.name==="globe"&&this.transform.zoom>=r.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate();const u=this.transform.getProjection().name==="mercator"&&o!==this.transform.mercatorFromTransition;return(t||u)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c,t){return this.transform.locationPoint3D(r.aT.convert(c),t)}unproject(c,t){return this.transform.pointLocation3D(r.P.convert(c),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,t,o){const u=g=>{let v=[];if(Array.isArray(t)){const b=t.filter(E=>this.getLayer(E));v=b.length?this.queryRenderedFeatures(g,{layers:b}):[]}else v=this.queryRenderedFeatures(g,{target:t});return v};if(c==="mouseenter"||c==="mouseover"){let g=!1;return{listener:o,targets:t,delegates:{mousemove:b=>{const E=u(b.point);E.length?g||(g=!0,o.call(this,new ms(c,this,b.originalEvent,{features:E}))):g=!1},mouseout:()=>{g=!1}}}}if(c==="mouseleave"||c==="mouseout"){let g=!1;return{listener:o,targets:t,delegates:{mousemove:E=>{u(E.point).length?g=!0:g&&(g=!1,o.call(this,new ms(c,this,E.originalEvent)))},mouseout:E=>{g&&(g=!1,o.call(this,new ms(c,this,E.originalEvent)))}}}}{const g=v=>{const b=u(v.point);b.length&&(v.features=b,o.call(this,v),delete v.features)};return{listener:o,targets:t,delegates:{[c]:g}}}}on(c,t,o){if(typeof t=="function"||o===void 0)return super.on(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(const g in u.delegates)this.on(g,u.delegates[g]);return this}once(c,t,o){if(typeof t=="function"||o===void 0)return super.once(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,o);for(const g in u.delegates)this.once(g,u.delegates[g]);return this}off(c,t,o){if(typeof t=="function"||o===void 0)return super.off(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[c]:void 0;return u&&(g=>{for(let v=0;v<g.length;v++){const b=g[v];if(b.listener===o&&lp(b.targets,t)){for(const E in b.delegates)this.off(E,b.delegates[E]);return g.splice(v,1),this}}})(u),this}queryRenderedFeatures(c,t){if(!this.style)return[];if(c===void 0||c instanceof r.P||Array.isArray(c)||t!==void 0||(t=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],!t){const v=this.style.queryRenderedFeatures(c,void 0,this.transform),b=this.style.queryRenderedFeatureset(c,void 0,this.transform);return v.concat(b)}let o=!0;if(t.target&&(o=this._isTargetValid(t.target),o&&!t.layers))return this.style.queryRenderedFeatureset(c,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const v of t.layers)if(!this._isValidId(v)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(c,t,this.transform)}let g=[];return u&&(g=g.concat(this.style.queryRenderedFeatures(c,t,this.transform))),o&&(g=g.concat(this.style.queryRenderedFeatureset(c,t,this.transform))),g}querySourceFeatures(c,t){return!c||typeof c=="string"&&!this._isValidId(c)?[]:this.style.querySourceFeatures(c,t)}queryRasterValue(c,t,o){return this._isValidId(c)?this.style.queryRasterValue(c,t,o):Promise.resolve(null)}isPointOnSurface(c){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(c))}addInteraction(c,t){return this._interactions.add(c,t),this}removeInteraction(c){return this._interactions.remove(c),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(c){return this._cooperativeGestures=c,this}setStyle(c,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&c&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(c,(o,u)=>{if(o){const g=typeof o=="string"?o:o instanceof Error?o.message:o.error;r.w(`Unable to perform style diff: ${g}. Rebuilding the style from scratch.`),this._updateStyle(c,t)}else u&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c){const o=Object.assign({},t);t&&t.config&&(o.initialConfig=t.config,delete o.config),this.style=new bo(this,o).load(c),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new bo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.dr(c)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}_isTargetValid(c){return"featuresetId"in c?this._isValidId("importId"in c?c.importId:c.featuresetId):"layerId"in c&&this._isValidId(c.layerId)}_areTargetsValid(c){if(Array.isArray(c)){for(const t of c)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(c)}addSource(c,t){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,o)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,t,{pixelRatio:o=1,sdf:u=!1,stretchX:g,stretchY:v,content:b}={}){this._lazyInitEmptyStyle();const E=r.I.from(c);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:C,height:P,data:z}=r.o.getImageData(t);this.style.addImage(E,{data:new r.q({width:C,height:P},z),pixelRatio:o,stretchX:g,stretchY:v,content:b,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:P}=t,z=t;this.style.addImage(E,{data:new r.q({width:C,height:P},new Uint8Array(z.data)),pixelRatio:o,stretchX:g,stretchY:v,content:b,sdf:u,usvg:!1,version:0,userImage:z}),z.onAdd&&z.onAdd(this,c)}}updateImage(c,t){this._lazyInitEmptyStyle();const o=r.I.from(c),u=this.style.getImage(o);if(!u)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.o.getImageData(t):t,{width:v,height:b,data:E}=g;if(v===void 0||b===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==(u.usvg?u.icon.usvg_tree.width:u.data.width)||b!==(u.usvg?u.icon.usvg_tree.height:u.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${v}, ${b})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const C=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let P=!1;u.usvg?(u.data=new r.q({width:v,height:b},new Uint8Array(E)),u.usvg=!1,u.icon=void 0,P=!0):u.data.replace(E,C),this.style.updateImage(o,u,P)}hasImage(c){return c?!!this.style&&!!this.style.getImage(r.I.from(c)):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(r.I.from(c))}loadImage(c,t){r.n(this._requestManager.transformRequest(c,r.R.Image),(o,u)=>{t(o,u instanceof HTMLImageElement?r.o.getImageData(u):u)})}listImages(){return this.style.listImages().map(c=>c.name)}addModel(c,t){this._lazyInitEmptyStyle(),this.style.addModel(c,t)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,t){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)):this}getSlot(c){const t=this.getLayer(c);return t&&t.slot||null}setSlot(c,t){return this.style.setSlot(c,t),this.style.mergeLayers(),this._update(!0)}addImport(c,t){return this.style.addImport(c,t).catch(o=>this.fire(new r.y(new Error("Failed to add import",o)))),this}updateImport(c,t){return typeof t!="string"&&t.id!==c?(this.removeImport(c),this.addImport(t)):(this.style.updateImport(c,t),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,t){return this.style.moveImport(c,t),this._update(!0)}moveLayer(c,t){return this._isValidId(c)?(this.style.moveLayer(c,t),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){if(!this._isValidId(c))return null;const t=this.style.getOwnLayer(c);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(c,t,o){return this._isValidId(c)?(this.style.setLayerZoomRange(c,t,o),this._update(!0)):this}setFilter(c,t,o={}){return this._isValidId(c)?(this.style.setFilter(c,t,o),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,t,o,u={}){return this._isValidId(c)?(this.style.setPaintProperty(c,t,o,u),this._update(!0)):this}getPaintProperty(c,t){return this._isValidId(c)?this.style.getPaintProperty(c,t):null}setLayoutProperty(c,t,o,u={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,t,o,u),this._update(!0)):this}getLayoutProperty(c,t){return this._isValidId(c)?this.style.getLayoutProperty(c,t):null}setLayerProperty(c,t,o,u={}){return this._isValidId(c)?(t==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(c,t,o,u),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(c){return this.style.setGlyphsUrl(c),this._update(!0)}getSchema(c){return this.style.getSchema(c)}setSchema(c,t){return this.style.setSchema(c,t),this._update(!0)}getConfig(c){return this.style.getConfig(c)}setConfig(c,t){return this.style.setConfig(c,t),this._update(!0)}getConfigProperty(c,t){return this.style.getConfigProperty(c,t)}setConfigProperty(c,t,o){return this.style.setConfigProperty(c,t,o),this._update(!0)}getFeaturesetDescriptors(c){return this.style.getFeaturesetDescriptors(c)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){const t=c[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(c){return this._lazyInitEmptyStyle(),this.style.setSnow(c),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(c){return this._lazyInitEmptyStyle(),this.style.setRain(c),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(c){return this._lazyInitEmptyStyle(),this.style.setColorTheme(c),this._update(!0)}setImportColorTheme(c,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(c,t),this._update(!0)}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aT.convert(c),this.transform):0}setFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.setFeatureState(c,t),this._update())}removeFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.removeFeatureState(c,t),this._update())}getFeatureState(c){return c.source&&!this._isValidId(c.source)?null:this.style.getFeatureState(c)}_selectIndoorFloor(c){this.style.indoorManager.selectFloor(c)}_setIndoorActiveFloorsVisibility(c){this.style.indoorManager.setActiveFloorsVisibility(c)}getIndoorTileOptions(c,t){return this.style.isIndoorEnabled()?this.style.indoorManager.getIndoorTileOptions(c,t):null}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let o,u,g,v=this._container;for(;v&&(!u||!g);){const b=window.getComputedStyle(v).transform;b&&b!=="none"&&(o=b.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(u=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(g=o[3])),v=v.parentElement}this._containerWidth=u?Math.abs(c/u):c,this._containerHeight=g?Math.abs(t/g):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=he("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=he("div","mapboxgl-canvas-container",c);this._canvas=he("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=he("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{u[g]=he("div",`mapboxgl-ctrl-${g}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const o=r.o.devicePixelRatio||1;this._canvas.width=o*Math.ceil(c),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);t!==-1&&this._markers.splice(t,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const t=this._popups.indexOf(c);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const c=Object.assign({},Ae.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",c);t?(Jr(t,!0),this.painter=new tp(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",o=>{if(o.dataType==="source"){const u=this.transform.elevation?this.transform.elevation._source():null;u&&o.sourceCacheId===u.id&&this.style&&this.style._setLabelPlacementStale(),this.painter.setTileLoadedFlag(!0)}}),r.k.testSupport(t)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;this.fire(new r.z("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,u=r.o.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=g.createQuery(),g.beginQuery(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,P=this.transform.pitch,z=r.o.now(),U=new r.ac(C,{now:z,fadeDuration:v,pitch:P,transition:this.style.transition,worldview:this._worldview});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(u),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(u),this.style&&(this._placementDirty=this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource)),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ie.mark(H.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const C=r.o.now()-u;g.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const P=g.getQueryParameter(t,g.QUERY_RESULT)/1e6;g.deleteQuery(t),this.fire(new r.z("gpu-timing-frame",{cpuTime:C,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(C);this.fire(new r.z("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(C);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:P}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(E||this._repaint)this.triggerRepaint();else{const C=this.idle();if(C&&(b=this._updateAverageElevation(u,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,ie.mark(H.fullLoad),this._performanceMetricsCollection&&vn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const t of this._markers)c&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!c||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(c,t=!1){const o=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=c;const b=Math.abs(g-v);if(b>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(v),o(v);this._averageElevation.easeTo(v,c,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),o(v)}return!!this._averageElevation.isEasing(c)&&o(this._averageElevation.getValue(c))}_authenticate(){Vs(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===si||c.status===401)){const t=this.painter.context.gl;Jr(t,!1),this._logoControl instanceof ll&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ci(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Qt(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&fi(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Fi(this._requestManager._customAccessToken)}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const o=this.painter.context.gl,u=o.createFramebuffer();function g(v){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,v,0);const b=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,b),b}return o.bindFramebuffer(o.FRAMEBUFFER,u),this._canvasPixelComparison(g(c),t.canvasCopies.map(g),t.timeStamps)}_canvasPixelComparison(c,t,o){let u=o[1]-o[0];const g=c.length/4;for(let v=0;v<t.length;v++){const b=t[v];let E=0;for(let C=0;C<b.length;C+=4)b[C]===c[C]&&b[C+1]===c[C+1]&&b[C+2]===c[C+2]&&b[C+3]===c[C+3]&&(E+=1);u+=(o[v+2]-o[v+1])*(1-E/g)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Gs.delete(this.painter.context.gl),Mr.remove(),Gt.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=r.o.frame(t=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)}))}_preloadTiles(c){const t=this.style?this.style.getSourceCaches():[];return r.bw(t,(o,u)=>o._preloadTiles(c,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,this.style&&c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,c&&this._update())}_setCacheLimits(c,t){r.f4(c,t)}get version(){return q}},NavigationControl:class{constructor(c={}){this.options=Object.assign({},Bl,c),this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(r.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),he("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),he("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))}),this._compassIcon=he("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),o=t===c.getMaxZoom(),u=t===c.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new os(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const o=he("button",c,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(c,t){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",o),c.firstElementChild&&c.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends r.E{constructor(c={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},oa,c),r.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ip(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._clearRequestTimeout(),this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,c(o)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>t(o.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),o=c.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._clearRequestTimeout(),this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this.options.followUserLocation?(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active")):(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"));break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.followUserLocation&&(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",Object.assign({coords:c.coords,timestamp:c.timestamp},c.toJSON?{toJSON:c.toJSON.bind(c)}:{}))),this._finish()}}_updateCamera(c){const t=new r.aT(c.coords.longitude,c.coords.latitude),o=c.coords.accuracy,u=this._map.getBearing(),g=Object.assign({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),g,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new r.aT(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,t=r.cf(1,c._center.lat)*c.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this._clearRequestTimeout(),this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",{code:c.code,message:c.message,PERMISSION_DENIED:c.PERMISSION_DENIED,POSITION_UNAVAILABLE:c.POSITION_UNAVAILABLE,TIMEOUT:c.TIMEOUT})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_startRequestTimeout(){this._clearRequestTimeout();const c=this.options.positionOptions.timeout;c&&(this._requestTimeoutId=window.setTimeout(()=>{this._onError({code:3,message:"Geolocation request timed out"})},c))}_clearRequestTimeout(){this._requestTimeoutId!==void 0&&(clearTimeout(this._requestTimeoutId),this._requestTimeoutId=void 0)}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=he("button","mapboxgl-ctrl-geolocate",this._container),he("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=he("div","mapboxgl-user-location"),this._dotElement.appendChild(he("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(he("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Hr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=he("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Hr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.showButton||(this._container.style.display="none"),this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this._startRequestTimeout(),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._startRequestTimeout(),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}setFollowUserLocation(c){return this.options.followUserLocation=c??oa.followUserLocation,this.options.trackUserLocation&&this._watchState!=="OFF"&&(this.options.followUserLocation?this._watchState!=="BACKGROUND"&&this._watchState!=="BACKGROUND_ERROR"||(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))):this._watchState!=="ACTIVE_LOCK"&&this._watchState!=="ACTIVE_ERROR"||(this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this.fire(new r.z("trackuserlocationend")))),this}_addDeviceOrientationListener(){const c=()=>{const t="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(t,this._onDeviceOrientation)};typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this._clearRequestTimeout(),this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Gh,ScaleControl:class{constructor(c={}){this.options=Object.assign({},Hh,c),r.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,u=t._containerWidth/2-c/2,g=t.unproject([u,o]),v=t.unproject([u+c,o]),b=g.distanceTo(v);if(this.options.unit==="imperial"){const E=3.2808*b;E>5280?this._setScale(c,E/5280,"mile"):this._setScale(c,E,"foot")}else this.options.unit==="nautical"?this._setScale(c,b/1852,"nautical-mile"):b>=1e3?this._setScale(c,b/1e3,"kilometer"):this._setScale(c,b,"meter")}_setScale(c,t,o){this._map._requestDomTask(()=>{const u=(function(v){const b=Math.pow(10,`${Math.floor(v)}`.length-1);let E=v/b;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:(function(C){const P=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*P)/P})(E),b*E})(t),g=u/t;this._container.innerHTML=o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(u):`${u}&nbsp;${Lr[o]}`,this._container.style.width=c*g+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c={}){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:r.w("Full screen control 'container' must be a DOM element.")),r.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=he("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=he("button","mapboxgl-ctrl-fullscreen",this._controlContainer);he("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Mf,Popup:class extends r.E{constructor(c){super(),this.options=Object.assign(Object.create(Fo),c),this._altitude=this.options.altitude,r.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=r.aT.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(c){return this._altitude=c,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=c;u=o.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=he("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const o=this._closeButton=he("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.innerHTML='<span aria-hidden="true">&#215;</span>',o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,o=this._container,u=this._pos;if(!t||!o||!u)return"bottom";const g=o.offsetWidth,v=o.offsetHeight,b=u.x<g/2,E=u.x>t.transform.width-g/2;if(u.y+c<v)return b?"top-left":E?"top-right":"top";if(u.y>t.transform.height-v){if(b)return"bottom-left";if(E)return"bottom-right"}return b?"left":E?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let u=this._container;if(u||(u=this._container=he("div","mapboxgl-popup",t.getContainer()),this._tip=he("div","mapboxgl-popup-tip",u),u.appendChild(o)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fu(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const g=this._pos=this._trackPointer&&c instanceof r.P?c:t.project(this._lngLat,this._altitude),v=Nu(this.options.offset),b=this._anchor=this._getAnchor(v.y),E=Nu(this.options.offset,b),C=g.add(E).round();t._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Na[b]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&t._showingGlobe()){const g=r.f5(t.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(pc);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Hr,Style:bo,LngLat:r.aT,LngLatBounds:r.aI,Point:r.P,MercatorCoordinate:r.ae,FreeCameraOptions:wg,Evented:r.E,config:r.e,prewarm:r.f9,clearPrewarmedResources:r.f8,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(c){r.e.ACCESS_TOKEN=c},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(c){r.e.API_URL=c},get workerCount(){return r.fi.workerCount},set workerCount(c){r.fi.workerCount=c},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){r.e.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){r.fh(c)},get workerUrl(){return r.fg.workerUrl},set workerUrl(c){r.fg.workerUrl=c},get workerClass(){return r.fg.workerClass},set workerClass(c){r.fg.workerClass=c},get workerParams(){return r.fg.workerParams},set workerParams(c){r.fg.workerParams=c},get dracoUrl(){return r.ff()},set dracoUrl(c){r.fe(c)},get meshoptUrl(){return r.fd()},set meshoptUrl(c){r.fc(c)},setNow:r.o.setNow,restoreNow:r.o.restoreNow}});var B=R;return B}))})(lx)),lx.exports}var W5=Z5();const xx=_1(W5),X5="pk.eyJ1IjoiemhlY29kaW5nY2hpYW4iLCJhIjoiY21raHd4MWRpMDNyZDNlc2R2dW1qZ3RjYSJ9.aP1_wXdsZQz0vDg6Nvc93A";function l1({center:d=[103.8198,1.3521],zoom:h=13,onMapLoad:_,className:T="w-full h-full"}){const R=le.useRef(null),D=le.useRef(null),[B,r]=le.useState(!1);return le.useEffect(()=>{if(!R.current||D.current)return;xx.accessToken=X5;const q={background:"#F9FAFB",land:"#F9FAFB",park:"#EDEFF1",water:"#E8E3DC",road:"#DCDCDD",roadOutline:"#BFC1C5",text:"#1F2937",textHalo:"#FFFFFF"};return D.current=new xx.Map({container:R.current,style:"mapbox://styles/mapbox/light-v11",center:d,zoom:h,attributionControl:!1,doubleClickZoom:!1}),D.current.on("load",()=>{if(!D.current)return;const H=D.current.getStyle().layers;H&&H.forEach(ie=>{const Q=ie["source-layer"]??"";ie.type==="background"?D.current?.setPaintProperty(ie.id,"background-color",q.background):ie.type==="line"?Q.includes("road")||ie.id.includes("road")?(D.current?.setPaintProperty(ie.id,"line-color",q.road),D.current?.setPaintProperty(ie.id,"line-width",.8)):Q.includes("rail")||ie.id.includes("rail")?D.current?.setPaintProperty(ie.id,"line-color",q.roadOutline):D.current?.setPaintProperty(ie.id,"line-color","#D8CFC6"):ie.type==="fill"?Q.includes("water")?(D.current?.setPaintProperty(ie.id,"fill-color",q.water),D.current?.setPaintProperty(ie.id,"fill-opacity",1)):Q.includes("landcover")||Q.includes("landuse")||Q.includes("park")?(D.current?.setPaintProperty(ie.id,"fill-color",q.park),D.current?.setPaintProperty(ie.id,"fill-opacity",.7)):Q.includes("building")?(D.current?.setPaintProperty(ie.id,"fill-color","#EBDDCF"),D.current?.setPaintProperty(ie.id,"fill-opacity",.8)):(D.current?.setPaintProperty(ie.id,"fill-color",q.land),D.current?.setPaintProperty(ie.id,"fill-opacity",.8)):ie.type==="symbol"&&ie.layout&&"text-field"in ie.layout&&(D.current?.setPaintProperty(ie.id,"text-color",q.text),D.current?.setPaintProperty(ie.id,"text-halo-color",q.textHalo),D.current?.setPaintProperty(ie.id,"text-halo-width",1))}),r(!0),_&&D.current&&_(D.current)}),()=>{D.current?.remove(),D.current=null}},[]),le.useEffect(()=>{if(D.current&&B){const[q,H]=d,ie=D.current.getCenter();Math.sqrt(Math.pow(ie.lng-q,2)+Math.pow(ie.lat-H,2))>.01&&D.current.setCenter(d)}},[d[0],d[1],B]),ee.jsx("div",{className:T,children:ee.jsx("div",{ref:R,className:"w-full h-full"})})}function $1(){const{user:d}=hd(),[h,_]=le.useState([]),[T,R]=le.useState(!0),[D,B]=le.useState(null),[r,q]=le.useState(null),H=le.useCallback(()=>{q(null)},[]),ie=le.useCallback(async()=>{if(!d){_([]),R(!1);return}R(!0);const{data:Ae,error:he}=await Zr.from("notifications").select("*").eq("user_id",d.id).order("created_at",{ascending:!1});if(he){B(he),R(!1);return}const Re=Ae??[];if(Re.length>0&&Re[0].read===!1){const Ne=Re[0];_(Ge=>(Ge.some(rt=>rt.id===Ne.id)||q(Ne),Re))}else _(Re);R(!1)},[d]);le.useEffect(()=>{ie()},[ie]),le.useEffect(()=>{if(!d)return;const Ae=Zr.channel("notifications-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${d.id}`},he=>{const Re=he.new;_(Ne=>[Re,...Ne]),q(Re)}).subscribe();return()=>{Zr.removeChannel(Ae)}},[d]);const Q=le.useCallback(async Ae=>{const{error:he}=await Zr.rpc("mark_notification_read",{p_notification_id:Ae});if(he)throw he;_(Re=>Re.map(Ne=>Ne.id===Ae?{...Ne,read:!0}:Ne))},[]),me=le.useCallback(async()=>{const Ae=h.filter(he=>!he.read);Ae.length!==0&&(await Promise.all(Ae.map(he=>Zr.rpc("mark_notification_read",{p_notification_id:he.id}))),_(he=>he.map(Re=>({...Re,read:!0}))))},[h]),we=h.filter(Ae=>!Ae.read).length;return{notifications:h,unreadCount:we,newNotification:r,clearNewNotification:H,loading:T,error:D,markAsRead:Q,markAllAsRead:me,refresh:ie}}function Nx({activeTab:d}){const{unreadCount:h}=$1(),_=[{id:"map",icon:x3,label:"Map",path:"/"},{id:"deploy",icon:T3,label:"Snails",path:"/deploy"},{id:"notifications",icon:m3,label:"Alerts",path:"/notifications"},{id:"profile",icon:E3,label:"Profile",path:"/profile"}];return ee.jsx("nav",{className:"fixed left-0 right-0 bottom-0 z-50 bg-card/95 border-t border-border rounded-t-2xl shadow-2xl backdrop-blur-sm",children:ee.jsx("div",{className:"flex w-full max-w-2xl mx-auto items-center justify-around px-4 py-1.5",children:_.map(T=>{const R=T.icon,D=d===T.id,B=T.id==="notifications"&&h>0;return ee.jsxs($3,{href:T.path,className:`relative flex flex-col items-center gap-0.5 transition-all active:scale-95 ${D?"text-primary":"text-muted-foreground hover:text-foreground"}`,children:[ee.jsxs("div",{className:`relative flex items-center justify-center rounded-full px-2 py-1.5 ${D?"bg-primary/10":"bg-transparent"}`,children:[ee.jsx(R,{className:"w-5 h-5",strokeWidth:D?2.6:2.2}),B&&ee.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-3.5 h-3.5 bg-red-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center",children:h>9?"9+":h})]}),ee.jsx("span",{className:"text-xs font-medium tracking-wide",children:T.label})]},T.id)})})})}function Y5({notification:d,onClose:h}){if(!d)return null;const _=d.data,T=d.type;return T==="arrival_success"?ee.jsx(cg,{open:!0,onOpenChange:()=>h(),children:ee.jsxs(ug,{className:"sm:max-w-md",children:[ee.jsxs(hg,{children:[ee.jsxs(dg,{className:"flex items-center gap-2",children:[ee.jsx("span",{className:"text-2xl",children:""}),"Invasion Successful!"]}),ee.jsxs(fg,{children:["Your snail invaded @",_.target_username,"'s home base."]})]}),ee.jsxs("div",{className:"space-y-4 py-4",children:[ee.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[ee.jsxs("div",{className:"flex items-center gap-3",children:[ee.jsx("span",{className:"text-2xl",children:""}),ee.jsx("span",{className:"font-medium",children:"Salt Earned"})]}),ee.jsxs("span",{className:"text-xl font-bold text-green-600",children:["+",_.salt_reward]})]}),ee.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[ee.jsxs("div",{className:"flex items-center gap-3",children:[ee.jsx("span",{className:"text-2xl",children:""}),ee.jsx("span",{className:"font-medium",children:"Snail Returned"})]}),ee.jsxs("span",{className:"text-xl font-bold text-green-600",children:["+",_.snail_reward]})]})]}),ee.jsx(Us,{onClick:h,className:"w-full",children:"Continue"})]})}):T==="arrival_invaded"?ee.jsx(cg,{open:!0,onOpenChange:()=>h(),children:ee.jsxs(ug,{className:"sm:max-w-md",children:[ee.jsxs(hg,{children:[ee.jsxs(dg,{className:"flex items-center gap-2",children:[ee.jsx("span",{className:"text-2xl",children:""}),"Base Invaded!"]}),ee.jsxs(fg,{children:["@",_.sender_username,"'s snail reached your home base."]})]}),ee.jsx("div",{className:"space-y-4 py-4",children:ee.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-red-200 bg-red-50 p-4",children:[ee.jsxs("div",{className:"flex items-center gap-3",children:[ee.jsx("span",{className:"text-2xl",children:""}),ee.jsx("span",{className:"font-medium",children:"Salt Lost"})]}),ee.jsxs("span",{className:"text-xl font-bold text-red-600",children:["-",_.salt_penalty]})]})}),ee.jsx(Us,{onClick:h,className:"w-full",children:"Continue"})]})}):T==="intercept"?ee.jsx(cg,{open:!0,onOpenChange:()=>h(),children:ee.jsxs(ug,{className:"sm:max-w-md",children:[ee.jsxs(hg,{children:[ee.jsxs(dg,{className:"flex items-center gap-2",children:[ee.jsx("span",{className:"text-2xl",children:""}),"Snail Intercepted!"]}),ee.jsxs(fg,{children:["You captured @",_.sender_username,"'s snail before it reached your base."]})]}),ee.jsxs("div",{className:"space-y-4 py-4",children:[ee.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[ee.jsxs("div",{className:"flex items-center gap-3",children:[ee.jsx("span",{className:"text-2xl",children:""}),ee.jsx("span",{className:"font-medium",children:"Snail Captured"})]}),ee.jsxs("span",{className:"text-xl font-bold text-green-600",children:["+",_.snail_reward]})]}),ee.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[ee.jsxs("div",{className:"flex items-center gap-3",children:[ee.jsx("span",{className:"text-2xl",children:""}),ee.jsx("span",{className:"font-medium",children:"Salt Earned"})]}),ee.jsxs("span",{className:"text-xl font-bold text-green-600",children:["+",_.salt_reward]})]}),ee.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["Intercepted at ",Math.round((_.progress??0)*100),"% progress"]})]}),ee.jsx(Us,{onClick:h,className:"w-full",children:"Continue"})]})}):T==="snail_intercepted"?ee.jsx(cg,{open:!0,onOpenChange:()=>h(),children:ee.jsxs(ug,{className:"sm:max-w-md",children:[ee.jsxs(hg,{children:[ee.jsxs(dg,{className:"flex items-center gap-2",children:[ee.jsx("span",{className:"text-2xl",children:""}),"Snail Intercepted!"]}),ee.jsxs(fg,{children:["@",_.interceptor_username," intercepted your snail before it reached their base."]})]}),ee.jsxs("div",{className:"space-y-4 py-4",children:[ee.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-red-200 bg-red-50 p-4",children:[ee.jsxs("div",{className:"flex items-center gap-3",children:[ee.jsx("span",{className:"text-2xl",children:""}),ee.jsx("span",{className:"font-medium",children:"Snail Lost"})]}),ee.jsx("span",{className:"text-xl font-bold text-red-600",children:"-1"})]}),ee.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["Intercepted at ",Math.round((_.progress??0)*100),"% progress"]})]}),ee.jsx(Us,{onClick:h,className:"w-full",children:"Continue"})]})}):null}function K5({open:d,senderUsername:h,onIntercept:_,onClose:T}){const[R,D]=le.useState(!1),B=async()=>{D(!0);try{await _(),T()}catch(r){console.error("Failed to intercept snail:",r)}finally{D(!1)}};return ee.jsx(cg,{open:d,onOpenChange:()=>T(),children:ee.jsxs(ug,{className:"sm:max-w-md",children:[ee.jsxs(hg,{children:[ee.jsxs(dg,{className:"flex items-center gap-2",children:[ee.jsx("span",{className:"text-2xl",children:""}),"Snail in Range!"]}),ee.jsxs(fg,{children:["You can intercept ",h,"'s snail before it reaches your base."]})]}),ee.jsxs("div",{className:"flex gap-3 pt-4",children:[ee.jsx(Us,{variant:"outline",onClick:T,className:"flex-1",disabled:R,children:"Ignore"}),ee.jsx(Us,{onClick:B,className:"flex-1",disabled:R,children:R?ee.jsxs(ee.Fragment,{children:[ee.jsx(Pp,{className:"mr-2 h-4 w-4 animate-spin"}),"Intercepting..."]}):"Intercept"})]})]})})}function J5({onMove:d,size:h=100}){const _=le.useRef(null),[T,R]=le.useState(!1),[D,B]=le.useState({x:0,y:0}),r=h/2-15,q=(me,we)=>{R(!0),Q(me,we)},H=(me,we)=>{T&&Q(me,we)},ie=()=>{R(!1),B({x:0,y:0}),d(0,0)},Q=(me,we)=>{if(!_.current)return;const Ae=_.current.getBoundingClientRect(),he=Ae.left+Ae.width/2,Re=Ae.top+Ae.height/2;let Ne=me-he,Ge=we-Re;if(Math.sqrt(Ne*Ne+Ge*Ge)>r){const Bt=Math.atan2(Ge,Ne);Ne=Math.cos(Bt)*r,Ge=Math.sin(Bt)*r}B({x:Ne,y:Ge});const rt=Ne/r,Pt=Ge/r;d(rt,Pt)};return le.useEffect(()=>{const me=Re=>{Re.stopPropagation(),Re.preventDefault(),H(Re.clientX,Re.clientY)},we=Re=>{Re.stopPropagation(),Re.preventDefault(),Re.touches.length>0&&H(Re.touches[0].clientX,Re.touches[0].clientY)},Ae=Re=>{Re.stopPropagation(),Re.preventDefault(),ie()},he=Re=>{Re.stopPropagation(),Re.preventDefault(),ie()};return T&&(window.addEventListener("mousemove",me),window.addEventListener("touchmove",we,{passive:!1}),window.addEventListener("mouseup",Ae),window.addEventListener("touchend",he)),()=>{window.removeEventListener("mousemove",me),window.removeEventListener("touchmove",we),window.removeEventListener("mouseup",Ae),window.removeEventListener("touchend",he)}},[T]),ee.jsxs("div",{ref:_,className:"relative bg-background/80 backdrop-blur-sm rounded-full border-2 border-border shadow-lg",style:{width:h,height:h},onMouseDown:me=>{me.stopPropagation(),me.preventDefault(),q(me.clientX,me.clientY)},onTouchStart:me=>{me.stopPropagation(),me.preventDefault(),me.touches.length>0&&q(me.touches[0].clientX,me.touches[0].clientY)},onClick:me=>{me.stopPropagation(),me.preventDefault()},onDoubleClick:me=>{me.stopPropagation(),me.preventDefault()},onContextMenu:me=>{me.stopPropagation(),me.preventDefault()},children:[ee.jsx("div",{className:"absolute top-1/2 left-1/2 w-8 h-8 bg-primary rounded-full shadow-md transition-transform",style:{transform:`translate(calc(-50% + ${D.x}px), calc(-50% + ${D.y}px))`}}),ee.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:ee.jsx("div",{className:"w-1 h-1 bg-muted-foreground/30 rounded-full"})})]})}function tR(d){const h=le.useRef({value:d,previous:d});return le.useMemo(()=>(h.current.value!==d&&(h.current.previous=h.current.value,h.current.value=d),h.current.previous),[d])}var jx="Checkbox",[Q5]=Np(jx),[ej,Z1]=Q5(jx);function tj(d){const{__scopeCheckbox:h,checked:_,children:T,defaultChecked:R,disabled:D,form:B,name:r,onCheckedChange:q,required:H,value:ie="on",internal_do_not_use_render:Q}=d,[me,we]=px({prop:_,defaultProp:R??!1,onChange:q,caller:jx}),[Ae,he]=le.useState(null),[Re,Ne]=le.useState(null),Ge=le.useRef(!1),Ue=Ae?!!B||!!Ae.closest("form"):!0,rt={checked:me,disabled:D,setChecked:we,control:Ae,setControl:he,name:r,form:B,value:ie,hasConsumerStoppedPropagationRef:Ge,required:H,defaultChecked:zp(R)?!1:R,isFormControl:Ue,bubbleInput:Re,setBubbleInput:Ne};return ee.jsx(ej,{scope:h,...rt,children:ij(Q)?Q(rt):T})}var iR="CheckboxTrigger",nR=le.forwardRef(({__scopeCheckbox:d,onKeyDown:h,onClick:_,...T},R)=>{const{control:D,value:B,disabled:r,checked:q,required:H,setControl:ie,setChecked:Q,hasConsumerStoppedPropagationRef:me,isFormControl:we,bubbleInput:Ae}=Z1(iR,d),he=xs(R,ie),Re=le.useRef(q);return le.useEffect(()=>{const Ne=D?.form;if(Ne){const Ge=()=>Q(Re.current);return Ne.addEventListener("reset",Ge),()=>Ne.removeEventListener("reset",Ge)}},[D,Q]),ee.jsx(hr.button,{type:"button",role:"checkbox","aria-checked":zp(q)?"mixed":q,"aria-required":H,"data-state":cR(q),"data-disabled":r?"":void 0,disabled:r,value:B,...T,ref:he,onKeyDown:Rr(h,Ne=>{Ne.key==="Enter"&&Ne.preventDefault()}),onClick:Rr(_,Ne=>{Q(Ge=>zp(Ge)?!0:!Ge),Ae&&we&&(me.current=Ne.isPropagationStopped(),me.current||Ne.stopPropagation())})})});nR.displayName=iR;var rR=le.forwardRef((d,h)=>{const{__scopeCheckbox:_,name:T,checked:R,defaultChecked:D,required:B,disabled:r,value:q,onCheckedChange:H,form:ie,...Q}=d;return ee.jsx(tj,{__scopeCheckbox:_,checked:R,defaultChecked:D,disabled:r,required:B,onCheckedChange:H,name:T,form:ie,value:q,internal_do_not_use_render:({isFormControl:me})=>ee.jsxs(ee.Fragment,{children:[ee.jsx(nR,{...Q,ref:h,__scopeCheckbox:_}),me&&ee.jsx(lR,{__scopeCheckbox:_})]})})});rR.displayName=jx;var sR="CheckboxIndicator",oR=le.forwardRef((d,h)=>{const{__scopeCheckbox:_,forceMount:T,...R}=d,D=Z1(sR,_);return ee.jsx(q_,{present:T||zp(D.checked)||D.checked===!0,children:ee.jsx(hr.span,{"data-state":cR(D.checked),"data-disabled":D.disabled?"":void 0,...R,ref:h,style:{pointerEvents:"none",...d.style}})})});oR.displayName=sR;var aR="CheckboxBubbleInput",lR=le.forwardRef(({__scopeCheckbox:d,...h},_)=>{const{control:T,hasConsumerStoppedPropagationRef:R,checked:D,defaultChecked:B,required:r,disabled:q,name:H,value:ie,form:Q,bubbleInput:me,setBubbleInput:we}=Z1(aR,d),Ae=xs(_,we),he=tR(D),Re=pC(T);le.useEffect(()=>{const Ge=me;if(!Ge)return;const Ue=window.HTMLInputElement.prototype,Pt=Object.getOwnPropertyDescriptor(Ue,"checked").set,Bt=!R.current;if(he!==D&&Pt){const Tt=new Event("click",{bubbles:Bt});Ge.indeterminate=zp(D),Pt.call(Ge,zp(D)?!1:D),Ge.dispatchEvent(Tt)}},[me,he,D,R]);const Ne=le.useRef(zp(D)?!1:D);return ee.jsx(hr.input,{type:"checkbox","aria-hidden":!0,defaultChecked:B??Ne.current,required:r,disabled:q,name:H,value:ie,form:Q,...h,tabIndex:-1,ref:Ae,style:{...h.style,...Re,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});lR.displayName=aR;function ij(d){return typeof d=="function"}function zp(d){return d==="indeterminate"}function cR(d){return zp(d)?"indeterminate":d?"checked":"unchecked"}function Lw({className:d,...h}){return ee.jsx(rR,{"data-slot":"checkbox",className:bs("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",d),...h,children:ee.jsx(oR,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:ee.jsx(O1,{className:"size-3.5"})})})}function zA(d,[h,_]){return Math.min(_,Math.max(h,d))}function nj(d){const h=d+"CollectionProvider",[_,T]=Np(h),[R,D]=_(h,{collectionRef:{current:null},itemMap:new Map}),B=he=>{const{scope:Re,children:Ne}=he,Ge=pi.useRef(null),Ue=pi.useRef(new Map).current;return ee.jsx(R,{scope:Re,itemMap:Ue,collectionRef:Ge,children:Ne})};B.displayName=h;const r=d+"CollectionSlot",q=N_(r),H=pi.forwardRef((he,Re)=>{const{scope:Ne,children:Ge}=he,Ue=D(r,Ne),rt=xs(Re,Ue.collectionRef);return ee.jsx(q,{ref:rt,children:Ge})});H.displayName=r;const ie=d+"CollectionItemSlot",Q="data-radix-collection-item",me=N_(ie),we=pi.forwardRef((he,Re)=>{const{scope:Ne,children:Ge,...Ue}=he,rt=pi.useRef(null),Pt=xs(Re,rt),Bt=D(ie,Ne);return pi.useEffect(()=>(Bt.itemMap.set(rt,{ref:rt,...Ue}),()=>void Bt.itemMap.delete(rt))),ee.jsx(me,{[Q]:"",ref:Pt,children:Ge})});we.displayName=ie;function Ae(he){const Re=D(d+"CollectionConsumer",he);return pi.useCallback(()=>{const Ge=Re.collectionRef.current;if(!Ge)return[];const Ue=Array.from(Ge.querySelectorAll(`[${Q}]`));return Array.from(Re.itemMap.values()).sort((Bt,Tt)=>Ue.indexOf(Bt.ref.current)-Ue.indexOf(Tt.ref.current))},[Re.collectionRef,Re.itemMap])}return[{Provider:B,Slot:H,ItemSlot:we},Ae,T]}var rj=le.createContext(void 0);function sj(d){const h=le.useContext(rj);return d||h||"ltr"}var oj=[" ","Enter","ArrowUp","ArrowDown"],aj=[" ","Enter"],gg="Select",[Ux,Vx,lj]=nj(gg),[X_]=Np(gg,[lj,Dx]),Gx=Dx(),[cj,jp]=X_(gg),[uj,hj]=X_(gg),uR=d=>{const{__scopeSelect:h,children:_,open:T,defaultOpen:R,onOpenChange:D,value:B,defaultValue:r,onValueChange:q,dir:H,name:ie,autoComplete:Q,disabled:me,required:we,form:Ae}=d,he=Gx(h),[Re,Ne]=le.useState(null),[Ge,Ue]=le.useState(null),[rt,Pt]=le.useState(!1),Bt=sj(H),[Tt,Ht]=px({prop:T,defaultProp:R??!1,onChange:D,caller:gg}),[Ei,rn]=px({prop:B,defaultProp:r,onChange:q,caller:gg}),en=le.useRef(null),Ui=Re?Ae||!!Re.closest("form"):!0,[si,Ji]=le.useState(new Set),Si=Array.from(si).map(Xe=>Xe.props.value).join(";");return ee.jsx(ek,{...he,children:ee.jsxs(cj,{required:we,scope:h,trigger:Re,onTriggerChange:Ne,valueNode:Ge,onValueNodeChange:Ue,valueNodeHasChildren:rt,onValueNodeHasChildrenChange:Pt,contentId:z_(),value:Ei,onValueChange:rn,open:Tt,onOpenChange:Ht,dir:Bt,triggerPointerDownPosRef:en,disabled:me,children:[ee.jsx(Ux.Provider,{scope:h,children:ee.jsx(uj,{scope:d.__scopeSelect,onNativeOptionAdd:le.useCallback(Xe=>{Ji(gt=>new Set(gt).add(Xe))},[]),onNativeOptionRemove:le.useCallback(Xe=>{Ji(gt=>{const yt=new Set(gt);return yt.delete(Xe),yt})},[]),children:_})}),Ui?ee.jsxs(OR,{"aria-hidden":!0,required:we,tabIndex:-1,name:ie,autoComplete:Q,value:Ei,onChange:Xe=>rn(Xe.target.value),disabled:me,form:Ae,children:[Ei===void 0?ee.jsx("option",{value:""}):null,Array.from(si)]},Si):null]})})};uR.displayName=gg;var hR="SelectTrigger",dR=le.forwardRef((d,h)=>{const{__scopeSelect:_,disabled:T=!1,...R}=d,D=Gx(_),B=jp(hR,_),r=B.disabled||T,q=xs(h,B.onTriggerChange),H=Vx(_),ie=le.useRef("touch"),[Q,me,we]=zR(he=>{const Re=H().filter(Ue=>!Ue.disabled),Ne=Re.find(Ue=>Ue.value===B.value),Ge=LR(Re,he,Ne);Ge!==void 0&&B.onValueChange(Ge.value)}),Ae=he=>{r||(B.onOpenChange(!0),we()),he&&(B.triggerPointerDownPosRef.current={x:Math.round(he.pageX),y:Math.round(he.pageY)})};return ee.jsx(SC,{asChild:!0,...D,children:ee.jsx(hr.button,{type:"button",role:"combobox","aria-controls":B.contentId,"aria-expanded":B.open,"aria-required":B.required,"aria-autocomplete":"none",dir:B.dir,"data-state":B.open?"open":"closed",disabled:r,"data-disabled":r?"":void 0,"data-placeholder":PR(B.value)?"":void 0,...R,ref:q,onClick:Rr(R.onClick,he=>{he.currentTarget.focus(),ie.current!=="mouse"&&Ae(he)}),onPointerDown:Rr(R.onPointerDown,he=>{ie.current=he.pointerType;const Re=he.target;Re.hasPointerCapture(he.pointerId)&&Re.releasePointerCapture(he.pointerId),he.button===0&&he.ctrlKey===!1&&he.pointerType==="mouse"&&(Ae(he),he.preventDefault())}),onKeyDown:Rr(R.onKeyDown,he=>{const Re=Q.current!=="";!(he.ctrlKey||he.altKey||he.metaKey)&&he.key.length===1&&me(he.key),!(Re&&he.key===" ")&&oj.includes(he.key)&&(Ae(),he.preventDefault())})})})});dR.displayName=hR;var fR="SelectValue",pR=le.forwardRef((d,h)=>{const{__scopeSelect:_,className:T,style:R,children:D,placeholder:B="",...r}=d,q=jp(fR,_),{onValueNodeHasChildrenChange:H}=q,ie=D!==void 0,Q=xs(h,q.onValueNodeChange);return Wo(()=>{H(ie)},[H,ie]),ee.jsx(hr.span,{...r,ref:Q,style:{pointerEvents:"none"},children:PR(q.value)?ee.jsx(ee.Fragment,{children:B}):D})});pR.displayName=fR;var dj="SelectIcon",mR=le.forwardRef((d,h)=>{const{__scopeSelect:_,children:T,...R}=d;return ee.jsx(hr.span,{"aria-hidden":!0,...R,ref:h,children:T||""})});mR.displayName=dj;var fj="SelectPortal",gR=d=>ee.jsx(R1,{asChild:!0,...d});gR.displayName=fj;var _g="SelectContent",_R=le.forwardRef((d,h)=>{const _=jp(_g,d.__scopeSelect),[T,R]=le.useState();if(Wo(()=>{R(new DocumentFragment)},[]),!_.open){const D=T;return D?bv.createPortal(ee.jsx(yR,{scope:d.__scopeSelect,children:ee.jsx(Ux.Slot,{scope:d.__scopeSelect,children:ee.jsx("div",{children:d.children})})}),D):null}return ee.jsx(vR,{...d,ref:h})});_R.displayName=_g;var Ku=10,[yR,Up]=X_(_g),pj="SelectContentImpl",mj=N_("SelectContent.RemoveScroll"),vR=le.forwardRef((d,h)=>{const{__scopeSelect:_,position:T="item-aligned",onCloseAutoFocus:R,onEscapeKeyDown:D,onPointerDownOutside:B,side:r,sideOffset:q,align:H,alignOffset:ie,arrowPadding:Q,collisionBoundary:me,collisionPadding:we,sticky:Ae,hideWhenDetached:he,avoidCollisions:Re,...Ne}=d,Ge=jp(_g,_),[Ue,rt]=le.useState(null),[Pt,Bt]=le.useState(null),Tt=xs(h,Qt=>rt(Qt)),[Ht,Ei]=le.useState(null),[rn,en]=le.useState(null),Ui=Vx(_),[si,Ji]=le.useState(!1),Si=le.useRef(!1);le.useEffect(()=>{if(Ue)return OI(Ue)},[Ue]),SI();const Xe=le.useCallback(Qt=>{const[Ii,...fi]=Ui().map(Oi=>Oi.ref.current),[Ri]=fi.slice(-1),Fi=document.activeElement;for(const Oi of Qt)if(Oi===Fi||(Oi?.scrollIntoView({block:"nearest"}),Oi===Ii&&Pt&&(Pt.scrollTop=0),Oi===Ri&&Pt&&(Pt.scrollTop=Pt.scrollHeight),Oi?.focus(),document.activeElement!==Fi))return},[Ui,Pt]),gt=le.useCallback(()=>Xe([Ht,Ue]),[Xe,Ht,Ue]);le.useEffect(()=>{si&&gt()},[si,gt]);const{onOpenChange:yt,triggerPointerDownPosRef:mi}=Ge;le.useEffect(()=>{if(Ue){let Qt={x:0,y:0};const Ii=Ri=>{Qt={x:Math.abs(Math.round(Ri.pageX)-(mi.current?.x??0)),y:Math.abs(Math.round(Ri.pageY)-(mi.current?.y??0))}},fi=Ri=>{Qt.x<=10&&Qt.y<=10?Ri.preventDefault():Ue.contains(Ri.target)||yt(!1),document.removeEventListener("pointermove",Ii),mi.current=null};return mi.current!==null&&(document.addEventListener("pointermove",Ii),document.addEventListener("pointerup",fi,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Ii),document.removeEventListener("pointerup",fi,{capture:!0})}}},[Ue,yt,mi]),le.useEffect(()=>{const Qt=()=>yt(!1);return window.addEventListener("blur",Qt),window.addEventListener("resize",Qt),()=>{window.removeEventListener("blur",Qt),window.removeEventListener("resize",Qt)}},[yt]);const[Ci,Fe]=zR(Qt=>{const Ii=Ui().filter(Fi=>!Fi.disabled),fi=Ii.find(Fi=>Fi.ref.current===document.activeElement),Ri=LR(Ii,Qt,fi);Ri&&setTimeout(()=>Ri.ref.current.focus())}),wt=le.useCallback((Qt,Ii,fi)=>{const Ri=!Si.current&&!fi;(Ge.value!==void 0&&Ge.value===Ii||Ri)&&(Ei(Qt),Ri&&(Si.current=!0))},[Ge.value]),bt=le.useCallback(()=>Ue?.focus(),[Ue]),Gt=le.useCallback((Qt,Ii,fi)=>{const Ri=!Si.current&&!fi;(Ge.value!==void 0&&Ge.value===Ii||Ri)&&en(Qt)},[Ge.value]),ci=T==="popper"?c1:xR,Bi=ci===c1?{side:r,sideOffset:q,align:H,alignOffset:ie,arrowPadding:Q,collisionBoundary:me,collisionPadding:we,sticky:Ae,hideWhenDetached:he,avoidCollisions:Re}:{};return ee.jsx(yR,{scope:_,content:Ue,viewport:Pt,onViewportChange:Bt,itemRefCallback:wt,selectedItem:Ht,onItemLeave:bt,itemTextRefCallback:Gt,focusSelectedItem:gt,selectedItemText:rn,position:T,isPositioned:si,searchRef:Ci,children:ee.jsx(V1,{as:mj,allowPinchZoom:!0,children:ee.jsx(U1,{asChild:!0,trapped:Ge.open,onMountAutoFocus:Qt=>{Qt.preventDefault()},onUnmountAutoFocus:Rr(R,Qt=>{Ge.trigger?.focus({preventScroll:!0}),Qt.preventDefault()}),children:ee.jsx(Ax,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:D,onPointerDownOutside:B,onFocusOutside:Qt=>Qt.preventDefault(),onDismiss:()=>Ge.onOpenChange(!1),children:ee.jsx(ci,{role:"listbox",id:Ge.contentId,"data-state":Ge.open?"open":"closed",dir:Ge.dir,onContextMenu:Qt=>Qt.preventDefault(),...Ne,...Bi,onPlaced:()=>Ji(!0),ref:Tt,style:{display:"flex",flexDirection:"column",outline:"none",...Ne.style},onKeyDown:Rr(Ne.onKeyDown,Qt=>{const Ii=Qt.ctrlKey||Qt.altKey||Qt.metaKey;if(Qt.key==="Tab"&&Qt.preventDefault(),!Ii&&Qt.key.length===1&&Fe(Qt.key),["ArrowUp","ArrowDown","Home","End"].includes(Qt.key)){let Ri=Ui().filter(Fi=>!Fi.disabled).map(Fi=>Fi.ref.current);if(["ArrowUp","End"].includes(Qt.key)&&(Ri=Ri.slice().reverse()),["ArrowUp","ArrowDown"].includes(Qt.key)){const Fi=Qt.target,Oi=Ri.indexOf(Fi);Ri=Ri.slice(Oi+1)}setTimeout(()=>Xe(Ri)),Qt.preventDefault()}})})})})})})});vR.displayName=pj;var gj="SelectItemAlignedPosition",xR=le.forwardRef((d,h)=>{const{__scopeSelect:_,onPlaced:T,...R}=d,D=jp(_g,_),B=Up(_g,_),[r,q]=le.useState(null),[H,ie]=le.useState(null),Q=xs(h,Tt=>ie(Tt)),me=Vx(_),we=le.useRef(!1),Ae=le.useRef(!0),{viewport:he,selectedItem:Re,selectedItemText:Ne,focusSelectedItem:Ge}=B,Ue=le.useCallback(()=>{if(D.trigger&&D.valueNode&&r&&H&&he&&Re&&Ne){const Tt=D.trigger.getBoundingClientRect(),Ht=H.getBoundingClientRect(),Ei=D.valueNode.getBoundingClientRect(),rn=Ne.getBoundingClientRect();if(D.dir!=="rtl"){const Fi=rn.left-Ht.left,Oi=Ei.left-Fi,vn=Tt.left-Oi,Mr=Tt.width+vn,Vs=Math.max(Mr,Ht.width),Gs=window.innerWidth-Ku,Jr=zA(Oi,[Ku,Math.max(Ku,Gs-Vs)]);r.style.minWidth=Mr+"px",r.style.left=Jr+"px"}else{const Fi=Ht.right-rn.right,Oi=window.innerWidth-Ei.right-Fi,vn=window.innerWidth-Tt.right-Oi,Mr=Tt.width+vn,Vs=Math.max(Mr,Ht.width),Gs=window.innerWidth-Ku,Jr=zA(Oi,[Ku,Math.max(Ku,Gs-Vs)]);r.style.minWidth=Mr+"px",r.style.right=Jr+"px"}const en=me(),Ui=window.innerHeight-Ku*2,si=he.scrollHeight,Ji=window.getComputedStyle(H),Si=parseInt(Ji.borderTopWidth,10),Xe=parseInt(Ji.paddingTop,10),gt=parseInt(Ji.borderBottomWidth,10),yt=parseInt(Ji.paddingBottom,10),mi=Si+Xe+si+yt+gt,Ci=Math.min(Re.offsetHeight*5,mi),Fe=window.getComputedStyle(he),wt=parseInt(Fe.paddingTop,10),bt=parseInt(Fe.paddingBottom,10),Gt=Tt.top+Tt.height/2-Ku,ci=Ui-Gt,Bi=Re.offsetHeight/2,Qt=Re.offsetTop+Bi,Ii=Si+Xe+Qt,fi=mi-Ii;if(Ii<=Gt){const Fi=en.length>0&&Re===en[en.length-1].ref.current;r.style.bottom="0px";const Oi=H.clientHeight-he.offsetTop-he.offsetHeight,vn=Math.max(ci,Bi+(Fi?bt:0)+Oi+gt),Mr=Ii+vn;r.style.height=Mr+"px"}else{const Fi=en.length>0&&Re===en[0].ref.current;r.style.top="0px";const vn=Math.max(Gt,Si+he.offsetTop+(Fi?wt:0)+Bi)+fi;r.style.height=vn+"px",he.scrollTop=Ii-Gt+he.offsetTop}r.style.margin=`${Ku}px 0`,r.style.minHeight=Ci+"px",r.style.maxHeight=Ui+"px",T?.(),requestAnimationFrame(()=>we.current=!0)}},[me,D.trigger,D.valueNode,r,H,he,Re,Ne,D.dir,T]);Wo(()=>Ue(),[Ue]);const[rt,Pt]=le.useState();Wo(()=>{H&&Pt(window.getComputedStyle(H).zIndex)},[H]);const Bt=le.useCallback(Tt=>{Tt&&Ae.current===!0&&(Ue(),Ge?.(),Ae.current=!1)},[Ue,Ge]);return ee.jsx(yj,{scope:_,contentWrapper:r,shouldExpandOnScrollRef:we,onScrollButtonChange:Bt,children:ee.jsx("div",{ref:q,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:rt},children:ee.jsx(hr.div,{...R,ref:Q,style:{boxSizing:"border-box",maxHeight:"100%",...R.style}})})})});xR.displayName=gj;var _j="SelectPopperPosition",c1=le.forwardRef((d,h)=>{const{__scopeSelect:_,align:T="start",collisionPadding:R=Ku,...D}=d,B=Gx(_);return ee.jsx(EC,{...B,...D,ref:h,align:T,collisionPadding:R,style:{boxSizing:"border-box",...D.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});c1.displayName=_j;var[yj,W1]=X_(_g,{}),u1="SelectViewport",bR=le.forwardRef((d,h)=>{const{__scopeSelect:_,nonce:T,...R}=d,D=Up(u1,_),B=W1(u1,_),r=xs(h,D.onViewportChange),q=le.useRef(0);return ee.jsxs(ee.Fragment,{children:[ee.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:T}),ee.jsx(Ux.Slot,{scope:_,children:ee.jsx(hr.div,{"data-radix-select-viewport":"",role:"presentation",...R,ref:r,style:{position:"relative",flex:1,overflow:"hidden auto",...R.style},onScroll:Rr(R.onScroll,H=>{const ie=H.currentTarget,{contentWrapper:Q,shouldExpandOnScrollRef:me}=B;if(me?.current&&Q){const we=Math.abs(q.current-ie.scrollTop);if(we>0){const Ae=window.innerHeight-Ku*2,he=parseFloat(Q.style.minHeight),Re=parseFloat(Q.style.height),Ne=Math.max(he,Re);if(Ne<Ae){const Ge=Ne+we,Ue=Math.min(Ae,Ge),rt=Ge-Ue;Q.style.height=Ue+"px",Q.style.bottom==="0px"&&(ie.scrollTop=rt>0?rt:0,Q.style.justifyContent="flex-end")}}}q.current=ie.scrollTop})})})]})});bR.displayName=u1;var wR="SelectGroup",[vj,xj]=X_(wR),bj=le.forwardRef((d,h)=>{const{__scopeSelect:_,...T}=d,R=z_();return ee.jsx(vj,{scope:_,id:R,children:ee.jsx(hr.div,{role:"group","aria-labelledby":R,...T,ref:h})})});bj.displayName=wR;var TR="SelectLabel",wj=le.forwardRef((d,h)=>{const{__scopeSelect:_,...T}=d,R=xj(TR,_);return ee.jsx(hr.div,{id:R.id,...T,ref:h})});wj.displayName=TR;var bx="SelectItem",[Tj,SR]=X_(bx),ER=le.forwardRef((d,h)=>{const{__scopeSelect:_,value:T,disabled:R=!1,textValue:D,...B}=d,r=jp(bx,_),q=Up(bx,_),H=r.value===T,[ie,Q]=le.useState(D??""),[me,we]=le.useState(!1),Ae=xs(h,Ge=>q.itemRefCallback?.(Ge,T,R)),he=z_(),Re=le.useRef("touch"),Ne=()=>{R||(r.onValueChange(T),r.onOpenChange(!1))};if(T==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return ee.jsx(Tj,{scope:_,value:T,disabled:R,textId:he,isSelected:H,onItemTextChange:le.useCallback(Ge=>{Q(Ue=>Ue||(Ge?.textContent??"").trim())},[]),children:ee.jsx(Ux.ItemSlot,{scope:_,value:T,disabled:R,textValue:ie,children:ee.jsx(hr.div,{role:"option","aria-labelledby":he,"data-highlighted":me?"":void 0,"aria-selected":H&&me,"data-state":H?"checked":"unchecked","aria-disabled":R||void 0,"data-disabled":R?"":void 0,tabIndex:R?void 0:-1,...B,ref:Ae,onFocus:Rr(B.onFocus,()=>we(!0)),onBlur:Rr(B.onBlur,()=>we(!1)),onClick:Rr(B.onClick,()=>{Re.current!=="mouse"&&Ne()}),onPointerUp:Rr(B.onPointerUp,()=>{Re.current==="mouse"&&Ne()}),onPointerDown:Rr(B.onPointerDown,Ge=>{Re.current=Ge.pointerType}),onPointerMove:Rr(B.onPointerMove,Ge=>{Re.current=Ge.pointerType,R?q.onItemLeave?.():Re.current==="mouse"&&Ge.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Rr(B.onPointerLeave,Ge=>{Ge.currentTarget===document.activeElement&&q.onItemLeave?.()}),onKeyDown:Rr(B.onKeyDown,Ge=>{q.searchRef?.current!==""&&Ge.key===" "||(aj.includes(Ge.key)&&Ne(),Ge.key===" "&&Ge.preventDefault())})})})})});ER.displayName=bx;var ov="SelectItemText",AR=le.forwardRef((d,h)=>{const{__scopeSelect:_,className:T,style:R,...D}=d,B=jp(ov,_),r=Up(ov,_),q=SR(ov,_),H=hj(ov,_),[ie,Q]=le.useState(null),me=xs(h,Ne=>Q(Ne),q.onItemTextChange,Ne=>r.itemTextRefCallback?.(Ne,q.value,q.disabled)),we=ie?.textContent,Ae=le.useMemo(()=>ee.jsx("option",{value:q.value,disabled:q.disabled,children:we},q.value),[q.disabled,q.value,we]),{onNativeOptionAdd:he,onNativeOptionRemove:Re}=H;return Wo(()=>(he(Ae),()=>Re(Ae)),[he,Re,Ae]),ee.jsxs(ee.Fragment,{children:[ee.jsx(hr.span,{id:q.textId,...D,ref:me}),q.isSelected&&B.valueNode&&!B.valueNodeHasChildren?bv.createPortal(D.children,B.valueNode):null]})});AR.displayName=ov;var CR="SelectItemIndicator",IR=le.forwardRef((d,h)=>{const{__scopeSelect:_,...T}=d;return SR(CR,_).isSelected?ee.jsx(hr.span,{"aria-hidden":!0,...T,ref:h}):null});IR.displayName=CR;var h1="SelectScrollUpButton",RR=le.forwardRef((d,h)=>{const _=Up(h1,d.__scopeSelect),T=W1(h1,d.__scopeSelect),[R,D]=le.useState(!1),B=xs(h,T.onScrollButtonChange);return Wo(()=>{if(_.viewport&&_.isPositioned){let r=function(){const H=q.scrollTop>0;D(H)};const q=_.viewport;return r(),q.addEventListener("scroll",r),()=>q.removeEventListener("scroll",r)}},[_.viewport,_.isPositioned]),R?ee.jsx(DR,{...d,ref:B,onAutoScroll:()=>{const{viewport:r,selectedItem:q}=_;r&&q&&(r.scrollTop=r.scrollTop-q.offsetHeight)}}):null});RR.displayName=h1;var d1="SelectScrollDownButton",MR=le.forwardRef((d,h)=>{const _=Up(d1,d.__scopeSelect),T=W1(d1,d.__scopeSelect),[R,D]=le.useState(!1),B=xs(h,T.onScrollButtonChange);return Wo(()=>{if(_.viewport&&_.isPositioned){let r=function(){const H=q.scrollHeight-q.clientHeight,ie=Math.ceil(q.scrollTop)<H;D(ie)};const q=_.viewport;return r(),q.addEventListener("scroll",r),()=>q.removeEventListener("scroll",r)}},[_.viewport,_.isPositioned]),R?ee.jsx(DR,{...d,ref:B,onAutoScroll:()=>{const{viewport:r,selectedItem:q}=_;r&&q&&(r.scrollTop=r.scrollTop+q.offsetHeight)}}):null});MR.displayName=d1;var DR=le.forwardRef((d,h)=>{const{__scopeSelect:_,onAutoScroll:T,...R}=d,D=Up("SelectScrollButton",_),B=le.useRef(null),r=Vx(_),q=le.useCallback(()=>{B.current!==null&&(window.clearInterval(B.current),B.current=null)},[]);return le.useEffect(()=>()=>q(),[q]),Wo(()=>{r().find(ie=>ie.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[r]),ee.jsx(hr.div,{"aria-hidden":!0,...R,ref:h,style:{flexShrink:0,...R.style},onPointerDown:Rr(R.onPointerDown,()=>{B.current===null&&(B.current=window.setInterval(T,50))}),onPointerMove:Rr(R.onPointerMove,()=>{D.onItemLeave?.(),B.current===null&&(B.current=window.setInterval(T,50))}),onPointerLeave:Rr(R.onPointerLeave,()=>{q()})})}),Sj="SelectSeparator",Ej=le.forwardRef((d,h)=>{const{__scopeSelect:_,...T}=d;return ee.jsx(hr.div,{"aria-hidden":!0,...T,ref:h})});Ej.displayName=Sj;var f1="SelectArrow",Aj=le.forwardRef((d,h)=>{const{__scopeSelect:_,...T}=d,R=Gx(_),D=jp(f1,_),B=Up(f1,_);return D.open&&B.position==="popper"?ee.jsx(AC,{...R,...T,ref:h}):null});Aj.displayName=f1;var Cj="SelectBubbleInput",OR=le.forwardRef(({__scopeSelect:d,value:h,..._},T)=>{const R=le.useRef(null),D=xs(T,R),B=tR(h);return le.useEffect(()=>{const r=R.current;if(!r)return;const q=window.HTMLSelectElement.prototype,ie=Object.getOwnPropertyDescriptor(q,"value").set;if(B!==h&&ie){const Q=new Event("change",{bubbles:!0});ie.call(r,h),r.dispatchEvent(Q)}},[B,h]),ee.jsx(hr.select,{..._,style:{...CC,..._.style},ref:D,defaultValue:h})});OR.displayName=Cj;function PR(d){return d===""||d===void 0}function zR(d){const h=kp(d),_=le.useRef(""),T=le.useRef(0),R=le.useCallback(B=>{const r=_.current+B;h(r),(function q(H){_.current=H,window.clearTimeout(T.current),H!==""&&(T.current=window.setTimeout(()=>q(""),1e3))})(r)},[h]),D=le.useCallback(()=>{_.current="",window.clearTimeout(T.current)},[]);return le.useEffect(()=>()=>window.clearTimeout(T.current),[]),[_,R,D]}function LR(d,h,_){const R=h.length>1&&Array.from(h).every(H=>H===h[0])?h[0]:h,D=_?d.indexOf(_):-1;let B=Ij(d,Math.max(D,0));R.length===1&&(B=B.filter(H=>H!==_));const q=B.find(H=>H.textValue.toLowerCase().startsWith(R.toLowerCase()));return q!==_?q:void 0}function Ij(d,h){return d.map((_,T)=>d[(h+T)%d.length])}var Rj=uR,Mj=dR,Dj=pR,Oj=mR,Pj=gR,zj=_R,Lj=bR,kj=ER,Bj=AR,Fj=IR,Nj=RR,jj=MR;function Uj({...d}){return ee.jsx(Rj,{"data-slot":"select",...d})}function Vj({...d}){return ee.jsx(Dj,{"data-slot":"select-value",...d})}function Gj({className:d,size:h="default",children:_,...T}){return ee.jsxs(Mj,{"data-slot":"select-trigger","data-size":h,className:bs("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",d),...T,children:[_,ee.jsx(Oj,{asChild:!0,children:ee.jsx(XC,{className:"size-4 opacity-50"})})]})}function qj({className:d,children:h,position:_="popper",align:T="center",...R}){return ee.jsx(Pj,{children:ee.jsxs(zj,{"data-slot":"select-content",className:bs("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",_==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",d),position:_,align:T,...R,children:[ee.jsx($j,{}),ee.jsx(Lj,{className:bs("p-1",_==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:h}),ee.jsx(Zj,{})]})})}function Hj({className:d,children:h,..._}){return ee.jsxs(kj,{"data-slot":"select-item",className:bs("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",d),..._,children:[ee.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:ee.jsx(Fj,{children:ee.jsx(O1,{className:"size-4"})})}),ee.jsx(Bj,{children:h})]})}function $j({className:d,...h}){return ee.jsx(Nj,{"data-slot":"select-scroll-up-button",className:bs("flex cursor-default items-center justify-center py-1",d),...h,children:ee.jsx(g3,{className:"size-4"})})}function Zj({className:d,...h}){return ee.jsx(jj,{"data-slot":"select-scroll-down-button",className:bs("flex cursor-default items-center justify-center py-1",d),...h,children:ee.jsx(XC,{className:"size-4"})})}const Wj=100,kR=1,BR=.1,tx=5e3,p1="snail-focus-request",m1="pending-snail-focus";function Xj(d){return d.map(([h,_])=>({lat:_,lng:h}))}function Yj(d){return d.map(h=>[h.lng,h.lat])}function g1(d,h,_=new Date){const T=h.getTime()-d.getTime();if(T<=0)return 1;const R=_.getTime()-d.getTime();return Math.min(Math.max(R/T,0),1)}function FR(d){const h=[0];let _=0;for(let T=1;T<d.length;T++){const R=F_(d[T-1],d[T]);_+=R,h.push(_)}return h}function Kj(d,h){if(d.length===0)throw new Error("Path must contain at least one point");if(h<=0)return d[0];if(h>=1)return d[d.length-1];const _=FR(d),R=_[_.length-1]*h;for(let D=1;D<_.length;D++)if(R<=_[D]){const B=d[D-1],r=d[D],q=_[D]-_[D-1],H=(R-_[D-1])/q;return{lat:B.lat+(r.lat-B.lat)*H,lng:B.lng+(r.lng-B.lng)*H}}return d[d.length-1]}function LA(d,h,_,T=new Date){const R=Xj(d),D=g1(h,_,T),B=Kj(R,D),r=FR(R),H=r[r.length-1]*D,ie=[],Q=[];for(let me=0;me<R.length;me++)r[me]<=H?ie.push(R[me]):Q.push(R[me]);return ie.length>0&&Q.length>0&&(ie.push(B),Q.unshift(B)),{currentPosition:B,progress:D,isComplete:D>=1,pastTrail:ie,futureTrail:Q}}function F_(d,h){const T=q=>q*Math.PI/180,R=T(h.lat-d.lat),D=T(h.lng-d.lng),B=Math.sin(R/2)*Math.sin(R/2)+Math.cos(T(d.lat))*Math.cos(T(h.lat))*Math.sin(D/2)*Math.sin(D/2);return 6371e3*(2*Math.atan2(Math.sqrt(B),Math.sqrt(1-B)))}function Jj(d,h,_=50){return F_(d,h)<=_}function kA(d,h=new Date){const _=d.getTime()-h.getTime();return Math.max(0,_/(1e3*60*60))}function Qj(d=new Date,h=BR){return new Date(d.getTime()+h*60*60*1e3)}function NR(){const{user:d}=hd(),[h,_]=le.useState([]),[T,R]=le.useState(!0),[D,B]=le.useState(null),r=le.useCallback(async()=>{if(!d){_([]),R(!1);return}R(!0);try{await Zr.rpc("check_and_sync_snails")}catch{}const{data:me,error:we}=await Zr.from("snails").select("*").or(`sender_id.eq.${d.id},target_id.eq.${d.id}`).eq("status","moving").order("start_time",{ascending:!1});if(we){B(we),R(!1);return}_(me??[]),R(!1)},[d]);le.useEffect(()=>{r()},[r]),le.useEffect(()=>{if(!d)return;const me=Zr.channel("snails-changes").on("postgres_changes",{event:"*",schema:"public",table:"snails"},()=>{r()}).subscribe();return()=>{Zr.removeChannel(me)}},[d,r]);const q=le.useCallback(async(me,we,Ae,he)=>{if(!d)throw new Error("Not authenticated");const{data:Re,error:Ne}=await Zr.rpc("deploy_snail",{p_target_id:me,p_friendship_id:we,p_path_json:Ae,p_arrival_time:he.toISOString()});if(Ne)throw Ne;return await r(),Re},[d,r]),H=le.useCallback(async me=>{if(!d)throw new Error("Not authenticated");const{data:we,error:Ae}=await Zr.rpc("intercept_snail",{p_snail_id:me});if(Ae)throw Ae;return await r(),we},[d,r]),ie=h.filter(me=>me.target_id===d?.id),Q=h.filter(me=>me.sender_id===d?.id);return{snails:h,incomingSnails:ie,outgoingSnails:Q,loading:T,error:D,deploySnail:q,interceptSnail:H,refresh:r}}const jR=le.createContext(null);function e4({children:d}){const{user:h}=hd(),[_,T]=le.useState(null),[R,D]=le.useState(!0),[B,r]=le.useState(null),q=le.useCallback(async()=>{if(!h){T(null),D(!1);return}D(!0);const{data:we,error:Ae}=await Zr.from("profiles").select("*").eq("id",h.id).single();Ae?Ae.code==="PGRST116"?T(null):r(Ae):T(we),D(!1)},[h]);le.useEffect(()=>{q()},[q]);const H=le.useCallback(async(we,Ae,he)=>{const Re=he??h?.id;if(!Re)throw new Error("Not authenticated");const Ne={id:Re,username:we};Ae&&(Ne.home_location=`POINT(${Ae.lng} ${Ae.lat})`);const{data:Ge,error:Ue}=await Zr.from("profiles").insert(Ne).select().single();if(Ue)throw Ue;return(!he||he===h?.id)&&T(Ge),Ge},[h]),ie=le.useCallback(async we=>{if(!h)throw new Error("Not authenticated");const{data:Ae,error:he}=await Zr.from("profiles").update(we).eq("id",h.id).select().single();if(he)throw he;return T(Ae),Ae},[h]),Q=le.useCallback(async(we,Ae)=>{if(!h)throw new Error("Not authenticated");const{error:he}=await Zr.from("profiles").update({home_location:`POINT(${Ae} ${we})`}).eq("id",h.id);if(he)throw he;await q()},[h,q]),me=le.useCallback(async()=>{if(!h)throw new Error("Not authenticated");const{data:we,error:Ae}=await Zr.rpc("purchase_snail");if(Ae)throw Ae;return T(he=>he&&{...he,salt_balance:typeof we?.salt_balance=="number"?we.salt_balance:he.salt_balance,snail_inventory:typeof we?.snail_inventory=="number"?we.snail_inventory:he.snail_inventory}),we},[h]);return ee.jsx(jR.Provider,{value:{profile:_,loading:R,error:B,createProfile:H,updateProfile:ie,updateHomeLocation:Q,purchaseSnail:me,refresh:q},children:d})}function Ev(){const d=le.useContext(jR);if(!d)throw new Error("useProfile must be used within a ProfileProvider");return d}function UR(){const{user:d}=hd(),[h,_]=le.useState([]),[T,R]=le.useState(!0),[D,B]=le.useState(null),[r,q]=le.useState([]),[H,ie]=le.useState(!1),Q=le.useCallback(async()=>{if(!d){_([]),R(!1);return}R(!0);const{data:Ue,error:rt}=await Zr.rpc("get_friendships_with_profiles");if(rt)B(rt),_([]);else{B(null);const Pt=(Ue??[]).map(Bt=>({...Bt,requester_username:Bt.requester_username??"Mystery Player",addressee_username:Bt.addressee_username??"Mystery Player",requester_home_location:Bt.requester_home_location??null,addressee_home_location:Bt.addressee_home_location??null}));_(Pt)}R(!1)},[d]);le.useEffect(()=>{Q()},[Q]),le.useEffect(()=>{if(!d)return;const Ue=Zr.channel(`friendships-${d.id}`).on("postgres_changes",{event:"*",schema:"public",table:"friendships"},()=>{Q()}).subscribe();return()=>{Zr.removeChannel(Ue)}},[d,Q]);const me=le.useCallback(async Ue=>{const rt=Ue.trim();if(!rt)return q([]),[];ie(!0);const{data:Pt,error:Bt}=await Zr.rpc("search_profiles",{p_query:rt});if(ie(!1),Bt)throw B(Bt),Bt;const Tt=Pt??[];return q(Tt),Tt},[]),we=le.useCallback(()=>{q([])},[]),Ae=le.useCallback(async Ue=>{if(!d)throw new Error("Not authenticated");const{data:rt,error:Pt}=await Zr.rpc("request_friend",{p_target_id:Ue});if(Pt)throw B(Pt),Pt;return await Q(),rt},[d,Q]),he=le.useCallback(async(Ue,rt)=>{if(!d)throw new Error("Not authenticated");const{error:Pt}=await Zr.rpc("respond_friend_request",{p_friendship_id:Ue,p_accept:rt});if(Pt)throw B(Pt),Pt;await Q()},[d,Q]),Re=le.useMemo(()=>h.filter(Ue=>Ue.status==="friends"),[h]),Ne=le.useMemo(()=>h.filter(Ue=>Ue.status==="requested"&&Ue.addressee_id===d?.id),[h,d?.id]),Ge=le.useMemo(()=>h.filter(Ue=>Ue.status==="requested"&&Ue.requester_id===d?.id),[h,d?.id]);return{friendships:h,friends:Re,incomingRequests:Ne,outgoingRequests:Ge,loading:T,error:D,searchResults:r,searching:H,searchProfiles:me,clearSearchResults:we,requestFriend:Ae,respondToRequest:he,refresh:Q}}const t4=/POINT\s*\(([-\d.]+)\s+([-\d.]+)\)/i;function i4(d){const h=d.trim();if(!/^[0-9a-fA-F]+$/.test(h)||h.length%2!==0)return null;const _=new Uint8Array(h.length/2);for(let T=0;T<h.length;T+=2)_[T/2]=parseInt(h.slice(T,T+2),16);return new DataView(_.buffer)}function n4(d){const h=i4(d);if(!h)return null;const _=h.getUint8(0)===1;let T=1;const R=h.getUint32(T,_);if(T+=4,R&536870912&&(T+=4),T+16>h.byteLength)return null;const D=h.getFloat64(T,_),B=h.getFloat64(T+8,_);return Number.isFinite(B)&&Number.isFinite(D)?{lat:B,lng:D}:null}function ix(d){if(!d)return null;if(typeof d=="object"&&d!==null&&"coordinates"in d&&Array.isArray(d.coordinates)){const h=d.coordinates;if(h.length>=2){const[_,T]=h;return{lat:T,lng:_}}}if(typeof d=="string"){const h=d.match(t4);if(h){const[,T,R]=h;return{lat:Number(R),lng:Number(T)}}const _=n4(d);if(_)return _}return null}function nx(d,h,_=64){const T=[];for(let D=0;D<=_;D++){const B=D/_*2*Math.PI,r=h/6371e3*Math.cos(B),q=h/6371e3*Math.sin(B),H=d.lat+q*180/Math.PI,ie=d.lng+r*180/Math.PI/Math.cos(d.lat*Math.PI/180);T.push([ie,H])}return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[T]}}}function r4(d,h,_=kR*1e3){const T=F_(d,h);if(T===0)return{lat:d.lat,lng:d.lng+_/111320};const R=_/T;return{lat:d.lat+(h.lat-d.lat)*R,lng:d.lng+(h.lng-d.lng)*R}}const s4="https://router.project-osrm.org";async function o4(d,h){const _=`${s4}/route/v1/foot/${d.lng},${d.lat};${h.lng},${h.lat}?overview=full&geometries=geojson`,T=await fetch(_);if(!T.ok)throw new Error("Failed to fetch walking route");const R=await T.json();if(!R?.routes?.length)throw new Error("No walking route found");const D=R.routes[0];return{coordinates:D.geometry.coordinates.map(([B,r])=>({lat:r,lng:B})),distance:D.distance,duration:D.duration}}const BA="map-layer-visibility",Rp=()=>({type:"FeatureCollection",features:[]});function a4(){const{user:d}=hd(),{incomingSnails:h,outgoingSnails:_,snails:T,refresh:R,interceptSnail:D,deploySnail:B}=NR(),{profile:r,refresh:q}=Ev(),{friends:H}=UR(),{newNotification:ie,clearNewNotification:Q,markAsRead:me,refresh:we}=$1(),Ae=le.useMemo(()=>{const ot=new Map;for(const It of H)It.requester_id===d?.id?ot.set(It.addressee_id,It.addressee_home_location):ot.set(It.requester_id,It.requester_home_location);return ot},[H,d?.id]),he=le.useMemo(()=>{const ot=new Map;for(const It of H)It.requester_id===d?.id?ot.set(It.addressee_id,It.addressee_username):ot.set(It.requester_id,It.requester_username);return ot},[H,d?.id]),Re=le.useMemo(()=>Array.from(he.keys()),[he]),Ne=()=>{try{const ot=localStorage.getItem(BA);if(ot){const It=JSON.parse(ot);return{homeBase:It.homeBase??!0,incomingSnails:It.incomingSnails??!0,outgoingSnails:new Map(Object.entries(It.outgoingSnails||{}))}}}catch(ot){console.error("Failed to load layer visibility",ot)}return{homeBase:!0,incomingSnails:!0,outgoingSnails:new Map}},Ge=ot=>{try{localStorage.setItem(BA,JSON.stringify({homeBase:ot.homeBase,incomingSnails:ot.incomingSnails,outgoingSnails:Object.fromEntries(ot.outgoingSnails)}))}catch(It){console.error("Failed to save layer visibility",It)}},[Ue,rt]=le.useState(Ne),[Pt,Bt]=le.useState(!1),[Tt,Ht]=le.useState(!1),[Ei,rn]=le.useState(!1),[en,Ui]=le.useState(null),[si,Ji]=le.useState(!1),[Si,Xe]=le.useState(null),[gt,yt]=le.useState(null),[mi,Ci]=le.useState(null),[Fe,wt]=le.useState(null),[bt,Gt]=le.useState(!1),ci=tx/1e3,Bi=le.useCallback(()=>{yt(null),Ci(null),wt(null),Gt(!1)},[]),Qt=le.useMemo(()=>ix(r?.home_location),[r?.home_location]),Ii=ot=>ot.requester_id===d?.id?ot.addressee_username||"Mystery Player":ot.requester_username||"Mystery Player",fi=r?.snail_inventory??0,Ri=fi>0,Fi=le.useMemo(()=>H.map(ot=>{const It=ot.requester_id===d?.id,ui=It?ot.addressee_id:ot.requester_id,Mn=Ii(ot),In=ix(It?ot.addressee_home_location:ot.requester_home_location);return{friendshipId:ot.id,profileId:ui,username:Mn,homeLocation:In}}),[H,d?.id]),Oi=le.useMemo(()=>Fi.find(ot=>ot.friendshipId===en),[Fi,en]),vn=le.useMemo(()=>!Oi?.homeLocation||!gt?null:F_(Oi.homeLocation,gt)/1e3,[Oi?.homeLocation,gt]),Mr=le.useMemo(()=>{if(Oi?.homeLocation)return[Oi.homeLocation.lng,Oi.homeLocation.lat];if(Qt)return[Qt.lng,Qt.lat]},[Oi?.homeLocation,Qt]);le.useEffect(()=>{Ge(Ue)},[Ue]),le.useEffect(()=>{rt(ot=>{const It=new Map(ot.outgoingSnails);for(const ui of Re)It.has(ui)||It.set(ui,!0);return{...ot,outgoingSnails:It}})},[Re]),le.useEffect(()=>{if(Fi.length===0){Ui(null);return}if(en&&Fi.some(It=>It.friendshipId===en))return;const ot=Fi.find(It=>It.homeLocation)??Fi[0];Ui(ot?.friendshipId??null)},[Fi,en]),le.useEffect(()=>{yt(null),Ci(null),wt(null),Gt(!1)},[en]);const Vs=()=>{if(Fi.length===0){ns.error("Add a friend before deploying a snail.");return}if(!r){ns.error("Profile not loaded yet.");return}if(!Qt){ns.error("Set your home base before deploying snails.");return}if(!Ri){ns.error("You have no snails available.");return}const ot=Fi.find(It=>It.homeLocation)??Fi[0];Bi(),Ui(ot?.friendshipId??null),rn(!0)},Gs=async()=>{if(!r){ns.error("Profile not loaded yet.");return}if(!Qt){ns.error("Set your home base before deploying snails.");return}if(!Ri){ns.error("You have no snails available.");return}if(!Oi){ns.error("Select a friend to target.");return}if(!Oi.homeLocation){ns.error("This friend has not set their home base yet.");return}if(!gt||!mi){ns.error("Select a drop site to generate a walking route.");return}if(F_(Oi.homeLocation,gt)<tx){ns.error(`Pick a point at least ${ci.toFixed(1)}km from ${Oi.username}'s base.`);return}Ji(!0);try{const It=Yj(mi),ui=Qj();await B(Oi.profileId,Oi.friendshipId,It,ui),ns.success(`Snail deployed to ${Oi.username}`),rn(!1)}catch(It){const ui=It instanceof Error?It.message:"Failed to deploy snail";ns.error(ui)}finally{Ji(!1)}},Jr=le.useCallback(ot=>{Xe(ot),ot.addControl(new xx.NavigationControl({showCompass:!1}),"top-right"),ot.addSource("deploy-friend-home",{type:"geojson",data:Rp()}),ot.addLayer({id:"deploy-friend-home-fill",type:"fill",source:"deploy-friend-home",paint:{"fill-color":"#C084FC","fill-opacity":.2}}),ot.addLayer({id:"deploy-friend-home-outline",type:"line",source:"deploy-friend-home",paint:{"line-color":"#A855F7","line-width":2}}),ot.addSource("deploy-drop-boundary",{type:"geojson",data:Rp()}),ot.addLayer({id:"deploy-drop-boundary-outline",type:"line",source:"deploy-drop-boundary",paint:{"line-color":"#FBBF24","line-width":2,"line-dasharray":[1.5,1.5]}}),ot.addSource("deploy-target-point",{type:"geojson",data:Rp()}),ot.addLayer({id:"deploy-target-circle",type:"circle",source:"deploy-target-point",paint:{"circle-radius":8,"circle-color":"#22C55E","circle-stroke-width":2,"circle-stroke-color":"#FFFFFF"}}),ot.addSource("deploy-route-line",{type:"geojson",data:Rp()}),ot.addLayer({id:"deploy-route",type:"line",source:"deploy-route-line",paint:{"line-color":"#0EA5E9","line-width":3}})},[]);le.useEffect(()=>{if(!Si||!Ei)return;const ot=It=>{if(!Qt){ns.error("Set your home base before deploying snails.");return}if(!Oi?.homeLocation){ns.error("Ask this friend to set their home base first.");return}const ui={lat:It.lngLat.lat,lng:It.lngLat.lng};if(F_(Oi.homeLocation,ui)<tx){ns.error(`Drop site must be at least ${ci.toFixed(1)}km from ${Oi.username}'s base.`);return}yt(ui)};return Si.on("click",ot),()=>{Si.off("click",ot)}},[Si,Oi?.homeLocation,Oi?.username,Qt,ci,Ei]),le.useEffect(()=>{if(!Si)return;const ot=Si.getSource("deploy-friend-home"),It=Si.getSource("deploy-drop-boundary");!ot||!It||(Oi?.homeLocation?(ot.setData({type:"FeatureCollection",features:[nx(Oi.homeLocation,kR*1e3)]}),It.setData({type:"FeatureCollection",features:[nx(Oi.homeLocation,tx)]})):(ot?.setData(Rp()),It?.setData(Rp())))},[Si,Oi?.homeLocation]),le.useEffect(()=>{if(!Si)return;const ot=Si.getSource("deploy-target-point");ot&&(gt?ot.setData({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:[gt.lng,gt.lat]}}]}):ot.setData(Rp()))},[Si,gt]),le.useEffect(()=>{if(!Si)return;const ot=Si.getSource("deploy-route-line");ot&&(mi?ot.setData({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:mi.map(It=>[It.lng,It.lat])}}]}):ot.setData(Rp()))},[Si,mi]),le.useEffect(()=>{if(!gt||!Oi?.homeLocation){Ci(null),wt(null),Gt(!1);return}let ot=!1;Gt(!0);const It=r4(Oi.homeLocation,gt);return o4(gt,It).then(ui=>{if(ot)return;const Mn=ui.coordinates.length===0?[gt,It]:ui.coordinates.map((In,Xr,Gn)=>Xr===0?gt:Xr===Gn.length-1?It:In);Ci(Mn),wt({distanceMeters:ui.distance})}).catch(ui=>{if(ot)return;const Mn=ui instanceof Error?ui.message:"Failed to plan a walking route";ns.error(Mn),Ci(null),wt(null)}).finally(()=>{ot||Gt(!1)}),()=>{ot=!0}},[gt,Oi?.homeLocation]);const Cn=le.useRef(null),ws=le.useRef(void 0),[Ts,Aa]=le.useState(!1),[_r,go]=le.useState(null),[tr,Ss]=le.useState(()=>sessionStorage.getItem(m1)),[Ur,Xo]=le.useState(!1),io=le.useRef({x:0,y:0}),[Co,Vr]=le.useState(0),[Ps,Wr]=le.useState(null),Yo=le.useRef(new Set);le.useEffect(()=>{const ot=setInterval(()=>{Vr(It=>It+1)},1e3);return()=>clearInterval(ot)},[]),le.useEffect(()=>{const ot=new Date;T.some(ui=>new Date(ui.arrival_time)<=ot)&&R()},[Co,T,R]),le.useEffect(()=>{if(!(!_r||Ps))for(const ot of h){if(Yo.current.has(ot.id))continue;const It=LA(ot.path_json,new Date(ot.start_time),new Date(ot.arrival_time));if(Jj(_r,It.currentPosition,Wj)){Wr(ot);break}}},[_r,h,Ps,Co]);const $r=async()=>{Ps&&(await D(Ps.id),await q(),await we(),Wr(null))},yr=()=>{Ps&&Yo.current.add(Ps.id),Wr(null)};le.useEffect(()=>{if(Ur)return;if(!navigator.geolocation){console.error("Geolocation is not supported by this browser."),alert("Geolocation is not supported by your browser. This game requires GPS access.");return}const ot=navigator.geolocation.watchPosition(It=>{const ui={lat:It.coords.latitude,lng:It.coords.longitude};go(ui)},It=>{console.error("Geolocation error:",It);let ui="Unable to get your location. ";switch(It.code){case It.PERMISSION_DENIED:ui+="Please enable location permissions in your browser settings.";break;case It.POSITION_UNAVAILABLE:ui+="Location information is unavailable.";break;case It.TIMEOUT:ui+="Location request timed out.";break;default:ui+="An unknown error occurred.";break}alert(ui)},{enableHighAccuracy:!0,maximumAge:0,timeout:5e3});return()=>{navigator.geolocation.clearWatch(ot)}},[Ur]),le.useEffect(()=>{if(!Ur)return;const ot=1e3,It=1/111320;let ui,Mn=performance.now();const In=Xr=>{const Gn=(Xr-Mn)/1e3;Mn=Xr;const{x:pt,y:Yn}=io.current;(pt!==0||Yn!==0)&&go(or=>{if(!or)return{lat:1.3521,lng:103.8198};const vr=ot,Ni=It,Le=It/Math.cos(or.lat*Math.PI/180),J=or.lat+Yn*vr*Ni*Gn,re=or.lng+pt*vr*Le*Gn;return{lat:J,lng:re}}),ui=requestAnimationFrame(In)};return ui=requestAnimationFrame(In),()=>{cancelAnimationFrame(ui)}},[Ur]);const Gr=(ot,It)=>{io.current={x:ot,y:-It}},ha=()=>{Xo(ot=>!ot),!Ur&&!_r&&go({lat:1.3521,lng:103.8198})};le.useEffect(()=>{const ot=It=>{const ui=It.detail;typeof ui=="string"&&ui&&Ss(ui)};return window.addEventListener(p1,ot),()=>{window.removeEventListener(p1,ot)}},[]);const Ko=ot=>{console.log("handleMapLoad called"),Cn.current=ot,Aa(!0),ot.addSource("home-base-zone",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),ot.addLayer({id:"home-base-fill",type:"fill",source:"home-base-zone",paint:{"fill-color":"#3B82F6","fill-opacity":.3}}),ot.addLayer({id:"home-base-border",type:"line",source:"home-base-zone",paint:{"line-color":"#3B82F6","line-width":1}}),ot.addSource("friend-home-zones",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),ot.addLayer({id:"friend-home-fill",type:"fill",source:"friend-home-zones",paint:{"fill-color":"#A855F7","fill-opacity":.3}}),ot.addLayer({id:"friend-home-border",type:"line",source:"friend-home-zones",paint:{"line-color":"#A855F7","line-width":1}}),ot.addSource("home-base-label",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),ot.addSource("friend-home-labels",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),ot.addLayer({id:"home-base-label-text",type:"symbol",source:"home-base-label",layout:{"text-field":["get","label"],"text-size":14,"text-anchor":"center","text-offset":[0,0]},paint:{"text-color":"#3B82F6","text-halo-color":"#FFFFFF","text-halo-width":2}}),ot.addLayer({id:"friend-home-labels-text",type:"symbol",source:"friend-home-labels",layout:{"text-field":["get","label"],"text-size":14,"text-anchor":"center","text-offset":[0,0]},paint:{"text-color":"#A855F7","text-halo-color":"#FFFFFF","text-halo-width":2}}),ot.addSource("snail-trails",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),ot.addLayer({id:"past-trails",type:"line",source:"snail-trails",filter:["==",["get","trailType"],"past"],paint:{"line-color":["get","color"],"line-width":4}}),ot.addLayer({id:"future-trails",type:"line",source:"snail-trails",filter:["==",["get","trailType"],"future"],paint:{"line-color":["get","color"],"line-width":2,"line-dasharray":[2,2]}}),ot.addSource("snail-positions",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),ot.loadImage("/user-snail.webp",(It,ui)=>{!It&&ui&&(ot.hasImage("user-snail")||ot.addImage("user-snail",ui,{pixelRatio:2}))}),ot.loadImage("/enemy-snail.webp",(It,ui)=>{!It&&ui&&(ot.hasImage("enemy-snail")||ot.addImage("enemy-snail",ui,{pixelRatio:2}))}),ot.loadImage("/avatar.webp",(It,ui)=>{!It&&ui&&(ot.hasImage("avatar")||ot.addImage("avatar",ui,{pixelRatio:2}))}),ot.addLayer({id:"snail-marker-glow",type:"circle",source:"snail-positions",paint:{"circle-radius":["interpolate",["linear"],["zoom"],3,4,8,8,14,12,18,16],"circle-color":["case",["==",["get","direction"],"outgoing"],"rgba(34, 197, 94, 0.35)","rgba(248, 113, 113, 0.35)"],"circle-blur":.8}}),ot.addLayer({id:"snail-marker-emoji",type:"symbol",source:"snail-positions",layout:{"icon-image":["case",["==",["get","direction"],"outgoing"],"user-snail","enemy-snail"],"icon-size":["interpolate",["linear"],["zoom"],3,.05,14,.08,22,.4],"icon-rotate":["get","bearing"],"icon-rotation-alignment":"map","icon-allow-overlap":!0}}),ot.addSource("user-position",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Point",coordinates:[0,0]}}}),ot.addLayer({id:"user-marker",type:"symbol",source:"user-position",layout:{"icon-image":"avatar","icon-size":["interpolate",["linear"],["zoom"],3,1,14,1,22,.5],"icon-allow-overlap":!0}})},Es=(ot,It)=>{const ui=ot.getSource("user-position");ui&&ui.setData({type:"Feature",properties:{},geometry:{type:"Point",coordinates:[It.lng,It.lat]}})};le.useEffect(()=>{!Cn.current||!_r||!Ts||Es(Cn.current,_r)},[_r,Ts]),le.useEffect(()=>{if(!Cn.current||!Ts)return;const ot=Cn.current.getSource("home-base-zone"),It=Cn.current.getSource("home-base-label");if(!ot||!It)return;if(!Ue.homeBase){ot.setData({type:"FeatureCollection",features:[]}),It.setData({type:"FeatureCollection",features:[]});return}const ui=ix(r?.home_location);if(!ui){ot.setData({type:"FeatureCollection",features:[]}),It.setData({type:"FeatureCollection",features:[]});return}ot.setData({type:"FeatureCollection",features:[nx(ui,1e3)]}),It.setData({type:"FeatureCollection",features:[{type:"Feature",properties:{label:"Your Home Base"},geometry:{type:"Point",coordinates:[ui.lng,ui.lat]}}]})},[r?.home_location,Ts,Ue.homeBase]),le.useEffect(()=>{if(!Cn.current||!Ts)return;const ot=Cn.current.getSource("friend-home-zones"),It=Cn.current.getSource("friend-home-labels");if(!ot||!It)return;const ui=[],Mn=[],In=new Set;for(const Xr of _){if(!(Ue.outgoingSnails.get(Xr.target_id)??!0))continue;const pt=Ae.get(Xr.target_id),Yn=ix(pt);if(!Yn)continue;const or=`${Yn.lng},${Yn.lat}`;if(In.has(or))continue;In.add(or),ui.push(nx(Yn,1e3));const vr=he.get(Xr.target_id)??"Friend";Mn.push({type:"Feature",properties:{label:`${vr} Home Base`},geometry:{type:"Point",coordinates:[Yn.lng,Yn.lat]}})}ot.setData({type:"FeatureCollection",features:ui}),It.setData({type:"FeatureCollection",features:Mn})},[_,Ae,he,Ts,Ue.outgoingSnails]),le.useEffect(()=>{if(!Cn.current)return;const ot=Cn.current,It=ot.getSource("snail-trails"),ui=ot.getSource("snail-positions");if(!It||!ui)return;const Mn=[],In=[],Xr=new Map,Gn=(Yn,or)=>{const vr=_e=>_e*Math.PI/180,Ni=_e=>_e*180/Math.PI,Le=vr(or.lng-Yn.lng),J=vr(Yn.lat),re=vr(or.lat),ge=Math.sin(Le)*Math.cos(re),Me=Math.cos(J)*Math.sin(re)-Math.sin(J)*Math.cos(re)*Math.cos(Le);return(Ni(Math.atan2(ge,Me))+360)%360},pt=(Yn,or,vr)=>{for(const Ni of Yn){if(or==="incoming"&&!Ue.incomingSnails||or==="outgoing"&&!(Ue.outgoingSnails.get(Ni.target_id)??!0))continue;const Le=LA(Ni.path_json,new Date(Ni.start_time),new Date(Ni.arrival_time));let J=0;if(Le.futureTrail.length>0)J=Gn(Le.currentPosition,Le.futureTrail[0]);else if(Le.pastTrail.length>=2){const re=Le.pastTrail.length-1;J=Gn(Le.pastTrail[re-1],Le.pastTrail[re])}In.push({type:"Feature",properties:{snailId:Ni.id,direction:or,bearing:J},geometry:{type:"Point",coordinates:[Le.currentPosition.lng,Le.currentPosition.lat]}}),Xr.set(Ni.id,Le.currentPosition),Le.pastTrail.length>=2&&Mn.push({type:"Feature",properties:{trailType:"past",color:vr},geometry:{type:"LineString",coordinates:Le.pastTrail.map(re=>[re.lng,re.lat])}}),Le.futureTrail.length>=2&&or==="outgoing"&&Mn.push({type:"Feature",properties:{trailType:"future",color:vr},geometry:{type:"LineString",coordinates:Le.futureTrail.map(re=>[re.lng,re.lat])}})}};if(pt(h,"incoming","#EF4444"),pt(_,"outgoing","#22C55E"),It.setData({type:"FeatureCollection",features:Mn}),ui.setData({type:"FeatureCollection",features:In}),tr){const Yn=Xr.get(tr);Yn||console.warn("Snail focus requested but coordinates missing",tr,Array.from(Xr.keys())),Yn&&Cn.current&&(Cn.current.easeTo({center:[Yn.lng,Yn.lat],zoom:15,duration:1500}),Ss(null),sessionStorage.removeItem(m1))}},[h,_,tr,Ts,Co,Ue.incomingSnails,Ue.outgoingSnails]);const Io=[103.8198,1.3521],Ro=10.5,Jo=async()=>{ie&&(await me(ie.id),Q(),q())};return ee.jsxs("div",{className:"relative w-full h-screen",children:[ee.jsx(l1,{center:ws.current??Io,zoom:Ro,onMapLoad:Ko,className:"w-full h-full"}),!_r&&!Ur&&ee.jsx("div",{className:"absolute top-4 left-4 bg-card text-card-foreground px-4 py-2 rounded-lg shadow-md",children:ee.jsx("p",{className:"text-sm",children:"Acquiring GPS..."})}),ee.jsxs("div",{className:"absolute top-4 right-4 flex flex-col items-end gap-2",children:[ee.jsx(Us,{onClick:()=>Bt(!Pt),variant:"outline",size:"sm",className:"bg-card shadow-md",children:Pt?"Hide Layers":"Show Layers"}),Pt&&ee.jsxs("div",{className:"bg-card text-card-foreground rounded-lg shadow-lg p-4 min-w-[220px] max-h-[70vh] overflow-y-auto",children:[ee.jsx("h3",{className:"font-semibold mb-3 text-sm",children:"Map Layers"}),ee.jsxs("div",{className:"space-y-3",children:[ee.jsxs("div",{className:"flex items-center gap-2",children:[ee.jsx(Lw,{id:"layer-home-base",checked:Ue.homeBase,onCheckedChange:ot=>rt(It=>({...It,homeBase:ot===!0}))}),ee.jsx("label",{htmlFor:"layer-home-base",className:"text-sm cursor-pointer select-none",children:"Your Home Base"})]}),ee.jsxs("div",{className:"flex items-center gap-2",children:[ee.jsx(Lw,{id:"layer-incoming-snails",checked:Ue.incomingSnails,onCheckedChange:ot=>rt(It=>({...It,incomingSnails:ot===!0}))}),ee.jsx("label",{htmlFor:"layer-incoming-snails",className:"text-sm cursor-pointer select-none",children:"Incoming Snails"})]}),ee.jsxs("div",{className:"space-y-2",children:[ee.jsxs(Us,{onClick:()=>Ht(!Tt),variant:"ghost",size:"sm",className:"w-full justify-start h-auto py-1 px-2 text-sm font-normal",children:[ee.jsx("span",{className:"mr-1",children:Tt?"":""}),"Outgoing Snails"]}),Tt&&ee.jsx("div",{className:"ml-4 space-y-2",children:Re.length===0?ee.jsx("p",{className:"text-xs text-muted-foreground",children:"No friends yet"}):Re.map(ot=>{const It=he.get(ot)??"Unknown";return ee.jsxs("div",{className:"flex items-center gap-2",children:[ee.jsx(Lw,{id:`layer-friend-${ot}`,checked:Ue.outgoingSnails.get(ot)??!0,onCheckedChange:ui=>rt(Mn=>{const In=new Map(Mn.outgoingSnails);return In.set(ot,ui===!0),{...Mn,outgoingSnails:In}})}),ee.jsx("label",{htmlFor:`layer-friend-${ot}`,className:"text-xs cursor-pointer select-none",children:It})]},ot)})})]})]})]})]}),ee.jsxs("div",{className:"absolute bottom-20 right-6 pointer-events-none flex flex-col items-end gap-2",children:[ee.jsx(Us,{onClick:ha,variant:Ur?"default":"outline",size:"sm",className:`pointer-events-auto rounded-full px-4 py-1 h-8 ${Ur?"":"bg-white text-blue-500 hover:bg-gray-50 border-2 border-gray-300"}`,children:Ur?" Demo":" Demo"}),Ur&&ee.jsx("div",{className:"pointer-events-auto",children:ee.jsx(J5,{onMove:Gr,size:100})})]}),ee.jsx("div",{className:"absolute bottom-20 left-6",children:ee.jsx(Us,{onClick:Vs,size:"lg",className:"h-20 w-20 rounded-full bg-white hover:bg-gray-100 shadow-lg border-2 border-gray-300 p-3",children:ee.jsx("img",{src:"/user-snail.webp",alt:"Release Snail",className:"w-full h-full object-contain"})})}),ee.jsx(Y5,{notification:ie,onClose:Jo}),ee.jsx(K5,{open:!!Ps,senderUsername:Ps?he.get(Ps.sender_id)??"Unknown":"",onIntercept:$r,onClose:yr}),ee.jsx(cg,{open:Ei,onOpenChange:ot=>{rn(ot),ot||(Ji(!1),Bi(),Xe(null))},children:ee.jsxs(ug,{className:"max-w-lg",children:[ee.jsxs(hg,{children:[ee.jsx(dg,{children:"Deploy a snail"}),ee.jsxs(fg,{children:["Snails travel for ",BR," hours regardless of distance."]})]}),ee.jsxs("div",{className:"space-y-4",children:[ee.jsxs("div",{className:"relative h-64 rounded-lg border border-border/70 overflow-hidden",children:[Oi?.homeLocation?ee.jsx(l1,{center:Mr,zoom:12,onMapLoad:Jr,className:"h-full w-full"}):ee.jsx("div",{className:"flex h-full items-center justify-center px-4 text-center text-sm text-muted-foreground",children:"Select a friend to see their home base on the map."}),bt&&ee.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background/70 backdrop-blur-sm",children:ee.jsx(Pp,{className:"h-6 w-6 animate-spin text-primary"})})]}),gt&&vn!==null&&ee.jsxs("p",{className:"text-xs text-muted-foreground",children:["Drop site: ",vn.toFixed(2)," km from ",Oi?.username,"'s base",Fe&&` | Route: ${(Fe.distanceMeters/1e3).toFixed(2)} km`]}),ee.jsxs("div",{className:"space-y-2",children:[ee.jsx("p",{className:"text-sm font-medium text-foreground",children:"Target"}),Fi.length===0?ee.jsx("p",{className:"text-sm text-muted-foreground",children:"Add a friend to send a snail."}):ee.jsxs(Uj,{value:en??void 0,onValueChange:ot=>Ui(ot),children:[ee.jsx(Gj,{className:"w-full",children:ee.jsx(Vj,{placeholder:"Select a friend"})}),ee.jsx(qj,{children:Fi.map(ot=>ee.jsxs(Hj,{value:ot.friendshipId,disabled:!ot.homeLocation,children:[ot.username,!ot.homeLocation&&" (no home base)"]},ot.friendshipId))})]})]}),ee.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border/70 p-3",children:[ee.jsxs("div",{className:"flex items-center gap-2",children:[ee.jsx("span",{style:{fontSize:"20px"},children:""}),ee.jsx("p",{className:"text-sm text-muted-foreground",children:"Snails available"})]}),ee.jsx("p",{className:"font-gaegu font-bold text-2xl text-foreground",children:fi})]}),ee.jsxs("p",{className:"text-xs text-muted-foreground",children:["Click the map to place your snail. Drop site must be at least ",ci.toFixed(1)," km from their base."]})]}),ee.jsxs(JI,{children:[ee.jsx(Us,{variant:"outline",onClick:()=>rn(!1),children:"Cancel"}),ee.jsx(Us,{onClick:Gs,disabled:si||!Oi?.homeLocation||!Qt||!Ri||!mi||!gt||bt,children:si?ee.jsxs(ee.Fragment,{children:[ee.jsx(Pp,{className:"mr-2 h-4 w-4 animate-spin"}),"Deploying..."]}):"Deploy"})]})]})}),ee.jsx(Nx,{activeTab:"map"})]})}function Lp({children:d,className:h="",onClick:_}){return ee.jsx("div",{className:`rounded-[2.5rem_1.5rem_4rem_2rem] bg-white/80 border border-white/50 backdrop-blur-lg shadow-xl p-5 opacity-95 ${h}`,onClick:_,children:d})}function l4(){return KC.useSyncExternalStore(c4,()=>!0,()=>!1)}function c4(){return()=>{}}var X1="Avatar",[u4]=Np(X1),[h4,VR]=u4(X1),GR=le.forwardRef((d,h)=>{const{__scopeAvatar:_,...T}=d,[R,D]=le.useState("idle");return ee.jsx(h4,{scope:_,imageLoadingStatus:R,onImageLoadingStatusChange:D,children:ee.jsx(hr.span,{...T,ref:h})})});GR.displayName=X1;var qR="AvatarImage",HR=le.forwardRef((d,h)=>{const{__scopeAvatar:_,src:T,onLoadingStatusChange:R=()=>{},...D}=d,B=VR(qR,_),r=d4(T,D),q=kp(H=>{R(H),B.onImageLoadingStatusChange(H)});return Wo(()=>{r!=="idle"&&q(r)},[r,q]),r==="loaded"?ee.jsx(hr.img,{...D,ref:h,src:T}):null});HR.displayName=qR;var $R="AvatarFallback",ZR=le.forwardRef((d,h)=>{const{__scopeAvatar:_,delayMs:T,...R}=d,D=VR($R,_),[B,r]=le.useState(T===void 0);return le.useEffect(()=>{if(T!==void 0){const q=window.setTimeout(()=>r(!0),T);return()=>window.clearTimeout(q)}},[T]),B&&D.imageLoadingStatus!=="loaded"?ee.jsx(hr.span,{...R,ref:h}):null});ZR.displayName=$R;function FA(d,h){return d?h?(d.src!==h&&(d.src=h),d.complete&&d.naturalWidth>0?"loaded":"loading"):"error":"idle"}function d4(d,{referrerPolicy:h,crossOrigin:_}){const T=l4(),R=le.useRef(null),D=T?(R.current||(R.current=new window.Image),R.current):null,[B,r]=le.useState(()=>FA(D,d));return Wo(()=>{r(FA(D,d))},[D,d]),Wo(()=>{const q=Q=>()=>{r(Q)};if(!D)return;const H=q("loaded"),ie=q("error");return D.addEventListener("load",H),D.addEventListener("error",ie),h&&(D.referrerPolicy=h),typeof _=="string"&&(D.crossOrigin=_),()=>{D.removeEventListener("load",H),D.removeEventListener("error",ie)}},[D,_,h]),B}var f4=GR,p4=HR,m4=ZR;function av({className:d,...h}){return ee.jsx(f4,{"data-slot":"avatar",className:bs("relative flex size-8 shrink-0 overflow-hidden rounded-full",d),...h})}function g4({className:d,...h}){return ee.jsx(p4,{"data-slot":"avatar-image",className:bs("aspect-square size-full",d),...h})}function lv({className:d,...h}){return ee.jsx(m4,{"data-slot":"avatar-fallback",className:bs("bg-muted flex size-full items-center justify-center rounded-full",d),...h})}const _4=ZC("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function NA({className:d,variant:h,asChild:_=!1,...T}){const R=_?JA:"span";return ee.jsx(R,{"data-slot":"badge",className:bs(_4({variant:h}),d),...T})}var Y1="Progress",K1=100,[y4]=Np(Y1),[v4,x4]=y4(Y1),WR=le.forwardRef((d,h)=>{const{__scopeProgress:_,value:T=null,max:R,getValueLabel:D=b4,...B}=d;(R||R===0)&&!jA(R)&&console.error(w4(`${R}`,"Progress"));const r=jA(R)?R:K1;T!==null&&!UA(T,r)&&console.error(T4(`${T}`,"Progress"));const q=UA(T,r)?T:null,H=wx(q)?D(q,r):void 0;return ee.jsx(v4,{scope:_,value:q,max:r,children:ee.jsx(hr.div,{"aria-valuemax":r,"aria-valuemin":0,"aria-valuenow":wx(q)?q:void 0,"aria-valuetext":H,role:"progressbar","data-state":KR(q,r),"data-value":q??void 0,"data-max":r,...B,ref:h})})});WR.displayName=Y1;var XR="ProgressIndicator",YR=le.forwardRef((d,h)=>{const{__scopeProgress:_,...T}=d,R=x4(XR,_);return ee.jsx(hr.div,{"data-state":KR(R.value,R.max),"data-value":R.value??void 0,"data-max":R.max,...T,ref:h})});YR.displayName=XR;function b4(d,h){return`${Math.round(d/h*100)}%`}function KR(d,h){return d==null?"indeterminate":d===h?"complete":"loading"}function wx(d){return typeof d=="number"}function jA(d){return wx(d)&&!isNaN(d)&&d>0}function UA(d,h){return wx(d)&&!isNaN(d)&&d<=h&&d>=0}function w4(d,h){return`Invalid prop \`max\` of value \`${d}\` supplied to \`${h}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${K1}\`.`}function T4(d,h){return`Invalid prop \`value\` of value \`${d}\` supplied to \`${h}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${K1} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var S4=WR,E4=YR;function VA({className:d,value:h,variant:_="default",...T}){return ee.jsx(S4,{"data-slot":"progress",className:bs("relative h-3 w-full overflow-hidden rounded-full bg-white/30 backdrop-blur border border-border",d),...T,children:ee.jsx(E4,{"data-slot":"progress-indicator",className:bs("h-full w-full flex-1 rounded-full transition-all",_==="danger"?"bg-gradient-to-r from-red-500 to-red-300 shadow-[0_0_10px_rgba(239,68,68,0.5)]":"bg-gradient-to-r from-[var(--snail-green)] to-green-300 shadow-[0_0_10px_rgba(73,184,131,0.5)]"),style:{transform:`translateX(-${100-(h||0)}%)`}})})}function A4(){const{user:d}=hd(),{outgoingSnails:h,incomingSnails:_,loading:T}=NR(),{friends:R,incomingRequests:D,outgoingRequests:B,loading:r,error:q,searchResults:H,searching:ie,searchProfiles:Q,clearSearchResults:me,requestFriend:we,respondToRequest:Ae}=UR(),[he,Re]=le.useState(!1),[Ne,Ge]=le.useState(""),[Ue,rt]=le.useState(!1),[Pt,Bt]=le.useState(null),[Tt,Ht]=le.useState(null),[,Ei]=zx();le.useEffect(()=>{he||(Ge(""),rt(!1),me())},[he,me]);const rn=!r&&R.length===0&&D.length===0&&B.length===0,en=le.useMemo(()=>{const Fe=new Map;return R.forEach(wt=>{wt.requester_id&&Fe.set(wt.requester_id,wt.requester_username||"Mystery Player"),wt.addressee_id&&Fe.set(wt.addressee_id,wt.addressee_username||"Mystery Player")}),Fe},[R]),Ui=Fe=>Fe.requester_id===d?.id?Fe.addressee_username||"Mystery Player":Fe.requester_username||"Mystery Player",si=le.useCallback(Fe=>en.get(Fe)??"Mystery Player",[en]),Ji=async Fe=>{if(Fe.preventDefault(),!Ne.trim()){ns.error("Enter a username to search");return}rt(!0);try{await Q(Ne)}catch(wt){const bt=wt instanceof Error?wt.message:"Failed to search players";ns.error(bt)}},Si=async(Fe,wt)=>{Bt(Fe);try{await we(Fe),ns.success(`Friend request sent to ${wt}`),me(),Ge(""),rt(!1),Re(!1)}catch(bt){const Gt=bt instanceof Error?bt.message:"Failed to send request";ns.error(Gt)}finally{Bt(null)}},Xe=async(Fe,wt)=>{Ht(Fe);try{await Ae(Fe,wt),ns.success(wt?"Friend request accepted":"Friend request declined")}catch(bt){const Gt=bt instanceof Error?bt.message:"Failed to update request";ns.error(Gt)}finally{Ht(null)}},gt=le.useCallback(Fe=>{sessionStorage.setItem(m1,Fe),window.dispatchEvent(new CustomEvent(p1,{detail:Fe})),Ei("/")},[Ei]),yt=Fe=>{const wt=Math.max(0,Math.floor(Fe*60)),bt=Math.floor(wt/60),Gt=wt%60;return`${bt}h ${Gt}m left`},mi=h.map(Fe=>{const wt=new Date(Fe.start_time),bt=new Date(Fe.arrival_time),Gt=g1(wt,bt)*100,ci=kA(bt);return{...Fe,progress:Gt,remainingHours:ci,target_username:si(Fe.target_id)}}),Ci=_.map(Fe=>{const wt=new Date(Fe.start_time),bt=new Date(Fe.arrival_time),Gt=g1(wt,bt)*100,ci=kA(bt);return{...Fe,progress:Gt,remainingHours:ci,sender_username:si(Fe.sender_id)}});return ee.jsxs("div",{className:"relative min-h-screen pb-24",children:[ee.jsx("div",{className:"fixed inset-0 bg-cover bg-center opacity-40 pointer-events-none",style:{backgroundImage:"url('/background.png')"},"aria-hidden":"true"}),ee.jsxs("div",{className:"relative z-10 container max-w-screen-sm mx-auto py-6 space-y-6",children:[ee.jsxs(Lp,{children:[ee.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ee.jsx("h2",{className:"font-gaegu font-bold text-3xl text-foreground",children:"Friends"}),ee.jsxs(cg,{open:he,onOpenChange:Re,children:[ee.jsx(B5,{asChild:!0,children:ee.jsx(Us,{size:"sm",variant:"outline",className:"rounded-full w-8 h-8 p-0",children:ee.jsx(b3,{className:"w-4 h-4"})})}),ee.jsxs(ug,{children:[ee.jsxs(hg,{children:[ee.jsx(dg,{children:"Add a friend"}),ee.jsx(fg,{children:"Search for a player by username to send a request."})]}),ee.jsxs("form",{onSubmit:Ji,className:"space-y-4",children:[ee.jsx(ax,{placeholder:"Enter username",value:Ne,onChange:Fe=>Ge(Fe.target.value),autoFocus:!0}),ee.jsx(JI,{children:ee.jsx(Us,{type:"submit",disabled:ie,children:ie?ee.jsxs(ee.Fragment,{children:[ee.jsx(Pp,{className:"mr-2 h-4 w-4 animate-spin"}),"Searching"]}):"Search"})})]}),ee.jsx("div",{className:"space-y-2",children:Ue&&H.length===0?ee.jsx("p",{className:"text-sm text-muted-foreground",children:"No matching players found."}):H.map(Fe=>ee.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border/70 px-3 py-2",children:[ee.jsxs("div",{className:"flex items-center gap-3",children:[ee.jsx(av,{className:"h-8 w-8",children:ee.jsx(lv,{children:Fe.username.charAt(0).toUpperCase()})}),ee.jsx("p",{className:"text-sm font-medium",children:Fe.username})]}),ee.jsx(Us,{size:"sm",onClick:()=>Si(Fe.id,Fe.username),disabled:Pt===Fe.id,children:Pt===Fe.id?ee.jsxs(ee.Fragment,{children:[ee.jsx(Pp,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending..."]}):"Add"})]},Fe.id))})]})]})]}),q&&ee.jsx("p",{className:"text-red-500 text-sm mb-2",children:q.message}),r?ee.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Loading friends..."}):rn?ee.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Add a friend to start trading snails."}):ee.jsxs("div",{className:"space-y-5",children:[D.length>0&&ee.jsxs("div",{className:"space-y-2",children:[ee.jsx("p",{className:"text-sm font-medium text-foreground",children:"Incoming requests"}),D.map(Fe=>{const wt=Ui(Fe);return ee.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border border-border/70 p-3 sm:flex-row sm:items-center sm:justify-between",children:[ee.jsxs("div",{className:"flex items-center gap-3",children:[ee.jsx(av,{className:"h-10 w-10",children:ee.jsx(lv,{children:wt.charAt(0).toUpperCase()})}),ee.jsxs("div",{children:[ee.jsx("p",{className:"font-medium",children:wt}),ee.jsx("p",{className:"text-xs text-muted-foreground",children:"wants to connect"})]})]}),ee.jsxs("div",{className:"flex gap-2",children:[ee.jsx(Us,{variant:"outline",size:"sm",disabled:Tt===Fe.id,onClick:()=>Xe(Fe.id,!1),children:Tt===Fe.id?ee.jsx(Pp,{className:"h-4 w-4 animate-spin"}):ee.jsxs(ee.Fragment,{children:[ee.jsx(YC,{className:"mr-2 h-4 w-4"}),"Decline"]})}),ee.jsx(Us,{size:"sm",onClick:()=>Xe(Fe.id,!0),disabled:Tt===Fe.id,children:Tt===Fe.id?ee.jsx(Pp,{className:"h-4 w-4 animate-spin"}):ee.jsxs(ee.Fragment,{children:[ee.jsx(O1,{className:"mr-2 h-4 w-4"}),"Accept"]})})]})]},Fe.id)})]}),B.length>0&&ee.jsxs("div",{className:"space-y-2",children:[ee.jsx("p",{className:"text-sm font-medium text-foreground",children:"Pending requests"}),B.map(Fe=>{const wt=Ui(Fe);return ee.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-border/70 p-3",children:[ee.jsxs("div",{className:"flex items-center gap-3",children:[ee.jsx(av,{className:"h-8 w-8",children:ee.jsx(lv,{children:wt.charAt(0).toUpperCase()})}),ee.jsx("p",{className:"font-medium text-sm",children:wt})]}),ee.jsx(NA,{variant:"outline",children:"Waiting"})]},Fe.id)})]}),R.length>0&&ee.jsx("div",{className:"space-y-2",children:R.map(Fe=>{const wt=Ui(Fe);return ee.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-border/70 p-3",children:[ee.jsxs("div",{className:"flex items-center gap-3",children:[ee.jsx(av,{className:"h-10 w-10",children:ee.jsx(lv,{children:wt.charAt(0).toUpperCase()})}),ee.jsxs("div",{children:[ee.jsx("p",{className:"font-medium",children:wt}),ee.jsx("p",{className:"text-xs text-muted-foreground",children:"Ready for snail exchanges"})]})]}),ee.jsx(NA,{variant:"secondary",children:"Friend"})]},Fe.id)})})]})]}),ee.jsxs(Lp,{children:[ee.jsx("div",{className:"mb-4",children:ee.jsx("h2",{className:"font-gaegu font-bold text-3xl text-foreground",children:"Your Snails"})}),T?ee.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Loading..."}):mi.length===0?ee.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No active snails. Deploy one from the Garden tab!"}):ee.jsx("div",{className:"space-y-4",children:mi.map(Fe=>ee.jsxs("button",{type:"button",onClick:()=>gt(Fe.id),className:"w-full text-left space-y-2 rounded-lg border border-border/70 p-3 transition hover:bg-muted/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:[ee.jsxs("div",{className:"flex items-center justify-between",children:[ee.jsxs("div",{className:"flex items-center gap-2",children:[ee.jsx("img",{src:"/user-snail.webp",alt:"",className:"h-10 w-10"}),ee.jsxs("span",{className:"font-medium text-foreground",children:["To ",Fe.target_username]})]}),ee.jsx("span",{className:"text-sm text-muted-foreground",children:yt(Fe.remainingHours)})]}),ee.jsx(VA,{value:Fe.progress,className:"h-3"})]},Fe.id))})]}),ee.jsxs(Lp,{children:[ee.jsx("div",{className:"mb-4",children:ee.jsx("h2",{className:"font-gaegu font-bold text-3xl text-foreground",children:"Snails incoming"})}),T?ee.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Loading..."}):Ci.length===0?ee.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No one is approaching your base."}):ee.jsx("div",{className:"space-y-4",children:Ci.map(Fe=>ee.jsxs("button",{type:"button",onClick:()=>gt(Fe.id),className:"w-full text-left space-y-2 rounded-lg border border-border/70 p-3 transition hover:bg-muted/40 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:[ee.jsxs("div",{className:"flex items-center justify-between",children:[ee.jsxs("div",{className:"flex items-center gap-2",children:[ee.jsx("img",{src:"/enemy-snail.webp",alt:"",className:"h-10 w-10"}),ee.jsxs("span",{className:"font-medium text-foreground",children:["From ",Fe.sender_username]})]}),ee.jsx("span",{className:"text-sm text-muted-foreground",children:yt(Fe.remainingHours)})]}),ee.jsx(VA,{value:Fe.progress,variant:"danger",className:"h-3"})]},Fe.id))})]})]}),ee.jsx(Nx,{activeTab:"deploy"})]})}function C4(d){const h=d.data;switch(d.type){case"arrival_success":return{title:"Invasion Successful!",description:`Your snail invaded ${h.target_username}'s base`,icon:"",isPositive:!0,resources:[{label:"",value:h.salt_reward??0,isPositive:!0},{label:"",value:h.snail_reward??0,isPositive:!0}]};case"arrival_invaded":return{title:"Base Invaded!",description:`${h.sender_username}'s snail reached your base`,icon:"",isPositive:!1,resources:[{label:"",value:h.salt_penalty??0,isPositive:!1}]};case"intercept":return{title:"Snail Intercepted!",description:`You captured ${h.sender_username}'s snail at ${Math.round((h.progress??0)*100)}%`,icon:"",isPositive:!0,resources:[{label:"",value:h.salt_reward??0,isPositive:!0},{label:"",value:h.snail_reward??0,isPositive:!0}]};case"snail_intercepted":return{title:"Snail Intercepted!",description:`${h.interceptor_username} intercepted your snail at ${Math.round((h.progress??0)*100)}%`,icon:"",isPositive:!1,resources:[{label:"",value:1,isPositive:!1}]};default:return{title:"Notification",description:"Something happened",icon:"",isPositive:!0,resources:[]}}}function I4(d){const h=new Date(d),T=new Date().getTime()-h.getTime(),R=Math.floor(T/6e4),D=Math.floor(T/36e5),B=Math.floor(T/864e5);return R<1?"Just now":R<60?`${R}m ago`:D<24?`${D}h ago`:`${B}d ago`}function R4({notification:d}){const h=C4(d);return ee.jsx("div",{className:"rounded-lg border border-border/70 p-3",children:ee.jsxs("div",{className:"space-y-1",children:[ee.jsxs("div",{className:"flex items-center justify-between gap-2",children:[ee.jsx("p",{className:"font-semibold leading-none flex-1",style:{fontSize:"26px"},children:h.title}),ee.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap leading-none",children:I4(d.created_at)})]}),ee.jsx("p",{className:"text-muted-foreground leading-snug",style:{fontSize:"22px"},children:h.description}),h.resources.length>0&&ee.jsx("div",{className:"flex items-center gap-3 pt-0.5",children:h.resources.map((_,T)=>ee.jsxs("span",{className:`font-semibold leading-none ${_.isPositive?"text-green-600":"text-red-600"}`,style:{fontSize:"22px"},children:[_.isPositive?"+":"-",_.value," ",_.label]},T))})]})})}function M4(){const{notifications:d,loading:h,markAllAsRead:_}=$1(),{refresh:T}=Ev();return le.useEffect(()=>{!h&&d.length>0&&d.some(D=>!D.read)&&_().then(()=>T())},[h,d,_,T]),ee.jsxs("div",{className:"fixed inset-0 flex flex-col",children:[ee.jsx("div",{className:"fixed inset-0 bg-cover bg-center opacity-40 pointer-events-none",style:{backgroundImage:"url('/background.png')"},"aria-hidden":"true"}),ee.jsx("div",{className:"relative flex-1 overflow-y-auto pb-24",children:ee.jsx("div",{className:"relative z-10 container max-w-screen-sm mx-auto py-6 space-y-6",children:ee.jsxs(Lp,{children:[ee.jsx("h2",{className:"font-gaegu font-bold text-3xl text-foreground mb-4",children:"Notifications"}),h?ee.jsx("div",{className:"flex items-center justify-center py-12",children:ee.jsx(Pp,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):d.length===0?ee.jsx("div",{className:"text-center py-12",children:ee.jsx("p",{className:"text-muted-foreground",children:"No notifications yet"})}):ee.jsx("div",{className:"space-y-2",children:d.map(R=>ee.jsx(R4,{notification:R},R.id))})]})})}),ee.jsx(Nx,{activeTab:"notifications"})]})}function D4(){const{user:d,logout:h}=hd(),{profile:_,loading:T,purchaseSnail:R}=Ev(),[D,B]=le.useState(!1),[r,q]=le.useState(null),H=async()=>{try{await h()}catch(he){console.error("Logout failed:",he)}},ie=_?.username||d?.user_metadata?.username||d?.email?.split("@")[0]||"Player",Q=_?.salt_balance??0,me=_?.snail_inventory??0,we=Q>=100,Ae=async()=>{if(!D){q(null),B(!0);try{await R(),q({type:"success",message:"Purchased 1 snail for 100 salt."})}catch(he){console.error("Failed to purchase snail:",he),q({type:"error",message:he instanceof Error?he.message:"Unable to complete purchase. Try again."})}finally{B(!1)}}};return ee.jsxs("div",{className:"fixed inset-0 flex flex-col",children:[ee.jsx("div",{className:"fixed inset-0 bg-cover bg-center opacity-40 pointer-events-none",style:{backgroundImage:"url('/background.png')"},"aria-hidden":"true"}),ee.jsx("div",{className:"relative flex-1 overflow-y-auto pb-24",children:ee.jsxs("div",{className:"relative z-10 container max-w-screen-sm mx-auto py-6 space-y-6",children:[ee.jsx(Lp,{children:ee.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[ee.jsxs(av,{className:"w-16 h-16",children:[ee.jsx(g4,{src:"/snail-avatar.svg",alt:"Snail avatar"}),ee.jsx(lv,{className:"bg-primary text-primary-foreground text-2xl",children:ie.charAt(0).toUpperCase()})]}),ee.jsxs("div",{className:"flex-1",children:[ee.jsx("h1",{className:"font-gaegu font-bold text-3xl sm:text-4xl text-foreground tracking-wide leading-tight",children:ie}),d?.email&&ee.jsx("p",{className:"text-sm text-muted-foreground",children:d.email})]}),ee.jsx(Us,{variant:"ghost",size:"icon",onClick:H,className:"ml-auto",children:ee.jsx(v3,{className:"w-5 h-5"})})]})}),ee.jsx("div",{className:"space-y-3",children:ee.jsx(Lp,{children:ee.jsxs("div",{className:"space-y-3",children:[ee.jsx("h2",{className:"font-gaegu font-bold text-3xl text-foreground",children:"Achievements"}),ee.jsxs("div",{className:"flex flex-col gap-4 text-foreground",children:[ee.jsxs("div",{className:"flex items-center justify-between",children:[ee.jsxs("div",{className:"flex items-center gap-2",children:[ee.jsx("span",{className:"text-xl",children:""}),ee.jsx("p",{className:"text-base text-muted-foreground font-semibold",children:"Successful invasions"})]}),ee.jsx("p",{className:"font-gaegu font-bold text-4xl",children:T?"...":_?.successful_invasions??0})]}),ee.jsxs("div",{className:"flex items-center justify-between",children:[ee.jsxs("div",{className:"flex items-center gap-2",children:[ee.jsx("span",{className:"text-xl",children:""}),ee.jsx("p",{className:"text-base text-muted-foreground font-semibold",children:"Snails intercepted"})]}),ee.jsx("p",{className:"font-gaegu font-bold text-4xl",children:T?"...":_?.snails_intercepted??0})]})]})]})})}),ee.jsx("div",{className:"space-y-3",children:ee.jsx(Lp,{children:ee.jsxs("div",{className:"space-y-4",children:[ee.jsxs("div",{className:"flex items-center justify-between",children:[ee.jsx("h2",{className:"font-gaegu font-bold text-3xl text-foreground",children:"Shop"}),ee.jsxs("div",{className:"flex items-center gap-4",children:[ee.jsxs("div",{className:"flex items-center gap-2",children:[ee.jsx("span",{style:{fontSize:"22px"},children:""}),ee.jsx("p",{className:"font-gaegu font-bold text-foreground",style:{fontSize:"22px"},children:T?"...":Q})]}),ee.jsxs("div",{className:"flex items-center gap-2",children:[ee.jsx("span",{style:{fontSize:"22px"},children:""}),ee.jsx("p",{className:"font-gaegu font-bold text-foreground",style:{fontSize:"22px"},children:T?"...":me})]})]})]}),ee.jsxs("div",{className:"space-y-3",children:[ee.jsxs("div",{className:"space-y-1",children:[ee.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Buy Snails"}),ee.jsx("p",{className:"text-sm text-muted-foreground",children:"Trade 100  for 1  for your offensive lineup."})]}),ee.jsx(Us,{onClick:Ae,disabled:D||!we||T,className:"w-full bg-transparent hover:bg-[#78350F]/10 text-black font-semibold text-lg border border-[#78350F]",children:D?"Processing...":"Buy 1 "}),!we&&!T&&ee.jsx("p",{className:"text-xs text-muted-foreground",children:"Earn more salt through deliveries or interceptions to keep buying snails."}),r&&ee.jsx("p",{className:`text-sm ${r.type==="error"?"text-red-500":"text-emerald-500"}`,children:r.message})]})]})})})]})}),ee.jsx(Nx,{activeTab:"profile"})]})}const nv=[103.8198,1.3521];function O4(){const{user:d,loading:h,logout:_}=hd(),{profile:T,createProfile:R,loading:D}=Ev(),[,B]=zx(),[r,q]=le.useState(null),[H,ie]=le.useState(nv),[Q,me]=le.useState(!0),[we,Ae]=le.useState(!1),he=d?.user_metadata?.username??"";le.useEffect(()=>{if(d){if(!navigator.geolocation){me(!1),q({lat:nv[1],lng:nv[0]});return}navigator.geolocation.getCurrentPosition(Ue=>{const rt={lat:Ue.coords.latitude,lng:Ue.coords.longitude};ie([rt.lng,rt.lat]),q(rt),me(!1)},()=>{q({lat:nv[1],lng:nv[0]}),me(!1)},{enableHighAccuracy:!0,timeout:1e4})}},[d]),le.useEffect(()=>{T?.home_location&&B("/")},[T?.home_location,B]);const Re=le.useCallback(Ue=>{const rt=Ue.getCenter(),Pt=new xx.Marker({color:"#3B82F6",draggable:!0}).setLngLat([rt.lng,rt.lat]).addTo(Ue);q({lat:rt.lat,lng:rt.lng}),Pt.on("dragend",()=>{const Bt=Pt.getLngLat();q({lat:Bt.lat,lng:Bt.lng})})},[]);if((h||D)&&!we)return ee.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background text-muted-foreground",children:"Loading..."});if(!d)return ee.jsx(mx,{to:"/login"});if(T?.home_location)return ee.jsx(mx,{to:"/"});const Ne=async()=>{if(!he.trim()){ns.error("Username is required. Please sign up again.");return}if(!r){ns.error("Please select a location on the map.");return}Ae(!0);try{await R(he.trim(),r)}catch(Ue){const rt=Ue instanceof Error?Ue.message:"Failed to create profile";ns.error(rt),Ae(!1)}},Ge=async()=>{try{await _(),B("/login")}catch(Ue){const rt=Ue instanceof Error?Ue.message:"Failed to sign out";ns.error(rt)}};return ee.jsx("div",{className:"min-h-screen bg-background px-4 py-8",children:ee.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[ee.jsx("div",{className:"flex justify-end",children:ee.jsx(Us,{variant:"ghost",size:"sm",onClick:Ge,children:"Not you? Sign out"})}),ee.jsxs("div",{className:"text-center space-y-2",children:[ee.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Set up your home base"}),ee.jsx("p",{className:"text-muted-foreground",children:"Drag the marker to set your home base location."})]}),ee.jsx(Lp,{children:ee.jsxs("div",{className:"space-y-4",children:[ee.jsxs("div",{className:"space-y-2",children:[ee.jsx("p",{className:"text-sm font-medium text-foreground",children:"Home base location"}),ee.jsx("div",{className:"relative h-72 rounded-lg border border-border/70 overflow-hidden",children:Q?ee.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Detecting your location..."}):ee.jsx(l1,{center:H,zoom:15,onMapLoad:Re,className:"h-full w-full"})}),r&&ee.jsxs("div",{className:"text-xs text-muted-foreground text-center",children:[r.lat.toFixed(5),", ",r.lng.toFixed(5)]})]}),ee.jsx(Us,{type:"button",className:"w-full",disabled:we||!r||Q,onClick:Ne,children:we?"Saving...":"Create Home Base"})]})})]})})}function rv({component:d,requireProfile:h=!1}){const{isAuthenticated:_,loading:T}=hd(),{profile:R,loading:D}=Ev();return T||h&&D?ee.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:ee.jsx("div",{className:"text-muted-foreground",children:"Loading..."})}):_?h&&(!R||!R.home_location)?ee.jsx(mx,{to:"/setup-home-base"}):ee.jsx(d,{}):ee.jsx(mx,{to:"/login"})}function P4(){return ee.jsxs(Z3,{children:[ee.jsx(Ip,{path:"/login",component:V5}),ee.jsx(Ip,{path:"/",children:ee.jsx(rv,{component:a4,requireProfile:!0})}),ee.jsx(Ip,{path:"/deploy",children:ee.jsx(rv,{component:A4,requireProfile:!0})}),ee.jsx(Ip,{path:"/notifications",children:ee.jsx(rv,{component:M4,requireProfile:!0})}),ee.jsx(Ip,{path:"/profile",children:ee.jsx(rv,{component:D4,requireProfile:!0})}),ee.jsx(Ip,{path:"/setup-home-base",children:ee.jsx(rv,{component:O4})}),ee.jsx(Ip,{path:"/404",component:Q2}),ee.jsx(Ip,{component:Q2})]})}function z4(){return ee.jsx(G5,{children:ee.jsx(H5,{defaultTheme:"light",children:ee.jsx(e4,{children:ee.jsxs(l3,{children:[ee.jsx(gz,{}),ee.jsx(P4,{})]})})})})}const L4=new RP({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1}}});FP.createRoot(document.getElementById("root")).render(ee.jsx(OP,{client:L4,children:ee.jsx(z4,{})}));
